System.register("chunks:///_virtual/AnimationUtils.ts",["cc"],(function(t){var e,o,i,s,n,a,r,l,c,d;return{setters:[function(t){e=t.cclegacy,o=t.Node,i=t.Layers,s=t.UIOpacity,n=t.Sprite,a=t.assetManager,r=t.SpriteFrame,l=t.v3,c=t.tween,d=t._decorator}],execute:function(){var m;e._RF.push({},"14eccGvK+pDd40mf1YiHSFj","AnimationUtils",void 0);const{ccclass:p}=d;t("AnimationUtils",p("AnimationUtils")(m=class{static playImage(t,e,l,c,d,m="up"){console.log(`[AnimationUtils] playImage called with: fromNode=${e.name}, toNode=${l.name}, parentNode=${c.name}, curveType=${m}`);let p=new o("FlyEffectNode");p.layer=i.Enum.UI_2D;let y=p.addComponent(s),u=p.addComponent(n);const f=a.getBundle(t);if(!f)return void console.error(`[AnimationUtils] Bundle ${t} not found`);const _="cocos_lizi/fly/sybres_eft_str_02/spriteFrame";f.load(_,r,((t,o)=>{t?console.error(`[AnimationUtils] Failed to load spriteFrame: ${_}`,t):(u.spriteFrame=o,this._startAnimation(p,u,y,e,l,c,f,d,m))}))}static _startAnimation(t,e,o,i,s,n,a,d,m="up"){t.active=!0,n.addChild(t);let p,y=i.getWorldPosition(),u=s.getWorldPosition();if("down"===m){const t=.3*(u.x-y.x),e=-200;p=l(y.x+t,y.y+e,y.z)}else p=l(y.x,y.y+500,y.z);t.setWorldPosition(y),t.setScale(2,2,1),c(t).to(1,{worldPosition:u},{onUpdate:(e,o)=>{let i=o,s=y,n=p,a=u,r=(1-i)*(1-i)*s.x+2*i*(1-i)*n.x+i*i*a.x,c=(1-i)*(1-i)*s.y+2*i*(1-i)*n.y+i*i*a.y;t.setWorldPosition(l(r,c,0))}}).call((()=>{a.load("cocos_lizi/fly/sybres_eft_exp_04/spriteFrame",r,((i,s)=>{if(i)return console.error("[AnimationUtils] Failed to load explosion sprite",i),t.destroy(),void(d&&d());e.spriteFrame=s,c(t).to(.3,{scale:l(8,8,1)}).start(),c(o).to(.1,{opacity:0}).call((()=>{t.destroy(),d&&d()})).start()}))})).start()}})||m);e._RF.pop()}}}));

System.register("chunks:///_virtual/AnimationViewModel.ts",["cc","./ViewModel.ts","./index80.ts","./index83.ts","./soundDefine21.ts"],(function(e){var o,i,t,n,l,s,a,c,h,d,m,p,k;return{setters:[function(e){o=e.cclegacy,i=e.Node,t=e.UITransform,n=e.Graphics,l=e.Color,s=e.sp,a=e.assetManager,c=e._decorator},function(e){h=e.StoreInject,d=e.default},function(e){m=e.getStore},function(e){p=e.moneyComing_Audio},function(e){k=e.SoundPathDefine}],execute:function(){var r;o._RF.push({},"c8234RwiX9BV79sxen4RPgp","AnimationViewModel",void 0);const{ccclass:w}=c;e("AnimationViewModel",h(m())(r=w("AnimationViewModel")(r=class extends d{constructor(){super("MoneyComing_GameMain"),this.previousBet=10,this.isInitialized=!1}begin(){const e=m().getState();this.previousBet=e.betAmount}connect(e){const o=this.store.getState();console.log("[AnimationViewModel] connect: initial state",o),o&&this.onStateUpdate(o),this.store.subscribe((()=>{const e=this.store.getState();this.onStateUpdate(e)}))}onStateUpdate(e){const o=e.betAmount;this.isInitialized?o!==this.previousBet&&(console.log(`[AnimationViewModel] onStateUpdate: Bet changed from ${this.previousBet} to ${o}`),this.handleBetChange(o)):(console.log(`[AnimationViewModel] onStateUpdate: Initializing with betAmount=${o}`),this.isInitialized=!0,this.setInitialLockState(o),this.previousBet=o)}setInitialLockState(e){if(console.log(`[AnimationViewModel] setInitialLockState: betAmount=${e}`),1===e){const e=this.comp.wheel3LockNode;e?(this.showWheel3ShadowMask(),this.playSpineAnimation(e,"spine/lock/wheel_lock","stand",!0)):console.warn("[AnimationViewModel] setInitialLockState: wheel3LockNode is missing");const o=this.comp.luckyWheelLockNode;o?this.playSpineAnimation(o,"spine/lock/unlock","stand",!0):console.warn("[AnimationViewModel] setInitialLockState: luckyWheelLockNode is missing")}else this.comp.wheel3LockNode&&(this.comp.wheel3LockNode.active=!1),this.comp.luckyWheelLockNode&&(this.comp.luckyWheelLockNode.active=!1),this.hideWheel3ShadowMask()}handleBetChange(e){const o=this.previousBet;console.log(`[AnimationViewModel] handleBetChange: previous=${o}, new=${e}`),e>o&&p&&p.playOneShot(k.activeFeature),1!==o&&1===e?(console.log("[AnimationViewModel] Switching to Bet 1 -> LOCK"),this.playWheel3LockAnimation(),this.playLuckyWheelLockAnimation()):1===o&&1!==e&&(console.log("[AnimationViewModel] Switching from Bet 1 -> UNLOCK"),this.playWheel3UnlockAnimation(),this.playLuckyWheelUnlockAnimation()),this.previousBet=e}playWheel3LockAnimation(){const e=this.comp.wheel3LockNode;console.log("[AnimationViewModel] playWheel3LockAnimation: lockNode exists?",!!e),e&&(this.showWheel3ShadowMask(),p&&p.playOneShot(k.wheelLock),this.playSpineAnimation(e,"spine/lock/wheel_lock","lock",!1,(()=>{this.playSpineAnimation(e,"spine/lock/wheel_lock","stand",!0)})))}playWheel3UnlockAnimation(){const e=this.comp.wheel3LockNode;e&&(this.hideWheel3ShadowMask(),this.playSpineAnimation(e,"spine/lock/wheel_lock","unlock",!1,(()=>{e.active=!1})))}showWheel3ShadowMask(){const e=this.comp.wheels[2];if(!e||!e.node)return;let o=e.node.getChildByName("wheel_shadow_mask");if(!o){o=new i("wheel_shadow_mask"),e.node.addChild(o),o.setPosition(-7,0,0),o.setScale(1.25,1,1);o.addComponent(t).setContentSize(200,400);const s=o.addComponent(n);s.clear(),s.fillColor=new l(0,0,0,128),s.rect(-100,-200,200,400),s.fill()}o.active=!0;const s=this.comp.wheel3LockNode;s?o.setSiblingIndex(Math.max(0,s.getSiblingIndex()-1)):o.setSiblingIndex(e.node.children.length-1)}hideWheel3ShadowMask(){const e=this.comp.wheels[2];if(!e||!e.node)return;const o=e.node.getChildByName("wheel_shadow_mask");o&&(o.active=!1)}playLuckyWheelLockAnimation(){const e=this.comp.luckyWheelLockNode;e&&this.playSpineAnimation(e,"spine/lock/unlock","start",!1,(()=>{this.playSpineAnimation(e,"spine/lock/unlock","stand",!0)}))}playLuckyWheelUnlockAnimation(){const e=this.comp.luckyWheelLockNode;e&&this.playSpineAnimation(e,"spine/lock/unlock","end",!1,(()=>{e.active=!1}))}playSymbolAnimation(e,o,t=!1){if(!e)return;let n=e.getChildByName("symbol_anim");n||(n=new i("symbol_anim"),e.addChild(n),n.setPosition(0,0,0)),n.setScale(1,1,1),this.playSpineAnimation(n,`spine/${o}/${o}`,"animation",t)}playSpineAnimation(e,o,i,t,n){if(!e)return void console.warn("[AnimationViewModel] playSpineAnimation: node is null");console.log(`[AnimationViewModel] playSpineAnimation: path=${o}, anim=${i}, node=${e.name}, active=${e.active}`),e.active=!0;let l=e.getComponent(s.Skeleton);l||(l=e.addComponent(s.Skeleton),console.log("[AnimationViewModel] Added sp.Skeleton component"));const c=a.getBundle("moneyComing");c?c.load(o,s.SkeletonData,((e,s)=>{if(e||!l)return void console.error(`[AnimationViewModel] Failed to load spine: ${o}`,e);console.log(`[AnimationViewModel] Spine loaded successfully: ${o}`),l.skeletonData=s,l.premultipliedAlpha=!0;const a=l.setAnimation(0,i,t);console.log(`[AnimationViewModel] Animation set: ${i}, trackEntry=${!!a}`),a&&!t&&n&&l.setCompleteListener((()=>{l.setCompleteListener(null),n()}))})):console.error("[AnimationViewModel] Failed to get bundle: moneyComing")}})||r)||r);o._RF.pop()}}}));

System.register("chunks:///_virtual/BetSelection.ts",["cc"],(function(e){var t,c,n;return{setters:[function(e){t=e.cclegacy,c=e.Component,n=e._decorator}],execute:function(){var A;t._RF.push({},"12345Z4AAAAAAAAAAAAAAAA","BetSelection",void 0);const{ccclass:o,property:s}=n;e("BetSelection",o("BetSelection")(A=class extends c{start(){}update(e){}})||A);t._RF.pop()}}}));

System.register("chunks:///_virtual/config20.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"18850r0KmRN6qlyxOsoJpRt","config",void 0);e("default",{sktCode:"MoneyComing",name:"MoneyComing",gameId:14007,isTest:!1,seatNumber:1,isReconnect:!1,memberId:"",testConfig:{wsUrl:"",token:"",uid:""},api:{useMCP:!0,gameId:14007,variantId:"standard"},gameConfig:{autoSpin:{totalSpins:50,intervals:{normal:1,turbo:.5,superTurbo:.2}},sequentialStop:{initialStopDelay:4.5,wheelStopInterval:.2},simultaneousStop:{normal:{scrollDuration:3,stopDuration:.1},turbo:{scrollDuration:2,stopDuration:.1},superTurbo:{scrollDuration:1,stopDuration:.1}},luckyWheelPrizes:{5:[1e3,250,50,150,75,500,25,100],10:[2e3,500,100,300,150,1e3,50,200],50:[5e4,1e4,1e3,5e3,1500,25e3,500,2500],100:[1e5,2e4,2e3,1e4,3e3,5e4,1e3,5e3]},luckyWheel:{spinDuration:6,accelerationDuration:.5,decelerationDuration:1,maxRotationSpeed:720,easing:"cubicOut",anglePerPrize:45,startAngleOffset:0},gameplay:{winDisplayDuration:.1,symbolProbability:.8,bigWin:{big:15e4,mega:3e5,super:5e5}},constants:{elementPrefix:"element_",featureMultiplierPrefix:"feature_x",featureScatterKeyword:"feature_scatter",featureAllRespinKeyword:"feature_all_respin",bundleName:"moneyComing"}}});t._RF.pop()}}}));

System.register("chunks:///_virtual/game37.ts",["cc","./index.mjs_cjs=&original=2.js","./index2.js"],(function(e){var t,n;return{setters:[function(e){t=e.cclegacy},null,function(e){n=e.default}],execute:function(){t._RF.push({},"4b354Q8P1pH4K0SMiEw2Kdu","game",void 0);e("updateBalance",n.createAction("UPDATE_BALANCE")),e("updateBet",n.createAction("UPDATE_BET")),e("updateWin",n.createAction("UPDATE_WIN")),e("setSpinning",n.createAction("SET_SPINNING")),e("setRespin",n.createAction("SET_RESPIN")),e("setSpinResults",n.createAction("SET_SPIN_RESULTS")),e("setTurboMode",n.createAction("SET_TURBO_MODE")),e("setAutoSpin",n.createAction("SET_AUTO_SPIN"));t._RF.pop()}}}));

System.register("chunks:///_virtual/GameMainViewModel2.ts",["cc","./ViewModel.ts","./index61.ts","./index80.ts","./MoneyComing_GameMain.ts","./socketConnect20.ts","./index81.ts","./game37.ts","./config20.ts","./index83.ts","./soundDefine21.ts"],(function(e){var o,t,n,i,s,l,a,c,p,h,r,u,m,d,g,M,S,y,w,A,f;return{setters:[function(e){o=e.cclegacy,t=e._decorator},function(e){n=e.StoreInject,i=e.default},function(e){s=e.global},function(e){l=e.getStore},function(e){a=e.MoneyComing_GameMain},function(e){c=e.moneyComingWebSocketDriver,p=e.SKT_MAG_TYPE},function(e){h=e.bundlePkgName},function(e){r=e.setAutoSpin,u=e.setTurboMode,m=e.updateBet,d=e.updateWin,g=e.updateBalance,M=e.setSpinning,S=e.setRespin,y=e.setSpinResults},function(e){w=e.default},function(e){A=e.moneyComing_Audio},function(e){f=e.SoundPathDefine}],execute:function(){var C;o._RF.push({},"d5bd4ymCwtHVZf5COZPZI7Z","GameMainViewModel",void 0);const{ccclass:R}=t;e("GameMainViewModel",n(l())(C=R("GameMainViewModel")(C=class extends i{constructor(){super(a),this.lastSpinData=null}begin(){this.listenServerMsg(),this.playBgMusic()}connect(e){return this.inject(e,(e=>(console.log("[GameMainViewModel] inject selector 被调用, state.spinResults:",e.spinResults),{balance:e.balance,betAmount:e.betAmount,winAmount:e.winAmount,spinResults:e.spinResults,isSpinning:e.isSpinning,isRespin:e.isRespin,turboMode:e.turboMode,autoSpin:e.autoSpin}))),this.setEvent({onSpin:()=>{this.onSpin()},onAutoSpin:()=>{this.comp.props.autoSpin?(console.log("[MoneyComing] 停止 AutoSpin"),this.dispatch(r(!1))):(console.log("[MoneyComing] 开始 AutoSpin"),this.dispatch(r(!0)),this.onSpin())},onTurbo:()=>{const e=(this.comp.props.turboMode+1)%3;console.log("[MoneyComing] 切换 Turbo 模式:",0===e?"Normal":1===e?"Turbo":"Super Turbo"),this.dispatch(u(e))},onBetChange:e=>{e>this.comp.props.betAmount&&A.playOneShot(f.activeFeature),this.dispatch(m(e))},onSpinComplete:()=>{const e=this.comp.props.spinResults;if("feature_all_respin"===e[3]&&this.respinViewModel)return console.log("[MoneyComing] 触发 All Respin Feature"),void this.handleAllRespinFlow(e);if(e[3]&&e[3].includes("scatter"))return console.log("[MoneyComing] 触发 Scatter Feature"),void this.handleScatterFlow(e);const o=this.lastSpinData?this.lastSpinData.winAmount:0,t=this.lastSpinData?this.lastSpinData.balance:this.comp.props.balance;console.log("[MoneyComing] 轮盘停止完成，MCP 返回:"),console.log("  - 中奖金额:",o,"元"),console.log("  - 新余额:",t,"元"),console.log("  - lastSpinData:",this.lastSpinData),this.comp.playWinAnimations(e),this.checkAndPlayBigWin(o,(()=>{this.dispatch(d(o)),this.dispatch(g(t)),this.dispatch(M(!1)),this.handleAutoSpin()}))}}),this}handleAutoSpin(){if(this.comp.props.autoSpin){const e=this.getAutoSpinInterval();console.log(`[MoneyComing] AutoSpin 下一次延迟: ${e}秒`),this.comp.scheduleOnce((()=>{this.comp.props.autoSpin&&this.onSpin()}),e)}}async handleAllRespinFlow(e){console.log("[MoneyComing] ========== All Respin Flow 开始 ==========");const o=this.lastSpinData?this.lastSpinData.balance:this.comp.props.balance,t=this.lastSpinData?this.lastSpinData.winAmount:0;console.log("[MoneyComing] 第一次 Spin:"),console.log("  - 初始中奖:",t,"元"),console.log("  - 当前余额:",o,"元"),this.dispatch(d(t)),this.dispatch(g(o));const n=this.respinViewModel,i=this.comp.props.betAmount;await n.handleAllRespin(e,(e=>{if(console.log("[MoneyComing] Respin 完成，最终结果:",e),this.lastSpinData){const e=this.lastSpinData.winAmount,o=this.lastSpinData.balance;console.log("[MoneyComing] 更新最终状态:"),console.log("  - 总中奖:",e,"元"),console.log("  - 新余额:",o,"元"),this.checkAndPlayBigWin(e,(()=>{this.dispatch(d(e)),this.dispatch(g(o)),this.dispatch(M(!1)),console.log("[MoneyComing] ========== All Respin Flow 完成 =========="),this.handleAutoSpin()}))}else console.error("[MoneyComing] lastSpinData 丢失，无法更新状态"),this.dispatch(M(!1))}),(async()=>{console.log("[MoneyComing] 调用 MCP API 获取 Respin 结果...");try{const e=await c.api.spin(i);return console.log("[MoneyComing] Respin API 返回:"),console.log("  - Respin 中奖:",e.winAmount,"元（本次免费转）"),console.log("  - 总中奖:",e.totalWinAmount,"元（基础 + 免费转）"),console.log("  - 新余额:",e.balance,"元"),console.log("  - Respin 结果:",e.spinResults),this.lastSpinData={winAmount:e.totalWinAmount,balance:e.balance},e.spinResults}catch(o){return console.error("[MoneyComing] Respin API 调用失败:",o),s.hallDispatch({type:"ADD_TOAST",payload:{content:"Respin 失败"}}),e}}))}async handleScatterFlow(e){console.log("[MoneyComing] ========== Scatter Flow 开始 ==========");const o=this.comp.props.betAmount,t=this.calculateWinAmount(e,o);console.log("[MoneyComing] 第一次 Spin - 基础中奖:",t,"元");const n=this.lastSpinData?this.lastSpinData.balance:this.comp.props.balance,i=this.lastSpinData?this.lastSpinData.winAmount:t;this.dispatch(d(i)),this.dispatch(g(n)),this.comp.showFeaturePanel(t,"scatter",o),this.comp.playFeatureSymbolAnimation(e[3]),this.comp.playScatterFlyAnimation(o,(async()=>{console.log("[MoneyComing] Scatter Fly Complete, 调用 MCP API 获取 Lucky Wheel 结果...");try{const e=await c.api.spin(o);if(console.log("[MoneyComing] Lucky Wheel API 返回:"),console.log("  - featureResult:",e.featureResult),console.log("  - 总中奖:",e.totalWinAmount,"元（基础 + Lucky Wheel）"),console.log("  - 新余额:",e.balance,"元"),!e.featureResult){console.error("[MoneyComing] API 返回缺少 featureResult，使用 Mock 数据");const e=Math.floor(8*Math.random()),i=o*(e+1)*5;return void this.handleLuckyWheelSpin(e,i,t,n)}const{selectedIndex:i,winAmount:s}=e.featureResult;console.log(`[MoneyComing] MCP 返回: selectedIndex=${i}, Feature 中奖: ${s} 元`);const l=w.gameConfig.luckyWheelPrizes[o],a=l?l.indexOf(s):-1;-1===a&&console.warn(`[MoneyComing] 未找到匹配的奖品金额 ${s}，使用 MCP index ${i}`);const p=-1!==a?a:i;console.log(`[MoneyComing] Lucky Wheel 实际停止位置: ${p}`);const h=this.luckyWheelViewModel;h?h.spin(p,(()=>{console.log("[MoneyComing] Lucky Wheel Spin Complete"),this.comp.updateFeatureBonus(s),A.playOneShot(f.scatterOver),setTimeout((()=>{const o=e.totalWinAmount;this.lastSpinData={winAmount:o,balance:e.balance},this.checkAndPlayBigWin(o,(()=>{this.dispatch(d(o)),this.dispatch(g(e.balance)),this.dispatch(M(!1)),this.comp.hideFeaturePanel(),console.log("[MoneyComing] ========== Scatter Flow 完成 =========="),this.handleAutoSpin()}))}),2e3)})):(console.error("[MoneyComing] LuckyWheelViewModel not found"),this.dispatch(M(!1)),this.comp.hideFeaturePanel())}catch(e){console.error("[MoneyComing] Lucky Wheel API 调用失败:",e);const i=Math.floor(8*Math.random()),s=o*(i+1)*5;this.handleLuckyWheelSpin(i,s,t,n)}}))}handleLuckyWheelSpin(e,o,t,n){const i=this.luckyWheelViewModel;i?i.spin(e,(()=>{this.comp.updateFeatureBonus(o),A.playOneShot(f.scatterOver),setTimeout((()=>{const e=t+o;this.checkAndPlayBigWin(e,(()=>{this.dispatch(d(e)),this.dispatch(g(n-this.comp.props.betAmount+e)),this.dispatch(M(!1)),this.comp.hideFeaturePanel(),this.handleAutoSpin()}))}),2e3)})):(console.error("[MoneyComing] LuckyWheelViewModel not found"),this.dispatch(M(!1)),this.comp.hideFeaturePanel())}async recoverAllRespin(){console.log("[GameMainViewModel] ========== 开始 All Respin 崩溃恢复 ==========");const e=this.comp.props.spinResults||[],o=this.comp.props.betAmount;console.log("[GameMainViewModel] 当前显示结果:",e),console.log("[GameMainViewModel] 投注金额:",o,"元"),console.log("[GameMainViewModel] 提前锁定所有轮子，防止任何转动");const t=this.comp.wheels;if(t&&t.length>=4)for(let o=0;o<4;o++){const n=t[o];n&&(n.lock(),n._isSpinning=!1,n._spinState=0,e[o]&&n.showResult(e[o],!1),console.log(`[GameMainViewModel] 轮子 ${o} 已提前锁定:`,e[o]))}this.dispatch(S(!0)),console.log("[GameMainViewModel] 恢复流程：已设置 isRespin=true"),await new Promise((e=>setTimeout(e,50))),this.dispatch(M(!0)),console.log("[GameMainViewModel] 恢复流程：已设置 isSpinning=true");const n=this.respinViewModel;if(!n)return console.error("[GameMainViewModel] RespinViewModel 未找到，无法恢复"),void this.dispatch(M(!1));await n.handleAllRespin(e,(e=>{if(console.log("[GameMainViewModel] 恢复的 Respin 完成，最终结果:",e),this.lastSpinData){const e=this.lastSpinData.winAmount,o=this.lastSpinData.balance;console.log("[GameMainViewModel] 恢复完成，更新最终状态:"),console.log("  - 总中奖:",e,"元"),console.log("  - 新余额:",o,"元"),this.checkAndPlayBigWin(e,(()=>{this.dispatch(d(e)),this.dispatch(g(o)),this.dispatch(M(!1)),console.log("[GameMainViewModel] ========== All Respin 崩溃恢复完成 ==========")}))}else console.error("[GameMainViewModel] lastSpinData 丢失，无法更新状态"),this.dispatch(M(!1))}),(async()=>{console.log("[GameMainViewModel] 调用 MCP API 获取恢复的 Respin 结果...");try{const e=await c.api.spin(o);return console.log("[GameMainViewModel] 恢复的 Respin API 返回:"),console.log("  - Respin 中奖:",e.winAmount,"元（本次免费转）"),console.log("  - 总中奖:",e.totalWinAmount,"元（基础 + 免费转）"),console.log("  - 新余额:",e.balance,"元"),console.log("  - Respin 结果:",e.spinResults),this.lastSpinData={winAmount:e.totalWinAmount,balance:e.balance},e.spinResults}catch(o){return console.error("[GameMainViewModel] 恢复的 Respin API 调用失败:",o),s.hallDispatch({type:"ADD_TOAST",payload:{content:"Respin 恢复失败"}}),this.dispatch(M(!1)),e}}),!0)}async recoverScatter(){console.log("[GameMainViewModel] ========== 开始 Scatter 崩溃恢复 ==========");const e=this.comp.props.spinResults||[],o=this.comp.props.betAmount;console.log("[GameMainViewModel] 当前显示结果:",e),console.log("[GameMainViewModel] 投注金额:",o,"元");const t=this.calculateWinAmount(e,o);console.log("[GameMainViewModel] 第一次 Spin 基础中奖:",t,"元"),console.log("[GameMainViewModel] 锁定所有轮子，防止转动");const n=this.comp.wheels;if(n&&n.length>=4)for(let o=0;o<4;o++){const t=n[o];t&&(t.lock(),t._isSpinning=!1,t._spinState=0,e[o]&&t.showResult(e[o],!1),console.log(`[GameMainViewModel] 轮子 ${o} 已锁定:`,e[o]))}this.dispatch(S(!0)),console.log("[GameMainViewModel] 恢复流程：已设置 isRespin=true"),await new Promise((e=>setTimeout(e,50))),this.dispatch(M(!0)),console.log("[GameMainViewModel] 恢复流程：已设置 isSpinning=true（禁用按钮）"),this.comp.showFeaturePanel(t,"scatter",o),console.log("[GameMainViewModel] 播放 scatter 飞行动画..."),await new Promise((e=>{this.comp.playScatterFlyAnimation(o,(()=>{console.log("[GameMainViewModel] Scatter 飞行动画完成"),e()}))})),console.log("[GameMainViewModel] 调用 MCP API 获取 Lucky Wheel 结果...");try{const e=await c.api.spin(o);if(console.log("[GameMainViewModel] Lucky Wheel API 返回:"),console.log("  - featureResult:",e.featureResult),console.log("  - 总中奖:",e.totalWinAmount,"元（基础 + Lucky Wheel）"),console.log("  - 新余额:",e.balance,"元"),!e.featureResult){console.error("[GameMainViewModel] API 返回缺少 featureResult"),s.hallDispatch({type:"ADD_TOAST",payload:{content:"Lucky Wheel 恢复失败"}}),this.dispatch(S(!1)),this.dispatch(M(!1)),this.comp.hideFeaturePanel();const e=this.comp.wheels;if(e)for(let o=0;o<4;o++)e[o]&&e[o].unlock();return}const{selectedIndex:t,winAmount:n}=e.featureResult;console.log(`[GameMainViewModel] MCP 返回: selectedIndex=${t}, Feature 中奖: ${n} 元`);const i=w.gameConfig.luckyWheelPrizes[o],l=i?i.indexOf(n):-1;-1===l&&console.warn(`[GameMainViewModel] 未找到匹配的奖品金额 ${n}，使用 MCP index ${t}`);const a=-1!==l?l:t;console.log(`[GameMainViewModel] Lucky Wheel 实际停止位置: ${a}`);const p=this.luckyWheelViewModel;if(!p){console.error("[GameMainViewModel] LuckyWheelViewModel 未找到"),this.dispatch(S(!1)),this.dispatch(M(!1)),this.comp.hideFeaturePanel();const e=this.comp.wheels;if(e)for(let o=0;o<4;o++)e[o]&&e[o].unlock();return}p.spin(a,(()=>{console.log("[GameMainViewModel] Lucky Wheel Spin Complete"),this.comp.updateFeatureBonus(n),A.playOneShot(f.scatterOver),setTimeout((()=>{const o=e.totalWinAmount;this.lastSpinData={winAmount:o,balance:e.balance},this.checkAndPlayBigWin(o,(()=>{this.dispatch(d(o)),this.dispatch(g(e.balance)),this.dispatch(S(!1)),this.dispatch(M(!1)),this.comp.hideFeaturePanel(),console.log("[GameMainViewModel] 解锁所有轮子");const t=this.comp.wheels;if(t&&t.length>=4)for(let e=0;e<4;e++)t[e]&&(t[e].unlock(),console.log(`[GameMainViewModel] 轮子 ${e} 已解锁`));console.log("[GameMainViewModel] ========== Scatter 崩溃恢复完成 ==========")}))}),2e3)}))}catch(e){console.error("[GameMainViewModel] Lucky Wheel API 调用失败:",e),s.hallDispatch({type:"ADD_TOAST",payload:{content:"Lucky Wheel 恢复失败"}}),this.dispatch(S(!1)),this.dispatch(M(!1)),this.comp.hideFeaturePanel();const o=this.comp.wheels;if(o)for(let e=0;e<4;e++)o[e]&&o[e].unlock()}}checkAndPlayBigWin(e,o){const t=e/this.comp.props.betAmount;let n="";t>=20?n="super":t>=10?n="mega":t>=5&&(n="big"),n?(console.log(`[MoneyComing] Trigger Big Win: ${n}, amount: ${e}`),this.comp.playBigWinEffect(n,e,o)):o()}getAutoSpinInterval(){const e=this.comp.props.turboMode;return 1===e?w.gameConfig.autoSpin.intervals.turbo:2===e?w.gameConfig.autoSpin.intervals.superTurbo:w.gameConfig.autoSpin.intervals.normal}generateSpinResults(){const e=["element_0","element_00","element_1","element_5","element_10"],o=this.comp.props.betAmount,t=[];for(let n=0;n<3;n++)(1!==o||2!==n)&&Math.random()<.8?t.push(e[Math.floor(Math.random()*e.length)]):t.push("");let n=["feature_x2","feature_x5","feature_all_respin"];return 5===o?n.push("feature_scatter"):10===o?n.push("feature_x10","feature_scatter"):50!==o&&100!==o||n.push("feature_x10","feature_scatter_50_100"),Math.random()<.8?t.push(n[Math.floor(Math.random()*n.length)]):t.push(""),t}calculateWinAmount(e,o){if(e.length<4)return 0;const t=e.slice(0,3),n=e[3];let i="";for(const e of t)e&&e.startsWith("element_")&&(i+=e.replace("element_",""));if(""===i)return 0;const s=parseInt(i,10);if(isNaN(s)||0===s)return 0;let l=1;return"feature_x2"===n?l=2:"feature_x5"===n?l=5:"feature_x10"===n&&(l=10),s*l}onSpin(e=null){if(this.comp.props.isSpinning)return;this.dispatch(y([])),this.dispatch(M(!0));const o=Date.now(),t=this.comp.props.betAmount;if(!c||!c.api)return console.error("[MoneyComing] API not initialized"),this.dispatch(M(!1)),void s.hallDispatch({type:"ADD_TOAST",payload:{content:"API 未初始化"}});const n=e||{clearState:!1};c.api.spin(t,n).then((e=>{console.log("[MoneyComing] Spin 成功，结果:",e),this.lastSpinData={winAmount:e.winAmount,balance:e.balance};const t=(Date.now()-o)/1e3,n=this.comp.props.turboMode;let i=w.gameConfig.simultaneousStop.normal.scrollDuration;1===n?i=w.gameConfig.simultaneousStop.turbo.scrollDuration:2===n&&(i=w.gameConfig.simultaneousStop.superTurbo.scrollDuration);const s=Math.max(0,i-t);console.log(`[MoneyComing] 转动时间控制: 已转动=${t.toFixed(2)}秒, 最小时长=${i}秒, 还需等待=${s.toFixed(2)}秒`),setTimeout((()=>{console.log("[GameMainViewModel] 准备 dispatch setSpinResults:",e.spinResults),this.dispatch(y(e.spinResults)),console.log("[GameMainViewModel] dispatch setSpinResults 完成")}),1e3*s)})).catch((e=>{console.error("[MoneyComing] Spin 失败:",e),s.hallDispatch({type:"ADD_TOAST",payload:{content:"Spin 失败，请重试"}}),this.dispatch(M(!1))}))}listenServerMsg(){console.log("[MoneyComing] 设置 WebSocket 监听器..."),c.sktMsgListener.add(p.SPIN,h,(e=>{console.log("[MoneyComing] 收到 SPIN 响应:",e),this.dispatch(y(e.results))}))}playBgMusic(){this.comp.scheduleOnce((()=>{A.stop(),this.comp.scheduleOnce((()=>{A.play(f.bg,!0)}))}))}unMountCallBack(){c.sktMsgListener.remove(p.SPIN,h)}})||C)||C);o._RF.pop()}}}));

System.register("chunks:///_virtual/index80.ts",["cc","./redux.mjs_cjs=&original=.js","./index82.ts","./redux.js"],(function(e){var t,n,o;return{setters:[function(e){t=e.cclegacy},null,function(e){n=e.rootReducer},function(e){o=e.default}],execute:function(){let r;e("store",void 0),t._RF.push({},"25c02KUwCBEBKpdOTVmCIxz","index",void 0);const c=t=>{if(!r){const t=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||o.compose;r=e("store",o.createStore(n,t(o.applyMiddleware())))}return r};e("default",{configureStore:c});e("getStore",(()=>(r||c(),r)));t._RF.pop()}}}));

System.register("chunks:///_virtual/index81.ts",["cc","./prefabDefine21.ts","./soundDefine21.ts"],(function(e){var n,t,u;return{setters:[function(e){n=e.cclegacy},function(e){t=e.default},function(e){u=e.default}],execute:function(){n._RF.push({},"668502f67VE45lcjAlGJjuA","index",void 0);const c=e("bundlePkgName","moneyComing");e("default",[...t(c),...u(c)]);n._RF.pop()}}}));

System.register("chunks:///_virtual/index82.ts",["cc","./index.mjs_cjs=&original=2.js","./game37.ts","./index2.js"],(function(e){var n,t,o,s,i,u,c,r,l,d;return{setters:[function(e){n=e.cclegacy},null,function(e){t=e.updateBalance,o=e.updateBet,s=e.updateWin,i=e.setSpinning,u=e.setRespin,c=e.setSpinResults,r=e.setTurboMode,l=e.setAutoSpin},function(e){d=e.default}],execute:function(){n._RF.push({},"6fb59NzZ7JMAbVTDMEx39UD","index",void 0);const p=d.createReducer({[t.toString()]:(e,n)=>(console.log("[Reducer] updateBalance:",n),{...e,balance:n}),[o.toString()]:(e,n)=>(console.log("[Reducer] updateBet:",n),{...e,betAmount:n}),[s.toString()]:(e,n)=>(console.log("[Reducer] updateWin:",n),{...e,winAmount:n}),[i.toString()]:(e,n)=>(console.log("[Reducer] setSpinning:",n),{...e,isSpinning:n}),[u.toString()]:(e,n)=>(console.log("[Reducer] setRespin:",n),{...e,isRespin:n}),[c.toString()]:(e,n)=>{console.log("[Reducer] setSpinResults:",n);const t={...e,spinResults:n};return console.log("[Reducer] newState.spinResults:",t.spinResults),t},[r.toString()]:(e,n)=>(console.log("[Reducer] setTurboMode:",n),{...e,turboMode:n}),[l.toString()]:(e,n)=>(console.log("[Reducer] setAutoSpin:",n),{...e,autoSpin:n})},{balance:2e4,betAmount:10,winAmount:0,spinResults:[],isSpinning:!1,isRespin:!1,turboMode:0,autoSpin:!1});e("rootReducer",p);n._RF.pop()}}}));

System.register("chunks:///_virtual/index83.ts",["cc","./LoaderPanelViewModel.ts","./AudioMgr.ts","./config20.ts","./socketConnect20.ts","./index81.ts","./prefabDefine21.ts","./index80.ts","./game37.ts","./index61.ts","./baseBoard.ts","./hallType2.ts","./WebSocketStarter.ts","./GameMainViewModel2.ts","./AnimationViewModel.ts","./listenerFactoy.ts","./UseSetOption.ts"],(function(e,o){var n,i,t,l,c,s,a,d,m,r,g,p,u,M,w,y,L,C,A,f,h,G,S,_,v,V,B;return{setters:[function(e){n=e.cclegacy,i=e.assetManager,t=e.Prefab},function(e){l=e.default},function(e){c=e.AudioMgr},function(e){s=e.default},function(e){a=e.default,d=e.removeInstance},function(e){m=e.bundlePkgName,r=e.default},function(e){g=e.PrefabPathDefine},function(e){p=e.default,u=e.getStore},function(e){M=e.updateBalance,w=e.updateBet,y=e.setSpinResults,L=e.updateWin,C=e.setSpinning},function(e){A=e.lang,f=e.global},function(e){h=e.addToastAction},function(e){G=e.SubGameRunState},function(e){S=e.default},function(e){_=e.GameMainViewModel},function(e){v=e.AnimationViewModel},function(e){V=e.listenerFactoy},function(e){B=e.setActiveAudio}],execute:function(){e({animationViewModel:void 0,gameMainViewModel:void 0,moneyComing_Audio:void 0}),n._RF.push({},"9168eZ7yHlO0IqoXiXqc0yH","index",void 0);let b,R,T,I,W=[],k=e("bundleMoneyComing",null);const N=e("sourceManageSeletor",((e=m)=>W.find((o=>o.bundle.name===e))));e("NORMAL_MAG_TYPE",function(e){return e[e.CHANGE_GAME=0]="CHANGE_GAME",e}({}));e("msgListener",V());let O=0;e("startUp",(n=>{p.configureStore(),i.loadBundle(m,((i,d)=>{k=e("bundleMoneyComing",d),k.load(g.LOAING_PANEL,t,((e,o)=>{}),((i,t)=>{window.HALL_GLOBAL.isAllowOpenSubGame(s.gameId)&&(window.HALL_GLOBAL.setSubGameRunState(G.READY),I=(new l).mountView(t).appendTo(n).setProps({loadBarType:1}).setEvent({onLoadDone:i=>{W=i,T=e("moneyComing_Audio",new c(N())),B(T),O=window.setTimeout((()=>{window.HALL_GLOBAL.closeSubGame({confirmContent:window.HALL_GLOBAL.lang.write((e=>e.InitGameModule.GameBoardInit)),confirmDoneBeforeFn:()=>t(I,O)}),window.HALL_GLOBAL.addToast(window.HALL_GLOBAL.lang.write((e=>e.InitGameModule.GameBoardInit),{},{placeStr:"game init failed"}))}),1e4);const t=(e,o)=>{e.unMount(),window.clearTimeout(o)};I.comp.setTipContent(window.HALL_GLOBAL.lang.write((e=>e.WebSocketModule.GameInit),{},{placeStr:"Game init..."})),window.HALL_GLOBAL.setSubGameRunState(G.RUN),console.log("[MoneyComing] 开始初始化 API 连接..."),a().then((i=>{console.log("[MoneyComing] API 连接初始化成功"),I.comp.setTipContent(A.write((e=>e.WebSocketModule.GameInit),{},{placeStr:"Entering game..."})),i.api.enter().then((i=>{console.log("[MoneyComing] Enter 成功，数据:",i),console.log("[MoneyComing] 当前 store:",u()),console.log("[MoneyComing] dispatch 前的 state:",u().getState()),u().dispatch(M(i.balance)),u().dispatch(w(i.currentBet)),console.log("[MoneyComing] dispatch 后的 state:",u().getState()),console.log(`[MoneyComing] 初始余额: ${i.balance} 元，推荐投注: ${i.currentBet} 元`),i.initialReels&&i.initialReels.length>0&&(u().dispatch(y(i.initialReels)),console.log("[MoneyComing] 初始轮盘状态:",i.initialReels));const l=N().getFile(g.GAME_MAIN);if(console.log("[MoneyComing] 获取 prefab:",l?"成功":"失败",l),!l||!l.source)return console.error("[MoneyComing] 游戏主界面 prefab 未找到或无效！"),window.HALL_GLOBAL.addToast("游戏资源加载失败"),void window.HALL_GLOBAL.closeSubGame();console.log("[MoneyComing] 创建 GameMainViewModel..."),b=e("gameMainViewModel",(new _).mountView(l.source).appendTo(n).connect(u().getState())),console.log("[MoneyComing] GameMainViewModel 创建完成，节点:",b.viewNode),console.log("[MoneyComing] 创建 AnimationViewModel..."),R=e("animationViewModel",new v),R.viewNode=b.viewNode,R.comp=b.comp,R.connect(u().getState()),console.log("[MoneyComing] 根节点:",n,"子节点数量:",n.children.length);const c=b.viewNode.getChildByPath("lucky_wheel");c?(console.log("[MoneyComing] Found lucky_wheel node, attaching LuckyWheelViewModel"),o.import("./MoneyComing_LuckyWheel.ts").then((({MoneyComing_LuckyWheel:e})=>{let n=c.getComponent(e);n||(n=c.addComponent(e)),o.import("./LuckyWheelViewModel.ts").then((({LuckyWheelViewModel:e})=>{const o=new e;o.viewNode=c,o.comp=n,o.connect(),b.luckyWheelViewModel=o,console.log("[MoneyComing] LuckyWheelViewModel attached and connected"),i.needsRecovery&&"scatter"===i.recoveryType&&(console.log("[MoneyComing] ========== 开始崩溃恢复流程 =========="),console.log("[MoneyComing] 恢复类型: scatter (feature_scatter → simpleWheel)"),console.log("[MoneyComing] 第一次 spin 结果:",i.firstSpinResults),console.log("[MoneyComing] 第一次 spin 中奖:",i.firstSpinWin,"元"),console.log("[MoneyComing] LuckyWheelViewModel.comp 是否存在:",!!o.comp),i.firstSpinWin&&u().dispatch(L(i.firstSpinWin)),setTimeout((()=>{console.log("[MoneyComing] 触发恢复的 scatter 流程..."),console.log("[MoneyComing] 检查 LuckyWheelViewModel.comp:",o.comp),"function"==typeof b.recoverScatter?b.recoverScatter():(console.error("[MoneyComing] GameMainViewModel.recoverScatter 方法不存在"),u().dispatch(C(!1)))}),1e3))}))}))):console.error("[MoneyComing] Could not find lucky_wheel node"),o.import("./MoneyComing_Respin.ts").then((({MoneyComing_Respin:e})=>{let n=b.viewNode.getComponent(e);n||(n=b.viewNode.addComponent(e)),o.import("./RespinViewModel.ts").then((({RespinViewModel:e})=>{const o=new e;o.viewNode=b.viewNode,o.comp=n,o.connect(),o.setGameMain(b.comp),b.respinViewModel=o,console.log("[MoneyComing] RespinViewModel attached and connected"),i.needsRecovery&&"freeSpin"===i.recoveryType&&(console.log("[MoneyComing] ========== 开始崩溃恢复流程 =========="),console.log("[MoneyComing] 恢复类型: freeSpin (feature_all_respin)"),console.log("[MoneyComing] 第一次 spin 结果:",i.firstSpinResults),console.log("[MoneyComing] 第一次 spin 中奖:",i.firstSpinWin,"元"),console.log("[MoneyComing] RespinViewModel.comp 是否存在:",!!o.comp),i.firstSpinWin&&u().dispatch(L(i.firstSpinWin)),setTimeout((()=>{console.log("[MoneyComing] 触发恢复的 respin 流程..."),console.log("[MoneyComing] 检查 RespinViewModel.comp:",o.comp),"function"==typeof b.recoverAllRespin?b.recoverAllRespin():(console.error("[MoneyComing] GameMainViewModel.recoverAllRespin 方法不存在"),u().dispatch(C(!1)))}),1e3))}))})),I.viewNode.isValid&&I.viewNode.setSiblingIndex(I.viewNode.parent.children.length),setTimeout((()=>{console.log("[MoneyComing] 卸载加载面板..."),t(I,O),console.log("[MoneyComing] 游戏初始化完成！")}),100)})).catch((e=>{console.error("[MoneyComing] Enter 失败:",e),I.comp.setTipContent(e&&e.message||"Enter game failed"),f.hallDispatch(h({content:"进入游戏失败，请重试"}))}))})).catch((e=>{console.error("[MoneyComing] API 连接初始化失败:",e),I.comp.setTipContent(e||"API connection error"),f.hallDispatch(h({content:"API 连接失败"})),console.error("[MoneyComing] WebSocket 初始化失败:",e),I.comp.setTipContent(e||"WebSocket connection error"),window.HALL_GLOBAL.addToast("WebSocket 连接失败")}))}}).setProps({versionStr:`md5: ${window.HALL_GLOBAL.getGameConfig(s.gameId)?window.HALL_GLOBAL.getGameConfig(s.gameId).md5:""}`}),I.comp.startLoad([d],[...r]))}))}))})),e("stopGame",(()=>{console.log("[MoneyComing] stopGame called"),window.HALL_GLOBAL.hallDispatch({type:"SET_ACTIVE_SUBGAME",payload:{subGameInfo:null}}),window.HALL_GLOBAL.setLoading(!1,m),console.log("[MoneyComing] setLoadingAction dispatched"),O&&window.clearTimeout(O),S.Instance().eventListener.removeById(m),I&&I.unMount(),b&&b.unMount(),console.log("[MoneyComing] 游戏卸载完成！",T),T&&(T.stop(),T.longStop(),T.remove(),T=e("moneyComing_Audio",null)),d(),console.log("[MoneyComing] stopGame completed")}));n._RF.pop()}}}));

System.register("chunks:///_virtual/LuckyWheelRotator.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,o,i,r,n,a,s;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.initializerDefineProperty},function(t){i=t.cclegacy,r=t.Node,n=t._decorator,a=t.Component,s=t.tween}],execute:function(){var u,h,c,l,R,p,g,d,_;i._RF.push({},"49b6bvzj2NO17Z1y2g/1Pi6","LuckyWheelRotator",void 0);const{ccclass:b,property:y}=n;t("LuckyWheelRotator",(u=b("LuckyWheelRotator"),h=y({tooltip:"旋转速度（度/秒）"}),c=y({tooltip:"是否自动开始旋转"}),l=y({type:r,tooltip:"旋转的目标节点，默认为当前节点"}),u((g=e((p=class extends a{constructor(...t){super(...t),o(this,"rotationSpeed",g,this),o(this,"autoStart",d,this),o(this,"targetNode",_,this),this._isRotating=!1,this._currentRotation=0,this.betAmount=0}onLoad(){this.targetNode||(this.targetNode=this.node),this._currentRotation=this.targetNode.eulerAngles.z,this.autoStart&&this.startRotation()}update(t){if(!this._isRotating||!this.targetNode||this.betAmount<=1)return;const e=this.rotationSpeed*t;this._currentRotation+=e,this._currentRotation>=360?this._currentRotation-=360:this._currentRotation<0&&(this._currentRotation+=360),this.targetNode.setRotationFromEuler(0,0,this._currentRotation)}startRotation(){this._isRotating=!0}stopRotation(){this._isRotating=!1}setRotationSpeed(t){this.rotationSpeed=t}toggleRotation(){this._isRotating=!this._isRotating}resetRotation(){this._currentRotation=0,this.targetNode&&this.targetNode.setRotationFromEuler(0,0,0)}setCurrentRotation(t){this._currentRotation=t,this.targetNode&&this.targetNode.setRotationFromEuler(0,0,t)}spinTo(t,e,o){this._isRotating=!1;const i={angle:this._currentRotation};let r=0;if(this.rotationSpeed<0){let e=this._currentRotation%360;e>0&&(e-=360);let o=t;o>0&&(o-=360);let i=o-e;i>0&&(i-=360),r=this._currentRotation+i-1800}else{let e=this._currentRotation%360;e<0&&(e+=360);let o=t-e;o<0&&(o+=360),r=this._currentRotation+o+1800}s(i).to(e,{angle:r},{easing:"cubicOut",onUpdate:()=>{this.setCurrentRotation(i.angle)},onComplete:()=>{this._isRotating=!1,o&&o()}}).start()}}).prototype,"rotationSpeed",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 30}}),d=e(p.prototype,"autoStart",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_=e(p.prototype,"targetNode",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=p))||R));i._RF.pop()}}}));

System.register("chunks:///_virtual/LuckyWheelViewModel.ts",["cc","./ViewModel.ts","./index80.ts"],(function(e){var t,o,c,n,i;return{setters:[function(e){t=e.cclegacy,o=e._decorator},function(e){c=e.StoreInject,n=e.default},function(e){i=e.getStore}],execute:function(){var s;t._RF.push({},"d868bL/mA1HU6Cbby25yYM5","LuckyWheelViewModel",void 0);const{ccclass:u}=o;e("LuckyWheelViewModel",c(i())(s=u("LuckyWheelViewModel")(s=class extends n{constructor(){super("MoneyComing_LuckyWheel")}begin(){}connect(){return this.inject({},(e=>({betAmount:e.betAmount}))),this}spin(e,t){this.comp?this.comp.spin(e,t):(console.error("[LuckyWheelViewModel] Component not found"),t())}})||s)||s);t._RF.pop()}}}));

System.register("chunks:///_virtual/MoneyComing_GameMain.ts",["cc","./BaseComponent.ts","./MoneyComing_Wheel.ts","./SymbolAnimator.ts","./AnimationUtils.ts","./index83.ts","./soundDefine21.ts","./LuckyWheelRotator.ts"],(function(e){var t,o,n,s,i,r,p,l,a,h,c,d,u,_,m,g,y,b,w;return{setters:[function(e){t=e.cclegacy,o=e.Button,n=e.Label,s=e.Node,i=e.Color,r=e.UITransform,p=e.sp,l=e.assetManager,a=e.SpriteFrame,h=e.Sprite,c=e.tween,d=e._decorator},function(e){u=e.BaseComponent},function(e){_=e.MoneyComing_Wheel},function(e){m=e.SymbolAnimator},function(e){g=e.AnimationUtils},function(e){y=e.moneyComing_Audio},function(e){b=e.SoundPathDefine},function(e){w=e.LuckyWheelRotator}],execute:function(){var f;t._RF.push({},"93351gVVfJBKKOjeFsktmEg","MoneyComing_GameMain",void 0);const{ccclass:S,property:N}=d;e("MoneyComing_GameMain",S("MoneyComing_GameMain")(f=class extends u{constructor(...e){super(...e),this.wheels=[],this.betSelectionNode=null,this.propertyNode={props_spin_btn:new o,props_bet_btn:new o,props_auto_btn:new o,props_turbo:new o,props_balance_label:new n,props_win_label:new n,props_bet_label:new n,props_unlock_1:new s,props_unlock_5:new s,props_unlock_10:new s,props_unlock_50:new s,props_brand_board:new s,props_feature_board:new s,props_lucky_wheel_1_5_10:new s,props_lucky_wheel_50_100:new s,props_lucky_wheels:new s,props_win_effect:new s,props_setting:new s,props_setting_selection:new s,props_setting_back:new s},this.wheel3LockNode=null,this.luckyWheelLockNode=null,this.props={balance:2e4,betAmount:10,winAmount:0,spinResults:[],isSpinning:!1,turboMode:0,autoSpin:!1},this.events={onSpin:()=>{},onAutoSpin:()=>{},onTurbo:()=>{},onBetChange:e=>{},onSpinComplete:()=>{}}}initState(){return{}}start(){console.log("[GameMain] start: initial spinResults:",this.props.spinResults),this.props.spinResults&&this.props.spinResults.length>0&&(console.log("[GameMain] start: setting initial wheel results:",this.props.spinResults),this.wheels.forEach(((e,t)=>{const o=t<this.props.spinResults.length?this.props.spinResults[t]:"";o&&e.showResult(o,!1)}))),this.props.betAmount>0?(this.updateUnlockLevels(this.props.betAmount),this.highlightCurrentBet(this.props.betAmount),this.updateUnlockLevels(this.props.betAmount),this.highlightCurrentBet(this.props.betAmount),this.propertyNode.props_bet_label&&(this.propertyNode.props_bet_label.string=this.props.betAmount.toFixed(2))):console.warn("[GameMain] start: betAmount is 0, waiting for props update...")}bindEvent(){this.propertyNode.props_spin_btn&&this.propertyNode.props_spin_btn.node.on(s.EventType.TOUCH_END,(()=>{this.hideBetSelection(),this.hideSettingSelection(),y.playOneShot(b.spin),this.events.onSpin()})),this.propertyNode.props_auto_btn&&this.propertyNode.props_auto_btn.node.on(s.EventType.TOUCH_END,(()=>{this.hideBetSelection(),this.events.onAutoSpin()})),this.propertyNode.props_turbo&&this.propertyNode.props_turbo.node.on(s.EventType.TOUCH_END,(()=>{this.hideBetSelection(),this.events.onTurbo()})),this.propertyNode.props_bet_btn&&this.propertyNode.props_bet_btn.node.on(s.EventType.TOUCH_END,(()=>this.toggleBetSelection())),this.propertyNode.props_setting&&this.propertyNode.props_setting.on(s.EventType.TOUCH_END,(()=>{this.onSettingClick()})),this.propertyNode.props_setting_back&&this.propertyNode.props_setting_back.on(s.EventType.TOUCH_END,(()=>{this.onBackToHallClick()}))}onSettingClick(){this.props.isSpinning||this.props.autoSpin||this.propertyNode.props_setting_selection&&(this.propertyNode.props_setting_selection.active=!0)}hideSettingSelection(){this.propertyNode.props_setting_selection&&(this.propertyNode.props_setting_selection.active=!1)}onBackToHallClick(){window.HALL_GLOBAL&&window.HALL_GLOBAL.closeSubGame?window.HALL_GLOBAL.closeSubGame():console.error("[GameMain] window.HALL_GLOBAL.closeSubGame is not available")}hideBetSelection(){this.betSelectionNode&&this.betSelectionNode.active&&(this.betSelectionNode.active=!1)}toggleBetSelection(){this.betSelectionNode&&(this.betSelectionNode.active=!this.betSelectionNode.active,this.betSelectionNode.active&&this.highlightCurrentBet())}highlightCurrentBet(e=this.props.betAmount){if(!this.betSelectionNode)return;const t=[1,5,10,50,100];for(const n of t){const t=this.betSelectionNode.getChildByPath(`hLayout / betOptionLayout / betOption${n} `);if(t){const s=t.getComponentInChildren(o);s&&(s.normalColor=n===e?new i(150,150,150,255):new i(50,50,50,255))}}}updateUnlockLevels(e){const t={1:this.propertyNode.props_unlock_1,5:this.propertyNode.props_unlock_5,10:this.propertyNode.props_unlock_10,50:this.propertyNode.props_unlock_50};Object.keys(t).forEach((e=>{const o=t[e];o&&o.isValid&&(o.active=!1)}));const o=(e,t,o)=>{e&&e.isValid&&(e.active=t,e.setPosition(e.position.x,o,e.position.z))};switch(e){case 1:o(t[1],!0,-30),o(t[5],!0,30);break;case 5:o(t[5],!0,-30),o(t[10],!0,30);break;case 10:o(t[10],!0,-30),o(t[50],!0,30);break;case 50:case 100:o(t[10],!0,-30),o(t[50],!0,30)}-1!==[1,5,10].indexOf(e)?this.playBrandTextAnimation("down_start","down_cycle"):this.playBrandTextAnimation("up_start","up_cycle"),this.updateFeatureWheel(e)}updateFeatureWheel(e){if(this.wheels.length<4)return;const t=this.wheels[3];if(!t)return;const o=this.getAvailableFeatureElements(e);t.setVisibleElements(o)}getAvailableFeatureElements(e){const t=["feature_x2","feature_x5","feature_all_respin"];return 1===e?t:5===e?[...t,"feature_scatter"]:10===e?[...t,"feature_x10","feature_scatter"]:50===e||100===e?[...t,"feature_x10","feature_scatter_50_100"]:t}playBrandTextAnimation(e,t){const o=this.propertyNode.props_brand_board;if(!o||!o.isValid)return;let n=o.getChildByName("payboard_light_anim");n||(n=new s("payboard_light_anim"),o.addChild(n));n.setSiblingIndex(2),n.layer=o.layer;let i=n.getComponent(r);i||(i=n.addComponent(r));const a=o.getComponent(r);a&&(i.contentSize=a.contentSize);let h=n.getComponent(p.Skeleton);h||(h=n.addComponent(p.Skeleton)),h.premultipliedAlpha=!0;const c="spine/payboard_Light/payboard_Light",d=l.getBundle("moneyComing");d?h.skeletonData&&"payboard_Light"===h.skeletonData.name?this.playSkeletonAnimation(h,e,t):d.load(c,p.SkeletonData,((o,n)=>{!o&&h&&h.isValid?(h.skeletonData=n,this.playSkeletonAnimation(h,e,t)):console.error(`[GameMain] Failed to load skeleton data for ${c}`,o)})):console.error("[GameMain] Cannot find bundle: moneyComing")}playSkeletonAnimation(e,t,o){if(e.animation===o)return;e.setAnimation(0,t,!1)?e.setCompleteListener((()=>{e.setAnimation(0,o,!0),e.setCompleteListener(null)})):e.setAnimation(0,o,!0)}onBetAmountSelected(e){this.events.onBetChange(e),this.betSelectionNode&&(this.betSelectionNode.active=!1)}initBetSelection(){if(!this.betSelectionNode)return;const e=[1,5,10,50,100];for(const t of e){const e=`hLayout/betOptionLayout/betOption${t}`;let n=null;if(n=this.betSelectionNode.getChildByPath(e),n){const i=n.getComponentInChildren(o);i?i.node.on(s.EventType.TOUCH_END,(()=>{this.onBetAmountSelected(t)})):console.warn(`[GameMain] ⚠️ 节点 ${e} 的子节点中没有 Button 组件`)}else console.warn(`[GameMain] ❌ 未找到投注按钮节点: ${t}，尝试的路径: `,e)}}useProps(e,t){if("balance"===e&&this.propertyNode.props_balance_label&&void 0!==t.cur&&null!==t.cur&&(this.propertyNode.props_balance_label.string=t.cur.toFixed(2)),"winAmount"===e&&this.propertyNode.props_win_label&&void 0!==t.cur&&null!==t.cur&&(this.propertyNode.props_win_label.string=t.cur.toFixed(2)),"betAmount"===e&&(this.propertyNode.props_bet_label&&void 0!==t.cur&&null!==t.cur?(this.propertyNode.props_bet_label.string=t.cur.toFixed(2),this.updateUnlockLevels(t.cur),this.highlightCurrentBet(t.cur),this.wheels.forEach(((e,t)=>{m.stopAllAnimations(e.node),this.stopExpectAnimation(t)}))):console.warn("[GameMain] useProps: props_bet_label is missing or value is invalid")),"isSpinning"===e){const e=t.cur,n=this.props.autoSpin;if(console.log(`[GameMain] useProps: isSpinning changed to ${e}, isAutoSpin = ${n} `),this.propertyNode.props_spin_btn&&(this.propertyNode.props_spin_btn.interactable=!e&&!n,console.log(`[GameMain] Updated spin_btn interactable: ${this.propertyNode.props_spin_btn.interactable} `)),this.propertyNode.props_bet_btn&&(this.propertyNode.props_bet_btn.interactable=!e&&!n),this.propertyNode.props_setting){const t=this.propertyNode.props_setting.getComponent(o);t&&(t.interactable=!e&&!n)}this.propertyNode.props_turbo&&(this.propertyNode.props_turbo.interactable=!e&&!n),this.propertyNode.props_auto_btn&&(this.propertyNode.props_auto_btn.interactable=n||!e),e&&!t.pre&&(this.props.isRespin?console.log("[GameMain] useProps: isSpinning 触发，但处于 Respin 模式，跳过自动启动"):(console.log("[GameMain] useProps: isSpinning 触发，启动普通转动"),this.startSpin()))}if("spinResults"===e&&(console.log("[GameMain] spinResults 变化:",{cur:t.cur,length:t.cur?t.cur.length:0,isSpinning:this.props.isSpinning,isRespin:this.props.isRespin}),t.cur&&t.cur.length>0?this.props.isSpinning?this.props.isRespin?console.log("[GameMain] Respin 模式，不自动调用 stop（由 RespinViewModel 控制）"):(console.log("[GameMain] 普通 Spin，调用 stopSpin"),this.stopSpin(t.cur)):(console.log("[GameMain] 初始状态或非旋转状态，直接设置结果:",t.cur),this.wheels.forEach(((e,o)=>{const n=o<t.cur.length?t.cur[o]:"";n&&e.showResult(n,!1)}))):console.warn("[GameMain] 不满足 stopSpin 条件:",{hasCur:!!t.cur,lengthOk:t.cur&&t.cur.length>0,isSpinning:this.props.isSpinning})),"turboMode"===e&&this.updateTurboButtonSprite(t.cur),"autoSpin"===e){const e=t.cur,n=this.props.isSpinning;if(this.propertyNode.props_spin_btn&&(this.propertyNode.props_spin_btn.interactable=!n&&!e),this.propertyNode.props_bet_btn&&(this.propertyNode.props_bet_btn.interactable=!n&&!e),this.propertyNode.props_setting){const t=this.propertyNode.props_setting.getComponent(o);t&&(t.interactable=!n&&!e)}this.propertyNode.props_turbo&&(this.propertyNode.props_turbo.interactable=!n&&!e),this.propertyNode.props_auto_btn&&(this.propertyNode.props_auto_btn.interactable=e||!n)}}updateTurboButtonSprite(e){if(!this.propertyNode.props_turbo)return;let t="";if(0===e?t="texture/ui/controls/normal":1===e?t="texture/ui/controls/turbo":2===e&&(t="texture/ui/controls/super_turbo"),!t)return;const o=l.getBundle("moneyComing");o?o.load(`${t}/spriteFrame`,a,((e,o)=>{if(e||!o)return void console.error(`[GameMain] Failed to load turbo button image: ${t}`,e);const n=this.propertyNode.props_turbo.node.getComponent(h);n?n.spriteFrame=o:console.warn("[GameMain] Sprite component not found on turbo button")})):console.error("[GameMain] Cannot find moneyComing bundle")}bindUI(){this.propertyNode.props_bet_label,this.betSelectionNode=this.node.getChildByPath("control_panel/controls/betSelection"),this.betSelectionNode?(this.betSelectionNode.active=!1,this.initBetSelection()):console.warn("[GameMain] betSelection 节点未找到，请在 Cocos Creator prefab 中创建该节点，路径：control_panel/controls/betSelection"),this.wheels=[];["wheels_container/wheels_layout/wheel_frame/wheels/wheel1","wheels_container/wheels_layout/wheel_frame/wheels/wheel2","wheels_container/wheels_layout/wheel_frame/wheels/wheel3","wheels_container/wheels_layout/wheel_frame/wheels/wheel_feature"].forEach(((e,t)=>{const o=this.node.getChildByPath(e);if(o){let n=o.getComponent(_);n?console.log(`[GameMain] 使用已有的 MoneyComing_Wheel 组件: ${e}`):(console.log(`[GameMain] 动态添加 MoneyComing_Wheel 组件到 ${e}`),n=o.addComponent(_)),n.symbolContainer||(n.symbolContainer=o.getChildByName("symbol_container")),n.wheelType=t<3?"coin":"feature",n.bundle="moneyComing",this.wheels.push(n)}else console.warn(`Wheel node not found: ${e}`)})),this.initLockNodes();const e=this.node.getChildByPath("control_panel/controls/props_setting_selection");if(e){this.propertyNode.props_setting_selection=e,e.active=!1;const t=e.getChildByPath("OptionLayout/props_setting_back");t&&(this.propertyNode.props_setting_back=t,t.on(s.EventType.TOUCH_END,(()=>{this.onBackToHallClick()})))}else console.warn("[GameMain] props_setting_selection node not found at control_panel/controls/props_setting_selection");const t=this.node.getChildByPath("lucky_wheel/brand/board/props_brand_board");t&&(this.propertyNode.props_brand_board=t);const o=this.node.getChildByPath("lucky_wheel/brand/board/props_feature_board");o&&(this.propertyNode.props_feature_board=o,o.active=!1)}initLockNodes(){const e=this.wheels[2];if(e&&e.node){let t=e.node.getChildByName("wheel_lock_node");t||(t=new s("wheel_lock_node"),e.node.addChild(t),t.setPosition(0,0,0)),t.layer=e.node.layer,t.setSiblingIndex(e.node.children.length-1),t.active=!1,this.wheel3LockNode=t}else console.error("[GameMain] initLockNodes: Wheel 3 not found");const t=this.propertyNode.props_lucky_wheel_1_5_10;if(t){let e=t.getChildByName("wheel_lock_node");e||(e=new s("wheel_lock_node"),t.addChild(e),e.setPosition(0,0,0)),e.layer=t.layer,e.setSiblingIndex(t.children.length-1),e.active=!1,this.luckyWheelLockNode=e}else console.error("[GameMain] initLockNodes: props_lucky_wheel_1_5_10 not bound")}startSpin(){this.wheels.forEach((e=>{m.stopAllAnimations(e.node)})),this.hideFeaturePanel(),this.stopLuckyWheelVFX();const e=this.props.turboMode;console.log(`[GameMain] startSpin: 设置 turboMode=${e}`),this.wheels.forEach(((t,o)=>{1===this.props.betAmount&&2===o||(t.setTurboMode(e),t.startSpin())}))}stopLuckyWheelVFX(){[this.propertyNode.props_lucky_wheel_1_5_10,this.propertyNode.props_lucky_wheel_50_100].forEach((e=>{if(!e||!e.isValid)return;const t=e.getChildByName("target_coin");t&&t.active&&(t.active=!1,console.log("[GameMain] Stopped target_coin VFX"));const o=e.getChildByName("scatter_end_anim");o&&o.active&&(o.active=!1,console.log("[GameMain] Stopped scatter_end_anim VFX")),this.resumeLuckyWheelRotation(e)}))}resumeLuckyWheelRotation(e){if(!e||!e.isValid)return;["money","money_upgrade","money_bg"].forEach((t=>{const o=e.getChildByName(t);if(o&&o.active){const e=o.getComponent(w);e&&(e.startRotation(),console.log(`[GameMain] Resumed rotation for ${t}`))}}))}stopSpin(e){console.log("[GameMain] stopSpin 开始, results:",e,"wheels数量:",this.wheels.length,"turboMode:",this.props.turboMode);let t=0;const o=this.props.turboMode>0?0:.2;this.wheels.forEach(((n,s)=>{const i=s<e.length?e[s]:"";console.log(`[GameMain] 准备停止 wheel ${s}, result: "${i}", delay: ${s*o}秒`),this.scheduleOnce((()=>{y.playOneShot(b.spinOver),console.log(`[GameMain] 调用 wheel.stop() for index ${s}`),n.stop(i,(()=>{t++,console.log(`[GameMain] wheel ${s} 停止完成, stoppedCount: ${t}/${this.wheels.length}`),t===this.wheels.length&&(console.log("[GameMain] 所有 wheel 停止完成，触发 onSpinComplete"),this.events.onSpinComplete())}))}),s*o)}))}startRespin(){console.log("[GameMain] startRespin 开始");for(let e=0;e<3;e++)this.wheels[e]&&m.stopAllAnimations(this.wheels[e].node);if(this.stopLuckyWheelVFX(),this.wheels[3]){console.log("[GameMain] 确保 feature 轮子停止，当前结果:",this.props.spinResults?.[3]);const e=this.wheels[3];e.isSpinning&&(console.warn("[GameMain] ⚠️ Feature 轮子正在转动，强制停止"),e._isSpinning=!1,e._spinState=0),this.props.spinResults&&this.props.spinResults[3]&&e.showResult(this.props.spinResults[3],!1)}const e=this.props.turboMode;console.log(`[GameMain] startRespin: 设置 turboMode=${e}`),this.wheels.forEach(((t,o)=>{3!==o?1!==this.props.betAmount||2!==o?(console.log(`[GameMain] 启动轮子 ${o} 的 respin`),t.setTurboMode(e),t.startSpin(),this.playExpectAnimation(o)):console.log("[GameMain] ✅ 跳过锁定的轮子 (index 2)"):console.log("[GameMain] ✅ 跳过 feature 轮子 (index 3)")}))}stopRespin(e,t){console.log("[GameMain] stopRespin 开始, results:",e,"turboMode:",this.props.turboMode);let o=0;const n=[],s=this.props.turboMode>0?0:.2;this.wheels[3]&&this.props.spinResults&&this.props.spinResults[3]&&(console.log("[GameMain] stopRespin: 确保 feature 轮子保持固定:",this.props.spinResults[3]),this.wheels[3].showResult(this.props.spinResults[3],!1)),this.wheels.forEach(((e,t)=>{3!==t?1!==this.props.betAmount||2!==t?n.push(e):console.log("[GameMain] stopRespin: ✅ 跳过锁定的轮子 (index 2)"):console.log("[GameMain] stopRespin: ✅ 跳过 feature 轮子 (index 3)")})),console.log("[GameMain] stopRespin: 需要停止的轮子数量:",n.length,"stopInterval:",s),n.forEach(((i,r)=>{const p=this.wheels.indexOf(i),l=e[p]||"";console.log(`[GameMain] stopRespin: 停止轮子 ${p}, result: "${l}", delay: ${r*s}秒`),this.scheduleOnce((()=>{i.stop(l,(()=>{this.stopExpectAnimation(p),o++,o===n.length&&t()}))}),r*s)}))}showFeaturePanel(e,t="all_respin",o=1){const s=this.propertyNode.props_brand_board,i=this.propertyNode.props_feature_board;if(!s||!i)return void console.warn("[GameMain] Brand or Feature board nodes missing");const r=i.parent===s;s.active=!!r,i.active=!0;const p=i.getChildByPath("right");if(p){const e=p.getChildByName("all_respin"),n=p.getChildByName("scatter"),s=p.getChildByName("scatter_50_100");e&&(e.active=!1),n&&(n.active=!1),s&&(s.active=!1),"all_respin"===t&&e?e.active=!0:"scatter"===t&&(-1!==[50,100].indexOf(o)&&s?s.active=!0:n&&(n.active=!0))}const l=i.getChildByPath("base_value")?.getComponent(n);l&&(l.string=e.toString());const a=i.getChildByPath("bonus_value")?.getComponent(n);a&&(a.string="0")}updateFeatureBonus(e){const t=this.propertyNode.props_feature_board;if(!t||!t.active)return;const o=t.getChildByPath("bonus_value")?.getComponent(n);o&&(o.string=e.toString())}playFeatureSymbolAnimation(e){if(this.wheels.length<4)return;const t=this.wheels[3];if(!t)return;const o=t.getDisplayedElement();if(o){const n=o.getWorldPosition();m.playAnimationAt(t.node,n,e,"moneyComing",!0)}}playWinAnimations(e){this.wheels.forEach((e=>{m.stopAllAnimations(e.node)}));const t=1===this.props.betAmount?2:3,o=e[3];let n="";for(let o=0;o<t;o++){const t=e[o];t&&t.startsWith("element_")&&(n+=t.replace("element_",""))}const s=n?parseInt(n,10):0;if(s>0){let o=-1;for(let n=0;n<t;n++){const t=e[n];if(t&&t.startsWith("element_")){const e=t.replace("element_","");if("0"!==e&&"00"!==e){o=n;break}}}if(-1!==o)for(let n=o;n<t;n++){const t=e[n];if(t&&t.startsWith("element_")){const e=this.wheels[n],o=e.getDisplayedElement();if(o){const n=o.getWorldPosition();m.playAnimationAt(e.node,n,t,"moneyComing",!0)}}}}if(o){const e=o.includes("x"),t=o.includes("scatter"),n="feature_all_respin"===o;if(s>0&&e||t||n){const e=this.wheels[3],t=e.getDisplayedElement();if(t){const n=t.getWorldPosition();m.playAnimationAt(e.node,n,o,"moneyComing",!0)}}}}playExpectAnimation(e){if(e<0||e>=this.wheels.length)return;const t=this.wheels[e];if(!t||!t.node)return;const o=this.node,n=`expect_anim_${e}`;let i=o.getChildByName(n);i||(i=new s(n),o.addChild(i));const a=t.node.getWorldPosition(),h=o.getComponent(r)?.convertToNodeSpaceAR(a)||a;i.setPosition(h),i.setScale(1,.95,1),i.setSiblingIndex(o.children.length-1),i.active=!0;let c=i.getComponent(p.Skeleton);c||(c=i.addComponent(p.Skeleton)),c.premultipliedAlpha=!0;const d="spine/expect/expect",u=l.getBundle("moneyComing");u&&u.load(d,p.SkeletonData,((e,t)=>{!e&&c&&c.isValid?(c.skeletonData=t,c.setAnimation(0,"light01",!0)):console.error(`[GameMain] Failed to load expect spine: ${d}`,e)}))}stopExpectAnimation(e){if(e<0||e>=this.wheels.length)return;const t=this.wheels[e];if(!t||!t.node)return;const o=t.node.parent;if(!o)return;if(!o.parent)return;const n=`expect_anim_${e}`,s=this.node.getChildByName(n);s&&s.destroy()}playBigWinEffect(e,t,o){y.playOneShot(b.bigWin);const s=this.propertyNode.props_win_effect;if(!s)return console.error("[GameMain] props_win_effect node not found!"),void o();s.active=!0;const i=`${e}win_start`,r=`${e}win_cycle`,l=s.getChildByName("point");if(l){const e=l.getComponent(p.Skeleton);e&&(e.setAnimation(0,"win_start",!1),e.addAnimation(0,"win_cycle",!0));const o=l.getComponentInChildren(n);if(o){c({value:0}).to(2,{value:t},{onUpdate:e=>{o.string=e.value.toFixed(2)}}).start()}}const a=s.getChildByName("win_back");if(a){const e=a.getComponent(p.Skeleton);e&&(e.setAnimation(0,i,!1),e.addAnimation(0,r,!0))}const h=s.getChildByName("win_front");if(h){const e=h.getComponent(p.Skeleton);e&&(e.setAnimation(0,i,!1),e.addAnimation(0,r,!0))}this.scheduleOnce((()=>{s.active=!1,o()}),5)}playScatterFlyAnimation(e,t){if(this.wheels.length<4)return void t();const o=this.wheels[3].node;let n="";1===e||5===e||10===e?n="props_lucky_wheel_1_5_10/money_bg":50!==e&&100!==e||(n="props_lucky_wheel_50_100/money_bg");const s=this.propertyNode.props_lucky_wheels;if(!s)return console.error("[GameMain] Lucky wheels node not found"),void t();const i=s.getChildByPath(n);if(!o||!i)return console.error(`[GameMain] Start or End node not found. Start: ${o?.name}, End: ${i?.name}`),void t();const r=this.node;y.playOneShot(b.allRespinScatter),g.playImage("moneyComing",o,i,r,(()=>{t()}),"up")}hideFeaturePanel(){const e=this.propertyNode.props_brand_board,t=this.propertyNode.props_feature_board;if(e&&t&&t.active){t.parent===e?(t.active=!1,e.active=!0):(e.active=!0,t.active=!1)}}})||f);t._RF.pop()}}}));

System.register("chunks:///_virtual/MoneyComing_LuckyWheel.ts",["cc","./BaseComponent.ts","./LuckyWheelRotator.ts","./index83.ts","./soundDefine21.ts"],(function(e){var t,o,n,i,c,s,a,l;return{setters:[function(e){t=e.cclegacy,o=e.Node,n=e.sp,i=e._decorator},function(e){c=e.BaseComponent},function(e){s=e.LuckyWheelRotator},function(e){a=e.moneyComing_Audio},function(e){l=e.SoundPathDefine}],execute:function(){var r;t._RF.push({},"14404rPkqdIX447vdvVabHH","MoneyComing_LuckyWheel",void 0);const{ccclass:h,property:_}=i;e("MoneyComing_LuckyWheel",h("MoneyComing_LuckyWheel")(r=class extends c{constructor(...e){super(...e),this.rotators=[],this.propertyNode={props_lucky_wheel_1_5_10:new o,props_lucky_wheel_50_100:new o},this.props={betAmount:1},this.events={}}bindEvent(){}initState(){return{}}bindUI(){this.initRotators(),this.initVFXNodes(),console.log("[LuckyWheel] bindUI: forcing initial update with betAmount=",this.props.betAmount),this.updateWheelState(this.props.betAmount)}initVFXNodes(){[this.propertyNode.props_lucky_wheel_1_5_10,this.propertyNode.props_lucky_wheel_50_100].forEach((e=>{if(e&&e.isValid){const t=e.getChildByName("target_coin");t&&(t.active=!1,console.log("[LuckyWheel] Initialized target_coin as inactive"));const o=e.getChildByName("scatter_end_anim");o&&(o.active=!1,console.log("[LuckyWheel] Initialized scatter_end_anim as inactive"))}}))}initRotators(){[this.propertyNode.props_lucky_wheel_1_5_10,this.propertyNode.props_lucky_wheel_50_100].forEach((e=>{if(e&&e.isValid){["money","money_upgrade","money_bg"].forEach((t=>{const o=e.getChildByName(t);if(o){let e=o.getComponent(s);e||(e=o.addComponent(s)),e.autoStart=!0,e.rotationSpeed=-10,e.startRotation(),this.rotators.push(e)}}))}}))}useProps(e,t){console.log(`[LuckyWheel] useProps: key=${e}, pre=${t.pre}, cur=${t.cur}`),"betAmount"===e&&this.updateWheelState(t.cur)}updateWheelState(e){console.log(`[LuckyWheel] updateWheelState: betAmount=${e}`),this.rotators.forEach((t=>t.betAmount=e));const t=this.propertyNode.props_lucky_wheel_1_5_10,o=this.propertyNode.props_lucky_wheel_50_100;console.log(`[LuckyWheel] Nodes: 1_5_10=${t?.name}, 50_100=${o?.name}`),t&&o&&(-1!==[1,5,10].indexOf(e)?(console.log("[LuckyWheel] Showing 1_5_10"),t.active=!0,o.active=!1,this.updateWheelContent(t,e)):(console.log("[LuckyWheel] Showing 50_100"),t.active=!1,o.active=!0,this.updateWheelContent(o,e)))}updateWheelContent(e,t){const o=e.getChildByName("money"),n=e.getChildByName("money_upgrade"),i=e.getChildByName("money_bg");let c=!1;c=1===t||5===t||50===t;let a=0;if(i&&(a=i.eulerAngles.z),o&&(o.active=c,c&&i)){o.setRotationFromEuler(0,0,a);const e=o.getComponent(s);e&&e.setCurrentRotation(a)}if(n&&(n.active=!c,!c&&i)){n.setRotationFromEuler(0,0,a);const e=n.getComponent(s);e&&e.setCurrentRotation(a)}}spin(e,t){console.log(`[LuckyWheel] spin: prizeIndex=${e}`),a.playOneShot(l.luckyWheel);const o=this.propertyNode.props_lucky_wheel_1_5_10.active?this.propertyNode.props_lucky_wheel_1_5_10:this.propertyNode.props_lucky_wheel_50_100;if(this.stopWinVFX(this.propertyNode.props_lucky_wheel_1_5_10),this.stopWinVFX(this.propertyNode.props_lucky_wheel_50_100),o){const e=o.getChildByName("wheel");if(e){const t=e.getComponent(n.Skeleton);t&&(t.timeScale=2,t.setAnimation(0,"common_run_start",!1))}}let i=90-45*e;if(i<0&&(i+=360),!o)return console.error("[LuckyWheel] No active wheel found"),void t();const c=[];if(["money","money_upgrade","money_bg"].forEach((e=>{const t=o.getChildByName(e);if(t&&t.active){const e=t.getComponent(s);e&&c.push(e)}})),0===c.length)return console.warn("[LuckyWheel] No active rotators found"),void t();let r=0;c.forEach((e=>{e.spinTo(i,6,(()=>{r++,r===c.length&&(this.playWinVFX(o),t())}))}))}playWinVFX(e){if(!e)return;const t=e.getChildByName("target_coin");t?(t.active=!0,console.log("[LuckyWheel] Activated target_coin VFX")):console.warn("[LuckyWheel] target_coin node not found");const o=e.getChildByName("scatter_end_anim");o?(o.active=!0,console.log("[LuckyWheel] Activated scatter_end_anim")):console.warn("[LuckyWheel] scatter_end_anim node not found")}stopWinVFX(e){if(!e||!e.isValid)return void console.warn("[LuckyWheel] stopWinVFX: wheelNode is null or invalid");console.log(`[LuckyWheel] stopWinVFX called for: ${e.name}, active: ${e.active}`);const t=e.getChildByName("target_coin");if(t){const e=t.active;t.active=!1,console.log(`[LuckyWheel] Deactivated target_coin VFX (was ${e?"active":"inactive"})`)}else console.warn(`[LuckyWheel] target_coin not found in ${e.name}`);const o=e.getChildByName("scatter_end_anim");if(o){const e=o.active;o.active=!1,console.log(`[LuckyWheel] Deactivated scatter_end_anim (was ${e?"active":"inactive"})`)}else console.warn(`[LuckyWheel] scatter_end_anim not found in ${e.name}`)}})||r);t._RF.pop()}}}));

System.register("chunks:///_virtual/MoneyComing_Respin.ts",["cc","./BaseComponent.ts"],(function(e){var o,n,t,s,l,i,r,a,p,y,c,m,h;return{setters:[function(e){o=e.cclegacy,n=e.assetManager,t=e.SpriteFrame,s=e.Node,l=e.Layers,i=e.UIOpacity,r=e.Sprite,a=e.UITransform,p=e.Vec3,y=e.v3,c=e.tween,m=e._decorator},function(e){h=e.BaseComponent}],execute:function(){var g;o._RF.push({},"a3599MIjJJN/bQKZ+9K2205","MoneyComing_Respin",void 0);const{ccclass:_,property:d}=m;e("MoneyComing_Respin",_("MoneyComing_Respin")(g=class extends h{constructor(...e){super(...e),this.propertyNode={},this.props={betAmount:1},this.events={onFlyComplete:()=>{}}}initState(){return{}}bindEvent(){}useProps(e,o){}bindUI(){}playFlyAnimation(e){console.log("[MoneyComing_Respin] playFlyAnimation 开始, betAmount:",e);const o=this.node.getChildByPath("wheels_container/wheels_layout/wheel_frame/wheels/wheel_feature");if(!o)return console.error("[MoneyComing_Respin] Feature wheel node not found"),console.log("[MoneyComing_Respin] 调用 onFlyComplete (节点未找到)"),void this.events.onFlyComplete();console.log("[MoneyComing_Respin] Feature wheel node 找到");const s=o,l=[],i=["wheels_container/wheels_layout/wheel_frame/wheels/wheel1","wheels_container/wheels_layout/wheel_frame/wheels/wheel2","wheels_container/wheels_layout/wheel_frame/wheels/wheel3"],r=1===e?2:3;for(let e=0;e<r;e++){const o=this.node.getChildByPath(i[e]);o&&l.push(o)}if(0===l.length)return console.warn("[MoneyComing_Respin] No target wheels found"),console.log("[MoneyComing_Respin] 调用 onFlyComplete (无目标轮子)"),void this.events.onFlyComplete();console.log("[MoneyComing_Respin] 找到",l.length,"个目标轮子");let a=0;const p=l.length,y="moneyComing",c=n.getBundle(y);if(!c)return console.error("[MoneyComing_Respin] Bundle moneyComing not found"),console.log("[MoneyComing_Respin] 调用 onFlyComplete (Bundle 未找到)"),void this.events.onFlyComplete();console.log("[MoneyComing_Respin] 开始加载飞行资源..."),c.load(["cocos_lizi/fly/sybres_eft_str_02/spriteFrame","cocos_lizi/fly/sybres_eft_exp_04/spriteFrame"],t,((e,o)=>{if(e)return console.error("[MoneyComing_Respin] Failed to load fly assets",e),console.log("[MoneyComing_Respin] 调用 onFlyComplete (资源加载失败)"),void this.events.onFlyComplete();console.log("[MoneyComing_Respin] 飞行资源加载成功，开始播放",p,"个飞行动画");const n=o[0],t=o[1];l.forEach(((e,o)=>{this.playSingleFly(s,e,n,t,(()=>{a++,console.log(`[MoneyComing_Respin] 飞行动画 ${a}/${p} 完成`),a===p&&(console.log("[MoneyComing_Respin] 🎉 所有飞行动画完成，调用 onFlyComplete"),this.events.onFlyComplete())}))}))}))}playSingleFly(e,o,n,t,m){let h=new s("FlyEffectNode");h.layer=l.Enum.UI_2D;let g=h.addComponent(i),_=h.addComponent(r);_.spriteFrame=n,this.node.addChild(h);let d=e.getWorldPosition(),C=o.getWorldPosition(),u=this.node.getComponent(a)?.convertToNodeSpaceAR(d)||new p,w=this.node.getComponent(a)?.convertToNodeSpaceAR(C)||new p,f=y(u.x,u.y+500,0);h.setPosition(u),h.setScale(2,2,1),c(h).to(1,{position:w},{onUpdate:(e,o)=>{let n=o,t=u,s=f,l=w,i=(1-n)*(1-n)*t.x+2*n*(1-n)*s.x+n*n*l.x,r=(1-n)*(1-n)*t.y+2*n*(1-n)*s.y+n*n*l.y;h.setPosition(i,r,0)}}).call((()=>{_.spriteFrame=t,c(h).to(.3,{scale:new p(8,8,1)}).start(),c(g).to(.3,{opacity:0}).call((()=>{h.destroy(),m()})).start()})).start()}})||g);o._RF.pop()}}}));

System.register("chunks:///_virtual/MoneyComing_StartUp.ts",["cc","./index83.ts"],(function(t){var e,n,c;return{setters:[function(t){e=t.cclegacy},function(t){n=t.startUp,c=t.stopGame}],execute:function(){e._RF.push({},"684abfx4RNH163jlrqRZBFm","MoneyComing_StartUp",void 0);t("default",(t=>(n(t),()=>{c()})));e._RF.pop()}}}));

System.register("chunks:///_virtual/MoneyComing_Wheel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./SymbolAnimator.ts"],(function(t){var i,e,n,o,s,l,h,r,a,m,p,c;return{setters:[function(t){i=t.applyDecoratedDescriptor,e=t.initializerDefineProperty},function(t){n=t.cclegacy,o=t.Node,s=t._decorator,l=t.Component,h=t.instantiate,r=t.Layout,a=t.UITransform,m=t.Vec3,p=t.tween},function(t){c=t.SymbolAnimator}],execute:function(){var y,b,u,g,_,C,d,S,f,E,w,N,I,T,D,M,P,x,H,Y,$;n._RF.push({},"f96714hkFBGA73VXVIiag4T","MoneyComing_Wheel",void 0);const{ccclass:k,property:L}=s;var z=function(t){return t[t.IDLE=0]="IDLE",t[t.SPINNING=1]="SPINNING",t[t.DECELERATING=2]="DECELERATING",t[t.BOUNCING=3]="BOUNCING",t}(z||{});t("MoneyComing_Wheel",(y=k("MoneyComing_Wheel"),b=L(o),u=L({group:"Physics",tooltip:"最大速度（像素/秒）"}),g=L({group:"Physics",tooltip:"加速度（像素/秒²）"}),_=L({group:"Physics",tooltip:"减速时使用的缓动函数"}),C=L({group:"Physics",tooltip:"减速到停止的总时长"}),d=L({group:"Physics",tooltip:"回弹效果的缓动函数"}),S=L({group:"Physics",tooltip:"回弹效果的时长"}),y((w=i((E=class extends l{constructor(...t){super(...t),e(this,"symbolContainer",w,this),e(this,"symbolHeight",N,this),e(this,"wheelType",I,this),e(this,"containerHeight",T,this),e(this,"elementSpacing",D,this),this.bundle=null,e(this,"maxSpeed",M,this),e(this,"acceleration",P,this),e(this,"decelerationEasing",x,this),e(this,"decelerationDuration",H,this),e(this,"bounceEasing",Y,this),e(this,"bounceDuration",$,this),this._isSpinning=!1,this._onSpinComplete=null,this._targetElementName="",this._symbolCount=0,this._elementMap=new Map,this._originalSymbolCount=0,this._currentVisibleElements=[],this._spinState=z.IDLE,this._currentSpeed=0,this._targetY=0,this._stopCallback=null,this._loopHeight=0,this._startY=0,this._locked=!1,this._turboMode=0,this._baseMaxSpeed=4e3}setTurboMode(t){this._turboMode=t,this.maxSpeed=1===t?1.5*this._baseMaxSpeed:2===t?2.5*this._baseMaxSpeed:this._baseMaxSpeed,console.log(`[Wheel] setTurboMode: mode=${t}, maxSpeed=${this.maxSpeed}`)}lock(){this._locked=!0,this._isSpinning=!1,this._spinState=z.IDLE,console.log(`[Wheel] 轮子已锁定, wheelType=${this.wheelType}`)}unlock(){this._locked=!1,console.log(`[Wheel] 轮子已解锁, wheelType=${this.wheelType}`)}onLoad(){if(this.symbolContainer||(this.symbolContainer=this.node.getChildByName("symbol_container")||this.node),this.symbolContainer){const t=[...this.symbolContainer.children];if(this._originalSymbolCount=t.length,this._elementMap.clear(),t.forEach((t=>{this._elementMap.set(t.name,h(t))})),this._originalSymbolCount>1){const i=Math.min(3,this._originalSymbolCount);for(let e=0;e<i;e++){const i=t[this._originalSymbolCount-1-e],n=h(i);this.symbolContainer.insertChild(n,0)}for(let e=0;e<i;e++){const i=t[e],n=h(i);this.symbolContainer.addChild(n)}}const i=this.symbolContainer.getComponent(r);i&&(i.updateLayout(),i.enabled=!1),this._symbolCount=this.symbolContainer.children.length,this._originalSymbolCount>0&&(this._loopHeight=this.elementSpacing*(this._originalSymbolCount-1)+this.symbolHeight)}if(this.symbolHeight<=0&&this.symbolContainer&&this.symbolContainer.children.length>0){const t=this.symbolContainer.children[0].getComponent(a);t&&(this.symbolHeight=t.height)}this.resetToInitialPosition()}resetToInitialPosition(){if(!this.symbolContainer||0===this.symbolContainer.children.length)return;const t=(this._symbolCount-this._originalSymbolCount)/2,i=this.symbolContainer.children[t];if(!i){const t=this.symbolContainer.children[0].position.y;return void(this.symbolContainer.position=new m(this.symbolContainer.position.x,-t,0))}const e=i.position.y;this._startY=-e,this.symbolContainer.position=new m(this.symbolContainer.position.x,this._startY,0)}startSpin(t="",i=2,e){this._locked?console.warn(`[Wheel] 轮子已锁定，禁止转动, wheelType=${this.wheelType}`):(p(this.symbolContainer).stop(),this._isSpinning||(0!==this._originalSymbolCount?(this._isSpinning=!0,this._spinState=z.SPINNING,this._currentSpeed=this.maxSpeed,this._onSpinComplete=e||null,this._targetElementName=t):e&&e("")))}stop(t,i,e){if(console.log(`[Wheel] stop called: targetElementName="${t}", wheelType=${this.wheelType}, isSpinning=${this._isSpinning}, spinState=${this._spinState}`),!this._isSpinning||this._spinState!==z.SPINNING)return console.log("[Wheel] 轮盘未在滚动，直接触发回调"),void(i&&i());this._targetElementName=t,this._stopCallback=i||null;let n=null,o=[];const s=this.symbolContainer.position.y,l=.2*this.maxSpeed,h=this._startY-this._loopHeight+l,r=this._startY-l;for(const i of this.symbolContainer.children){if(i.name.replace(/-clone.*$/,"")===t){const t=-i.position.y;let e=t-s;e<0&&(e+=this._loopHeight),o.push({node:i,distance:e,targetY:t})}}if(o.length>0){const t=o.filter((t=>t.targetY>h&&t.targetY<r));t.length>0?(t.sort(((t,i)=>t.distance-i.distance)),n=t[0].node):(o.sort(((t,i)=>t.distance-i.distance)),n=o[0].node)}if(n)this._targetY=-n.position.y;else{const t=this.getClosestElement();if(t){const i=t.position.y;this._targetY=-i+this.symbolHeight/2+this.elementSpacing/2}else this._targetY=this.symbolContainer.position.y}this._spinState=z.IDLE,this.symbolContainer.position=new m(this.symbolContainer.position.x,this._targetY,0),this._onSpinFinished()}update(t){if(this._spinState!==z.SPINNING)return;this._currentSpeed<this.maxSpeed&&(this._currentSpeed+=this.acceleration*t,this._currentSpeed>this.maxSpeed&&(this._currentSpeed=this.maxSpeed));let i=this.symbolContainer.position.y-this._currentSpeed*t;if(this._originalSymbolCount>1&&this._loopHeight>0){i<this._startY-this._loopHeight&&(i+=this._loopHeight)}this.symbolContainer.position=new m(this.symbolContainer.position.x,i,0)}_onSpinFinished(){this._isSpinning=!1,this._spinState=z.IDLE,this.symbolContainer.position=new m(this.symbolContainer.position.x,this._targetY,0),console.log(`[Wheel] _onSpinFinished: targetElementName="${this._targetElementName}", wheelType=${this.wheelType}, finalY=${this._targetY}`);this.getDisplayedElement();this._stopCallback?(console.log(`[Wheel] 触发 _stopCallback for wheelType=${this.wheelType}`),this._stopCallback(),this._stopCallback=null):console.warn(`[Wheel] 警告: _stopCallback 为 null, wheelType=${this.wheelType}`),this._onSpinComplete&&(this._onSpinComplete(this._targetElementName),this._onSpinComplete=null)}getDisplayedElement(){return this._targetElementName&&""!==this._targetElementName?this.findDisplayedElement(this._targetElementName):null}findDisplayedElement(t){if(!this.symbolContainer)return null;const i=[];for(const t of this.symbolContainer.children)i.push(t.name);let e=null,n=1/0;for(const i of this.symbolContainer.children){if(i.name.replace(/-clone.*$/,"")===t){const t=i.position.y,o=this.symbolContainer.position.y,s=Math.abs(o+t);s<n&&(n=s,e=i)}}return e||null}showResult(t,i=!0){p(this.symbolContainer).stop(),this._isSpinning=!1,this._spinState=z.IDLE,this._currentSpeed=0;let e=0,n=null;for(const i of this.symbolContainer.children){if(i.name.replace(/-clone.*$/,"")===t){n=i;break}}if(console.log(`[Wheel showResult] elementName=${t}, found=${!!n}`),n)e=-n.position.y;else{const t=this.getClosestElement();if(t){e=-t.position.y+this.symbolHeight/2+this.elementSpacing/2}else e=this.symbolContainer.position.y}if(this.symbolContainer.position=new m(this.symbolContainer.position.x,e,0),this._targetElementName=t,this._targetY=e,i&&t&&""!==t&&this.bundle){const i=this.findDisplayedElement(t);if(i){const e=i.getWorldPosition();c.playAnimationAt(this.node,e,t,this.bundle)}}}get isSpinning(){return this._isSpinning}reset(){p(this.symbolContainer).stop(),this._isSpinning=!1,this._spinState=z.IDLE,this.resetToInitialPosition()}getCurrentElementName(){return this.getClosestElement().name}getClosestElement(){const t=this.symbolContainer.position.y;let i=null,e=1/0;for(const n of this.symbolContainer.children){const o=n.position.y,s=Math.abs(t+o);s<e&&(e=s,i=n)}return i}setVisibleElements(t){if(!this.symbolContainer)return;if(0===this._elementMap.size)return;0===t.length&&(t=Array.from(this._elementMap.keys()));if(this._currentVisibleElements.length===t.length&&this._currentVisibleElements.every(((i,e)=>i===t[e])))return;this._spinState,z.IDLE;const i=this.symbolContainer.position.clone();p(this.symbolContainer).stop(),this._isSpinning=!1,this._spinState=z.IDLE;const e=this.symbolContainer.active;if(this.symbolContainer.active=!1,this.symbolContainer.removeAllChildren(),t.forEach((t=>{const i=this._elementMap.get(t);if(i){const t=h(i);this.symbolContainer.addChild(t)}})),this._originalSymbolCount=this.symbolContainer.children.length,0===this._originalSymbolCount)return;if(this._originalSymbolCount>1){const t=[...this.symbolContainer.children],i=Math.min(3,this._originalSymbolCount);for(let e=0;e<i;e++){const i=t[this._originalSymbolCount-1-e],n=h(i);this.symbolContainer.insertChild(n,0)}for(let e=0;e<i;e++){const i=t[e],n=h(i);this.symbolContainer.addChild(n)}}this._symbolCount=this.symbolContainer.children.length;const n=this.symbolContainer.getComponent(r);n&&(n.enabled=!1),this._manuallyLayoutChildren(),this._finalizePositionAfterRebuild(i,e),this._originalSymbolCount>0&&(this._loopHeight=this.elementSpacing*(this._originalSymbolCount-1)+this.symbolHeight),this._currentVisibleElements=[...t]}_manuallyLayoutChildren(){if(!this.symbolContainer||0===this.symbolContainer.children.length)return;let t=0;for(let i=0;i<this.symbolContainer.children.length;i++){const e=this.symbolContainer.children[i];0===i?t=0:t-=this.symbolHeight+this.elementSpacing,e.setPosition(0,t,0)}}_finalizePositionAfterRebuild(t,i=!0){if(t&&this._currentVisibleElements.length>0){const t=(this._symbolCount-this._originalSymbolCount)/2,i=this.symbolContainer.children[t];if(i){const t=i.position.y;this._startY=-t,this.resetToInitialPosition()}else this.resetToInitialPosition()}else this.resetToInitialPosition();this.symbolContainer.active=i}}).prototype,"symbolContainer",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=i(E.prototype,"symbolHeight",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 166}}),I=i(E.prototype,"wheelType",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"coin"}}),T=i(E.prototype,"containerHeight",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 316}}),D=i(E.prototype,"elementSpacing",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),M=i(E.prototype,"maxSpeed",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4e3}}),P=i(E.prototype,"acceleration",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3e3}}),x=i(E.prototype,"decelerationEasing",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"quadOut"}}),H=i(E.prototype,"decelerationDuration",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),Y=i(E.prototype,"bounceEasing",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),$=i(E.prototype,"bounceDuration",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),f=E))||f));n._RF.pop()}}}));

System.register("chunks:///_virtual/MoneyComingAPI.ts",["cc","./config20.ts","./symbolMapping.ts"],(function(e){var n,o,t,s,l,i;return{setters:[function(e){n=e.cclegacy},function(e){o=e.default},function(e){t=e.BET_MAPPING,s=e.SYMBOL_MAPPING,l=e.centsToYuan,i=e.REVERSE_BET_MAPPING}],execute:function(){n._RF.push({},"a1f018saABP3pyJIS9yzR1c","MoneyComingAPI",void 0);class r{constructor(e=14007){this.gameId=void 0,this.apiBaseUrl=void 0,this.gameId=e,this.apiBaseUrl=window.HALL_GLOBAL&&window.HALL_GLOBAL.config&&window.HALL_GLOBAL.config.httpBaseUrl||""}getFetcher(){if(window.HALL_GLOBAL&&window.HALL_GLOBAL.fetcher)return window.HALL_GLOBAL.fetcher;throw new Error("[MoneyComingAPI] Fetcher not available. Please ensure HALL_GLOBAL is initialized before using MoneyComingAPI.")}async enter(){console.log("[MoneyComingAPI] Calling slot/enter...");const e={gameId:this.gameId};try{const n=this.getFetcher(),o=await n.send("/api/genius-game-server/slot/enter",e,"post",{},{isLoading:!0,dataVerify:0});console.log("[MoneyComingAPI] Enter response:",o);const t=o.data?o.data:o,s=this.convertEnterData(t);return console.log("[MoneyComingAPI] Enter success:",s),s}catch(e){throw console.error("[MoneyComingAPI] Enter failed:",e),e}}async spin(e,n){console.log("[MoneyComingAPI] ========== 调用 SPIN 接口 =========="),console.log("[MoneyComingAPI] 投注金额:",e,"元"),n&&console.log("[MoneyComingAPI] Debug 参数:",n);const o=t[e];if(!o)throw new Error(`Invalid bet amount: ${e}. Valid options: ${Object.keys(t).join(", ")}`);const i={actionType:"SPIN",gameId:this.gameId,payload:{type:"SPIN",betAmount:o,variantId:"standard",debug:n?{clearState:void 0!==n.clearState&&n.clearState,forceFeature:n.forceFeature}:void 0}};try{const e=this.getFetcher(),n=await e.send("/api/genius-game-server/slot/action",i,"post",{},{isLoading:!1,dataVerify:0});console.log("[MoneyComingAPI] Spin response:",JSON.stringify(n));const o=n.data?n.data:n;console.log("\n========== Spin 结果详情 =========="),console.log("[MoneyComingAPI] 响应类型:",o.spinResult?"spinResult":o.featureResult?"featureResult":"unknown");try{o.spinResult&&o.spinResult.reels&&(console.log("\n原始 Reels:",o.spinResult.reels),console.log("符号映射:"),o.spinResult.reels.forEach(((e,n)=>{const o=e&&e.length>0?1===e.length?e[0]:e[1]:null,t=o&&o.id?o.id:"undefined",l=s[t]||"未映射";console.log(`  Reel ${n}: ${t} → ${l}`)})),o.spinResult.winLines&&o.spinResult.winLines.length>0?console.log("中奖线:",o.spinResult.winLines.length,"条"):console.log("中奖线: 无"))}catch(e){console.error("[MoneyComingAPI] 打印 spinResult 时出错:",e)}try{if(o.featureResult){console.log("\nFeature 结果:"),console.log(`  - 类型: ${o.featureResult.type||"N/A"}`),console.log(`  - 完成: ${!!o.featureResult.completed}`),console.log(`  - 停止位置: ${o.featureResult.selectedIndex||0}`);const e=o.featureResult.winAmount||0;console.log(`  - Feature 中奖: ${l(e)} 元`)}}catch(e){console.error("[MoneyComingAPI] 打印 featureResult 时出错:",e)}console.log("\n金额信息:"),console.log(`  - totalWinAmount: ${l(o.totalWinAmount||0)} 元`),console.log(`  - balance: ${l(o.balance||0)} 元`),console.log("=====================================\n");const t=this.convertSpinData(o);return console.log("[MoneyComingAPI] Spin success:",t),t}catch(e){throw console.error("[MoneyComingAPI] Spin failed:",e),e}}convertEnterData(e){console.log("[MoneyComingAPI] convertEnterData input:",e);const n=l(e.balance);console.log(`[MoneyComingAPI] Balance: ${e.balance} 分 → ${n} 元`);const o=e.betOptions.map((e=>{const n=i[e];return void 0===n&&console.warn(`[MoneyComingAPI] Unknown bet option: ${e} cents`),n})).filter((e=>void 0!==e));console.log("[MoneyComingAPI] Bet options:",e.betOptions,"→",o);let t=i[e.recommendedBetAmount];void 0===t&&(console.warn(`[MoneyComingAPI] Unknown recommended bet: ${e.recommendedBetAmount} cents, using default 10`),t=10),console.log(`[MoneyComingAPI] Recommended bet: ${e.recommendedBetAmount} 分 → ${t} 元`);let s,r,a,c=!1;!e.roundCompleted&&e.triggeredFeature&&e.spinResult&&(console.log("[MoneyComingAPI] ========== 检测到未完成的回合 =========="),console.log("[MoneyComingAPI] roundCompleted:",e.roundCompleted),console.log("[MoneyComingAPI] triggeredFeature:",e.triggeredFeature),"freeSpin"===e.triggeredFeature.type?(c=!0,s="freeSpin",t=i[e.betAmount],r=this.mapReelsToSpinResults(e.spinResult.reels,t),a=l(e.spinResult.winAmount),console.log("[MoneyComingAPI] 需要恢复 freeSpin (feature_all_respin)"),console.log("[MoneyComingAPI] 第一次 spin 结果:",r),console.log("[MoneyComingAPI] 第一次 spin 中奖:",a,"元")):"simpleWheel"===e.triggeredFeature.type&&(c=!0,s="scatter",t=i[e.betAmount],r=this.mapReelsToSpinResults(e.spinResult.reels,t),a=l(e.spinResult.winAmount),console.log("[MoneyComingAPI] 需要恢复 scatter (feature_scatter → simpleWheel)"),console.log("[MoneyComingAPI] 第一次 spin 结果:",r),console.log("[MoneyComingAPI] 第一次 spin 中奖:",a,"元")));const u=c&&r?r:this.generateIdleReels();return console.log("[MoneyComingAPI] Initial reels:",u),{balance:n,betOptions:o,currentBet:t,initialReels:u,needsRecovery:c,recoveryType:s,firstSpinResults:r,firstSpinWin:a}}convertSpinData(e){const n=l(e.balance),o=e.spinResult?this.mapReelsToSpinResults(e.spinResult.reels):[],t=l(e.totalWinAmount),s=l(e.totalWinAmount),i=e.featureResult?{type:e.featureResult.type||"unknown",completed:e.featureResult.completed||!1,totalCount:e.featureResult.totalCount||0,currentCount:e.featureResult.currentCount||0,selectedIndex:void 0!==e.featureResult.selectedIndex?e.featureResult.selectedIndex:0,winAmount:l(e.featureResult.winAmount||0)}:void 0;return{balance:n,spinResults:o,winAmount:t,totalWinAmount:s,roundCompleted:e.roundCompleted,featureResult:i}}generateIdleReels(){return["element_0","element_00","",""]}mapReelsToSpinResults(e,n){return e.map(((e,o)=>{const t=1===e.length?e[0]:e[1];if(!t)return console.warn(`[MoneyComingAPI] Reel ${o} missing symbol, reel:`,e),"";const l=t.id;let i=s[l];return"E9801"===l&&n&&n>=50&&(console.log(`[MoneyComingAPI] 调整 E9801 符号: bet=${n}元, 'feature_scatter' → 'feature_scatter_50_100'`),i="feature_scatter_50_100"),i||"E0001"===l||console.warn(`[MoneyComingAPI] Unknown symbol: ${l}`),i||""}))}}e("MoneyComingAPI",r);e("default",new r(o.gameId));n._RF.pop()}}}));

System.register("chunks:///_virtual/moneyComingScript",["./MoneyComingStandalone.ts","./MoneyComing_StartUp.ts","./MoneyComingAPI.ts","./symbolMapping.ts","./types.ts","./BetSelection.ts","./LuckyWheelRotator.ts","./MoneyComing_GameMain.ts","./MoneyComing_LuckyWheel.ts","./MoneyComing_Respin.ts","./MoneyComing_Wheel.ts","./config20.ts","./index83.ts","./socketConnect20.ts","./index81.ts","./prefabDefine21.ts","./soundDefine21.ts","./game37.ts","./index80.ts","./index82.ts","./type19.ts","./AnimationUtils.ts","./SymbolAnimator.ts","./AnimationViewModel.ts","./GameMainViewModel2.ts","./LuckyWheelViewModel.ts","./RespinViewModel.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MoneyComingStandalone.ts",["cc","./index83.ts","./StandAloneFetcher.ts"],(function(o){var n,e,t,a,l;return{setters:[function(o){n=o.cclegacy,e=o.Component,t=o._decorator},function(o){a=o.startUp},function(o){l=o.default}],execute:function(){var i;n._RF.push({},"aaf01wTsydB14SNKO9+WU5e","MoneyComingStandalone",void 0);const{ccclass:s}=t;o("MoneyComingStandalone",s("MoneyComingStandalone")(i=class extends e{start(){if(window.HALL_GLOBAL)console.log("[MoneyComingStandalone] HALL_GLOBAL already exists, starting MoneyComing..."),a(this.node);else{console.log("[MoneyComingStandalone] Initializing HALL_GLOBAL for standalone mode...");const o="https://u3d-dev-web.kbtech.cc/dev",n=new l(o);window.HALL_GLOBAL={hallDispatch:o=>console.log("[Mock] Hall Dispatch:",o),addToast:o=>console.log("[Mock] Toast:",o),setLoading:(o,n)=>console.log("[Mock] Loading:",o,n),setSubGameRunState:o=>console.log("[Mock] SubGameRunState:",o),isAllowOpenSubGame:()=>!0,closeSubGame:()=>console.log("[Mock] Close SubGame"),lang:{write:(o,n,e)=>"Mock String"},getGameConfig:o=>({md5:"DEV_VERSION"}),config:{httpBaseUrl:o},fetcher:n,wsInstance:{}},console.log("[MoneyComingStandalone] HALL_GLOBAL initialized"),console.log("[MoneyComingStandalone] StandAloneFetcher initialized with baseUrl:",o),console.log("[MoneyComingStandalone] Starting MoneyComing..."),a(this.node)}}})||i);n._RF.pop()}}}));

System.register("chunks:///_virtual/prefabDefine21.ts",["cc","./SourceManage.ts"],(function(e){var n,r,t;return{setters:[function(e){n=e.cclegacy,r=e.Prefab},function(e){t=e.loopFiles}],execute:function(){n._RF.push({},"cdbe4QsFEVMwrlG434WG6Xp","prefabDefine",void 0);let f=e("PrefabPathDefine",function(e){return e.LOAING_PANEL="prefabs/prefab_moneyComing_loading",e.GAME_MAIN="prefabs/MoneyComingView",e}({}));e("default",(e=>t(e,r,f)));n._RF.pop()}}}));

System.register("chunks:///_virtual/RespinViewModel.ts",["cc","./ViewModel.ts","./index80.ts","./game37.ts","./index83.ts","./soundDefine21.ts","./config20.ts"],(function(e){var o,t,n,i,s,l,a,p,m;return{setters:[function(e){o=e.cclegacy,t=e._decorator},function(e){n=e.StoreInject,i=e.default},function(e){s=e.getStore},function(e){l=e.setRespin},function(e){a=e.moneyComing_Audio},function(e){p=e.SoundPathDefine},function(e){m=e.default}],execute:function(){var c;o._RF.push({},"f8dcdnlnTtEgYLs8Y177lIp","RespinViewModel",void 0);const{ccclass:r}=t;e("RespinViewModel",n(s())(c=r("RespinViewModel")(c=class extends i{constructor(){super("MoneyComing_Respin"),this.gameMainComp=null}begin(){}connect(){return this.inject({},(e=>({betAmount:e.betAmount}))),this}setGameMain(e){this.gameMainComp=e}async handleAllRespin(e,o,t,n){console.log("[RespinViewModel] handleAllRespin started, isRecovery:",!!n),s().dispatch(l(!0)),console.log("[RespinViewModel] 已设置 isRespin=true");let i="";const c=1===this.comp.props.betAmount?2:3;for(let o=0;o<c;o++){const t=e[o];t&&t.startsWith("element_")&&(i+=t.replace("element_",""))}const r=""===i||isNaN(parseInt(i,10))?0:parseInt(i,10);if(n?(console.log("[RespinViewModel] 恢复模式：跳过符号动画，但显示 Feature Panel"),this.gameMainComp&&this.gameMainComp.showFeaturePanel(r,"all_respin",this.comp.props.betAmount)):(this.gameMainComp&&(this.gameMainComp.showFeaturePanel(r,"all_respin",this.comp.props.betAmount),a.playOneShot(p.activeFeature)),this.gameMainComp&&this.gameMainComp.playFeatureSymbolAnimation("feature_all_respin"),a.playOneShot(p.allRespin),a.playOneShot(p.allRespinScatter)),console.log("[RespinViewModel] 准备播放飞行动画, this.comp 存在:",!!this.comp),this.comp?await new Promise((e=>{let o=!1;console.log("[RespinViewModel] 开始播放飞行动画");const t=setTimeout((()=>{o||(console.warn("[RespinViewModel] ⚠️ 飞行动画超时，强制继续"),o=!0,e())}),3e3);this.comp.events.onFlyComplete=()=>{o||(console.log("[RespinViewModel] ✅ 飞行动画完成"),o=!0,clearTimeout(t),e())},console.log("[RespinViewModel] 调用 playFlyAnimation"),this.comp.playFlyAnimation(this.comp.props.betAmount)})):(console.error("[RespinViewModel] ⚠️ this.comp 不存在，跳过飞行动画，延迟 1.5 秒"),await new Promise((e=>setTimeout(e,1500)))),console.log("[RespinViewModel] 飞行动画完成，延迟 500ms 后启动 respin"),await new Promise((e=>setTimeout(e,500))),this.gameMainComp){console.log("[RespinViewModel] 准备启动 respin，锁定 feature 轮子，解锁前三个轮子");const o=this.gameMainComp.wheels;if(o&&o.length>=4){const t=1===this.comp.props.betAmount?2:3;for(let e=0;e<t;e++)o[e]&&(o[e].unlock(),console.log(`[RespinViewModel] 轮子 ${e} 已解锁`));const n=e[3];n&&o[3]&&(o[3].lock(),o[3]._isSpinning=!1,o[3]._spinState=0,o[3].showResult(n,!1),console.log("[RespinViewModel] Feature 轮子已锁定并固定:",n))}a.playOneShot(p.spin),this.gameMainComp.startRespin()}const u=Date.now(),h=t?await t():this.generateRespinResults(this.comp.props.betAmount),g=(Date.now()-u)/1e3,d=this.comp.props.turboMode;let M=m.gameConfig.simultaneousStop.normal.scrollDuration;1===d?M=m.gameConfig.simultaneousStop.turbo.scrollDuration:2===d&&(M=m.gameConfig.simultaneousStop.superTurbo.scrollDuration);const w=Math.max(0,M-g);console.log(`[RespinViewModel] Respin 转动时间控制: 已转动=${g.toFixed(2)}秒, 最小时长=${M}秒, 还需等待=${w.toFixed(2)}秒`),await new Promise((e=>setTimeout(e,1e3*w))),this.gameMainComp&&await new Promise((e=>{this.gameMainComp.stopRespin(h,e)}));let R="";for(let e=0;e<c;e++){const o=h[e];o&&o.startsWith("element_")&&(R+=o.replace("element_",""))}const f=""===R||isNaN(parseInt(R,10))?0:parseInt(R,10);if(this.gameMainComp&&this.gameMainComp.updateFeatureBonus(f),await new Promise((e=>setTimeout(e,1e3))),this.gameMainComp&&this.gameMainComp.hideFeaturePanel(),console.log("[RespinViewModel] handleAllRespin completed"),this.gameMainComp){const e=this.gameMainComp.wheels?.[3];e&&(e.unlock(),console.log("[RespinViewModel] Feature 轮子已解锁"))}s().dispatch(l(!1)),console.log("[RespinViewModel] 已清除 isRespin=false"),o(h)}generateRespinResults(e){const o=["element_0","element_00","element_1","element_5","element_10"],t=()=>o[Math.floor(Math.random()*o.length)];return[t(),t(),1===e?"":t(),"feature_all_respin"]}})||c)||c);o._RF.pop()}}}));

System.register("chunks:///_virtual/socketConnect20.ts",["cc","./MoneyComingAPI.ts"],(function(e){var o,n;return{setters:[function(e){o=e.cclegacy},function(e){n=e.default}],execute:function(){o._RF.push({},"2f393RnampFrJaP9qGy4476","socketConnect",void 0);e("SKT_MAG_TYPE",function(e){return e.ENTER="enter",e.SPIN="spin",e.EXIT_GAME="exit",e}({}));let t=e("moneyComingWebSocketDriver",null);e("default",(()=>new Promise(((o,i)=>{console.log("[MoneyComing] Initializing API connection..."),t=e("moneyComingWebSocketDriver",{loginGame:e=>(console.log("[MoneyComing] loginGame called (no-op for HTTP)"),{bindReceiveHandler:e=>{setTimeout((()=>e({data:{success:!0}})),100)},bindTimeoutHandler:e=>!0}),logoutGame:e=>{console.log("[MoneyComing] logoutGame called (no-op for HTTP)")},filterData:(e,o)=>({data:e,error:void 0}),sktMsgListener:{add:(e,o,n)=>{console.log(`[MoneyComing] sktMsgListener.add: ${e}`)},remove:(e,o)=>{console.log(`[MoneyComing] sktMsgListener.remove: ${e}`)}},api:n}),o(t)}))));e("removeInstance",(()=>{console.log("[MoneyComing] Cleaning up API connection"),t=e("moneyComingWebSocketDriver",null)}));o._RF.pop()}}}));

System.register("chunks:///_virtual/soundDefine21.ts",["cc","./SourceManage.ts"],(function(e){var u,n,i;return{setters:[function(e){u=e.cclegacy,n=e.AudioClip},function(e){i=e.loopFiles}],execute:function(){u._RF.push({},"61a73HYA9FA5p8MDYZOD9uS","soundDefine",void 0);let o=e("SoundPathDefine",function(e){return e.bg="audio/music/bg",e.luckyWheel="audio/sound/lucky_wheel",e.activeFeature="audio/sound/active_feature",e.wheelLock="audio/sound/wheel_lock",e.spinOver="audio/sound/spin_over",e.feature="audio/sound/feature",e.allRespin="audio/sound/all_respin",e.number="audio/sound/number",e.bigWin="audio/sound/big_win",e.scatterOver="audio/sound/scatter_over",e.allRespinScatter="audio/sound/all_respin_scatter",e.spin="audio/sound/spin",e}({}));e("default",(e=>i(e,n,o)));u._RF.pop()}}}));

System.register("chunks:///_virtual/SymbolAnimator.ts",["cc"],(function(e){var o,n,t,s,i,l,a;return{setters:[function(e){o=e.cclegacy,n=e._decorator,t=e.Component,s=e.assetManager,i=e.sp,l=e.Node,a=e.UITransform}],execute:function(){var m,r;o._RF.push({},"02413jRgrVEg7SfoDiim3WK","SymbolAnimator",void 0);const{ccclass:y}=n;e("SymbolAnimator",y("SymbolAnimator")(((r=class extends t{static playAnimationAt(e,o,n,t,m=!1,r=1){console.log(`[SymbolAnimator] playAnimationAt for ${n}`);const y=this.SPINE_PATH_MAP.get(n);if(!y)return void console.warn(`[SymbolAnimator] 元素 ${n} 没有对应的 spine 动画`);const c=s.getBundle(t);c?c.load(y,i.SkeletonData,((t,s)=>{if(t||!e||!e.isValid)return void console.error(`[SymbolAnimator] 加载 spine 资源失败或父节点已销毁: ${y}`,t);const c=new l(`spine_anim_${n}_${Date.now()}`);e.addChild(c);const _=e.getComponent(a).convertToNodeSpaceAR(o);c.setPosition(_),c.layer=e.layer;const p=c.addComponent(i.Skeleton);p.skeletonData=s,p.premultipliedAlpha=!0,p.timeScale=r;const b="animation";p.findAnimation(b)?(p.setAnimation(0,b,m),m||p.setCompleteListener((()=>{c&&c.isValid&&c.destroy()}))):(console.warn(`[SymbolAnimator] spine 资源 ${y} 中未找到名为 'animation' 的动画`),c.destroy())})):console.error(`[SymbolAnimator] 无法获取 bundle: ${t}`)}static stopAllAnimations(e){if(!e||!e.isValid)return;const o=[...e.children];for(const e of o)e.name.startsWith("spine_anim_")&&e.destroy()}}).SPINE_PATH_MAP=new Map([["element_0","spine/symbol/symbol_0"],["element_00","spine/symbol/symbol_00"],["element_1","spine/symbol/symbol_1"],["element_5","spine/symbol/symbol_5"],["element_10","spine/symbol/symbol_10"],["feature_x2","spine/symbol/symbol_2x"],["feature_x5","spine/symbol/symbol_5x"],["feature_x10","spine/symbol/symbol_10x"],["feature_all_respin","spine/symbol/symbol_all"],["feature_scatter","spine/symbol/symbol_scatter"],["feature_scatter_50_100","spine/symbol/symbol_scatter_red"]]),m=r))||m);o._RF.pop()}}}));

System.register("chunks:///_virtual/symbolMapping.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"28b265MVj5MD6qXJXLldXVR","symbolMapping",void 0);const n=e("SYMBOL_MAPPING",{E0101:"element_10",E0102:"element_00",E0103:"element_5",E0104:"element_1",E0105:"element_0",E0106:"element_10",E0107:"element_5",E0108:"element_1",E0109:"element_0",E0001:"",E9601:"feature_x10",E9602:"feature_x5",E9603:"feature_x2",E9801:"feature_scatter",E9802:"feature_scatter_50_100",E9803:"feature_all_respin",E9901:"","":""}),r=(e("REVERSE_SYMBOL_MAPPING",(()=>{const e={};for(const t in n)if(n.hasOwnProperty(t)){const r=n[t];r&&(e[r]=t)}return e})()),e("BET_MAPPING",{1:100,5:500,10:1e3,50:5e3,100:1e4}));e("REVERSE_BET_MAPPING",(()=>{const e={};for(const t in r)if(r.hasOwnProperty(t)){const n=Number(t);e[r[n]]=n}return e})()),e("yuanToCents",(e=>Math.round(100*e))),e("centsToYuan",(e=>e/100));t._RF.pop()}}}));

System.register("chunks:///_virtual/type19.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"4902aWhmWpM944EXJQ2Mzp8","type",void 0),t._RF.pop()}}}));

System.register("chunks:///_virtual/types.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"d5779ubg4RBMYykHUp3t/R9","types",void 0),t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/moneyComingScript', 'chunks:///_virtual/moneyComingScript'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});