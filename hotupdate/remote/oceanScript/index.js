System.register("chunks:///_virtual/config21.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"4027but/jlHBLoQjTFQOWFu","config",void 0);e("default",{sktCode:"Ocean",name:"Ocean",gameId:23,isTest:!1,seatNumber:1,isReconnect:!1,memberId:"",testConfig:{wsUrl:"",token:"",uid:""},gameConfig:{autoSpin:{totalSpins:50,intervals:{normal:1,turbo:.5,superTurbo:.2}},gameplay:{winDisplayDuration:2,symbolProbability:.8,bigWin:{big:1500,mega:3e3,super:5e3}},pearlCollect:{goalValue:10},stickySpin:{pearlCountToTrigger:3,initialSpins:2,bonusSpins:2,maxPearls:10},constants:{bundleName:"ocean",reelCount:5,visibleSymbols:3,symbolHeight:125,symbolSpacing:0,reelPositions:[-344,-172,0,172,344],betOptions:[100,200,500,1e3,2e3],defaultBet:200,scatterSymbol:"ocean_icon_scatter",wildSymbol:"ocean_icon_mermaid_1",pearlSymbol:"ocean_icon_pearl",iconNames:["common_icon_9","common_icon_10","common_icon_j","common_icon_q","common_icon_k","ocean_icon_starfish","ocean_icon_pearl","ocean_icon_treasurebox","ocean_icon_tropicalfish","ocean_icon_oceanturtle","ocean_icon_mermaid_1","ocean_icon_scatter"],iconSpineMap:{ocean_icon_oceanturtle:"spine/spine_ocean_turtle/sea_icon_seaturtle",ocean_icon_starfish:"spine/spine_ocean_starfish/json/sea_icon_starfish",ocean_icon_tropicalfish:"spine/spine_ocean_tropicalfish/sea_icon_tropicalfish",ocean_icon_scatter:"spine/spine_ocean_scatter/haitunxiao"},mermaidSpinePath:"spine/spine_ocean_meirenyu/spine_ocean_meirenyu",mermaidSpineFullPath:"spine/spine_ocean_meirenyu_full/spine_ocean_meirenyu_full",pearlSpinePath:"spine/spine_ocean_peral/spine_ocean_peral",pearlFontPath:"font/ocean_pearl_number_small_font",mermaidBgPath:"texture/ocean_bg&reel/ocean_bg_reel/spriteFrame",mermaidActiveSpinePath:"spine/ocean_mermaid_active/ocean_mermaid_active",scatterBigSpinePath:"spine/spine_ocean_dolphin_big/haitunda"}}});n._RF.pop()}}}));

System.register("chunks:///_virtual/game38.ts",["cc","./index.mjs_cjs=&original=2.js","./index2.js"],(function(e){var t,n;return{setters:[function(e){t=e.cclegacy},null,function(e){n=e.default}],execute:function(){t._RF.push({},"bac49alWylL/4uf15+rOxCi","game",void 0);e("updateBalance",n.createAction("OCEAN_UPDATE_BALANCE")),e("updateBet",n.createAction("OCEAN_UPDATE_BET")),e("updateWin",n.createAction("OCEAN_UPDATE_WIN")),e("setSpinning",n.createAction("OCEAN_SET_SPINNING")),e("setSpinResults",n.createAction("OCEAN_SET_SPIN_RESULTS")),e("setTurboMode",n.createAction("OCEAN_SET_TURBO_MODE")),e("setAutoSpin",n.createAction("OCEAN_SET_AUTO_SPIN")),e("setWinningLines",n.createAction("OCEAN_SET_WINNING_LINES")),e("setPearlValues",n.createAction("OCEAN_SET_PEARL_VALUES"));t._RF.pop()}}}));

System.register("chunks:///_virtual/index84.ts",["cc","./prefabDefine22.ts","./spriteDefine21.ts"],(function(e){var t,n,u;return{setters:[function(e){t=e.cclegacy},function(e){n=e.default},function(e){u=e.default}],execute:function(){t._RF.push({},"1ae7eQPJENFkZsfB1ud9GG8","index",void 0);const c=e("bundlePkgName","ocean");e("default",[...n(c),...u(c)]);t._RF.pop()}}}));

System.register("chunks:///_virtual/index85.ts",["cc","./redux.mjs_cjs=&original=.js","./index87.ts","./redux.js"],(function(e){var t,o,r;return{setters:[function(e){t=e.cclegacy},null,function(e){o=e.rootReducer},function(e){r=e.default}],execute:function(){let n;e("store",void 0),t._RF.push({},"4e851Opk5BNYrV8Hb4EOcRS","index",void 0);const c=t=>{if(!n){const t=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||r.compose;n=e("store",r.createStore(o,t(r.applyMiddleware())))}return n};e("default",{configureStore:c,getStore:i});const i=e("getStore",(()=>(n||c(),n)));t._RF.pop()}}}));

System.register("chunks:///_virtual/index86.ts",["cc","./LoaderPanelViewModel.ts","./config21.ts","./socketConnect21.ts","./index84.ts","./prefabDefine22.ts","./index85.ts","./index60.ts","./baseBoard2.ts","./hallType2.ts","./OceanViewModel.ts","./config17.ts","./WebSocketStarter.ts"],(function(e){var n,t,o,a,c,i,l,s,d,u,r,f,m,p,g,b,S,w,h,G,I,M;return{setters:[function(e){n=e.cclegacy,t=e.assetManager,o=e.Prefab},function(e){a=e.default},function(e){c=e.default},function(e){i=e.default,l=e.removeInstance},function(e){s=e.bundlePkgName,d=e.default},function(e){u=e.PrefabPathDefine},function(e){r=e.default,f=e.getStore},function(e){m=e.global,p=e.lang},function(e){g=e.setSubGameRunState,b=e.addToastAction,S=e.setSubGameInfoAction,w=e.setLoadingAction},function(e){h=e.SubGameRunState},function(e){G=e.OceanViewModel},function(e){I=e.subGameList},function(e){M=e.default}],execute:function(){e("oceanViewModel",void 0),n._RF.push({},"b4110oTtKNJF6t2siJGLliD","index",void 0);let O,v,D=[],T=e("bundleOcean",null);const k=e("sourceManageSeletor",((e=s)=>D.find((n=>n.bundle.name===e))));let A=0;e("startUp",(n=>{r.configureStore(),t.loadBundle(s,((t,l)=>{T=e("bundleOcean",l),T.load(u.LOAING_PANEL,o,((e,n)=>{}),((t,o)=>{m.isAllowOpenSubGame(c.gameId)&&(m.hallDispatch(g(h.READY)),v=(new a).mountView(o).appendTo(n).setProps({loadBarType:1}).setEvent({onLoadDone:t=>{D=t,A=window.setTimeout((()=>{m.closeSubGame({confirmContent:p.write((e=>e.InitGameModule.GameBoardInit)),confirmDoneBeforeFn:()=>o(v,A)}),m.hallDispatch(b({content:p.write((e=>e.InitGameModule.GameBoardInit),{},{placeStr:"game init failed"})}))}),1e4);const o=(e,n)=>{e.unMount(),window.clearTimeout(n)};v.comp.setTipContent(p.write((e=>e.WebSocketModule.GameInit),{},{placeStr:"Game init..."})),m.hallDispatch(g(h.RUN)),console.log("[Ocean] 开始初始化 WebSocket..."),i().then((()=>{console.log("[Ocean] WebSocket 初始化成功");const t=k().getFile(u.GAME_MAIN);if(!t||!t.source)return console.error("[Ocean] 游戏主界面 prefab 未找到或无效！"),m.hallDispatch(b({content:"游戏资源加载失败"})),void m.closeSubGame();console.log("[Ocean] 创建 OceanViewModel..."),O=e("oceanViewModel",(new G).mountView(t.source).appendTo(n).connect(f().getState())),v.viewNode.isValid&&v.viewNode.setSiblingIndex(v.viewNode.parent.children.length),setTimeout((()=>{console.log("[Ocean] 卸载加载面板..."),o(v,A),console.log("[Ocean] 游戏初始化完成！")}),100)})).catch((e=>{console.error("[Ocean] WebSocket 初始化失败:",e),v.comp.setTipContent(e||"WebSocket connection error"),m.hallDispatch(b({content:"WebSocket 连接失败"}))}))}}).setProps({versionStr:`md5: ${I&&I.find((e=>e.gameId===c.gameId))?I.find((e=>e.gameId===c.gameId)).md5:""}`}),v.comp.startLoad([l],[...d]))}))}))})),e("stopGame",(()=>{console.log("[Ocean] stopGame called"),m.hallDispatch(S(null)),m.hallDispatch(w({isShow:!1,flagId:s})),A&&window.clearTimeout(A),M.Instance().eventListener.removeById(s),v&&v.unMount(),O&&O.unMount(),l()}));n._RF.pop()}}}));

System.register("chunks:///_virtual/index87.ts",["cc","./index.mjs_cjs=&original=2.js","./game38.ts","./index2.js"],(function(n){var t,e,i,s,o,u,r,a,c,g,l;return{setters:[function(n){t=n.cclegacy},null,function(n){e=n.updateBalance,i=n.updateBet,s=n.updateWin,o=n.setSpinning,u=n.setSpinResults,r=n.setTurboMode,a=n.setAutoSpin,c=n.setWinningLines,g=n.setPearlValues},function(n){l=n.default}],execute:function(){t._RF.push({},"eed90QNGzdP/Yy8HacTfEIG","index",void 0);const p=l.createReducer({[e.toString()]:(n,t)=>({...n,balance:t}),[i.toString()]:(n,t)=>({...n,betAmount:t}),[s.toString()]:(n,t)=>({...n,winAmount:t}),[o.toString()]:(n,t)=>({...n,isSpinning:t}),[u.toString()]:(n,t)=>({...n,spinResults:t}),[r.toString()]:(n,t)=>({...n,turboMode:t}),[a.toString()]:(n,t)=>({...n,autoSpin:t}),[c.toString()]:(n,t)=>({...n,winningLines:t}),[g.toString()]:(n,t)=>({...n,pearlValues:t})},{balance:0,betAmount:200,winAmount:0,spinResults:[],isSpinning:!1,turboMode:0,autoSpin:!1,winningLines:[],pearlValues:[]});n("rootReducer",p);t._RF.pop()}}}));

System.register("chunks:///_virtual/Ocean_FreeGameManager.ts",["cc","./config21.ts","./OceanUtils.ts"],(function(e){var t,n,a,s,o,i,r;return{setters:[function(e){t=e.cclegacy,n=e.Label,a=e.tween,s=e.Vec3,o=e.Button},function(e){i=e.default},function(e){r=e.OceanUtils}],execute:function(){t._RF.push({},"6d846X+QyBAa4cfVkeWnCEz","Ocean_FreeGameManager",void 0);e("Ocean_FreeGameManager",class{get isActive(){return this._isActive}constructor(e){this.gameMain=void 0,this._isActive=!1,this._currentSpin=0,this._totalSpins=0,this._totalWinAmount=0,this._maskNode=null,this.gameMain=e}async triggerFreeGame(e){const t=this.calculateFreeSpins(e);console.log(`[Ocean_FreeGameManager] 触发 FreeGame，Scatter数量: ${e}，免费次数: ${t}`),await this.showStartPopup(t),this.enterFreeGameMode(t),this.startFreeGameMode()}calculateFreeSpins(e){return{3:8,4:15,5:25}[e]||8}showStartPopup(e){return new Promise((t=>{console.log("[Ocean_FreeGameManager] 显示 FreeGame 开始弹窗");const i=this.gameMain.propertyNode.props_freegame_popup;if(i&&i.isValid){i.active=!0,i.setSiblingIndex(999),this._maskNode=r.createMask(i,0,180);const c=i.getChildByPath("content/center_bg/props_freegame_count_amount");if(c){const t=c.getComponent(n);t?t.string=e.toString():console.warn("[Ocean_FreeGameManager] props_freegame_count_amount 没有 Label 组件")}const l=i.getChildByPath("content/in_freespins");l&&(l.active=!1);const p=i.getChildByPath("content/freespins_en");p&&(p.active=!0);const m=i.getChildByName("content");m&&(m.setScale(0,0,0),a(m).to(.5,{scale:new s(1.1,1.1,1.1)},{easing:"cubicOut"}).to(.2,{scale:new s(1,1,1)},{easing:"cubicIn"}).start());const h=i.getChildByPath("content/common_sale_button_green");if(h){const e=h.getComponentInChildren(n);e&&(e.string="START");const a=()=>{h.off(o.EventType.CLICK,a),r.destroyMask(this._maskNode),this._maskNode=null,i.active=!1,t()};h.on(o.EventType.CLICK,a)}else setTimeout((()=>{r.destroyMask(this._maskNode),this._maskNode=null,i.active=!1,t()}),2e3)}else console.warn("[Ocean_FreeGameManager] FreeGame 弹窗节点未找到"),r.destroyMask(this._maskNode),this._maskNode=null,t()}))}enterFreeGameMode(e){this._isActive=!0,this._currentSpin=0,this._totalSpins=e,this._totalWinAmount=0,console.log(`[Ocean_FreeGameManager] 进入 FreeGame 模式，总次数: ${e}`)}startFreeGameMode(){console.log("[Ocean_FreeGameManager] 开始 FreeGame 模式");const e=this.gameMain.propertyNode.props_normal;e&&e.isValid&&(e.active=!1);const t=this.gameMain.propertyNode.props_freegame;t&&t.isValid&&(t.active=!0),this.updateUI(),this.gameMain.propertyNode.props_spin_btn?.isValid&&(this.gameMain.propertyNode.props_spin_btn.interactable=!1),setTimeout((()=>{this.freeGameLoop()}),1e3)}updateUI(){const e=this.gameMain.propertyNode.props_jackpot_freegame_count;e&&e.isValid&&r.setNumberSprite(e,this._currentSpin);const t=this.gameMain.propertyNode.props_jackpot_freegame_total;t&&t.isValid&&r.setNumberSprite(t,this._totalSpins)}async freeGameLoop(){for(console.log("[Ocean_FreeGameManager] 开始 FreeGame 循环");this._currentSpin<this._totalSpins;){this._currentSpin++,console.log(`[Ocean_FreeGameManager] 第 ${this._currentSpin}/${this._totalSpins} 次 FreeSpin`),this.updateUI();const{results:e,pearlValues:t,winAmount:n}=this.generateMockResults();await this.performSpin(e,t),this._totalWinAmount+=n,console.log(`[Ocean_FreeGameManager] 本次赢钱: ${n}，累计: ${this._totalWinAmount}`),await this.delay(1500)}await this.settleFreeGame()}generateMockResults(){const e=[],t=[],n=i.gameConfig.constants.iconNames,a=i.gameConfig.constants.pearlSymbol,s=n.filter((e=>e!==a&&"ocean_icon_scatter"!==e));for(let n=0;n<5;n++){const n=[],a=[];for(let e=0;e<3;e++){const e=s[Math.floor(Math.random()*s.length)];n.push(e),a.push(null)}e.push(n),t.push(a)}return{results:e,pearlValues:t,winAmount:Math.random()<.5?Math.floor(100*Math.random())+10:0}}performSpin(e,t){return new Promise((n=>{console.log("[Ocean_FreeGameManager] 执行 spin");const a=this.gameMain.wheels;if(!a||0===a.length)return console.warn("[Ocean_FreeGameManager] 轮子未初始化"),void setTimeout(n,1e3);a.forEach((e=>{e.startSpin()}));setTimeout((()=>{let s=0;const o=a.length;a.forEach(((a,i)=>{setTimeout((()=>{const r=e[i]||[],c=t[i]?.map((e=>e??0))||[];a.stopSpin(r,c,(()=>{s++,s>=o&&setTimeout(n,500)}))}),200*i)}))}),2e3)}))}async settleFreeGame(){console.log(`[Ocean_FreeGameManager] FreeGame 结算，总赢钱: ${this._totalWinAmount}`),await this.showEndPopup(),this.exitFreeGameMode()}showEndPopup(){return new Promise((e=>{console.log("[Ocean_FreeGameManager] 显示 FreeGame 结算弹窗");const t=this.gameMain.propertyNode.props_freegame_popup;if(t&&t.isValid){t.active=!0,t.setSiblingIndex(999),this._maskNode=r.createMask(t,0,180);const i=t.getChildByPath("content/center_bg/props_freegame_count_amount");if(i){const e=i.getComponent(n);e&&(e.string=this._totalWinAmount.toLocaleString())}const c=t.getChildByPath("content/in_freespins");if(c){c.active=!0;const e=c.getChildByName("props_freegame_count");e&&r.setNumberSprite(e,this._totalSpins)}const l=t.getChildByPath("content/freespins_en");l&&(l.active=!1);const p=t.getChildByName("content");p&&(p.setScale(0,0,0),a(p).to(.5,{scale:new s(1.1,1.1,1.1)},{easing:"cubicOut"}).to(.2,{scale:new s(1,1,1)},{easing:"cubicIn"}).start());const m=t.getChildByPath("content/common_sale_button_green");if(m){const a=m.getComponentInChildren(n);a&&(a.string="COLLECT");const s=()=>{m.off(o.EventType.CLICK,s),r.destroyMask(this._maskNode),this._maskNode=null,t.active=!1,e()};m.on(o.EventType.CLICK,s)}else setTimeout((()=>{r.destroyMask(this._maskNode),this._maskNode=null,t.active=!1,e()}),2e3)}else r.destroyMask(this._maskNode),this._maskNode=null,e()}))}exitFreeGameMode(){console.log("[Ocean_FreeGameManager] 退出 FreeGame 模式"),this._isActive=!1,this._currentSpin=0,this._totalSpins=0;const e=this.gameMain.propertyNode.props_freegame;e&&e.isValid&&(e.active=!1);const t=this.gameMain.propertyNode.props_normal;t&&t.isValid&&(t.active=!0),this.gameMain.propertyNode.props_spin_btn?.isValid&&(this.gameMain.propertyNode.props_spin_btn.interactable=!0)}delay(e){return new Promise((t=>setTimeout(t,e)))}}),t._RF.pop()}}}));

System.register("chunks:///_virtual/Ocean_GameMain.ts",["cc","./BaseComponent.ts","./Ocean_SlotReel.ts","./Ocean_ReelEffect.ts","./Ocean_StickySpinManager.ts","./Ocean_FreeGameManager.ts","./config21.ts","./index86.ts","./spriteDefine21.ts"],(function(e){var n,t,i,s,o,p,r,a,c,l,_,h,g;return{setters:[function(e){n=e.cclegacy,t=e.Button,i=e.Label,s=e.Node,o=e._decorator},function(e){p=e.BaseComponent},function(e){r=e.Ocean_SlotReel},function(e){a=e.Ocean_ReelEffect},function(e){c=e.Ocean_StickySpinManager},function(e){l=e.Ocean_FreeGameManager},function(e){_=e.default},function(e){h=e.sourceManageSeletor},function(e){g=e.SpritePathDefine}],execute:function(){var y;n._RF.push({},"76356j1kHhMM5iMVU5gXP6u","Ocean_GameMain",void 0);const{ccclass:d,property:u}=o;e("Ocean_GameMain",d("Ocean_GameMain")(y=class extends p{constructor(...e){super(...e),this.wheels=[],this._pearlCollectionScheduled=!1,this._collectedPearlCount=0,this._collectedPearls=[],this.stickySpinManager=null,this.freeGameManager=null,this.propertyNode={props_spin_btn:new t,props_balance_label:new i,props_win_label:new i,props_back_btn:new s,props_pearl_collector:new s,props_pearl_progress:new s,props_normal:new s,props_stickyspin:new s,props_stickyspin_start:new s,props_stickyspin_end:new s,props_stickyspin_count:new s,props_stickyspin_remaining_prefix:new s,props_stickyspin_pearl_count:new s,props_stickyspin_win_value:new s,props_stickyspin_popup:new s,props_stickyspin_popup_btn:new s,props_freegame:new s,props_jackpot_freegame_count:new s,props_jackpot_freegame_total:new s,props_freegame_popup:new s},this.props={balance:0,betAmount:200,winAmount:0,spinResults:[],isSpinning:!1,turboMode:0,autoSpin:!1,winningLines:[],pearlValues:[]},this.events={onSpin:()=>{},onAutoSpin:()=>{},onTurbo:()=>{},onBetChange:e=>{},onSpinComplete:()=>{}},this._paylineLoopTimer=0,this._currentPaylineIndex=0,this._isPlayingPaylines=!1}async loadAssets(){a.preloadResources();const e=new Map,n=h();if(n)for(const t in g){const i=g[t],s=n.getFile(i);s&&s.source&&e.set(t,s.source)}return e}initState(){return{}}bindEvent(){this.propertyNode.props_spin_btn&&this.propertyNode.props_spin_btn.node.on(s.EventType.TOUCH_END,(()=>{this.events.onSpin()})),this.propertyNode.props_back_btn&&this.propertyNode.props_back_btn.on(s.EventType.TOUCH_END,(()=>{window.HALL_GLOBAL&&window.HALL_GLOBAL.closeSubGame&&window.HALL_GLOBAL.closeSubGame()}))}bindUI(){const e=this.node.getChildByPath("control/spin");e&&(this.propertyNode.props_spin_btn=e.getComponent(t));const n=this.node.getChildByPath("control/balance");n&&(this.propertyNode.props_balance_label=n.getComponent(i));const s=this.node.getChildByPath("control/win");s&&(this.propertyNode.props_win_label=s.getComponent(i));const o=this.node.getChildByPath("jackpot/collect");o&&(this.propertyNode.props_normal=o);const p=this.node.getChildByPath("jackpot/props_stickyspin");if(p){this.propertyNode.props_stickyspin=p;const e=p.getChildByPath("content/props_stickyspin_start");e&&(this.propertyNode.props_stickyspin_start=e);const n=p.getChildByPath("content/props_stickyspin_start/props_stickyspin_end");n&&(this.propertyNode.props_stickyspin_end=n);const t=p.getChildByPath("content/props_stickyspin_start/props_stickyspin_remaining");if(t)this.propertyNode.props_stickyspin_count=t,console.log("[Ocean_GameMain] 找到 props_stickyspin_remaining 节点");else{const e=p.getChildByPath("content/props_stickyspin_remaining");e&&(this.propertyNode.props_stickyspin_count=e)}const i=p.getChildByPath("content/props_stickyspin_start/props_stickyspin_remaining_prefix");if(i)this.propertyNode.props_stickyspin_remaining_prefix=i,console.log("[Ocean_GameMain] 找到 props_stickyspin_remaining_prefix 节点");else{const e=p.getChildByPath("content/props_stickyspin_remaining_prefix");e&&(this.propertyNode.props_stickyspin_remaining_prefix=e)}const s=p.getChildByPath("content/ocean_icon_pearl/props_stickyspin_pearl_count");s?(this.propertyNode.props_stickyspin_pearl_count=s,console.log("[Ocean_GameMain] 找到 props_stickyspin_pearl_count 节点")):console.warn("[Ocean_GameMain] 未找到 props_stickyspin_pearl_count 节点");const o=p.getChildByPath("content/props_stickyspin_start/props_stickyspin_end/props_stickyspin_win_value");o&&(this.propertyNode.props_stickyspin_win_value=o)}const h=this.node.getChildByPath("popups/props_stickyspin_popup");if(h){this.propertyNode.props_stickyspin_popup=h,h.active=!1;const e=h.getChildByPath("content/props_stickyspin_popup_btn");e&&(this.propertyNode.props_stickyspin_popup_btn=e)}console.log("[Ocean_GameMain] StickySpin 节点绑定:",{popup:!!this.propertyNode.props_stickyspin_popup,btn:!!this.propertyNode.props_stickyspin_popup_btn,main:!!this.propertyNode.props_stickyspin});const g=this.node.getChildByPath("jackpot/props_freegame");if(g){this.propertyNode.props_freegame=g,g.active=!1;const e=g.getChildByPath("content/bg/props_jackpot_freegame_count");e&&(this.propertyNode.props_jackpot_freegame_count=e);const n=g.getChildByPath("content/bg/props_jackpot_freegame_total");n&&(this.propertyNode.props_jackpot_freegame_total=n)}this.propertyNode.props_freegame_popup.active=!1,console.log("[Ocean_GameMain] FreeGame 节点绑定:",{freegame:!!this.propertyNode.props_freegame,popup:!!this.propertyNode.props_freegame_popup}),this.stickySpinManager=new c(this),console.log("[Ocean_GameMain] StickySpinManager 已初始化"),this.freeGameManager=new l(this),console.log("[Ocean_GameMain] FreeGameManager 已初始化");_.gameConfig.constants.iconNames.forEach((e=>{})),this.wheels=[];const y=["container/reels/reel_0","container/reels/reel_1","container/reels/reel_2","container/reels/reel_3","container/reels/reel_4","container/reels/reel_freegame"],d=this.getInitialSymbols();this.loadAssets().then((e=>{y.forEach(((n,t)=>{const i=this.node.getChildByPath(n);if(i){let s=i.getComponent(r);s||(s=i.addComponent(r)),n.includes("reel_freegame")&&(s.isBigSymbolReel=!0);const o=t<d.length?d[t]:void 0;s.init(e,s.isBigSymbolReel,o),s.getComponent(a)||s.addComponent(a),this.wheels.push(s)}else console.warn(`Wheel node not found: ${n}`)}))}))}getInitialSymbols(){const e="ocean_icon_starfish",n="ocean_icon_scatter";return[[e,n,e],[e,n,e],[e,n,e],[e,n,e],[e,n,e]]}useProps(e,n){"balance"===e&&this.propertyNode.props_balance_label&&(this.propertyNode.props_balance_label.string=n.cur.toFixed(2)),"winAmount"===e&&this.propertyNode.props_win_label&&(this.propertyNode.props_win_label.string=n.cur.toFixed(2)),"isSpinning"===e&&(this.propertyNode.props_spin_btn&&(this.propertyNode.props_spin_btn.interactable=!n.cur),n.cur&&!n.pre&&this.startSpin()),"spinResults"===e&&n.cur&&n.cur.length>0&&this.props.isSpinning&&this.stopSpin(n.cur),"winningLines"===e&&(n.cur&&n.cur.length>0?this.startPaylineLoop():this.stopPaylineLoop())}startSpin(){this.stopPaylineLoop(),this._pearlCollectionScheduled=!1;this.wheels.slice(0,5).forEach((e=>{e.stopWinEffect(),e.startSpin()}))}stopSpin(e){let n=0;const t=this.props.pearlValues||[],i=this.wheels.slice(0,5);i.forEach(((s,o)=>{const p=3*o,r=p+3,a=e.slice(p,r),c=t.slice(p,r);this.scheduleOnce((()=>{s.stopSpin(a,c,(()=>{n++,n===i.length&&this.scheduleOnce((()=>{this._playSpecialEffects(),this.scheduleOnce((()=>{this.events.onSpinComplete&&this.events.onSpinComplete()}),.4)}),0)}))}),.2*o)}))}_playSpecialEffects(){const e=this.props.pearlValues;if(this.checkAndTriggerStickySpin())return;if(this.checkAndTriggerFreeGame())return;e&&e.length>0&&this.wheels.forEach(((n,t)=>{n.getVisibleSymbols().forEach(((i,s)=>{if("ocean_icon_pearl"===i){const i=e[3*t+s];i>0&&n.showPearlVisuals(s,i)}}))})),this._schedulePearlCollection();const n=this.props.winningLines;if(console.log(`[Ocean_GameMain] _playSpecialEffects: winningLines = ${JSON.stringify(n)}`),n&&n.length>0){console.log(`[Ocean_GameMain] _playSpecialEffects: Checking for Mermaid symbols (has ${n.length} winning lines).`);const e=new Set;n.forEach((n=>{n.forEach((n=>{e.add(`${n.col},${n.row}`)}))})),console.log(`[Ocean_GameMain] winningPositions: ${Array.from(e).join(", ")}`),this.wheels.forEach(((n,t)=>{const i=n.getVisibleSymbols();let s=0;for(;s<i.length;)if("ocean_icon_mermaid_1"===i[s]){const o=s;let p=0,r=!1;for(;s<i.length&&"ocean_icon_mermaid_1"===i[s];){const n=`${t},${s}`;e.has(n)&&(r=!0),p++,s++}r?(console.log(`[Ocean_GameMain] Playing Mermaid animation: Col=${t}, Start=${o}, Count=${p}`),n.playMermaidAnimation(p,o)):console.log(`[Ocean_GameMain] Skipping Mermaid (not on winning line): Col=${t}, Start=${o}, Count=${p}`)}else s++}))}else console.log("[Ocean_GameMain] No winning lines, skipping Mermaid animation.");let t=0;const i=[];this.wheels.forEach(((e,n)=>{e.getVisibleSymbols().forEach(((e,s)=>{"ocean_icon_scatter"===e&&(t++,i.push({col:n,row:s}))}))})),t>0?(console.log(`[Ocean_GameMain] Scatter found! Count: ${t}. Positions: ${JSON.stringify(i)}`),i.forEach((e=>{this.wheels[e.col].playScatterAnimation(e.row,t)}))):console.log("[Ocean_GameMain] No Scatters found.")}startPaylineLoop(){this.props.winningLines&&0!==this.props.winningLines.length&&(this._isPlayingPaylines=!0,this._currentPaylineIndex=0,this.playCurrentPayline())}playCurrentPayline(){if(!this._isPlayingPaylines||!this.props.winningLines||0===this.props.winningLines.length)return;this.stopAllPaylineEffects();this.props.winningLines[this._currentPaylineIndex].forEach((e=>{const n=this.wheels[e.col];n&&n.playWinEffect(e.row)})),this._currentPaylineIndex=(this._currentPaylineIndex+1)%this.props.winningLines.length,this._paylineLoopTimer=setTimeout((()=>this.playCurrentPayline()),2e3)}stopAllPaylineEffects(){this.wheels.forEach((e=>{e&&e.stopPaylineEffectsOnly()}))}stopPaylineLoop(){this._paylineLoopTimer&&(clearTimeout(this._paylineLoopTimer),this._paylineLoopTimer=0),this._isPlayingPaylines=!1,this._currentPaylineIndex=0,this.stopAllPaylineEffects()}_schedulePearlCollection(){if(this._pearlCollectionScheduled)return;const e=this.props.pearlValues;if(!e||0===e.length)return;let n=!1;this.wheels.forEach(((t,i)=>{t.getVisibleSymbols().forEach(((t,s)=>{"ocean_icon_pearl"===t&&e[3*i+s]>0&&(n=!0)}))})),n&&(this._pearlCollectionScheduled=!0,setTimeout((()=>{this&&this.node&&this.node.isValid&&this.collectPearls()}),300))}collectPearls(e,n){const t=this.props.pearlValues;if(!t||0===t.length)return void(n&&n(0));const i=e||this.propertyNode.props_pearl_collector;if(!i||!i.isValid)return console.warn("[Ocean_GameMain] collectPearls: No valid collect target"),void(n&&n(0));let s=0,o=0,p=0;if(this.wheels.forEach(((e,n)=>{e.getVisibleSymbols().forEach(((e,i)=>{"ocean_icon_pearl"===e&&t[3*n+i]>0&&p++}))})),0===p)return void(n&&n(0));console.log(`[Ocean_GameMain] collectPearls: Collecting ${p} pearls`);let r=0;this.wheels.forEach(((e,a)=>{e.getVisibleSymbols().forEach(((c,l)=>{if("ocean_icon_pearl"===c){const c=t[3*a+l];if(c>0){const t=0*r;r++,console.log(`[Ocean_GameMain] Scheduling pearl collection: col=${a}, row=${l}, value=${c}, delay=${t}ms`),setTimeout((()=>{e&&e.node&&e.node.isValid&&e.playPearlCollectAnimation(l,c,i,(e=>{s+=e,o++,this._collectedPearlCount++,this._collectedPearls.push({col:a,row:l,value:e}),this._updatePearlProgress(),o>=p&&n&&n(s)}))}),t)}}}))}))}_updatePearlProgress(){const e=this.propertyNode.props_pearl_progress;if(!e||!e.isValid)return;const n=_.gameConfig.pearlCollect.goalValue,t=Math.min(this._collectedPearlCount/n,1);e.setScale(t,1,1)}resetPearlProgress(){this._collectedPearlCount=0,this._collectedPearls=[],this._updatePearlProgress()}checkAndTriggerStickySpin(){if(this.stickySpinManager?.isActive)return!1;if(this.freeGameManager?.isActive)return!1;const e=this.props.pearlValues;if(!e||0===e.length)return!1;const n=[];this.wheels.forEach(((t,i)=>{t.getVisibleSymbols().forEach(((t,s)=>{const o=3*i+s;if(t===_.gameConfig.constants.pearlSymbol){const t=e[o];t&&t>0&&n.push({col:i,row:s,value:t})}}))})),console.log(`[Ocean_GameMain] checkAndTriggerStickySpin: 检测到 ${n.length} 个珍珠`);const t=_.gameConfig.stickySpin.pearlCountToTrigger;return n.length>=t&&(console.log(`[Ocean_GameMain] 珍珠数量 ${n.length} >= ${t}，触发 StickySpin！`),this.propertyNode.props_spin_btn?.isValid&&(this.propertyNode.props_spin_btn.interactable=!1),this.stickySpinManager&&this.stickySpinManager.triggerStickySpin(n),!0)}checkAndTriggerFreeGame(){if(this.freeGameManager?.isActive)return!1;if(this.stickySpinManager?.isActive)return!1;let e=0;return this.wheels.forEach((n=>{n.getVisibleSymbols().forEach((n=>{"ocean_icon_scatter"===n&&e++}))})),console.log(`[Ocean_GameMain] checkAndTriggerFreeGame: 检测到 ${e} 个 Scatter`),e>=3&&(console.log(`[Ocean_GameMain] Scatter 数量 ${e} >= 3，触发 FreeGame！`),this.propertyNode.props_spin_btn?.isValid&&(this.propertyNode.props_spin_btn.interactable=!1),this.scheduleOnce((()=>{this.freeGameManager&&this.freeGameManager.triggerFreeGame(e)}),2),!0)}})||y);n._RF.pop()}}}));

System.register("chunks:///_virtual/Ocean_PaylineEffect.ts",["cc"],(function(e){var t,n,s,r,i;return{setters:[function(e){t=e.cclegacy,n=e.Component,s=e.Sprite,r=e.tween,i=e._decorator}],execute:function(){var a;t._RF.push({},"182edtVCQRMCopUTzJiSkpY","Ocean_PaylineEffect",void 0);const{ccclass:_,property:c}=i;e("Ocean_PaylineEffect",_("Ocean_PaylineEffect")(a=class extends n{constructor(...e){super(...e),this._sprite=null,this._frames=[],this._currentFrameIndex=0,this._tween=null}onLoad(){this._sprite=this.getComponent(s)}init(e){this._frames=e}play(e=!0){if(0===this._frames.length)return;this.stop(),this._currentFrameIndex=0,this._updateFrame();const t={index:0};this._tween=r(t).to(.05*this._frames.length,{index:this._frames.length-1},{onUpdate:e=>{const t=Math.floor(e.index);t!==this._currentFrameIndex&&(this._currentFrameIndex=t,this._updateFrame())}}).call((()=>{t.index=0,this._currentFrameIndex=0})).union(),e&&(this._tween=this._tween.repeatForever()),this._tween.start()}stop(){this._tween&&(this._tween.stop(),this._tween=null)}_updateFrame(){this._sprite&&this._frames[this._currentFrameIndex]&&(this._sprite.spriteFrame=this._frames[this._currentFrameIndex])}})||a);t._RF.pop()}}}));

System.register("chunks:///_virtual/Ocean_ReelEffect.ts",["cc","./Ocean_SlotReel.ts","./Ocean_PaylineEffect.ts","./config21.ts"],(function(e){var t,n,o,a,i,l,s,r,d,c,m,h,p,f,g,y,C,_;return{setters:[function(e){t=e.cclegacy,n=e._decorator,o=e.Component,a=e.assetManager,i=e.SpriteFrame,l=e.sp,s=e.Font,r=e.Tween,d=e.tween,c=e.Vec3,m=e.Node,h=e.UITransform,p=e.Sprite,f=e.Label,g=e.Mask},function(e){y=e.Ocean_SlotReel},function(e){C=e.Ocean_PaylineEffect},function(e){_=e.default}],execute:function(){var u,S;t._RF.push({},"89151W/Ce5EpLXAZ6OSac3f","Ocean_ReelEffect",void 0);const{ccclass:P,property:A}=n;e("Ocean_ReelEffect",P("Ocean_ReelEffect")(((S=class e extends o{constructor(...e){super(...e),this._reel=null}onLoad(){this._reel=this.getComponent(y),e.preloadResources()}static preloadResources(){e._isLoading||e._sharedFramesLoaded||e._loadSharedResources()}static _loadSharedResources(){if(e._isLoading||e._sharedFramesLoaded)return;e._isLoading=!0;const t=a.getBundle("ocean");if(!t)return void(e._isLoading=!1);e._sharedPaylineFrames=new Array(15),e._sharedFrameLoadCount=0;for(let n=1;n<=15;n++){const o=`ani/common_payline_tips3/common_payline_tips3_${n}/spriteFrame`;t.load(o,i,((t,a)=>{t?console.warn(`[Ocean] Failed to load payline frame: ${o}`,t):(e._sharedPaylineFrames[n-1]=a,e._sharedFrameLoadCount++,15===e._sharedFrameLoadCount&&(e._sharedFramesLoaded=!0,e._isLoading=!1,console.log("[Ocean] Successfully loaded 15 shared payline frames.")))}))}t.load(_.gameConfig.constants.pearlSpinePath,l.SkeletonData,((t,n)=>{t||(e._pearlSpineData=n,e._checkPearlResourcesLoaded(),console.log("[Ocean] Pearl spine preloaded."))})),t.load(_.gameConfig.constants.pearlFontPath,s,((t,n)=>{t||(e._pearlFont=n,e._checkPearlResourcesLoaded(),console.log("[Ocean] Pearl font preloaded."))}))}static _checkPearlResourcesLoaded(){e._pearlSpineData&&e._pearlFont&&(e._pearlResourcesLoaded=!0,console.log("[Ocean] All pearl resources preloaded."))}playEffect(e){if(!this._reel)return;const t=this._reel.bufferCount+e,n=this._reel.symbolContainer.children[t];n&&this._playPaylineEffect(n)}_playScaleAnimation(e,t=!0){r.stopAllByTarget(e),e._originalScale||(e._originalScale=e.scale.clone());const n=e._originalScale;e.setScale(n.x,n.y,n.z);const o=d(e).to(.3,{scale:new c(.85*n.x,.85*n.y,1)}).to(.3,{scale:n}).union();t&&o.repeatForever(),o.start()}_playSpineEffect(e,t){const n=e.children[0];n&&(n.active=!1);let o=e.getChildByName("SpineEffect");if(o){const e=o.getComponent(l.Skeleton);e&&e.skeletonData&&e.setAnimation(0,"move",!0)}else{o=new m("SpineEffect"),o.layer=e.layer,e.addChild(o),o.setPosition(0,0,0);const n=o.addComponent(l.Skeleton);let i=a.getBundle("ocean");i||(i=a.bundles.get("ocean")),i&&i.load(t,l.SkeletonData,((e,o)=>{e?console.error(`Failed to load spine: ${t}`,e):n&&n.isValid&&(n.skeletonData=o,n.node.setScale(.23,.23,1),n.setAnimation(0,"move",!0))}))}}_playBigSpineEffect(e,t){const n=e.children[0];n&&(n.active=!1);let o=e.getChildByName("ScatterBigSpine");if(o){const e=o.getComponent(l.Skeleton);e&&e.skeletonData&&e.setAnimation(0,"haitunda",!1)}else{o=new m("ScatterBigSpine"),o.layer=e.layer,e.addChild(o),o.setPosition(0,0,0);const n=o.addComponent(l.Skeleton);let i=a.getBundle("ocean");i||(i=a.bundles.get("ocean")),i&&i.load(t,l.SkeletonData,((e,o)=>{e?console.error(`Failed to load big scatter spine: ${t}`,e):n&&n.isValid&&(n.skeletonData=o,n.node.setPosition(0,25,0),n.node.setScale(.2,.2,1),n.setAnimation(0,"haitunda",!1))}))}}stopPaylineEffectsOnly(){if(this._reel)for(const e of this._reel.symbolContainer.children){const t=e.getComponentInChildren(C);t&&t.isValid&&(t.stop(),t.node.active=!1)}}stopAllEffects(){if(this._reel)for(const e of this._reel.symbolContainer.children){const t=e.getComponentInChildren(C);t&&t.isValid&&(t.stop(),t.node.active=!1);const n=e.getChildByName("SpineEffect");n&&n.destroy();const o=e.getChildByName("ScatterBigSpine");o&&o.destroy();const a=e.getChildByName("MermaidBackground");a&&a.destroy();const i=e.getChildByName("MermaidActiveHost");i&&i.destroy();const l=e.getChildByName("MermaidEffectHost");l&&l.destroy();const s=e.children[0];s&&(r.stopAllByTarget(s),s.active=!0,s._originalScale?s.setScale(s._originalScale):this._reel.restoreIconScale(s))}}_playPaylineEffect(t){let n=t.getComponentInChildren(C);if(n&&n.isValid)n.node.active=!0;else{const e=new m("PaylineEffect");e.layer=t.layer,t.addChild(e);const o=t.getComponent(h);let a=172,i=this._reel.symbolHeight;o&&(a=o.width,i=o.height);const l=a+10,s=i+20;e.addComponent(h).setContentSize(l,s);const r=e.addComponent(p);r.sizeMode=p.SizeMode.CUSTOM,r.trim=!1,n=e.addComponent(C),n.node.setPosition(0,0,0),this._reel.isBigSymbolReel?n.node.setScale(1,1,1):n.node.setScale(2,2,1)}e._sharedFramesLoaded&&e._sharedPaylineFrames.length>0?(n.init(e._sharedPaylineFrames),n.play(!0)):this.scheduleOnce((()=>{e._sharedFramesLoaded&&n&&n.isValid&&(n.init(e._sharedPaylineFrames),n.play(!0))}),.1)}showPearlVisuals(t,n){if(!this._reel)return;const o=this._reel.bufferCount,i=this._reel.symbolContainer.children[o+t];if(!i)return;let r=i.getChildByName("PearlEffectHost");r||(r=new m("PearlEffectHost"),r.layer=i.layer,i.addChild(r),r.setSiblingIndex(i.children.length-1)),r.removeAllChildren();const d=new m("PearlSpine");d.layer=i.layer;const c=d.addComponent(l.Skeleton);if(r.addChild(d),e._pearlSpineData)c.skeletonData=e._pearlSpineData,c.premultipliedAlpha=!1,d.setScale(.58,.6,1),d.setPosition(0,0,0),c.setAnimation(0,"move",!0);else{const e=a.getBundle("ocean");e&&e.load(_.gameConfig.constants.pearlSpinePath,l.SkeletonData,((e,t)=>{!e&&c&&c.isValid&&(c.skeletonData=t,c.premultipliedAlpha=!1,d.setScale(.58,.6,1),d.setPosition(0,0,0),c.setAnimation(0,"move",!0))}))}const h=new m("PearlLabel");h.layer=i.layer;const p=h.addComponent(f);if(r.addChild(h),e._pearlFont)p.font=e._pearlFont,p.string=n.toString(),p.node.setPosition(0,-10,0),p.fontSize=18,p.lineHeight=18;else{const e=a.getBundle("ocean");e&&e.load(_.gameConfig.constants.pearlFontPath,s,((e,t)=>{!e&&p&&p.isValid&&(p.font=t,p.string=n.toString(),p.node.setPosition(0,-10,0),p.fontSize=18,p.lineHeight=18)}))}}playPearlCollectAnimation(e,t,n,o){if(!this._reel)return;const a=this._reel.bufferCount,i=this._reel.symbolContainer.children[a+e];if(!i)return;const l=i.getChildByName("PearlEffectHost");l&&n&&this._playPearlFlyAnimation(l,n,t,o)}_playPearlFlyAnimation(e,t,n,o){if(!(e&&e.isValid&&t&&t.isValid))return void(o&&o(n));let l=this.node,s=[];for(;l&&"OceanView"!==l.name;)s.push(l.name),l=l.parent;if(!l){for(l=e.parent;l&&!l.getComponent(h);)l=l.parent;l||(l=this.node)}const r=l.getComponent(h);if(!r)return void(o&&o(n));const d=new m("FlyingPearl");d.layer=1<<25,l.addChild(d);try{d.setSiblingIndex(l.children.length-1);const s=d.addComponent(p);(d.getComponent(h)||d.addComponent(h)).setContentSize(60,60);const m=.8,f=.2;d.setScale(m,m,1);const g=a.getBundle("ocean");g&&g.load("texture/oceanicon_small/ocean_icon_pearl/spriteFrame",i,((e,t)=>{d&&d.isValid&&!e&&t&&(s.spriteFrame=t)}));const y=e.getWorldPosition(),C=t.getWorldPosition(),_=r.convertToNodeSpaceAR(y),u=r.convertToNodeSpaceAR(C);d.setPosition(_);const S=_.x+.5*(u.x-_.x),P=Math.max(_.y,u.y)+100,A=new c(S,P,0),F=.8;let v=0;const E=e=>{if(!d||!d.isValid)return void this.unschedule(E);v+=e;const t=Math.min(v/F,1),a=1-t,i=a*a*_.x+2*a*t*A.x+t*t*u.x,l=a*a*_.y+2*a*t*A.y+t*t*u.y;d.setPosition(i,l,0);const s=m+(f-m)*t;d.setScale(s,s,1),t>=1&&(this.unschedule(E),d.destroy(),o&&o(n))};this.schedule(E,0)}catch(e){d&&d.isValid&&d.destroy(),o&&o(n)}}static cleanupFlyingPearls(e){if(!e)return;e.children.filter((e=>"FlyingPearl"===e.name)).forEach((e=>{r.stopAllByTarget(e),e.destroy()}))}playMermaidAnimation(e,t){if(!this._reel)return;const n=this._reel.bufferCount,o=this._reel.symbolContainer.children[n+t];if(!o)return;for(let o=0;o<e;o++){const e=this._reel.symbolContainer.children[n+t+o];if(e){const t=e.children[0];t&&(t.active=!1)}}this._addMermaidBackground(t,e,n),this._addMermaidActiveAnimation(t,e,n);let i=o.getChildByName("MermaidEffectHost");i?i.removeAllChildren():(i=new m("MermaidEffectHost"),i.layer=o.layer,o.addChild(i)),i.setSiblingIndex(o.children.length-1),console.log(`[OceanReelEffect] playMermaidAnimation: wildCount=${e}, startIndex=${t}`);try{const t=new m("Viewport");t.layer=o.layer;const n=t.addComponent(h);console.log("[OceanReelEffect] viewportNode created, viewportTransform="+(n?"ok":"null"));t.addComponent(g).type=g.Type.GRAPHICS_RECT,console.log("[OceanReelEffect] Mask added"),i.addChild(t),console.log("[OceanReelEffect] viewportNode added to effectHost");const s=new m("MermaidSpine");s.layer=o.layer;const r=s.addComponent(l.Skeleton);t.addChild(s),console.log("[OceanReelEffect] mermaidSpineNode added to viewport");let d=a.getBundle("ocean");d||(d=a.bundles.get("ocean")),console.log(`[OceanReelEffect] playMermaidAnimation: bundle=${d?"found":"NOT FOUND"}, path=${_.gameConfig.constants.mermaidSpineFullPath}`),d&&d.load(_.gameConfig.constants.mermaidSpineFullPath,l.SkeletonData,((t,a)=>{if(console.log(`[OceanReelEffect] Spine load result: err=${t?t.message:"none"}, skeletonData=${a?"loaded":"null"}`),t)console.error(`[OceanReelEffect] Failed to load mermaid spine: ${_.gameConfig.constants.mermaidSpineFullPath}`,t);else if(r&&r.isValid){r.skeletonData=a;const t=o.getComponent(h)?.width??172,l=this._reel.symbolHeight,d=this._reel.elementSpacing;r.node.setScale(.55,.75,1),1===e?(n.setContentSize(t,l),i.setPosition(0,0,0),s.setPosition(0,-180,0)):2===e?(n.setContentSize(t,2*l+d),i.setPosition(0,-(l+d)/2,0),s.setPosition(0,-120,0)):e>=3&&(n.setContentSize(t,3*l+2*d),i.setPosition(0,-(l+d),0),s.setPosition(0,-60,0)),console.log('[OceanReelEffect] Setting animation "move" on spine, loop=true'),r.setAnimation(0,"move",!0),console.log("[OceanReelEffect] Animation set successfully")}}))}catch(e){console.error("[OceanReelEffect] playMermaidAnimation error:",e)}}_addMermaidBackground(e,t,n){const o=this._reel.symbolContainer.children[n+e];if(!o)return;let l=o.getChildByName("MermaidBackground");if(!l){l=new m("MermaidBackground"),l.layer=o.layer,o.addChild(l),l.addComponent(h);const e=l.addComponent(p);e.sizeMode=p.SizeMode.CUSTOM,e.trim=!1,l.setSiblingIndex(0)}const s=l.getComponent(h),r=l.getComponent(p),d=o.getComponent(h)?.width??172,c=t*this._reel.symbolHeight+Math.max(0,t-1)*this._reel.elementSpacing;s&&s.setContentSize(d,c),l.setPosition(-2,t>=2?-62*(t-1):-2,0);const f=a.getBundle("ocean");f&&r&&!r.spriteFrame&&f.load(_.gameConfig.constants.mermaidBgPath,i,((e,t)=>{!e&&r&&r.isValid&&(r.spriteFrame=t)}))}_addMermaidActiveAnimation(e,t,n){const o=this._reel.symbolContainer.children[n+e];if(!o)return;const i=o.getComponent(h)?.width??172;let s=o.getChildByName("MermaidActiveHost");s||(s=new m("MermaidActiveHost"),s.layer=o.layer,o.addChild(s),s.setSiblingIndex(1)),s.removeAllChildren();const r=new m("ActiveViewport");r.layer=o.layer;const d=r.addComponent(h);r.addComponent(g).type=g.Type.GRAPHICS_RECT,s.addChild(r);const c=new m("ActiveSpine");c.layer=o.layer;const p=c.addComponent(l.Skeleton);r.addChild(c);const f=a.getBundle("ocean");f&&f.load(_.gameConfig.constants.mermaidActiveSpinePath,l.SkeletonData,((e,n)=>{if(!e&&p&&p.isValid){p.skeletonData=n,p.premultipliedAlpha=!1,c.setScale(.55,.75,1);const e=this._reel.symbolHeight,o=this._reel.elementSpacing,a=e+o;1===t?(d.setContentSize(i,e),s.setPosition(0,0,0),c.setPosition(0,0,0)):2===t?(d.setContentSize(i,2*e+o),s.setPosition(0,-a/2,0),c.setPosition(0,0,0)):t>=3&&(d.setContentSize(i,3*e+2*o),s.setPosition(0,-a,0),c.setPosition(0,0,0)),p.setAnimation(0,"move",!0)}}))}playScatterAnimation(e,t){if(!this._reel)return;const n=this._reel.bufferCount,o=this._reel.symbolContainer.children[n+e];if(o)if(t>=3){const e=_.gameConfig.constants.scatterBigSpinePath;e&&this._playBigSpineEffect(o,e)}else{const e=o.children[0];e&&this._playScaleAnimation(e,!1)}}})._sharedPaylineFrames=[],S._sharedFramesLoaded=!1,S._sharedFrameLoadCount=0,S._isLoading=!1,S._pearlSpineData=null,S._pearlFont=null,S._pearlResourcesLoaded=!1,u=S))||u);t._RF.pop()}}}));

System.register("chunks:///_virtual/Ocean_SlotReel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./config21.ts","./Ocean_ReelEffect.ts"],(function(t){var e,i,n,o,s,l,a,r,h,c;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){n=t.cclegacy,o=t.Node,s=t._decorator,l=t.Component,a=t.UITransform,r=t.Sprite},function(t){h=t.default},function(t){c=t.Ocean_ReelEffect}],execute:function(){var m,p,_,u,b,S,d,C,y;n._RF.push({},"a4e70Iz+mFGjq8jLS3HplVJ","Ocean_SlotReel",void 0);const{ccclass:g,property:f}=s;var I=function(t){return t[t.IDLE=0]="IDLE",t[t.SPINNING=1]="SPINNING",t[t.STOPPING=2]="STOPPING",t}(I||{});t("Ocean_SlotReel",(m=g("Ocean_SlotReel"),p=f(o),m((b=e((u=class extends l{constructor(...t){super(...t),i(this,"symbolContainer",b,this),i(this,"symbolHeight",S,this),i(this,"elementSpacing",d,this),i(this,"maxSpeed",C,this),i(this,"isBigSymbolReel",y,this),this._spriteFrameMap=new Map,this._spinState=I.IDLE,this._currentSpeed=0,this._visibleCount=3,this._bufferCount=5,this._startY=0,this._loopHeight=0,this._stopCallback=null}onLoad(){this.symbolContainer||(this.symbolContainer=this.node.getChildByName("symbol_container")||this.node),this.symbolHeight=h.gameConfig.constants.symbolHeight,this.elementSpacing=h.gameConfig.constants.symbolSpacing}get bufferCount(){return this._bufferCount}restoreIconScale(t){this._updateIconScale(t.name,t)}init(t,e=!1,i){if(this._spriteFrameMap=t,this.isBigSymbolReel=e,this.symbolContainer||(this.symbolContainer=this.node.getChildByName("symbol_container")||this.node),!this.symbolContainer)return void console.warn("[Ocean_SlotReel] symbolContainer 未找到");this.symbolHeight=h.gameConfig.constants.symbolHeight,this.elementSpacing=h.gameConfig.constants.symbolSpacing,this.isBigSymbolReel&&(this._visibleCount=1);const n=this.symbolContainer.getComponent(a);n&&n.setContentSize(172,750),this._generateInitialSymbols(i)}resetToInitial(t){this._spinState=I.IDLE,this._currentSpeed=0,this._generateInitialSymbols(t)}startSpin(){if(this._spinState!==I.IDLE)return;const t=this.getComponent(c);t&&t.stopAllEffects(),this._spinState=I.SPINNING,this._currentSpeed=this.maxSpeed}_replaceResultSymbols(t,e=[]){if(!this.symbolContainer||0===t.length)return;const i=this._bufferCount;for(let n=0;n<this._visibleCount&&!(n>=t.length);n++){const s=t[n],l=i+n,h=this.symbolContainer.children[l];if(h){h.name=`container_${s}`;let t=h.children[0];t||(t=new o(s),h.addChild(t)),t.name=s;let i=t.getComponent(r);i||(i=t.addComponent(r)),this._spriteFrameMap.has(s)&&(i.spriteFrame=this._spriteFrameMap.get(s),i.sizeMode=r.SizeMode.CUSTOM,i.trim=!0);const l=t.getComponent(a);if(l){const t=h.getComponent(a);t&&l.setContentSize(t.width,this.symbolHeight-2)}this._updateIconScale(s,t),"ocean_icon_pearl"===s&&e[n]>0&&this.showPearlVisuals(n,e[n])}}}stopSpin(t,e=[],i){if(console.log(`[OceanSlotReel] stopSpin called. State: ${this._spinState}, Results: ${t.length}, _startY: ${this._startY}`),this._spinState!==I.SPINNING)return console.warn("[OceanSlotReel] stopSpin ignored. Not SPINNING."),void(i&&i());this._spinState=I.STOPPING,this._stopCallback=i||null,this._replaceResultSymbols(t,e),this.symbolContainer.setPosition(0,this._startY,0),console.log(`[OceanSlotReel] Snapped to Y: ${this._startY}`),this._onSpinFinished()}playWinEffect(t){const e=this.getComponent(c);e&&e.playEffect(t)}stopWinEffect(){const t=this.getComponent(c);t&&t.stopAllEffects()}getVisibleSymbols(){const t=[],e=this._bufferCount;for(let i=0;i<this._visibleCount;i++){const n=this.symbolContainer.children[e+i];n&&n.children.length>0?t.push(n.children[0].name):t.push("")}return t}showPearlVisuals(t,e){const i=this.getComponent(c);i&&i.showPearlVisuals(t,e)}playMermaidAnimation(t,e){const i=this.getComponent(c);i&&i.playMermaidAnimation(t,e)}playScatterAnimation(t,e){const i=this.getComponent(c);i&&i.playScatterAnimation(t,e)}stopPaylineEffectsOnly(){const t=this.getComponent(c);t&&t.stopPaylineEffectsOnly()}playPearlCollectAnimation(t,e,i,n){const o=this.getComponent(c);o&&o.playPearlCollectAnimation(t,e,i,n)}_generateInitialSymbols(t){this.symbolContainer.removeAllChildren();const e=this._visibleCount+2*this._bufferCount;for(let i=0;i<e;i++){let e;const n=i-this._bufferCount;e=t&&n>=0&&n<t.length?this._createSpecificIcon(t[n]):this._createRandomIcon(),this.symbolContainer.addChild(e)}this._layoutChildren(),this._loopHeight=(this.symbolHeight+this.elementSpacing)*this._visibleCount;const i=this._bufferCount,n=this.symbolContainer.children[i];if(n){const t=this.symbolHeight+this.elementSpacing;this._startY=-n.position.y,this.isBigSymbolReel||(this._startY+=t),this.symbolContainer.setPosition(0,this._startY,0)}}_createSpecificIcon(t){const e=new o(t);e.addComponent(a).setContentSize(172,123);const i=e.addComponent(r);i.sizeMode=r.SizeMode.CUSTOM,i.trim=!1;const n=this._spriteFrameMap.get(t);return n&&(i.spriteFrame=n),this._updateIconScale(t,e),e}update(t){if(this._spinState!==I.SPINNING)return;let e=this.symbolContainer.position.y-this._currentSpeed*t;if(e<this._startY-this._loopHeight){const t=this.symbolContainer.children[this.symbolContainer.children.length-1];if(t){t.removeFromParent();const e=this._createRandomIcon();this.symbolContainer.insertChild(e,0),this._layoutChildren()}e+=this.symbolHeight+this.elementSpacing}this.symbolContainer.setPosition(0,e,0)}_updateIconScale(t,e){const i=["common_icon_9","common_icon_10","common_icon_j","common_icon_q","common_icon_k","ocean_icon_starfish","ocean_icon_treasurebox","ocean_icon_tropicalfish","ocean_icon_oceanturtle"];this.isBigSymbolReel?e.setScale(.3,.8,1):"ocean_icon_pearl"===t?e.setScale(.75,.9,1):-1!==i.indexOf(t)?e.setScale(.75,.75,1):e.setScale(1,1,1)}_createRandomIcon(){const t=h.gameConfig.constants.iconNames,e=t[Math.floor(Math.random()*t.length)];return this._createIconNode(e)}_createIconNode(t){const e=new o(`container_${t}`);e.layer=this.node.layer;let i=172,n=this.symbolHeight;if(this.symbolContainer){const t=this.symbolContainer.getComponent(a);i=t&&t.width>0?t.width:this.isBigSymbolReel?514:172}e.addComponent(a).setContentSize(i,n);const s=new o(t);s.layer=this.node.layer;const l=i,h=this.symbolHeight-2;s.addComponent(a).setContentSize(l,h);const c=s.addComponent(r);return c.sizeMode=r.SizeMode.CUSTOM,c.trim=!0,this._spriteFrameMap.has(t)&&(c.spriteFrame=this._spriteFrameMap.get(t)),this._updateIconScale(t,s),e.addChild(s),s.setPosition(0,0,0),e}_layoutChildren(){let t=0;for(let e=0;e<this.symbolContainer.children.length;e++){this.symbolContainer.children[e].setPosition(0,t,0),t-=this.symbolHeight+this.elementSpacing}}_onSpinFinished(){this._spinState=I.IDLE,this._currentSpeed=0,this._stopCallback&&(this._stopCallback(),this._stopCallback=null)}}).prototype,"symbolContainer",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(u.prototype,"symbolHeight",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 125}}),d=e(u.prototype,"elementSpacing",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C=e(u.prototype,"maxSpeed",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3e3}}),y=e(u.prototype,"isBigSymbolReel",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_=u))||_));n._RF.pop()}}}));

System.register("chunks:///_virtual/Ocean_StickySpinManager.ts",["cc","./config21.ts","./OceanUtils.ts"],(function(e){var i,t,n,s,a,o,c,r,l,p,y,g,S,h;return{setters:[function(e){i=e.cclegacy,t=e.tween,n=e.Vec3,s=e.Node,a=e.UITransform,o=e.Sprite,c=e.assetManager,r=e.SpriteFrame,l=e.sp,p=e.Label,y=e.Color,g=e.Font},function(e){S=e.default},function(e){h=e.OceanUtils}],execute:function(){i._RF.push({},"0c6e9EOMapF1JBV7L1rIed4","Ocean_StickySpinManager",void 0);e("Ocean_StickySpinManager",class{constructor(e){this.gameMain=void 0,this._isActive=!1,this._remainingSpins=0,this._stickyPearls=[],this._totalWinAmount=0,this._stickyLayer=null,this._maskNode=null,this.gameMain=e}get isActive(){return this._isActive}get remainingSpins(){return this._remainingSpins}get stickyPearls(){return this._stickyPearls}async triggerStickySpin(e){this._isActive?console.log("[Ocean_StickySpinManager] 已在激活状态，忽略重复触发"):(this._isActive=!0,console.log("[Ocean_StickySpinManager] 触发 StickySpin，初始珍珠数:",e.length),await this.showStartPopup(),this.enterStickySpinMode(e),this.startStickySpinMode())}showStartPopup(){return new Promise((e=>{const i=this.gameMain.propertyNode.props_stickyspin_popup;if(console.log("[Ocean_StickySpinManager] 检查弹窗节点:",i,i?.isValid),!i||!i.isValid)return console.warn("[Ocean_StickySpinManager] 弹窗节点不存在，跳过弹窗"),void e();i.active=!0,i.setSiblingIndex(999),this._maskNode=h.createMask(i,0,180),console.log("[Ocean_StickySpinManager] 创建遮罩");const a=i.getChildByName("content");a&&(a.setScale(0,0,0),t(a).to(.5,{scale:new n(1.1,1.1,1.1)},{easing:"cubicOut"}).to(.2,{scale:new n(1,1,1)},{easing:"cubicIn"}).start());const o=this.gameMain.propertyNode.props_stickyspin_popup_btn;if(console.log("[Ocean_StickySpinManager] 检查按钮节点:",o,o?.isValid),o&&o.isValid){const t=()=>{o.off(s.EventType.TOUCH_END,t),h.destroyMask(this._maskNode),this._maskNode=null,i.active=!1,e()};o.on(s.EventType.TOUCH_END,t)}else console.log("[Ocean_StickySpinManager] 按钮不存在，2秒后自动关闭"),setTimeout((()=>{h.destroyMask(this._maskNode),this._maskNode=null,i.active=!1,e()}),2e3)}))}enterStickySpinMode(e){this._isActive=!0,this._stickyPearls=[...e],this._remainingSpins=S.gameConfig.stickySpin.initialSpins,this._totalWinAmount=0,console.log(`[Ocean_StickySpinManager] 进入模式，初始珍珠: ${e.length}，次数: ${this._remainingSpins}`),console.log("[Ocean_StickySpinManager] 初始珍珠列表:",JSON.stringify(e))}startStickySpinMode(){console.log("[Ocean_StickySpinManager] 开始 StickySpin 模式");const e=this.gameMain.propertyNode.props_normal;e&&e.isValid&&(e.active=!1,console.log("[Ocean_StickySpinManager] 隐藏 collect 节点")),this.updateUI();const i=this.gameMain.propertyNode.props_stickyspin;i&&i.isValid&&(i.active=!0);const t=this.gameMain.propertyNode.props_stickyspin_start,n=this.gameMain.propertyNode.props_stickyspin_end;t&&(t.active=!0),n&&(n.active=!1),this.showStickyPearls(),setTimeout((()=>{this.stickySpinLoop()}),1e3)}updateUI(){console.log(`[Ocean_StickySpinManager] updateUI: remainingSpins=${this._remainingSpins}, pearlCount=${this._stickyPearls.length}`);const e=this.gameMain.propertyNode.props_stickyspin_count,i=this.gameMain.propertyNode.props_stickyspin_remaining_prefix;if(e&&e.isValid)if(this._remainingSpins>=10){const t=Math.floor(this._remainingSpins/10),n=this._remainingSpins%10;h.setNumberSprite(e,n),i&&i.isValid&&(i.active=!0,h.setNumberSprite(i,t)),console.log(`[Ocean_StickySpinManager] 更新剩余次数图片(两位数): ${t}${n}`)}else h.setNumberSprite(e,this._remainingSpins),i&&i.isValid&&(i.active=!1),console.log(`[Ocean_StickySpinManager] 更新剩余次数图片: ${this._remainingSpins}`);else console.warn("[Ocean_StickySpinManager] 找不到 props_stickyspin_count 节点, countNode=",e);const t=this.gameMain.propertyNode.props_stickyspin_pearl_count;if(t&&t.isValid){const e=this._stickyPearls.length,i=Math.min(e,9);h.setNumberSprite(t,i),console.log(`[Ocean_StickySpinManager] 更新珍珠数量图片: ${i} (实际: ${e})`)}else console.warn("[Ocean_StickySpinManager] 找不到 props_stickyspin_pearl_count 节点, pearlCountNode=",t)}showStickyPearls(){if(this._stickyLayer||this.createStickyLayer(),!this._stickyLayer)return;[...this._stickyLayer.children].forEach((e=>{"Mask"!==e.name&&e.destroy()})),this._stickyPearls.forEach((e=>{this.createStickyPearlNode(e)})),console.log("[Ocean_StickySpinManager] 显示 Sticky 珍珠，数量:",this._stickyPearls.length)}createStickyLayer(){if(this._stickyLayer)return;let e=this.gameMain.node.getChildByPath("container/reels");if(e||(e=this.gameMain.node.getChildByName("reels")),!e)return void console.warn("[Ocean_StickySpinManager] 找不到 reels 容器");console.log("[Ocean_StickySpinManager] 找到 reels 容器:",e.name,"子节点数:",e.children.length),this._stickyLayer=new s("StickyLayer"),this._stickyLayer.layer=1<<25,this._stickyLayer.active=!0;const i=this._stickyLayer.addComponent(a);i.setContentSize(900,400),i.setAnchorPoint(.5,.5);const t=e.parent;if(!t)return void console.warn("[Ocean_StickySpinManager] 找不到 reels 父容器");t.addChild(this._stickyLayer),this._stickyLayer.setSiblingIndex(999);const n=e.position;this._stickyLayer.setPosition(n.x,n.y,n.z),console.log("[Ocean_StickySpinManager] reels 位置:",n,", StickyLayer 位置:",this._stickyLayer.position);const o=h.createMask(this._stickyLayer,0,150);o.layer=1<<25;const c=o.getComponent(a);c&&c.setContentSize(900,400),console.log("[Ocean_StickySpinManager] 遮罩创建完成，层级:",this._stickyLayer.getSiblingIndex()),console.log("[Ocean_StickySpinManager] Sticky 图层创建完成，位置:",this._stickyLayer.position)}createStickyPearlNode(e){if(!this._stickyLayer)return;const i=S.gameConfig.constants.reelPositions,t=S.gameConfig.constants.symbolHeight,n=S.gameConfig.constants.symbolSpacing,h=i[e.col]||0,_=t+n,k=_-e.row*_;console.log(`[Ocean_StickySpinManager] 创建珍珠: col=${e.col}, row=${e.row}, colX=${h}, pearlY=${k}, symbolHeight=${t}`);const d=new s(`Pearl_${e.col}_${e.row}`);d.layer=this._stickyLayer.layer,this._stickyLayer.addChild(d),d.setPosition(h,k,0);d.addComponent(a).setContentSize(172,t-2);const m=new s("PearlIcon");m.layer=d.layer,d.addChild(m),m.setScale(.75,.9,1);m.addComponent(a).setContentSize(172,t-2);const u=m.addComponent(o);u.sizeMode=o.SizeMode.CUSTOM,u.trim=!0;const M=c.getBundle("ocean");M?M.load("texture/oceanicon_small/ocean_icon_pearl/spriteFrame",r,((i,t)=>{!i&&u&&u.isValid&&t?(u.spriteFrame=t,console.log(`[Ocean_StickySpinManager] 珍珠图片加载成功: col=${e.col}, row=${e.row}`)):console.warn(`[Ocean_StickySpinManager] 珍珠图片加载失败: ${i}`)})):console.warn("[Ocean_StickySpinManager] ocean bundle 未找到");const f=new s("PearlSpine");f.layer=d.layer,d.addChild(f);const O=f.addComponent(l.Skeleton),w=c.getBundle("ocean");if(w){const e=S.gameConfig.constants.pearlSpinePath;w.load(e,l.SkeletonData,((e,i)=>{!e&&O&&O.isValid&&(O.skeletonData=i,O.premultipliedAlpha=!1,f.setScale(.58,.6,1),f.setPosition(0,0,0),O.setAnimation(0,"move",!0))}))}const v=new s("ValueLabel");v.layer=d.layer,d.addChild(v);const N=v.addComponent(p);N.string=e.value.toString(),N.fontSize=18,N.lineHeight=18,N.color=new y(255,255,255,255),v.setPosition(0,-10,0);const P=c.getBundle("ocean");if(P){const e=S.gameConfig.constants.pearlFontPath;P.load(e,g,((e,i)=>{!e&&N&&N.isValid&&(N.font=i)}))}console.log(`[Ocean_StickySpinManager] 创建 Sticky 珍珠: col=${e.col}, row=${e.row}, value=${e.value}`)}async stickySpinLoop(){for(console.log("[Ocean_StickySpinManager] 开始 StickySpin 循环");this._remainingSpins>0;){console.log(`[Ocean_StickySpinManager] 剩余次数: ${this._remainingSpins}`),this._remainingSpins--,this.updateUI();const{results:e,pearlValues:i,newPearls:t}=this.generateMockResults();await this.performSpin(e,i),t.length>0&&(console.log(`[Ocean_StickySpinManager] 发现 ${t.length} 个新珍珠！重置次数`),this._stickyPearls.push(...t),this._remainingSpins=S.gameConfig.stickySpin.bonusSpins,this.updateUI()),this.showStickyPearls(),await this.delay(1e3)}await this.settleStickySpin()}generateMockResults(){const e=[],i=[],t=[],n=S.gameConfig.constants.iconNames,s=S.gameConfig.constants.pearlSymbol,a=this._stickyPearls.length,o=S.gameConfig.stickySpin.maxPearls,c=n.filter((e=>e!==s));for(let n=0;n<5;n++){const r=[],l=[];for(let e=0;e<3;e++){const i=this._stickyPearls.find((i=>i.col===n&&i.row===e));if(i)r.push(s),l.push(i.value);else{if(Math.random()<.15&&a+t.length<o){const i=Math.floor(46*Math.random())+5;r.push(s),l.push(i),t.push({col:n,row:e,value:i})}else{const e=c[Math.floor(Math.random()*c.length)];r.push(e),l.push(null)}}}e.push(r),i.push(l)}return console.log(`[Ocean_StickySpinManager] 生成结果，已有珍珠: ${a}，新生成: ${t.length}`),{results:e,pearlValues:i,newPearls:t}}performSpin(e,i){return new Promise((t=>{console.log("[Ocean_StickySpinManager] 执行 spin");const n=this.gameMain.wheels;if(!n||0===n.length)return console.warn("[Ocean_StickySpinManager] 轮子未初始化"),void setTimeout(t,1e3);n.forEach((e=>{e.startSpin()}));setTimeout((()=>{let s=0;const a=n.length;n.forEach(((n,o)=>{setTimeout((()=>{const c=e[o]||[],r=i[o]?.map((e=>e??0))||[];n.stopSpin(c,r,(()=>{s++,s>=a&&setTimeout(t,500)}))}),200*o)}))}),2e3)}))}checkForNewPearls(e,i){const t=[],n=S.gameConfig.constants.pearlSymbol;for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)if(e[s][a]===n&&null!==i[s][a]&&i[s][a]>0){this._stickyPearls.some((e=>e.col===s&&e.row===a))||t.push({col:s,row:a,value:i[s][a]})}return t}async settleStickySpin(){console.log("[Ocean_StickySpinManager] 开始结算");const e=this.gameMain.propertyNode.props_stickyspin_start,i=this.gameMain.propertyNode.props_stickyspin_end;e&&(e.active=!1),i&&(i.active=!0);for(const e of this._stickyPearls){if(this._totalWinAmount+=e.value,this._stickyLayer){const i=this._stickyLayer.getChildByName(`Pearl_${e.col}_${e.row}`);i&&i.isValid&&t(i).to(.15,{scale:new n(1.3,1.3,1)},{easing:"cubicOut"}).to(.15,{scale:new n(1,1,1)},{easing:"cubicIn"}).start()}const i=this.gameMain.propertyNode.props_stickyspin_win_value;if(i&&i.isValid){const e=i.getComponent(p);e&&(e.string=this._totalWinAmount.toFixed(2))}console.log(`[Ocean_StickySpinManager] 结算珍珠 (${e.col}, ${e.row})，价值: ${e.value}，累计: ${this._totalWinAmount}`),await this.delay(300)}console.log("[Ocean_StickySpinManager] 结算完成，总赢钱:",this._totalWinAmount),await this.delay(1e3),await this.showSettlementPopup()}showSettlementPopup(){return new Promise((e=>{const i=this.gameMain.propertyNode.props_stickyspin_popup;if(!i||!i.isValid)return console.warn("[Ocean_StickySpinManager] 结算弹窗节点不存在，直接退出"),this.exitStickySpinMode(),void e();this._maskNode=h.createMask(i,0,180),console.log("[Ocean_StickySpinManager] 显示结算弹窗"),i.active=!0;const t=this.gameMain.propertyNode.props_stickyspin_popup_btn;if(t&&t.isValid){const n=t.getComponentInChildren(p);n&&(n.string="COLLECT");const a=()=>{t.off(s.EventType.TOUCH_END,a),h.destroyMask(this._maskNode),this._maskNode=null,i.active=!1,this.exitStickySpinMode(),e()};t.on(s.EventType.TOUCH_END,a)}else setTimeout((()=>{h.destroyMask(this._maskNode),this._maskNode=null,i.active=!1,this.exitStickySpinMode(),e()}),2e3)}))}exitStickySpinMode(){console.log("[Ocean_StickySpinManager] 退出模式"),this._isActive=!1,this._remainingSpins=0,this._stickyPearls=[],this._stickyLayer&&this._stickyLayer.isValid&&(this._stickyLayer.destroy(),this._stickyLayer=null,console.log("[Ocean_StickySpinManager] 销毁 Sticky 图层"));const e=this.gameMain.propertyNode.props_stickyspin;e&&e.isValid&&(e.active=!1);const i=this.gameMain.propertyNode.props_normal;i&&i.isValid&&(i.active=!0,console.log("[Ocean_StickySpinManager] 恢复 collect 节点")),this.resetReels(),this.gameMain.resetPearlProgress();const t=this.gameMain.propertyNode.props_spin_btn;t&&t.isValid&&(t.interactable=!0),console.log("[Ocean_StickySpinManager] StickySpin 完全退出")}resetReels(){const e=this.gameMain.wheels,i=this.gameMain.getInitialSymbols();e&&e.length>0&&(e.forEach(((e,t)=>{e.resetToInitial&&e.resetToInitial(i[t])})),console.log("[Ocean_StickySpinManager] 转轮已重置到初始状态"))}delay(e){return new Promise((i=>setTimeout(i,e)))}}),i._RF.pop()}}}));

System.register("chunks:///_virtual/Ocean_Wheel.ts",["cc"],(function(e){var n,s,t;return{setters:[function(e){n=e.cclegacy,s=e.Component,t=e._decorator}],execute:function(){var c;n._RF.push({},"21874Tdk6NMFaapdAPlWOA7","Ocean_Wheel",void 0);const{ccclass:i,property:o}=t;e("Ocean_Wheel",i("Ocean_Wheel")(c=class extends s{constructor(...e){super(...e),this.wheelIndex=0,this.isSpinning=!1}startSpin(){this.isSpinning=!0,console.log(`Wheel ${this.wheelIndex} start spin`)}stop(e,n){this.isSpinning=!1,console.log(`Wheel ${this.wheelIndex} stop with result ${e}`),n()}})||c);n._RF.pop()}}}));

System.register("chunks:///_virtual/Ocean_WinManager.ts",["cc","./config21.ts"],(function(n){var t,i;return{setters:[function(n){t=n.cclegacy},function(n){i=n.default}],execute:function(){t._RF.push({},"fc996idQ3JEYpgow0AUyIxx","Ocean_WinManager",void 0);n("Ocean_WinManager",class{constructor(){this._winningPositions=[],this._winningLines=[],this._winAmount=0}get currentWin(){return this._winAmount}getWinningPositions(){return this._winningPositions}getWinningLines(){return this._winningLines}reset(){this._winAmount=0,this._winningPositions=[],this._winningLines=[]}calculateWin(n,t){const i=[];for(let t=0;t<5;t++){const s=[];for(let i=0;i<3;i++)s.push(n[3*t+i]);i.push(s)}this._winningPositions=this.detectWinningLines(i);let s=0;if(this._winningPositions.length>0){const n=new Set(this._winningPositions.map((n=>n.col))).size;3===n?s=3*t:4===n?s=5*t:5===n&&(s=10*t)}return this._winAmount=Math.floor(s),this._winAmount}isSymbolMatch(n,t){const s=i.gameConfig.constants,e=s.pearlSymbol,o=s.scatterSymbol,r=s.wildSymbol;return n!==e&&t!==e&&(n===o||t===o?n===t:n===r||t===r||n===t)}detectWinningLines(n){const t=new Set,s=[];if(n.length<3)return[];const e=i.gameConfig.constants,o=e.scatterSymbol,r=e.pearlSymbol,c=e.wildSymbol;for(let t=0;t<n[0].length;t++){const i=n[0][t];if(!i||i===o||i===r)continue;this._findPathsFrom(n,t,i,c).forEach((n=>{n.length>=3&&s.push(n)}))}this._winningLines=s;const h=[];return s.forEach((n=>{n.forEach((n=>{const i=`${n.col},${n.row}`;t.has(i)||(t.add(i),h.push(n))}))})),h}_findPathsFrom(n,t,i,s){const e=n.length,o=[],r=(t,c,h,l)=>{const a=[...h,{col:t,row:c}];if(t===e-1)return void o.push(a);const g=n[t][c]===s?i:n[t][c];let u=!1;for(let i=0;i<n[t+1].length;i++){const s=n[t+1][i];this.isSymbolMatch(g,s)&&(u=!0,r(t+1,i,a))}!u&&a.length>=3&&o.push(a)};if(r(0,t,[]),0===o.length)return[];const c=Math.max(...o.map((n=>n.length)));return o.filter((n=>n.length===c))}}),t._RF.pop()}}}));

System.register("chunks:///_virtual/oceanScript",["./Ocean_FreeGameManager.ts","./Ocean_GameMain.ts","./Ocean_PaylineEffect.ts","./Ocean_ReelEffect.ts","./Ocean_SlotReel.ts","./Ocean_StickySpinManager.ts","./Ocean_Wheel.ts","./config21.ts","./index86.ts","./Ocean_WinManager.ts","./socketConnect21.ts","./index84.ts","./prefabDefine22.ts","./soundDefine22.ts","./spriteDefine21.ts","./game38.ts","./index85.ts","./index87.ts","./type20.ts","./OceanUtils.ts","./OceanViewModel.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/OceanUtils.ts",["cc"],(function(e){var t,n,o,s,r,a,i,c,d,l;return{setters:[function(e){t=e.cclegacy,n=e.Sprite,o=e.assetManager,s=e.SpriteFrame,r=e.Node,a=e.UITransform,i=e.ImageAsset,c=e.Texture2D,d=e.Color,l=e.BlockInputEvents}],execute:function(){t._RF.push({},"d7589yk4XxCs6b3/YM3mg4N","OceanUtils",void 0);e("OceanUtils",class{static setNumberSprite(e,t,r="texture/line_number",a=""){const i=e.getComponent(n);if(!i)return void console.warn(`[OceanUtils] Node ${e.name} does not have a Sprite component.`);const c=o.getBundle("ocean");if(!c)return void console.error("[OceanUtils] Ocean bundle not found.");const d=`${r}/${a}${t}`;c.load(`${d}/spriteFrame`,s,((e,t)=>{e?c.load(d,s,((e,t)=>{e?console.error(`[OceanUtils] Failed to load sprite frame: ${d}`,e):i&&i.isValid&&(i.spriteFrame=t)})):i&&i.isValid&&(i.spriteFrame=t)}))}static createMask(e,t=0,o=128){const m=new r("Mask");m.layer=e.layer,e.insertChild(m,t);const p=m.addComponent(a);p.setContentSize(3e3,3e3),p.setAnchorPoint(.5,.5);const u=m.addComponent(n);u.sizeMode=n.SizeMode.CUSTOM;const f=new i;f.reset({_data:new Uint8Array([255,255,255,255]),width:1,height:1,format:c.PixelFormat.RGBA8888,_compressed:!1});const g=new c;g.image=f;const C=new s;return C.texture=g,C.packable=!1,u.spriteFrame=C,u.color=new d(0,0,0,o),m.addComponent(l),m.setPosition(0,0,0),m}static destroyMask(e){e&&e.isValid&&e.destroy()}}),t._RF.pop()}}}));

System.register("chunks:///_virtual/OceanViewModel.ts",["cc","./ViewModel.ts","./index85.ts","./Ocean_GameMain.ts","./game38.ts","./Ocean_WinManager.ts"],(function(n){var t,i,e,s,o,c,a,p,h,r,u,l,d,_,m,g;return{setters:[function(n){t=n.cclegacy,i=n._decorator},function(n){e=n.StoreInject,s=n.default},function(n){o=n.getStore},function(n){c=n.Ocean_GameMain},function(n){a=n.setSpinning,p=n.setSpinResults,h=n.updateWin,r=n.setWinningLines,u=n.setPearlValues,l=n.setAutoSpin,d=n.setTurboMode,_=n.updateBet,m=n.updateBalance},function(n){g=n.Ocean_WinManager}],execute:function(){var M;t._RF.push({},"1fcb6jGLgBFe5wjJfDOvZBr","OceanViewModel",void 0);const{ccclass:f}=i;n("OceanViewModel",e(o())(M=f("OceanViewModel")(M=class extends s{constructor(){super(c),this.winManager=void 0,this.winManager=new g}begin(){}connect(n){return this.inject(n,(n=>({balance:n.balance,betAmount:n.betAmount,winAmount:n.winAmount,spinResults:n.spinResults,isSpinning:n.isSpinning,turboMode:n.turboMode,autoSpin:n.autoSpin,winningLines:n.winningLines,pearlValues:n.pearlValues}))),this.setEvent({onSpin:()=>{this.comp.props.isSpinning||(this.dispatch(a(!0)),this.dispatch(p([])),this.dispatch(h(0)),this.dispatch(r([])),this.dispatch(u([])),setTimeout((()=>{const n=[],t=["common_icon_9","common_icon_10","common_icon_j","common_icon_q","common_icon_k","ocean_icon_starfish","ocean_icon_tropicalfish","ocean_icon_oceanturtle","ocean_icon_mermaid_1","ocean_icon_scatter","ocean_icon_pearl"],i=[];for(let e=0;e<15;e++){const e=t[Math.floor(Math.random()*t.length)];n.push(e),"ocean_icon_pearl"===e?i.push(10*Math.floor(100*Math.random())):i.push(0)}this.dispatch(p(n)),this.dispatch(u(i))}),1e3))},onAutoSpin:()=>{this.dispatch(l(!this.comp.props.autoSpin))},onTurbo:()=>{const n=(this.comp.props.turboMode+1)%3;this.dispatch(d(n))},onBetChange:n=>{this.dispatch(_(n))},onSpinComplete:()=>{this.dispatch(a(!1));const n=this.comp.props.spinResults;if(n&&15===n.length){const t=this.winManager.calculateWin(n,this.comp.props.betAmount),i=this.winManager.getWinningLines();t>0&&(this.dispatch(h(t)),this.dispatch(r(i)),this.dispatch(m(this.comp.props.balance+t)))}}}),this}})||M)||M);t._RF.pop()}}}));

System.register("chunks:///_virtual/prefabDefine22.ts",["cc","./SourceManage.ts"],(function(e){var n,t,a;return{setters:[function(e){n=e.cclegacy,t=e.Prefab},function(e){a=e.loopFiles}],execute:function(){n._RF.push({},"61be23lxGBKbqBZAMpHqkLh","prefabDefine",void 0);let r=e("PrefabPathDefine",function(e){return e.LOAING_PANEL="prefabs/prefab_ocean_loading",e.GAME_MAIN="prefabs/OceanView",e}({}));e("default",(e=>a(e,t,r)));n._RF.pop()}}}));

System.register("chunks:///_virtual/socketConnect21.ts",["cc","./WebSocketStarter.ts","./config21.ts","./config17.ts"],(function(e){var t,n,o,c;return{setters:[function(e){t=e.cclegacy},function(e){n=e.WebSocketDriver},function(e){o=e.default},function(e){c=e.subGameList}],execute:function(){t._RF.push({},"eb2c7EBdI1JopV+YYxEBw9F","socketConnect",void 0);e("SKT_MAG_TYPE",function(e){return e.LOGIN="1000",e.SPIN="1001",e}({}));let r=e("oceanWebSocketDriver",null);e("default",(()=>new Promise(((t,i)=>{if(!o.gameId)return void i("gameId is null");const u=c.find((e=>e.gameId===o.gameId));u?(r=e("oceanWebSocketDriver",new n(o.gameId,u.gameHost)),r.filterData=e=>e,t(r)):i("subGameInfo not found")}))));e("removeInstance",(()=>{r=e("oceanWebSocketDriver",null)}));t._RF.pop()}}}));

System.register("chunks:///_virtual/soundDefine22.ts",["cc","./SourceManage.ts"],(function(n){var i,u,e;return{setters:[function(n){i=n.cclegacy,u=n.AudioClip},function(n){e=n.loopFiles}],execute:function(){i._RF.push({},"7e99976RTNHn7fTYXtGzmFf","soundDefine",void 0);let o=n("SoundPathDefine",function(n){return n.bg="audio/music/bg",n.spin="audio/sound/spin",n.win="audio/sound/win",n.click="audio/sound/click",n}({}));n("default",(n=>e(n,u,o)));i._RF.pop()}}}));

System.register("chunks:///_virtual/spriteDefine21.ts",["cc","./SourceManage.ts"],(function(e){var o,c,n;return{setters:[function(e){o=e.cclegacy,c=e.SpriteFrame},function(e){n=e.loopFiles}],execute:function(){o._RF.push({},"e0812aYtsBI/7qLdrapzFKb","spriteDefine",void 0);let a=e("SpritePathDefine",function(e){return e.common_icon_9="texture/oceanicon_small/common_icon_9/spriteFrame",e.common_icon_10="texture/oceanicon_small/common_icon_10/spriteFrame",e.common_icon_j="texture/oceanicon_small/common_icon_j/spriteFrame",e.common_icon_q="texture/oceanicon_small/common_icon_q/spriteFrame",e.common_icon_k="texture/oceanicon_small/common_icon_k/spriteFrame",e.common_icon_a="texture/oceanicon_small/common_icon_a/spriteFrame",e.ocean_icon_starfish="texture/oceanicon_small/ocean_icon_starfish/spriteFrame",e.ocean_icon_pearl="texture/oceanicon_small/ocean_icon_pearl/spriteFrame",e.ocean_icon_treasurebox="texture/oceanicon_small/ocean_icon_treasurebox/spriteFrame",e.ocean_icon_tropicalfish="texture/oceanicon_small/ocean_icon_tropicalfish/spriteFrame",e.ocean_icon_oceanturtle="texture/oceanicon_small/ocean_icon_oceanturtle/spriteFrame",e.ocean_icon_mermaid_1="texture/oceanicon_small/ocean_icon_mermaid_1/spriteFrame",e.ocean_icon_mermaid_2="texture/oceanicon_small/ocean_icon_mermaid_2/spriteFrame",e.ocean_icon_mermaid_3="texture/oceanicon_small/ocean_icon_mermaid_3/spriteFrame",e.ocean_icon_scatter="texture/oceanicon_small/ocean_icon_scatter/spriteFrame",e}({}));e("default",(e=>n(e,c,a)));o._RF.pop()}}}));

System.register("chunks:///_virtual/type20.ts",["cc"],(function(){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"496c9J3kpFNQ4vq73n1Gwmx","type",void 0),t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/oceanScript', 'chunks:///_virtual/oceanScript'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});