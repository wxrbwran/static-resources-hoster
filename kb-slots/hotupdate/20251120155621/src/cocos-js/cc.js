System.register([],(function(t,e){"use strict";return{execute:function(){function i(t,e,i,s){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(s):void 0})}function s(t,e,i,s,r){var n={};return Object.keys(s).forEach((function(t){n[t]=s[t]})),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce((function(i,s){return s(t,e,i)||i}),n),r&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(r):void 0,n.initializer=void 0),void 0===n.initializer&&(Object.defineProperty(t,e,n),n=null),n}function r(t,e){const i="undefined"==typeof window?global:window;return void 0===i[t]?i[t]=e:i[t]}t({BitMask:ue,CCClass:yi,Enum:pe,Eventify:ko,WorldNode3DToLocalNodeUI:ca,WorldNode3DToWorldNodeUI:ua,__checkObsoleteInNamespace__:function(t){return lt||(lt="undefined"==typeof Proxy?{}:new Proxy(t,{get:(t,e,i)=>(ht(e),Reflect.get(t,e,i))})),lt},__checkObsolete__:function(t){for(let e of t)ht(e)},_resetDebugSetting:B,absMax:Ki,absMaxComponent:$i,applyMixins:Ku,approx:Oi,assert:O,assertID:X,assertIsNonNullable:function(){},assertIsTrue:function(){},assertsArrayIndex:de,bezier:Lc,bezierByTime:Wc,binarySearch:function(t,e){return Ga(t,e,0)},binarySearchBy:function(t,e,i){let s=0,r=t.length-1,n=r>>>1;for(;s<=r;n=s+r>>>1){const o=t[n];if(i(o,e)<0)r=n-1;else{if(!(i(o,e)>0))return n;s=n+1}}return~s},binarySearchEpsilon:Ga,ccenum:fe,clamp:Ri,clamp01:Bi,color:ks,computeRatioByType:N$,createDefaultPipeline:k9,debug:R,debugID:U,deprecateModuleExportedName:at,deserialize:Xg,enumerableProps:Zi,equals:Pi,error:P,errorID:G,find:vT,flattenCodeArray:$u,floatToHalf:ts,formerlySerializedAs:Sh,fragmentText:oE,getBaselineOffset:zD,getEnglishWordPartAtFirst:rE,getEnglishWordPartAtLast:nE,getError:q,getPathFromRoot:function(t,e){let i=t,s="";for(;null!==i&&i!==e;)s=`${i.name}/${s}`,i=i.parent;return s.slice(0,-1)},getSerializationMetadata:function(t){return t[bh]},getSymbolAt:JD,getSymbolCodeAt:tE,getSymbolLength:QD,getWorldTransformUntilRoot:KV,halfToFloat:es,instantiate:HX,inverseLerp:qi,isCCClassOrFastDefined:bi,isCCObject:Io,isDisplayStats:$,isEnglishWordPartAtFirst:function(t){return qD.test(t)},isEnglishWordPartAtLast:function(t){return YD.test(t)},isUnicodeCJK:$D,isUnicodeSpace:KD,isValid:Mo,lerp:Fi,loadWasmModuleBullet:function(){return Promise.resolve()},loadWasmModuleSpine:IEt,log:I,logID:k,mat4:wr,murmurhash2_32_gc:Gu,nextPow2:Wi,pingPong:Yi,pseudoRandom:ji,pseudoRandomRange:Hi,pseudoRandomRangeInt:Gi,quat:cr,random:ki,randomRange:Ui,randomRangeInt:Vi,rect:Xr,repeat:Xi,safeMeasureText:ZD,sampleAnimationCurve:F$,setDefaultLogTimes:function(t){t>0&&(st=t)},setDisplayStats:K,setPropertyEnumType:ri,setPropertyEnumTypeOnAttrs:ni,setRandGenerator:zi,shift:Wu,size:jr,toDegree:Li,toRadian:Ni,tween:EOt,tweenUtil:IOt,v2:zr,v3:Ps,v4:gs,warn:M,warnID:j}),r("CC_WECHAT",!1),r("CC_XIAOMI",!1),r("CC_ALIPAY",!1),r("CC_BYTEDANCE",!1),r("CC_OPPO",!1),r("CC_VIVO",!1),r("CC_HUAWEI",!1),r("CC_MIGU",!1),r("CC_HONOR",!1),r("CC_COCOS_RUNTIME",!1);const n=!1;r("CC_EDITOR",!1),r("CC_PREVIEW",!1),r("CC_BUILD",!0),r("CC_TEST",!1),r("CC_DEBUG",!1),r("CC_DEV",!1),r("CC_MINIGAME",!1),r("CC_RUNTIME_BASED",!1),r("CC_SUPPORT_JIT",!0),r("CC_JSB",!0);const o="undefined"==typeof window?global:window,a=t("cclegacy",{_global:o}),h=a;a.internal={};const l=t("VERSION","3.8.7");o.CocosEngine=h.ENGINE_VERSION=l,o.cc=h;const c=void 0!==globalThis.jsb&&void 0!==jsb.window?jsb.window:globalThis;o.ccwindow=c;const u=2147483647;function d(t){return(t>0)-(t<0)}function _(t,e){return t^(t^e)&-(t<e)}function p(t){let e,i;return e=(t>65535)<<4,i=((t>>>=e)>255)<<3,e|=i,i=((t>>>=i)>15)<<2,e|=i,i=((t>>>=i)>3)<<1,e|=i,e|(t>>>=i)>>1}function m(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24}function g(t){let e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}function f(t){return--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}const y=new Array(256);(t=>{for(let e=0;e<256;++e){let i=e,s=e,r=7;for(i>>>=1;i;i>>>=1)s<<=1,s|=1&i,--r;t[e]=s<<r&255}})(y);var b=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:u,INT_MIN:-1<<31,abs:function(t){const e=t>>31;return(t^e)-e},countTrailingZeros:g,deinterleave2:function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},deinterleave3:function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},interleave2:function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},interleave3:function(t,e,i){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},isPow2:function(t){return!(t&t-1||!t)},log10:function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},log2:p,max:_,min:function(t,e){return e^(t^e)&-(t<e)},nextCombination:function(t){const e=t|t-1;return e+1|(~e&-~e)-1>>>g(t)+1},nextPow2:f,parity:function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1},popCount:m,prevPow2:function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},reverse:function(t){return y[255&t]<<24|y[t>>>8&255]<<16|y[t>>>16&255]<<8|y[t>>>24&255]},sign:d});t("bits",b);const v=c.document,S=`https://github.com/cocos/cocos-engine/blob/${l}/EngineErrorMap.md`;let T=null,w=console.log.bind(console),x=w,C=w,A=(t,e,...i)=>{t||console.log(`ASSERT: ${E(e,...i)}`)},D=w;function E(...t){return h.js.formatStr.apply(null,t)}function I(...t){return w(...t)}function M(...t){return x(...t)}function P(...t){return C(...t)}function O(t,e,...i){return A(t,e,...i)}function R(...t){return D(...t)}function B(t){if(w=x=C=A=D=()=>{},0!==t){if(t>4){const e=t=>{if(h.game.canvas){if(!T){const t=v.createElement("Div");t.setAttribute("id","logInfoDiv"),t.setAttribute("width","200");const e=h.game.canvas.height;t.setAttribute("height",`${e}`);const i=t.style;i.zIndex="99999",i.position="absolute",i.top=i.left="0",T=v.createElement("textarea"),T.setAttribute("rows","20"),T.setAttribute("cols","30"),T.setAttribute("disabled","true");const s=T.style;s.backgroundColor="transparent",s.borderBottom="1px solid #cccccc",s.borderTopWidth=s.borderLeftWidth=s.borderRightWidth="0px",s.borderTopStyle=s.borderLeftStyle=s.borderRightStyle="none",s.padding="0px",s.margin="0px",t.appendChild(T),h.game.canvas.parentNode.appendChild(t)}T.value=`${T.value+t}\r\n`,T.scrollTop=T.scrollHeight}};C=(...t)=>{e(`ERROR :  ${E(...t)}`)},A=(t,i,...s)=>{t||e(`ASSERT: ${E(i,...s)}`)},7!==t&&(x=(...t)=>{e(`WARN :  ${E(...t)}`)}),5===t&&(w=(...t)=>{e(E(...t))})}else console&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),C=console.error.bind?console.error.bind(console):console.error,A=(t,e,...i)=>{if(!t){const t=E(e,...i);throw new Error(t)}});if(4!==t&&(x=console.warn.bind?console.warn.bind(console):console.warn),t<=2&&(w=console.log),t<=1&&"function"==typeof console.debug){const t=console.debug.bind(console);D=(...e)=>t(...e)}}}function F(t){{const e=t.stack;return void P(e?`${t}\n${e}`:t)}}function N(t){return(e,...i)=>{const s=`${t} ${e}, please go to ${S}#${e} to see details.`;return 0===i.length?s:`${s} Arguments: ${i.join(", ")}`}}const L=N("Log");function k(t,...e){I(L(t,...e))}const z=N("Debug");function U(t,...e){R(z(t,...e))}const V=N("Warning");function j(t,...e){M(V(t,...e))}const H=N("Error");function G(t,...e){P(H(t,...e))}const W=N("Assert");function X(t,e,...i){t||O(!1,W(e,...i))}const Y=t("DebugMode",{NONE:0,VERBOSE:1,INFO:2,WARN:3,ERROR:4,INFO_FOR_WEB_PAGE:5,WARN_FOR_WEB_PAGE:6,ERROR_FOR_WEB_PAGE:7});function q(t,...e){return H(t,...e)}function $(){return!!h.profiler&&h.profiler.isShowingStats()}function K(t){h.profiler&&(t?h.profiler.showStats():h.profiler.hideStats())}var Z=Object.freeze({__proto__:null,DebugMode:Y,_resetDebugSetting:B,_throw:F,assert:O,assertID:X,debug:R,debugID:U,error:P,errorID:G,getError:q,isDisplayStats:$,log:I,logID:k,setDisplayStats:K,warn:M,warnID:j});let Q,J,tt,et,it,st=10;t("replaceProperty",Q),t("removeProperty",J),t("markAsWarning",tt);let rt=0;const nt=new Map;et=(t,e,i,s,r,n,o)=>{const a=nt.get(n);a&&a.logTimes>a.count&&(r(`'%s' is deprecated, please use '%s' instead. ${o}`,`${t}.${e}`,`${i}.${s}`),a.count++)},t("replaceProperty",Q=(t,e,i)=>{null!=t&&i.forEach((i=>{const s=rt++;nt.set(s,{id:s,count:0,logTimes:void 0!==i.logTimes?i.logTimes:st});const r=null!=i.target?i.target:t,n=null!=i.newName?i.newName:i.name,o=null!=i.targetName?i.targetName:e,a=r===t,h=i.suggest?`(${i.suggest})`:"";if(null!=i.customFunction)t[i.name]=function(){return et(e,i.name,o,n,M,s,h),i.customFunction.call(this,...arguments)};else if(null!=i.customSetter||null!=i.customGetter){const r=null!=i.customSetter,a=null!=i.customGetter;r&&a?Object.defineProperty(t,i.name,{get(){return et(e,i.name,o,n,M,s,h),i.customGetter.call(this)},set(t){et(e,i.name,o,n,M,s,h),i.customSetter.call(this,t)},enumerable:!1}):r?Object.defineProperty(t,i.name,{set(t){et(e,i.name,o,n,M,s,h),i.customSetter.call(this,t)},enumerable:!1}):a&&Object.defineProperty(t,i.name,{get(){return et(e,i.name,o,n,M,s,h),i.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(t,i.name,{get(){return et(e,i.name,o,n,M,s,h),a?this[n]:r[n]},set(t){et(e,i.name,o,n,M,s,h),a?this[n]=t:r[n]=t},enumerable:!1})}))}),it=(t,e,i,s,r)=>{const n=nt.get(s);n&&n.logTimes>n.count&&(i(`'%s' has been removed. ${r}`,`${t}.${e}`),n.count++)},t("removeProperty",J=(t,e,i)=>{null!=t&&i.forEach((i=>{const s=rt++;nt.set(s,{id:s,count:0,logTimes:void 0!==i.logTimes?i.logTimes:st});const r=i.suggest?`(${i.suggest})`:"";Object.defineProperty(t,i.name,{get:()=>it(e,i.name,P,s,r),set(){it(e,i.name,P,s,r)},enumerable:!1})}))}),t("markAsWarning",tt=()=>{});const ot={};function at(t){for(let e in t){const i=t[e];ot[e]=i}}function ht(t){const e=ot[t];if(!e)return;const{newName:i,since:s,removed:r}=e;r?i?G(16003,t,s,i):G(16002,t,s):i?j(16001,t,s,i):j(16e3,t,s)}let lt;var ct;class ut{constructor(t){this.id=0|998*Math.random(),this.prefix=t?t+".":""}getNewId(){return this.prefix+(++this.id).toString()}}ct=ut,ut.global=new ct("global");const dt=new ut("TmpCId."),_t="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]"),pt="__classname__",mt="__cid__";function gt(t){return"number"==typeof t||t instanceof Number}function ft(t){return"string"==typeof t||t instanceof String}function yt(t){for(const e in t)return!1;return!0}const bt=(()=>{const t={value:void 0,enumerable:!1,writable:!1,configurable:!0};return(e,i,s,r,n)=>{t.value=s,t.writable=r,t.enumerable=n,Object.defineProperty(e,i,t),t.value=void 0}})(),vt=(()=>{const t={get:void 0,set:void 0,enumerable:!1};return(e,i,s,r,n=!1,o=!1)=>{"boolean"==typeof r&&(k(1031),n=r,r=void 0),t.get=s,t.set=r,t.enumerable=n,t.configurable=o,Object.defineProperty(e,i,t),t.get=void 0,t.set=void 0}})(),St=(()=>{const t={get:void 0,enumerable:!1,configurable:!1};return(e,i,s,r,n)=>{t.get=s,t.enumerable=r,t.configurable=n,Object.defineProperty(e,i,t),t.get=void 0}})(),Tt=(()=>{const t={set:void 0,enumerable:!1,configurable:!1};return(e,i,s,r,n)=>{t.set=s,t.enumerable=r,t.configurable=n,Object.defineProperty(e,i,t),t.set=void 0}})();function wt(t){const e=Object.create(null);if(t){const t=".",i="/";e[t]=1,e[i]=1,delete e[t],delete e[i]}return e}function xt(t){if("function"==typeof t){const e=t.prototype;if(e&&e.hasOwnProperty(pt)&&e[pt])return e[pt];let i="";if(t.name)i=t.name;else if(t.toString){let e;const s=t.toString();e="["===s.charAt(0)?/\[\w+\s*(\w+)\]/.exec(s):/^function\s*(\w+)/.exec(s),e&&2===e.length&&(i=e[1])}return"Object"!==i?i:""}return t&&t.constructor?xt(t.constructor):""}function Ct(t,e,i,s){const r=/([^.]+)$/,n=r.exec(e)[0],o=r.exec(i)[0];function a(){return this[o]}s?vt(t,n,a,(function(t){this[o]=t})):St(t,n,a)}function At(t,e,i,s){for(const r in i)Ct(t,`${e}.${r}`,i[r],s)}const Dt=/(%d)|(%s)/,Et=/%s/;function It(t,...e){if(0===arguments.length)return"";if(0===e.length)return`${t}`;if("string"==typeof t&&Dt.test(t))for(const i of e){const e="number"==typeof i?Dt:Et;if(e.test(t)){const s=`${i}`;t=t.replace(e,s)}else t+=` ${i}`}else for(const i of e)t+=` ${i}`;return t}function Mt(){const t=arguments.length-1,e=new Array(t);for(let i=0;i<t;++i)e[i]=arguments[i+1];return e}function Pt(t,e){for(;t;){const i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;t=Object.getPrototypeOf(t)}return null}function Ot(t,e,i){const s=Pt(e,t);s&&Object.defineProperty(i,t,s)}function Rt(t,e,i){const s=Object.getOwnPropertyNames(t);for(let r=0,n=s.length;r<n;++r){const n=s[r];-1===i.indexOf(n)&&Ot(n,t,e)}}function Bt(t,...e){t=t||{};for(let i=0;i<e.length;++i){const s=e[i];if(s){if("object"!=typeof s){G(5402,s);continue}for(const e in s)e in t||Ot(e,s,t)}}return t}function Ft(t,...e){t=t||{};for(let i=0;i<e.length;++i){const s=e[i];if(s){if("object"!=typeof s){G(5403,s);continue}for(const e in s)Ot(e,s,t)}}return t}function Nt(t,e){for(const i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t}function Lt(t){const e=t.prototype,i=e&&Object.getPrototypeOf(e);return i&&i.constructor}function kt(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=Lt(t)))return!1;if(t===e)return!0}}return!1}function zt(t){for(const e of Object.keys(t))delete t[e]}const Ut=wt(!0),Vt=wt(!0);function jt(t,e,i){return function(s,r){if(r.prototype.hasOwnProperty(t)&&delete e[r.prototype[t]],bt(r.prototype,t,s),s){const n=e[s];!i&&n&&n!==r?G(16334,t,s,""):e[s]=r}}}const Ht=jt("__cid__",Ut,!1),Gt=jt("__classname__",Vt,!0);function Wt(t,e){if(Gt(t,e),!e.prototype.hasOwnProperty(mt)){const i=t||dt.getNewId();i&&Ht(i,e)}}function Xt(t,e){const i=Vt[e],s=Ut[e];let r=!0;if(i&&i!==t&&(G(16335,e),r=!1),s&&s!==t&&(G(16336,e),r=!1),r){let i=t[_t];i||(i=[],t[_t]=i),i.push(e),Vt[e]=t,Ut[e]=t}}function Yt(...t){for(const e of t){const t=e.prototype,i=t[mt];i&&delete Ut[i];const s=t[pt];s&&delete Vt[s];const r=t[_t];if(r)for(let t=0;t<r.length;++t){const e=r[t];delete Vt[e],delete Ut[e]}}}function qt(t){return $t(t)}function $t(t){return Ut[t]}function Kt(t){return Vt[t]}function Zt(t){return Qt(t)}function Qt(t){let e;if("function"==typeof t&&t.prototype.hasOwnProperty(mt))return e=t.prototype[mt],e;if(t&&t.constructor){const i=t.constructor.prototype;if(i&&i.hasOwnProperty(mt))return e=t[mt],e}return""}let Jt=class{get(){return this._get()}constructor(t,e){this.count=0;const i=void 0===e?t:e,s=void 0===e?null:t;this._pool=new Array(i),this._cleanup=s}_get(){if(this.count>0){--this.count;const t=this._pool[this.count];return this._pool[this.count]=null,t}return null}put(t){const e=this._pool;if(this.count<e.length){if(this._cleanup&&!1===this._cleanup(t))return;e[this.count]=t,++this.count}}resize(t){t>=0&&(this._pool.length=t,this.count>t&&(this.count=t))}};class te{constructor(t){this.i=0,this.array=t}get length(){return this.array.length}set length(t){this.array.length=t,this.i>=t&&(this.i=t-1)}remove(t){const e=this.array.indexOf(t);e>=0&&this.removeAt(e)}removeAt(t){this.array.splice(t,1),t<=this.i&&--this.i}fastRemove(t){const e=this.array.indexOf(t);e>=0&&this.fastRemoveAt(e)}fastRemoveAt(t){const e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i}push(t){this.array.push(t)}}function ee(t,e){t.splice(e,1)}function ie(t,e){const i=t.length;e<0||e>=i||(t[e]=t[i-1],t.length=i-1)}function se(t,e){const i=t.indexOf(e);return i>=0&&(ee(t,i),!0)}function re(t,e){const i=t.indexOf(e);i>=0&&(t[i]=t[t.length-1],--t.length)}function ne(t,e){const i=t.findIndex(e);if(i>=0){const e=t[i];return ee(t,i),e}}function oe(t,e){return t.indexOf(e)>=0}function ae(t,...e){for(let i=0,s=e.length;i<s;++i)t[i]=e[i]}var he=Object.freeze({__proto__:null,MutableForwardIterator:te,appendObjectsAt:function(t,e,i){return t.splice.apply(t,[i,0,...e]),t},contains:oe,copy:function(t){const e=t.length,i=new Array(e);for(let s=0;s<e;s+=1)i[s]=t[s];return i},fastRemove:re,fastRemoveAt:ie,fillItems:ae,remove:se,removeArray:function(t,e){for(let i=0,s=e.length;i<s;i++)se(t,e[i])},removeAt:ee,removeIf:ne,verifyType:function(t,e){if(t&&t.length>0)for(const i of t)if(!(i instanceof e))return k(1300),!1;return!0}});const le={IDGenerator:ut,Pool:Jt,array:he,isNumber:gt,isString:ft,isEmptyObject:yt,getPropertyDescriptor:Pt,addon:Bt,mixin:Ft,extend:Nt,getSuper:Lt,isChildClassOf:kt,clear:zt,value:bt,getset:vt,get:St,set:Tt,unregisterClass:Yt,getClassName:xt,setClassName:Wt,setClassAlias:Xt,getClassByName:Kt,getClassById:$t,get _registeredClassNames(){return{...Vt}},set _registeredClassNames(t){zt(Vt),Object.assign(Vt,t)},get _registeredClassIds(){return{...Ut}},set _registeredClassIds(t){zt(Ut),Object.assign(Ut,t)},_getClassId:Zt,getClassId:Qt,_setClassId:Ht,_getClassById:qt,obsolete:Ct,obsoletes:At,formatStr:It,shiftArguments:Mt,createMap:wt};h.js=le;var ce=Object.freeze({__proto__:null,IDGenerator:ut,Pool:Jt,_getClassById:qt,_getClassId:Zt,_idToClass:Ut,_nameToClass:Vt,_setClassId:Ht,addon:Bt,array:he,clear:zt,copyAllProperties:Rt,createMap:wt,extend:Nt,formatStr:It,get:St,getClassById:$t,getClassByName:Kt,getClassId:Qt,getClassName:xt,getPropertyDescriptor:Pt,getSuper:Lt,getset:vt,isChildClassOf:kt,isEmptyObject:yt,isNumber:gt,isString:ft,js:le,mixin:Ft,obsolete:Ct,obsoletes:At,set:Tt,setClassAlias:Xt,setClassName:Wt,shiftArguments:Mt,unregisterClass:Yt,value:bt});function ue(t){if("__bitmask__"in t)return t;bt(t,"__bitmask__",null,!0);let e=-1;const i=Object.keys(t);for(let s=0;s<i.length;s++){const r=i[s];let n=t[r];if(-1===n)n=++e,t[r]=n;else if("number"==typeof n)e=n;else if("string"==typeof n&&Number.isInteger(parseFloat(r)))continue;const o=`${n}`;r!==o&&bt(t,o,r)}return t}function de(t,e){e>=0&&t.length,t.length}t("js",ce),ue.isBitMask=t=>t&&Object.prototype.hasOwnProperty.call(t,"__bitmask__"),ue.getList=t=>t.__bitmask__?t.__bitmask__:ue.update(t),ue.update=t=>{Array.isArray(t.__bitmask__)||(t.__bitmask__=[]);const e=t.__bitmask__;e.length=0;for(const i in t){const s=t[i];Number.isInteger(s)&&e.push({name:i,value:s})}return e.sort(((t,e)=>t.value-e.value)),e},h.BitMask=ue;const _e=Object.prototype.hasOwnProperty;function pe(t){return"__enums__"in t?t:(bt(t,"__enums__",null,!0),pe.update(t))}function me(t){_e.call(t,"__enums__")}function ge(t){me(t);const e=t.__enums__||[];e.length=0;let i=!0;for(const s in t){const r=t[s],n=Number.isInteger(r);n||(i=!1),(n||"string"==typeof r&&t[r]!==Number.parseInt(s))&&e.push({name:s,value:r})}return i&&e.sort(((t,e)=>t.value-e.value)),t.__enums__=e,e}function fe(t){"__enums__"in t||bt(t,"__enums__",null,!0)}pe.update=t=>{let e=-1;const i=Object.keys(t);for(let s=0;s<i.length;s++){const r=i[s];let n=t[r];if(-1===n)n=++e,t[r]=n;else if("number"==typeof n)e=n;else if("string"==typeof n&&Number.isInteger(parseFloat(r)))continue;const o=`${n}`;r!==o&&bt(t,o,r)}return Array.isArray(t.__enums__)&&ge(t),t},pe.isEnum=t=>t&&_e.call(t,"__enums__"),pe.getList=t=>(me(t),t.__enums__?t.__enums__:ge(t)),pe.sortList=(t,e)=>{me(t),Array.isArray(t.__enums__)&&t.__enums__.sort(e)},h.Enum=pe;class ye{constructor(){}clone(){return G(100,`${xt(this)}.clone`),this}equals(t){return!1}set(t){G(100,`${xt(this)}.set`)}toString(){return""}}t("ValueType",ye),Wt("cc.ValueType",ye),h.ValueType=ye;const be=t("SettingsCategory",{PATH:"path",ENGINE:"engine",ASSETS:"assets",SCRIPTING:"scripting",PHYSICS:"physics",RENDERING:"rendering",LAUNCH:"launch",SCREEN:"screen",SPLASH_SCREEN:"splashScreen",ANIMATION:"animation",PROFILING:"profiling",PLUGINS:"plugins",XR:"xr"});class ve{constructor(){this._settings={},this._override={}}init(t="",i={}){for(const t in i){const e=i[t];if(e)for(const i in e)this.overrideSettings(t,i,e[i])}return t?window.oh&&"napi"===window.scriptEngineType?new Promise(((t,i)=>{e.import("../settings.js").then((e=>{this._settings=e.default,t()})).catch((t=>i(t)))})):new Promise(((e,i)=>{if(t.startsWith("http")){const s=new XMLHttpRequest;s.open("GET",t),s.responseType="text",s.onload=()=>{this._settings=JSON.parse(s.response),e()},s.onerror=()=>{i(new Error("request settings failed!"))},s.send(null)}else{const s=fsUtils.readJsonSync(t);s instanceof Error?i(s):(this._settings=s,e())}})):Promise.resolve()}overrideSettings(t,e,i){t in this._override||(this._override[t]={}),this._override[t][e]=i}querySettings(t,e){if(t in this._override){const i=this._override[t];if(i&&e in i)return i[e]}if(t in this._settings){const i=this._settings[t];if(i&&e in i)return i[e]}return null}}t("Settings",ve),ve.Category=be;const Se=t("settings",new ve);let Te;h.settings=Se,function(t){t[t.PORTRAIT=1]="PORTRAIT",t[t.PORTRAIT_UPSIDE_DOWN=2]="PORTRAIT_UPSIDE_DOWN",t[t.LANDSCAPE_LEFT=4]="LANDSCAPE_LEFT",t[t.LANDSCAPE_RIGHT=8]="LANDSCAPE_RIGHT",t[t.LANDSCAPE=12]="LANDSCAPE",t[t.AUTO=13]="AUTO"}(Te||(Te={}));const we=t("macro",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:Te.PORTRAIT,ORIENTATION_PORTRAIT_UPSIDE_DOWN:Te.PORTRAIT_UPSIDE_DOWN,ORIENTATION_LANDSCAPE:Te.LANDSCAPE,ORIENTATION_LANDSCAPE_LEFT:Te.LANDSCAPE_LEFT,ORIENTATION_LANDSCAPE_RIGHT:Te.LANDSCAPE_RIGHT,ORIENTATION_AUTO:Te.AUTO,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,ENABLE_FLOAT_OUTPUT:!1,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20,ENABLE_WEBGL_HIGHP_STRUCT_VALUES:!1,BATCHER2D_MEM_INCREMENT:144,CUSTOM_PIPELINE_NAME:"Builtin",init(){this.CLEANUP_IMAGE_CACHE=!0;const t=Se.querySettings("engine","macros");if(t)for(const e in t)we[e]=t[e]}});function xe(t,e,...i){const s=performance.now(),r=requestAnimationFrame||window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(void 0===r)return setTimeout(t,e,...i);const n=()=>{performance.now()-s<e?r(n):t(...i)};return r(n)}h.macro=we;const Ce=/^(?:cc|dragonBones|sp|ccsg)\..+/,Ae=new Array(123);for(let t=0;t<123;++t)Ae[t]=64;for(let t=0;t<64;++t)Ae["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(t)]=t;const De=Ae;function Ee(t,e,i){function s(t,e,i,s){const r=Object.getOwnPropertyDescriptor(t,e);if(r)r.get&&i&&(t[i]=r.get),r.set&&s&&(t[s]=r.set);else{const r=t[i];vt(t,e,r,t[s])}}let r;const n=t.prototype;for(let t=0,i=e.length;t<i;++t){r=e[t];const i=r[0].toUpperCase()+r.slice(1);s(n,r,`get${i}`,`set${i}`)}for(r in i){const t=i[r];s(n,r,t[0],t[1])}}function Ie(t,e,i,s){const r=t[e];r?Array.isArray(r)?s?(r.push(r[0]),r[0]=i):r.push(i):t[e]=s?[i,r]:[r,i]:t[e]=i}function Me(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));{let i=e.parentNode;if(i)do{if(i===t)return!0;i=i.parentNode}while(null!==i);return!1}}function Pe(t){return"object"==typeof window&&"function"==typeof Node?t instanceof Node:!!t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}function Oe(t,...e){t&&xe((()=>{t(...e)}),0)}function Re(t){return!(!t||t.constructor!==Object)&&yt(t)}function Be(t,e,i){if(e>i){const t=e;e=i,i=t}return t<e?e:t<i?t:i}function Fe(t){return t*we.RAD}function Ne(t){return t*we.DEG}h.misc={BUILTIN_CLASSID_RE:Ce,BASE64_VALUES:De,propertyDefine:Ee,pushToMap:Ie,contains:Me,isDomNode:Pe,callInNextTick:Oe,isPlainEmptyObj_DEV:Re,clampf:Be,degreesToRadians:Fe,radiansToDegrees:Ne},t("misc",Object.freeze({__proto__:null,BASE64_VALUES:De,BUILTIN_CLASSID_RE:Ce,callInNextTick:Oe,clampf:Be,contains:Me,degreesToRadians:Fe,isDomNode:Pe,isPlainEmptyObj_DEV:Re,propertyDefine:Ee,pushToMap:Ie,radiansToDegrees:Ne,tryCatchFunctor_EDITOR:function(t){return Function("target",`try {\n  target.${t}();\n}\ncatch (e) {\n  cc._throw(e);\n}`)}}));const Le="$_$";function ke(t,e){const i=e?Object.create(e):{};return bt(t,"__attrs__",i),i}function ze(t){if("function"!=typeof t)return ke(t,Ve(t.constructor));let e;const i=h.Class.getInheritanceChain(t);for(let t=i.length-1;t>=0;t--){const s=i[t];s.hasOwnProperty("__attrs__")&&s.__attrs__||(e=i[t+1],ke(s,e&&e.__attrs__))}return e=i[0],ke(t,e&&e.__attrs__),t.__attrs__}function Ue(t,e){const i=Ve(t),s=e+Le,r={};for(const t in i)t.startsWith(s)&&(r[t.slice(s.length)]=i[t]);return r}function Ve(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||ze(t)}function je(t,e,i,s){Ve(t)[e+Le+i]=s}let He=class{constructor(t,e){this.name=t,this.default=e}toString(){return this.name}};const Ge=t("CCInteger",new He("Integer",0));h.Integer=Ge,h.CCInteger=Ge;const We=t("CCFloat",new He("Float",0));h.Float=We,h.CCFloat=We;const Xe=t("CCBoolean",new He("Boolean",!1));h.Boolean=Xe,h.CCBoolean=Xe;const Ye=t("CCString",new He("String",""));function qe(t,e){return function(i,s){const r=`"${xt(i)}.${s}"`,n=Ue(i,s);let o=n.type;if(o===Ge||o===We?o="Number":o!==Ye&&o!==Xe||(o=`${o}`),o!==t)return void j(3604,r);if(!n.hasOwnProperty("default"))return;const a=n.default;if(void 0===a)return;if(Array.isArray(a)||Re(a))return;const h=typeof a,l=t.toLowerCase();if(h===l)if("object"===l){if(!a||a instanceof n.ctor)return;j(3605,r,xt(n.ctor))}else"Number"!==t&&j(3606,e,r,t);else{if("function"===h)return;t===Ye.default&&null==a?j(3607,r):j(3611,e,r,h)}delete n.type}}h.String=Ye,h.CCString=Ye;var $e=Object.freeze({__proto__:null,CCBoolean:Xe,CCFloat:We,CCInteger:Ge,CCString:Ye,DELIMETER:Le,PrimitiveType:He,attr:Ue,createAttrs:ze,createAttrsSingle:ke,getClassAttrs:Ve,getObjTypeChecker_ET:function(t){return function(e,i){qe("Object","type")(e,i);const s=Ve(e)[`${i+Le}default`],r=h.Class.getDefault(s);if(!Array.isArray(r)&&kt(t,h.ValueType)){const r=xt(t),n=It('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',xt(e),i,r);s?I(n):j(3612,n,r,xt(e),i,r)}}},getTypeChecker_ET:qe,setClassAttr:je});const Ke={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function Ze(t,e,i,s){if(!t.get&&!t.set&&t.hasOwnProperty("default")){const r=`_N$${e}`;t.get=function(){return this[r]},t.set=function(t){const e=this[r];this[r]=t,i.call(this,e)};const n={};s[r]=n;for(const e in Ke){const i=Ke[e];t.hasOwnProperty(e)&&(n[e]=t[e],i.canUsedInGet||delete t[e])}}}function Qe(t,e,i,s){if(Array.isArray(e)){if(!(e.length>0))return G(5508,i,s);t.type=e=e[0]}"function"==typeof e&&(e===String?t.type=h.String:e===Boolean?t.type=h.Boolean:e===Number&&(t.type=h.Float))}function Je(t,e,i){const s=t||void 0===e?{_short:!0}:{_short:!0,default:e};return i&&(s.type=i),s}function ti(t,e){if(!t||t.constructor!==Object){if(Array.isArray(t)&&t.length>0)return Je(e,[],t);if("function"==typeof t){const i=t;return Je(e,kt(i,h.ValueType)?new i:null,i)}return t instanceof He?Je(e,void 0,t):Je(e,t)}return null}function ei(t,e){for(const i in t){let s=t[i];const r=ti(s,!1);if(r&&(s=t[i]=r),s){const r=s.notify;r&&Ze(s,i,r,t),"type"in s&&Qe(s,s.type,e,i)}}}let ii=[];function si(){return ii[ii.length-1]}function ri(t,e,i){ni(Ve(t),e,i)}function ni(t,e,i){t[`${e}${Le}type`]="Enum",t[`${e}${Le}enumList`]=pe.getList(i)}h._RF={push:function(t,e,i,s){void 0===i&&(i=e,e=""),ii.push({uuid:e,script:i,module:t,exports:t.exports,beh:null,importMeta:s})},pop:function(){const t=ii.pop(),e=t.module;let i=e.exports;if(i===t.exports){for(const t in i)return;e.exports=i=t.cls}},peek:si};const oi=Le,ai="__ctors__",hi=t("ENUM_TAG","Enum"),li=t("BITMASK_TAG","BitMask");function ci(t,e){t.indexOf(e)<0&&t.push(e)}function ui(t,e){ci(t.__props__,e)}function di(t,e,i,s){ui(t,i),Si(t,s,e,i)}function _i(t,e,i,s){const r=s.get;s.set,r&&(Si(t,s,e,i),je(t,i,"serializable",!1))}function pi(t){return"function"==typeof t?t():t}function mi(t,e,i){const s=i.ctor;return bt(s,ai,!0,!0),s.prototype,e&&(s.$super=e),Wt(t,s),s}function gi(t,e,i){const s=h.Component,r=si();if(r&&kt(e,s)){if(kt(r.cls,s))return G(3615),null;t=t||r.script}const n=mi(t,e,i);if(r)if(kt(e,s)){const t=r.uuid;t&&Ht(t,n),r.cls=n}else kt(r.cls,s)||(r.cls=n);return n}function fi(t,e,i,s){if(t.__props__=[],s&&s.__props__&&(t.__props__=s.__props__.slice()),i){ei(i,e);for(const s in i){const r=i[s];r.get||r.set?_i(t,e,s,r):di(t,e,s,r)}}const r=Ve(t);t.__values__=t.__props__.filter((t=>!1!==r[`${t}${oi}serializable`]))}function yi(t){let e=t.name;const i=t.extends,s=gi(e,i,t);e||(e=h.js.getClassName(s)),s._sealed=!0,i&&(i._sealed=!1),fi(s,e,t.properties,i);const r=t.editor;return r&&kt(i,h.Component)&&h.Component._registerEditorProps(s,r),s}function bi(t){return null==t||null==t.hasOwnProperty?void 0:t.hasOwnProperty("__values__")}yi._isCCClass=function(t){return null==t||null==t.hasOwnProperty?void 0:t.hasOwnProperty(ai)},yi.fastDefine=function(t,e,i){Wt(t,e);const s=e.__props__=e.__values__=Object.keys(i),r=Ve(e);for(let t=0;t<s.length;t++){const e=s[t];r[`${e+oi}visible`]=!1,r[`${e+oi}default`]=i[e]}},yi.Attr=$e,yi.attr=Ue,yi.isCCClassOrFastDefined=bi,yi.getInheritanceChain=function(t){const e=[];for(;t=Lt(t);)t!==Object&&e.push(t);return e};const vi={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function Si(t,e,i,s){let r=null,n="";function o(){return n=s+oi,r=Ve(t)}"type"in e&&void 0===e.type&&j(3660,s,i);const a=e.type;a&&(vi[a]?(r||o())[`${n}type`]=a:"Object"===a||("object"==typeof a?pe.isEnum(a)?ni(r||o(),s,a):ue.isBitMask(a)&&((r||o())[`${n}type`]=li,r[`${n}bitmaskList`]=ue.getList(a)):"function"==typeof a&&((r||o())[`${n}type`]="Object",r[`${n}ctor`]=a))),"default"in e&&((r||o())[`${n}default`]=e.default);const h=(t,i)=>{if(t in e){const s=e[t];typeof s===i&&((r||o())[n+t]=s)}};let l;e.editorOnly&&((r||o())[`${n}editorOnly`]=!0),1&e.__internalFlags?l=!0===e.serializable||!!(4&e.__internalFlags):!1===e.serializable&&(l=!1),void 0!==l&&((r||o())[`${n}serializable`]=l),h("formerlySerializedAs","string");const c=e.range;c&&Array.isArray(c)&&c.length>=2&&((r||o())[`${n}min`]=c[0],r[`${n}max`]=c[1],c.length>2&&(r[`${n}step`]=c[2])),h("step","number"),h("userData","object")}yi.isArray=function(t){return t=pi(t),Array.isArray(t)},yi.getDefault=pi,yi.escapeForJS=function(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},yi.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,yi.getNewValueTypeCode=function(t){const e=xt(t),i=t.constructor;let s=`new ${e}(`;for(let e=0;e<i.__props__.length;e++)s+=t[i.__props__[e]],e<i.__props__.length-1&&(s+=",");return`${s})`},h.Class=yi;const Ti=Math.abs,wi=Math.floor,xi=Math.PI,Ci=xi/180,Ai=180/xi;let Di=Math.random;const Ei=t("HALF_PI",.5*xi),Ii=t("TWO_PI",2*xi),Mi=t("EPSILON",1e-6);function Pi(t,e){return Ti(t-e)<=Mi*Math.max(1,Ti(t),Ti(e))}function Oi(t,e,i){return i=i||Mi,Ti(t-e)<=i}function Ri(t,e,i){if(e>i){const t=e;e=i,i=t}return t<e?e:t>i?i:t}function Bi(t){return t<0?0:t>1?1:t}function Fi(t,e,i){return t+(e-t)*i}function Ni(t){return t*Ci}function Li(t){return t*Ai}function ki(){return Di()}function zi(t){Di=t}function Ui(t,e){return ki()*(e-t)+t}function Vi(t,e){return wi(Ui(t,e))}function ji(t){return(t=(9301*t+49297)%233280)/233280}function Hi(t,e,i){return ji(t)*(i-e)+e}function Gi(t,e,i){return wi(Hi(t,e,i))}function Wi(t){return f(t)}function Xi(t,e){return t-wi(t/e)*e}function Yi(t,e){return t=Xi(t,2*e),e-Ti(t-e)}function qi(t,e,i){return(i-t)/(e-t)}function $i(t){return Ti(t.x)>Ti(t.y)?Ti(t.x)>Ti(t.z)?t.x:t.z:Ti(t.y)>Ti(t.z)?t.y:t.z}function Ki(t,e){return Ti(t)>Ti(e)?t:e}function Zi(t,e){e.forEach((e=>{Object.defineProperty(t,e,{enumerable:!0})}))}const Qi=function(){const t=new Float32Array(1),e=new Int32Array(t.buffer);return function(i){t[0]=i;const s=e[0],r=s>>16&32768,n=2147483647&s;let o=n-(112<<23)+4096>>13;return o=n<113<<23?0:o,o=n>=143<<23?31744:o,o=n>255<<23?32256:o,e[0]=r|o,e[0]}}(),Ji=function(){const t=new Float32Array(1),e=new Int32Array(t.buffer);return function(i){const s=32767&i;let r=s<<13,n=0;return 31744!==r?(r+=112<<23,0===s?r=(1048575&r)>>1:32767===s&&(r=2147483647)):r=2139095040,n=(i>>15&1)<<31|r,e[0]=n,t[0]}}();function ts(t){return Qi(t)}function es(t){return Ji(t)}const is=Math.abs,ss=Math.max,rs=Math.min,os=Math.PI,as=Math.sin,hs=Math.cos,ls=Math.atan2,cs=Math.sqrt,us=Math.ceil,ds=Math.floor,_s=Math.round;function ps(t,e,i,s){return Object.freeze(new ms(t,e,i,s))}class ms extends ye{static clone(t){return new ms(t.x,t.y,t.z,t.w)}static copy(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}static set(t,e,i,s,r){return t.x=e,t.y=i,t.z=s,t.w=r,t}static fromColor(t,e){return t.x=e.r,t.y=e.g,t.z=e.b,t.w=e.a,t}static angle(t,e){const i=t.y*e.z-t.z*e.y,s=t.z*e.x-t.x*e.z,r=t.x*e.y-t.y*e.x,n=t.x*e.x+t.y*e.y+t.z*e.z;return ls(cs(i*i+s*s+r*r),n)}static add(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t.w=e.w+i.w,t}static subtract(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t.w=e.w-i.w,t}static multiply(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t.w=e.w*i.w,t}static divide(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t.w=e.w/i.w,t}static ceil(t,e){return t.x=us(e.x),t.y=us(e.y),t.z=us(e.z),t.w=us(e.w),t}static floor(t,e){return t.x=ds(e.x),t.y=ds(e.y),t.z=ds(e.z),t.w=ds(e.w),t}static min(t,e,i){return t.x=rs(e.x,i.x),t.y=rs(e.y,i.y),t.z=rs(e.z,i.z),t.w=rs(e.w,i.w),t}static max(t,e,i){return t.x=ss(e.x,i.x),t.y=ss(e.y,i.y),t.z=ss(e.z,i.z),t.w=ss(e.w,i.w),t}static round(t,e){return t.x=_s(e.x),t.y=_s(e.y),t.z=_s(e.z),t.w=_s(e.w),t}static multiplyScalar(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t}static scaleAndAdd(t,e,i,s){return t.x=e.x+i.x*s,t.y=e.y+i.y*s,t.z=e.z+i.z*s,t.w=e.w+i.w*s,t}static distance(t,e){const i=e.x-t.x,s=e.y-t.y,r=e.z-t.z,n=e.w-t.w;return cs(i*i+s*s+r*r+n*n)}static squaredDistance(t,e){const i=e.x-t.x,s=e.y-t.y,r=e.z-t.z,n=e.w-t.w;return i*i+s*s+r*r+n*n}static len(t){const e=t.x,i=t.y,s=t.z,r=t.w;return cs(e*e+i*i+s*s+r*r)}static lengthSqr(t){const e=t.x,i=t.y,s=t.z,r=t.w;return e*e+i*i+s*s+r*r}static negate(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t}static inverse(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t.w=1/e.w,t}static inverseSafe(t,e){const i=e.x,s=e.y,r=e.z,n=e.w;return is(i)<Mi?t.x=0:t.x=1/i,is(s)<Mi?t.y=0:t.y=1/s,is(r)<Mi?t.z=0:t.z=1/r,is(n)<Mi?t.w=0:t.w=1/n,t}static normalize(t,e){const i=e.x,s=e.y,r=e.z,n=e.w;let o=i*i+s*s+r*r+n*n;return o>0?(o=1/cs(o),t.x=i*o,t.y=s*o,t.z=r*o,t.w=n*o):(t.x=0,t.y=0,t.z=0,t.w=0),t}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}static lerp(t,e,i,s){return t.x=e.x+s*(i.x-e.x),t.y=e.y+s*(i.y-e.y),t.z=e.z+s*(i.z-e.z),t.w=e.w+s*(i.w-e.w),t}static scale(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t}static random(t,e){e=e||1;const i=2*ki()*os,s=2*ki()-1,r=cs(1-s*s);return t.x=r*hs(i)*e,t.y=r*as(i)*e,t.z=s*e,t.w=0,t}static transformMat4(t,e,i){const s=e.x,r=e.y,n=e.z,o=e.w;return t.x=i.m00*s+i.m04*r+i.m08*n+i.m12*o,t.y=i.m01*s+i.m05*r+i.m09*n+i.m13*o,t.z=i.m02*s+i.m06*r+i.m10*n+i.m14*o,t.w=i.m03*s+i.m07*r+i.m11*n+i.m15*o,t}static transformAffine(t,e,i){const s=e.x,r=e.y,n=e.z,o=e.w;return t.x=i.m00*s+i.m04*r+i.m08*n+i.m12*o,t.y=i.m01*s+i.m05*r+i.m09*n+i.m13*o,t.z=i.m02*s+i.m06*r+i.m10*n+i.m14*o,t.w=e.w,t}static transformQuat(t,e,i){const{x:s,y:r,z:n}=e,o=i.x,a=i.y,h=i.z,l=i.w,c=l*s+a*n-h*r,u=l*r+h*s-o*n,d=l*n+o*r-a*s,_=-o*s-a*r-h*n;return t.x=c*l+_*-o+u*-h-d*-a,t.y=u*l+_*-a+d*-o-c*-h,t.z=d*l+_*-h+c*-a-u*-o,t.w=e.w,t}static toArray(t,e,i=0){return t[i+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t}static fromArray(t,e,i=0){return t.x=e[i+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t}static strictEquals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}static equals(t,e,i=Mi){const s=1/0;return!(is(t.x)===s||is(t.y)===s||is(t.z)===s||is(t.w)===s||is(e.x)===s||is(e.y)===s||is(e.z)===s||is(e.w)===s)&&is(t.x-e.x)<=i*ss(1,is(t.x),is(e.x))&&is(t.y-e.y)<=i*ss(1,is(t.y),is(e.y))&&is(t.z-e.z)<=i*ss(1,is(t.z),is(e.z))&&is(t.w-e.w)<=i*ss(1,is(t.w),is(e.w))}constructor(t,e,i,s){super(),"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=s||0)}clone(){return new ms(this.x,this.y,this.z,this.w)}set(t,e,i,s){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=s||0),this}equals(t,e=Mi){const i=this;return is(i.x-t.x)<=e*ss(1,is(i.x),is(t.x))&&is(i.y-t.y)<=e*ss(1,is(i.y),is(t.y))&&is(i.z-t.z)<=e*ss(1,is(i.z),is(t.z))&&is(i.w-t.w)<=e*ss(1,is(i.w),is(t.w))}equals4f(t,e,i,s,r=Mi){const n=this;return is(n.x-t)<=r*ss(1,is(n.x),is(t))&&is(n.y-e)<=r*ss(1,is(n.y),is(e))&&is(n.z-i)<=r*ss(1,is(n.z),is(i))&&is(n.w-s)<=r*ss(1,is(n.w),is(s))}strictEquals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}strictEquals4f(t,e,i,s){return this.x===t&&this.y===e&&this.z===i&&this.w===s}lerp(t,e){const i=this,s=i.x,r=i.y,n=i.z,o=i.w;return i.x=s+e*(t.x-s),i.y=r+e*(t.y-r),i.z=n+e*(t.z-n),i.w=o+e*(t.w-o),i}toString(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`}clampf(t,e){const i=this;return i.x=Ri(i.x,t.x,e.x),i.y=Ri(i.y,t.y,e.y),i.z=Ri(i.z,t.z,e.z),i.w=Ri(i.w,t.w,e.w),i}add(t){const e=this;return e.x+=t.x,e.y+=t.y,e.z+=t.z,e.w+=t.w,e}add4f(t,e,i,s){const r=this;return r.x+=t,r.y+=e,r.z+=i,r.w+=s,r}subtract(t){const e=this;return e.x-=t.x,e.y-=t.y,e.z-=t.z,e.w-=t.w,e}subtract4f(t,e,i,s){const r=this;return r.x-=t,r.y-=e,r.z-=i,r.w-=s,r}multiplyScalar(t){const e=this;return e.x*=t,e.y*=t,e.z*=t,e.w*=t,e}multiply(t){const e=this;return e.x*=t.x,e.y*=t.y,e.z*=t.z,e.w*=t.w,e}multiply4f(t,e,i,s){const r=this;return r.x*=t,r.y*=e,r.z*=i,r.w*=s,r}divide(t){const e=this;return e.x/=t.x,e.y/=t.y,e.z/=t.z,e.w/=t.w,e}divide4f(t,e,i,s){const r=this;return r.x/=t,r.y/=e,r.z/=i,r.w/=s,r}negative(){const t=this;return t.x=-t.x,t.y=-t.y,t.z=-t.z,t.w=-t.w,t}dot(t){const e=this;return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w}cross(t){const e=this,{x:i,y:s,z:r}=e,{x:n,y:o,z:a}=t;return e.x=s*a-r*o,e.y=r*n-i*a,e.z=i*o-s*n,e}length(){const t=this,e=t.x,i=t.y,s=t.z,r=t.w;return cs(e*e+i*i+s*s+r*r)}lengthSqr(){const t=this,e=t.x,i=t.y,s=t.z,r=t.w;return e*e+i*i+s*s+r*r}normalize(){const t=this,e=t.x,i=t.y,s=t.z,r=t.w;let n=e*e+i*i+s*s+r*r;return n>0&&(n=1/cs(n),t.x=e*n,t.y=i*n,t.z=s*n,t.w=r*n),t}scale(t){const e=this;return e.x*=t,e.y*=t,e.z*=t,e.w*=t,e}transformMat4(t){const e=this,i=e.x,s=e.y,r=e.z,n=e.w;return e.x=t.m00*i+t.m04*s+t.m08*r+t.m12*n,e.y=t.m01*i+t.m05*s+t.m09*r+t.m13*n,e.z=t.m02*i+t.m06*s+t.m10*r+t.m14*n,e.w=t.m03*i+t.m07*s+t.m11*r+t.m15*n,e}}function gs(t,e,i,s){return new ms(t,e,i,s)}var fs;t("Vec4",ms),ms.ZERO=ps(0,0,0,0),ms.ONE=ps(1,1,1,1),ms.NEG_ONE=ps(-1,-1,-1,-1),ms.UNIT_X=ps(1,0,0,0),ms.UNIT_Y=ps(0,1,0,0),ms.UNIT_Z=ps(0,0,1,0),ms.UNIT_W=ps(0,0,0,1),yi.fastDefine("cc.Vec4",ms,{x:0,y:0,z:0,w:0}),h.Vec4=ms,h.v4=gs;const ys=Math.abs,bs=Math.max,vs=Math.min,Ss=Math.PI,Ts=Math.acos,ws=Math.sin,xs=Math.cos,Cs=Math.sqrt,As=Math.ceil,Ds=Math.floor,Es=Math.round;function Is(t,e,i){return Object.freeze(new Ms(t,e,i))}class Ms extends ye{static zero(t){return t.x=0,t.y=0,t.z=0,t}static clone(t){return new Ms(t.x,t.y,t.z)}static copy(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t}static set(t,e,i,s){return t.x=e,t.y=i,t.z=s,t}static add(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t.z=e.z+i.z,t}static subtract(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t.z=e.z-i.z,t}static multiply(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t.z=e.z*i.z,t}static divide(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t.z=e.z/i.z,t}static ceil(t,e){return t.x=As(e.x),t.y=As(e.y),t.z=As(e.z),t}static floor(t,e){return t.x=Ds(e.x),t.y=Ds(e.y),t.z=Ds(e.z),t}static min(t,e,i){return t.x=vs(e.x,i.x),t.y=vs(e.y,i.y),t.z=vs(e.z,i.z),t}static max(t,e,i){return t.x=bs(e.x,i.x),t.y=bs(e.y,i.y),t.z=bs(e.z,i.z),t}static round(t,e){return t.x=Es(e.x),t.y=Es(e.y),t.z=Es(e.z),t}static multiplyScalar(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t}static scaleAndAdd(t,e,i,s){return t.x=e.x+i.x*s,t.y=e.y+i.y*s,t.z=e.z+i.z*s,t}static distance(t,e){const i=e.x-t.x,s=e.y-t.y,r=e.z-t.z;return Cs(i*i+s*s+r*r)}static squaredDistance(t,e){const i=e.x-t.x,s=e.y-t.y,r=e.z-t.z;return i*i+s*s+r*r}static len(t){const e=t.x,i=t.y,s=t.z;return Cs(e*e+i*i+s*s)}static lengthSqr(t){const e=t.x,i=t.y,s=t.z;return e*e+i*i+s*s}static negate(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t}static invert(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t}static invertSafe(t,e){const i=e.x,s=e.y,r=e.z;return ys(i)<Mi?t.x=0:t.x=1/i,ys(s)<Mi?t.y=0:t.y=1/s,ys(r)<Mi?t.z=0:t.z=1/r,t}static normalize(t,e){const i=e.x,s=e.y,r=e.z;let n=i*i+s*s+r*r;return n>0?(n=1/Cs(n),t.x=i*n,t.y=s*n,t.z=r*n):(t.x=0,t.y=0,t.z=0),t}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,e,i){const{x:s,y:r,z:n}=e,{x:o,y:a,z:h}=i;return t.x=r*h-n*a,t.y=n*o-s*h,t.z=s*a-r*o,t}static lerp(t,e,i,s){return t.x=e.x+s*(i.x-e.x),t.y=e.y+s*(i.y-e.y),t.z=e.z+s*(i.z-e.z),t}static random(t,e){e=e||1;const i=2*ki()*Ss,s=2*ki()-1,r=Cs(1-s*s);return t.x=r*xs(i)*e,t.y=r*ws(i)*e,t.z=s*e,t}static transformMat4(t,e,i){const s=e.x,r=e.y,n=e.z;let o=i.m03*s+i.m07*r+i.m11*n+i.m15;return o=o?1/o:1,t.x=(i.m00*s+i.m04*r+i.m08*n+i.m12)*o,t.y=(i.m01*s+i.m05*r+i.m09*n+i.m13)*o,t.z=(i.m02*s+i.m06*r+i.m10*n+i.m14)*o,t}static transformMat4Normal(t,e,i){const s=e.x,r=e.y,n=e.z;let o=i.m03*s+i.m07*r+i.m11*n;return o=o?1/o:1,t.x=(i.m00*s+i.m04*r+i.m08*n)*o,t.y=(i.m01*s+i.m05*r+i.m09*n)*o,t.z=(i.m02*s+i.m06*r+i.m10*n)*o,t}static transformMat3(t,e,i){const s=e.x,r=e.y,n=e.z;return t.x=s*i.m00+r*i.m03+n*i.m06,t.y=s*i.m01+r*i.m04+n*i.m07,t.z=s*i.m02+r*i.m05+n*i.m08,t}static transformAffine(t,e,i){const s=e.x,r=e.y,n=e.z;return t.x=i.m00*s+i.m04*r+i.m08*n+i.m12,t.y=i.m01*s+i.m05*r+i.m09*n+i.m13,t.z=i.m02*s+i.m06*r+i.m10*n+i.m14,t}static transformQuat(t,e,i){const s=i.w*e.x+i.y*e.z-i.z*e.y,r=i.w*e.y+i.z*e.x-i.x*e.z,n=i.w*e.z+i.x*e.y-i.y*e.x,o=-i.x*e.x-i.y*e.y-i.z*e.z;return t.x=s*i.w+o*-i.x+r*-i.z-n*-i.y,t.y=r*i.w+o*-i.y+n*-i.x-s*-i.z,t.z=n*i.w+o*-i.z+s*-i.y-r*-i.x,t}static transformRTS(t,e,i,s,r){const n=e.x*r.x,o=e.y*r.y,a=e.z*r.z,h=i.w*n+i.y*a-i.z*o,l=i.w*o+i.z*n-i.x*a,c=i.w*a+i.x*o-i.y*n,u=-i.x*n-i.y*o-i.z*a;return t.x=h*i.w+u*-i.x+l*-i.z-c*-i.y+s.x,t.y=l*i.w+u*-i.y+c*-i.x-h*-i.z+s.y,t.z=c*i.w+u*-i.z+h*-i.y-l*-i.x+s.z,t}static transformInverseRTS(t,e,i,s,r){const n=e.x-s.x,o=e.y-s.y,a=e.z-s.z,h=i.w*n-i.y*a+i.z*o,l=i.w*o-i.z*n+i.x*a,c=i.w*a-i.x*o+i.y*n,u=i.x*n+i.y*o+i.z*a;return t.x=(h*i.w+u*i.x+l*i.z-c*i.y)/r.x,t.y=(l*i.w+u*i.y+c*i.x-h*i.z)/r.y,t.z=(c*i.w+u*i.z+h*i.y-l*i.x)/r.z,t}static rotateX(t,e,i,s){const r=e.x-i.x,n=e.y-i.y,o=e.z-i.z,a=xs(s),h=ws(s),l=r,c=n*a-o*h,u=n*h+o*a;return t.x=l+i.x,t.y=c+i.y,t.z=u+i.z,t}static rotateY(t,e,i,s){const r=e.x-i.x,n=e.y-i.y,o=e.z-i.z,a=xs(s),h=ws(s),l=o*h+r*a,c=n,u=o*a-r*h;return t.x=l+i.x,t.y=c+i.y,t.z=u+i.z,t}static rotateZ(t,e,i,s){const r=e.x-i.x,n=e.y-i.y,o=e.z-i.z,a=xs(s),h=ws(s),l=r*a-n*h,c=r*h+n*a,u=o;return t.x=l+i.x,t.y=c+i.y,t.z=u+i.z,t}static rotateN(t,e,i,s,r){const n=e.x-i.x,o=e.y-i.y,a=e.z-i.z,h=s.x,l=s.y,c=s.z,u=xs(r),d=ws(r),_=n*(h*h*(1-u)+u)+o*(h*l*(1-u)-c*d)+a*(h*c*(1-u)+l*d),p=n*(h*l*(1-u)+c*d)+o*(l*l*(1-u)+u)+a*(l*c*(1-u)-h*d),m=n*(h*c*(1-u)-l*d)+o*(l*c*(1-u)+h*d)+a*(c*c*(1-u)+u);return t.x=_+i.x,t.y=p+i.y,t.z=m+i.z,t}static toArray(t,e,i=0){return t[i+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t}static fromArray(t,e,i=0){return t.x=e[i+0],t.y=e[i+1],t.z=e[i+2],t}static strictEquals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}static equals(t,e,i=Mi){const{x:s,y:r,z:n}=t,{x:o,y:a,z:h}=e;return ys(s-o)<=i*bs(1,ys(s),ys(o))&&ys(r-a)<=i*bs(1,ys(r),ys(a))&&ys(n-h)<=i*bs(1,ys(n),ys(h))}static angle(t,e){const i=t.x*t.x+t.y*t.y+t.z*t.z,s=e.x*e.x+e.y*e.y+e.z*e.z;if(0===i||0===s)return 0;let r=(t.x*e.x+t.y*e.y+t.z*e.z)/Cs(i*s);return r=Ri(r,-1,1),Ts(r)}static projectOnPlane(t,e,i){return Ms.subtract(t,e,Ms.project(t,e,i))}static project(t,e,i){const s=Ms.lengthSqr(i);return s<1e-6?Ms.set(t,0,0,0):Ms.multiplyScalar(t,i,Ms.dot(e,i)/s)}static moveTowards(t,e,i,s){const r=i.x-e.x,n=i.y-e.y,o=i.z-e.z,a=r*r+n*n+o*o;if(0===a||s>=0&&a<s*s)return t.x=i.x,t.y=i.y,t.z=i.z,t;const h=s/Cs(a);return t.x=e.x+r*h,t.y=e.y+n*h,t.z=e.z+o*h,t}static generateOrthogonal(t,e){const{x:i,y:s,z:r}=e,n=ys(i),o=ys(s),a=ys(r);return n<o&&n<a?Ms.set(t,0,r,-s):o<a?Ms.set(t,r,0,-i):Ms.set(t,s,-i,0),Ms.normalize(t,t)}constructor(t,e,i){super(),"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0)}clone(){return new Ms(this.x,this.y,this.z)}set(t,e,i){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0),this}equals(t,e=Mi){return ys(this.x-t.x)<=e&&ys(this.y-t.y)<=e&&ys(this.z-t.z)<=e}equals3f(t,e,i,s=Mi){return ys(this.x-t)<=s&&ys(this.y-e)<=s&&ys(this.z-i)<=s}strictEquals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}strictEquals3f(t,e,i){return this.x===t&&this.y===e&&this.z===i}toString(){return`(${this.x}, ${this.y}, ${this.z})`}lerp(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add3f(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subtract3f(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}multiplyScalar(t){return"object"==typeof t&&j(16357),this.x*=t,this.y*=t,this.z*=t,this}multiply(t){return"object"!=typeof t&&j(16358),this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiply3f(t,e,i){return this.x*=t,this.y*=e,this.z*=i,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divide3f(t,e,i){return this.x/=t,this.y/=e,this.z/=i,this}negative(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}clampf(t,e){return this.x=Ri(this.x,t.x,e.x),this.y=Ri(this.y,t.y,e.y),this.z=Ri(this.z,t.z,e.z),this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){const{x:e,y:i,z:s}=this,{x:r,y:n,z:o}=t;return this.x=i*o-s*n,this.y=s*r-e*o,this.z=e*n-i*r,this}length(){const t=this;return Cs(t.x*t.x+t.y*t.y+t.z*t.z)}lengthSqr(){const t=this;return t.x*t.x+t.y*t.y+t.z*t.z}normalize(){const t=this,e=t.x,i=t.y,s=t.z;let r=e*e+i*i+s*s;return r>0&&(r=1/Cs(r),t.x=e*r,t.y=i*r,t.z=s*r),t}transformMat4(t){const e=this,i=e.x,s=e.y,r=e.z;let n=t.m03*i+t.m07*s+t.m11*r+t.m15;return n=n?1/n:1,e.x=(t.m00*i+t.m04*s+t.m08*r+t.m12)*n,e.y=(t.m01*i+t.m05*s+t.m09*r+t.m13)*n,e.z=(t.m02*i+t.m06*s+t.m10*r+t.m14)*n,e}toVec2(){return new h.Vec2(this.x,this.y)}}function Ps(t,e,i){return new Ms(t,e,i)}t("Vec3",Ms),fs=Ms,Ms.UNIT_X=Is(1,0,0),Ms.UNIT_Y=Is(0,1,0),Ms.UNIT_Z=Is(0,0,1),Ms.RIGHT=Is(1,0,0),Ms.UP=Is(0,1,0),Ms.FORWARD=Is(0,0,-1),Ms.ZERO=Is(0,0,0),Ms.ONE=Is(1,1,1),Ms.NEG_ONE=Is(-1,-1,-1),Ms.slerp=(()=>{const t=new fs,e=new fs,i=new fs;return(s,r,n,o)=>{const a=1e-5,h=fs.len(r),l=fs.len(n);if(h<a||l<a)return fs.lerp(s,r,n,o);const c=Fi(h,l,o),u=fs.dot(r,n)/(h*l);if(u>.99999)return fs.lerp(s,r,n,o);if(u<-.99999){const n=fs.multiplyScalar(t,r,1/h),a=fs.generateOrthogonal(e,n);return Os(i,n,a,Ss*o),fs.multiplyScalar(s,i,c),s}{const a=u,d=Ts(a)*o,_=fs.multiplyScalar(t,r,1/h),p=fs.multiplyScalar(e,n,1/l);return fs.scaleAndAdd(i,p,_,-a),fs.normalize(i,i),fs.multiplyScalar(i,i,ws(d)),fs.scaleAndAdd(i,i,_,xs(d)),fs.multiplyScalar(s,i,c),s}}})(),Ms.signedAngle=(()=>{const t=new fs;return(e,i,s)=>{const r=fs.angle(e,i),n=fs.cross(t,e,i);return fs.dot(n,s)<0?-r:r}})(),yi.fastDefine("cc.Vec3",Ms,{x:0,y:0,z:0}),h.Vec3=Ms;const Os=(()=>{const t={x:0,y:0,z:0,w:0};return(e,i,s,r)=>{const n=.5*r,o=ws(n);return t.x=o*s.x,t.y=o*s.y,t.z=o*s.z,t.w=xs(n),Ms.transformQuat(e,i,t),e}})();h.v3=Ps;const Rs=1/255,Bs=Math.abs,Fs=Math.max;function Ns(t,e,i,s){return Object.freeze(new Ls(t,e,i,s))}let Ls=class t extends ye{static clone(e){const i=new t;return i.r=e.r,i.g=e.g,i.b=e.b,i.a=e.a,i}static copy(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t}static set(t,e,i,s,r){return t.r=e,t.g=i,t.b=s,t.a=r,t}static toVec4(t,e){const i=t._data;return(e=void 0!==e?e:new ms).x=i[0]*Rs,e.y=i[1]*Rs,e.z=i[2]*Rs,e.w=i[3]*Rs,e}static fromVec4(e,i){const s=(i=void 0===i?new t:i)._data;return s[0]=e.x/Rs,s[1]=e.y/Rs,s[2]=e.z/Rs,s[3]=e.w/Rs,i}static fromHEX(t,e){let i;return"string"==typeof e?(6===(e="#"===e[0]?e.substring(1):e).length?e+="FF":3===e.length?e=`${e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}FF`:4===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),i=Number(`0x${e}`)):(e<16777216&&(e=255+(e<<8)),i=e),t.r=i>>>24,t.g=(16711680&i)>>>16,t.b=(65280&i)>>>8,t.a=255&i,t}static add(t,e,i){return t.r=e.r+i.r,t.g=e.g+i.g,t.b=e.b+i.b,t.a=e.a+i.a,t}static subtract(t,e,i){return t.r=e.r-i.r,t.g=e.g-i.g,t.b=e.b-i.b,t.a=e.a-i.a,t}static multiply(t,e,i){return t.r=e.r*i.r,t.g=e.g*i.g,t.b=e.b*i.b,t.a=e.a*i.a,t}static divide(t,e,i){return t.r=e.r/i.r,t.g=e.g/i.g,t.b=e.b/i.b,t.a=e.a/i.a,t}static scale(t,e,i){return t.r=e.r*i,t.g=e.g*i,t.b=e.b*i,t.a=e.a*i,t}static lerp(t,e,i,s){const r=e.r,n=e.g,o=e.b,a=e.a;return t.r=r+(i.r-r)*s,t.g=n+(i.g-n)*s,t.b=o+(i.b-o)*s,t.a=a+(i.a-a)*s,t}static toArray(e,i,s=0){const r=i instanceof t||i.a>1?1/255:1;return e[s+0]=i.r*r,e[s+1]=i.g*r,e[s+2]=i.b*r,e[s+3]=i.a*r,e}static fromArray(t,e,i=0){return e.r=255*t[i+0],e.g=255*t[i+1],e.b=255*t[i+2],e.a=255*t[i+3],e}static fromUint32(t,e){return e>>>=0,t.r=255&e,t.g=e>>8&255,t.b=e>>16&255,t.a=e>>24&255,t}static toUint32(t){return(t.a<<24|t.b<<16|t.g<<8|t.r)>>>0}static strictEquals(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a}static equals(t,e,i=Mi){return!(Bs(t.r)===1/0||Bs(t.g)===1/0||Bs(t.b)===1/0||Bs(t.a)===1/0)&&Bs(t.r-e.r)<=i*Fs(1,Bs(t.r),Bs(e.r))&&Bs(t.g-e.g)<=i*Fs(1,Bs(t.g),Bs(e.g))&&Bs(t.b-e.b)<=i*Fs(1,Bs(t.b),Bs(e.b))&&Bs(t.a-e.a)<=i*Fs(1,Bs(t.a),Bs(e.a))}static hex(t){return(255*t.r<<24|255*t.g<<16|255*t.b<<8|255*t.a)>>>0}get r(){return this._data[0]}set r(t){this._data[0]=t}get g(){return this._data[1]}set g(t){this._data[1]=t}get b(){return this._data[2]}set b(t){this._data[2]=t}get a(){return this._data[3]}set a(t){this._data[3]=t}get x(){return this._data[0]*Rs}set x(t){this._data[0]=255*t}get y(){return this._data[1]*Rs}set y(t){this._data[1]=255*t}get z(){return this._data[2]*Rs}set z(t){this._data[2]=255*t}get w(){return this._data[3]*Rs}set w(t){this._data[3]=255*t}constructor(t,e,i,s){super(),this._data=new Uint8ClampedArray(4),"string"==typeof t?this.fromHEX(t):void 0!==e?this.set(t,e,i,s):this.set(t)}clone(){const e=new t;return e._data.set(this._data),e}equals(t){const e=t,i=this._data;return t&&i[0]===e.r&&i[1]===e.g&&i[2]===e.b&&i[3]===e.a}lerp(e,i){return t.lerp(this,this,e,i),this}toString(){return`rgba(${this.r.toFixed()}, ${this.g.toFixed()}, ${this.b.toFixed()}, ${this.a.toFixed()})`}toCSS(t="rgba"){return"rgba"===t?`rgba(${this.r},${this.g},${this.b},${(this.a*Rs).toFixed(2)})`:"rgb"===t?`rgb(${this.r},${this.g},${this.b})`:`#${this.toHEX(t)}`}fromHEX(t){let e;return"string"==typeof t?(6===(t="#"===t[0]?t.substring(1):t).length?t+="FF":3===t.length?t=`${t[0]+t[0]+t[1]+t[1]+t[2]+t[2]}FF`:4===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),e=Number(`0x${t}`)):(t<16777216&&(t=255+(t<<8)),e=t),this.r=e>>>24,this.g=(16711680&e)>>>16,this.b=(65280&e)>>>8,this.a=255&e,this}toHEX(t="#rrggbb"){const e=this._data,i="0",s=[(e[0]<16?i:"")+e[0].toString(16),(e[1]<16?i:"")+e[1].toString(16),(e[2]<16?i:"")+e[2].toString(16)];return"#rgb"===t?(s[0]=s[0][0],s[1]=s[1][0],s[2]=s[2][0]):"#rrggbbaa"===t&&s.push((e[3]<16?i:"")+e[3].toString(16)),s.join("")}toRGBValue(){return this._data[2]<<16|this._data[1]<<8|this._data[0]}fromHSV(t,e,i){let s=0,r=0,n=0;if(0===e)s=r=n=i;else if(0===i)s=r=n=0;else{1===t&&(t=0),t*=6;const o=Math.floor(t),a=t-o,h=i*(1-e),l=i*(1-e*a),c=i*(1-e*(1-a));switch(o){default:case 0:s=i,r=c,n=h;break;case 1:s=l,r=i,n=h;break;case 2:s=h,r=i,n=c;break;case 3:s=h,r=l,n=i;break;case 4:s=c,r=h,n=i;break;case 5:s=i,r=h,n=l}}const o=this._data;return o[0]=255*s,o[1]=255*r,o[2]=255*n,this}toHSV(){const t=this._data[0]*Rs,e=this._data[1]*Rs,i=this._data[2]*Rs,s={h:0,s:0,v:0},r=Math.max(t,e,i),n=Math.min(t,e,i);let o=0;return s.v=r,s.s=r?(r-n)/r:0,s.s?(o=r-n,s.h=t===r?(e-i)/o:e===r?2+(i-t)/o:4+(t-e)/o,s.h/=6,s.h<0&&(s.h+=1)):s.h=0,s}set(t,e,i,s){const r=this._data;if("object"==typeof t){const e=t;var n,o,a,h;e._data?r.set(e._data):(r[0]=null!==(n=e.r)&&void 0!==n?n:0,r[1]=null!==(o=e.g)&&void 0!==o?o:0,r[2]=null!==(a=e.b)&&void 0!==a?a:0,r[3]=null!==(h=e.a)&&void 0!==h?h:255)}else r[0]=null!=t?t:0,r[1]=null!=e?e:0,r[2]=null!=i?i:0,r[3]=null!=s?s:255;return this}multiply(t){const e=this._data;return e[0]*=t.r/255,e[1]*=t.g/255,e[2]*=t.b/255,e[3]*=t.a/255,this}getModifiableProperties(){return["r","g","b","a"]}};function ks(t,e,i,s){return new Ls(t,e,i,s)}var zs;t("Color",Ls),Ls.WHITE=Ns(255,255,255,255),Ls.GRAY=Ns(127,127,127,255),Ls.BLACK=Ns(0,0,0,255),Ls.TRANSPARENT=Ns(0,0,0,0),Ls.RED=Ns(255,0,0,255),Ls.GREEN=Ns(0,255,0,255),Ls.BLUE=Ns(0,0,255,255),Ls.CYAN=Ns(0,255,255,255),Ls.MAGENTA=Ns(255,0,255,255),Ls.YELLOW=Ns(255,255,0,255),yi.fastDefine("cc.Color",Ls,{r:0,g:0,b:0,a:255}),h.Color=Ls,h.color=ks;const Us=Math.abs,Vs=Math.max;class js extends ye{static clone(t){return new js(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)}static copy(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t}static set(t,e,i,s,r,n,o,a,h,l){return t.m00=e,t.m01=i,t.m02=s,t.m03=r,t.m04=n,t.m05=o,t.m06=a,t.m07=h,t.m08=l,t}static identity(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t}static transpose(t,e){if(t===e){const i=e.m01,s=e.m02,r=e.m05;t.m01=e.m03,t.m02=e.m06,t.m03=i,t.m05=e.m07,t.m06=s,t.m07=r}else t.m00=e.m00,t.m01=e.m03,t.m02=e.m06,t.m03=e.m01,t.m04=e.m04,t.m05=e.m07,t.m06=e.m02,t.m07=e.m05,t.m08=e.m08;return t}static invert(t,e){const i=e.m00,s=e.m01,r=e.m02,n=e.m03,o=e.m04,a=e.m05,h=e.m06,l=e.m07,c=e.m08,u=c*o-a*l,d=-c*n+a*h,_=l*n-o*h;let p=i*u+s*d+r*_;return 0===p?(js.set(t,0,0,0,0,0,0,0,0,0),t):(p=1/p,t.m00=u*p,t.m01=(-c*s+r*l)*p,t.m02=(a*s-r*o)*p,t.m03=d*p,t.m04=(c*i-r*h)*p,t.m05=(-a*i+r*n)*p,t.m06=_*p,t.m07=(-l*i+s*h)*p,t.m08=(o*i-s*n)*p,t)}static determinant(t){const e=t.m00,i=t.m01,s=t.m02,r=t.m03,n=t.m04,o=t.m05,a=t.m06,h=t.m07,l=t.m08;return e*(l*n-o*h)+i*(-l*r+o*a)+s*(h*r-n*a)}static multiply(t,e,i){const s=e.m00,r=e.m01,n=e.m02,o=e.m03,a=e.m04,h=e.m05,l=e.m06,c=e.m07,u=e.m08,d=i.m00,_=i.m01,p=i.m02,m=i.m03,g=i.m04,f=i.m05,y=i.m06,b=i.m07,v=i.m08;return t.m00=d*s+_*o+p*l,t.m01=d*r+_*a+p*c,t.m02=d*n+_*h+p*u,t.m03=m*s+g*o+f*l,t.m04=m*r+g*a+f*c,t.m05=m*n+g*h+f*u,t.m06=y*s+b*o+v*l,t.m07=y*r+b*a+v*c,t.m08=y*n+b*h+v*u,t}static multiplyMat4(t,e,i){const s=e.m00,r=e.m01,n=e.m02,o=e.m03,a=e.m04,h=e.m05,l=e.m06,c=e.m07,u=e.m08,d=i.m00,_=i.m01,p=i.m02,m=i.m04,g=i.m05,f=i.m06,y=i.m08,b=i.m09,v=i.m10;return t.m00=d*s+_*o+p*l,t.m01=d*r+_*a+p*c,t.m02=d*n+_*h+p*u,t.m03=m*s+g*o+f*l,t.m04=m*r+g*a+f*c,t.m05=m*n+g*h+f*u,t.m06=y*s+b*o+v*l,t.m07=y*r+b*a+v*c,t.m08=y*n+b*h+v*u,t}static transform(t,e,i){this.translate(t,e,i)}static translate(t,e,i){const s=e.m00,r=e.m01,n=e.m02,o=e.m03,a=e.m04,h=e.m05,l=e.m06,c=e.m07,u=e.m08,d=i.x,_=i.y;return t.m00=s,t.m01=r,t.m02=n,t.m03=o,t.m04=a,t.m05=h,t.m06=d*s+_*o+l,t.m07=d*r+_*a+c,t.m08=d*n+_*h+u,t}static scale(t,e,i){const s=i.x,r=i.y;return t.m00=s*e.m00,t.m01=s*e.m01,t.m02=s*e.m02,t.m03=r*e.m03,t.m04=r*e.m04,t.m05=r*e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t}static rotate(t,e,i){const s=e.m00,r=e.m01,n=e.m02,o=e.m03,a=e.m04,h=e.m05,l=e.m06,c=e.m07,u=e.m08,d=Math.sin(i),_=Math.cos(i);return t.m00=_*s+d*o,t.m01=_*r+d*a,t.m02=_*n+d*h,t.m03=_*o-d*s,t.m04=_*a-d*r,t.m05=_*h-d*n,t.m06=l,t.m07=c,t.m08=u,t}static fromMat4(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m04,t.m04=e.m05,t.m05=e.m06,t.m06=e.m08,t.m07=e.m09,t.m08=e.m10,t}static fromViewUp(t,e,i){return Ms.lengthSqr(e)<Mi*Mi?(js.identity(t),t):(i=i||Ms.UNIT_Y,Ms.normalize(Hs,Ms.cross(Hs,i,e)),Ms.lengthSqr(Hs)<Mi*Mi?(js.identity(t),t):(Ms.cross(Gs,e,Hs),js.set(t,Hs.x,Hs.y,Hs.z,Gs.x,Gs.y,Gs.z,e.x,e.y,e.z),t))}static fromTranslation(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=e.x,t.m07=e.y,t.m08=1,t}static fromScaling(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=e.y,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t}static fromRotation(t,e){const i=Math.sin(e),s=Math.cos(e);return t.m00=s,t.m01=i,t.m02=0,t.m03=-i,t.m04=s,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t}static fromQuat(t,e){const i=e.x,s=e.y,r=e.z,n=e.w,o=i+i,a=s+s,h=r+r,l=i*o,c=s*o,u=s*a,d=r*o,_=r*a,p=r*h,m=n*o,g=n*a,f=n*h;return t.m00=1-u-p,t.m03=c-f,t.m06=d+g,t.m01=c+f,t.m04=1-l-p,t.m07=_-m,t.m02=d-g,t.m05=_+m,t.m08=1-l-u,t}static inverseTransposeMat4(t,e){const i=e.m00,s=e.m01,r=e.m02,n=e.m03,o=e.m04,a=e.m05,h=e.m06,l=e.m07,c=e.m08,u=e.m09,d=e.m10,_=e.m11,p=e.m12,m=e.m13,g=e.m14,f=e.m15,y=i*a-s*o,b=i*h-r*o,v=i*l-n*o,S=s*h-r*a,T=s*l-n*a,w=r*l-n*h,x=c*m-u*p,C=c*g-d*p,A=c*f-_*p,D=u*g-d*m,E=u*f-_*m,I=d*f-_*g;let M=y*I-b*E+v*D+S*A-T*C+w*x;return M?(M=1/M,t.m00=(a*I-h*E+l*D)*M,t.m01=(h*A-o*I-l*C)*M,t.m02=(o*E-a*A+l*x)*M,t.m03=(r*E-s*I-n*D)*M,t.m04=(i*I-r*A+n*C)*M,t.m05=(s*A-i*E-n*x)*M,t.m06=(m*w-g*T+f*S)*M,t.m07=(g*v-p*w-f*b)*M,t.m08=(p*T-m*v+f*y)*M,t):null}static toArray(t,e,i=0){return t[i+0]=e.m00,t[i+1]=e.m01,t[i+2]=e.m02,t[i+3]=e.m03,t[i+4]=e.m04,t[i+5]=e.m05,t[i+6]=e.m06,t[i+7]=e.m07,t[i+8]=e.m08,t}static fromArray(t,e,i=0){return t.m00=e[i+0],t.m01=e[i+1],t.m02=e[i+2],t.m03=e[i+3],t.m04=e[i+4],t.m05=e[i+5],t.m06=e[i+6],t.m07=e[i+7],t.m08=e[i+8],t}static add(t,e,i){return t.m00=e.m00+i.m00,t.m01=e.m01+i.m01,t.m02=e.m02+i.m02,t.m03=e.m03+i.m03,t.m04=e.m04+i.m04,t.m05=e.m05+i.m05,t.m06=e.m06+i.m06,t.m07=e.m07+i.m07,t.m08=e.m08+i.m08,t}static subtract(t,e,i){return t.m00=e.m00-i.m00,t.m01=e.m01-i.m01,t.m02=e.m02-i.m02,t.m03=e.m03-i.m03,t.m04=e.m04-i.m04,t.m05=e.m05-i.m05,t.m06=e.m06-i.m06,t.m07=e.m07-i.m07,t.m08=e.m08-i.m08,t}static multiplyScalar(t,e,i){return t.m00=e.m00*i,t.m01=e.m01*i,t.m02=e.m02*i,t.m03=e.m03*i,t.m04=e.m04*i,t.m05=e.m05*i,t.m06=e.m06*i,t.m07=e.m07*i,t.m08=e.m08*i,t}static multiplyScalarAndAdd(t,e,i,s){return t.m00=i.m00*s+e.m00,t.m01=i.m01*s+e.m01,t.m02=i.m02*s+e.m02,t.m03=i.m03*s+e.m03,t.m04=i.m04*s+e.m04,t.m05=i.m05*s+e.m05,t.m06=i.m06*s+e.m06,t.m07=i.m07*s+e.m07,t.m08=i.m08*s+e.m08,t}static strictEquals(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08}static equals(t,e,i=Mi){return Us(t.m00-e.m00)<=i*Vs(1,Us(t.m00),Us(e.m00))&&Us(t.m01-e.m01)<=i*Vs(1,Us(t.m01),Us(e.m01))&&Us(t.m02-e.m02)<=i*Vs(1,Us(t.m02),Us(e.m02))&&Us(t.m03-e.m03)<=i*Vs(1,Us(t.m03),Us(e.m03))&&Us(t.m04-e.m04)<=i*Vs(1,Us(t.m04),Us(e.m04))&&Us(t.m05-e.m05)<=i*Vs(1,Us(t.m05),Us(e.m05))&&Us(t.m06-e.m06)<=i*Vs(1,Us(t.m06),Us(e.m06))&&Us(t.m07-e.m07)<=i*Vs(1,Us(t.m07),Us(e.m07))&&Us(t.m08-e.m08)<=i*Vs(1,Us(t.m08),Us(e.m08))}static toEuler(t,e){const i=t.m00,s=t.m01;t.m02;const r=t.m03,n=t.m04;t.m05;const o=t.m06,a=t.m07,h=t.m08;return a<.999?a>-.999?(e.x=Math.asin(-a),e.y=Math.atan2(o,h),e.z=Math.atan2(s,n),!0):(e.x=Ei,e.y=Math.atan2(r,i),e.z=0,!1):(e.x=-Ei,e.y=Math.atan2(-r,i),e.z=0,!1)}constructor(t=1,e=0,i=0,s=0,r=1,n=0,o=0,a=0,h=1){super();const l=this;"object"==typeof t?(l.m00=t.m00,l.m01=t.m01,l.m02=t.m02,l.m03=t.m03,l.m04=t.m04,l.m05=t.m05,l.m06=t.m06,l.m07=t.m07,l.m08=t.m08):(l.m00=t,l.m01=e,l.m02=i,l.m03=s,l.m04=r,l.m05=n,l.m06=o,l.m07=a,l.m08=h)}clone(){return new js(this)}set(t=1,e=0,i=0,s=0,r=1,n=0,o=0,a=0,h=1){const l=this;return"object"==typeof t?(l.m00=t.m00,l.m01=t.m01,l.m02=t.m02,l.m03=t.m03,l.m04=t.m04,l.m05=t.m05,l.m06=t.m06,l.m07=t.m07,l.m08=t.m08):(l.m00=t,l.m01=e,l.m02=i,l.m03=s,l.m04=r,l.m05=n,l.m06=o,l.m07=a,l.m08=h),l}equals(t,e=Mi){return js.equals(this,t,e)}strictEquals(t){return js.strictEquals(this,t)}toString(){const t=this;return`[\n${t.m00}, ${t.m01}, ${t.m02},\n${t.m03}, ${t.m04}, ${t.m05},\n${t.m06}, ${t.m07}, ${t.m08}\n]`}identity(){return js.identity(this)}transpose(){const t=this,e=t.m01,i=t.m02,s=t.m05;return t.m01=t.m03,t.m02=t.m06,t.m03=e,t.m05=t.m07,t.m06=i,t.m07=s,t}invert(){return js.invert(this,this)}determinant(){return js.determinant(this)}add(t){const e=this;return e.m00+=t.m00,e.m01+=t.m01,e.m02+=t.m02,e.m03+=t.m03,e.m04+=t.m04,e.m05+=t.m05,e.m06+=t.m06,e.m07+=t.m07,e.m08+=t.m08,e}subtract(t){const e=this;return e.m00-=t.m00,e.m01-=t.m01,e.m02-=t.m02,e.m03-=t.m03,e.m04-=t.m04,e.m05-=t.m05,e.m06-=t.m06,e.m07-=t.m07,e.m08-=t.m08,e}multiply(t){return js.multiply(this,this,t)}multiplyScalar(t){const e=this;return e.m00*=t,e.m01*=t,e.m02*=t,e.m03*=t,e.m04*=t,e.m05*=t,e.m06*=t,e.m07*=t,e.m08*=t,e}scale(t){const e=t.x,i=t.y,s=this;return s.m00*=e,s.m01*=e,s.m02*=e,s.m03*=i,s.m04*=i,s.m05*=i,s}rotate(t){const e=this,i=e.m00,s=e.m01,r=e.m02,n=e.m03,o=e.m04,a=e.m05,h=e.m06,l=e.m07,c=e.m08,u=Math.sin(t),d=Math.cos(t);return e.m00=d*i+u*n,e.m01=d*s+u*o,e.m02=d*r+u*a,e.m03=d*n-u*i,e.m04=d*o-u*s,e.m05=d*a-u*r,e.m06=h,e.m07=l,e.m08=c,e}fromQuat(t){const e=t.x,i=t.y,s=t.z,r=t.w,n=e+e,o=i+i,a=s+s,h=e*n,l=i*n,c=i*o,u=s*n,d=s*o,_=s*a,p=r*n,m=r*o,g=r*a,f=this;return f.m00=1-c-_,f.m03=l-g,f.m06=u+m,f.m01=l+g,f.m04=1-h-_,f.m07=d-p,f.m02=u-m,f.m05=d+p,f.m08=1-h-c,f}}t("Mat3",js),zs=js,js.IDENTITY=Object.freeze(new zs);const Hs=new Ms,Gs=new Ms;var Ws;yi.fastDefine("cc.Mat3",js,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),h.Mat3=js;const Xs=Math.abs,Ys=Math.max,qs=Math.min,$s=Math.PI,Ks=Math.acos,Zs=Math.sin,Qs=Math.cos,Js=Math.sqrt,tr=Math.atan2,er=Math.asin,ir=Math.sign;class sr extends ye{static clone(t){return new sr(t.x,t.y,t.z,t.w)}static copy(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}static set(t,e,i,s,r){return t.x=e,t.y=i,t.z=s,t.w=r,t}static identity(t){return t.x=0,t.y=0,t.z=0,t.w=1,t}static rotationTo(t,e,i){const s=Ms.dot(e,i);return s<-.999999?(Ms.cross(ar,Ms.UNIT_X,e),ar.length()<1e-6&&Ms.cross(ar,Ms.UNIT_Y,e),Ms.normalize(ar,ar),sr.fromAxisAngle(t,ar,$s),t):s>.999999?(t.x=0,t.y=0,t.z=0,t.w=1,t):(Ms.cross(ar,e,i),t.x=ar.x,t.y=ar.y,t.z=ar.z,t.w=1+s,sr.normalize(t,t))}static getAxisAngle(t,e){const i=2*Ks(e.w),s=Zs(i/2);return 0!==s?(t.x=e.x/s,t.y=e.y/s,t.z=e.z/s):(t.x=1,t.y=0,t.z=0),i}static multiply(t,e,i){const s=e.x*i.w+e.w*i.x+e.y*i.z-e.z*i.y,r=e.y*i.w+e.w*i.y+e.z*i.x-e.x*i.z,n=e.z*i.w+e.w*i.z+e.x*i.y-e.y*i.x,o=e.w*i.w-e.x*i.x-e.y*i.y-e.z*i.z;return t.x=s,t.y=r,t.z=n,t.w=o,t}static multiplyScalar(t,e,i){return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i,t}static scaleAndAdd(t,e,i,s){return t.x=e.x+i.x*s,t.y=e.y+i.y*s,t.z=e.z+i.z*s,t.w=e.w+i.w*s,t}static rotateX(t,e,i){const s=Zs(i*=.5),r=Qs(i),{x:n,y:o,z:a,w:h}=e;return t.x=n*r+h*s,t.y=o*r+a*s,t.z=a*r-o*s,t.w=h*r-n*s,t}static rotateY(t,e,i){const s=Zs(i*=.5),r=Qs(i),{x:n,y:o,z:a,w:h}=e;return t.x=n*r-a*s,t.y=o*r+h*s,t.z=a*r+n*s,t.w=h*r-o*s,t}static rotateZ(t,e,i){const s=Zs(i*=.5),r=Qs(i),{x:n,y:o,z:a,w:h}=e;return t.x=n*r+o*s,t.y=o*r-n*s,t.z=a*r+h*s,t.w=h*r-a*s,t}static rotateAround(t,e,i,s){return sr.invert(rr,e),Ms.transformQuat(ar,i,rr),sr.fromAxisAngle(rr,ar,s),sr.multiply(t,e,rr),t}static rotateAroundLocal(t,e,i,s){return sr.fromAxisAngle(rr,i,s),sr.multiply(t,e,rr),t}static calculateW(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=Js(Xs(1-e.x*e.x-e.y*e.y-e.z*e.z)),t}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}static lerp(t,e,i,s){return t.x=e.x+s*(i.x-e.x),t.y=e.y+s*(i.y-e.y),t.z=e.z+s*(i.z-e.z),t.w=e.w+s*(i.w-e.w),t}static slerp(t,e,i,s){let r=0,n=0,o=i.x,a=i.y,h=i.z,l=i.w,c=e.x*i.x+e.y*i.y+e.z*i.z+e.w*i.w;if(c<0&&(c=-c,o=-o,a=-a,h=-h,l=-l),1-c>1e-6){const t=Ks(c),e=Zs(t);r=Zs((1-s)*t)/e,n=Zs(s*t)/e}else r=1-s,n=s;return t.x=r*e.x+n*o,t.y=r*e.y+n*a,t.z=r*e.z+n*h,t.w=r*e.w+n*l,t}static sqlerp(t,e,i,s,r,n){return sr.slerp(rr,e,r,n),sr.slerp(or,i,s,n),sr.slerp(t,rr,or,2*n*(1-n)),t}static invert(t,e){const i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,s=i?1/i:0;return t.x=-e.x*s,t.y=-e.y*s,t.z=-e.z*s,t.w=e.w*s,t}static conjugate(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t}static len(t){return Js(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w)}static lengthSqr(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w}static normalize(t,e){let i=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;return i>0?(i=1/Js(i),t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t.w=e.w*i):(t.x=0,t.y=0,t.z=0,t.w=0),t}static fromAxes(t,e,i,s){return js.set(hr,e.x,e.y,e.z,i.x,i.y,i.z,s.x,s.y,s.z),sr.normalize(t,sr.fromMat3(t,hr))}static fromViewUp(t,e,i){return js.fromViewUp(hr,e,i),sr.normalize(t,sr.fromMat3(t,hr))}static fromAxisAngle(t,e,i){const s=Zs(i*=.5);return t.x=s*e.x,t.y=s*e.y,t.z=s*e.z,t.w=Qs(i),t}static fromMat3(t,e){const{m00:i,m01:s,m02:r,m03:n,m04:o,m05:a,m06:h,m07:l,m08:c}=e,u=i-o-c,d=o-i-c,_=c-i-o;let p=0,m=i+o+c;u>m&&(m=u,p=1),d>m&&(m=d,p=2),_>m&&(m=_,p=3);const g=.5*Js(m+1),f=.25/g;switch(p){case 0:t.w=g,t.x=(a-l)*f,t.y=(h-r)*f,t.z=(s-n)*f;break;case 1:t.w=(a-l)*f,t.x=g,t.y=(s+n)*f,t.z=(h+r)*f;break;case 2:t.w=(h-r)*f,t.x=(s+n)*f,t.y=g,t.z=(a+l)*f;break;case 3:t.w=(s-n)*f,t.x=(h+r)*f,t.y=(a+l)*f,t.z=g;break;default:t.w=1,t.x=0,t.y=0,t.z=0}return t}static fromEuler(t,e,i,s){i*=lr,s*=lr;const r=Zs(e*=lr),n=Qs(e),o=Zs(i),a=Qs(i),h=Zs(s),l=Qs(s);return t.x=r*a*l+n*o*h,t.y=n*o*l+r*a*h,t.z=n*a*h-r*o*l,t.w=n*a*l-r*o*h,t}static fromAngleZ(t,e){return e*=lr,t.x=t.y=0,t.z=Zs(e),t.w=Qs(e),t}static toAxisX(t,e){const i=2*e.y,s=2*e.z;return t.x=1-i*e.y-s*e.z,t.y=i*e.x+s*e.w,t.z=s*e.x-i*e.w,t}static toAxisY(t,e){const i=2*e.x,s=2*e.y,r=2*e.z;return t.x=s*e.x-r*e.w,t.y=1-i*e.x-r*e.z,t.z=r*e.y+i*e.w,t}static toAxisZ(t,e){const i=2*e.x,s=2*e.y,r=2*e.z;return t.x=r*e.x+s*e.w,t.y=r*e.y-i*e.w,t.z=1-i*e.x-s*e.y,t}static toEuler(t,e,i){const{x:s,y:r,z:n,w:o}=e;let a=0,h=0,l=0;const c=s*r+n*o;if(c>.499999)a=0,h=Li(2*tr(s,o)),l=90;else if(c<-.499999)a=0,h=-Li(2*tr(s,o)),l=-90;else{const t=r*r,e=n*n;a=Li(tr(2*s*o-2*r*n,1-s*s*2-2*e)),h=Li(tr(2*r*o-2*s*n,1-2*t-2*e)),l=Li(er(2*c)),i&&(a=-180*ir(a+1e-6)+a,h=-180*ir(h+1e-6)+h,l=180*ir(l+1e-6)-l)}return t.x=a,t.y=h,t.z=l,t}static toEulerInYXZOrder(t,e){js.fromQuat(hr,e),js.toEuler(hr,t),t.x=Li(t.x),t.y=Li(t.y),t.z=Li(t.z)}static toArray(t,e,i=0){return t[i+0]=e.x,t[i+1]=e.y,t[i+2]=e.z,t[i+3]=e.w,t}static fromArray(t,e,i=0){return t.x=e[i+0],t.y=e[i+1],t.z=e[i+2],t.w=e[i+3],t}static strictEquals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}static equals(t,e,i=Mi){return Xs(t.x-e.x)<=i*Ys(1,Xs(t.x),Xs(e.x))&&Xs(t.y-e.y)<=i*Ys(1,Xs(t.y),Xs(e.y))&&Xs(t.z-e.z)<=i*Ys(1,Xs(t.z),Xs(e.z))&&Xs(t.w-e.w)<=i*Ys(1,Xs(t.w),Xs(e.w))}static angle(t,e){const i=qs(Xs(sr.dot(t,e)),1);return 2*Ks(i)}static rotateTowards(t,e,i,s){const r=sr.angle(e,i);if(0===r)return t.x=i.x,t.y=i.y,t.z=i.z,t.w=i.w,t;const n=qs(s/Li(r),1);return sr.slerp(t,e,i,n)}constructor(t,e,i,s){super(),"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=null!=s?s:1)}clone(){return new sr(this.x,this.y,this.z,this.w)}set(t,e,i,s){return"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=null!=s?s:1),this}equals(t,e=Mi){return sr.equals(this,t,e)}strictEquals(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w}getEulerAngles(t){return sr.toEuler(t,this)}lerp(t,e){const i=this;return i.x+=e*(t.x-i.x),i.y+=e*(t.y-i.y),i.z+=e*(t.z-i.z),i.w+=e*(t.w-i.w),i}slerp(t,e){return sr.slerp(this,this,t,e)}length(){const{x:t,y:e,z:i,w:s}=this;return Js(t*t+e*e+i*i+s*s)}lengthSqr(){const{x:t,y:e,z:i,w:s}=this;return t*t+e*e+i*i+s*s}toString(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`}}t("Quat",sr),Ws=sr,sr.IDENTITY=Object.freeze(new Ws);const rr=new sr,or=new sr,ar=new Ms,hr=new js,lr=.5*$s/180;function cr(t=0,e=0,i=0,s=1){return new sr(t,e,i,s)}var ur;yi.fastDefine("cc.Quat",sr,{x:0,y:0,z:0,w:1}),h.Quat=sr,h.quat=cr;const dr=Object.freeze,_r=t("preTransforms",dr([dr([1,0,0,1]),dr([0,1,-1,0]),dr([-1,0,0,-1]),dr([0,-1,1,0])])),pr=Math.abs,mr=Math.max,gr=Math.sqrt,fr=Math.sin,yr=Math.cos,br=Math.tan;class vr extends ye{static clone(t){return new vr(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08,t.m09,t.m10,t.m11,t.m12,t.m13,t.m14,t.m15)}static copy(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t}static set(t,e,i,s,r,n,o,a,h,l,c,u,d,_,p,m,g){return t.m00=e,t.m01=i,t.m02=s,t.m03=r,t.m04=n,t.m05=o,t.m06=a,t.m07=h,t.m08=l,t.m09=c,t.m10=u,t.m11=d,t.m12=_,t.m13=p,t.m14=m,t.m15=g,t}static identity(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}static zero(t){return t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=0,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=0,t}static transpose(t,e){if(t===e){const i=e.m01,s=e.m02,r=e.m03,n=e.m06,o=e.m07,a=e.m11;t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=i,t.m06=e.m09,t.m07=e.m13,t.m08=s,t.m09=n,t.m11=e.m14,t.m12=r,t.m13=o,t.m14=a}else t.m00=e.m00,t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=e.m01,t.m05=e.m05,t.m06=e.m09,t.m07=e.m13,t.m08=e.m02,t.m09=e.m06,t.m10=e.m10,t.m11=e.m14,t.m12=e.m03,t.m13=e.m07,t.m14=e.m11,t.m15=e.m15;return t}static invert(t,e){const i=e.m00,s=e.m01,r=e.m02,n=e.m03,o=e.m04,a=e.m05,h=e.m06,l=e.m07,c=e.m08,u=e.m09,d=e.m10,_=e.m11,p=e.m12,m=e.m13,g=e.m14,f=e.m15,y=i*a-s*o,b=i*h-r*o,v=i*l-n*o,S=s*h-r*a,T=s*l-n*a,w=r*l-n*h,x=c*m-u*p,C=c*g-d*p,A=c*f-_*p,D=u*g-d*m,E=u*f-_*m,I=d*f-_*g;let M=y*I-b*E+v*D+S*A-T*C+w*x;return 0===M?vr.zero(t):(M=1/M,t.m00=(a*I-h*E+l*D)*M,t.m01=(r*E-s*I-n*D)*M,t.m02=(m*w-g*T+f*S)*M,t.m03=(d*T-u*w-_*S)*M,t.m04=(h*A-o*I-l*C)*M,t.m05=(i*I-r*A+n*C)*M,t.m06=(g*v-p*w-f*b)*M,t.m07=(c*w-d*v+_*b)*M,t.m08=(o*E-a*A+l*x)*M,t.m09=(s*A-i*E-n*x)*M,t.m10=(p*T-m*v+f*y)*M,t.m11=(u*v-c*T-_*y)*M,t.m12=(a*C-o*D-h*x)*M,t.m13=(i*D-s*C+r*x)*M,t.m14=(m*b-p*S-g*y)*M,t.m15=(c*S-u*b+d*y)*M,t)}static determinant(t){const e=t.m00,i=t.m01,s=t.m02,r=t.m03,n=t.m04,o=t.m05,a=t.m06,h=t.m07,l=t.m08,c=t.m09,u=t.m10,d=t.m11,_=t.m12,p=t.m13,m=t.m14,g=t.m15;return(e*o-i*n)*(u*g-d*m)-(e*a-s*n)*(c*g-d*p)+(e*h-r*n)*(c*m-u*p)+(i*a-s*o)*(l*g-d*_)-(i*h-r*o)*(l*m-u*_)+(s*h-r*a)*(l*p-c*_)}static multiply(t,e,i){const s=e.m00,r=e.m01,n=e.m02,o=e.m03,a=e.m04,h=e.m05,l=e.m06,c=e.m07,u=e.m08,d=e.m09,_=e.m10,p=e.m11,m=e.m12,g=e.m13,f=e.m14,y=e.m15;let b=i.m00,v=i.m01,S=i.m02,T=i.m03;return t.m00=b*s+v*a+S*u+T*m,t.m01=b*r+v*h+S*d+T*g,t.m02=b*n+v*l+S*_+T*f,t.m03=b*o+v*c+S*p+T*y,b=i.m04,v=i.m05,S=i.m06,T=i.m07,t.m04=b*s+v*a+S*u+T*m,t.m05=b*r+v*h+S*d+T*g,t.m06=b*n+v*l+S*_+T*f,t.m07=b*o+v*c+S*p+T*y,b=i.m08,v=i.m09,S=i.m10,T=i.m11,t.m08=b*s+v*a+S*u+T*m,t.m09=b*r+v*h+S*d+T*g,t.m10=b*n+v*l+S*_+T*f,t.m11=b*o+v*c+S*p+T*y,b=i.m12,v=i.m13,S=i.m14,T=i.m15,t.m12=b*s+v*a+S*u+T*m,t.m13=b*r+v*h+S*d+T*g,t.m14=b*n+v*l+S*_+T*f,t.m15=b*o+v*c+S*p+T*y,t}static transform(t,e,i){const s=i.x,r=i.y,n=i.z;if(e===t)t.m12=e.m00*s+e.m04*r+e.m08*n+e.m12,t.m13=e.m01*s+e.m05*r+e.m09*n+e.m13,t.m14=e.m02*s+e.m06*r+e.m10*n+e.m14,t.m15=e.m03*s+e.m07*r+e.m11*n+e.m15;else{const i=e.m00,o=e.m01,a=e.m02,h=e.m03,l=e.m04,c=e.m05,u=e.m06,d=e.m07,_=e.m08,p=e.m09,m=e.m10,g=e.m11;t.m00=i,t.m01=o,t.m02=a,t.m03=h,t.m04=l,t.m05=c,t.m06=u,t.m07=d,t.m08=_,t.m09=p,t.m10=m,t.m11=g,t.m12=i*s+l*r+_*n+e.m12,t.m13=o*s+c*r+p*n+e.m13,t.m14=a*s+u*r+m*n+e.m14,t.m15=h*s+d*r+g*n+e.m15}return t}static translate(t,e,i){return e===t?(t.m12+=i.x,t.m13+=i.y,t.m14+=i.z):(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12+i.x,t.m13=e.m13+i.y,t.m14=e.m14+i.z,t.m15=e.m15),t}static scale(t,e,i){const s=i.x,r=i.y,n=i.z;return t.m00=e.m00*s,t.m01=e.m01*s,t.m02=e.m02*s,t.m03=e.m03*s,t.m04=e.m04*r,t.m05=e.m05*r,t.m06=e.m06*r,t.m07=e.m07*r,t.m08=e.m08*n,t.m09=e.m09*n,t.m10=e.m10*n,t.m11=e.m11*n,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t}static rotate(t,e,i,s){let r=s.x,n=s.y,o=s.z,a=gr(r*r+n*n+o*o);if(pr(a)<Mi)return null;a=1/a,r*=a,n*=a,o*=a;const h=fr(i),l=yr(i),c=1-l,u=e.m00,d=e.m01,_=e.m02,p=e.m03,m=e.m04,g=e.m05,f=e.m06,y=e.m07,b=e.m08,v=e.m09,S=e.m10,T=e.m11,w=r*r*c+l,x=n*r*c+o*h,C=o*r*c-n*h,A=r*n*c-o*h,D=n*n*c+l,E=o*n*c+r*h,I=r*o*c+n*h,M=n*o*c-r*h,P=o*o*c+l;return t.m00=u*w+m*x+b*C,t.m01=d*w+g*x+v*C,t.m02=_*w+f*x+S*C,t.m03=p*w+y*x+T*C,t.m04=u*A+m*D+b*E,t.m05=d*A+g*D+v*E,t.m06=_*A+f*D+S*E,t.m07=p*A+y*D+T*E,t.m08=u*I+m*M+b*P,t.m09=d*I+g*M+v*P,t.m10=_*I+f*M+S*P,t.m11=p*I+y*M+T*P,e!==t&&(t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t}static rotateX(t,e,i){const s=fr(i),r=yr(i),n=e.m04,o=e.m05,a=e.m06,h=e.m07,l=e.m08,c=e.m09,u=e.m10,d=e.m11;return e!==t&&(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m04=n*r+l*s,t.m05=o*r+c*s,t.m06=a*r+u*s,t.m07=h*r+d*s,t.m08=l*r-n*s,t.m09=c*r-o*s,t.m10=u*r-a*s,t.m11=d*r-h*s,t}static rotateY(t,e,i){const s=fr(i),r=yr(i),n=e.m00,o=e.m01,a=e.m02,h=e.m03,l=e.m08,c=e.m09,u=e.m10,d=e.m11;return e!==t&&(t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=n*r-l*s,t.m01=o*r-c*s,t.m02=a*r-u*s,t.m03=h*r-d*s,t.m08=n*s+l*r,t.m09=o*s+c*r,t.m10=a*s+u*r,t.m11=h*s+d*r,t}static rotateZ(t,e,i){const s=fr(i),r=yr(i),n=e.m00,o=e.m01,a=e.m02,h=e.m03,l=e.m04,c=e.m05,u=e.m06,d=e.m07;return e!==t&&(t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=n*r+l*s,t.m01=o*r+c*s,t.m02=a*r+u*s,t.m03=h*r+d*s,t.m04=l*r-n*s,t.m05=c*r-o*s,t.m06=u*r-a*s,t.m07=d*r-h*s,t}static fromTranslation(t,e){return vr.identity(t),t.m12=e.x,t.m13=e.y,t.m14=e.z,t}static fromScaling(t,e){return vr.identity(t),t.m00=e.x,t.m05=e.y,t.m10=e.z,t}static fromRotation(t,e,i){let s=i.x,r=i.y,n=i.z,o=gr(s*s+r*r+n*n);if(pr(o)<Mi)return null;o=1/o,s*=o,r*=o,n*=o;const a=fr(e),h=yr(e),l=1-h;return t.m00=s*s*l+h,t.m01=r*s*l+n*a,t.m02=n*s*l-r*a,t.m03=0,t.m04=s*r*l-n*a,t.m05=r*r*l+h,t.m06=n*r*l+s*a,t.m07=0,t.m08=s*n*l+r*a,t.m09=r*n*l-s*a,t.m10=n*n*l+h,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}static fromXRotation(t,e){const i=fr(e),s=yr(e);return vr.identity(t),t.m05=s,t.m06=i,t.m09=-i,t.m10=s,t}static fromYRotation(t,e){const i=fr(e),s=yr(e);return vr.identity(t),t.m00=s,t.m02=-i,t.m08=i,t.m10=s,t}static fromZRotation(t,e){const i=fr(e),s=yr(e);return vr.identity(t),t.m00=s,t.m01=i,t.m04=-i,t.m05=s,t}static fromRT(t,e,i){const s=e.x,r=e.y,n=e.z,o=e.w,a=s+s,h=r+r,l=n+n,c=s*a,u=s*h,d=s*l,_=r*h,p=r*l,m=n*l,g=o*a,f=o*h,y=o*l;return t.m00=1-(_+m),t.m01=u+y,t.m02=d-f,t.m03=0,t.m04=u-y,t.m05=1-(c+m),t.m06=p+g,t.m07=0,t.m08=d+f,t.m09=p-g,t.m10=1-(c+_),t.m11=0,t.m12=i.x,t.m13=i.y,t.m14=i.z,t.m15=1,t}static getTranslation(t,e){return t.x=e.m12,t.y=e.m13,t.z=e.m14,t}static getScaling(t,e){const i=Tr.m00=e.m00,s=Tr.m01=e.m01,r=Tr.m02=e.m02,n=Tr.m03=e.m04,o=Tr.m04=e.m05,a=Tr.m05=e.m06,h=Tr.m06=e.m08,l=Tr.m07=e.m09,c=Tr.m08=e.m10;return t.x=gr(i*i+s*s+r*r),t.y=gr(n*n+o*o+a*a),t.z=gr(h*h+l*l+c*c),js.determinant(Tr)<0&&(t.x*=-1),t}static getRotation(t,e){const i=e.m00+e.m05+e.m10;let s=0;return i>0?(s=2*gr(i+1),t.w=.25*s,t.x=(e.m06-e.m09)/s,t.y=(e.m08-e.m02)/s,t.z=(e.m01-e.m04)/s):e.m00>e.m05&&e.m00>e.m10?(s=2*gr(1+e.m00-e.m05-e.m10),t.w=(e.m06-e.m09)/s,t.x=.25*s,t.y=(e.m01+e.m04)/s,t.z=(e.m08+e.m02)/s):e.m05>e.m10?(s=2*gr(1+e.m05-e.m00-e.m10),t.w=(e.m08-e.m02)/s,t.x=(e.m01+e.m04)/s,t.y=.25*s,t.z=(e.m06+e.m09)/s):(s=2*gr(1+e.m10-e.m00-e.m05),t.w=(e.m01-e.m04)/s,t.x=(e.m08+e.m02)/s,t.y=(e.m06+e.m09)/s,t.z=.25*s),t}static toRTS(t,e,i,s){vr.toSRT(t,e,i,s)}static toSRT(t,e,i,s){i&&Ms.set(i,t.m12,t.m13,t.m14);const r=Ms.set(Sr,t.m00,t.m01,t.m02).length(),n=Ms.set(Sr,t.m04,t.m05,t.m06).length(),o=Ms.set(Sr,t.m08,t.m09,t.m10).length();if(s&&(s.x=r,s.y=n,s.z=o),0===r||0===n||0===o)return void(e&&sr.identity(e));Tr.m00=t.m00/r,Tr.m01=t.m01/r,Tr.m02=t.m02/r,Tr.m03=t.m04/n,Tr.m04=t.m05/n,Tr.m05=t.m06/n,Tr.m06=t.m08/o,Tr.m07=t.m09/o,Tr.m08=t.m10/o;const a=js.determinant(Tr);s&&a<0&&(s.x*=-1),e&&(a<0&&(Tr.m00*=-1,Tr.m01*=-1,Tr.m02*=-1),sr.fromMat3(e,Tr))}static toEuler(t,e){return js.set(Tr,t.m00,t.m01,t.m02,t.m04,t.m05,t.m06,t.m08,t.m09,t.m10),js.toEuler(Tr,e)}static fromRTS(t,e,i,s){return vr.fromSRT(t,e,i,s)}static fromSRT(t,e,i,s){const{x:r,y:n,z:o,w:a}=e,h=r+r,l=n+n,c=o+o,u=r*h,d=r*l,_=r*c,p=n*l,m=n*c,g=o*c,f=a*h,y=a*l,b=a*c,v=s.x,S=s.y,T=s.z;return t.m00=(1-(p+g))*v,t.m01=(d+b)*v,t.m02=(_-y)*v,t.m03=0,t.m04=(d-b)*S,t.m05=(1-(u+g))*S,t.m06=(m+f)*S,t.m07=0,t.m08=(_+y)*T,t.m09=(m-f)*T,t.m10=(1-(u+p))*T,t.m11=0,t.m12=i.x,t.m13=i.y,t.m14=i.z,t.m15=1,t}static fromRTSOrigin(t,e,i,s,r){return vr.fromSRTOrigin(t,e,i,s,r)}static fromSRTOrigin(t,e,i,s,r){const n=e.x,o=e.y,a=e.z,h=e.w,l=n+n,c=o+o,u=a+a,d=n*l,_=n*c,p=n*u,m=o*c,g=o*u,f=a*u,y=h*l,b=h*c,v=h*u,S=s.x,T=s.y,w=s.z,x=r.x,C=r.y,A=r.z;return t.m00=(1-(m+f))*S,t.m01=(_+v)*S,t.m02=(p-b)*S,t.m03=0,t.m04=(_-v)*T,t.m05=(1-(d+f))*T,t.m06=(g+y)*T,t.m07=0,t.m08=(p+b)*w,t.m09=(g-y)*w,t.m10=(1-(d+m))*w,t.m11=0,t.m12=i.x+x-(t.m00*x+t.m04*C+t.m08*A),t.m13=i.y+C-(t.m01*x+t.m05*C+t.m09*A),t.m14=i.z+A-(t.m02*x+t.m06*C+t.m10*A),t.m15=1,t}static fromQuat(t,e){const i=e.x,s=e.y,r=e.z,n=e.w,o=i+i,a=s+s,h=r+r,l=i*o,c=s*o,u=s*a,d=r*o,_=r*a,p=r*h,m=n*o,g=n*a,f=n*h;return t.m00=1-u-p,t.m01=c+f,t.m02=d-g,t.m03=0,t.m04=c-f,t.m05=1-l-p,t.m06=_+m,t.m07=0,t.m08=d+g,t.m09=_-m,t.m10=1-l-u,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t}static frustum(t,e,i,s,r,n,o){const a=1/(i-e),h=1/(r-s),l=1/(n-o);return t.m00=2*n*a,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=2*n*h,t.m06=0,t.m07=0,t.m08=(i+e)*a,t.m09=(r+s)*h,t.m10=(o+n)*l,t.m11=-1,t.m12=0,t.m13=0,t.m14=o*n*2*l,t.m15=0,t}static perspective(t,e,i,s,r,n=!0,o=-1,a=1,h=0){const l=1/br(e/2),c=1/(s-r),u=n?l/i:l,d=(n?l:l*i)*a,_=_r[h];return t.m00=u*_[0],t.m01=u*_[1],t.m02=0,t.m03=0,t.m04=d*_[2],t.m05=d*_[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=(r-o*s)*c,t.m11=-1,t.m12=0,t.m13=0,t.m14=r*s*c*(1-o),t.m15=0,t}static ortho(t,e,i,s,r,n,o,a=-1,h=1,l=0){const c=1/(e-i),u=1/(s-r)*h,d=1/(n-o),_=-2*c,p=-2*u,m=(e+i)*c,g=(r+s)*u,f=_r[l];return t.m00=_*f[0],t.m01=_*f[1],t.m02=0,t.m03=0,t.m04=p*f[2],t.m05=p*f[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=d*(1-a),t.m11=0,t.m12=m*f[0]+g*f[2],t.m13=m*f[1]+g*f[3],t.m14=(n-a*o)*d,t.m15=1,t}static lookAt(t,e,i,s){const r=e.x,n=e.y,o=e.z,a=s.x,h=s.y,l=s.z;let c=r-i.x,u=n-i.y,d=o-i.z,_=1/gr(c*c+u*u+d*d);c*=_,u*=_,d*=_;let p=h*d-l*u,m=l*c-a*d,g=a*u-h*c;_=1/gr(p*p+m*m+g*g),p*=_,m*=_,g*=_;const f=u*g-d*m,y=d*p-c*g,b=c*m-u*p;return t.m00=p,t.m01=f,t.m02=c,t.m03=0,t.m04=m,t.m05=y,t.m06=u,t.m07=0,t.m08=g,t.m09=b,t.m10=d,t.m11=0,t.m12=-(p*r+m*n+g*o),t.m13=-(f*r+y*n+b*o),t.m14=-(c*r+u*n+d*o),t.m15=1,t}static inverseTranspose(t,e){const i=e.m00,s=e.m01,r=e.m02,n=e.m03,o=e.m04,a=e.m05,h=e.m06,l=e.m07,c=e.m08,u=e.m09,d=e.m10,_=e.m11,p=e.m12,m=e.m13,g=e.m14,f=e.m15,y=i*a-s*o,b=i*h-r*o,v=i*l-n*o,S=s*h-r*a,T=s*l-n*a,w=r*l-n*h,x=c*m-u*p,C=c*g-d*p,A=c*f-_*p,D=u*g-d*m,E=u*f-_*m,I=d*f-_*g;let M=y*I-b*E+v*D+S*A-T*C+w*x;return M?(M=1/M,t.m00=(a*I-h*E+l*D)*M,t.m01=(h*A-o*I-l*C)*M,t.m02=(o*E-a*A+l*x)*M,t.m03=0,t.m04=(r*E-s*I-n*D)*M,t.m05=(i*I-r*A+n*C)*M,t.m06=(s*A-i*E-n*x)*M,t.m07=0,t.m08=(m*w-g*T+f*S)*M,t.m09=(g*v-p*w-f*b)*M,t.m10=(p*T-m*v+f*y)*M,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t):null}static toArray(t,e,i=0){return t[i+0]=e.m00,t[i+1]=e.m01,t[i+2]=e.m02,t[i+3]=e.m03,t[i+4]=e.m04,t[i+5]=e.m05,t[i+6]=e.m06,t[i+7]=e.m07,t[i+8]=e.m08,t[i+9]=e.m09,t[i+10]=e.m10,t[i+11]=e.m11,t[i+12]=e.m12,t[i+13]=e.m13,t[i+14]=e.m14,t[i+15]=e.m15,t}static fromArray(t,e,i=0){return t.m00=e[i+0],t.m01=e[i+1],t.m02=e[i+2],t.m03=e[i+3],t.m04=e[i+4],t.m05=e[i+5],t.m06=e[i+6],t.m07=e[i+7],t.m08=e[i+8],t.m09=e[i+9],t.m10=e[i+10],t.m11=e[i+11],t.m12=e[i+12],t.m13=e[i+13],t.m14=e[i+14],t.m15=e[i+15],t}static add(t,e,i){return t.m00=e.m00+i.m00,t.m01=e.m01+i.m01,t.m02=e.m02+i.m02,t.m03=e.m03+i.m03,t.m04=e.m04+i.m04,t.m05=e.m05+i.m05,t.m06=e.m06+i.m06,t.m07=e.m07+i.m07,t.m08=e.m08+i.m08,t.m09=e.m09+i.m09,t.m10=e.m10+i.m10,t.m11=e.m11+i.m11,t.m12=e.m12+i.m12,t.m13=e.m13+i.m13,t.m14=e.m14+i.m14,t.m15=e.m15+i.m15,t}static subtract(t,e,i){return t.m00=e.m00-i.m00,t.m01=e.m01-i.m01,t.m02=e.m02-i.m02,t.m03=e.m03-i.m03,t.m04=e.m04-i.m04,t.m05=e.m05-i.m05,t.m06=e.m06-i.m06,t.m07=e.m07-i.m07,t.m08=e.m08-i.m08,t.m09=e.m09-i.m09,t.m10=e.m10-i.m10,t.m11=e.m11-i.m11,t.m12=e.m12-i.m12,t.m13=e.m13-i.m13,t.m14=e.m14-i.m14,t.m15=e.m15-i.m15,t}static multiplyScalar(t,e,i){return t.m00=e.m00*i,t.m01=e.m01*i,t.m02=e.m02*i,t.m03=e.m03*i,t.m04=e.m04*i,t.m05=e.m05*i,t.m06=e.m06*i,t.m07=e.m07*i,t.m08=e.m08*i,t.m09=e.m09*i,t.m10=e.m10*i,t.m11=e.m11*i,t.m12=e.m12*i,t.m13=e.m13*i,t.m14=e.m14*i,t.m15=e.m15*i,t}static multiplyScalarAndAdd(t,e,i,s){return t.m00=e.m00+i.m00*s,t.m01=e.m01+i.m01*s,t.m02=e.m02+i.m02*s,t.m03=e.m03+i.m03*s,t.m04=e.m04+i.m04*s,t.m05=e.m05+i.m05*s,t.m06=e.m06+i.m06*s,t.m07=e.m07+i.m07*s,t.m08=e.m08+i.m08*s,t.m09=e.m09+i.m09*s,t.m10=e.m10+i.m10*s,t.m11=e.m11+i.m11*s,t.m12=e.m12+i.m12*s,t.m13=e.m13+i.m13*s,t.m14=e.m14+i.m14*s,t.m15=e.m15+i.m15*s,t}static strictEquals(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08&&t.m09===e.m09&&t.m10===e.m10&&t.m11===e.m11&&t.m12===e.m12&&t.m13===e.m13&&t.m14===e.m14&&t.m15===e.m15}static equals(t,e,i=Mi){return pr(t.m00-e.m00)<=i*mr(1,pr(t.m00),pr(e.m00))&&pr(t.m01-e.m01)<=i*mr(1,pr(t.m01),pr(e.m01))&&pr(t.m02-e.m02)<=i*mr(1,pr(t.m02),pr(e.m02))&&pr(t.m03-e.m03)<=i*mr(1,pr(t.m03),pr(e.m03))&&pr(t.m04-e.m04)<=i*mr(1,pr(t.m04),pr(e.m04))&&pr(t.m05-e.m05)<=i*mr(1,pr(t.m05),pr(e.m05))&&pr(t.m06-e.m06)<=i*mr(1,pr(t.m06),pr(e.m06))&&pr(t.m07-e.m07)<=i*mr(1,pr(t.m07),pr(e.m07))&&pr(t.m08-e.m08)<=i*mr(1,pr(t.m08),pr(e.m08))&&pr(t.m09-e.m09)<=i*mr(1,pr(t.m09),pr(e.m09))&&pr(t.m10-e.m10)<=i*mr(1,pr(t.m10),pr(e.m10))&&pr(t.m11-e.m11)<=i*mr(1,pr(t.m11),pr(e.m11))&&pr(t.m12-e.m12)<=i*mr(1,pr(t.m12),pr(e.m12))&&pr(t.m13-e.m13)<=i*mr(1,pr(t.m13),pr(e.m13))&&pr(t.m14-e.m14)<=i*mr(1,pr(t.m14),pr(e.m14))&&pr(t.m15-e.m15)<=i*mr(1,pr(t.m15),pr(e.m15))}constructor(t=1,e=0,i=0,s=0,r=0,n=1,o=0,a=0,h=0,l=0,c=1,u=0,d=0,_=0,p=0,m=1){super();const g=this;"object"==typeof t?(g.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,g.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,g.m08=t.m08,this.m09=t.m09,this.m10=t.m10,this.m11=t.m11,g.m12=t.m12,this.m13=t.m13,this.m14=t.m14,this.m15=t.m15):(g.m00=t,this.m01=e,this.m02=i,this.m03=s,g.m04=r,this.m05=n,this.m06=o,this.m07=a,g.m08=h,this.m09=l,this.m10=c,this.m11=u,g.m12=d,this.m13=_,this.m14=p,this.m15=m)}clone(){return new vr(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)}set(t=1,e=0,i=0,s=0,r=0,n=1,o=0,a=0,h=0,l=0,c=1,u=0,d=0,_=0,p=0,m=1){const g=this;return"object"==typeof t?(g.m01=t.m01,g.m02=t.m02,g.m03=t.m03,g.m04=t.m04,g.m05=t.m05,g.m06=t.m06,g.m07=t.m07,g.m08=t.m08,g.m09=t.m09,g.m10=t.m10,g.m11=t.m11,g.m12=t.m12,g.m13=t.m13,g.m14=t.m14,g.m15=t.m15,g.m00=t.m00):(g.m01=e,g.m02=i,g.m03=s,g.m04=r,g.m05=n,g.m06=o,g.m07=a,g.m08=h,g.m09=l,g.m10=c,g.m11=u,g.m12=d,g.m13=_,g.m14=p,g.m15=m,g.m00=t),g}equals(t,e=Mi){const i=1/0,s=this,r=s.m00,n=s.m01,o=s.m02,a=s.m03,h=s.m04,l=s.m05,c=s.m06,u=s.m07,d=s.m08,_=s.m09,p=s.m10,m=s.m11,g=s.m12,f=s.m13,y=s.m14,b=s.m15;return!(pr(r)===i||pr(n)===i||pr(o)===i||pr(a)===i||pr(h)===i||pr(l)===i||pr(c)===i||pr(u)===i||pr(d)===i||pr(_)===i||pr(p)===i||pr(m)===i||pr(g)===i||pr(f)===i||pr(y)===i||pr(b)===i)&&pr(r-t.m00)<=e*mr(1,pr(r),pr(t.m00))&&pr(n-t.m01)<=e*mr(1,pr(n),pr(t.m01))&&pr(o-t.m02)<=e*mr(1,pr(o),pr(t.m02))&&pr(a-t.m03)<=e*mr(1,pr(a),pr(t.m03))&&pr(h-t.m04)<=e*mr(1,pr(h),pr(t.m04))&&pr(l-t.m05)<=e*mr(1,pr(l),pr(t.m05))&&pr(c-t.m06)<=e*mr(1,pr(c),pr(t.m06))&&pr(u-t.m07)<=e*mr(1,pr(u),pr(t.m07))&&pr(d-t.m08)<=e*mr(1,pr(d),pr(t.m08))&&pr(_-t.m09)<=e*mr(1,pr(_),pr(t.m09))&&pr(p-t.m10)<=e*mr(1,pr(p),pr(t.m10))&&pr(m-t.m11)<=e*mr(1,pr(m),pr(t.m11))&&pr(g-t.m12)<=e*mr(1,pr(g),pr(t.m12))&&pr(f-t.m13)<=e*mr(1,pr(f),pr(t.m13))&&pr(y-t.m14)<=e*mr(1,pr(y),pr(t.m14))&&pr(b-t.m15)<=e*mr(1,pr(b),pr(t.m15))}strictEquals(t){const e=this;return e.m00===t.m00&&e.m01===t.m01&&e.m02===t.m02&&e.m03===t.m03&&e.m04===t.m04&&e.m05===t.m05&&e.m06===t.m06&&e.m07===t.m07&&e.m08===t.m08&&e.m09===t.m09&&e.m10===t.m10&&e.m11===t.m11&&e.m12===t.m12&&e.m13===t.m13&&e.m14===t.m14&&e.m15===t.m15}toString(){const t=this;return`[\n${t.m00}, ${t.m01}, ${t.m02}, ${t.m03},\n${t.m04}, ${t.m05}, ${t.m06}, ${t.m07},\n${t.m08}, ${t.m09}, ${t.m10}, ${t.m11},\n${t.m12}, ${t.m13}, ${t.m14}, ${t.m15}\n]`}identity(){return vr.identity(this)}zero(){return vr.zero(this)}transpose(){const t=this,e=t.m01,i=t.m02,s=t.m03,r=t.m06,n=t.m07,o=t.m11;return t.m01=t.m04,t.m02=t.m08,t.m03=t.m12,t.m04=e,t.m06=t.m09,t.m07=t.m13,t.m08=i,t.m09=r,t.m11=t.m14,t.m12=s,t.m13=n,t.m14=o,t}invert(){const t=this,e=t.m00,i=t.m01,s=t.m02,r=t.m03,n=t.m04,o=t.m05,a=t.m06,h=t.m07,l=t.m08,c=t.m09,u=t.m10,d=t.m11,_=t.m12,p=t.m13,m=t.m14,g=t.m15,f=e*o-i*n,y=e*a-s*n,b=e*h-r*n,v=i*a-s*o,S=i*h-r*o,T=s*h-r*a,w=l*p-c*_,x=l*m-u*_,C=l*g-d*_,A=c*m-u*p,D=c*g-d*p,E=u*g-d*m;let I=f*E-y*D+b*A+v*C-S*x+T*w;return 0===I?(t.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),t):(I=1/I,t.m00=(o*E-a*D+h*A)*I,t.m01=(s*D-i*E-r*A)*I,t.m02=(p*T-m*S+g*v)*I,t.m03=(u*S-c*T-d*v)*I,t.m04=(a*C-n*E-h*x)*I,t.m05=(e*E-s*C+r*x)*I,t.m06=(m*b-_*T-g*y)*I,t.m07=(l*T-u*b+d*y)*I,t.m08=(n*D-o*C+h*w)*I,t.m09=(i*C-e*D-r*w)*I,t.m10=(_*S-p*b+g*f)*I,t.m11=(c*b-l*S-d*f)*I,t.m12=(o*x-n*A-a*w)*I,t.m13=(e*A-i*x+s*w)*I,t.m14=(p*y-_*v-m*f)*I,t.m15=(l*v-c*y+u*f)*I,t)}determinant(){const t=this,e=t.m00,i=t.m01,s=t.m02,r=t.m03,n=t.m04,o=t.m05,a=t.m06,h=t.m07,l=t.m08,c=t.m09,u=t.m10,d=t.m11,_=t.m12,p=t.m13,m=t.m14,g=t.m15;return(e*o-i*n)*(u*g-d*m)-(e*a-s*n)*(c*g-d*p)+(e*h-r*n)*(c*m-u*p)+(i*a-s*o)*(l*g-d*_)-(i*h-r*o)*(l*m-u*_)+(s*h-r*a)*(l*p-c*_)}add(t){const e=this;return e.m00+=t.m00,e.m01+=t.m01,e.m02+=t.m02,e.m03+=t.m03,e.m04+=t.m04,e.m05+=t.m05,e.m06+=t.m06,e.m07+=t.m07,e.m08+=t.m08,e.m09+=t.m09,e.m10+=t.m10,e.m11+=t.m11,e.m12+=t.m12,e.m13+=t.m13,e.m14+=t.m14,e.m15+=t.m15,e}subtract(t){const e=this;return e.m00-=t.m00,e.m01-=t.m01,e.m02-=t.m02,e.m03-=t.m03,e.m04-=t.m04,e.m05-=t.m05,e.m06-=t.m06,e.m07-=t.m07,e.m08-=t.m08,e.m09-=t.m09,e.m10-=t.m10,e.m11-=t.m11,e.m12-=t.m12,e.m13-=t.m13,e.m14-=t.m14,e.m15-=t.m15,e}multiply(t){return vr.multiply(this,this,t)}multiplyScalar(t){const e=this;return e.m00*=t,e.m01*=t,e.m02*=t,e.m03*=t,e.m04*=t,e.m05*=t,e.m06*=t,e.m07*=t,e.m08*=t,e.m09*=t,e.m10*=t,e.m11*=t,e.m12*=t,e.m13*=t,e.m14*=t,e.m15*=t,e}translate(t){return this.m12+=t.x,this.m13+=t.y,this.m14+=t.z,this}transform(t){const{x:e,y:i,z:s}=t,r=this,n=r.m00,o=r.m01,a=r.m02,h=r.m03,l=r.m04,c=r.m05,u=r.m06,d=r.m07,_=r.m08,p=r.m09,m=r.m10,g=r.m11;return r.m12=n*e+l*i+_*s+r.m12,r.m13=o*e+c*i+p*s+r.m13,r.m14=a*e+u*i+m*s+r.m14,r.m15=h*e+d*i+g*s+r.m15,r}scale(t){const{x:e,y:i,z:s}=t,r=this;return r.m00*=e,r.m01*=e,r.m02*=e,r.m03*=e,r.m04*=i,r.m05*=i,r.m06*=i,r.m07*=i,r.m08*=s,r.m09*=s,r.m10*=s,r.m11*=s,r}rotate(t,e){let i=e.x,s=e.y,r=e.z,n=gr(i*i+s*s+r*r);if(pr(n)<Mi)return null;n=1/n,i*=n,s*=n,r*=n;const o=fr(t),a=yr(t),h=1-a,l=this,c=l.m00,u=l.m01,d=l.m02,_=l.m03,p=l.m04,m=l.m05,g=l.m06,f=l.m07,y=l.m08,b=l.m09,v=l.m10,S=l.m11,T=i*i*h+a,w=s*i*h+r*o,x=r*i*h-s*o,C=i*s*h-r*o,A=s*s*h+a,D=r*s*h+i*o,E=i*r*h+s*o,I=s*r*h-i*o,M=r*r*h+a;return l.m00=c*T+p*w+y*x,l.m01=u*T+m*w+b*x,l.m02=d*T+g*w+v*x,l.m03=_*T+f*w+S*x,l.m04=c*C+p*A+y*D,l.m05=u*C+m*A+b*D,l.m06=d*C+g*A+v*D,l.m07=_*C+f*A+S*D,l.m08=c*E+p*I+y*M,l.m09=u*E+m*I+b*M,l.m10=d*E+g*I+v*M,l.m11=_*E+f*I+S*M,l}getTranslation(t){return t.x=this.m12,t.y=this.m13,t.z=this.m14,t}getScale(t){const e=this,i=Tr.m00=e.m00,s=Tr.m01=e.m01,r=Tr.m02=e.m02,n=Tr.m03=e.m04,o=Tr.m04=e.m05,a=Tr.m05=e.m06,h=Tr.m06=e.m08,l=Tr.m07=e.m09,c=Tr.m08=e.m10;return t.x=gr(i*i+s*s+r*r),t.y=gr(n*n+o*o+a*a),t.z=gr(h*h+l*l+c*c),js.determinant(Tr)<0&&(t.x*=-1),t}getRotation(t){const e=this,i=Ms.set(Sr,e.m00,e.m01,e.m02).length(),s=Ms.set(Sr,e.m04,e.m05,e.m06).length(),r=Ms.set(Sr,e.m08,e.m09,e.m10).length();return Tr.m00=e.m00/i,Tr.m01=e.m01/i,Tr.m02=e.m02/i,Tr.m03=e.m04/s,Tr.m04=e.m05/s,Tr.m05=e.m06/s,Tr.m06=e.m08/r,Tr.m07=e.m09/r,Tr.m08=e.m10/r,js.determinant(Tr)<0&&(Tr.m00*=-1,Tr.m01*=-1,Tr.m02*=-1),sr.fromMat3(t,Tr)}fromRTS(t,e,i){return vr.fromSRT(this,t,e,i)}fromSRT(t,e,i){return vr.fromSRT(this,t,e,i)}fromQuat(t){return vr.fromQuat(this,t)}}t("Mat4",vr),ur=vr,vr.IDENTITY=Object.freeze(new ur);const Sr=new Ms,Tr=new js;function wr(t,e,i,s,r,n,o,a,h,l,c,u,d,_,p,m){return new vr(t,e,i,s,r,n,o,a,h,l,c,u,d,_,p,m)}yi.fastDefine("cc.Mat4",vr,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),h.Mat4=vr,h.mat4=wr;const Cr=Math.abs,Ar=Math.max,Dr=Math.min,Er=Math.PI,Ir=Math.acos,Mr=Math.sin,Pr=Math.cos,Or=Math.sqrt,Rr=Math.atan2,Br=Math.ceil,Fr=Math.floor,Nr=Math.round;function Lr(t,e){return Object.freeze(new kr(t,e))}class kr extends ye{static clone(t){return new kr(t.x,t.y)}static copy(t,e){return t.x=e.x,t.y=e.y,t}static set(t,e,i){return t.x=e,t.y=i,t}static add(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t}static subtract(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t}static multiply(t,e,i){return t.x=e.x*i.x,t.y=e.y*i.y,t}static divide(t,e,i){return t.x=e.x/i.x,t.y=e.y/i.y,t}static ceil(t,e){return t.x=Br(e.x),t.y=Br(e.y),t}static floor(t,e){return t.x=Fr(e.x),t.y=Fr(e.y),t}static min(t,e,i){return t.x=Dr(e.x,i.x),t.y=Dr(e.y,i.y),t}static max(t,e,i){return t.x=Ar(e.x,i.x),t.y=Ar(e.y,i.y),t}static round(t,e){return t.x=Nr(e.x),t.y=Nr(e.y),t}static multiplyScalar(t,e,i){return t.x=e.x*i,t.y=e.y*i,t}static scaleAndAdd(t,e,i,s){return t.x=e.x+i.x*s,t.y=e.y+i.y*s,t}static distance(t,e){const i=e.x-t.x,s=e.y-t.y;return Or(i*i+s*s)}static squaredDistance(t,e){const i=e.x-t.x,s=e.y-t.y;return i*i+s*s}static len(t){const e=t.x,i=t.y;return Or(e*e+i*i)}static lengthSqr(t){const e=t.x,i=t.y;return e*e+i*i}static negate(t,e){return t.x=-e.x,t.y=-e.y,t}static inverse(t,e){return t.x=1/e.x,t.y=1/e.y,t}static inverseSafe(t,e){const i=e.x,s=e.y;return Cr(i)<Mi?t.x=0:t.x=1/i,Cr(s)<Mi?t.y=0:t.y=1/s,t}static normalize(t,e){const i=e.x,s=e.y;let r=i*i+s*s;return r>0?(r=1/Or(r),t.x=i*r,t.y=s*r):(t.x=0,t.y=0),t}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e,i){return t instanceof Ms?(t.x=t.y=0,t.z=e.x*i.y-e.y*i.x,t):t.x*e.y-t.y*e.x}static lerp(t,e,i,s){const r=e.x,n=e.y;return t.x=r+s*(i.x-r),t.y=n+s*(i.y-n),t}static random(t,e){e=e||1;const i=2*ki()*Er;return t.x=Pr(i)*e,t.y=Mr(i)*e,t}static transformMat3(t,e,i){const s=e.x,r=e.y;return t.x=i.m00*s+i.m03*r+i.m06,t.y=i.m01*s+i.m04*r+i.m07,t}static transformMat4(t,e,i){const s=e.x,r=e.y;return t.x=i.m00*s+i.m04*r+i.m12,t.y=i.m01*s+i.m05*r+i.m13,t}static str(t){return`Vec2(${t.x}, ${t.y})`}static toArray(t,e,i=0){return t[i+0]=e.x,t[i+1]=e.y,t}static fromArray(t,e,i=0){return t.x=e[i+0],t.y=e[i+1],t}static strictEquals(t,e){return t.x===e.x&&t.y===e.y}static equals(t,e,i=Mi){return Cr(t.x-e.x)<=i*Ar(1,Cr(t.x),Cr(e.x))&&Cr(t.y-e.y)<=i*Ar(1,Cr(t.y),Cr(e.y))}static angle(t,e){const i=t.x*t.x+t.y*t.y,s=e.x*e.x+e.y*e.y;if(0===i||0===s)return 0;let r=(t.x*e.x+t.y*e.y)/Or(i*s);return r=Ri(r,-1,1),Ir(r)}constructor(t,e){super(),"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0)}clone(){return new kr(this.x,this.y)}set(t,e){return"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0),this}equals(t,e=Mi){return kr.equals(this,t,e)}equals2f(t,e,i=Mi){return Cr(this.x-t)<=i*Ar(1,Cr(this.x),Cr(t))&&Cr(this.y-e)<=i*Ar(1,Cr(this.y),Cr(e))}strictEquals(t){return t&&this.x===t.x&&this.y===t.y}strictEquals2f(t,e){return this.x===t&&this.y===e}toString(){return`(${this.x}, ${this.y})`}lerp(t,e){const i=this.x,s=this.y;return this.x=i+e*(t.x-i),this.y=s+e*(t.y-s),this}clampf(t,e){return this.x=Ri(this.x,t.x,e.x),this.y=Ri(this.y,t.y,e.y),this}add(t){return this.x+=t.x,this.y+=t.y,this}add2f(t,e){return this.x+=t,this.y+=e,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}subtract2f(t,e){return this.x-=t,this.y-=e,this}multiplyScalar(t){return"object"==typeof t&&j(16359),this.x*=t,this.y*=t,this}multiply(t){return"object"!=typeof t&&j(16360),this.x*=t.x,this.y*=t.y,this}multiply2f(t,e){return this.x*=t,this.y*=e,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divide2f(t,e){return this.x/=t,this.y/=e,this}negative(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}length(){return Or(this.x*this.x+this.y*this.y)}lengthSqr(){return this.x*this.x+this.y*this.y}normalize(){const t=this,e=t.x,i=t.y;let s=e*e+i*i;return s>0&&(s=1/Or(s),t.x*=s,t.y*=s),t}angle(t){const e=this.lengthSqr(),i=t.lengthSqr();if(0===e||0===i)return 0;let s=this.dot(t)/Or(e*i);return s=Ri(s,-1,1),Ir(s)}signAngle(t){const e=this.cross(t),i=this.dot(t);return Rr(e,i)}rotate(t){const e=this.x,i=this.y,s=Mr(t),r=Pr(t);return this.x=r*e-s*i,this.y=s*e+r*i,this}project(t){const e=this.dot(t)/t.dot(t);return this.x=t.x*e,this.y=t.y*e,this}transformMat4(t){const e=this.x,i=this.y;return this.x=t.m00*e+t.m04*i+t.m12,this.y=t.m01*e+t.m05*i+t.m13,this}toVec3(){return new Ms(this.x,this.y,0)}}function zr(t,e){return new kr(t,e)}t("Vec2",kr),kr.ZERO=Lr(0,0),kr.ONE=Lr(1,1),kr.NEG_ONE=Lr(-1,-1),kr.UNIT_X=Lr(1,0),kr.UNIT_Y=Lr(0,1),yi.fastDefine("cc.Vec2",kr,{x:0,y:0}),h.Vec2=kr,h.v2=zr,Q(kr,"Vec2",[{name:"sub",newName:"subtract",target:kr,targetName:"Vec2"},{name:"mul",newName:"multiply",target:kr,targetName:"Vec2"},{name:"div",newName:"divide",target:kr,targetName:"Vec2"},{name:"dist",newName:"distance",target:kr,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:kr,targetName:"Vec2"},{name:"mag",newName:"len",target:kr,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:kr,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:kr,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:kr,targetName:"Vec2"}]),Q(kr.prototype,"Vec2",[{name:"mag",newName:"length",target:kr.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:kr.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:kr.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:kr.prototype,targetName:"Vec2"}]),Q(Ms,"Vec3",[{name:"sub",newName:"subtract",target:Ms,targetName:"Vec3"},{name:"mul",newName:"multiply",target:Ms,targetName:"Vec3"},{name:"div",newName:"divide",target:Ms,targetName:"Vec3"},{name:"dist",newName:"distance",target:Ms,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:Ms,targetName:"Vec3"},{name:"mag",newName:"len",target:Ms,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:Ms,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Ms,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Ms,targetName:"Vec3"}]),Q(Ms.prototype,"Vec3",[{name:"mag",newName:"length",target:Ms.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:Ms.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Ms.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Ms.prototype,targetName:"Vec3"}]),Q(ms,"Vec4",[{name:"sub",newName:"subtract",target:ms,targetName:"Vec4"},{name:"mul",newName:"multiply",target:ms,targetName:"Vec4"},{name:"div",newName:"divide",target:ms,targetName:"Vec4"},{name:"dist",newName:"distance",target:ms,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:ms,targetName:"Vec4"},{name:"mag",newName:"len",target:ms,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:ms,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:ms,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:ms,targetName:"Vec4"}]),Q(ms.prototype,"Vec4",[{name:"mag",newName:"length",target:ms.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:ms.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:ms.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:ms.prototype,targetName:"Vec4"}]),Q(sr,"Quat",[{name:"mag",newName:"len",target:sr,targetName:"Quat"},{name:"mul",newName:"multiply",target:sr,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:sr,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:sr,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:sr,targetName:"Quat"}]),Q(sr.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:sr.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:sr.prototype,targetName:"Quat"}]),Q(Ls,"Color",[{name:"sub",newName:"subtract",target:Ls,targetName:"Color"},{name:"mul",newName:"multiply",target:Ls,targetName:"Color"},{name:"div",newName:"divide",target:Ls,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:Ls,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction(...t){const e=t[1].toString(16);return h.Color.fromHEX(t[0],e)}}]),Q(js,"Mat3",[{name:"sub",newName:"subtract",target:js,targetName:"Mat3"},{name:"mul",newName:"multiply",target:js,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:js,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:js,targetName:"Mat3"}]),Q(js.prototype,"Mat3",[{name:"sub",newName:"subtract",target:js.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:js.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:js.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:js.prototype,targetName:"Mat3"}]),Q(vr,"Mat4",[{name:"sub",newName:"subtract",target:vr,targetName:"Mat4"},{name:"mul",newName:"multiply",target:vr,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:vr,targetName:"Mat4"}]),Q(vr.prototype,"Mat4",[{name:"sub",newName:"subtract",target:vr.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:vr.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:vr.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:vr.prototype,targetName:"Mat4"}]);{const t=(t,e,i)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get(){return this._data()[i]},set(t){this._data()[i]=t}})},e=(t,e,i)=>{t._data=function(){return this.__data||(this.__data=new Float32Array(this.underlyingData())),this.__data},Object.setPrototypeOf(t,e),Object.defineProperty(t,"type",{configurable:!0,enumerable:!0,writable:!1,value:i})},i=(t,e)=>{for(const i of["__cid__","__classname__"])Object.defineProperty(t.prototype,i,{value:e.prototype[i],writable:!1,enumerable:!1,configurable:!0});for(const i of["__attrs__","__props__","__values__"])t[i]=e[i]};e(jsb.Mat4.prototype,vr.prototype,5);for(let e=0;e<16;e++){const i=`0${e}`;t(jsb.Mat4.prototype,`m${i.substring(i.length-2)}`,e)}for(let e=0;e<9;e++){const i=`0${e}`;t(jsb.Mat3.prototype,`m${i.substring(i.length-2)}`,e)}e(jsb.Mat3.prototype,js.prototype,4),t(jsb.Vec2.prototype,"x",0),t(jsb.Vec2.prototype,"y",1),e(jsb.Vec2.prototype,kr.prototype,0),t(jsb.Vec3.prototype,"x",0),t(jsb.Vec3.prototype,"y",1),t(jsb.Vec3.prototype,"z",2),e(jsb.Vec3.prototype,Ms.prototype,1),t(jsb.Vec4.prototype,"x",0),t(jsb.Vec4.prototype,"y",1),t(jsb.Vec4.prototype,"z",2),t(jsb.Vec4.prototype,"w",3),e(jsb.Vec4.prototype,ms.prototype,2),t(jsb.Quat.prototype,"x",0),t(jsb.Quat.prototype,"y",1),t(jsb.Quat.prototype,"z",2),t(jsb.Quat.prototype,"w",3),e(jsb.Quat.prototype,sr.prototype,3),Object.setPrototypeOf(jsb.Color.prototype,Ls.prototype),Object.defineProperty(jsb.Color.prototype,"type",{configurable:!0,enumerable:!0,writable:!1,value:8}),i(jsb.Vec4,ms),i(jsb.Vec3,Ms),i(jsb.Vec2,kr),i(jsb.Mat4,vr),i(jsb.Mat3,js),i(jsb.Color,Ls),i(jsb.Quat,sr)}var Ur;let Vr=class t extends ye{static lerp(t,e,i,s){return t.width=e.width+(i.width-e.width)*s,t.height=e.height+(i.height-e.height)*s,t}static equals(t,e){return t.width===e.width&&t.height===e.height}set x(t){this.width=t}get x(){return this.width}set y(t){this.height=t}get y(){return this.height}constructor(t,e){super(),"object"==typeof t?(this.width=t.width,this.height=t.height):(this.width=t||0,this.height=e||0)}clone(){return new t(this.width,this.height)}set(t,e){return"object"==typeof t?(this.height=t.height,this.width=t.width):(this.width=t||0,this.height=e||0),this}equals(t){return this.width===t.width&&this.height===t.height}lerp(t,e){return this.width+=(t.width-this.width)*e,this.height+=(t.height-this.height)*e,this}toString(){return`(${this.width}, ${this.height})`}};function jr(t=0,e=0){return new Vr(t,e)}t("Size",Vr),Ur=Vr,Vr.ZERO=Object.freeze(new Ur(0,0)),Vr.ONE=Object.freeze(new Ur(1,1)),yi.fastDefine("cc.Size",Vr,{width:0,height:0}),h.size=jr,h.Size=Vr;const Hr=Math.max,Gr=Math.min;let Wr=class t extends ye{static fromMinMax(t,e,i){const s=Gr(e.x,i.x),r=Gr(e.y,i.y),n=Hr(e.x,i.x),o=Hr(e.y,i.y);return t.x=s,t.y=r,t.width=n-s,t.height=o-r,t}static lerp(t,e,i,s){const r=e.x,n=e.y,o=e.width,a=e.height;return t.x=r+(i.x-r)*s,t.y=n+(i.y-n)*s,t.width=o+(i.width-o)*s,t.height=a+(i.height-a)*s,t}static intersection(t,e,i){const s=e.x,r=e.y,n=e.x+e.width,o=e.y+e.height,a=i.x,h=i.y,l=i.x+i.width,c=i.y+i.height;return t.x=Hr(s,a),t.y=Hr(r,h),t.width=Gr(n,l)-t.x,t.height=Gr(o,c)-t.y,t}static union(t,e,i){const s=e.x,r=e.y,n=e.width,o=e.height,a=i.x,h=i.y,l=i.width,c=i.height;return t.x=Gr(s,a),t.y=Gr(r,h),t.width=Hr(s+n,a+l)-t.x,t.height=Hr(r+o,h+c)-t.y,t}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}get xMin(){return this.x}set xMin(t){this.width+=this.x-t,this.x=t}get yMin(){return this.y}set yMin(t){this.height+=this.y-t,this.y=t}get xMax(){return this.x+this.width}set xMax(t){this.width=t-this.x}get yMax(){return this.y+this.height}set yMax(t){this.height=t-this.y}get center(){return new kr(this.x+.5*this.width,this.y+.5*this.height)}set center(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}get origin(){return new kr(this.x,this.y)}set origin(t){this.x=t.x,this.y=t.y}get size(){return new Vr(this.width,this.height)}set size(t){this.width=t.width,this.height=t.height}set z(t){this.width=t}get z(){return this.width}set w(t){this.height=t}get w(){return this.height}constructor(t,e,i,s){super(),"object"==typeof t?(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height):(this.x=t||0,this.y=e||0,this.width=i||0,this.height=s||0)}clone(){return new t(this.x,this.y,this.width,this.height)}set(t,e,i,s){const r=this;return"object"==typeof t?(r.x=t.x,r.y=t.y,r.width=t.width,r.height=t.height):(r.x=t||0,r.y=e||0,r.width=i||0,r.height=s||0),r}equals(t){const e=this;return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}lerp(t,e){const i=this,s=i.x,r=i.y,n=i.width,o=i.height;return i.x=s+(t.x-s)*e,i.y=r+(t.y-r)*e,i.width=n+(t.width-n)*e,i.height=o+(t.height-o)*e,i}toString(){const t=this;return`(${t.x}, ${t.y}, ${t.width}, ${t.height})`}intersects(t){const e=this,i=e.x+e.width,s=e.y+e.height,r=t.x+t.width,n=t.y+t.height;return!(i<t.x||r<e.x||s<t.y||n<e.y)}contains(t){const e=this;return e.x<=t.x&&e.x+e.width>=t.x&&e.y<=t.y&&e.y+e.height>=t.y}containsRect(t){const e=this;return e.x<=t.x&&e.x+e.width>=t.x+t.width&&e.y<=t.y&&e.y+e.height>=t.y+t.height}transformMat4(t){const e=this,i=e.x,s=e.y,r=i+e.width,n=s+e.height,o=t.m00*i+t.m04*s+t.m12,a=t.m01*i+t.m05*s+t.m13,h=t.m00*r+t.m04*s+t.m12,l=t.m01*r+t.m05*s+t.m13,c=t.m00*i+t.m04*n+t.m12,u=t.m01*i+t.m05*n+t.m13,d=t.m00*r+t.m04*n+t.m12,_=t.m01*r+t.m05*n+t.m13,p=Gr(o,h,c,d),m=Hr(o,h,c,d),g=Gr(a,l,u,_),f=Hr(a,l,u,_);return e.x=p,e.y=g,e.width=m-p,e.height=f-g,e}transformMat4ToPoints(t,e,i,s,r){const n=this,o=n.x,a=n.y,h=o+n.width,l=a+n.height;e.x=t.m00*o+t.m04*a+t.m12,e.y=t.m01*o+t.m05*a+t.m13,r.x=t.m00*h+t.m04*a+t.m12,r.y=t.m01*h+t.m05*a+t.m13,i.x=t.m00*o+t.m04*l+t.m12,i.y=t.m01*o+t.m05*l+t.m13,s.x=t.m00*h+t.m04*l+t.m12,s.y=t.m01*h+t.m05*l+t.m13}};function Xr(t=0,e=0,i=0,s=0){return new Wr(t,e,i,s)}t("Rect",Wr),yi.fastDefine("cc.Rect",Wr,{x:0,y:0,width:0,height:0}),h.Rect=Wr,h.rect=Xr;const Yr=t("MATH_FLOAT_ARRAY",Float32Array);class qr extends ye{static createFloatArray(t){return new Yr(t)}get array(){return this._array}}t("MathBase",qr);var $r=Object.freeze({__proto__:null,Color:Ls,EPSILON:Mi,HALF_PI:Ei,MATH_FLOAT_ARRAY:Yr,Mat3:js,Mat4:vr,MathBase:qr,Quat:sr,Rect:Wr,Size:Vr,TWO_PI:Ii,Vec2:kr,Vec3:Ms,Vec4:ms,absMax:Ki,absMaxComponent:$i,approx:Oi,bits:b,clamp:Ri,clamp01:Bi,color:ks,enumerableProps:Zi,equals:Pi,floatToHalf:ts,halfToFloat:es,inverseLerp:qi,lerp:Fi,mat4:wr,nextPow2:Wi,pingPong:Yi,preTransforms:_r,pseudoRandom:ji,pseudoRandomRange:Hi,pseudoRandomRangeInt:Gi,quat:cr,random:ki,randomRange:Ui,randomRangeInt:Vi,rect:Xr,repeat:Xi,setRandGenerator:zi,size:jr,toDegree:Li,toRadian:Ni,v2:zr,v3:Ps,v4:gs});t("math",$r);const Kr=new Ms,Zr=new Ms,Qr=new Ms,Jr=new Ms,tn=new Ms,en=new Ms,sn=new Array(3),rn=new Array(3);function nn(t,e){return Ms.dot(e.n,t)-e.d}function on(t,e,i){return Ms.copy(t,e),Ms.subtract(tn,i.center,i.halfExtents),Ms.add(en,i.center,i.halfExtents),t.x=t.x<tn.x?tn.x:t.x,t.y=t.y<tn.y?tn.y:t.y,t.z=t.z<tn.z?tn.z:t.z,t.x=t.x>en.x?en.x:t.x,t.y=t.y>en.y?en.y:t.y,t.z=t.z>en.z?en.z:t.z,t}function an(t,e,i){Ms.set(Kr,i.orientation.m00,i.orientation.m01,i.orientation.m02),Ms.set(Zr,i.orientation.m03,i.orientation.m04,i.orientation.m05),Ms.set(Qr,i.orientation.m06,i.orientation.m07,i.orientation.m08),sn[0]=Kr,sn[1]=Zr,sn[2]=Qr,rn[0]=i.halfExtents.x,rn[1]=i.halfExtents.y,rn[2]=i.halfExtents.z,Ms.subtract(Jr,e,i.center),Ms.set(t,i.center.x,i.center.y,i.center.z);for(let e=0;e<3;e++){let i=Ms.dot(Jr,sn[e]);i>rn[e]&&(i=rn[e]),i<-rn[e]&&(i=-rn[e]),t.x+=i*sn[e].x,t.y+=i*sn[e].y,t.z+=i*sn[e].z}return t}var hn=Object.freeze({__proto__:null,point_plane:nn,pt_point_aabb:on,pt_point_line:function(t,e,i,s){Ms.subtract(Kr,i,s);const r=Kr.clone(),n=Ms.lengthSqr(r);if(0===n)Ms.copy(t,i);else{Ms.subtract(Kr,e,i);const o=Ms.dot(Kr,r)/n;o<0?Ms.copy(t,i):o>1?Ms.copy(t,s):Ms.scaleAndAdd(t,i,r,o)}},pt_point_obb:an,pt_point_plane:function(t,e,i){const s=nn(e,i);return Ms.subtract(t,e,Ms.multiplyScalar(t,i.n,s))}});let ln=class t{static create(e,i,s,r,n,o){return new t(e,i,s,r,n,o)}static clone(e){return new t(e.s.x,e.s.y,e.s.z,e.e.x,e.e.y,e.e.z)}static copy(t,e){return Ms.copy(t.s,e.s),Ms.copy(t.e,e.e),t}static fromPoints(t,e,i){return Ms.copy(t.s,e),Ms.copy(t.e,i),t}static set(t,e,i,s,r,n,o){return t.s.x=e,t.s.y=i,t.s.z=s,t.e.x=r,t.e.y=n,t.e.z=o,t}static len(t){return Ms.distance(t.s,t.e)}get type(){return this._type}constructor(t=0,e=0,i=0,s=0,r=0,n=-1){this.s=void 0,this.e=void 0,this._type=void 0,this._type=2,this.s=new Ms(t,e,i),this.e=new Ms(s,r,n)}length(){return Ms.distance(this.s,this.e)}};class cn{static create(t=0,e=0,i=0,s=0,r=0,n=1){return new cn(t,e,i,s,r,n)}static clone(t){return new cn(t.o.x,t.o.y,t.o.z,t.d.x,t.d.y,t.d.z)}static copy(t,e){return Ms.copy(t.o,e.o),Ms.copy(t.d,e.d),t}static fromPoints(t,e,i){return Ms.copy(t.o,e),Ms.normalize(t.d,Ms.subtract(t.d,i,e)),t}static set(t,e,i,s,r,n,o){return t.o.x=e,t.o.y=i,t.o.z=s,t.d.x=r,t.d.y=n,t.d.z=o,t}get type(){return this._type}constructor(t=0,e=0,i=0,s=0,r=0,n=-1){this._type=1,this.o=new Ms(t,e,i),this.d=new Ms(s,r,n)}computeHit(t,e){Ms.normalize(t,this.d),Ms.scaleAndAdd(t,this.o,t,e)}}const un=new Ms,dn=new Ms,_n=new Ms,pn=new Ms;function mn(t){return Math.max(Math.max(t.x,t.y),t.z)}class gn{static create(t,e,i,s){return new gn(t,e,i,s)}static clone(t){return new gn(t.center.x,t.center.y,t.center.z,t.radius)}static copy(t,e){return Ms.copy(t.center,e.center),t.radius=e.radius,t}static fromPoints(t,e,i){return Ms.multiplyScalar(t.center,Ms.add(un,e,i),.5),t.radius=.5*Ms.subtract(un,i,e).length(),t}static set(t,e,i,s,r){return t.center.x=e,t.center.y=i,t.center.z=s,t.radius=r,t}get center(){return this._center}set center(t){this._center=t}get radius(){return this._radius}set radius(t){this._radius=t}get type(){return this._type}constructor(t=0,e=0,i=0,s=1){this._type=4,this._center=new Ms(t,e,i),this._radius=s}destroy(){}clone(){return gn.clone(this)}copy(t){return gn.copy(this,t)}getBoundary(t,e){Ms.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),Ms.set(e,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)}transform(t,e,i,s,r){Ms.transformMat4(r.center,this.center,t),r.radius=this.radius*mn(s)}translateAndRotate(t,e,i){Ms.transformMat4(i.center,this.center,t)}setScale(t,e){e.radius=this.radius*mn(t)}mergePoint(t){this.radius<0&&(this.center.set(t),this.radius=0),Ms.subtract(dn,t,this.center);const e=dn.length();if(e>this.radius){const t=.5*(e-this.radius);this.radius+=t,Ms.multiplyScalar(dn,dn,t/e),Ms.add(this.center,this.center,dn)}}mergePoints(t){const e=t.length;if(!(e<1)){this.radius=-1;for(let i=0;i<e;i++)this.mergePoint(t[i])}}mergeAABB(t){t.getBoundary(_n,pn),this.mergePoint(_n),this.mergePoint(pn)}}const fn=Ms.squaredDistance,yn=Ms.subtract,bn=Ms.dot,vn=Ms.set,Sn=Ms.cross,Tn=Ms.multiplyScalar,wn=Ms.copy,xn=Ms.add,Cn=Ms.scaleAndAdd,An=Math.max,Dn=Math.min,En=Math.abs,In=function(t,e){const i=bn(t.d,e.n);if(En(i)<Number.EPSILON)return 0;const s=-nn(t.o,e)/i;return s<0?0:s},Mn=function(){const t=Ps(),e=Ps(),i=Ps(),s=Ps(),r=Ps();return function(n,o,a){yn(t,o.b,o.a),yn(e,o.c,o.a),Sn(i,n.d,e);const h=bn(t,i);if(h<Number.EPSILON&&(!a||h>-Number.EPSILON))return 0;const l=1/h;yn(s,n.o,o.a);const c=bn(s,i)*l;if(c<0||c>1)return 0;Sn(r,s,t);const u=bn(n.d,r)*l;if(u<0||c+u>1)return 0;const d=bn(e,r)*l;return d<0?0:d}}(),Pn=function(){const t=Ps();return function(e,i){const s=i.radius,r=i.center,n=e.o,o=e.d,a=s*s;yn(t,r,n);const h=t.lengthSqr(),l=bn(t,o),c=a-(h-l*l);if(c<0)return 0;const u=Math.sqrt(c),d=h<a?l+u:l-u;return d<0?0:d}}(),On=function(){const t=Ps(),e=Ps();return function(i,s){return yn(t,s.center,s.halfExtents),xn(e,s.center,s.halfExtents),Rn(i,t,e)}}();function Rn(t,e,i){const s=t.o,r=t.d,n=1/r.x,o=1/r.y,a=1/r.z,h=(e.x-s.x)*n,l=(i.x-s.x)*n,c=(e.y-s.y)*o,u=(i.y-s.y)*o,d=(e.z-s.z)*a,_=(i.z-s.z)*a,p=An(An(Dn(h,l),Dn(c,u)),Dn(d,_)),m=Dn(Dn(An(h,l),An(c,u)),An(d,_));return m<0||p>m?0:p>0?p:m}const Bn=function(){let t=Ps(),e=Ps(),i=Ps();const s=Ps(),r=Ps(),n=Ps(),o=Ps(),a=new Array(3),h=new Array(3),l=new Array(3),c=new Array(6);return function(u,d){const _=d.halfExtents,p=d.orientation;a[0]=_.x,a[1]=_.y,a[2]=_.z,t=d.center,e=u.o,i=u.d,vn(s,p.m00,p.m01,p.m02),vn(r,p.m03,p.m04,p.m05),vn(n,p.m06,p.m07,p.m08),yn(o,t,e),h[0]=bn(s,i),h[1]=bn(r,i),h[2]=bn(n,i),l[0]=bn(s,o),l[1]=bn(r,o),l[2]=bn(n,o);for(let t=0;t<3;++t){if(0===h[t]){if(-l[t]-a[t]>0||-l[t]+a[t]<0)return 0;h[t]=1e-7}c[2*t+0]=(l[t]+a[t])/h[t],c[2*t+1]=(l[t]-a[t])/h[t]}const m=An(An(Dn(c[0],c[1]),Dn(c[2],c[3])),Dn(c[4],c[5])),g=Dn(Dn(An(c[0],c[1]),An(c[2],c[3])),An(c[4],c[5]));return g<0||m>g?0:m>0?m:g}}(),Fn=function(){const t=Ps(),e=Ps(),i=Ps(),s=Ps(),r=Ps(),n=Ps(),o=Ps(),a=new gn;return function(h,l){const c=l.ellipseCenter0,u=l.ellipseCenter1,d=yn(e,u,c);if(d.length()<Mi)return a.radius=l.radius,a.center.set(l.ellipseCenter0),co.raySphere(h,a);const _=h.o,p=yn(i,_,c),m=Ms.normalize(t,h.d),g=Sn(s,m,d),f=g.lengthSqr();if(0===f){a.radius=l.radius;const t=yn(r,u,_);return p.lengthSqr()<t.lengthSqr()?a.center.set(c):a.center.set(u),co.raySphere(h,a)}const y=Sn(r,p,d),b=d.lengthSqr(),v=2*bn(g,y),S=l.radius*l.radius,T=v*v-4*f*(y.lengthSqr()-S*b);if(T<0)return 0;const w=(-v-Math.sqrt(T))/(2*f);if(w<0){a.radius=l.radius;const t=yn(n,u,_);return p.lengthSqr()<t.lengthSqr()?a.center.set(l.ellipseCenter0):a.center.set(l.ellipseCenter1),co.raySphere(h,a)}{const t=Cn(n,h.o,m,w),e=yn(o,t,c),i=bn(e,d)/b;return i>=0&&i<=1?w:i<0?(a.radius=l.radius,a.center.set(l.ellipseCenter0),co.raySphere(h,a)):i>1?(a.radius=l.radius,a.center.set(l.ellipseCenter1),co.raySphere(h,a)):0}}}(),Nn=function(){const t=Ps();return function(e,i){yn(t,e.e,e.s);const s=-nn(e.s,i)/bn(t,i.n);return s<0||s>1?0:s}}(),Ln=function(){const t=Ps(),e=Ps(),i=Ps(),s=Ps(),r=Ps(),n=Ps();return function(o,a,h){yn(t,a.b,a.a),yn(e,a.c,a.a),yn(i,o.s,o.e),Sn(r,t,e);const l=bn(i,r);if(l<=0)return 0;yn(s,o.s,a.a);const c=bn(s,r);if(c<0||c>l)return 0;Sn(n,i,s);let u=bn(e,n);if(u<0||u>l)return 0;let d=-bn(t,n);if(d<0||u+d>l)return 0;if(h){const t=1/l;u*=t,d*=t;const e=1-u-d;vn(h,a.a.x*e+a.b.x*u+a.c.x*d,a.a.y*e+a.b.y*u+a.c.y*d,a.a.z*e+a.b.z*u+a.c.z*d)}return 1}}(),kn=new cn;function zn(t,e){kn.o.set(t.s),yn(kn.d,t.e,t.s),kn.d.normalize();const i=On(kn,e);return i<=t.length()?i:0}function Un(t,e){kn.o.set(t.s),yn(kn.d,t.e,t.s),kn.d.normalize();const i=Bn(kn,e);return i<=t.length()?i:0}function Vn(t,e){kn.o.set(t.s),yn(kn.d,t.e,t.s),kn.d.normalize();const i=Pn(kn,e);return i<=t.length()?i:0}const jn=function(){const t=Ps(),e=Ps(),i=Ps(),s=Ps();return function(r,n){return yn(t,r.center,r.halfExtents),xn(e,r.center,r.halfExtents),yn(i,n.center,n.halfExtents),xn(s,n.center,n.halfExtents),t.x<=s.x&&e.x>=i.x&&t.y<=s.y&&e.y>=i.y&&t.z<=s.z&&e.z>=i.z}}();function Hn(t,e,i){vn(i[0],t.x,e.y,e.z),vn(i[1],t.x,e.y,t.z),vn(i[2],t.x,t.y,e.z),vn(i[3],t.x,t.y,t.z),vn(i[4],e.x,e.y,e.z),vn(i[5],e.x,e.y,t.z),vn(i[6],e.x,t.y,e.z),vn(i[7],e.x,t.y,t.z)}function Gn(t,e,i,s,r,n){vn(n[0],t.x+i.x*e.x+s.x*e.y+r.x*e.z,t.y+i.y*e.x+s.y*e.y+r.y*e.z,t.z+i.z*e.x+s.z*e.y+r.z*e.z),vn(n[1],t.x-i.x*e.x+s.x*e.y+r.x*e.z,t.y-i.y*e.x+s.y*e.y+r.y*e.z,t.z-i.z*e.x+s.z*e.y+r.z*e.z),vn(n[2],t.x+i.x*e.x-s.x*e.y+r.x*e.z,t.y+i.y*e.x-s.y*e.y+r.y*e.z,t.z+i.z*e.x-s.z*e.y+r.z*e.z),vn(n[3],t.x+i.x*e.x+s.x*e.y-r.x*e.z,t.y+i.y*e.x+s.y*e.y-r.y*e.z,t.z+i.z*e.x+s.z*e.y-r.z*e.z),vn(n[4],t.x-i.x*e.x-s.x*e.y-r.x*e.z,t.y-i.y*e.x-s.y*e.y-r.y*e.z,t.z-i.z*e.x-s.z*e.y-r.z*e.z),vn(n[5],t.x+i.x*e.x-s.x*e.y-r.x*e.z,t.y+i.y*e.x-s.y*e.y-r.y*e.z,t.z+i.z*e.x-s.z*e.y-r.z*e.z),vn(n[6],t.x-i.x*e.x+s.x*e.y-r.x*e.z,t.y-i.y*e.x+s.y*e.y-r.y*e.z,t.z-i.z*e.x+s.z*e.y-r.z*e.z),vn(n[7],t.x-i.x*e.x-s.x*e.y+r.x*e.z,t.y-i.y*e.x-s.y*e.y+r.y*e.z,t.z-i.z*e.x-s.z*e.y+r.z*e.z)}function Wn(t,e){let i=bn(e,t[0]),s=i;for(let r=1;r<8;++r){const n=bn(e,t[r]);i=n<i?n:i,s=n>s?n:s}return[i,s]}const Xn=function(){const t=new Array(15);for(let e=0;e<15;e++)t[e]=Ps();const e=new Array(8),i=new Array(8);for(let t=0;t<8;t++)e[t]=Ps(),i[t]=Ps();const s=Ps(),r=Ps();return function(n,o){const a=o.orientation;vn(t[0],1,0,0),vn(t[1],0,1,0),vn(t[2],0,0,1),vn(t[3],a.m00,a.m01,a.m02),vn(t[4],a.m03,a.m04,a.m05),vn(t[5],a.m06,a.m07,a.m08);for(let e=0;e<3;++e)Sn(t[6+3*e],t[e],t[3]),Sn(t[7+3*e],t[e],t[4]),Sn(t[7+3*e],t[e],t[5]);yn(s,n.center,n.halfExtents),xn(r,n.center,n.halfExtents),Hn(s,r,e),Gn(o.center,o.halfExtents,t[3],t[4],t[5],i);for(let s=0;s<15;++s){const r=Wn(e,t[s]),n=Wn(i,t[s]);if(n[0]>r[1]||r[0]>n[1])return 0}return 1}}(),Yn=function(t,e){const i=t.halfExtents,s=e.n,r=i.x*En(s.x)+i.y*En(s.y)+i.z*En(s.z),n=bn(s,t.center);return n+r<e.d?-1:n-r>e.d?0:1},qn=function(t,e){const i=e.planes;for(let e=0;e<i.length;e++)if(-1===Yn(t,i[e]))return 0;return 1},$n=function(){const t=new Array(8);let e=0,i=0;for(let e=0;e<t.length;e++)t[e]=Ps();return function(s,r){const n=r.vertices,o=s.halfExtents;let a=0,h=!1;for(let t=0;t<r.planes.length;t++){if(a=Yn(s,r.planes[t]),-1===a)return 0;1===a&&(h=!0)}if(!h)return 1;for(let e=0;e<n.length;e++)yn(t[e],n[e],s.center);e=0,i=0;for(let s=0;s<n.length;s++)t[s].x>o.x?e++:t[s].x<-o.x&&i++;if(e===n.length||i===n.length)return 0;e=0,i=0;for(let s=0;s<n.length;s++)t[s].y>o.y?e++:t[s].y<-o.y&&i++;if(e===n.length||i===n.length)return 0;e=0,i=0;for(let s=0;s<n.length;s++)t[s].z>o.z?e++:t[s].z<-o.z&&i++;return e===n.length||i===n.length?0:1}}(),Kn=function(){const t=Ps(),e=new js;return function(i,s){return yn(t,s,i.center),Ms.transformMat3(t,t,js.transpose(e,i.orientation)),r=t,n=i.halfExtents,En(r.x)<n.x&&En(r.y)<n.y&&En(r.z)<n.z;var r,n}}(),Zn=function(){const t=function(t,e,i,s){return En(t.x*e+t.y*i+t.z*s)};return function(e,i){const s=e.orientation,r=e.halfExtents,n=i.n,o=i.d,a=r.x*t(n,s.m00,s.m01,s.m02)+r.y*t(n,s.m03,s.m04,s.m05)+r.z*t(n,s.m06,s.m07,s.m08),h=bn(n,e.center);return h+a<o?-1:h-a>o?0:1}}(),Qn=function(t,e){const i=e.planes;for(let e=0;e<i.length;e++)if(-1===Zn(t,i[e]))return 0;return 1},Jn=function(){const t=new Array(8);let e=0,i=0,s=0;for(let e=0;e<t.length;e++)t[e]=Ps();const r=function(t,e,i,s){return t.x*e+t.y*i+t.z*s};return function(n,o){const a=n.orientation,h=n.halfExtents,l=o.vertices,c=o.planes;let u=0,d=!1;for(let t=0;t<c.length;t++){if(u=Zn(n,c[t]),-1===u)return 0;1===u&&(d=!0)}if(!d)return 1;for(let e=0;e<l.length;e++)yn(t[e],l[e],n.center);i=0,s=0;for(let n=0;n<l.length;n++)e=r(t[n],a.m00,a.m01,a.m02),e>h.x?i++:e<-h.x&&s++;if(i===l.length||s===l.length)return 0;i=0,s=0;for(let n=0;n<l.length;n++)e=r(t[n],a.m03,a.m04,a.m05),e>h.y?i++:e<-h.y&&s++;if(i===l.length||s===l.length)return 0;i=0,s=0;for(let n=0;n<l.length;n++)e=r(t[n],a.m06,a.m07,a.m08),e>h.z?i++:e<-h.z&&s++;return i===l.length||s===l.length?0:1}}(),to=function(){const t=new Array(15);for(let e=0;e<15;e++)t[e]=Ps();const e=new Array(8),i=new Array(8);for(let t=0;t<8;t++)e[t]=Ps(),i[t]=Ps();return function(s,r){const n=s.orientation,o=r.orientation;vn(t[0],n.m00,n.m01,n.m02),vn(t[1],n.m03,n.m04,n.m05),vn(t[2],n.m06,n.m07,n.m08),vn(t[3],o.m00,o.m01,o.m02),vn(t[4],o.m03,o.m04,o.m05),vn(t[5],o.m06,o.m07,o.m08);for(let e=0;e<3;++e)Sn(t[6+3*e],t[e],t[3]),Sn(t[7+3*e],t[e],t[4]),Sn(t[8+3*e],t[e],t[5]);Gn(s.center,s.halfExtents,t[0],t[1],t[2],e),Gn(r.center,r.halfExtents,t[3],t[4],t[5],i);for(let s=0;s<15;++s){const r=Wn(e,t[s]),n=Wn(i,t[s]);if(n[0]>r[1]||r[0]>n[1])return 0}return 1}}(),eo=function(){const t=new gn,e=Ps(),i=Ps(),s=Ps(),r=new Array(8);for(let t=0;t<8;t++)r[t]=Ps();const n=new Array(8);for(let t=0;t<8;t++)n[t]=Ps();return function(o,a){const h=a.ellipseCenter0,l=a.ellipseCenter1,c=a.radius;if(0===fn(h,l))return t.radius=a.radius,t.center.set(h),co.sphereOBB(t,o);{const t=o.orientation;e.x=t.m00,e.y=t.m01,e.z=t.m02,i.x=t.m03,i.y=t.m04,i.z=t.m05,s.x=t.m06,s.y=t.m07,s.z=t.m08,Gn(o.center,o.halfExtents,e,i,s,r);const u=n,d=wn(u[0],e),_=wn(u[1],i),p=wn(u[2],s);yn(u[3],a.center,o.center).normalize();const m=yn(u[4],h,l);m.normalize(),Sn(u[5],d,m),Sn(u[6],_,m),Sn(u[7],p,m);for(let t=0;t<8;++t){const e=Wn(r,u[t]),i=bn(u[t],h),s=bn(u[t],l),n=An(i,s)+c;if(Dn(i,s)-c>e[1]||e[0]>n)return 0}return 1}}}(),io=function(t,e){const i=bn(e.n,t.center),s=t.radius*e.n.length();return i+s<e.d?-1:i-s>e.d?0:1},so=function(t,e){const i=e.planes;for(let e=0;e<i.length;e++)if(-1===io(t,i[e]))return 0;return 1},ro=function(){const t=Ps(),e=[1,-1,1,-1,1,-1];return function(i,s){for(let r=0;r<6;r++){const n=s.planes[r],o=i.radius,a=i.center,h=n.n,l=n.d,c=bn(h,a);if(c+o<l)return 0;if(!(c-o>l)){xn(t,a,Tn(t,h,o));for(let i=0;i<6;i++){if(i===r||i===r+e[r])continue;const n=s.planes[i];if(bn(n.n,t)<n.d)return 0}}}return 1}}(),no=function(t,e){const i=t.radius+e.radius;return fn(t.center,e.center)<i*i},oo=function(){const t=Ps();return function(e,i){const s=e.radius;return on(t,e.center,i),fn(e.center,t)<s*s}}(),ao=function(){const t=Ps();return function(e,i){const s=e.radius;return an(t,e.center,i),fn(e.center,t)<s*s}}(),ho=function(){const t=Ps(),e=Ps();return function(i,s){const r=s.ellipseCenter0,n=s.ellipseCenter1,o=i.center,a=i.radius+s.radius,h=a*a,l=fn(r,n);if(0===l)return fn(o,s.center)<h;{yn(t,o,r),yn(e,n,r);const i=bn(t,e)/l;return i<0?fn(o,r)<h:i>1?fn(o,n)<h:(Cn(t,r,e,i),fn(o,t)<h)}}}(),lo=function(){const t=Ps(),e=Ps(),i=Ps(),s=Ps(),r=Ps(),n=Ps();return function(o,a){const h=o.ellipseCenter0,l=o.ellipseCenter1,c=a.ellipseCenter1,u=a.ellipseCenter0,d=yn(t,l,h),_=yn(e,c,u),p=yn(i,h,u),m=bn(d,d),g=bn(d,_),f=bn(_,_),y=bn(d,p),b=bn(_,p),v=m*f-g*g;let S,T,w=v,x=v;v<Mi?(S=0,w=1,T=b,x=f):(S=g*b-f*y,T=m*b-g*y,S<0?(S=0,T=b,x=f):S>w&&(S=w,T=b+g,x=f)),T<0?(T=0,-y<0?S=0:-y>m?S=w:(S=-y,w=m)):T>x&&(T=x,-y+g<0?S=0:-y+g>m?S=w:(S=-y+g,w=m));const C=En(S)<Mi?0:S/w,A=En(T)<Mi?0:T/x,D=s;D.set(p),D.add(Tn(r,d,C)),D.subtract(Tn(n,_,A));const E=o.radius+a.radius;return D.lengthSqr()<E*E}}(),co={raySphere:Pn,rayAABB:On,rayOBB:Bn,rayPlane:In,rayTriangle:Mn,rayCapsule:Fn,raySubMesh:null,rayMesh:null,rayModel:null,lineSphere:Vn,lineAABB:zn,lineOBB:Un,linePlane:Nn,lineTriangle:Ln,sphereWithSphere:no,sphereAABB:oo,sphereOBB:ao,spherePlane:io,sphereFrustum:so,sphereFrustumAccurate:ro,sphereCapsule:ho,aabbWithAABB:jn,aabbWithOBB:Xn,aabbPlane:Yn,aabbFrustum:qn,aabbFrustumAccurate:$n,obbWithOBB:to,obbPlane:Zn,obbFrustum:Qn,obbFrustumAccurate:Jn,obbPoint:Kn,obbCapsule:eo,aabbFrustumCompletelyInside:function(t,e){const i=e.planes;for(let e=0;e<i.length;e++)if(0!==Yn(t,i[e]))return 0;return 1},capsuleWithCapsule:lo,resolve(t,e,i=null){const s=t._type,r=e._type,n=this[s|r];return s<r?n(t,e,i):n(e,t,i)}};co[5]=Pn,co[9]=On,co[17]=Bn,co[33]=In,co[65]=Mn,co[513]=Fn,co[6]=Vn,co[10]=zn,co[18]=Un,co[34]=Nn,co[66]=Ln,co[4]=no,co[12]=oo,co[20]=ao,co[36]=io,co[132]=so,co[260]=ro,co[516]=ho,co[8]=jn,co[24]=Xn,co[40]=Yn,co[136]=qn,co[264]=$n,co[16]=to,co[48]=Zn,co[144]=Qn,co[272]=Jn,co[528]=eo,co[512]=lo,Q(ln.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),J(co,"intersect",[{name:"line_quad"}]);const uo=new Ms(0,0,0),_o=new Ms(0,0,0),po=wr(),mo=gs();class go{static create(t,e,i,s){return new go(t,e,i,s)}static clone(t){return new go(t.n.x,t.n.y,t.n.z,t.d)}static copy(t,e){return Ms.copy(t.n,e.n),t.d=e.d,t}static fromPoints(t,e,i,s){return Ms.subtract(uo,i,e),Ms.subtract(_o,s,e),Ms.normalize(t.n,Ms.cross(t.n,uo,_o)),t.d=Ms.dot(t.n,e),t}static set(t,e,i,s,r){return t.n.x=e,t.n.y=i,t.n.z=s,t.d=r,t}static fromNormalAndPoint(t,e,i){return Ms.copy(t.n,e),t.d=Ms.dot(e,i),t}static normalize(t,e){const i=e.n.length();return Ms.normalize(t.n,e.n),i>0&&(t.d=e.d/i),t}get type(){return this._type}set x(t){this.n.x=t}get x(){return this.n.x}set y(t){this.n.y=t}get y(){return this.n.y}set z(t){this.n.z=t}get z(){return this.n.z}set w(t){this.d=t}get w(){return this.d}constructor(t=0,e=1,i=0,s=0){this._type=32,this.n=new Ms(t,e,i),this.d=s}transform(t){vr.invert(po,t),vr.transpose(po,po),ms.set(mo,this.n.x,this.n.y,this.n.z,-this.d),ms.transformMat4(mo,mo,po),Ms.set(this.n,mo.x,mo.y,mo.z),this.d=-mo.w}}class fo{static create(t=1,e=0,i=0,s=0,r=0,n=0,o=0,a=0,h=1){return new fo(t,e,i,s,r,n,o,a,h)}static clone(t){return new fo(t.a.x,t.a.y,t.a.z,t.b.x,t.b.y,t.b.z,t.c.x,t.c.y,t.c.z)}static copy(t,e){return Ms.copy(t.a,e.a),Ms.copy(t.b,e.b),Ms.copy(t.c,e.c),t}static fromPoints(t,e,i,s){return Ms.copy(t.a,e),Ms.copy(t.b,i),Ms.copy(t.c,s),t}static set(t,e,i,s,r,n,o,a,h,l){return t.a.x=e,t.a.y=i,t.a.z=s,t.b.x=r,t.b.y=n,t.b.z=o,t.c.x=a,t.c.y=h,t.c.z=l,t}get type(){return this._type}constructor(t=0,e=0,i=0,s=1,r=0,n=0,o=0,a=1,h=0){this._type=64,this.a=new Ms(t,e,i),this.b=new Ms(s,r,n),this.c=new Ms(o,a,h)}}at({replaceProperty:{since:"3.6.0",removed:!1},removeProperty:{since:"3.6.0",removed:!1},markAsWarning:{since:"3.6.0",removed:!1},setDefaultLogTimes:{since:"3.6.0",removed:!1}});class yo{constructor(){this._poolHandle=-1,bo.addContainer(this)}destroy(){bo.removeContainer(this)}}const bo=new class{constructor(){this._pools=[],this._lastShrinkPassed=0,this.shrinkTimeSpan=5}addContainer(t){-1===t._poolHandle&&(t._poolHandle=this._pools.length,this._pools.push(t))}removeContainer(t){-1!==t._poolHandle&&(this._pools[this._pools.length-1]._poolHandle=t._poolHandle,ie(this._pools,t._poolHandle),t._poolHandle=-1)}tryShrink(){for(let t=0;t<this._pools.length;t++)this._pools[t].tryShrink()}update(t){this._lastShrinkPassed+=t,this._lastShrinkPassed>this.shrinkTimeSpan&&(this.tryShrink(),this._lastShrinkPassed-=this.shrinkTimeSpan)}};class vo extends yo{constructor(t,e,i,s){super(),this._freePool=[],this._ctor=t,this._dtor=i||null,this._elementsPerBatch=Math.max(e,1),this._shrinkThreshold=s?_(s,1):this._elementsPerBatch,this._nextAvail=this._elementsPerBatch-1;for(let e=0;e<this._elementsPerBatch;++e)this._freePool.push(t())}alloc(){if(this._nextAvail<0){this._freePool.length=this._elementsPerBatch;for(let t=0;t<this._elementsPerBatch;t++)this._freePool[t]=this._ctor();this._nextAvail=this._elementsPerBatch-1}return this._freePool[this._nextAvail--]}free(t){this._freePool[++this._nextAvail]=t}freeArray(t){this._freePool.length=this._nextAvail+1,Array.prototype.push.apply(this._freePool,t),this._nextAvail+=t.length}tryShrink(){const t=this._nextAvail+1;if(t<=this._shrinkThreshold)return;let e=0;if(e=t>>1>=this._shrinkThreshold?t>>1:Math.floor((t-this._shrinkThreshold+1)/2),this._dtor)for(let t=this._nextAvail-e+1;t<=this._nextAvail;++t)this._dtor(this._freePool[t]);this._nextAvail-=e,this._freePool.length=this._nextAvail+1}destroy(){const t=arguments.length>0?arguments[0]:null;t&&j(14100);const e=t||this._dtor;if(e)for(let t=0;t<=this._nextAvail;t++)e(this._freePool[t]);this._freePool.length=0,this._nextAvail=-1,super.destroy()}}t("Pool",vo);class So extends yo{constructor(t,e,i){super(),this._count=0,this._fn=t,this._dtor=i||null,this._data=new Array(e),this._initSize=e;for(let i=0;i<e;++i)this._data[i]=t()}get length(){return this._count}get data(){return this._data}reset(){this._count=0}resize(t){if(t>this._data.length)for(let e=this._data.length;e<t;++e)this._data[e]=this._fn()}add(){return this._count>=this._data.length&&this.resize(this._data.length<<1),this._data[this._count++]}destroy(){if(this._dtor)for(let t=0;t<this._data.length;t++)this._dtor(this._data[t]);this._data.length=0,this._count=0,super.destroy()}tryShrink(){if(this._data.length>>2>this._count){const t=Math.max(this._initSize,this._data.length>>1);if(this._dtor)for(let e=t;e<this._data.length;e++)this._dtor(this._data[e]);this._data.length=t}}removeAt(t){if(t>=this._count)return;const e=this._count-1,i=this._data[t];this._data[t]=this._data[e],this._data[e]=i,this._count-=1}}t("RecyclePool",So);class To extends yo{constructor(t,e){super(),this.length=0,this._initSize=0,this.array=new Array(t),this._initSize=t,this._compareFn=e}push(t){this.array[this.length++]=t}pop(){return this.array[--this.length]}get(t){return this.array[t]}clear(){this.length=0}destroy(){this.length=0,this.array.length=0,super.destroy()}tryShrink(){this.array.length>>2>this.length&&(this.array.length=Math.max(this._initSize,this.array.length>>1))}sort(){this.array.length=this.length,this.array.sort(this._compareFn)}concat(t){for(let e=0;e<t.length;++e)this.array[this.length++]=t[e]}fastRemove(t){if(t>=this.length||t<0)return;const e=--this.length;this.array[t]=this.array[e]}indexOf(t){for(let e=0,i=this.length;e<i;++e)if(this.array[e]===t)return e;return-1}}t("CachedArray",To),t("memop",Object.freeze({__proto__:null,CachedArray:To,Pool:vo,RecyclePool:So}));const wo=t("editorExtrasTag","__editorExtras__"),xo=t("CCObjectFlags",{Destroyed:1,RealDestroyed:2,ToDestroy:4,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,IsOnEnableCalled:2048,IsEditorOnEnableCalled:4096,IsPreloadStarted:8192,IsOnLoadCalled:16384,IsOnLoadStarted:32768,IsStartCalled:65536,IsRotationLocked:131072,IsScaleLocked:262144,IsAnchorLocked:524288,IsSizeLocked:1048576,IsPositionLocked:2097152,IsSkipTransformUpdate:16777216,PersistentMask:-4192741,AllHideMasks:1560}),Co=[];function Ao(t,e){const i=t instanceof h.Node||t instanceof h.Component,s=i?"_id":null;let r;const n={};for(r in t)if(t.hasOwnProperty(r)){if(r===s)continue;switch(typeof t[r]){case"string":n[r]="";break;case"object":case"function":n[r]=null}}if(yi._isCCClass(e)){const t=h.Class.Attr.getClassAttrs(e),s=e.__props__;for(let e=0;e<s.length;e++){r=s[e];const o=`${r}`;if(o in t){if(i&&"_id"===r)continue;switch(typeof t[o]){case"string":n[r]="";break;case"object":case"function":n[r]=null;break;case"undefined":n[r]=void 0}}}}{let t="";for(r in n){let e;e=yi.IDENTIFIER_RE.test(r)?`o.${r}=`:`o[${yi.escapeForJS(r)}]=`;let i=n[r];""===i&&(i='""'),t+=`${e+i};\n`}return Function("o",t)}}class Do{static _deferredDestroy(){const t=Co.length;for(let e=0;e<t;++e){const t=Co[e];1&t._objFlags||t._destroyImmediate()}t===Co.length?Co.length=0:Co.splice(0,t)}constructor(t=""){this._objFlags=0,this._name=t}get name(){return this._name}set name(t){this._name=t}set hideFlags(t){const e=1560&t;this._objFlags=-1561&this._objFlags|e}get hideFlags(){return 1560&this._objFlags}get isValid(){return!(1&this._objFlags)}destroy(){return 1&this._objFlags?(j(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,Co.push(this),this._destroy(),0))}_destruct(){const t=this.constructor;let e;Object.prototype.hasOwnProperty.call(t,"__destruct__")?e=t.__destruct__:(e=Ao(this,t),bt(t,"__destruct__",e,!0)),e(this)}_destroyImmediate(){var t;1&this._objFlags?G(5e3):(null==(t=this._onPreDestroy)||t.call(this),this.destruct&&this.destruct(),this._destruct(),this._objFlags|=1)}}t("CCObject",Do),Do.prototype._deserialize=null,yi.fastDefine("cc.Object",Do,{_name:"",_objFlags:0});const Eo={};for(const t in xo)"string"==typeof t&&"number"==typeof xo[t]&&(Eo[t]=xo[t]);function Io(t){return t instanceof Do}function Mo(t,e){return"object"==typeof t?!(!t||t._objFlags&(e?5:1)):void 0!==t}bt(Do,"Flags",Eo),h.isValid=Mo,Rt(Do,jsb.CCObject,["prototype","length","name"]),Rt(Do.prototype,jsb.CCObject.prototype,["constructor","name","hideFlags","isValid"]),t("CCObject",Do=jsb.CCObject),h.Object=Do;const Po=ie;function Oo(){}class Ro{constructor(){this.callback=Oo,this.target=void 0,this.once=!1}set(t,e,i){this.callback=t||Oo,this.target=e,this.once=!!i}reset(){this.target=void 0,this.callback=Oo,this.once=!1}check(){return!(Io(this.target)&&!Mo(this.target,!0))}}const Bo=new vo((()=>new Ro),32);class Fo{constructor(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}removeByCallback(t){for(let e=0;e<this.callbackInfos.length;++e){const i=this.callbackInfos[e];i&&i.callback===t&&(i.reset(),Bo.free(i),Po(this.callbackInfos,e),--e)}}removeByTarget(t){for(let e=0;e<this.callbackInfos.length;++e){const i=this.callbackInfos[e];i&&i.target===t&&(i.reset(),Bo.free(i),Po(this.callbackInfos,e),--e)}}cancel(t){const e=this.callbackInfos[t];e&&(e.reset(),this.isInvoking?this.callbackInfos[t]=null:Po(this.callbackInfos,t),Bo.free(e)),this.containCanceled=!0}cancelAll(){for(let t=0;t<this.callbackInfos.length;t++){const e=this.callbackInfos[t];e&&(e.reset(),Bo.free(e),this.callbackInfos[t]=null)}this.containCanceled=!0}purgeCanceled(){for(let t=this.callbackInfos.length-1;t>=0;--t)this.callbackInfos[t]||Po(this.callbackInfos,t);this.containCanceled=!1}clear(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1}}const No=new vo((()=>new Fo),16);class Lo{constructor(){this._callbackTable=wt(!0),this._offCallback=void 0}on(t,e,i,s){if(!this.hasEventListener(t,e,i)){let r=this._callbackTable[t];r||(r=this._callbackTable[t]=No.alloc());const n=Bo.alloc();n.set(e,i,s),r.callbackInfos.push(n)}return e}hasEventListener(t,e,i){const s=this._callbackTable&&this._callbackTable[t];if(!s)return!1;const r=s.callbackInfos;if(!e){if(s.isInvoking){for(let t=0;t<r.length;++t)if(r[t])return!0;return!1}return r.length>0}for(let t=0;t<r.length;++t){const s=r[t];if(s&&s.check()&&s.callback===e&&s.target===i)return!0}return!1}removeAll(t){const e=typeof t;if("string"===e||"number"===e){const e=this._callbackTable&&this._callbackTable[t];e&&(e.isInvoking?e.cancelAll():(e.clear(),No.free(e),delete this._callbackTable[t]))}else if(t)for(const e in this._callbackTable){const i=this._callbackTable[e];if(i.isInvoking){const e=i.callbackInfos;for(let s=0;s<e.length;++s){const r=e[s];r&&r.target===t&&i.cancel(s)}}else i.removeByTarget(t)}}off(t,e,i){var s;const r=this._callbackTable&&this._callbackTable[t];if(r){const s=r.callbackInfos;if(e)for(let t=0;t<s.length;++t){const n=s[t];if(n&&n.callback===e&&n.target===i){r.cancel(t);break}}else this.removeAll(t)}null==(s=this._offCallback)||s.call(this)}emit(t,e,i,s,r,n){const o=this._callbackTable&&this._callbackTable[t];if(o){const a=!o.isInvoking;o.isInvoking=!0;const h=o.callbackInfos;for(let o=0,a=h.length;o<a;++o){const a=h[o];if(a){const o=a.callback,h=a.target;a.once&&this.off(t,o,h),a.check()?h?o.call(h,e,i,s,r,n):o(e,i,s,r,n):this.off(t,o,h)}}a&&(o.isInvoking=!1,o.containCanceled&&o.purgeCanceled())}}clear(){for(const t in this._callbackTable){const e=this._callbackTable[t];e&&(e.clear(),No.free(e),delete this._callbackTable[t])}}_registerOffCallback(t){this._offCallback=t}}function ko(t){class e extends t{constructor(...t){super(...t),this._callbackTable=wt(!0)}once(t,e,i){return this.on(t,e,i,!0)}targetOff(t){this.removeAll(t)}}const i=Lo.prototype,s=Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i));for(let t=0;t<s.length;++t){const r=s[t];if(!(r in e.prototype)){const t=Object.getOwnPropertyDescriptor(i,r);t&&Object.defineProperty(e.prototype,r,t)}}return e}t("CallbacksInvoker",Lo);const zo=t("EventTarget",ko(class{}));h.EventTarget=zo;class Uo{constructor(){this._delegates=[]}add(t){this._delegates.includes(t)||this._delegates.push(t)}hasListener(t){return this._delegates.includes(t)}remove(t){re(this._delegates,t)}dispatch(...t){return Promise.all(this._delegates.map((t=>t(...arguments))).filter(Boolean))}}let Vo,jo,Ho,Go,Wo,Xo;t("AsyncDelegate",Uo),function(t){t.UNKNOWN="unknown",t.WECHAT="wechat",t.ANDROID="androidbrowser",t.IE="ie",t.EDGE="edge",t.QQ="qqbrowser",t.MOBILE_QQ="mqqbrowser",t.UC="ucbrowser",t.UCBS="ucbs",t.BROWSER_360="360browser",t.BAIDU_APP="baiduboxapp",t.BAIDU="baidubrowser",t.MAXTHON="maxthon",t.OPERA="opera",t.OUPENG="oupeng",t.MIUI="miuibrowser",t.FIREFOX="firefox",t.SAFARI="safari",t.CHROME="chrome",t.LIEBAO="liebao",t.QZONE="qzone",t.SOUGOU="sogou",t.HUAWEI="huawei"}(Vo||(Vo={})),function(t){t.UNKNOWN="unknown",t.ENGLISH="en",t.CHINESE="zh",t.FRENCH="fr",t.ITALIAN="it",t.GERMAN="de",t.SPANISH="es",t.DUTCH="du",t.RUSSIAN="ru",t.KOREAN="ko",t.JAPANESE="ja",t.HUNGARIAN="hu",t.PORTUGUESE="pt",t.ARABIC="ar",t.NORWEGIAN="no",t.POLISH="pl",t.TURKISH="tr",t.UKRAINIAN="uk",t.ROMANIAN="ro",t.BULGARIAN="bg",t.HINDI="hi"}(jo||(jo={})),function(t){t[t.NONE=0]="NONE",t[t.LAN=1]="LAN",t[t.WWAN=2]="WWAN"}(Ho||(Ho={})),function(t){t.UNKNOWN="Unknown",t.IOS="iOS",t.ANDROID="Android",t.WINDOWS="Windows",t.LINUX="Linux",t.OSX="OS X",t.OHOS="OHOS",t.OPENHARMONY="OpenHarmony"}(Go||(Go={})),function(t){t.UNKNOWN="UNKNOWN",t.EDITOR_PAGE="EDITOR_PAGE",t.EDITOR_CORE="EDITOR_CORE",t.MOBILE_BROWSER="MOBILE_BROWSER",t.DESKTOP_BROWSER="DESKTOP_BROWSER",t.WIN32="WIN32",t.ANDROID="ANDROID",t.IOS="IOS",t.MACOS="MACOS",t.OHOS="OHOS",t.OPENHARMONY="OPENHARMONY",t.WECHAT_GAME="WECHAT_GAME",t.WECHAT_MINI_PROGRAM="WECHAT_MINI_PROGRAM",t.XIAOMI_QUICK_GAME="XIAOMI_QUICK_GAME",t.ALIPAY_MINI_GAME="ALIPAY_MINI_GAME",t.TAOBAO_CREATIVE_APP="TAOBAO_CREATIVE_APP",t.TAOBAO_MINI_GAME="TAOBAO_MINI_GAME",t.BYTEDANCE_MINI_GAME="BYTEDANCE_MINI_GAME",t.OPPO_MINI_GAME="OPPO_MINI_GAME",t.VIVO_MINI_GAME="VIVO_MINI_GAME",t.HUAWEI_QUICK_GAME="HUAWEI_QUICK_GAME",t.MIGU_MINI_GAME="MIGU_MINI_GAME",t.HONOR_MINI_GAME="HONOR_MINI_GAME"}(Wo||(Wo={})),function(t){t.WEBP="WEBP",t.IMAGE_BITMAP="IMAGE_BITMAP",t.WEB_VIEW="WEB_VIEW",t.VIDEO_PLAYER="VIDEO_PLAYER",t.SAFE_AREA="SAFE_AREA",t.HPE="HPE",t.INPUT_TOUCH="INPUT_TOUCH",t.EVENT_KEYBOARD="EVENT_KEYBOARD",t.EVENT_MOUSE="EVENT_MOUSE",t.EVENT_TOUCH="EVENT_TOUCH",t.EVENT_ACCELEROMETER="EVENT_ACCELEROMETER",t.EVENT_GAMEPAD="EVENT_GAMEPAD",t.EVENT_HANDLE="EVENT_HANDLE",t.EVENT_HMD="EVENT_HMD",t.EVENT_HANDHELD="EVENT_HANDHELD",t.WASM="WASM"}(Xo||(Xo={}));const Yo={0:Ho.NONE,1:Ho.LAN,2:Ho.WWAN},qo={0:Wo.WIN32,2:Wo.MACOS,3:Wo.ANDROID,4:Wo.IOS,5:Wo.IOS,6:Wo.OHOS,7:Wo.OPENHARMONY},$o=new class extends zo{get networkType(){return Yo[jsb.device.getNetworkType()]}constructor(){super(),this._initPromise=[],this.isNative=!0,this.isBrowser=!1,this.platform=qo[__getPlatform()],this.isMobile=this.platform===Wo.ANDROID||this.platform===Wo.IOS||this.platform===Wo.OHOS||this.platform===Wo.OPENHARMONY,this.isLittleEndian=(()=>{const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]})();const t=__getCurrentLanguageCode();this.nativeLanguage=t?t.toLowerCase():jo.UNKNOWN,this.language=__getCurrentLanguage(),this.os=__getOS(),this.osVersion=__getOSVersion(),this.osMainVersion=parseInt(this.osVersion),this.browserType=Vo.UNKNOWN,this.browserVersion="",this.isXR="undefined"!=typeof xr&&void 0!==xr.XrEntry;const e="function"==typeof __supportHPE&&__supportHPE(),i=this.platform===Wo.OPENHARMONY;this._featureMap={[Xo.WEBP]:!0,[Xo.IMAGE_BITMAP]:!1,[Xo.WEB_VIEW]:this.isMobile,[Xo.VIDEO_PLAYER]:this.isMobile,[Xo.SAFE_AREA]:this.isMobile,[Xo.HPE]:e,[Xo.INPUT_TOUCH]:this.isMobile,[Xo.EVENT_KEYBOARD]:!0,[Xo.EVENT_MOUSE]:e||!this.isMobile||i,[Xo.EVENT_TOUCH]:!0,[Xo.EVENT_ACCELEROMETER]:this.isMobile,[Xo.EVENT_GAMEPAD]:!0,[Xo.EVENT_HANDLE]:this.isXR,[Xo.EVENT_HMD]:this.isXR,[Xo.EVENT_HANDHELD]:"undefined"!=typeof xr&&void 0!==xr.ARModule,[Xo.WASM]:!0},this._registerEvent()}_registerEvent(){jsb.onPause=()=>{this.emit("hide")},jsb.onResume=()=>{this.emit("show")},jsb.onClose=()=>{this.emit("close")}}_setFeature(t,e){return this._featureMap[t]=e}init(){return Promise.all(this._initPromise)}hasFeature(t){return this._featureMap[t]}getBatteryLevel(){return jsb.device.getBatteryLevel()}triggerGC(){jsb.garbageCollect()}openURL(t){jsb.openURL(t)}now(){return Date.now?Date.now():+new Date}restartJSVM(){__restartVM()}close(){__close()}exit(){__exit()}},Ko=/(\.[^./?\\]*)(\?.*)?$/,Zo=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,Qo=/[^./]+\/\.\.\//;function Jo(...t){let e="";return t.forEach((t=>{e=(e+(""===e?"":"/")+t).replace(/(\/|\\\\)$/,"")})),e}function ta(t){const e=Ko.exec(t);return e?e[1]:""}function ea(t){if(t){const e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t}function ia(t,e){const i=t.indexOf("?");i>0&&(t=t.substring(0,i));const s=/(\/|\\)([^/\\]+)$/g.exec(t.replace(/(\/|\\)$/,""));if(!s)return t;const r=s[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?r.substring(0,r.length-e.length):r}function sa(t){const e=Zo.exec(t);return e?e[2]:""}function ra(t,e){e=e||"";let i=t.indexOf("?"),s="";return i>0&&(s=t.substring(i),t=t.substring(0,i)),i=t.lastIndexOf("."),i<0?t+e+s:t.substring(0,i)+e+s}function na(t,e,i){if(0===e.indexOf("."))return ra(t,e);let s=t.indexOf("?"),r="";const n=i?ta(t):"";return s>0&&(r=t.substring(s),t=t.substring(0,s)),s=t.lastIndexOf("/"),s=s<=0?0:s+1,t.substring(0,s)+e+n+r}function oa(t){let e=t=String(t);do{e=t,t=t.replace(Qo,"")}while(e.length!==t.length);return t}function aa(t){return t.replace(/[/\\]$/,"")}function ha(){return $o.os===Go.WINDOWS?"\\":"/"}t("path",Object.freeze({__proto__:null,_normalize:oa,basename:ia,changeBasename:na,changeExtname:ra,dirname:sa,extname:ta,getSeperator:ha,join:Jo,mainFileName:ea,stripSep:aa}));const la=new Ms;function ca(t,e,i,s){s||(s=new Ms),t.convertToUINode(e,i,s);const r=i.position;return s.add(r),s}function ua(t,e,i){return i||(i=new Ms),t.worldToScreen(e,i),i.x/=h.view.getScaleX(),i.y/=h.view.getScaleY(),i}const da=t("convertUtils",{WorldNode3DToLocalNodeUI:ca,WorldNode3DToWorldNodeUI:ua});h.pipelineUtils=da,Q(h.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction(...t){const e=t[0],i=t[3]||la;return e.convertToUINode(t[1],t[2],i),i.add(t[2].position),t[3]||i.clone()}}]);const _a={0:Te.PORTRAIT,"-90":Te.LANDSCAPE_LEFT,90:Te.LANDSCAPE_RIGHT,180:Te.PORTRAIT_UPSIDE_DOWN},pa=new class extends zo{get supportFullScreen(){return!1}get isFullScreen(){return!1}get devicePixelRatio(){return jsb.device.getDevicePixelRatio()||1}get windowSize(){const t=this.devicePixelRatio,e=jsb.window.innerWidth,i=jsb.window.innerHeight,s=Math.round(e),r=Math.round(i);return new Vr(s*t,r*t)}set windowSize(t){M("Setting window size is not supported yet.")}get resolution(){const t=this.windowSize,e=this.resolutionScale;return new Vr(t.width*e,t.height*e)}get resolutionScale(){return this._resolutionScale}set resolutionScale(t){var e;t!==this._resolutionScale&&(this._resolutionScale=t,null==(e=this._cbToUpdateFrameBuffer)||e.call(this))}get orientation(){return _a[jsb.device.getDeviceOrientation()]}set orientation(t){j(1221)}get safeAreaEdge(){const t=jsb.device.getSafeAreaEdge(),e=this.devicePixelRatio;return{top:t.x*e,bottom:t.z*e,left:t.y*e,right:t.w*e}}get isProportionalToFrame(){return this._isProportionalToFrame}set isProportionalToFrame(t){}constructor(){super(),this.isFrameRotated=!1,this.handleResizeEvent=!0,this._cbToUpdateFrameBuffer=void 0,this._resolutionScale=1,this._isProportionalToFrame=!1,this._registerEvent()}init(t,e){this._cbToUpdateFrameBuffer=e,this._cbToUpdateFrameBuffer()}requestFullScreen(){return Promise.reject(new Error("request fullscreen has not been supported yet on this platform."))}exitFullScreen(){return Promise.reject(new Error("exit fullscreen has not been supported yet on this platform."))}_registerEvent(){jsb.onResize=t=>{0!==t.width&&0!==t.height&&(window.resize(t.width/this.devicePixelRatio,t.height/this.devicePixelRatio),this.emit("window-resize",t.width,t.height,t.windowId))},jsb.onOrientationChanged=()=>{this.emit("orientation-change",this.orientation)}}},ma=t("screen",new class{init(){var t,e;const i=null===(t=Se.querySettings("screen","exactFitScreen"))||void 0===t||t,s=null!==(e=Se.querySettings("screen","orientation"))&&void 0!==e?e:"auto",r=3===Se.querySettings("rendering","renderMode");pa.init({exactFitScreen:i,configOrientation:s,isHeadlessMode:r},(()=>{var t;const e=h.director;null!=(t=e.root)&&t.pipeline?e.root.pipeline.shadingScale=pa.resolutionScale:j(1220)}))}get devicePixelRatio(){return pa.devicePixelRatio}get windowSize(){return pa.windowSize}set windowSize(t){pa.windowSize=t}get resolution(){return pa.resolution}get supportsFullScreen(){return pa.supportFullScreen}fullScreen(){return pa.isFullScreen}requestFullScreen(t,e,i){return arguments.length>0&&j(1400,"screen.requestFullScreen(element, onFullScreenChange?, onFullScreenError?)","screen.requestFullScreen(): Promise"),pa.requestFullScreen().then((()=>{null==e||e.call(document)})).catch((t=>{P(t),null==i||i.call(document)}))}exitFullScreen(){return pa.exitFullScreen()}autoFullScreen(t,e){var i;null==(i=this.requestFullScreen(t,e))||i.catch((t=>{M(t)}))}disableAutoFullScreen(t){}on(t,e,i){pa.on(t,e,i)}once(t,e,i){pa.once(t,e,i)}off(t,e,i){pa.off(t,e,i)}});h.screen=ma;const ga=t("sys",{Feature:Xo,hasFeature:t=>$o.hasFeature(t),NetworkType:Ho,Language:jo,OS:Go,Platform:Wo,BrowserType:Vo,isNative:$o.isNative,isBrowser:$o.isBrowser,isMobile:$o.isMobile,isLittleEndian:$o.isLittleEndian,platform:$o.platform,language:$o.language,languageCode:$o.nativeLanguage,os:$o.os,osVersion:$o.osVersion,osMainVersion:$o.osMainVersion,browserType:$o.browserType,browserVersion:$o.browserVersion,isXR:$o.isXR,windowPixelResolution:ma.windowSize,capabilities:{canvas:!0,opengl:!0,webp:$o.hasFeature(Xo.WEBP),imageBitmap:$o.hasFeature(Xo.IMAGE_BITMAP),touches:$o.hasFeature(Xo.INPUT_TOUCH),mouse:$o.hasFeature(Xo.EVENT_MOUSE),keyboard:$o.hasFeature(Xo.EVENT_KEYBOARD),accelerometer:$o.hasFeature(Xo.EVENT_ACCELEROMETER)},localStorage:{},getNetworkType:()=>$o.networkType,getBatteryLevel:()=>$o.getBatteryLevel(),garbageCollect(){$o.triggerGC()},isObjectValid:t=>null!=t,__isWebIOS14OrIPadOS14Env:!1,dump(){let t="";t+=`isMobile : ${this.isMobile}\r\n`,t+=`language : ${this.language}\r\n`,t+=`browserType : ${this.browserType}\r\n`,t+=`browserVersion : ${this.browserVersion}\r\n`,t+=`supports webp: ${ga.hasFeature(Xo.WEBP)}\r\n`,t+=`supports bitmap: ${ga.hasFeature(Xo.IMAGE_BITMAP)}\r\n`,t+=`supports touches: ${ga.hasFeature(Xo.INPUT_TOUCH)}\r\n`,t+=`supports mouse: ${ga.hasFeature(Xo.EVENT_MOUSE)}\r\n`,t+=`supports keyboard: ${ga.hasFeature(Xo.EVENT_KEYBOARD)}\r\n`,t+=`supports accelerometer: ${ga.hasFeature(Xo.EVENT_ACCELEROMETER)}\r\n`,t+=`os : ${this.os}\r\n`,t+=`osVersion : ${this.osVersion}\r\n`,t+=`platform : ${this.platform}\r\n`,t+=`Using ${h.game.renderType===h.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS"} renderer.\r\n`,I(t)},openURL(t){$o.openURL(t)},init(){return Promise.resolve().then((()=>$o.init())).then((()=>{try{let t=ga.localStorage=window.localStorage;t.setItem("storage",""),t.removeItem("storage"),t=null}catch(t){const e=function(){j(5200)};this.localStorage={getItem:e,setItem:e,clear:e,removeItem:e,key:e,length:0}}this.__isWebIOS14OrIPadOS14Env=(ga.os===Go.IOS||ga.os===Go.OSX)&&$o.isBrowser&&/(OS 14)|(Version\/14)/.test(window.navigator.userAgent)}))},now:()=>$o.now(),restartVM(){$o.restartJSVM()},getSafeAreaRect(t=!0){const e=h.view,i=pa.safeAreaEdge;t&&(pa.orientation===we.ORIENTATION_PORTRAIT?i.top<i.bottom?i.top=i.bottom:i.bottom=i.top:i.left<i.right?i.left=i.right:i.right=i.left);const s=pa.windowSize,r=new kr(i.left,i.bottom),n=new kr(s.width-i.right,s.height-i.top);e._convertToUISpace(r),e._convertToUISpace(n);const o=r.x,a=r.y,l=n.x-r.x,c=n.y-r.y;return new Wr(o,a,l,c)}});h.sys=ga,tt(h,"cc",[{name:"winSize",suggest:"please use view.getVisibleSize() instead."}]),tt(ga,"sys",[{name:"capabilities",suggest:"please use sys.hasFeature() method instead."}]),Q(ga,"sys",["UNKNOWN","ENGLISH","CHINESE","FRENCH","ITALIAN","GERMAN","SPANISH","DUTCH","RUSSIAN","KOREAN","JAPANESE","HUNGARIAN","PORTUGUESE","ARABIC","NORWEGIAN","POLISH","TURKISH","UKRAINIAN","ROMANIAN","BULGARIAN"].map((t=>({name:`LANGUAGE_${t}`,newName:t,target:ga.Language,targetName:"sys.Language"})))),Q(ga,"sys",["UNKNOWN","IOS","ANDROID","WINDOWS","LINUX","OSX"].map((t=>({name:`OS_${t}`,newName:t,target:ga.OS,targetName:"sys.OS"})))),Q(ga,"sys",["UNKNOWN","WECHAT","ANDROID","IE","EDGE","QQ","MOBILE_QQ","UC","UCBS","BAIDU_APP","BAIDU","MAXTHON","OPERA","OUPENG","MIUI","FIREFOX","SAFARI","CHROME","LIEBAO","QZONE","SOUGOU","HUAWEI"].map((t=>({name:`BROWSER_TYPE_${t}`,newName:t,target:ga.BrowserType,targetName:"sys.BrowserType"})))),Q(ga,"sys",[{name:"BROWSER_TYPE_360",newName:"BROWSER_360",target:ga.BrowserType,targetName:"sys.BrowserType"}]),Q(ga,"sys",["UNKNOWN","EDITOR_PAGE","EDITOR_CORE","MOBILE_BROWSER","DESKTOP_BROWSER","WIN32","MACOS","IOS","ANDROID","OHOS","WECHAT_GAME","XIAOMI_QUICK_GAME","ALIPAY_MINI_GAME","BYTEDANCE_MINI_GAME","OPPO_MINI_GAME","VIVO_MINI_GAME","HUAWEI_QUICK_GAME"].map((t=>({name:t,target:ga.Platform,targetName:"sys.Platform"})))),Q(ga,"sys",[{name:"IPHONE",newName:"IOS",target:ga.Platform,targetName:"sys.Platform"},{name:"IPAD",newName:"IOS",target:ga.Platform,targetName:"sys.Platform"}]),J(ga,"sys",["LINUX","BLACKBERRY","NACL","EMSCRIPTEN","TIZEN","WINRT","WP8","QQ_PLAY","FB_PLAYABLE_ADS"].map((t=>({name:t})))),Q(ga,"sys",[{name:"windowPixelResolution",target:ma,targetName:"screen",newName:"windowSize"}]),tt(ma,"screen",[{name:"autoFullScreen",suggest:"please use screen.requestFullScreen() instead."},{name:"disableAutoFullScreen"}]);const fa=t("visibleRect",{topLeft:h.v2(0,0),topRight:h.v2(0,0),top:h.v2(0,0),bottomLeft:h.v2(0,0),bottomRight:h.v2(0,0),bottom:h.v2(0,0),center:h.v2(0,0),left:h.v2(0,0),right:h.v2(0,0),width:0,height:0,init(t){const e=this.width=t.width,i=this.height=t.height,s=t.x,r=t.y,n=r+i,o=s+e;this.topLeft.x=s,this.topLeft.y=n,this.topRight.x=o,this.topRight.y=n,this.top.x=s+e/2,this.top.y=n,this.bottomLeft.x=s,this.bottomLeft.y=r,this.bottomRight.x=o,this.bottomRight.y=r,this.bottom.x=s+e/2,this.bottom.y=r,this.center.x=s+e/2,this.center.y=r+i/2,this.left.x=s,this.left.y=r+i/2,this.right.x=o,this.right.y=r+i/2}});h.visibleRect=fa;const ya=new Ms,ba=new Ms,va=new Ms,Sa=new Ms,Ta=new js,wa=Math.abs,xa=(t,e,i)=>{Ta.m00=wa(i.m00),Ta.m01=wa(i.m01),Ta.m02=wa(i.m02),Ta.m03=wa(i.m04),Ta.m04=wa(i.m05),Ta.m05=wa(i.m06),Ta.m06=wa(i.m08),Ta.m07=wa(i.m09),Ta.m08=wa(i.m10),Ms.transformMat3(t,e,Ta)};class Ca{static create(t,e,i,s,r,n){return new Ca(t,e,i,s,r,n)}static clone(t){return new Ca(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z)}static copy(t,e){return Ms.copy(t.center,e.center),Ms.copy(t.halfExtents,e.halfExtents),t}static fromPoints(t,e,i){return Ms.add(ya,i,e),Ms.subtract(ba,i,e),Ms.multiplyScalar(t.center,ya,.5),Ms.multiplyScalar(t.halfExtents,ba,.5),t}static set(t,e,i,s,r,n,o){return t.center.set(e,i,s),t.halfExtents.set(r,n,o),t}static merge(t,e,i){return Ms.subtract(ya,e.center,e.halfExtents),Ms.subtract(ba,i.center,i.halfExtents),Ms.add(va,e.center,e.halfExtents),Ms.add(Sa,i.center,i.halfExtents),Ms.max(Sa,va,Sa),Ms.min(va,ya,ba),Ca.fromPoints(t,va,Sa)}static toBoundingSphere(t,e){return t.center.set(e.center),t.radius=e.halfExtents.length(),t}static transform(t,e,i){return Ms.transformMat4(t.center,e.center,i),xa(t.halfExtents,e.halfExtents,i),t}get type(){return this._type}constructor(t=0,e=0,i=0,s=1,r=1,n=1){this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._type=8,this.center=new Ms(t,e,i),this.halfExtents=new Ms(s,r,n)}getBoundary(t,e){Ms.subtract(t,this.center,this.halfExtents),Ms.add(e,this.center,this.halfExtents)}transform(t,e,i,s,r){Ms.transformMat4(r.center,this.center,t),xa(r.halfExtents,this.halfExtents,t)}clone(){const t=this.center,e=this.halfExtents;return new Ca(t.x,t.y,t.z,e.x,e.y,e.z)}copy(t){return Ms.copy(this.center,t.center),Ms.copy(this.halfExtents,t.halfExtents),this}mergePoint(t){this.getBoundary(ya,ba),t.x<ya.x&&(ya.x=t.x),t.y<ya.y&&(ya.y=t.y),t.z<ya.z&&(ya.z=t.z),t.x>ba.x&&(ba.x=t.x),t.y>ba.y&&(ba.y=t.y),t.z>ba.z&&(ba.z=t.z),Ms.add(va,ya,ba),this.center.set(Ms.multiplyScalar(va,va,.5)),this.halfExtents.set(ba.x-va.x,ba.y-va.y,ba.z-va.z)}mergePoints(t){if(!(t.length<1))for(let e=0;e<t.length;e++)this.mergePoint(t[e])}mergeFrustum(t){this.mergePoints(t.vertices)}}class Aa{get type(){return this._type}constructor(t=.5,e=.5,i=1){this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=512,this.radius=t,this.halfHeight=e,this.axis=i,this.center=new Ms,this.rotation=new sr,this.ellipseCenter0=new Ms(0,e,0),this.ellipseCenter1=new Ms(0,-e,0),this.updateCache()}transform(t,e,i,s,r){const n=s,o=$i(n);r.radius=this.radius*Math.abs(o);let a=(this.halfHeight+this.radius)*Math.abs(n.y)-r.radius;a<0&&(a=0),r.halfHeight=a,Ms.transformMat4(r.center,this.center,t),sr.multiply(r.rotation,this.rotation,i),r.updateCache()}updateCache(){this.updateLocalCenter(),Ms.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),Ms.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)}updateLocalCenter(){const t=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(t,0,0),this.ellipseCenter1.set(-t,0,0);break;case 1:this.ellipseCenter0.set(0,t,0),this.ellipseCenter1.set(0,-t,0);break;case 2:this.ellipseCenter0.set(0,0,t),this.ellipseCenter1.set(0,0,-t)}}}const Da=new Array(8);Da[0]=Ps(1,1,1),Da[1]=Ps(-1,1,1),Da[2]=Ps(-1,-1,1),Da[3]=Ps(1,-1,1),Da[4]=Ps(1,1,-1),Da[5]=Ps(-1,1,-1),Da[6]=Ps(-1,-1,-1),Da[7]=Ps(1,-1,-1);const Ea=Ps(),Ia=Ps(),Ma=Ps(),Pa=go.fromPoints,Oa=Ms.set,Ra=Ms.transformMat4;class Ba{static createOrthographic(t,e,i,s,r,n){const o=e/2,a=i/2;Oa(Ma,o,a,-s),Ra(t.vertices[0],Ma,n),Oa(Ma,-o,a,-s),Ra(t.vertices[1],Ma,n),Oa(Ma,-o,-a,-s),Ra(t.vertices[2],Ma,n),Oa(Ma,o,-a,-s),Ra(t.vertices[3],Ma,n),Oa(Ma,o,a,-r),Ra(t.vertices[4],Ma,n),Oa(Ma,-o,a,-r),Ra(t.vertices[5],Ma,n),Oa(Ma,-o,-a,-r),Ra(t.vertices[6],Ma,n),Oa(Ma,o,-a,-r),Ra(t.vertices[7],Ma,n),t.updatePlanes()}static createOrtho(t,e,i,s,r,n){return Ba.createOrthographic(t,e,i,s,r,n)}static createPerspective(t,e,i,s,r,n){const o=Math.tan(.5*i),a=o*e;Ea.set(s*a,s*o,s),Ia.set(r*a,r*o,r);const h=t.vertices;Ma.set(Ea.x,Ea.y,-Ea.z),Ra(h[0],Ma,n),Ma.set(-Ea.x,Ea.y,-Ea.z),Ra(h[1],Ma,n),Ma.set(-Ea.x,-Ea.y,-Ea.z),Ra(h[2],Ma,n),Ma.set(Ea.x,-Ea.y,-Ea.z),Ra(h[3],Ma,n),Ma.set(Ia.x,Ia.y,-Ia.z),Ra(h[4],Ma,n),Ma.set(-Ia.x,Ia.y,-Ia.z),Ra(h[5],Ma,n),Ma.set(-Ia.x,-Ia.y,-Ia.z),Ra(h[6],Ma,n),Ma.set(Ia.x,-Ia.y,-Ia.z),Ra(h[7],Ma,n),t.updatePlanes()}static createFromAABB(t,e){const i=new Ms,s=new Ms;Ms.subtract(i,e.center,e.halfExtents),Ms.add(s,e.center,e.halfExtents);const r=t.vertices;return r[0].set(s.x,s.y,-i.z),r[1].set(i.x,s.y,-i.z),r[2].set(i.x,i.y,-i.z),r[3].set(s.x,i.y,-i.z),r[4].set(s.x,s.y,-s.z),r[5].set(i.x,s.y,-s.z),r[6].set(i.x,i.y,-s.z),r[7].set(s.x,i.y,-s.z),t.updatePlanes(),t}split(t,e,i,s,r){return Ba.createPerspective(this,i,s,t,e,r)}static create(){return new Ba}static clone(t){return Ba.copy(new Ba,t)}static copy(t,e){t._type=e.type;for(let i=0;i<6;++i)go.copy(t.planes[i],e.planes[i]);for(let i=0;i<8;++i)Ms.copy(t.vertices[i],e.vertices[i]);return t}set accurate(t){this._type=t?256:128}get type(){return this._type}constructor(){this.planes=void 0,this.vertices=void 0,this._type=void 0,this._type=128,this.planes=new Array(6);for(let t=0;t<6;++t)this.planes[t]=go.create(0,0,0,0);this.vertices=new Array(8);for(let t=0;t<8;++t)this.vertices[t]=new Ms}update(t,e){const i=this.planes;Oa(i[0].n,t.m03+t.m00,t.m07+t.m04,t.m11+t.m08),i[0].d=-(t.m15+t.m12),Oa(i[1].n,t.m03-t.m00,t.m07-t.m04,t.m11-t.m08),i[1].d=-(t.m15-t.m12),Oa(i[2].n,t.m03+t.m01,t.m07+t.m05,t.m11+t.m09),i[2].d=-(t.m15+t.m13),Oa(i[3].n,t.m03-t.m01,t.m07-t.m05,t.m11-t.m09),i[3].d=-(t.m15-t.m13),Oa(i[4].n,t.m03+t.m02,t.m07+t.m06,t.m11+t.m10),i[4].d=-(t.m15+t.m14),Oa(i[5].n,t.m03-t.m02,t.m07-t.m06,t.m11-t.m10),i[5].d=-(t.m15-t.m14);for(let t=0;t<6;t++){const e=i[t],s=1/e.n.length();Ms.multiplyScalar(e.n,e.n,s),e.d*=s}for(let t=0;t<8;t++)Ra(this.vertices[t],Da[t],e)}transform(t){for(let e=0;e<8;e++)Ra(this.vertices[e],this.vertices[e],t);this.updatePlanes()}zero(){for(let t=0;t<8;t++)this.vertices[t].set(0,0,0);for(let t=0;t<6;t++)go.set(this.planes[t],0,0,0,0)}updatePlanes(){const t=this.planes,e=this.vertices;Pa(t[0],e[1],e[6],e[5]),Pa(t[1],e[3],e[4],e[7]),Pa(t[2],e[6],e[3],e[7]),Pa(t[3],e[0],e[5],e[4]),Pa(t[4],e[2],e[0],e[3]),Pa(t[5],e[7],e[5],e[6])}}function Fa(t,e){const i=Object.getOwnPropertyDescriptor(t.prototype,e),s=`_$cache_${e}`,r=`_$_${e}`;Object.defineProperty(t.prototype,r,i),Object.defineProperty(t.prototype,e,{get(){return void 0===this[s]&&(this[s]=this[r]),this[s]},set(t){this[r]=t},configurable:!0,enumerable:!0})}function Na(t){t.prototype._arraybuffer=function(){return this.__data||(this.__data=this.underlyingData()),this.__data}}const La=(t,e)=>{const i=t.__nativeFields__[e],s=`_$_${e}`;O(4===i.fieldSize,`field ${e} size ${i.fieldSize}`),Object.defineProperty(t.prototype,i.fieldName,{configurable:!0,enumerable:!0,get(){return void 0===this[s]&&(this[s]=new Float32Array(this._arraybuffer(),i.fieldOffset,1)),this[s][0]},set(t){void 0===this[s]&&(this[s]=new Float32Array(this._arraybuffer(),i.fieldOffset,1)),this[s][0]=t}})},ka=(t,e)=>{const i=t.__nativeFields__[e];i||console.error(`attr ${e} not defined in class ${t.toString()}`);const s=`_$_${e}`;O(4===i.fieldSize,`field ${e} size ${i.fieldSize}`),Object.defineProperty(t.prototype,i.fieldName,{configurable:!0,enumerable:!0,get(){return void 0===this[s]&&(this[s]=new Int32Array(this._arraybuffer(),i.fieldOffset,1)),this[s][0]},set(t){void 0===this[s]&&(this[s]=new Int32Array(this._arraybuffer(),i.fieldOffset,1)),this[s][0]=t}})};{Fa(ns.Line,"s"),Fa(ns.Line,"e"),Object.setPrototypeOf(ns.Line.prototype,ln.prototype),Na(ns.Plane),Fa(ns.Plane,"n"),La(ns.Plane,"d"),Object.setPrototypeOf(ns.Plane.prototype,go.prototype),Na(ns.Ray),Fa(ns.Ray,"o"),Fa(ns.Ray,"d"),Object.setPrototypeOf(ns.Ray.prototype,cn.prototype),Na(ns.Triangle),Fa(ns.Triangle,"a"),Fa(ns.Triangle,"b"),Fa(ns.Triangle,"c"),Object.setPrototypeOf(ns.Triangle.prototype,fo.prototype),Na(ns.Sphere),Fa(ns.Sphere,"_center"),La(ns.Sphere,"_radius"),Object.setPrototypeOf(ns.Sphere.prototype,gn.prototype),Na(ns.AABB),Fa(ns.AABB,"center"),Fa(ns.AABB,"halfExtents"),Object.setPrototypeOf(ns.AABB.prototype,Ca.prototype),Na(ns.Capsule),La(ns.Capsule,"radius"),La(ns.Capsule,"halfHeight"),ka(ns.Capsule,"axis"),Fa(ns.Capsule,"center"),Fa(ns.Capsule,"rotation"),Fa(ns.Capsule,"ellipseCenter0"),Fa(ns.Capsule,"ellipseCenter1"),Object.setPrototypeOf(ns.Capsule.prototype,Aa.prototype),Fa(ns.Frustum,"vertices"),Fa(ns.Frustum,"planes"),Object.setPrototypeOf(ns.Frustum.prototype,Ba.prototype);const t=Object.getOwnPropertyDescriptor(ns.ShapeBase.prototype,"_type");for(const e of[ns.Line,ns.Plane,ns.Ray,ns.Triangle,ns.Sphere,ns.AABB,ns.Capsule,ns.Frustum])Object.defineProperty(e.prototype,"_type",t)}const za=new Ms,Ua=new Ms,Va=new js,ja=Math.abs;class Ha{static create(t,e,i,s,r,n,o,a,h,l,c,u,d,_,p){return new Ha(t,e,i,s,r,n,o,a,h,l,c,u,d,_,p)}static clone(t){return new Ha(t.center.x,t.center.y,t.center.z,t.halfExtents.x,t.halfExtents.y,t.halfExtents.z,t.orientation.m00,t.orientation.m01,t.orientation.m02,t.orientation.m03,t.orientation.m04,t.orientation.m05,t.orientation.m06,t.orientation.m07,t.orientation.m08)}static copy(t,e){return Ms.copy(t.center,e.center),Ms.copy(t.halfExtents,e.halfExtents),js.copy(t.orientation,e.orientation),t}static fromPoints(t,e,i){return Ms.multiplyScalar(t.center,Ms.add(za,e,i),.5),Ms.multiplyScalar(t.halfExtents,Ms.subtract(Ua,i,e),.5),js.identity(t.orientation),t}static set(t,e,i,s,r,n,o,a,h,l,c,u,d,_,p,m){return Ms.set(t.center,e,i,s),Ms.set(t.halfExtents,r,n,o),js.set(t.orientation,a,h,l,c,u,d,_,p,m),t}get type(){return this._type}constructor(t=0,e=0,i=0,s=1,r=1,n=1,o=1,a=0,h=0,l=0,c=1,u=0,d=0,_=0,p=1){this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=16,this.center=new Ms(t,e,i),this.halfExtents=new Ms(s,r,n),this.orientation=new js(o,a,h,l,c,u,d,_,p)}getBoundary(t,e){var i,s,r;i=za,s=this.halfExtents,r=this.orientation,Va.m00=ja(r.m00),Va.m01=ja(r.m01),Va.m02=ja(r.m02),Va.m03=ja(r.m03),Va.m04=ja(r.m04),Va.m05=ja(r.m05),Va.m06=ja(r.m06),Va.m07=ja(r.m07),Va.m08=ja(r.m08),Ms.transformMat3(i,s,Va),Ms.subtract(t,this.center,za),Ms.add(e,this.center,za)}transform(t,e,i,s,r){Ms.transformMat4(r.center,this.center,t),js.fromQuat(r.orientation,i),Ms.multiply(r.halfExtents,this.halfExtents,s)}translateAndRotate(t,e,i){Ms.transformMat4(i.center,this.center,t),js.fromQuat(i.orientation,e)}setScale(t,e){Ms.multiply(e.halfExtents,this.halfExtents,t)}}function Ga(t,e,i=1e-6){let s=0,r=t.length-1,n=r>>>1;for(;s<=r;n=s+r>>>1){const o=t[n];if(o>e+i)r=n-1;else{if(!(o<e-i))return n;s=n+1}}return~s}let Wa;Wa=Symbol.iterator;class Xa{constructor(){this._times=[],this._values=[]}get keyFramesCount(){return this._times.length}get rangeMin(){return this._times[0]}get rangeMax(){return this._times[this._values.length-1]}[Wa](){let t=0;return{next:()=>{if(t>=this._times.length)return{done:!0,value:void 0};{const e=[this._times[t],this._values[t]];return++t,{done:!1,value:e}}}}}keyframes(){return this}times(){return this._times}values(){return this._values}getKeyframeTime(t){return this._times[t]}getKeyframeValue(t){return this._values[t]}addKeyFrame(t,e){return this._insertNewKeyframe(t,e)}removeKeyframe(t){this._times.splice(t,1),this._values.splice(t,1)}indexOfKeyframe(t){return Ga(this._times,t)}updateTime(t,e){const i=this._values[t];this.removeKeyframe(t),this._insertNewKeyframe(e,i)}assignSorted(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.slice());else{const e=Array.from(t);this.setKeyframes(e.map((([t])=>t)),e.map((([,t])=>t)))}}clear(){this._times.length=0,this._values.length=0}searchKeyframe(t){return Ga(this._times,t)}setKeyframes(t,e){t.length,e.length,Ya(t),this._times=t,this._values=e}_insertNewKeyframe(t,e){const i=this._times,s=this._values,r=i.length,n=Ga(i,t);if(n>=0)return n;const o=~n;return 0===o?(i.unshift(t),s.unshift(e)):o===r?(i.push(t),s.push(e)):(i.splice(o-1,0,t),s.splice(o-1,0,e)),o}}function Ya(t){return t.every(((t,e,i)=>0===e||t>i[e-1]||Oi(t,i[e-1],1e-6)))}function qa(t,e,i,s,r){const n=i/s,o=e/s,a=n*n,h=1/3*(-1/3*a+o),l=.5*(2/27*n*a-1/3*n*o+t/s),c=h*h*h,u=l*l+c;let d=0;if(Ka(u)){if(Ka(l))return r[0]=0,1;{const t=Math.cbrt(-l);return r[0]=2*t,r[1]=-t,2}}if(u<0){const t=1/3*Math.acos(-l/Math.sqrt(-c)),e=2*Math.sqrt(-h);r[0]=e*Math.cos(t),r[1]=-e*Math.cos(t+Math.PI/3),r[2]=-e*Math.cos(t-Math.PI/3),d=3}else{const t=Math.sqrt(u),e=Math.cbrt(t-l),i=-Math.cbrt(t+l);r[0]=e+i,d=1}const _=1/3*n;for(let t=0;t<d;++t)r[t]-=_;return d}yi.fastDefine("cc.KeyframeCurve",Xa,{_times:[],_values:[]}),t("RealInterpolationMode",{LINEAR:0,CONSTANT:1,CUBIC:2}),t("ExtrapolationMode",{LINEAR:0,CLAMP:1,LOOP:2,PING_PONG:3}),t("TangentWeightMode",{NONE:0,LEFT:1,RIGHT:2,BOTH:3});const $a=1e-9;function Ka(t){return t>-1e-9&&t<$a}function Za(t,e,i,s){return i.slice().reverse().reduce((function(i,s){return s(t,e,i)||i}),s)}const Qa=()=>{},Ja=()=>Qa,th=eh((()=>{}));function eh(t){return function(e){return"function"==typeof e?t(e):function(i){return t(i,e)}}}function ih(t,e,i){const s=nh(t);if(s){const t=oh(s,"proto");oh(t,"editor")[e]=i}}function sh(t){return e=>i=>{ih(i,t,e)}}const rh="__ccclassCache__";function nh(t){return oh(t,rh)}function oh(t,e){return t[e]||(t[e]={})}const ah=eh(((t,e)=>{let i=Lt(t);i===Object&&(i=null);const s={name:e,extends:i,ctor:t},r=t[rh];if(r){const e=r.proto;e&&Ft(s,e),t[rh]=void 0}return yi(s)})),hh=sh("requireComponent"),lh=sh("executionOrder"),ch=th;function uh(t,e,i){let s=null;function r(t,e,i){fh(ph(t),mh(t,e),t.constructor,e,s,i)}return void 0===t?uh({type:void 0}):void 0===e?(s=t,r):void r(t,e,i)}function dh(t){let e;try{e=t()}catch(e){return t}return"object"!=typeof e||null===e?e:t}function _h(t){let e;try{e=new t}catch(t){return{}}return e}function ph(t){return nh(t.constructor)}function mh(t,e){var i,s;const r=oh(nh(t.constructor),"proto"),n=oh(r,"properties");return null!==(s=n[i=e])&&void 0!==s?s:n[i]={}}function gh(t,e,i){var s,r;const n=nh(t.constructor),o=oh(n,"proto"),a=oh(o,"properties"),h=null!==(r=a[s=e])&&void 0!==r?r:a[s]={};return h.__internalFlags|=1,i&&"function"!=typeof i&&(i.get||i.set)?(i.get&&(h.get=i.get),i.set&&(h.set=i.set)):yh(n,h,t.constructor,e,i),h}function fh(t,e,i,s,r,n){let o;const a=n&&"function"!=typeof n&&(n.get||n.set);r&&(o=ti(r,a));const h=Ft(e,o||r||{});a?(n.get&&(h.get=n.get),n.set&&(h.set=n.set)):yh(t,h,i,s,n)}function yh(t,e,i,s,r){if(void 0!==r)"function"==typeof r?e.default=dh(r):null===r||r.initializer&&(e.default=dh(r.initializer));else{const r=t.default||(t.default=_h(i));r.hasOwnProperty(s)&&(e.default=r[s])}}const bh=Symbol("cc:SerializationMetadata"),vh=t("serializable",((t,e,i)=>{wh(gh(t,e,i))}));function Sh(t){return(e,i,s)=>{const r=gh(e,i,s);r.formerlySerializedAs=t,wh(r)}}const Th=(t,e,i)=>{const s=gh(t,e,i);s.editorOnly=!0,wh(s)};function wh(t){t.__internalFlags|=4}const xh=Qa,Ch=th,Ah=Ja,Dh=th,Eh=Ja,Ih=Ja,Mh=Ja,Ph=t("editable",Qa),Oh=t("visible",Ja),Rh=Qa,Bh=t("displayName",Ja),Fh=t("tooltip",Ja),Nh=t("range",Ja),Lh=Ja,kh=t("rangeStep",Ja),zh=t("slide",Qa),Uh=t("displayOrder",Ja),Vh=t("disallowAnimation",Qa),jh=Xh(Ge),Hh=Xh(We),Gh=Xh(Xe),Wh=Xh(Ye);function Xh(t){return uh({type:t})}const Yh=t("override",((t,e,i)=>{gh(t,e,i).override=!0}));const qh=t("EditorExtendable",class{});var $h,Kh,Zh,Qh,Jh,tl,el,il=Object.freeze({__proto__:null,boolean:Gh,ccclass:ah,disallowAnimation:Vh,disallowMultiple:ch,displayName:Bh,displayOrder:Uh,editable:Ph,executeInEditMode:Ch,executionOrder:lh,float:Hh,formerlySerializedAs:Sh,help:Mh,icon:Ih,inspector:Eh,integer:jh,menu:Ah,override:Yh,playOnFocus:Dh,property:uh,range:Nh,rangeStep:kh,requireComponent:hh,serializable:vh,slide:zh,string:Wh,tooltip:Fh,type:Xh,uniquelyReferenced:xh,visible:Oh});function sl(t,e){return(e<<3)+t}function rl(t){return ol[t]}function nl(t){switch(t){case 0:return Uint8Array;case 1:return Uint16Array;case 2:return Uint32Array;case 3:return Int8Array;case 4:return Int16Array;case 5:return Int32Array;case 6:return Float32Array;case 7:return Float64Array}}t("_decorator",il),t("CompactValueTypeArray",ah("cc.CompactValueTypeArray")((el=class t{constructor(){this._byteOffset=Zh&&Zh(),this._unitCount=Qh&&Qh(),this._unitElement=Jh&&Jh(),this._length=tl&&tl()}static lengthFor(t,e,i){return rl(e).requiredUnits*t.length*nl(i).BYTES_PER_ELEMENT}static compress(e,i,s,r,n,o){const a=rl(i),h=nl(s),l=a.requiredUnits*e.length,c=new h(r,n,l);for(let t=0;t<e.length;++t)a.compress(c,t,e[t]);const u=new t;return u._unitElement=sl(s,i),u._byteOffset=o,u._unitCount=l,u._length=e.length,u}decompress(t){const{storageUnit:e,elementType:i}={storageUnit:7&(s=this._unitElement),elementType:s>>3};var s;const r=rl(i),n=new(nl(e))(t,this._byteOffset,this._unitCount),o=new Array(this._length);for(let t=0;t<this._length;++t)o[t]=r.decompress(n,t);return o}},el.StorageUnit={Uint8:0,Uint16:1,Uint32:2,Int8:3,Int16:4,Int32:5,Float32:6,Float64:7},el.ElementType={Scalar:0,Vec2:1,Vec3:2,Vec4:3,Quat:4,Mat4:5},Zh=Za((Kh=el).prototype,"_byteOffset",[vh],(function(){return 0})),Qh=Za(Kh.prototype,"_unitCount",[vh],(function(){return 0})),Jh=Za(Kh.prototype,"_unitElement",[vh],(function(){return sl(0,0)})),tl=Za(Kh.prototype,"_length",[vh],(function(){return 0})),$h=Kh))||$h);const ol={0:{requiredUnits:1,compress(t,e,i){t[e]=i},decompress:(t,e)=>t[e]},1:{requiredUnits:2,compress(t,e,i){t[2*e]=i.x,t[2*e+1]=i.y},decompress:(t,e)=>new Ms(t[2*e],t[2*e+1])},2:{requiredUnits:3,compress(t,e,i){t[3*e]=i.x,t[3*e+1]=i.y,t[3*e+2]=i.z},decompress:(t,e)=>new Ms(t[3*e],t[3*e+1],t[3*e+2])},3:{requiredUnits:4,compress(t,e,i){t[4*e]=i.x,t[4*e+1]=i.y,t[4*e+2]=i.z,t[4*e+3]=i.w},decompress:(t,e)=>new ms(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])},4:{requiredUnits:4,compress(t,e,i){t[4*e]=i.x,t[4*e+1]=i.y,t[4*e+2]=i.z,t[4*e+3]=i.w},decompress:(t,e)=>new sr(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])},5:{requiredUnits:16,compress(t,e,i){vr.toArray(t,i,16*e)},decompress:(t,e)=>vr.fromArray(new vr,t,16*e)}},al=t("serializeTag",Symbol("[[Serialize]]")),hl=t("deserializeTag",Symbol("[[Deserialize]]"));function ll(){return 0}function cl(t){return t}function ul(t){return t*t}function dl(t){return t*(2-t)}function _l(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function pl(t){return t*t*t}function ml(t){return--t*t*t+1}function gl(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}function fl(t){return t*t*t*t}function yl(t){return 1- --t*t*t*t}function bl(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}function vl(t){return t*t*t*t*t}function Sl(t){return--t*t*t*t*t+1}function Tl(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}function wl(t){return 1===t?1:1-Math.cos(t*Math.PI/2)}function xl(t){return Math.sin(t*Math.PI/2)}function Cl(t){return.5*(1-Math.cos(Math.PI*t))}function Al(t){return 0===t?0:1024**(t-1)}function Dl(t){return 1===t?1:1-2**(-10*t)}function El(t){return 0===t?0:1===t?1:(t*=2)<1?.5*1024**(t-1):.5*(2-2**(-10*(t-1)))}function Il(t){return 1-Math.sqrt(1-t*t)}function Ml(t){return Math.sqrt(1- --t*t)}function Pl(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function Ol(t){let e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*2**(10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4))}function Rl(t){let e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*2**(-10*t)*Math.sin(2*(t-e)*Math.PI/.4)+1)}function Bl(t){let e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*2**(10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*-.5:i*2**(-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*.5+1)}function Fl(t){if(1===t)return 1;const e=1.70158;return t*t*((e+1)*t-e)}function Nl(t){if(0===t)return 0;const e=1.70158;return--t*t*((e+1)*t+e)+1}function Ll(t){const e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}function kl(t){return 1-zl(1-t)}function zl(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Ul(t){return t<.5?.5*kl(2*t):.5*zl(2*t-1)+.5}function Vl(t){return t<=0?0:t>=1?1:t*t*(3-2*t)}function jl(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}h._decorator=il;const Hl=Jl(ul,dl),Gl=Jl(pl,ml),Wl=Jl(fl,yl),Xl=Jl(vl,Sl),Yl=Jl(wl,xl),ql=Jl(Al,Dl),$l=Jl(Il,Ml),Kl=Jl(Ol,Rl),Zl=Jl(Fl,Nl),Ql=Jl(kl,zl);function Jl(t,e){return i=>i<.5?e(2*i)/2:t(2*i-1)/2+.5}var tc=Object.freeze({__proto__:null,backIn:Fl,backInOut:Ll,backOut:Nl,backOutIn:Zl,bounceIn:kl,bounceInOut:Ul,bounceOut:zl,bounceOutIn:Ql,circIn:Il,circInOut:Pl,circOut:Ml,circOutIn:$l,constant:ll,cubicIn:pl,cubicInOut:gl,cubicOut:ml,cubicOutIn:Gl,elasticIn:Ol,elasticInOut:Bl,elasticOut:Rl,elasticOutIn:Kl,expoIn:Al,expoInOut:El,expoOut:Dl,expoOutIn:ql,fade:jl,linear:cl,quadIn:ul,quadInOut:_l,quadOut:dl,quadOutIn:Hl,quartIn:fl,quartInOut:bl,quartOut:yl,quartOutIn:Wl,quintIn:vl,quintInOut:Tl,quintOut:Sl,quintOutIn:Xl,sineIn:wl,sineInOut:Cl,sineOut:xl,sineOutIn:Yl,smooth:Vl});t("easing",tc),t("EasingMethod",{LINEAR:0,CONSTANT:1,QUAD_IN:2,QUAD_OUT:3,QUAD_IN_OUT:4,QUAD_OUT_IN:5,CUBIC_IN:6,CUBIC_OUT:7,CUBIC_IN_OUT:8,CUBIC_OUT_IN:9,QUART_IN:10,QUART_OUT:11,QUART_IN_OUT:12,QUART_OUT_IN:13,QUINT_IN:14,QUINT_OUT:15,QUINT_IN_OUT:16,QUINT_OUT_IN:17,SINE_IN:18,SINE_OUT:19,SINE_IN_OUT:20,SINE_OUT_IN:21,EXPO_IN:22,EXPO_OUT:23,EXPO_IN_OUT:24,EXPO_OUT_IN:25,CIRC_IN:26,CIRC_OUT:27,CIRC_IN_OUT:28,CIRC_OUT_IN:29,ELASTIC_IN:30,ELASTIC_OUT:31,ELASTIC_IN_OUT:32,ELASTIC_OUT_IN:33,BACK_IN:34,BACK_OUT:35,BACK_IN_OUT:36,BACK_OUT_IN:37,BOUNCE_IN:38,BOUNCE_OUT:39,BOUNCE_IN_OUT:40,BOUNCE_OUT_IN:41,SMOOTH:42,FADE:43});const ec={1:ll,0:cl,2:ul,3:dl,4:_l,5:Hl,6:pl,7:ml,8:gl,9:Gl,10:fl,11:yl,12:bl,13:Wl,14:vl,15:Sl,16:Tl,17:Xl,18:wl,19:xl,20:Cl,21:Yl,22:Al,23:Dl,24:El,25:ql,26:Il,27:Ml,28:Pl,29:$l,30:Ol,31:Rl,32:Bl,33:Kl,34:Fl,35:Nl,36:Ll,37:Zl,38:kl,39:zl,40:Ul,41:Ql,42:Vl,43:jl};function ic(t){return ec[t]}m(255),m(65280);class sc extends qh{constructor(){super(),this.value=0,this.rightTangent=0,this.rightTangentWeight=0,this.leftTangent=0,this.leftTangentWeight=0,this._flags=0}get interpolationMode(){return 255&this._flags}set interpolationMode(t){this._flags&=-256,this._flags|=0|t}get tangentWeightMode(){return(65280&this._flags)>>8}set tangentWeightMode(t){this._flags&=-65281,this._flags|=t<<8}get easingMethod(){return(16711680&this._flags)>>16}set easingMethod(t){this._flags&=-16711681,this._flags|=t<<16}}var rc,nc,oc;function ac(t){const e=new sc;if("number"==typeof t)e.value=t;else{const{interpolationMode:i,tangentWeightMode:s,value:r,rightTangent:n,rightTangentWeight:o,leftTangent:a,leftTangentWeight:h,easingMethod:l,[wo]:c}=t;e.value=null!=r?r:e.value,e.rightTangent=null!=n?n:e.rightTangent,e.rightTangentWeight=null!=o?o:e.rightTangentWeight,e.leftTangent=null!=a?a:e.leftTangent,e.leftTangentWeight=null!=h?h:e.leftTangentWeight,e.interpolationMode=null!=i?i:e.interpolationMode,e.tangentWeightMode=null!=s?s:e.tangentWeightMode,e.easingMethod=null!=l?l:e.easingMethod,c&&(e[wo]=c)}return e}yi.fastDefine("cc.RealKeyframeValue",sc,{interpolationMode:0,tangentWeightMode:0,value:0,rightTangent:0,rightTangentWeight:0,leftTangent:0,leftTangentWeight:0,easingMethod:0,[wo]:void 0}),yi.Attr.setClassAttr(sc,wo,"editorOnly",!0),(rc=sc,null!==(oc=(nc=rc)[bh])&&void 0!==oc?oc:nc[bh]={}).uniquelyReferenced=!0;class hc extends Xa{constructor(){super(),this.preExtrapolation=1,this.postExtrapolation=1}evaluate(t){const{_times:e,_values:i}=this,s=e.length;if(0===s)return 0;const r=e[0],n=e[s-1];if(t<r){const{preExtrapolation:o}=this,a=i[0];if(1===o||s<2)return a.value;switch(o){case 0:return Rc(r,i[0].value,e[1],i[1].value,t);case 2:t=Pc(t,r,n);break;case 3:t=Oc(t,r,n);break;default:return a.value}}else if(t>n){const{postExtrapolation:o}=this,a=i[s-1];if(1===o||s<2)return a.value;switch(o){case 0:return Rc(n,a.value,e[s-2],i[s-2].value,t);case 2:t=Pc(t,r,n);break;case 3:t=Oc(t,r,n);break;default:return a.value}}const o=Ga(e,t);if(o>=0)return i[o].value;const a=~o,h=a-1,l=e[h],c=i[h],u=e[a];return Bc(l,c,u,i[a],(t-l)/(u-l))}addKeyFrame(t,e){return super.addKeyFrame(t,ac(e))}assignSorted(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.map((t=>ac(t))));else{const e=Array.from(t);this.setKeyframes(e.map((([t])=>t)),e.map((([,t])=>ac(t))))}}isConstant(t){if(this._values.length<=1)return!0;const e=this._values[0].value;return this._values.every((i=>Oi(i.value,e,t)))}[al](t,e){if(!e.toCCON)return void t.writeThis();const{_times:i,_values:s}=this,r=i.length,n=new DataView(new ArrayBuffer(0+uc+uc+dc+_c*r+Ec*r));let o=0;n.setUint8(o,this.preExtrapolation),o+=uc,n.setUint8(o,this.postExtrapolation),o+=uc,n.setUint32(o,r,!0),o+=dc,i.forEach(((t,e)=>n.setFloat32(o+_c*e,t,!0))),o+=_c*r;for(const t of s)o=Ic(n,t,o);const a=new Uint8Array(n.buffer,0,o);t.writeProperty("bytes",a);const h=s.map((t=>t[wo]));h.some((t=>void 0!==t))&&t.writeProperty("keyframeValueEditorExtras",h)}[hl](t,e){if(!e.fromCCON)return void t.readThis();const i=t.readProperty("bytes"),s=new DataView(i.buffer,i.byteOffset,i.byteLength);let r=0;this.preExtrapolation=s.getUint8(r),r+=uc,this.postExtrapolation=s.getUint8(r),r+=uc;const n=s.getUint32(r,!0);r+=dc;const o=Array.from({length:n},((t,e)=>s.getFloat32(r+_c*e,!0)));r+=_c*n;const a=new Array(n);for(let t=0;t<n;++t){const e=ac({});r=Mc(s,e,r),a[t]=e}i.byteLength;const h=t.readProperty("keyframeValueEditorExtras");h&&(h.length,h.forEach(((t,e)=>a[e][wo]=t))),this._times=o,this._values=a}}t("RealCurve",hc),yi.fastDefine("cc.RealCurve",hc,{_times:[],_values:[],preExtrapolation:1,postExtrapolation:1});const lc=8,cc=255<<lc,uc=1,dc=4,_c=4,pc=4,mc=4,gc=1,fc=1,yc=4,bc=4,vc=4,Sc=4,{interpolationMode:Tc,tangentWeightMode:wc,leftTangent:xc,leftTangentWeight:Cc,rightTangent:Ac,rightTangentWeight:Dc}=ac({}),Ec=pc+mc+gc+fc+yc+bc+vc+Sc+0;function Ic(t,e,i){let s=0,r=i;const n=r;r+=pc;const{value:o,interpolationMode:a,tangentWeightMode:h,rightTangent:l,rightTangentWeight:c,leftTangent:u,leftTangentWeight:d,easingMethod:_}=e;return t.setFloat32(r,o,!0),r+=mc,a!==Tc&&(s|=2,t.setUint8(r,a),r+=gc),h!==wc&&(s|=4,t.setUint8(r,h),r+=fc),u!==xc&&(s|=8,t.setFloat32(r,u,!0),r+=yc),d!==Cc&&(s|=16,t.setFloat32(r,d,!0),r+=bc),l!==Ac&&(s|=32,t.setFloat32(r,l,!0),r+=vc),c!==Dc&&(s|=64,t.setFloat32(r,c,!0),r+=Sc),s|=_<<lc,t.setUint32(n,s,!0),r}function Mc(t,e,i){let s=i;const r=t.getUint32(s,!0);s+=pc,e.value=t.getFloat32(s,!0),s+=mc,2&r&&(e.interpolationMode=t.getUint8(s),s+=gc),4&r&&(e.tangentWeightMode=t.getUint8(s),s+=fc),8&r&&(e.leftTangent=t.getFloat32(s,!0),s+=yc),16&r&&(e.leftTangentWeight=t.getFloat32(s,!0),s+=bc),32&r&&(e.rightTangent=t.getFloat32(s,!0),s+=vc),64&r&&(e.rightTangentWeight=t.getFloat32(s,!0),s+=Sc);const n=(r&cc)>>lc;return e.easingMethod=n,s}function Pc(t,e,i){return e+Xi(t-e,i-e)}function Oc(t,e,i){return e+Yi(t-e,i-e)}function Rc(t,e,i,s,r){return e+(s-e)/(i-t)*(r-t)}function Bc(t,e,i,s,r){const n=i-t;switch(e.interpolationMode){default:case 1:return e.value;case 0:{const t=0===e.easingMethod?r:ic(e.easingMethod)(r);return Fi(e.value,s.value,t)}case 2:{const o=1/3,{rightTangent:a,rightTangentWeight:h}=e,l=!!(2&e.tangentWeightMode),{leftTangent:c,leftTangentWeight:u}=s,d=!!(1&s.tangentWeightMode);if(l||d){let _=0;if(l)_=h;else{const t=n,e=n*a;_=Math.sqrt(t*t+e*e)*o}const p=Math.atan(a),m=Math.cos(p)*_+t,g=Math.sin(p)*_+e.value;let f=0;if(d)f=u;else{const t=n,e=n*c;f=Math.sqrt(t*t+e*e)*o}const y=Math.atan(c),b=(m-t)/n,v=(-Math.cos(y)*f+i-t)/n,S=g,T=-Math.sin(y)*f+s.value,w=[0,0,0],x=Nc(w,qa(0-r,3*b,3*v-6*b,3*(b-v)+1,w),r);return Fc(e.value,S,T,s.value,x)}{const t=e.value+o*a*n,i=s.value-o*c*n;return Fc(e.value,t,i,s.value,r)}}}}function Fc(t,e,i,s,r){const n=1-r;return n*n*n*t+3*n*n*r*e+3*n*r*r*i+r*r*r*s}function Nc(t,e,i){let s=i;if(1===e)s=t[0];else{s=-1/0;for(let i=0;i<e;++i){const e=t[i];e>=0&&e<=1&&e>s&&(s=e)}s===-1/0&&(s=0)}return s}function Lc(t,e,i,s,r){const n=1-r;return n*(n*(t+(3*e-t)*r)+3*i*r*r)+s*r*r*r}h.bezier=Lc;const kc=Math.cos,zc=Math.acos,Uc=Math.max,Vc=2*Math.PI,jc=Math.sqrt;function Hc(t){return t<0?-((-t)**(1/3)):t**(1/3)}function Gc(t,e){const i=e-0,s=e-t[0],r=3*i,n=3*s,o=3*(e-t[2]),a=1/(-i+n-o+(e-1)),h=1/3,l=(r-6*s+o)*a,c=l*h,u=(-r+n)*a,d=(3*u-l*l)*h,_=d*h,p=(2*l*l*l-9*l*u+i*a*27)/27,m=p/2,g=m*m+_*_*_;let f,y,b,v,S;if(g<0){const t=-d*h,e=jc(t*t*t),i=-p/(2*e),s=zc(i<-1?-1:i>1?1:i),r=2*Hc(e);return b=r*kc(s*h)-c,v=r*kc((s+Vc)*h)-c,S=r*kc((s+2*Vc)*h)-c,b>=0&&b<=1?v>=0&&v<=1?S>=0&&S<=1?Uc(b,v,S):Uc(b,v):S>=0&&S<=1?Uc(b,S):b:v>=0&&v<=1?S>=0&&S<=1?Uc(v,S):v:S}if(0===g)return f=m<0?Hc(-m):-Hc(m),b=2*f-c,v=-f-c,b>=0&&b<=1?v>=0&&v<=1?Uc(b,v):b:v;{const t=jc(g);return f=Hc(-m+t),y=Hc(m+t),b=f-y-c,b}}function Wc(t,e){const i=Gc(t,e),s=t[1];return((1-i)*(s+(t[3]-s)*i)*3+i*i)*i}var Xc,Yc,qc,$c,Kc,Zc,Qc,Jc,tu;h.bezierByTime=Wc,t("QuatInterpolationMode",{SLERP:0,CONSTANT:1});let eu=ah("cc.QuatKeyframeValue")(Xc=xh((Yc=class{constructor({value:t,interpolationMode:e,easingMethod:i}={}){this.interpolationMode=qc&&qc(),this.value=$c&&$c(),this.easingMethod=Kc&&Kc(),this.value=t?sr.clone(t):this.value,this.interpolationMode=null!=e?e:this.interpolationMode,this.easingMethod=null!=i?i:this.easingMethod}},qc=Za(Yc.prototype,"interpolationMode",[vh],(function(){return 0})),$c=Za(Yc.prototype,"value",[vh],(function(){return sr.clone(sr.IDENTITY)})),Kc=Za(Yc.prototype,"easingMethod",[vh],(function(){return 0})),Xc=Yc))||Xc)||Xc;function iu(t){return new eu(t)}let su=t("QuatCurve",ah("cc.QuatCurve")((Qc=class extends Xa{constructor(){super(),this.preExtrapolation=Jc&&Jc(),this.postExtrapolation=tu&&tu()}evaluate(t,e){var i;null!==(i=e)&&void 0!==i||(e=new sr);const{_times:s,_values:r,postExtrapolation:n,preExtrapolation:o}=this,a=s.length;if(0===a)return e;const h=s[0],l=s[a-1];if(t<h){const i=r[0];switch(o){case 2:t=h+Xi(t-h,l-h);break;case 3:t=h+Yi(t-h,l-h);break;default:return sr.copy(e,i.value)}}else if(t>l){const i=r[a-1];switch(n){case 2:t=h+Xi(t-h,l-h);break;case 3:t=h+Yi(t-h,l-h);break;default:return sr.copy(e,i.value)}}const c=Ga(s,t);if(c>=0)return sr.copy(e,r[c].value);const u=~c,d=u-1,_=s[d],p=r[d],m=s[u],g=r[u],f=(t-_)/(m-_);switch(p.interpolationMode){default:case 1:return sr.copy(e,p.value);case 0:{const{easingMethod:t}=p,i=0===t?f:Array.isArray(t)?Wc(t,f):ic(t)(f);return sr.slerp(e,p.value,g.value,i)}}}addKeyFrame(t,e){const i=new eu(e);return super.addKeyFrame(t,i)}assignSorted(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.map((t=>iu(t))));else{const e=Array.from(t);this.setKeyframes(e.map((([t])=>t)),e.map((([,t])=>iu(t))))}}[al](t,e){if(!e.toCCON)return void t.writeThis();const{_times:i,_values:s}=this;let r=!0;s.forEach(((t,e,[i])=>{r&&t.interpolationMode!==i.interpolationMode&&(r=!1)}));const n=i.length,o=hu*(r?1:n),a=s.reduce(((t,{easingMethod:e})=>t+(Array.isArray(e)?lu+4*uu:lu)),0);let h=0;h+=ru+nu+ou*n+4*au*n+a+o+0;const l=new DataView(new ArrayBuffer(h));let c=0,u=0;r&&(u|=1),l.setUint32(c,u,!0),c+=ru,l.setUint32(c,n,!0),c+=nu,i.forEach(((t,e)=>l.setFloat32(c+ou*e,t,!0))),c+=ou*n,s.forEach((({value:{x:t,y:e,z:i,w:s}},r)=>{const n=c+4*au*r;l.setFloat32(n+0*au,t,!0),l.setFloat32(n+1*au,e,!0),l.setFloat32(n+2*au,i,!0),l.setFloat32(n+3*au,s,!0)})),c+=4*au*n,s.forEach((({easingMethod:t})=>{Array.isArray(t)?(l.setUint8(c,cu),++c,l.setFloat32(c+0*uu,t[0],!0),l.setFloat32(c+1*uu,t[1],!0),l.setFloat32(c+2*uu,t[2],!0),l.setFloat32(c+3*uu,t[3],!0),c+=4*uu):(l.setUint8(c,t),++c)}));const d=c;c+=o;let _=d;s.forEach((({interpolationMode:t})=>{l.setUint8(_,t),r||(_+=hu)}));const p=new Uint8Array(l.buffer);t.writeProperty("bytes",p)}[hl](t,e){if(!e.fromCCON)return void t.readThis();const i=t.readProperty("bytes"),s=new DataView(i.buffer,i.byteOffset,i.byteLength);let r=0;const n=s.getUint32(r,!0);r+=ru;const o=1&n,a=s.getUint32(r,!0);r+=nu;const h=Array.from({length:a},((t,e)=>s.getFloat32(r+ou*e,!0)));r+=ou*a;const l=r;r+=4*au*a;const c=Array.from({length:a},((t,e)=>{const i=l+4*au*e,n=s.getFloat32(i+0*au,!0),o=s.getFloat32(i+1*au,!0),a=s.getFloat32(i+2*au,!0),h=s.getFloat32(i+3*au,!0),c=s.getUint8(r);++r;const u=iu({value:{x:n,y:o,z:a,w:h}});return c!==cu?u.easingMethod=c:(u.easingMethod=[s.getFloat32(r+0*uu,!0),s.getFloat32(r+1*uu,!0),s.getFloat32(r+2*uu,!0),s.getFloat32(r+3*uu,!0)],r+=4*uu),u}));if(o){const t=s.getUint8(r);++r;for(let e=0;e<a;++e)c[e].interpolationMode=t}else{for(let t=0;t<a;++t){const e=s.getUint8(r+t);c[t].interpolationMode=e}r+=a}this._times=h,this._values=c}},Jc=Za(Qc.prototype,"preExtrapolation",[vh],(function(){return 1})),tu=Za(Qc.prototype,"postExtrapolation",[vh],(function(){return 1})),Zc=Qc))||Zc);const ru=1,nu=4,ou=4,au=4,hu=1,lu=1,cu=255,uu=4;var du;let _u=t("ObjectCurve",ah("cc.ObjectCurve")(du=class extends Xa{evaluate(t){const e=this.searchKeyframe(t);if(e>=0)return this._values[e];const i=Ri(~e-1,0,this._values.length-1);return this._values[i]}})||du);const pu={Blend:0,Fixed:1};pe(pu);class mu{constructor(){this.color=Ls.WHITE.clone(),this.time=0}}t("ColorKey",mu),yi.fastDefine("cc.ColorKey",mu,{color:Ls.WHITE.clone(),time:0}),yi.Attr.setClassAttr(mu,"color","visible",!0),yi.Attr.setClassAttr(mu,"time","visible",!0);class gu{constructor(){this.alpha=1,this.time=0}}t("AlphaKey",gu),yi.fastDefine("cc.AlphaKey",gu,{alpha:1,time:0}),yi.Attr.setClassAttr(gu,"alpha","visible",!0),yi.Attr.setClassAttr(gu,"time","visible",!0);class fu{constructor(){this.colorKeys=[],this.alphaKeys=[],this.mode=0}setKeys(t,e){this.colorKeys=t,this.alphaKeys=e}sortKeys(){this.colorKeys.length>1&&this.colorKeys.sort(((t,e)=>t.time-e.time)),this.alphaKeys.length>1&&this.alphaKeys.sort(((t,e)=>t.time-e.time))}evaluate(t){return this.evaluateFast(new Ls,t)}evaluateFast(t,e){return this.getRGB(t,e),t.a=this.getAlpha(e),t}randomColor(){return this.getRandomColor(new Ls)}getRandomColor(t){const e=this.colorKeys[Math.trunc(ki()*this.colorKeys.length)],i=this.alphaKeys[Math.trunc(ki()*this.alphaKeys.length)];return t.set(e.color),t.a=i.alpha,t}getRGB(t,e){const i=this.colorKeys,s=i.length;if(s>1){e=Xi(e,1+Mi);for(let r=1;r<s;++r){const s=i[r-1].time,n=i[r].time;if(e>=s&&e<n){if(1===this.mode)return Ls.copy(t,i[r].color),t;const o=(e-s)/(n-s);return Ls.lerp(t,i[r-1].color,i[r].color,o),t}}const r=s-1;Oi(e,i[r].time,Mi)?Ls.copy(t,i[r].color):e<i[0].time?Ls.lerp(t,Ls.BLACK,i[0].color,e/i[0].time):e>i[r].time&&Ls.lerp(t,i[r].color,Ls.BLACK,(e-i[r].time)/(1-i[r].time))}else 1===s?Ls.copy(t,i[0].color):Ls.copy(t,Ls.WHITE);return t}getAlpha(t){const e=this.alphaKeys,i=e.length;if(i>1){t=Xi(t,1+Mi);for(let s=1;s<i;++s){const i=e[s-1].time,r=e[s].time;if(t>=i&&t<r){if(1===this.mode)return e[s].alpha;const n=(t-i)/(r-i);return Fi(e[s-1].alpha,e[s].alpha,n)}}const s=i-1;return Oi(t,e[s].time,Mi)?e[s].alpha:t<e[0].time?Fi(0,e[0].alpha,t/e[0].time):t>e[s].time?Fi(e[s].alpha,0,(t-e[s].time)/(1-e[s].time)):255}return 1===i?e[0].alpha:255}}t("Gradient",fu),fu.Mode=pu,yi.fastDefine("cc.Gradient",fu,{colorKeys:[],alphaKeys:[],mode:0}),yi.Attr.setClassAttr(fu,"colorKeys","visible",!0),yi.Attr.setClassAttr(fu,"alphaKeys","visible",!0),yi.Attr.setClassAttr(fu,"mode","visible",!0);class yu{constructor(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0}}yi.fastDefine("cc.Keyframe",yu,{time:0,value:0,inTangent:0,outTangent:0});class bu{constructor(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}evaluate(t){return vu(t-this.time,this.coefficient)}}function vu(t,e){return t*(t*(t*e[0]+e[1])+e[2])+e[3]}class Su{get _internalCurve(){return this._curve}get keyFrames(){return Array.from(this._curve.keyframes()).map((([t,e])=>{const i=new yu;return i.time=t,i.value=e.value,i.inTangent=e.leftTangent,i.outTangent=e.rightTangent,i}))}set keyFrames(t){this._curve.assignSorted(t.map((t=>[t.time,{interpolationMode:2,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}])))}get preWrapMode(){return wu(this._curve.preExtrapolation)}set preWrapMode(t){this._curve.preExtrapolation=Tu(t)}get postWrapMode(){return wu(this._curve.postExtrapolation)}set postWrapMode(t){this._curve.postExtrapolation=Tu(t)}constructor(t=null){if(this._curve=void 0,this.cachedKey=void 0,t instanceof hc)this._curve=t;else{const e=new hc;this._curve=e,e.preExtrapolation=2,e.postExtrapolation=1,t?e.assignSorted(t.map((t=>[t.time,{interpolationMode:2,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]))):e.assignSorted([[0,{interpolationMode:2,value:1}],[1,{interpolationMode:2,value:1}]])}this.cachedKey=new bu}addKey(t){t?this._curve.addKeyFrame(t.time,{interpolationMode:2,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}):this._curve.clear()}evaluate_slow(t){return this._curve.evaluate(t)}evaluate(t){const{cachedKey:e,_curve:i}=this,s=i.keyFramesCount-1;let r=t;const n=t<0?i.preExtrapolation:i.postExtrapolation,o=i.getKeyframeTime(0),a=i.getKeyframeTime(s);switch(n){case 2:r=Xi(t-o,a-o)+o;break;case 3:r=Yi(t-o,a-o)+o;break;default:r=Ri(t,o,a)}if(r>=e.time&&r<e.endTime)return e.evaluate(r);const h=this.findIndex(e,r),l=Math.min(h+1,s);return this.calcOptimizedKey(e,h,l),e.evaluate(r)}calcOptimizedKey(t,e,i){const s=this._curve.getKeyframeTime(e),r=this._curve.getKeyframeTime(i),{value:n,leftTangent:o}=this._curve.getKeyframeValue(e),{value:a,rightTangent:h}=this._curve.getKeyframeValue(i);t.index=e,t.time=s,t.endTime=r;const l=r-s,c=a-n,u=1/(l*l),d=o*l,_=h*l;t.coefficient[0]=(d+_-c-c)*u/l,t.coefficient[1]=(c+c+c-d-d-_)*u,t.coefficient[2]=o,t.coefficient[3]=n}findIndex(t,e){const{_curve:i}=this,s=i.keyFramesCount,r=t.index;if(-1!==r)if(e>i.getKeyframeTime(r))for(let t=0;t<3;t++){const n=r+t;if(n+1<s&&i.getKeyframeTime(n+1)>e)return n}else for(let t=0;t<3;t++){const s=r-t;if(s>=0&&i.getKeyframeTime(s-1)<=e)return s-1}let n,o=0,a=s;for(;a-o>1;)n=Math.floor((o+a)/2),i.getKeyframeTime(n)>=e?a=n:o=n;return o}}function Tu(t){switch(t){default:case 0:case 1:case 8:return 1;case 22:return 3;case 2:return 2}}function wu(t){switch(t){default:case 0:case 1:return 8;case 3:return 22;case 2:return 2}}function xu(){const t=new hc;return t.assignSorted([[0,{interpolationMode:2,value:1}],[1,{interpolationMode:2,value:1}]]),t}Su.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],yi.fastDefine("cc.AnimationCurve",Su,{_curve:null});const Cu=Ms.multiplyScalar,Au=Ms.add,Du=Ps(),Eu=Ps(),Iu=Ps(),Mu=Ps();class Pu{constructor(t=2,e=[]){this._type=void 0,this._knots=[],this._type=1024,this._mode=t;for(let t=0;t<e.length;t++)this._knots[t]=Ps(e[t])}static create(t,e=[]){return new Pu(t,e)}static clone(t){return new Pu(t.mode,t.knots)}static copy(t,e){t._mode=e.mode,t._knots.length=0;const i=e.knots,s=i.length;for(let e=0;e<s;e++)t._knots[e]=Ps(i[e]);return t}get type(){return this._type}get mode(){return this._mode}get knots(){return this._knots}setModeAndKnots(t,e){this._mode=t,this._knots.length=0;for(let t=0;t<e.length;t++)this._knots[t]=Ps(e[t])}clearKnots(){this._knots.length=0}getKnotCount(){return this._knots.length}addKnot(t){this._knots.push(Ps(t))}insertKnot(t,e){const i=Ps(e);t>=this._knots.length?this._knots.push(i):this._knots.splice(t,0,i)}removeKnot(t){de(this._knots,t),this._knots.splice(t,1)}setKnot(t,e){de(this._knots,t),this._knots[t].set(e)}getKnot(t){return de(this._knots,t),this._knots[t]}getPoint(t,e=4294967295){t=Ri(t,0,1);const i=this.getSegments();if(0===i)return Ps();if(4294967295===e){const s=1/i;e=Math.floor(t/s),t=t%s/s}const s=this._knots;if(e>=i)return Ps(s[s.length-1]);switch(this._mode){case 0:return Pu.calcLinear(s[e],s[e+1],t);case 1:{const i=4*e;return Pu.calcBezier(s[i],s[i+1],s[i+2],s[i+3],t)}case 2:{const i=e>0?s[e-1]:s[e],r=e+2<s.length?s[e+2]:s[e+1];return Pu.calcCatmullRom(i,s[e],s[e+1],r,t)}default:return Ps()}}getPoints(t,e=4294967295){if(0===t)return[];if(1===t)return[this.getPoint(0,e)];const i=[],s=1/(t-1);for(let r=0;r<t;r++){const t=r*s,n=this.getPoint(t,e);i.push(n)}return i}getSegments(){const t=this._knots.length;switch(this._mode){case 0:case 2:return t<2?(j(14300),0):t-1;case 1:return t<4||t%4!=0?(j(14301),0):t/4;default:return X(!1,16407),0}}static calcLinear(t,e,i){const s=new Ms;return Cu(Du,t,1-i),Cu(Eu,e,i),Au(s,Du,Eu),s}static calcBezier(t,e,i,s,r){const n=new Ms,o=1-r;return Cu(Du,t,o*o*o),Cu(Eu,e,3*r*o*o),Cu(Iu,i,3*r*r*o),Cu(Mu,s,r*r*r),Au(Du,Du,Eu),Au(Iu,Iu,Mu),Au(n,Du,Iu),n}static calcCatmullRom(t,e,i,s,r){const n=new Ms,o=r*r,a=o*r;return Cu(Du,t,-.5*a+o-.5*r),Cu(Eu,e,1.5*a-2.5*o+1),Cu(Iu,i,-1.5*a+2*o+.5*r),Cu(Mu,s,.5*a-.5*o),Au(Du,Du,Eu),Au(Iu,Iu,Mu),Au(n,Du,Iu),n}}function Ou(t,e){M(`${t} is deprecated, please use ${e} instead.`)}Q(co,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var Ru=Object.freeze({__proto__:null,AABB:Ca,AnimationCurve:Su,Capsule:Aa,ERaycastMode:{ALL:0,CLOSEST:1,ANY:2},Frustum:Ba,Keyframe:yu,Line:ln,OBB:Ha,OptimizedKey:bu,Plane:go,Ray:cn,Sphere:gn,Spline:Pu,SplineMode:{LINEAR:0,BEZIER:1,CATMULL_ROM:2},Triangle:fo,WrapModeMask:{Default:0,Normal:1,Loop:2,ShouldWrap:4,Clamp:8,PingPong:22,Reverse:36},aabb:class extends Ca{constructor(){super(),Ou("aabb","AABB")}},capsule:class extends Aa{constructor(){super(),Ou("capsule","Capsule")}},constructLegacyCurveAndConvert:xu,distance:hn,enums:{SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512,SHAPE_SPLINE:1024},evalOptCurve:vu,frustum:class extends Ba{constructor(){super(),Ou("frustum","Frustum")}},intersect:co,line:class extends ln{constructor(){super(),Ou("line","Line")}},obb:class extends Ha{constructor(){super(),Ou("obb","OBB")}},plane:class extends go{constructor(){super(),Ou("plane","Plane")}},ray:class extends cn{constructor(){super(),Ou("ray","Ray")}},sphere:class extends gn{constructor(){super(),Ou("sphere","Sphere")}},triangle:class extends fo{constructor(){super(),Ou("triangle","Triangle")}}});t("geometry",Ru),t("SystemPriority",{LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:2147483648});class Bu{constructor(){this._id="",this._priority=0,this._executeInEditMode=!1}set priority(t){this._priority=t}get priority(){return this._priority}set id(t){this._id=t}get id(){return this._id}static sortByPriority(t,e){return t._priority<e._priority?1:t._priority>e.priority?-1:0}init(){}update(t){}postUpdate(t){}destroy(){}}t("System",Bu),Bu.Priority=pe({LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:2147483648});const Fu=new ut("Scheduler");class Nu{static get(t,e,i,s){let r=Nu._listEntries.pop();return r?(r.target=t,r.priority=e,r.paused=i,r.markedForDeletion=s):r=new Nu(t,e,i,s),r}static put(t){Nu._listEntries.length<20&&(t.target=null,Nu._listEntries.push(t))}constructor(t,e,i,s){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=t,this.priority=e,this.paused=i,this.markedForDeletion=s}}Nu._listEntries=[];class Lu{static get(t,e,i,s){let r=Lu._hashUpdateEntries.pop();return r?(r.list=t,r.entry=e,r.target=i,r.callback=s):r=new Lu(t,e,i,s),r}static put(t){Lu._hashUpdateEntries.length<20&&(t.list=t.entry=t.target=t.callback=null,Lu._hashUpdateEntries.push(t))}constructor(t,e,i,s){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=t,this.entry=e,this.target=i,this.callback=s}}Lu._hashUpdateEntries=[];class ku{static get(t,e,i,s,r,n){let o=ku._hashTimerEntries.pop();return o?(o.timers=t,o.target=e,o.timerIndex=i,o.currentTimer=s,o.currentTimerSalvaged=r,o.paused=n):o=new ku(t,e,i,s,r,n),o}static put(t){ku._hashTimerEntries.length<20&&(t.timers=t.target=t.currentTimer=null,ku._hashTimerEntries.push(t))}constructor(t,e,i,s,r,n){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=t,this.target=e,this.timerIndex=i,this.currentTimer=s,this.currentTimerSalvaged=r,this.paused=n}}ku._hashTimerEntries=[];class zu{static get(){return zu._timers.pop()||new zu}static put(t){zu._timers.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,zu._timers.push(t))}constructor(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null}initWithCallback(t,e,i,s,r,n){return this._lock=!1,this._scheduler=t,this._target=i,this._callback=e,this._timesExecuted=0,this._elapsed=-1,this._interval=s,this._delay=n,this._useDelay=this._delay>0,this._repeat=r,this._runForever=this._repeat===h.macro.REPEAT_FOREVER,!0}getInterval(){return this._interval}setInterval(t){this._interval=t}update(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))}getCallback(){return this._callback}trigger(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)}cancel(){this._scheduler&&this._callback&&this._target&&this._scheduler.unscheduleForTimer(this,this._target)}}zu._timers=[];class Uu extends Bu{static enableForTarget(t){let e=!1;(t.uuid||t.id)&&(e=!0),e||(t.id=Fu.getNewId())}constructor(){super(),this._timeScale=void 0,this._updatesNegList=void 0,this._updates0List=void 0,this._updatesPosList=void 0,this._hashForUpdates=void 0,this._hashForTimers=void 0,this._currentTarget=void 0,this._currentTargetSalvaged=void 0,this._updateHashLocked=void 0,this._arrayForTimers=void 0,this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates=wt(!0),this._hashForTimers=wt(!0),this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]}setTimeScale(t){this._timeScale=t}getTimeScale(){return this._timeScale}update(t){let e,i,s,r,n;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),e=0,i=this._updatesNegList,s=i.length;e<s;e++)r=i[e],r.paused||r.markedForDeletion||!r.target||null==r.target.update||r.target.update(t);for(e=0,i=this._updates0List,s=i.length;e<s;e++)r=i[e],r.paused||r.markedForDeletion||!r.target||null==r.target.update||r.target.update(t);for(e=0,i=this._updatesPosList,s=i.length;e<s;e++)r=i[e],r.paused||r.markedForDeletion||!r.target||null==r.target.update||r.target.update(t);const o=this._arrayForTimers;for(e=0;e<o.length;e++){var a;if(n=o[e],this._currentTarget=n,this._currentTargetSalvaged=!1,!n.paused&&n.timers)for(n.timerIndex=0;n.timerIndex<n.timers.length;++n.timerIndex)n.currentTimer=n.timers[n.timerIndex],n.currentTimerSalvaged=!1,n.currentTimer.update(t),n.currentTimer=null;this._currentTargetSalvaged&&0===(null==(a=this._currentTarget.timers)?void 0:a.length)&&(this._removeHashElement(this._currentTarget),--e)}for(e=0,i=this._updatesNegList;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updates0List;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updatesPosList;e<i.length;)r=i[e],r.markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null}schedule(t,e,i,s,r,n){var o,a;let l,c;"function"!=typeof t?(j(1514),l=e,c=t):(l=t,c=e),3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(n=!!s,s=h.macro.REPEAT_FOREVER,r=0),X(Boolean(c),1502);const u=c.uuid||c.id;if(!u)return void G(1510);let d,_,p=this._hashForTimers[u];if(p?p.paused!==n&&j(1511):(p=ku.get(null,c,0,null,!1,Boolean(n)),this._arrayForTimers.push(p),this._hashForTimers[u]=p),null==p.timers)p.timers=[];else for(_=0;_<p.timers.length;++_)if(d=p.timers[_],d&&l===d.getCallback())return k(1507,d.getInterval(),i),void d.setInterval(i);d=zu.get(),d.initWithCallback(this,l,c,i,null!==(o=s)&&void 0!==o?o:0,null!==(a=r)&&void 0!==a?a:0),p.timers.push(d),this._currentTarget===p&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}scheduleUpdate(t,e,i){const s=t.uuid||t.id;if(!s)return void G(1510);const r=this._hashForUpdates[s];if(r&&r.entry){if(r.entry.priority===e)return r.entry.markedForDeletion=!1,void(r.entry.paused=i);if(this._updateHashLocked)return k(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=i);this.unscheduleUpdate(t)}const n=Nu.get(t,e,i,!1);let o;0===e?(o=this._updates0List,this._appendIn(o,n)):(o=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(o,n,e)),this._hashForUpdates[s]=Lu.get(o,n,t,null)}unschedule(t,e){if(!e||!t)return;const i=e.uuid||e.id;if(!i)return void G(1510);const s=this._hashForTimers[i];if(s){const e=s.timers;if(!e)return;for(let i=0,r=e.length;i<r;i++){const r=e[i];if(t===r.getCallback())return r!==s.currentTimer||s.currentTimerSalvaged||(s.currentTimerSalvaged=!0),e.splice(i,1),zu.put(r),s.timerIndex>=i&&s.timerIndex--,void(0===e.length&&(this._currentTarget===s?this._currentTargetSalvaged=!0:this._removeHashElement(s)))}}}unscheduleForTimer(t,e){const i=e.uuid||e.id,s=this._hashForTimers[i],r=s.timers;if(r&&0!==r.length)for(let e=r.length-1;e>=0;e--){const i=r[e];if(i===t)return r.splice(e,1),zu.put(i),s.timerIndex>=e&&s.timerIndex--,void(0===r.length&&(this._currentTargetSalvaged=!0))}}unscheduleUpdate(t){if(!t)return;const e=t.uuid||t.id;if(!e)return void G(1510);const i=this._hashForUpdates[e];null!=i&&i.entry&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}unscheduleAllForTarget(t){if(!t)return;const e=t.uuid||t.id;if(!e)return void G(1510);const i=this._hashForTimers[e];if(null!=i&&i.timers){const t=i.timers;i.currentTimer&&t.indexOf(i.currentTimer)>-1&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(let e=0,i=t.length;e<i;e++)zu.put(t[e]);t.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(t)}unscheduleAll(){this.unscheduleAllWithMinPriority(2147483648)}unscheduleAllWithMinPriority(t){let e,i;const s=this._arrayForTimers;for(e=s.length-1;e>=0;e--)i=s[e],i.target&&this.unscheduleAllForTarget(i.target);let r,n=0;if(t<0)for(e=0;e<this._updatesNegList.length;){var o;n=this._updatesNegList.length,r=this._updatesNegList[e],null!=(o=r)&&o.target&&r.priority>=t&&this.unscheduleUpdate(r.target),n===this._updatesNegList.length&&e++}if(t<=0)for(e=0;e<this._updates0List.length;){var a;n=this._updates0List.length,r=this._updates0List[e],null!=(a=r)&&a.target&&this.unscheduleUpdate(r.target),n===this._updates0List.length&&e++}for(e=0;e<this._updatesPosList.length;){var h;n=this._updatesPosList.length,r=this._updatesPosList[e],null!=(h=r)&&h.target&&r.priority>=t&&this.unscheduleUpdate(r.target),n===this._updatesPosList.length&&e++}}isScheduled(t,e){X(Boolean(t),1508),X(Boolean(e),1509);const i=e.uuid||e.id;if(!i)return G(1510),!1;const s=this._hashForTimers[i];if(!s)return!1;if(null==s.timers)return!1;{const e=s.timers;for(let i=0;i<e.length;++i)if(t===e[i].getCallback())return!0;return!1}}pauseAllTargets(){return this.pauseAllTargetsWithMinPriority(2147483648)}pauseAllTargetsWithMinPriority(t){const e=[];let i;const s=this._arrayForTimers;let r,n,o;for(r=0,n=s.length;r<n;r++){var a;i=s[r],null!=(a=i)&&a.target&&(i.paused=!0,e.push(i.target))}if(t<0)for(r=0;r<this._updatesNegList.length;r++){var h;o=this._updatesNegList[r],null!=(h=o)&&h.target&&o.priority>=t&&(o.paused=!0,e.push(o.target))}if(t<=0)for(r=0;r<this._updates0List.length;r++){var l;o=this._updates0List[r],null!=(l=o)&&l.target&&(o.paused=!0,e.push(o.target))}for(r=0;r<this._updatesPosList.length;r++){var c;o=this._updatesPosList[r],null!=(c=o)&&c.target&&o.priority>=t&&(o.paused=!0,e.push(o.target))}return e}resumeTargets(t){if(t)for(let e=0;e<t.length;e++)this.resumeTarget(t[e])}pauseTarget(t){X(Boolean(t),1503);const e=t.uuid||t.id;if(!e)return void G(1510);const i=this._hashForTimers[e];i&&(i.paused=!0);const s=this._hashForUpdates[e];null!=s&&s.entry&&(s.entry.paused=!0)}resumeTarget(t){X(Boolean(t),1504);const e=t.uuid||t.id;if(!e)return void G(1510);const i=this._hashForTimers[e];i&&(i.paused=!1);const s=this._hashForUpdates[e];null!=s&&s.entry&&(s.entry.paused=!1)}isTargetPaused(t){X(Boolean(t),1505);const e=t.uuid||t.id;if(!e)return G(1510),!1;const i=this._hashForTimers[e];if(i)return i.paused;const s=this._hashForUpdates[e];return!(null==s||!s.entry)&&s.entry.paused}_removeHashElement(t){if(!t.target)return;const e=t.target.uuid||t.target.id;if(void 0===e)return;delete this._hashForTimers[e];const i=this._arrayForTimers;for(let e=0,s=i.length;e<s;e++)if(i[e]===t){i.splice(e,1);break}ku.put(t)}_removeUpdateFromHash(t){if(!t.target)return;const e=t.target.uuid||t.target.id;if(void 0===e)return;const i=this._hashForUpdates[e];if(i){const t=i.list,s=i.entry;if(t)for(let e=0,i=t.length;e<i;e++)if(t[e]===s){t.splice(e,1);break}delete this._hashForUpdates[e],s&&Nu.put(s),Lu.put(i)}}_priorityIn(t,e,i){for(let s=0;s<t.length;s++)if(i<t[s].priority)return void t.splice(s,0,e);t.push(e)}_appendIn(t,e){t.push(e)}}t("Scheduler",Uu),Uu.ID="scheduler",h.Scheduler=Uu;const Vu={};Q(Vu,"vmath",[{name:"vec2",newName:"Vec2",target:$r,targetName:"math"},{name:"vec3",newName:"Vec3",target:$r,targetName:"math"},{name:"vec4",newName:"Vec4",target:$r,targetName:"math"},{name:"quat",newName:"Quat",target:$r,targetName:"math"},{name:"mat3",newName:"Mat3",target:$r,targetName:"math"},{name:"mat4",newName:"Mat4",target:$r,targetName:"math"},{name:"color4",newName:"Color",target:$r,targetName:"math"},{name:"rect",newName:"Rect",target:$r,targetName:"math"},{name:"approx",newName:"approx",target:$r,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:$r,targetName:"math"},{name:"equals",newName:"equals",target:$r,targetName:"math"},{name:"clamp",newName:"clamp",target:$r,targetName:"math"},{name:"clamp01",newName:"clamp01",target:$r,targetName:"math"},{name:"lerp",newName:"lerp",target:$r,targetName:"math"},{name:"toRadian",newName:"toRadian",target:$r,targetName:"math"},{name:"toDegree",newName:"toDegree",target:$r,targetName:"math"},{name:"random",newName:"random",target:$r,targetName:"math"},{name:"randomRange",newName:"randomRange",target:$r,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:$r,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:$r,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:$r,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:$r,targetName:"math"},{name:"repeat",newName:"repeat",target:$r,targetName:"math"},{name:"pingPong",newName:"pingPong",target:$r,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:$r,targetName:"math"}]),h.vmath=Vu,Q(Uu.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:Uu,targetName:"Scheduler"}]),Q(Uu,"Scheduler",[{name:"PRIORITY_SYSTEM",newName:"System.Priority.SCHEDULER",customGetter:()=>2147483648}]),J(Uu,"Scheduler",[{name:"PRIORITY_NON_SYSTEM",suggest:"Use enum` System.Priority` instead"}]),tt(ce,"js",[{name:"js",suggest:"'js.js' is deprecated since v3.7.0, please access 'js' directly instead."}]);const ju=String.prototype.charCodeAt;function Hu(t){return this[t]}function Gu(t,e){let i=t.length,s=e^i,r=0;const n="string"==typeof t?ju:Hu;for(;i>=4;){let e=255&n.call(t,r)|(255&n.call(t,++r))<<8|(255&n.call(t,++r))<<16|(255&n.call(t,++r))<<24;e=1540483477*(65535&e)+((1540483477*(e>>>16)&65535)<<16),e^=e>>>24,e=1540483477*(65535&e)+((1540483477*(e>>>16)&65535)<<16),s=1540483477*(65535&s)+((1540483477*(s>>>16)&65535)<<16)^e,i-=4,++r}switch(i){case 3:s^=(255&n.call(t,r+2))<<16;case 2:s^=(255&n.call(t,r+1))<<8;case 1:s^=255&n.call(t,r),s=1540483477*(65535&s)+((1540483477*(s>>>16)&65535)<<16)}return s^=s>>>13,s=1540483477*(65535&s)+((1540483477*(s>>>16)&65535)<<16),s^=s>>>15,s>>>0}function Wu(t,e,i){if(de(t,e),de(t,i),e===i)return t;const s=t[e];if(e<i)for(let s=e+1;s<=i;++s)t[s-1]=t[s];else for(let s=e;s!==i;--s)t[s]=t[s-1];return t[i]=s,t}h.easing=tc;const Xu=t("garbageCollectionManager",new class{constructor(){this._finalizationRegistry=null,this._gcObjects=new WeakMap}registerGCObject(t){return t}init(){}finalizationRegistryCallback(t){}destroy(){}});class Yu{constructor(){return Xu.registerGCObject(this)}destroy(){}}function qu(t,e){for(const i of e)Array.isArray(i)?qu(t,i):t.push(i)}function $u(t){const e=[];return qu(e,t),e.join("")}function Ku(t,e){e.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((i=>{"constructor"!==i&&Object.defineProperty(t.prototype,i,Object.getOwnPropertyDescriptor(e.prototype,i))}))}))}t("GCObject",Yu),h.math=$r,h.geometry=Ru;const Zu=(t,e,i)=>{for(let s=0;s<e.length;++s)t.length<=s&&t.push(new i),t[s].copy(e[s]);t.length=e.length},Qu={UNKNOWN:0,SWAPCHAIN:1,BUFFER:2,TEXTURE:3,RENDER_PASS:4,FRAMEBUFFER:5,SAMPLER:6,SHADER:7,DESCRIPTOR_SET_LAYOUT:8,PIPELINE_LAYOUT:9,PIPELINE_STATE:10,DESCRIPTOR_SET:11,INPUT_ASSEMBLER:12,COMMAND_BUFFER:13,QUEUE:14,QUERY_POOL:15,GLOBAL_BARRIER:16,TEXTURE_BARRIER:17,BUFFER_BARRIER:18,COUNT:19},Ju={UNREADY:0,FAILED:1,SUCCESS:2},td={UNKNOWN:0,GLES2:1,GLES3:2,METAL:3,VULKAN:4,NVN:5,WEBGL:6,WEBGL2:7,WEBGPU:8},ed={IDENTITY:0,ROTATE_90:1,ROTATE_180:2,ROTATE_270:3},id={ELEMENT_INDEX_UINT:0,INSTANCED_ARRAYS:1,MULTIPLE_RENDER_TARGETS:2,BLEND_MINMAX:3,COMPUTE_SHADER:4,INPUT_ATTACHMENT_BENEFIT:5,SUBPASS_COLOR_INPUT:6,SUBPASS_DEPTH_STENCIL_INPUT:7,RASTERIZATION_ORDER_NOCOHERENT:8,MULTI_SAMPLE_RESOLVE_DEPTH_STENCIL:9,COUNT:10},sd={UNKNOWN:0,A8:1,L8:2,LA8:3,R8:4,R8SN:5,R8UI:6,R8I:7,R16F:8,R16UI:9,R16I:10,R32F:11,R32UI:12,R32I:13,RG8:14,RG8SN:15,RG8UI:16,RG8I:17,RG16F:18,RG16UI:19,RG16I:20,RG32F:21,RG32UI:22,RG32I:23,RGB8:24,SRGB8:25,RGB8SN:26,RGB8UI:27,RGB8I:28,RGB16F:29,RGB16UI:30,RGB16I:31,RGB32F:32,RGB32UI:33,RGB32I:34,RGBA8:35,BGRA8:36,SRGB8_A8:37,RGBA8SN:38,RGBA8UI:39,RGBA8I:40,RGBA16F:41,RGBA16UI:42,RGBA16I:43,RGBA32F:44,RGBA32UI:45,RGBA32I:46,R5G6B5:47,R11G11B10F:48,RGB5A1:49,RGBA4:50,RGB10A2:51,RGB10A2UI:52,RGB9E5:53,DEPTH:54,DEPTH_STENCIL:55,BC1:56,BC1_ALPHA:57,BC1_SRGB:58,BC1_SRGB_ALPHA:59,BC2:60,BC2_SRGB:61,BC3:62,BC3_SRGB:63,BC4:64,BC4_SNORM:65,BC5:66,BC5_SNORM:67,BC6H_UF16:68,BC6H_SF16:69,BC7:70,BC7_SRGB:71,ETC_RGB8:72,ETC2_RGB8:73,ETC2_SRGB8:74,ETC2_RGB8_A1:75,ETC2_SRGB8_A1:76,ETC2_RGBA8:77,ETC2_SRGB8_A8:78,EAC_R11:79,EAC_R11SN:80,EAC_RG11:81,EAC_RG11SN:82,PVRTC_RGB2:83,PVRTC_RGBA2:84,PVRTC_RGB4:85,PVRTC_RGBA4:86,PVRTC2_2BPP:87,PVRTC2_4BPP:88,ASTC_RGBA_4X4:89,ASTC_RGBA_5X4:90,ASTC_RGBA_5X5:91,ASTC_RGBA_6X5:92,ASTC_RGBA_6X6:93,ASTC_RGBA_8X5:94,ASTC_RGBA_8X6:95,ASTC_RGBA_8X8:96,ASTC_RGBA_10X5:97,ASTC_RGBA_10X6:98,ASTC_RGBA_10X8:99,ASTC_RGBA_10X10:100,ASTC_RGBA_12X10:101,ASTC_RGBA_12X12:102,ASTC_SRGBA_4X4:103,ASTC_SRGBA_5X4:104,ASTC_SRGBA_5X5:105,ASTC_SRGBA_6X5:106,ASTC_SRGBA_6X6:107,ASTC_SRGBA_8X5:108,ASTC_SRGBA_8X6:109,ASTC_SRGBA_8X8:110,ASTC_SRGBA_10X5:111,ASTC_SRGBA_10X6:112,ASTC_SRGBA_10X8:113,ASTC_SRGBA_10X10:114,ASTC_SRGBA_12X10:115,ASTC_SRGBA_12X12:116,COUNT:117},rd={NONE:0,UNORM:1,SNORM:2,UINT:3,INT:4,UFLOAT:5,FLOAT:6},nd={FLOAT:0,UNFILTERABLE_FLOAT:1,SINT:2,UINT:3},od={UNKNOWN:0,BOOL:1,BOOL2:2,BOOL3:3,BOOL4:4,INT:5,INT2:6,INT3:7,INT4:8,UINT:9,UINT2:10,UINT3:11,UINT4:12,FLOAT:13,FLOAT2:14,FLOAT3:15,FLOAT4:16,MAT2:17,MAT2X3:18,MAT2X4:19,MAT3X2:20,MAT3:21,MAT3X4:22,MAT4X2:23,MAT4X3:24,MAT4:25,SAMPLER1D:26,SAMPLER1D_ARRAY:27,SAMPLER2D:28,SAMPLER2D_ARRAY:29,SAMPLER3D:30,SAMPLER_CUBE:31,SAMPLER:32,TEXTURE1D:33,TEXTURE1D_ARRAY:34,TEXTURE2D:35,TEXTURE2D_ARRAY:36,TEXTURE3D:37,TEXTURE_CUBE:38,IMAGE1D:39,IMAGE1D_ARRAY:40,IMAGE2D:41,IMAGE2D_ARRAY:42,IMAGE3D:43,IMAGE_CUBE:44,SUBPASS_INPUT:45,COUNT:46},ad={NONE:0,TRANSFER_SRC:1,TRANSFER_DST:2,INDEX:4,VERTEX:8,UNIFORM:16,STORAGE:32,INDIRECT:64},hd={NONE:0,ENABLE_STAGING_WRITE:1},ld={NONE:0,READ_ONLY:1,WRITE_ONLY:2,READ_WRITE:3},cd={NONE:0,DEVICE:1,HOST:2},ud={TEX1D:0,TEX2D:1,TEX3D:2,CUBE:3,TEX1D_ARRAY:4,TEX2D_ARRAY:5},dd={UNKNOWN:0,BUFFER:1,TEX1D:2,TEX1D_ARRAY:3,TEX2D:4,TEX2D_ARRAY:5,TEX2DMS:6,TEX2DMS_ARRAY:7,TEX3D:8,TEXCUBE:9,TEXCUBE_ARRAY:10,RAYTRACING_ACCELERATION_STRUCTURE:11},_d={NONE:0,TRANSFER_SRC:1,TRANSFER_DST:2,SAMPLED:4,STORAGE:8,COLOR_ATTACHMENT:16,DEPTH_STENCIL_ATTACHMENT:32,INPUT_ATTACHMENT:64,SHADING_RATE:128},pd={NONE:0,GEN_MIPMAP:1,GENERAL_LAYOUT:2,EXTERNAL_OES:4,EXTERNAL_NORMAL:8,LAZILY_ALLOCATED:16,MUTABLE_VIEW_FORMAT:64,MUTABLE_STORAGE:128},md={NONE:0,RENDER_TARGET:1,SAMPLED_TEXTURE:2,LINEAR_FILTER:4,STORAGE_TEXTURE:8,VERTEX_ATTRIBUTE:16,SHADING_RATE:32},gd={X1:1,X2:2,X4:4,X8:8,X16:16,X32:32,X64:64},fd={OFF:0,ON:1,RELAXED:2,MAILBOX:3,HALF:4},yd={NONE:0,POINT:1,LINEAR:2,ANISOTROPIC:3},bd={WRAP:0,MIRROR:1,CLAMP:2,BORDER:3},vd={NEVER:0,LESS:1,EQUAL:2,LESS_EQUAL:3,GREATER:4,NOT_EQUAL:5,GREATER_EQUAL:6,ALWAYS:7},Sd={ZERO:0,KEEP:1,REPLACE:2,INCR:3,DECR:4,INVERT:5,INCR_WRAP:6,DECR_WRAP:7},Td={ZERO:0,ONE:1,SRC_ALPHA:2,DST_ALPHA:3,ONE_MINUS_SRC_ALPHA:4,ONE_MINUS_DST_ALPHA:5,SRC_COLOR:6,DST_COLOR:7,ONE_MINUS_SRC_COLOR:8,ONE_MINUS_DST_COLOR:9,SRC_ALPHA_SATURATE:10,CONSTANT_COLOR:11,ONE_MINUS_CONSTANT_COLOR:12,CONSTANT_ALPHA:13,ONE_MINUS_CONSTANT_ALPHA:14},wd={ADD:0,SUB:1,REV_SUB:2,MIN:3,MAX:4},xd={NONE:0,R:1,G:2,B:4,A:8,ALL:15},Cd={NONE:0,VERTEX:1,CONTROL:2,EVALUATION:4,GEOMETRY:8,FRAGMENT:16,COMPUTE:32,ALL:63},Ad={LOAD:0,CLEAR:1,DISCARD:2},Dd={STORE:0,DISCARD:1},Ed={NONE:0,INDIRECT_BUFFER:1,INDEX_BUFFER:2,VERTEX_BUFFER:4,VERTEX_SHADER_READ_UNIFORM_BUFFER:8,VERTEX_SHADER_READ_TEXTURE:16,VERTEX_SHADER_READ_OTHER:32,FRAGMENT_SHADER_READ_UNIFORM_BUFFER:64,FRAGMENT_SHADER_READ_TEXTURE:128,FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT:256,FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT:512,FRAGMENT_SHADER_READ_OTHER:1024,COLOR_ATTACHMENT_READ:2048,DEPTH_STENCIL_ATTACHMENT_READ:4096,COMPUTE_SHADER_READ_UNIFORM_BUFFER:8192,COMPUTE_SHADER_READ_TEXTURE:16384,COMPUTE_SHADER_READ_OTHER:32768,TRANSFER_READ:65536,HOST_READ:131072,PRESENT:262144,VERTEX_SHADER_WRITE:524288,FRAGMENT_SHADER_WRITE:1048576,COLOR_ATTACHMENT_WRITE:2097152,DEPTH_STENCIL_ATTACHMENT_WRITE:4194304,COMPUTE_SHADER_WRITE:8388608,TRANSFER_WRITE:16777216,HOST_PREINITIALIZED:33554432,HOST_WRITE:67108864,SHADING_RATE:134217728},Id={NONE:0,SAMPLE_ZERO:1,AVERAGE:2,MIN:3,MAX:4},Md={GRAPHICS:0,COMPUTE:1,RAY_TRACING:2},Pd={POINT_LIST:0,LINE_LIST:1,LINE_STRIP:2,LINE_LOOP:3,LINE_LIST_ADJACENCY:4,LINE_STRIP_ADJACENCY:5,ISO_LINE_LIST:6,TRIANGLE_LIST:7,TRIANGLE_STRIP:8,TRIANGLE_FAN:9,TRIANGLE_LIST_ADJACENCY:10,TRIANGLE_STRIP_ADJACENCY:11,TRIANGLE_PATCH_ADJACENCY:12,QUAD_PATCH_LIST:13},Od={FILL:0,POINT:1,LINE:2},Rd={GOURAND:0,FLAT:1},Bd={NONE:0,FRONT:1,BACK:2},Fd={NONE:0,LINE_WIDTH:1,DEPTH_BIAS:2,BLEND_CONSTANTS:4,DEPTH_BOUNDS:8,STENCIL_WRITE_MASK:16,STENCIL_COMPARE_MASK:32},Nd={FRONT:1,BACK:2,ALL:3},Ld={UNKNOWN:0,UNIFORM_BUFFER:1,DYNAMIC_UNIFORM_BUFFER:2,STORAGE_BUFFER:4,DYNAMIC_STORAGE_BUFFER:8,SAMPLER_TEXTURE:16,SAMPLER:32,TEXTURE:64,STORAGE_IMAGE:128,INPUT_ATTACHMENT:256},kd={GRAPHICS:0,COMPUTE:1,TRANSFER:2},zd={OCCLUSION:0,PIPELINE_STATISTICS:1,TIMESTAMP:2},Ud={PRIMARY:0,SECONDARY:1},Vd={NONE:0,COLOR:1,DEPTH:2,STENCIL:4,DEPTH_STENCIL:6,ALL:7},jd={FULL:0,SPLIT_BEGIN:1,SPLIT_END:2},Hd={RASTER:0,COMPUTE:1,COPY:2,MOVE:3,RAYTRACE:4,PRESENT:5};class Gd{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}}class Wd{constructor(t=0,e=0,i=0,s=0,r=0,n=0,o=0,a=0,h=0,l=0,c=0,u=0,d=0,_=0,p=0,m=1,g=0,f=0,y=new Gd,b=new Gd,v=!1,S=!1,T=!1,w=-1,x=1,C=1){this.maxVertexAttributes=t,this.maxVertexUniformVectors=e,this.maxFragmentUniformVectors=i,this.maxTextureUnits=s,this.maxImageUnits=r,this.maxVertexTextureUnits=n,this.maxColorRenderTargets=o,this.maxShaderStorageBufferBindings=a,this.maxShaderStorageBlockSize=h,this.maxUniformBufferBindings=l,this.maxUniformBlockSize=c,this.maxTextureSize=u,this.maxCubeMapTextureSize=d,this.maxArrayTextureLayers=_,this.max3DTextureSize=p,this.uboOffsetAlignment=m,this.maxComputeSharedMemorySize=g,this.maxComputeWorkGroupInvocations=f,this.maxComputeWorkGroupSize=y,this.maxComputeWorkGroupCount=b,this.supportQuery=v,this.supportVariableRateShading=S,this.supportSubPassShading=T,this.clipSpaceMinZ=w,this.screenSpaceSignY=x,this.clipSpaceSignY=C}copy(t){return this.maxVertexAttributes=t.maxVertexAttributes,this.maxVertexUniformVectors=t.maxVertexUniformVectors,this.maxFragmentUniformVectors=t.maxFragmentUniformVectors,this.maxTextureUnits=t.maxTextureUnits,this.maxImageUnits=t.maxImageUnits,this.maxVertexTextureUnits=t.maxVertexTextureUnits,this.maxColorRenderTargets=t.maxColorRenderTargets,this.maxShaderStorageBufferBindings=t.maxShaderStorageBufferBindings,this.maxShaderStorageBlockSize=t.maxShaderStorageBlockSize,this.maxUniformBufferBindings=t.maxUniformBufferBindings,this.maxUniformBlockSize=t.maxUniformBlockSize,this.maxTextureSize=t.maxTextureSize,this.maxCubeMapTextureSize=t.maxCubeMapTextureSize,this.maxArrayTextureLayers=t.maxArrayTextureLayers,this.max3DTextureSize=t.max3DTextureSize,this.uboOffsetAlignment=t.uboOffsetAlignment,this.maxComputeSharedMemorySize=t.maxComputeSharedMemorySize,this.maxComputeWorkGroupInvocations=t.maxComputeWorkGroupInvocations,this.maxComputeWorkGroupSize.copy(t.maxComputeWorkGroupSize),this.maxComputeWorkGroupCount.copy(t.maxComputeWorkGroupCount),this.supportQuery=t.supportQuery,this.supportVariableRateShading=t.supportVariableRateShading,this.supportSubPassShading=t.supportSubPassShading,this.clipSpaceMinZ=t.clipSpaceMinZ,this.screenSpaceSignY=t.screenSpaceSignY,this.clipSpaceSignY=t.clipSpaceSignY,this}}class Xd{constructor(t=!0){this.enableBarrierDeduce=t}copy(t){return this.enableBarrierDeduce=t.enableBarrierDeduce,this}}class Yd{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}}class qd{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.width=i,this.height=s}copy(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}}class $d{constructor(t=0,e=0,i=1){this.width=t,this.height=e,this.depth=i}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this}}class Kd{constructor(t=0,e=0,i=1){this.mipLevel=t,this.baseArrayLayer=e,this.layerCount=i}copy(t){return this.mipLevel=t.mipLevel,this.baseArrayLayer=t.baseArrayLayer,this.layerCount=t.layerCount,this}}class Zd{constructor(t=0,e=1,i=0,s=1){this.baseMipLevel=t,this.levelCount=e,this.baseArrayLayer=i,this.layerCount=s}copy(t){return this.baseMipLevel=t.baseMipLevel,this.levelCount=t.levelCount,this.baseArrayLayer=t.baseArrayLayer,this.layerCount=t.layerCount,this}}class Qd{constructor(t=new Kd,e=new Yd,i=new Kd,s=new Yd,r=new $d){this.srcSubres=t,this.srcOffset=e,this.dstSubres=i,this.dstOffset=s,this.extent=r}copy(t){return this.srcSubres.copy(t.srcSubres),this.srcOffset.copy(t.srcOffset),this.dstSubres.copy(t.dstSubres),this.dstOffset.copy(t.dstOffset),this.extent.copy(t.extent),this}}class Jd{constructor(t=new Kd,e=new Yd,i=new $d,s=new Kd,r=new Yd,n=new $d){this.srcSubres=t,this.srcOffset=e,this.srcExtent=i,this.dstSubres=s,this.dstOffset=r,this.dstExtent=n}copy(t){return this.srcSubres.copy(t.srcSubres),this.srcOffset.copy(t.srcOffset),this.srcExtent.copy(t.srcExtent),this.dstSubres.copy(t.dstSubres),this.dstOffset.copy(t.dstOffset),this.dstExtent.copy(t.dstExtent),this}}class t_{constructor(t=0,e=0,i=0,s=new Yd,r=new $d,n=new Kd){this.buffOffset=t,this.buffStride=e,this.buffTexHeight=i,this.texOffset=s,this.texExtent=r,this.texSubres=n}copy(t){return this.buffOffset=t.buffOffset,this.buffStride=t.buffStride,this.buffTexHeight=t.buffTexHeight,this.texOffset.copy(t.texOffset),this.texExtent.copy(t.texExtent),this.texSubres.copy(t.texSubres),this}}class e_{constructor(t=0,e=0,i=0,s=0,r=0,n=1){this.left=t,this.top=e,this.width=i,this.height=s,this.minDepth=r,this.maxDepth=n}copy(t){return this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height,this.minDepth=t.minDepth,this.maxDepth=t.maxDepth,this}reset(){this.left=0,this.top=0,this.width=0,this.height=0,this.minDepth=0,this.maxDepth=1}}class i_{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.z=i,this.w=s}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}reset(){this.x=0,this.y=0,this.z=0,this.w=0}}class s_{constructor(t="",e=new i_){this.name=t,this.color=e}copy(t){return this.name=t.name,this.color.copy(t.color),this}}class r_{constructor(t=[0],e=[0],i=[0],s=[0],r=[0],n=[0],o=[0],a=[0]){this.maxBlockCounts=t,this.maxSamplerTextureCounts=e,this.maxSamplerCounts=i,this.maxTextureCounts=s,this.maxBufferCounts=r,this.maxImageCounts=n,this.maxSubpassInputCounts=o,this.setIndices=a}copy(t){return this.maxBlockCounts=t.maxBlockCounts.slice(),this.maxSamplerTextureCounts=t.maxSamplerTextureCounts.slice(),this.maxSamplerCounts=t.maxSamplerCounts.slice(),this.maxTextureCounts=t.maxTextureCounts.slice(),this.maxBufferCounts=t.maxBufferCounts.slice(),this.maxImageCounts=t.maxImageCounts.slice(),this.maxSubpassInputCounts=t.maxSubpassInputCounts.slice(),this.setIndices=t.setIndices.slice(),this}}class n_{constructor(t=0,e=null,i=1,s=0,r=0){this.windowId=t,this.windowHandle=e,this.vsyncMode=i,this.width=s,this.height=r}copy(t){return this.windowId=t.windowId,this.windowHandle=t.windowHandle,this.vsyncMode=t.vsyncMode,this.width=t.width,this.height=t.height,this}}class o_{constructor(t=new r_){this.bindingMappingInfo=t}copy(t){return this.bindingMappingInfo.copy(t.bindingMappingInfo),this}}class a_{constructor(t=0,e=0,i=0,s=1,r=0){this.usage=t,this.memUsage=e,this.size=i,this.stride=s,this.flags=r}copy(t){return this.usage=t.usage,this.memUsage=t.memUsage,this.size=t.size,this.stride=t.stride,this.flags=t.flags,this}}class h_{constructor(t=null,e=0,i=0){this.buffer=t,this.offset=e,this.range=i}copy(t){return this.buffer=t.buffer,this.offset=t.offset,this.range=t.range,this}}class l_{constructor(t=0,e=0,i=0,s=0,r=0,n=0,o=0){this.vertexCount=t,this.firstVertex=e,this.indexCount=i,this.firstIndex=s,this.vertexOffset=r,this.instanceCount=n,this.firstInstance=o}copy(t){return this.vertexCount=t.vertexCount,this.firstVertex=t.firstVertex,this.indexCount=t.indexCount,this.firstIndex=t.firstIndex,this.vertexOffset=t.vertexOffset,this.instanceCount=t.instanceCount,this.firstInstance=t.firstInstance,this}}class c_{constructor(t=0,e=0,i=0,s=null,r=0){this.groupCountX=t,this.groupCountY=e,this.groupCountZ=i,this.indirectBuffer=s,this.indirectOffset=r}copy(t){return this.groupCountX=t.groupCountX,this.groupCountY=t.groupCountY,this.groupCountZ=t.groupCountZ,this.indirectBuffer=t.indirectBuffer,this.indirectOffset=t.indirectOffset,this}}class u_{constructor(t=[]){this.drawInfos=t}copy(t){return Zu(this.drawInfos,t.drawInfos,l_),this}}class d_{constructor(t=1,e=0,i=0,s=0,r=0,n=0,o=1,a=1,h=1,l=1,c=0){this.type=t,this.usage=e,this.format=i,this.width=s,this.height=r,this.flags=n,this.layerCount=o,this.levelCount=a,this.samples=h,this.depth=l,this.externalRes=c}copy(t){return this.type=t.type,this.usage=t.usage,this.format=t.format,this.width=t.width,this.height=t.height,this.flags=t.flags,this.layerCount=t.layerCount,this.levelCount=t.levelCount,this.samples=t.samples,this.depth=t.depth,this.externalRes=t.externalRes,this}}class __{constructor(t=null,e=1,i=0,s=0,r=1,n=0,o=1,a=0,h=1){this.texture=t,this.type=e,this.format=i,this.baseLevel=s,this.levelCount=r,this.baseLayer=n,this.layerCount=o,this.basePlane=a,this.planeCount=h}copy(t){return this.texture=t.texture,this.type=t.type,this.format=t.format,this.baseLevel=t.baseLevel,this.levelCount=t.levelCount,this.baseLayer=t.baseLayer,this.layerCount=t.layerCount,this.basePlane=t.basePlane,this.planeCount=t.planeCount,this}}class p_{constructor(t=2,e=2,i=0,s=0,r=0,n=0,o=0,a=7){this.minFilter=t,this.magFilter=e,this.mipFilter=i,this.addressU=s,this.addressV=r,this.addressW=n,this.maxAnisotropy=o,this.cmpFunc=a}copy(t){return this.minFilter=t.minFilter,this.magFilter=t.magFilter,this.mipFilter=t.mipFilter,this.addressU=t.addressU,this.addressV=t.addressV,this.addressW=t.addressW,this.maxAnisotropy=t.maxAnisotropy,this.cmpFunc=t.cmpFunc,this}}class m_{constructor(t="",e=0,i=0){this.name=t,this.type=e,this.count=i}copy(t){return this.name=t.name,this.type=t.type,this.count=t.count,this}}class g_{constructor(t=0,e=0,i="",s=[],r=0,n=0){this.set=t,this.binding=e,this.name=i,this.members=s,this.count=r,this.flattened=n}copy(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,Zu(this.members,t.members,m_),this.count=t.count,this.flattened=t.flattened,this}}class f_{constructor(t=0,e=0,i="",s=0,r=0,n=0){this.set=t,this.binding=e,this.name=i,this.type=s,this.count=r,this.flattened=n}copy(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this.flattened=t.flattened,this}}class y_{constructor(t=0,e=0,i="",s=0,r=0){this.set=t,this.binding=e,this.name=i,this.count=s,this.flattened=r}copy(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this.flattened=t.flattened,this}}class b_{constructor(t=0,e=0,i="",s=0,r=0,n=0){this.set=t,this.binding=e,this.name=i,this.type=s,this.count=r,this.flattened=n}copy(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this.flattened=t.flattened,this}}class v_{constructor(t=0,e=0,i="",s=0,r=0,n=3,o=0){this.set=t,this.binding=e,this.name=i,this.type=s,this.count=r,this.memoryAccess=n,this.flattened=o}copy(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this.memoryAccess=t.memoryAccess,this.flattened=t.flattened,this}}class S_{constructor(t=0,e=0,i="",s=0,r=3,n=0){this.set=t,this.binding=e,this.name=i,this.count=s,this.memoryAccess=r,this.flattened=n}copy(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this.memoryAccess=t.memoryAccess,this.flattened=t.flattened,this}}class T_{constructor(t=0,e=0,i="",s=0,r=0){this.set=t,this.binding=e,this.name=i,this.count=s,this.flattened=r}copy(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this.flattened=t.flattened,this}}class w_{constructor(t=0,e=""){this.stage=t,this.source=e}copy(t){return this.stage=t.stage,this.source=t.source,this}}class x_{constructor(t="",e=0,i=!1,s=0,r=!1,n=0){this.name=t,this.format=e,this.isNormalized=i,this.stream=s,this.isInstanced=r,this.location=n}copy(t){return this.name=t.name,this.format=t.format,this.isNormalized=t.isNormalized,this.stream=t.stream,this.isInstanced=t.isInstanced,this.location=t.location,this}}class C_{constructor(t="",e=[],i=[],s=[],r=[],n=[],o=[],a=[],h=[],l=[],c=4294967295){this.name=t,this.stages=e,this.attributes=i,this.blocks=s,this.buffers=r,this.samplerTextures=n,this.samplers=o,this.textures=a,this.images=h,this.subpassInputs=l,this.hash=c}copy(t){return this.name=t.name,Zu(this.stages,t.stages,w_),Zu(this.attributes,t.attributes,x_),Zu(this.blocks,t.blocks,g_),Zu(this.buffers,t.buffers,S_),Zu(this.samplerTextures,t.samplerTextures,f_),Zu(this.samplers,t.samplers,y_),Zu(this.textures,t.textures,b_),Zu(this.images,t.images,v_),Zu(this.subpassInputs,t.subpassInputs,T_),this.hash=t.hash,this}}class A_{constructor(t=[],e=[],i=null,s=null){this.attributes=t,this.vertexBuffers=e,this.indexBuffer=i,this.indirectBuffer=s}copy(t){return Zu(this.attributes,t.attributes,x_),this.vertexBuffers=t.vertexBuffers.slice(),this.indexBuffer=t.indexBuffer,this.indirectBuffer=t.indirectBuffer,this}}class D_{constructor(t=0,e=1,i=1,s=0,r=null){this.format=t,this.sampleCount=e,this.loadOp=i,this.storeOp=s,this.barrier=r}copy(t){return this.format=t.format,this.sampleCount=t.sampleCount,this.loadOp=t.loadOp,this.storeOp=t.storeOp,this.barrier=t.barrier,this}}class E_{constructor(t=0,e=1,i=1,s=0,r=1,n=0,o=null){this.format=t,this.sampleCount=e,this.depthLoadOp=i,this.depthStoreOp=s,this.stencilLoadOp=r,this.stencilStoreOp=n,this.barrier=o}copy(t){return this.format=t.format,this.sampleCount=t.sampleCount,this.depthLoadOp=t.depthLoadOp,this.depthStoreOp=t.depthStoreOp,this.stencilLoadOp=t.stencilLoadOp,this.stencilStoreOp=t.stencilStoreOp,this.barrier=t.barrier,this}}class I_{constructor(t=[],e=[],i=[],s=[],r=-1,n=-1,o=-1,a=0,h=0){this.inputs=t,this.colors=e,this.resolves=i,this.preserves=s,this.depthStencil=r,this.depthStencilResolve=n,this.shadingRate=o,this.depthResolveMode=a,this.stencilResolveMode=h}copy(t){return this.inputs=t.inputs.slice(),this.colors=t.colors.slice(),this.resolves=t.resolves.slice(),this.preserves=t.preserves.slice(),this.depthStencil=t.depthStencil,this.depthStencilResolve=t.depthStencilResolve,this.shadingRate=t.shadingRate,this.depthResolveMode=t.depthResolveMode,this.stencilResolveMode=t.stencilResolveMode,this}}class M_{constructor(t=0,e=0,i=null,s=0,r=0){this.srcSubpass=t,this.dstSubpass=e,this.generalBarrier=i,this.prevAccesses=s,this.nextAccesses=r}copy(t){return this.srcSubpass=t.srcSubpass,this.dstSubpass=t.dstSubpass,this.generalBarrier=t.generalBarrier,this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this}}class P_{constructor(t=[],e=new E_,i=new E_,s=[],r=[]){this.colorAttachments=t,this.depthStencilAttachment=e,this.depthStencilResolveAttachment=i,this.subpasses=s,this.dependencies=r}copy(t){return Zu(this.colorAttachments,t.colorAttachments,D_),this.depthStencilAttachment.copy(t.depthStencilAttachment),this.depthStencilResolveAttachment.copy(t.depthStencilResolveAttachment),Zu(this.subpasses,t.subpasses,I_),Zu(this.dependencies,t.dependencies,M_),this}}class O_{constructor(t=0,e=0,i=0,s=0,r=0,n=0,o=0,a=0,h=0){this.width=t,this.height=e,this.depthOrArraySize=i,this.firstSlice=s,this.numSlices=r,this.mipLevel=n,this.levelCount=o,this.basePlane=a,this.planeCount=h}copy(t){return this.width=t.width,this.height=t.height,this.depthOrArraySize=t.depthOrArraySize,this.firstSlice=t.firstSlice,this.numSlices=t.numSlices,this.mipLevel=t.mipLevel,this.levelCount=t.levelCount,this.basePlane=t.basePlane,this.planeCount=t.planeCount,this}}class R_{constructor(t=0,e=0,i=0){this.prevAccesses=t,this.nextAccesses=e,this.type=i}copy(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this.type=t.type,this}}class B_{constructor(t=0,e=0,i=0,s=new O_,r=!1,n=null,o=null){this.prevAccesses=t,this.nextAccesses=e,this.type=i,this.range=s,this.discardContents=r,this.srcQueue=n,this.dstQueue=o}copy(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this.type=t.type,this.range.copy(t.range),this.discardContents=t.discardContents,this.srcQueue=t.srcQueue,this.dstQueue=t.dstQueue,this}}class F_{constructor(t=0,e=0,i=0,s=0,r=0,n=!1,o=null,a=null){this.prevAccesses=t,this.nextAccesses=e,this.type=i,this.offset=s,this.size=r,this.discardContents=n,this.srcQueue=o,this.dstQueue=a}copy(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this.type=t.type,this.offset=t.offset,this.size=t.size,this.discardContents=t.discardContents,this.srcQueue=t.srcQueue,this.dstQueue=t.dstQueue,this}}class N_{constructor(t=null,e=[],i=null,s=null){this.renderPass=t,this.colorTextures=e,this.depthStencilTexture=i,this.depthStencilResolveTexture=s}copy(t){return this.renderPass=t.renderPass,this.colorTextures=t.colorTextures.slice(),this.depthStencilTexture=t.depthStencilTexture,this.depthStencilResolveTexture=t.depthStencilResolveTexture,this}}class L_{constructor(t=-1,e=0,i=0,s=0,r=1,n=0,o=0,a=0,h=[]){this.binding=t,this.descriptorType=e,this.count=i,this.stageFlags=s,this.access=r,this.viewDimension=n,this.sampleType=o,this.format=a,this.immutableSamplers=h}copy(t){return this.binding=t.binding,this.descriptorType=t.descriptorType,this.count=t.count,this.stageFlags=t.stageFlags,this.access=t.access,this.viewDimension=t.viewDimension,this.sampleType=t.sampleType,this.format=t.format,this.immutableSamplers=t.immutableSamplers.slice(),this}}class k_{constructor(t=[]){this.bindings=t}copy(t){return Zu(this.bindings,t.bindings,L_),this}}class z_{constructor(t=null){this.layout=t}copy(t){return this.layout=t.layout,this}}class U_{constructor(t=[]){this.setLayouts=t}copy(t){return this.setLayouts=t.setLayouts.slice(),this}}class V_{constructor(t=[]){this.attributes=t}copy(t){return Zu(this.attributes,t.attributes,x_),this}}class j_{constructor(t=null,e=0){this.queue=t,this.type=e}copy(t){return this.queue=t.queue,this.type=t.type,this}}class H_{constructor(t=0){this.type=t}copy(t){return this.type=t.type,this}}class G_{constructor(t=0,e=32767,i=!0){this.type=t,this.maxQueryObjects=e,this.forceWait=i}copy(t){return this.type=t.type,this.maxQueryObjects=t.maxQueryObjects,this.forceWait=t.forceWait,this}}class W_{constructor(t="",e=0,i=0,s=0,r=!1,n=!1,o=!1,a=!1){this.name=t,this.size=e,this.count=i,this.type=s,this.hasAlpha=r,this.hasDepth=n,this.hasStencil=o,this.isCompressed=a}copy(t){return this.name=t.name,this.size=t.size,this.count=t.count,this.type=t.type,this.hasAlpha=t.hasAlpha,this.hasDepth=t.hasDepth,this.hasStencil=t.hasStencil,this.isCompressed=t.isCompressed,this}}class X_{constructor(t=0,e=0){this.bufferSize=t,this.textureSize=e}copy(t){return this.bufferSize=t.bufferSize,this.textureSize=t.textureSize,this}}class Y_{constructor(t=0,e=0,i=0){this.writeMask=t,this.compareMask=e,this.reference=i}copy(t){return this.writeMask=t.writeMask,this.compareMask=t.compareMask,this.reference=t.reference,this}}class q_{constructor(t=new e_,e=new qd,i=new i_,s=1,r=0,n=0,o=0,a=0,h=0,l=new Y_,c=new Y_){this.viewport=t,this.scissor=e,this.blendConstant=i,this.lineWidth=s,this.depthBiasConstant=r,this.depthBiasClamp=n,this.depthBiasSlope=o,this.depthMinBounds=a,this.depthMaxBounds=h,this.stencilStatesFront=l,this.stencilStatesBack=c}copy(t){return this.viewport.copy(t.viewport),this.scissor.copy(t.scissor),this.blendConstant.copy(t.blendConstant),this.lineWidth=t.lineWidth,this.depthBiasConstant=t.depthBiasConstant,this.depthBiasClamp=t.depthBiasClamp,this.depthBiasSlope=t.depthBiasSlope,this.depthMinBounds=t.depthMinBounds,this.depthMaxBounds=t.depthMaxBounds,this.stencilStatesFront.copy(t.stencilStatesFront),this.stencilStatesBack.copy(t.stencilStatesBack),this}}class $_ extends Yu{get objectType(){return this._objectType}get objectID(){return this._objectID}get typedID(){return this._typedID}constructor(t){super(),this._objectType=0,this._objectID=0,this._typedID=0,this._objectType=t,this._objectID=$_._idTable[0]++,this._typedID=$_._idTable[t]++}}$_._idTable=Array(19).fill(65536);const K_={ATTR_POSITION:"a_position",ATTR_NORMAL:"a_normal",ATTR_TANGENT:"a_tangent",ATTR_BITANGENT:"a_bitangent",ATTR_WEIGHTS:"a_weights",ATTR_JOINTS:"a_joints",ATTR_COLOR:"a_color",ATTR_COLOR1:"a_color1",ATTR_COLOR2:"a_color2",ATTR_TEX_COORD:"a_texCoord",ATTR_TEX_COORD1:"a_texCoord1",ATTR_TEX_COORD2:"a_texCoord2",ATTR_TEX_COORD3:"a_texCoord3",ATTR_TEX_COORD4:"a_texCoord4",ATTR_TEX_COORD5:"a_texCoord5",ATTR_TEX_COORD6:"a_texCoord6",ATTR_TEX_COORD7:"a_texCoord7",ATTR_TEX_COORD8:"a_texCoord8",ATTR_BATCH_ID:"a_batch_id",ATTR_BATCH_UV:"a_batch_uv"};function Z_(t,e,i,s,r,n,o,a){return new W_(t,e,i,s,r,n,o,a)}function Q_(t){return new W_(`ASTC_SRGBA_${t}`,1,4,1,!0,!1,!1,!0)}function J_(t){return new W_(`ASTC_RGBA_${t}`,1,4,1,!0,!1,!1,!0)}const tp=Object.freeze([Z_("UNKNOWN"),Z_("A8",1,1,1,!0),Z_("L8",1,1,1),Z_("LA8",1,2,1,!0),Z_("R8",1,1,1),Z_("R8SN",1,1,2),Z_("R8UI",1,1,3),Z_("R8I",1,1,4),Z_("R16F",2,1,6),Z_("R16UI",2,1,3),Z_("R16I",2,1,4),Z_("R32F",4,1,6),Z_("R32UI",4,1,3),Z_("R32I",4,1,4),Z_("RG8",2,2,1),Z_("RG8SN",2,2,2),Z_("RG8UI",2,2,3),Z_("RG8I",2,2,4),Z_("RG16F",4,2,6),Z_("RG16UI",4,2,3),Z_("RG16I",4,2,4),Z_("RG32F",8,2,6),Z_("RG32UI",8,2,3),Z_("RG32I",8,2,4),Z_("RGB8",3,3,1),Z_("SRGB8",3,3,1),Z_("RGB8SN",3,3,2),Z_("RGB8UI",3,3,3),Z_("RGB8I",3,3,4),Z_("RGB16F",6,3,6),Z_("RGB16UI",6,3,3),Z_("RGB16I",6,3,4),Z_("RGB32F",12,3,6),Z_("RGB32UI",12,3,3),Z_("RGB32I",12,3,4),Z_("RGBA8",4,4,1,!0),Z_("BGRA8",4,4,1,!0),Z_("SRGB8_A8",4,4,1,!0),Z_("RGBA8SN",4,4,2,!0),Z_("RGBA8UI",4,4,3,!0),Z_("RGBA8I",4,4,4,!0),Z_("RGBA16F",8,4,6,!0),Z_("RGBA16UI",8,4,3,!0),Z_("RGBA16I",8,4,4,!0),Z_("RGBA32F",16,4,6,!0),Z_("RGBA32UI",16,4,3,!0),Z_("RGBA32I",16,4,4,!0),Z_("R5G6B5",2,3,1),Z_("R11G11B10F",4,3,6),Z_("RGB5A1",2,4,1,!0),Z_("RGBA4",2,4,1,!0),Z_("RGB10A2",2,4,1,!0),Z_("RGB10A2UI",2,4,3,!0),Z_("RGB9E5",2,4,6,!0),Z_("DEPTH",4,1,6,!1,!0),Z_("DEPTH_STENCIL",5,2,6,!1,!0,!0),Z_("BC1",1,3,1,!1,!1,!1,!0),Z_("BC1_ALPHA",1,4,1,!0,!1,!1,!0),Z_("BC1_SRGB",1,3,1,!1,!1,!1,!0),Z_("BC1_SRGB_ALPHA",1,4,1,!0,!1,!1,!0),Z_("BC2",1,4,1,!0,!1,!1,!0),Z_("BC2_SRGB",1,4,1,!0,!1,!1,!0),Z_("BC3",1,4,1,!0,!1,!1,!0),Z_("BC3_SRGB",1,4,1,!0,!1,!1,!0),Z_("BC4",1,1,1,!1,!1,!1,!0),Z_("BC4_SNORM",1,1,2,!1,!1,!1,!0),Z_("BC5",1,2,1,!1,!1,!1,!0),Z_("BC5_SNORM",1,2,2,!1,!1,!1,!0),Z_("BC6H_UF16",1,3,5,!1,!1,!1,!0),Z_("BC6H_SF16",1,3,6,!1,!1,!1,!0),Z_("BC7",1,4,1,!0,!1,!1,!0),Z_("BC7_SRGB",1,4,1,!0,!1,!1,!0),Z_("ETC_RGB8",1,3,1,!1,!1,!1,!0),Z_("ETC2_RGB8",1,3,1,!1,!1,!1,!0),Z_("ETC2_SRGB8",1,3,1,!1,!1,!1,!0),Z_("ETC2_RGB8_A1",1,4,1,!0,!1,!1,!0),Z_("ETC2_SRGB8_A1",1,4,1,!0,!1,!1,!0),Z_("ETC2_RGBA8",2,4,1,!0,!1,!1,!0),Z_("ETC2_SRGB8_A8",2,4,1,!0,!1,!1,!0),Z_("EAC_R11",1,1,1,!1,!1,!1,!0),Z_("EAC_R11SN",1,1,2,!1,!1,!1,!0),Z_("EAC_RG11",2,2,1,!1,!1,!1,!0),Z_("EAC_RG11SN",2,2,2,!1,!1,!1,!0),Z_("PVRTC_RGB2",2,3,1,!1,!1,!1,!0),Z_("PVRTC_RGBA2",2,4,1,!0,!1,!1,!0),Z_("PVRTC_RGB4",2,3,1,!1,!1,!1,!0),Z_("PVRTC_RGBA4",2,4,1,!0,!1,!1,!0),Z_("PVRTC2_2BPP",2,4,1,!0,!1,!1,!0),Z_("PVRTC2_4BPP",2,4,1,!0,!1,!1,!0),J_("4x4"),J_("5x4"),J_("5x5"),J_("6x5"),J_("6x6"),J_("8x5"),J_("8x6"),J_("8x8"),J_("10x5"),J_("10x6"),J_("10x8"),J_("10x10"),J_("12x10"),J_("12x12"),Q_("4x4"),Q_("5x4"),Q_("5x5"),Q_("6x5"),Q_("6x6"),Q_("8x5"),Q_("8x6"),Q_("8x8"),Q_("10x5"),Q_("10x6"),Q_("10x8"),Q_("10x10"),Q_("12x10"),Q_("12x12")]);function ep(t){return t>0&&!(t&t-1)}const ip=Math.ceil;function sp(t,e,i,s){if(!tp[t].isCompressed)return e*i*s*tp[t].size;switch(t){case 56:case 57:case 58:case 59:case 72:case 73:case 74:case 75:case 79:case 80:case 85:case 86:case 88:return ip(e/4)*ip(i/4)*8*s;case 60:case 61:case 62:case 63:case 64:case 65:case 69:case 68:case 70:case 71:case 77:case 76:case 81:case 82:case 89:case 103:return ip(e/4)*ip(i/4)*16*s;case 66:case 67:return ip(e/4)*ip(i/4)*32*s;case 83:case 84:case 87:return ip(e/8)*ip(i/4)*8*s;case 90:case 104:return ip(e/5)*ip(i/4)*16*s;case 91:case 105:return ip(e/5)*ip(i/5)*16*s;case 92:case 106:return ip(e/6)*ip(i/5)*16*s;case 93:case 107:return ip(e/6)*ip(i/6)*16*s;case 94:case 108:return ip(e/8)*ip(i/5)*16*s;case 95:case 109:return ip(e/8)*ip(i/6)*16*s;case 96:case 110:return ip(e/8)*ip(i/8)*16*s;case 97:case 111:return ip(e/10)*ip(i/5)*16*s;case 98:case 112:return ip(e/10)*ip(i/6)*16*s;case 99:case 113:return ip(e/10)*ip(i/8)*16*s;case 100:case 114:return ip(e/10)*ip(i/10)*16*s;case 101:case 115:return ip(e/12)*ip(i/10)*16*s;case 102:case 116:return ip(e/12)*ip(i/12)*16*s;default:return 0}}function rp(t,e,i,s,r){let n=0;for(let o=0;o<r;++o)n+=sp(t,e,i,s),e=Math.max(e>>1,1),i=Math.max(i>>1,1);return n}const np=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function op(t){return np[t]||0}function ap(t){if(t.isCompressed)return Uint8Array;const e=t.size/t.count;switch(t.type){case 1:case 3:switch(e){case 1:default:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}case 2:case 4:switch(e){case 1:default:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}case 6:return 2===e?Uint16Array:Float32Array}return Float32Array}function hp(t){switch(t){case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 65:case 69:case 68:case 70:case 71:case 66:case 67:case 72:case 73:case 74:case 75:case 79:case 80:case 77:case 76:case 81:case 82:case 85:case 86:case 88:case 89:case 103:return{width:4,height:4};case 83:case 84:case 87:return{width:8,height:4};case 90:case 104:return{width:5,height:4};case 91:case 105:return{width:5,height:5};case 92:case 106:return{width:6,height:5};case 93:case 107:return{width:6,height:6};case 94:case 108:return{width:8,height:5};case 95:case 109:return{width:8,height:6};case 96:case 110:return{width:8,height:8};case 97:case 111:return{width:10,height:5};case 98:case 112:return{width:10,height:6};case 99:case 113:return{width:10,height:8};case 100:case 114:return{width:10,height:10};case 101:case 115:return{width:12,height:10};case 102:case 116:return{width:12,height:12};default:return{width:1,height:1}}}function lp(t,e){return ip(t/e)*e}var cp=Object.freeze({__proto__:null,API:td,AccessFlagBit:Ed,Address:bd,Attribute:x_,AttributeName:K_,BarrierType:jd,BindingMappingInfo:r_,BlendFactor:Td,BlendOp:wd,BufferBarrierInfo:F_,BufferFlagBit:hd,BufferInfo:a_,BufferTextureCopy:t_,BufferUsageBit:ad,BufferViewInfo:h_,ClearFlagBit:Vd,Color:i_,ColorAttachment:D_,ColorMask:xd,CommandBufferInfo:j_,CommandBufferType:Ud,ComparisonFunc:vd,CullMode:Bd,DESCRIPTOR_BUFFER_TYPE:15,DESCRIPTOR_DYNAMIC_TYPE:10,DESCRIPTOR_SAMPLER_TYPE:496,DESCRIPTOR_STORAGE_BUFFER_TYPE:12,DRAW_INFO_SIZE:28,DepthStencilAttachment:E_,DescriptorSetInfo:z_,DescriptorSetLayoutBinding:L_,DescriptorSetLayoutInfo:k_,DescriptorType:Ld,DeviceCaps:Wd,DeviceInfo:o_,DeviceOptions:Xd,DispatchInfo:c_,DrawInfo:l_,DynamicStateFlagBit:Fd,DynamicStates:q_,DynamicStencilStates:Y_,Extent:$d,Feature:id,Filter:yd,Format:sd,FormatFeatureBit:md,FormatInfo:W_,FormatInfos:tp,FormatSize:sp,FormatSurfaceSize:rp,FormatType:rd,FramebufferInfo:N_,GFXObject:$_,GeneralBarrierInfo:R_,GetTypeSize:op,IndirectBuffer:u_,InputAssemblerInfo:A_,InputState:V_,IsPowerOf2:ep,LoadOp:Ad,MarkerInfo:s_,MemoryAccessBit:ld,MemoryStatus:X_,MemoryUsageBit:cd,ObjectType:Qu,Offset:Yd,PassType:Hd,PipelineBindPoint:Md,PipelineLayoutInfo:U_,PolygonMode:Od,PrimitiveMode:Pd,QueryPoolInfo:G_,QueryType:zd,QueueInfo:H_,QueueType:kd,Rect:qd,RenderPassInfo:P_,ResolveMode:Id,ResourceRange:O_,SampleCount:gd,SampleType:nd,SamplerInfo:p_,ShadeModel:Rd,ShaderInfo:C_,ShaderStage:w_,ShaderStageFlagBit:Cd,Size:Gd,Status:Ju,StencilFace:Nd,StencilOp:Sd,StoreOp:Dd,SubpassDependency:M_,SubpassInfo:I_,SurfaceTransform:ed,SwapchainInfo:n_,TextureBarrierInfo:B_,TextureBlit:Jd,TextureCopy:Qd,TextureFlagBit:pd,TextureInfo:d_,TextureSubresLayers:Kd,TextureSubresRange:Zd,TextureType:ud,TextureUsageBit:_d,TextureViewInfo:__,Type:od,Uniform:m_,UniformBlock:g_,UniformInputAttachment:T_,UniformSampler:y_,UniformSamplerTexture:f_,UniformStorageBuffer:S_,UniformStorageImage:v_,UniformTexture:b_,ViewDimension:dd,Viewport:e_,VsyncMode:fd,alignTo:lp,formatAlignment:hp,getTypedArrayConstructor:ap});function up(t,e,i,s,r){for(let n=0,o=e.length;n<o;n++){let o=e[n],a=o[i][s]||o[i];o[i]=new Proxy(a,{get:(t,e)=>e===s?t:Reflect.get(t,e),set:(e,i,s)=>(Reflect.set(e,i,s),r(t,n,e,i,s),!0)})}}class dp{constructor(t=!1,e=Od.FILL,i=Rd.GOURAND,s=Bd.BACK,r=!0,n=!1,o=0,a=0,h=0,l=!0,c=!1,u=1){this._nativeObj=void 0,this._isDiscard=!1,this._polygonMode=Od.FILL,this._shadeModel=Rd.GOURAND,this._cullMode=Bd.BACK,this._isFrontFaceCCW=!0,this._depthBiasEnabled=!1,this._depthBias=0,this._depthBiasClamp=0,this._depthBiasSlop=0,this._isDepthClip=!0,this._isMultisample=!1,this._lineWidth=1,this._nativeObj=new gfx.RasterizerState,this.assignProperties(t,e,i,s,r,n,o,a,h,l,c,u)}get native(){return this._nativeObj}get isDiscard(){return this._isDiscard}set isDiscard(t){this._isDiscard=t,this._nativeObj.isDiscard=t}get polygonMode(){return this._polygonMode}set polygonMode(t){this._polygonMode=t,this._nativeObj.polygonMode=t}get shadeModel(){return this._shadeModel}set shadeModel(t){this._shadeModel=t,this._nativeObj.shadeModel=t}get cullMode(){return this._cullMode}set cullMode(t){this._cullMode=t,this._nativeObj.cullMode=t}get isFrontFaceCCW(){return this._isFrontFaceCCW}set isFrontFaceCCW(t){this._isFrontFaceCCW=t,this._nativeObj.isFrontFaceCCW=t}get depthBiasEnabled(){return this._depthBiasEnabled}set depthBiasEnabled(t){this._depthBiasEnabled=t,this._nativeObj.depthBiasEnabled=t}get depthBias(){return this._depthBias}set depthBias(t){this._depthBias=t,this._nativeObj.depthBias=t}get depthBiasClamp(){return this._depthBiasClamp}set depthBiasClamp(t){this._depthBiasClamp=t,this._nativeObj.depthBiasClamp=t}get depthBiasSlop(){return this._depthBiasSlop}set depthBiasSlop(t){this._depthBiasSlop=t,this._nativeObj.depthBiasSlop=t}get isDepthClip(){return this._isDepthClip}set isDepthClip(t){this._isDepthClip=t,this._nativeObj.isDepthClip=t}get isMultisample(){return this._isMultisample}set isMultisample(t){this._isMultisample=t,this._nativeObj.isMultisample=t}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this._nativeObj.lineWidth=t}reset(){this.assignProperties(!1,Od.FILL,Rd.GOURAND,Bd.BACK,!0,!1,0,0,0,!0,!1,1)}assign(t){t&&this.assignProperties(t.isDiscard,t.polygonMode,t.shadeModel,t.cullMode,t.isFrontFaceCCW,t.depthBiasEnabled,t.depthBias,t.depthBiasClamp,t.depthBiasSlop,t.isDepthClip,t.isMultisample,t.lineWidth)}destroy(){this._nativeObj=null}assignProperties(t,e,i,s,r,n,o,a,h,l,c,u){void 0!==t&&(this.isDiscard=t),void 0!==e&&(this.polygonMode=e),void 0!==i&&(this.shadeModel=i),void 0!==s&&(this.cullMode=s),void 0!==r&&(this.isFrontFaceCCW=r),void 0!==n&&(this.depthBiasEnabled=n),void 0!==o&&(this.depthBias=o),void 0!==a&&(this.depthBiasClamp=a),void 0!==h&&(this.depthBiasSlop=h),void 0!==l&&(this.isDepthClip=l),void 0!==c&&(this.isMultisample=c),void 0!==u&&(this.lineWidth=u)}}class _p{constructor(t=!0,e=!0,i=vd.LESS,s=!1,r=vd.ALWAYS,n=65535,o=65535,a=Sd.KEEP,h=Sd.KEEP,l=Sd.KEEP,c=1,u=!1,d=vd.ALWAYS,_=65535,p=65535,m=Sd.KEEP,g=Sd.KEEP,f=Sd.KEEP,y=1){this._nativeObj=void 0,this._depthTest=!0,this._depthWrite=!0,this._depthFunc=vd.LESS,this._stencilTestFront=!1,this._stencilFuncFront=vd.ALWAYS,this._stencilReadMaskFront=65535,this._stencilWriteMaskFront=65535,this._stencilFailOpFront=Sd.KEEP,this._stencilZFailOpFront=Sd.KEEP,this._stencilPassOpFront=Sd.KEEP,this._stencilRefFront=1,this._stencilTestBack=!1,this._stencilFuncBack=vd.ALWAYS,this._stencilReadMaskBack=65535,this._stencilWriteMaskBack=65535,this._stencilFailOpBack=Sd.KEEP,this._stencilZFailOpBack=Sd.KEEP,this._stencilPassOpBack=Sd.KEEP,this._stencilRefBack=1,this._nativeObj=new gfx.DepthStencilState,this.assignProperties(t,e,i,s,r,n,o,a,h,l,c,u,d,_,p,m,g,f,y)}get native(){return this._nativeObj}get depthTest(){return this._depthTest}set depthTest(t){this._depthTest=t,this._nativeObj.depthTest=t}get depthWrite(){return this._depthWrite}set depthWrite(t){this._depthWrite=t,this._nativeObj.depthWrite=t}get depthFunc(){return this._depthFunc}set depthFunc(t){this._depthFunc=t,this._nativeObj.depthFunc=t}get stencilTestFront(){return this._stencilTestFront}set stencilTestFront(t){this._stencilTestFront=t,this._nativeObj.stencilTestFront=t}get stencilFuncFront(){return this._stencilFuncFront}set stencilFuncFront(t){this._stencilFuncFront=t,this._nativeObj.stencilFuncFront=t}get stencilReadMaskFront(){return this._stencilReadMaskFront}set stencilReadMaskFront(t){this._stencilReadMaskFront=t,this._nativeObj.stencilReadMaskFront=t}get stencilWriteMaskFront(){return this._stencilWriteMaskFront}set stencilWriteMaskFront(t){this._stencilWriteMaskFront=t,this._nativeObj.stencilWriteMaskFront=t}get stencilFailOpFront(){return this._stencilFailOpFront}set stencilFailOpFront(t){this._stencilFailOpFront=t,this._nativeObj.stencilFailOpFront=t}get stencilZFailOpFront(){return this._stencilZFailOpFront}set stencilZFailOpFront(t){this._stencilZFailOpFront=t,this._nativeObj.stencilZFailOpFront=t}get stencilPassOpFront(){return this._stencilPassOpFront}set stencilPassOpFront(t){this._stencilPassOpFront=t,this._nativeObj.stencilPassOpFront=t}get stencilRefFront(){return this._stencilRefFront}set stencilRefFront(t){this._stencilRefFront=t,this._nativeObj.stencilRefFront=t}get stencilTestBack(){return this._stencilTestBack}set stencilTestBack(t){this._stencilTestBack=t,this._nativeObj.stencilTestBack=t}get stencilFuncBack(){return this._stencilFuncBack}set stencilFuncBack(t){this._stencilFuncBack=t,this._nativeObj.stencilFuncBack=t}get stencilReadMaskBack(){return this._stencilReadMaskBack}set stencilReadMaskBack(t){this._stencilReadMaskBack=t,this._nativeObj.stencilReadMaskBack=t}get stencilWriteMaskBack(){return this._stencilWriteMaskBack}set stencilWriteMaskBack(t){this._stencilWriteMaskBack=t,this._nativeObj.stencilWriteMaskBack=t}get stencilFailOpBack(){return this._stencilFailOpBack}set stencilFailOpBack(t){this._stencilFailOpBack=t,this._nativeObj.stencilFailOpBack=t}get stencilZFailOpBack(){return this._stencilZFailOpBack}set stencilZFailOpBack(t){this._stencilZFailOpBack=t,this._nativeObj.stencilZFailOpBack=t}get stencilPassOpBack(){return this._stencilPassOpBack}set stencilPassOpBack(t){this._stencilPassOpBack=t,this._nativeObj.stencilPassOpBack=t}get stencilRefBack(){return this._stencilRefBack}set stencilRefBack(t){this._stencilRefBack=t,this._nativeObj.stencilRefBack=t}reset(){this.assignProperties(!0,!0,vd.LESS,!1,vd.ALWAYS,65535,65535,Sd.KEEP,Sd.KEEP,Sd.KEEP,1,!1,vd.ALWAYS,65535,65535,Sd.KEEP,Sd.KEEP,Sd.KEEP,1)}assign(t){t&&this.assignProperties(t.depthTest,t.depthWrite,t.depthFunc,t.stencilTestFront,t.stencilFuncFront,t.stencilReadMaskFront,t.stencilWriteMaskFront,t.stencilFailOpFront,t.stencilZFailOpFront,t.stencilPassOpFront,t.stencilRefFront,t.stencilTestBack,t.stencilFuncBack,t.stencilReadMaskBack,t.stencilWriteMaskBack,t.stencilFailOpBack,t.stencilZFailOpBack,t.stencilPassOpBack,t.stencilRefBack)}destroy(){this._nativeObj=null}assignProperties(t,e,i,s,r,n,o,a,h,l,c,u,d,_,p,m,g,f,y){void 0!==t&&(this.depthTest=t),void 0!==e&&(this.depthWrite=e),void 0!==i&&(this.depthFunc=i),void 0!==s&&(this.stencilTestFront=s),void 0!==r&&(this.stencilFuncFront=r),void 0!==n&&(this.stencilReadMaskFront=n),void 0!==o&&(this.stencilWriteMaskFront=o),void 0!==a&&(this.stencilFailOpFront=a),void 0!==h&&(this.stencilZFailOpFront=h),void 0!==l&&(this.stencilPassOpFront=l),void 0!==c&&(this.stencilRefFront=c),void 0!==u&&(this.stencilTestBack=u),void 0!==d&&(this.stencilFuncBack=d),void 0!==_&&(this.stencilReadMaskBack=_),void 0!==p&&(this.stencilWriteMaskBack=p),void 0!==m&&(this.stencilFailOpBack=m),void 0!==g&&(this.stencilZFailOpBack=g),void 0!==f&&(this.stencilPassOpBack=f),void 0!==y&&(this.stencilRefBack=y)}}class pp{get native(){return this._nativeObj}constructor(t=!1,e=Td.ONE,i=Td.ZERO,s=wd.ADD,r=Td.ONE,n=Td.ZERO,o=wd.ADD,a=xd.ALL){this._nativeObj=void 0,this._blend=!1,this._blendSrc=Td.ONE,this._blendDst=Td.ZERO,this._blendEq=wd.ADD,this._blendSrcAlpha=Td.ONE,this._blendDstAlpha=Td.ZERO,this._blendAlphaEq=wd.ADD,this._blendColorMask=xd.ALL,this._nativeObj=new gfx.BlendTarget,this.assignProperties(t,e,i,s,r,n,o,a)}get blend(){return this._blend}set blend(t){this._blend=t,this._nativeObj.blend=t}get blendSrc(){return this._blendSrc}set blendSrc(t){this._blendSrc=t,this._nativeObj.blendSrc=t}get blendDst(){return this._blendDst}set blendDst(t){this._blendDst=t,this._nativeObj.blendDst=t}get blendEq(){return this._blendEq}set blendEq(t){this._blendEq=t,this._nativeObj.blendEq=t}get blendSrcAlpha(){return this._blendSrcAlpha}set blendSrcAlpha(t){this._blendSrcAlpha=t,this._nativeObj.blendSrcAlpha=t}get blendDstAlpha(){return this._blendDstAlpha}set blendDstAlpha(t){this._blendDstAlpha=t,this._nativeObj.blendDstAlpha=t}get blendAlphaEq(){return this._blendAlphaEq}set blendAlphaEq(t){this._blendAlphaEq=t,this._nativeObj.blendAlphaEq=t}get blendColorMask(){return this._blendColorMask}set blendColorMask(t){this._blendColorMask=t,this._nativeObj.blendColorMask=t}reset(){this.assignProperties(!1,Td.ONE,Td.ZERO,wd.ADD,Td.ONE,Td.ZERO,wd.ADD,xd.ALL)}destroy(){this._nativeObj=null}assign(t){t&&this.assignProperties(t.blend,t.blendSrc,t.blendDst,t.blendEq,t.blendSrcAlpha,t.blendDstAlpha,t.blendAlphaEq,t.blendColorMask)}assignProperties(t,e,i,s,r,n,o,a){void 0!==t&&(this.blend=t),void 0!==e&&(this.blendSrc=e),void 0!==i&&(this.blendDst=i),void 0!==s&&(this.blendEq=s),void 0!==r&&(this.blendSrcAlpha=r),void 0!==n&&(this.blendDstAlpha=n),void 0!==o&&(this.blendAlphaEq=o),void 0!==a&&(this.blendColorMask=a)}}class mp{_setTargets(t){this.targets=t;const e="$__nativeObj";this._syncTargetsToNativeObj(e),up(this,this.targets,"_nativeObj",e,(t=>{t._syncTargetsToNativeObj(e)}))}_syncTargetsToNativeObj(t){const e=this.targets.map((e=>e.native[t]||e.native));this._nativeObj.targets=e}get native(){return this._nativeObj}constructor(t=!1,e=!1,i=new i_,s=[new pp]){this.targets=void 0,this._blendColor=void 0,this._nativeObj=void 0,this._isA2C=!1,this._isIndepend=!1,this._nativeObj=new gfx.BlendState,this._setTargets(s),this.blendColor=i,this.isA2C=t,this.isIndepend=e}get isA2C(){return this._isA2C}set isA2C(t){this._isA2C=t,this._nativeObj.isA2C=t}get isIndepend(){return this._isIndepend}set isIndepend(t){this._isIndepend=t,this._nativeObj.isIndepend=t}get blendColor(){return this._blendColor}set blendColor(t){this._blendColor=t,this._nativeObj.blendColor=t}setTarget(t,e){let i=this.targets[t];i||(i=this.targets[t]=new pp),i.assign(e),this._setTargets(this.targets)}reset(){this.isA2C=!1,this.isIndepend=!1,this.blendColor=new i_(0,0,0,0);const t=this.targets;for(let e=1,i=t.length;e<i;++e)t[e].destroy();t.length=1,t[0].reset(),this._setTargets(t)}destroy(){for(let t=0,e=this.targets.length;t<e;++t)this.targets[t].destroy();this.targets=null,this._nativeObj=null}}gfx.PipelineState;const gp=gfx.PipelineStateInfo;class fp{constructor(){this.initialized=!1,this._gfxDevice=void 0,this._canvas=null,this._swapchain=void 0,this._renderType=-1,this._deviceInitialized=!1}get gfxDevice(){return this._gfxDevice}get swapchain(){return this._swapchain}_tryInitializeWebGPUDevice(t,e){return this._deviceInitialized?Promise.resolve(!0):t?(this._gfxDevice=new t,new Promise(((t,i)=>{this._gfxDevice.initialize(e).then((e=>{this._deviceInitialized=e,t(e)})).catch((t=>{i(t)}))}))):Promise.resolve(!1)}_tryInitializeDeviceSync(t,e){return!!this._deviceInitialized||(t&&(this._gfxDevice=new t,this._deviceInitialized=this._gfxDevice.initialize(e)),this._deviceInitialized)}init(t,e){if(this.initialized)return!0;const i=Se.querySettings(ve.Category.RENDERING,"renderMode");this._canvas=t,this._canvas&&(this._canvas.oncontextmenu=()=>!1),this._renderType=this._determineRenderType(i),this._deviceInitialized=!1;const s=new o_(e);if(1===this._renderType||2===this._renderType)if(globalThis.gfx)this._gfxDevice=gfx.DeviceManager.create(s);else{let t=!!globalThis.WebGL2RenderingContext;if(globalThis.navigator.userAgent.toLowerCase(),ga.browserType===Vo.UC&&(t=!1),2===this._renderType&&a.WebGPUDevice)return new Promise(((t,e)=>{this._tryInitializeWebGPUDevice(a.WebGPUDevice,s).then((e=>{this._initSwapchain(),t(e)})).catch((t=>{e(t)}))}));t&&a.WebGL2Device&&this._tryInitializeDeviceSync(a.WebGL2Device,s),a.WebGLDevice&&this._tryInitializeDeviceSync(a.WebGLDevice,s),a.EmptyDevice&&this._tryInitializeDeviceSync(a.EmptyDevice,s),this._initSwapchain()}else 4===this._renderType&&a.EmptyDevice&&(this._tryInitializeDeviceSync(a.EmptyDevice,s),this._initSwapchain());return!!this._gfxDevice||(G(16337),this._renderType=-1,!1)}_initSwapchain(){const t=new n_(1,this._canvas),e=ma.windowSize;t.width=e.width,t.height=e.height,this._swapchain=this._gfxDevice.createSwapchain(t)}_supportWebGPU(){return"gpu"in globalThis.navigator}_determineRenderType(t){("number"!=typeof t||t>4||t<0)&&(t=0);let e=0,i=!1;if(1===t?(e=0,i=!0):0===t||4===t?(e=this._supportWebGPU()?2:1,i=!0):2===t?(e=1,i=!0):3===t&&(e=4,i=!0),!i)throw new Error(q(3820,t));return e}}const yp=new fp,bp={GFXDevice:!0,GFXBuffer:!0,GFXTexture:!0,GFXSampler:!0,GFXShader:!0,GFXInputAssembler:!0,GFXRenderPass:!0,GFXFramebuffer:!0,GFXPipelineState:!0,GFXCommandBuffer:!0,GFXQueue:!0,GFXObjectType:!0,GFXObject:!1,GFXAttributeName:!0,GFXType:!0,GFXFormat:!0,GFXBufferUsageBit:!0,GFXMemoryUsageBit:!0,GFXBufferFlagBit:!0,GFXBufferAccessBit:"MemoryAccessBit",GFXPrimitiveMode:!0,GFXPolygonMode:!0,GFXShadeModel:!0,GFXCullMode:!0,GFXComparisonFunc:!0,GFXStencilOp:!0,GFXBlendOp:!0,GFXBlendFactor:!0,GFXColorMask:!0,GFXFilter:!0,GFXAddress:!0,GFXTextureType:!0,GFXTextureUsageBit:!0,GFXSampleCount:!0,GFXTextureFlagBit:!0,GFXShaderStageFlagBit:!0,GFXDescriptorType:!0,GFXCommandBufferType:!0,GFXLoadOp:!0,GFXStoreOp:!0,GFXPipelineBindPoint:!0,GFXDynamicStateFlagBit:!0,GFXStencilFace:!0,GFXQueueType:!0,GFXRect:!0,GFXViewport:!0,GFXColor:!0,GFXClearFlag:!0,GFXOffset:!0,GFXExtent:!0,GFXTextureSubres:"TextureSubresLayers",GFXTextureCopy:!0,GFXBufferTextureCopy:!0,GFXFormatType:!0,GFXFormatInfo:!0,GFXMemoryStatus:!0,GFXFormatInfos:!0,GFXFormatSize:!0,GFXFormatSurfaceSize:!0,GFXGetTypeSize:!0,getTypedArrayConstructor:!1};for(const t in bp){let e=bp[t];!0===e?e=t.slice(3):!1===e&&(e=t),Q(a,"cc",[{name:t,newName:e,target:a.gfx,targetName:"cc.gfx"}])}J(a,"cc",[{name:"GFX_MAX_VERTEX_ATTRIBUTES"},{name:"GFX_MAX_TEXTURE_UNITS"},{name:"GFX_MAX_ATTACHMENTS"},{name:"GFX_MAX_BUFFER_BINDINGS"},{name:"GFXTextureLayout"}]);const vp=gfx.DescriptorSet,Sp=gfx.Buffer,Tp=gfx.CommandBuffer,wp=gfx.Device,xp=gfx.Swapchain,Cp=gfx.Framebuffer,Ap=gfx.InputAssembler,Dp=gfx.DescriptorSetLayout,Ep=gfx.PipelineLayout,Ip=gfx.PipelineState,Mp=gfx.Queue,Pp=gfx.RenderPass,Op=gfx.Shader,Rp=gfx.Texture,Bp=gfx.Sampler,Fp=gfx.GeneralBarrier,Np=gfx.TextureBarrier,Lp=Object.assign({},cp);Lp.GFXObject=gfx.GFXObject,Lp.Device=gfx.Device,Lp.Swapchain=gfx.Swapchain,Lp.Buffer=gfx.Buffer,Lp.Texture=gfx.Texture,Lp.Sampler=gfx.Sampler,Lp.Shader=gfx.Shader,Lp.InputAssembler=gfx.InputAssembler,Lp.RenderPass=gfx.RenderPass,Lp.Framebuffer=gfx.Framebuffer,Lp.DescriptorSet=gfx.DescriptorSet,Lp.DescriptorSetLayout=gfx.DescriptorSetLayout,Lp.PipelineLayout=gfx.PipelineLayout,Lp.PipelineState=gfx.PipelineState,Lp.CommandBuffer=gfx.CommandBuffer,Lp.Queue=gfx.Queue,Lp.GeneralBarrier=gfx.GeneralBarrier,Lp.TextureBarrier=gfx.TextureBarrier,a.gfx=Lp,Lp.BlendTarget=pp,Lp.BlendState=mp,Lp.RasterizerState=dp,Lp.DepthStencilState=_p,Lp.PipelineStateInfo=gp,t("gfx",Object.freeze({__proto__:null,API:td,AccessFlagBit:Ed,Address:bd,Attribute:x_,AttributeName:K_,BarrierType:jd,BindingMappingInfo:r_,BlendFactor:Td,BlendOp:wd,BlendState:mp,BlendTarget:pp,Buffer:Sp,BufferBarrierInfo:F_,BufferFlagBit:hd,BufferInfo:a_,BufferTextureCopy:t_,BufferUsageBit:ad,BufferViewInfo:h_,ClearFlagBit:Vd,Color:i_,ColorAttachment:D_,ColorMask:xd,CommandBuffer:Tp,CommandBufferInfo:j_,CommandBufferType:Ud,ComparisonFunc:vd,CullMode:Bd,DESCRIPTOR_BUFFER_TYPE:15,DESCRIPTOR_DYNAMIC_TYPE:10,DESCRIPTOR_SAMPLER_TYPE:496,DESCRIPTOR_STORAGE_BUFFER_TYPE:12,DRAW_INFO_SIZE:28,DepthStencilAttachment:E_,DepthStencilState:_p,DescriptorSet:vp,DescriptorSetInfo:z_,DescriptorSetLayout:Dp,DescriptorSetLayoutBinding:L_,DescriptorSetLayoutInfo:k_,DescriptorType:Ld,Device:wp,DeviceCaps:Wd,DeviceInfo:o_,DeviceManager:fp,DeviceOptions:Xd,DispatchInfo:c_,DrawInfo:l_,DynamicStateFlagBit:Fd,DynamicStates:q_,DynamicStencilStates:Y_,Extent:$d,Feature:id,Filter:yd,Format:sd,FormatFeatureBit:md,FormatInfo:W_,FormatInfos:tp,FormatSize:sp,FormatSurfaceSize:rp,FormatType:rd,Framebuffer:Cp,FramebufferInfo:N_,GFXObject:$_,GeneralBarrier:Fp,GeneralBarrierInfo:R_,GetTypeSize:op,IndirectBuffer:u_,InputAssembler:Ap,InputAssemblerInfo:A_,InputState:V_,IsPowerOf2:ep,LegacyRenderMode:{AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,WEBGPU:4},LoadOp:Ad,MarkerInfo:s_,MemoryAccessBit:ld,MemoryStatus:X_,MemoryUsageBit:cd,ObjectType:Qu,Offset:Yd,PassType:Hd,PipelineBindPoint:Md,PipelineLayout:Ep,PipelineLayoutInfo:U_,PipelineState:Ip,PipelineStateInfo:gp,PolygonMode:Od,PrimitiveMode:Pd,QueryPoolInfo:G_,QueryType:zd,Queue:Mp,QueueInfo:H_,QueueType:kd,RasterizerState:dp,Rect:qd,RenderPass:Pp,RenderPassInfo:P_,RenderType:{UNKNOWN:-1,CANVAS:0,WEBGL:1,WEBGPU:2,OPENGL:3,HEADLESS:4},ResolveMode:Id,ResourceRange:O_,SampleCount:gd,SampleType:nd,Sampler:Bp,SamplerInfo:p_,ShadeModel:Rd,Shader:Op,ShaderInfo:C_,ShaderStage:w_,ShaderStageFlagBit:Cd,Size:Gd,Status:Ju,StencilFace:Nd,StencilOp:Sd,StoreOp:Dd,SubpassDependency:M_,SubpassInfo:I_,SurfaceTransform:ed,Swapchain:xp,SwapchainInfo:n_,Texture:Rp,TextureBarrier:Np,TextureBarrierInfo:B_,TextureBlit:Jd,TextureCopy:Qd,TextureFlagBit:pd,TextureInfo:d_,TextureSubresLayers:Kd,TextureSubresRange:Zd,TextureType:ud,TextureUsageBit:_d,TextureViewInfo:__,Type:od,Uniform:m_,UniformBlock:g_,UniformInputAttachment:T_,UniformSampler:y_,UniformSamplerTexture:f_,UniformStorageBuffer:S_,UniformStorageImage:v_,UniformTexture:b_,ViewDimension:dd,Viewport:e_,VsyncMode:fd,alignTo:lp,deviceManager:yp,formatAlignment:hp,getTypedArrayConstructor:ap}));const kp=new ms;function zp(t,e,i,s){if(!i)return;const r=i.chunk,n=i.data,o=r.vb,a=i.vertexCount,h=t.worldMatrix,l=h.m00,c=h.m01,u=h.m02,d=h.m03,_=h.m04,p=h.m05,m=h.m06,g=h.m07,f=h.m12,y=h.m13,b=h.m14,v=h.m15;kp.set(s.r/255,s.g/255,s.b/255,s.a/255);let S=0;for(let t=0;t<a;++t){const e=n[t],s=e.x,r=e.y;let a=d*s+g*r+v;a=a?1/a:1,o[S+0]=(l*s+_*r+f)*a,o[S+1]=(c*s+p*r+y)*a,o[S+2]=(u*s+m*r+b)*a,ms.toArray(o,kp,S+5),S+=i.floatStride}r.bufferId;const T=r.vertexOffset,w=r.meshBuffer,x=r.meshBuffer.iData;let C=w.indexOffset;for(let t=0,e=a/4;t<e;t++){const e=T+4*t;x[C++]=e,x[C++]=e+1,x[C++]=e+2,x[C++]=e+1,x[C++]=e+3,x[C++]=e+2}w.indexOffset+=i.indexCount,w.setDirty()}function Up(t,e){if(!t.chunk)return;const i=t.vertexFormat,s=t.chunk.vb;let r,n,o,a,h=0;for(let l=0;l<i.length;++l){if(n=i[l],o=tp[n.format],o.hasAlpha)if(a=t.floatStride,o.size/o.count==1){r||(r=new Uint32Array(s.buffer,s.byteOffset,s.length));const t=~~Ri(Math.round(255*e),0,255);for(let e=h;e<r.length;e+=a)r[e]=(16777215&r[e]|t<<24)>>>0}else if(o.size/o.count==4)for(let t=h+3;t<s.length;t+=a)s[t]=e;h+=o.size>>2}}class Vp{get map(){return this._map}constructor(t){this._map=null,this._count=0,t?(this._map=t,this._count=Object.keys(t).length):(this._map=wt(!0),this._count=0)}add(t,e){return t in this._map||this._count++,this._map[t]=e}get(t){return this._map[t]}has(t){return t in this._map}remove(t){const e=this._map[t];return t in this._map&&(delete this._map[t],this._count--),e}clear(){0!==this._count&&(this._map=wt(!0),this._count=0)}forEach(t){for(const e in this._map)t(this._map[e],e)}find(t){for(const e in this._map)if(t(this._map[e],e))return this._map[e];return null}get count(){return this._count}destroy(){this._map=null}}class jp{constructor(t,e){this.id=jp._pipelineId++,this.name="",this.pipes=[],this.name=t;for(let t=0,i=e.length;t<i;t++)this.pipes.push(e[t])}insert(t,e){return e>this.pipes.length?(j(4921),this):(this.pipes.splice(e,0,t),this)}append(t){return this.pipes.push(t),this}remove(t){return this.pipes.splice(t,1),this}sync(t){const e=this.pipes;if(0===e.length)return null;t.isFinished=!1;for(let i=0,s=e.length;i<s;){const r=(0,e[i])(t);if(r)return t.isFinished=!0,r;i++,i!==s&&(t.input=t.output,t.output=null)}return t.isFinished=!0,t.output}async(t){0!==this.pipes.length&&(t.isFinished=!1,this._flow(0,t))}_flow(t,e){(0,this.pipes[t])(e,(i=>{i?(e.isFinished=!0,e.dispatch("complete",i)):++t<this.pipes.length?(e.input=e.output,e.output=null,this._flow(t,e)):(e.isFinished=!0,e.dispatch("complete",i,e.output))}))}}jp._pipelineId=0;const Hp=new Vp,Gp=new Vp,Wp=new Vp,Xp=new Vp,Yp=new jp("normal load",[]),qp=new jp("fetch",[]),$p=new jp("transform url",[]),Kp=new Map,Zp={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}},Qp={INTERNAL:"internal",RESOURCES:"resources",MAIN:"main",START_SCENE:"start-scene"};class Jp{static create(t){let e;return 0!==Jp._deadPool.length?(e=Jp._deadPool.pop(),e.set(t)):e=new Jp(t),e}get isFinish(){return this.isFinished}set isFinish(t){this.isFinished=t}constructor(t){this.id=Jp._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinished=!0,this.set(t)}set(t=Object.create(null)){this.onComplete=t.onComplete||null,this.onProgress=t.onProgress||null,this.onError=t.onError||null,this.source=this.input=t.input,this.output=null,this.progress=t.progress,this.options=t.options||Object.create(null)}dispatch(t,e,i,s,r){switch(t){case"complete":this.onComplete&&this.onComplete(e,i);break;case"progress":this.onProgress&&this.onProgress(e,i,s,r);break;case"error":this.onError&&this.onError(e,i,s,r);break;default:{const n=`on${t[0].toUpperCase()}${t.substring(1)}`;"function"==typeof this[n]&&this[n](e,i,s,r);break}}}recycle(){Jp._deadPool.length!==Jp.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,Jp._deadPool.push(this))}}Jp.MAX_DEAD_NUM=500,Jp._taskId=0,Jp._deadPool=[];const tm="0123456789abcdef".split(""),em=["","","",""],im=em.concat(em,"-",em,"-",em,"-",em,"-",em,em,em),sm=im.map(((t,e)=>"-"===t?NaN:e)).filter(Number.isFinite);function rm(t){const e=t.split("@")[0];if(22!==e.length)return t;im[0]=t[0],im[1]=t[1];for(let e=2,i=2;e<22;e+=2){const s=De[t.charCodeAt(e)],r=De[t.charCodeAt(e+1)];im[sm[i++]]=tm[s>>2],im[sm[i++]]=tm[(3&s)<<2|r>>4],im[sm[i++]]=tm[15&r]}return t.replace(e,im.join(""))}const nm=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function om(t){const e=nm.exec(t);return e?e[1]:""}function am(t,e){(e=e||Object.create(null)).__isNative__=e.isNative,e.nativeExt&&(e.ext=e.nativeExt);const i=Xp.find((e=>!!e.getAssetInfo(t)));return i&&(e.bundle=i.name),cm(t,e)}function hm(t){return!!t&&(t instanceof a.SceneAsset||t instanceof a.Scene)}function lm(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t}function cm(t,e){const i=Jp.create({input:t,options:e}),s=[];try{const t=$p.sync(i);for(const e of t){const t=e.url;e.recycle(),s.push(t)}}catch(t){for(const t of i.output)t.recycle();P(t.message,t.stack)}return i.recycle(),s.length>1?s:s[0]}var um=Object.freeze({__proto__:null,decodeUuid:rm,getUrlWithUuid:am,getUuidFromURL:om,isScene:hm,normalize:lm,transform:cm});const dm=t=>{t()};function _m(t){const e=t._lpos;t.setPositionForJS(e.x,e.y,e.z);const i=t._lscale;t.setScaleForJS(i.x,i.y,i.z);const s=t._lrot;t.setRotationForJS(s.x,s.y,s.z,s.w);const r=t._euler;t.setRotationFromEulerForJS(r.x,r.y,r.z)}function pm(t){if(!t)return;const e=t.children;if(!e)return;const i=e.length;if(i){t._setChildren(e);for(let t=0;t<i;++t)pm(e[t])}}function mm(){}mm.prototype.once=function(t,e,i){return this.on(t,e,i,!0)},mm.prototype.targetOff=function(t){this.removeAll(t)},Ku(jsb.Asset,[Lo,mm]);const gm=jsb.Asset.prototype;gm._ctor=function(){this.loaded=!0,this._ref=0,this.__nativeRefs={},this.__jsb_ref_id=void 0,this._iN$t=null,this.__editorExtras__={editorOnly:!0},this._callbackTable=wt(!0),this._file=null},Object.defineProperty(gm,"_nativeAsset",{get(){return this._file},set(t){this._file=t}}),Object.defineProperty(gm,"nativeUrl",{get(){if(!this._nativeUrl){if(!this._native)return"";const t=this._native;if(47===t.charCodeAt(0))return t.slice(1);46===t.charCodeAt(0)?this._nativeUrl=am(this._uuid,{nativeExt:t,isNative:!0}):this._nativeUrl=am(this._uuid,{__nativeName__:t,nativeExt:ta(t),isNative:!0})}return this._nativeUrl}}),Object.defineProperty(gm,"refCount",{configurable:!0,enumerable:!0,get(){return this._ref}}),gm.addRef=function(){return this._ref++,this.addAssetRef(),this},gm.decRef=function(t=!0){return this.decAssetRef(),this._ref>0&&this._ref--,t&&a.assetManager.getReleaseManager().tryRelease(this),this},gm.toString=function(){return this.nativeUrl},gm.createNode=null;const fm=t("Asset",jsb.Asset);a.Asset=jsb.Asset,function(t,e=dm){const{Asset:i}={...t},s=Object.getOwnPropertyDescriptor(i.prototype,"_nativeAsset");e((()=>{vh(i.prototype,"_native",(()=>""))}),"serializable","_native"),e((()=>{uh(i.prototype,"_nativeAsset",s)}),"property","_nativeAsset"),e((()=>{ah("cc.Asset")(i)}),"ccclass",null)}({Asset:fm});const ym={RGB565:47,RGB5A1:49,RGBA4444:50,RGB888:24,RGB32F:32,RGBA8888:35,BGRA8888:36,RGBA32F:44,A8:1,I8:2,AI8:3,RGB_PVRTC_2BPPV1:83,RGBA_PVRTC_2BPPV1:84,RGB_A_PVRTC_2BPPV1:1024,RGB_PVRTC_4BPPV1:85,RGBA_PVRTC_4BPPV1:86,RGB_A_PVRTC_4BPPV1:1025,RGB_ETC1:72,RGBA_ETC1:1026,RGB_ETC2:73,RGBA_ETC2:77,RGBA_ASTC_4x4:89,RGBA_ASTC_5x4:90,RGBA_ASTC_5x5:91,RGBA_ASTC_6x5:92,RGBA_ASTC_6x6:93,RGBA_ASTC_8x5:94,RGBA_ASTC_8x6:95,RGBA_ASTC_8x8:96,RGBA_ASTC_10x5:97,RGBA_ASTC_10x6:98,RGBA_ASTC_10x8:99,RGBA_ASTC_10x10:100,RGBA_ASTC_12x10:101,RGBA_ASTC_12x12:102},bm={REPEAT:0,CLAMP_TO_EDGE:2,MIRRORED_REPEAT:1,CLAMP_TO_BORDER:3},vm={NONE:0,LINEAR:2,NEAREST:1},Sm=t("ImageAsset",jsb.ImageAsset),Tm=jsb.window,wm=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"];function xm(t){return!!(ga.hasFeature(ga.Feature.IMAGE_BITMAP)&&t instanceof ImageBitmap)}const Cm=Sm.prototype;Cm._ctor=function(t){jsb.Asset.prototype._ctor.apply(this,arguments),this._width=0,this._height=0,this._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1,mipmapLevelDataSize:[]},void 0!==t&&this.reset(t)},Object.defineProperty(Cm,"_nativeAsset",{configurable:!0,enumerable:!0,get(){return this._nativeData},set(t){t instanceof Tm.HTMLElement||xm(t)||(t.format=t.format||this.format),this.reset(t)}}),Object.defineProperty(Cm,"data",{configurable:!0,enumerable:!0,get(){return this._nativeData&&!0!==(t=this._nativeData)._compressed&&(t instanceof Tm.HTMLImageElement||t instanceof Tm.HTMLCanvasElement||xm(t))?this._nativeData:this._nativeData&&this._nativeData._data;var t}}),Cm._setRawAsset=function(t,e=!0){this._native=!1!==e?t||"":`/${t}`},Cm.reset=function(t){this._nativeData=t,t instanceof Tm.HTMLElement||void 0!==t.format&&(this.format=t.format),this._syncDataToNative()};const Am=jsb.Asset.prototype.destroy;var Dm,Em,Im;Cm.destroy=function(){return this.data&&this.data instanceof Tm.HTMLImageElement?(this.data.src="",this._setRawAsset(""),this.data.destroy()):xm(this.data)&&this.data.close&&this.data.close(),Am.call(this)},Object.defineProperty(Cm,"width",{configurable:!0,enumerable:!0,get(){var t;return(null==(t=this._nativeData)?void 0:t.width)||this._width}}),Object.defineProperty(Cm,"height",{configurable:!0,enumerable:!0,get(){var t;return(null==(t=this._nativeData)?void 0:t.height)||this._height}}),Cm._syncDataToNative=function(){const t=this._nativeData;if(this._width=t.width,this._height=t.height,this.setWidth(this._width),this.setHeight(this._height),this.url=this.nativeUrl,t instanceof Tm.HTMLCanvasElement)this.setData(t._data.data);else if(t instanceof Tm.HTMLImageElement)this.setData(t._data),t._mipmapLevelDataSize&&this.setMipmapLevelDataSize(t._mipmapLevelDataSize);else{if(!this._nativeData._data)return void console.error(`[ImageAsset] setData bad argument ${this._nativeData}`);this.setData(this._nativeData._data),this._nativeData.mipmapLevelDataSize&&this.setMipmapLevelDataSize(this._nativeData.mipmapLevelDataSize)}},Cm._serialize=function(){},Cm._deserialize=function(t){let e="";"string"==typeof t?e=t:(this._width=t.w,this._height=t.h,e=t.fmt);const i=yp.gfxDevice,s=e.split("_");let r=Number.MAX_VALUE,n=this.format,o="";const a=we.SUPPORT_TEXTURE_FORMATS;for(const t of s){const e=t.split("@"),s=parseInt(e[0],void 0),h=wm[s]||e[0],l=a.indexOf(h);if(-1!==l&&l<r){const t=e[1]?parseInt(e[1]):this.format;if(!(".astc"!==h||i&&i.getFormatFeatures(sd.ASTC_RGBA_4X4)&md.SAMPLED_TEXTURE))continue;if(!(".pvr"!==h||i&&i.getFormatFeatures(sd.PVRTC_RGBA4)&md.SAMPLED_TEXTURE))continue;if(!(t!==ym.RGB_ETC1&&t!==ym.RGBA_ETC1||i&&i.getFormatFeatures(sd.ETC_RGB8)&md.SAMPLED_TEXTURE))continue;if(!(t!==ym.RGB_ETC2&&t!==ym.RGBA_ETC2||i&&i.getFormatFeatures(sd.ETC2_RGB8)&md.SAMPLED_TEXTURE))continue;if(".webp"===h&&!ga.hasFeature(ga.Feature.WEBP))continue;r=l,o=h,n=t}}o?(this._setRawAsset(o),this.format=n):j(3121)},a.ImageAsset=jsb.ImageAsset,function(t,e=dm){const{ImageAsset:i}={...t},s=Object.getOwnPropertyDescriptor(i.prototype,"_nativeAsset");e((()=>{Yh(i.prototype,"_nativeAsset",s)}),"override","_nativeAsset"),e((()=>{ah("cc.ImageAsset")(i)}),"ccclass",null)}({ImageAsset:Sm});let Mm=t("Script",ah("cc.Script")(Dm=class extends fm{constructor(t){super(t)}})||Dm);a._Script=Mm;let Pm=t("JavaScript",ah("cc.JavaScript")(Em=class extends Mm{constructor(t){super(t)}})||Em);a._JavaScript=Pm;let Om=t("TypeScript",ah("cc.TypeScript")(Im=class extends Mm{constructor(t){super(t)}})||Im);var Rm,Bm,Fm,Nm,Lm,km,zm;a._TypeScript=Om;let Um=t("EventHandler",ah("cc.ClickEvent")((Bm=class t{constructor(){this.target=Fm&&Fm(),this.component=Nm&&Nm(),this._componentId=Lm&&Lm(),this.handler=km&&km(),this.customEventData=zm&&zm()}get _componentName(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)}set _componentName(t){this._componentId=this._compName2Id(t)}static emitEvents(e,...i){for(let s=0,r=e.length;s<r;s++){const r=e[s];r instanceof t&&r.emit(i)}}emit(t){const e=this.target;if(!h.isValid(e))return;this._genCompIdIfNeeded();const i=h.js.getClassById(this._componentId),s=e.getComponent(i);if(!h.isValid(s))return;const r=s[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),r.apply(s,t))}_compName2Id(t){const e=h.js.getClassByName(t);return h.js.getClassId(e)}_compId2Name(t){const e=h.js.getClassById(t);return h.js.getClassName(e)}_genCompIdIfNeeded(){this._componentId||(this._componentName=this.component,this.component="")}},Fm=Za(Bm.prototype,"target",[vh],(function(){return null})),Nm=Za(Bm.prototype,"component",[vh],(function(){return""})),Lm=Za(Bm.prototype,"_componentId",[vh],(function(){return""})),km=Za(Bm.prototype,"handler",[vh],(function(){return""})),zm=Za(Bm.prototype,"customEventData",[vh],(function(){return""})),Rm=Bm))||Rm);var Vm,jm,Hm,Gm,Wm,Xm,Ym,qm;const $m=new ut("Comp");let Km=t("Component",(Vm=ah("cc.Component"),jm=Xh(Mm),Vm((qm=class extends Do{constructor(){super(),this.node=Wm&&Wm(),this._enabled=Xm&&Xm(),this.__prefab=Ym&&Ym(),this._sceneGetter=null,this._id=$m.getNewId()}get name(){if(this._name)return this._name;let t=xt(this);const e=t.lastIndexOf(".");return e>=0&&(t=t.slice(e+1)),this.node?`${this.node.name}<${t}>`:t}set name(t){this._name=t}get uuid(){return this._id}get __scriptAsset(){return null}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&(this._enabled=t,this.node.activeInHierarchy)){const e=h.director._compScheduler;t?e.enableComp(this):e.disableComp(this)}}get enabledInHierarchy(){return this._enabled&&this.node&&this.node.activeInHierarchy}get _isOnLoadCalled(){return 16384&this._objFlags}_getRenderScene(){return this._sceneGetter?this._sceneGetter():this.node.scene.renderScene}addComponent(t){return this.node.addComponent(t)}getComponent(t){return this.node.getComponent(t)}getComponents(t){return this.node.getComponents(t)}getComponentInChildren(t){return this.node.getComponentInChildren(t)}getComponentsInChildren(t){return this.node.getComponentsInChildren(t)}destroy(){return!!super.destroy()&&(this._enabled&&this.node.activeInHierarchy&&h.director._compScheduler.disableComp(this),!0)}_onPreDestroy(){this.unscheduleAllCallbacks(),h.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)}_instantiate(t){return t||(t=h.instantiate._clone(this,this)),t&&(t.node=null),t}schedule(t,e=0,i=h.macro.REPEAT_FOREVER,s=0){X(Boolean(t),1619),X((e=e||0)>=0,1620),i=Number.isNaN(i)?h.macro.REPEAT_FOREVER:i,s=s||0;const r=h.director.getScheduler(),n=r.isTargetPaused(this);r.schedule(t,this,e,i,s,n)}scheduleOnce(t,e=0){this.schedule(t,0,0,e)}unschedule(t){t&&h.director.getScheduler().unschedule(t,this)}unscheduleAllCallbacks(){h.director.getScheduler().unscheduleAllForTarget(this)}get internalUpdate(){return this.update}get internalLateUpdate(){return this.lateUpdate}get internalPreload(){return this.__preload}get internalOnLoad(){return this.onLoad}get internalStart(){return this.start}get internalOnEnable(){return this.onEnable}get internalOnDisable(){return this.onDisable}get internalOnDestroy(){return this.onDestroy}},qm.EventHandler=Um,qm._executionOrder=0,qm._requireComponent=null,qm.system=null,s((Gm=qm).prototype,"__scriptAsset",[jm],Object.getOwnPropertyDescriptor(Gm.prototype,"__scriptAsset"),Gm.prototype),Wm=Za(Gm.prototype,"node",[vh],(function(){return null})),Xm=Za(Gm.prototype,"_enabled",[vh],(function(){return!0})),Ym=Za(Gm.prototype,"__prefab",[vh],(function(){return null})),Hm=Gm))||Hm));var Zm,Qm,Jm;bt(Km,"_registerEditorProps",((t,e)=>{let i=e.requireComponent;i&&(Array.isArray(i)&&(i=i.filter(Boolean)),t._requireComponent=i);const s=e.executionOrder;s&&"number"==typeof s&&(t._executionOrder=s)})),h.Component=Km;let tg=t("MissingScript",ah("cc.MissingScript")((Qm=class extends Km{static safeFindClass(t){const e=$t(t);if(e)return e;a.deserialize.reportMissingClass(t)}constructor(){super(),this._$erialized=Jm&&Jm()}onLoad(){j(4600,this.node.name)}},Jm=Za(Qm.prototype,"_$erialized",[vh,Th],(function(){return null})),Zm=Qm))||Zm);a._MissingScript=tg;try{const t=tg.__values__;0!==t.length&&"_$erialized"===t[t.length-1]||(G(16338),G(16339,t.join(", ")))}catch(rn){G(16340,`${rn}`)}class eg{get offset(){return this._offset}constructor(t){if(this._offset=0,this._buffer=void 0,this._view=void 0,t instanceof ArrayBuffer)this._buffer=t,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(t))throw new Error("Invalid argument");this._buffer=t.buffer,this._view=new DataView(this._buffer,t.byteOffset,t.byteLength)}}_array(t){const e=new Array(t);for(let i=0;i<t;i++)e[i]=this.parse();return e}_map(t){let e="";const i={};for(let s=0;s<t;s++)e=this.parse(),i[e]=this.parse();return i}_str(t){const e=ig(this._view,this._offset,t);return this._offset+=t,e}_bin(t){const e=this._buffer.slice(this._offset,this._offset+t);return this._offset+=t,e}parse(){const t=this._view.getUint8(this._offset++);let e,i=0,s=0,r=0,n=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:if(i=this._view.getUint8(this._offset),s=this._view.getInt8(this._offset+1),this._offset+=2,-1===s){const t=this._view.getUint32(this._offset);return r=this._view.getInt32(this._offset+4),n=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*r+n)+t/1e6)}return[s,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),s=this._view.getInt8(this._offset+2),this._offset+=3,[s,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),s=this._view.getInt8(this._offset+4),this._offset+=5,[s,this._bin(i)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return r=this._view.getUint32(this._offset)*2**32,n=this._view.getUint32(this._offset+4),this._offset+=8,r+n;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return r=this._view.getInt32(this._offset)*2**32,n=this._view.getUint32(this._offset+4),this._offset+=8,r+n;case 212:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?void(this._offset+=1):[s,this._bin(1)];case 213:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(2)];case 214:return s=this._view.getInt8(this._offset),this._offset+=1,-1===s?(e=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*e)):[s,this._bin(4)];case 215:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?(r=this._view.getInt32(this._offset)*2**32,n=this._view.getUint32(this._offset+4),this._offset+=8,new Date(r+n)):-1===s?(r=this._view.getUint32(this._offset),n=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&r)+n)+(r>>>2)/1e6)):[s,this._bin(8)];case 216:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")}}function ig(t,e,i){let s="",r=0;for(let n=e,o=e+i;n<o;n++){const e=t.getUint8(n);if(128&e)if(192!=(224&e))if(224!=(240&e)){if(240!=(248&e))throw new Error(`Invalid byte ${e.toString(16)}`);r=(7&e)<<18|(63&t.getUint8(++n))<<12|(63&t.getUint8(++n))<<6|63&t.getUint8(++n),r>=65536?(r-=65536,s+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))):s+=String.fromCharCode(r)}else s+=String.fromCharCode((15&e)<<12|(63&t.getUint8(++n))<<6|63&t.getUint8(++n));else s+=String.fromCharCode((31&e)<<6|63&t.getUint8(++n));else s+=String.fromCharCode(e)}return s}function sg(t){const e=new eg(t),i=e.parse();if(e.offset!==t.byteLength)throw new Error(t.byteLength-e.offset+" trailing bytes");return i}class rg{constructor(t,e){this._document=t,this._chunks=e}get document(){return this._document}get chunks(){return this._chunks}}function ng(t){if(t.length<16)throw new ag(q(13102));const e=new DataView(t.buffer,t.byteOffset,t.byteLength);if(1313817411!==e.getUint32(0,!0))throw new ag(q(13100));const i=e.getUint32(4,!0);if(e.getUint32(8,!0)!==e.byteLength)throw new ag(q(13102));let s=12;const r=e.getUint32(s,!0);s+=4;const n=new Uint8Array(e.buffer,s+e.byteOffset,r);let o;s+=r;try{if(1===i){const t=og(n);o=JSON.parse(t)}else 2===i&&(o=sg(n))}catch(t){throw new ag(t)}const a=[];for(;s<e.byteLength;){s%8!=0&&(s+=8-s%8);const t=e.getUint32(s,!0);s+=4,a.push(new Uint8Array(e.buffer,s+e.byteOffset,t)),s+=t}if(s!==e.byteLength)throw new ag(q(13102));return new rg(o,a)}function og(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);if("Buffer"in globalThis){const{Buffer:e}=globalThis;return e.from(t.buffer,t.byteOffset,t.byteLength).toString()}throw new Error(q(13104))}class ag extends Error{}function hg(t,e,i,s,r){if(e instanceof a.ValueType){r||t.push("if(prop){");const s=xt(e);t.push(`s._deserializeFastDefinedObject(o${i},prop,${s});`),r||t.push(`}else o${i}=null;`)}else t.push(`\nif (prop) {\n    s._deserializeAndAssignField(o, prop, ${s});\n} else {\n    o${i}=null;\n}\n`)}a.internal.decodeCCONBinary=ng,a.internal.CCON=rg;const lg=function(t,e){const i=yi.Attr.getClassAttrs(e),s=e.__values__,r=["var prop;"],n=pg(e);for(let t=0;t<s.length;t++){const e=s[t];let o,a;yi.IDENTIFIER_RE.test(e)?(a=`"${e}"`,o=`.${e}`):(a=yi.escapeForJS(e),o=`[${a}]`);let h=o;if(i[e+_g]){const t=i[e+_g];h=yi.IDENTIFIER_RE.test(t)?`.${t}`:`[${yi.escapeForJS(t)}]`}r.push(`prop=d${h};`),r.push('if(typeof (prop)!=="undefined"){');const l=yi.getDefault(i[e+dg]),c=i[e+ug];n&&(void 0!==l||c)?mg(l,c)?r.push(`o${o}=prop;`):hg(r,l,o,a,!0):(r.push(`if(typeof (prop)!=="object"){o${o}=prop;}else{`),hg(r,l,o,a,!1),r.push("}")),r.push("}")}return(kt(e,a.Node)||kt(e,a.Component))&&r.push("d._id&&(o._id=d._id);"),"_$erialized"===s[s.length-1]&&(r.push("o._$erialized=JSON.parse(JSON.stringify(d));"),r.push("s._fillPlainObject(o._$erialized,d);")),Function("s","o","d","k",r.join(""))},cg=yi.Attr.DELIMETER,ug=`${cg}type`,dg=`${cg}default`,_g=`${cg}formerlySerializedAs`;function pg(t){return Ce.test(Qt(t))}function mg(t,e){if(void 0===t)return e instanceof yi.Attr.PrimitiveType||e===hi||e===li;{const e=typeof t;return"string"===e||"number"===e||"boolean"===e}}class gg extends Jt{constructor(){super((t=>{t.clear()}),1)}}gg.prototype.get=function(t,e,i,s,r){const n=this._get();return n?(n.reset(t,e,i,s,r),n):new fg(t,e,i,s,r)};class fg{get ignoreEditorOnly(){return this._ignoreEditorOnly}constructor(t,e,i,s,r){this.deserializedList=[],this.deserializedData=null,this.result=t,this.customEnv=s,this._classFinder=e,this._reportMissingClass=i,this._onDereferenced=null==e?void 0:e.onDereferenced}reset(t,e,i,s,r){this.result=t,this.customEnv=s,this._classFinder=e,this._reportMissingClass=i,this._onDereferenced=null==e?void 0:e.onDereferenced}clear(){this.result=null,this.customEnv=null,this.deserializedList.length=0,this.deserializedData=null,this._classFinder=null,this._reportMissingClass=null,this._onDereferenced=null}deserialize(t){let e,i=!1;t instanceof rg?(i=!0,e=t.document,t.chunks.length>0&&(t.chunks.length,this._mainBinChunk=t.chunks[0])):e=t,this._serializedData=e,this._context={fromCCON:i};const s=Array.isArray(e)?e[0]:e;return this.deserializedData=this._deserializeObject(s,0),this._serializedData=void 0,this._mainBinChunk=void 0,this._context=void 0,this.deserializedData}_deserializeObject(t,e,i,s){switch(t.__type__){case"TypedArray":return this._deserializeTypedArrayView(t);case"TypedArrayRef":return this._deserializeTypedArrayViewRef(t);default:return t.__type__?this._deserializeTypeTaggedObject(t,e,i,s):Array.isArray(t)?this._deserializeArray(t):this._deserializePlainObject(t)}}_deserializeTypedArrayView(t){return globalThis[t.ctor].from(t.array)}_deserializeTypedArrayViewRef(t){const{offset:e,length:i,ctor:s}=t;return new globalThis[s](this._mainBinChunk.buffer,this._mainBinChunk.byteOffset+e,i)}_deserializeArray(t){const e=new Array(t.length);let i;for(let s=0;s<t.length;s++)i=t[s],"object"==typeof i&&i?this._deserializeAndAssignField(e,i,`${s}`)&&(e[s]=null):e[s]=i;return e}_deserializePlainObject(t){const e={};return this._fillPlainObject(e,t),e}_deserializeTypeTaggedObject(t,e,i,s){const r=t.__type__,n=this._classFinder(r,t,i,s);if(!n)return this._classFinder===$t&&this._reportMissingClass(r),null;const o=t=>{const i=new t;return e>=0&&(this.deserializedList[e]=i),i};{const e=o(n);return this._deserializeInto(t,e,n),e}}_deserializeInto(t,e,i,s=!1){s||!e[hl]?e._deserialize?e._deserialize(t.content,this):a.Class._isCCClass(i)?this._deserializeFireClass(e,t,i):this._deserializeFastDefinedObject(e,t,i):this._runCustomizedDeserialize(t,e,i)}_runCustomizedDeserialize(t,e,i){const s={readProperty:e=>{const i=t[e];return"object"==typeof i&&i?this._deserializeObjectField(i):i},readThis:()=>{this._deserializeInto(t,e,i,!0)},readSuper:()=>{const s=Lt(i);s&&this._deserializeInto(t,e,s)}};e[hl](s,this._context)}_deserializeFireClass(t,e,i){let s;if(i.hasOwnProperty("__deserialize__"))s=i.__deserialize__;else{s=lg(0,i);try{if(i===tg){const t=i.__values__;0!==t.length&&"_$erialized"===t[t.length-1]||(G(16341),G(16342,t.join(", ")));const e=s;s=function(t,i,s,r){e(t,i,s,r),i._$erialized||G(16343,JSON.stringify(s))}}}catch(t){G(16344,`${t}`)}bt(i,"__deserialize__",s,!0)}s(this,t,e,i)}_deserializeAndAssignField(t,e,i){const s=e.__id__;if("number"==typeof s){const e=this.deserializedList[s];if(e)t[i]=e;else{var r;const e=this._serializedData[s];t[i]=this._deserializeObject(e,s,void 0,i),null==(r=this._onDereferenced)||r.call(this,this.deserializedList,s,t,i)}}else{const s=e.__uuid__;if(s){const r=e.__expectedType__;this.result.push(t,i,s,r)}else t[i]=this._deserializeObject(e,-1)}return!1}_deserializeObjectField(t){const e=t.__id__;if("number"==typeof e){const t=this.deserializedList[e];if(t)return t;{const t=this._serializedData[e];return this._deserializeObject(t,e,void 0,void 0)}}if(t.__uuid__)throw t.__expectedType__,new Error("Asset reference field serialization is currently not supported in custom serialization.");return this._deserializeObject(t,-1)}_fillPlainObject(t,e){for(const i in e){if(!e.hasOwnProperty(i))continue;const s=e[i];"object"!=typeof s?"__type__"!==i&&(t[i]=s):s?this._deserializeAndAssignField(t,s,i)&&(t[i]=null):t[i]=null}}_deserializeFastDefinedObject(t,e,i){if(i===a.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(i===a.Vec3)return t.x=e.x||0,t.y=e.y||0,void(t.z=e.z||0);if(i===a.Color){t.r=e.r||0,t.g=e.g||0,t.b=e.b||0;const i=e.a;return void(t.a=void 0===i?255:i)}if(i===a.Size)return t.width=e.width||0,void(t.height=e.height||0);const s=yi.Attr.getClassAttrs(i),r=i.__values__;for(let i=0;i<r.length;i++){const n=r[i];let o=e[n];void 0!==o||e.hasOwnProperty(n)||(o=yi.getDefault(s[n+dg])),"object"!=typeof o?t[n]=o:o?this._deserializeAndAssignField(t,o,n):t[n]=null}}}function yg(t,e,i){var s;const r=(i=i||{}).classFinder||$t,n=i.createAssetRefs||ga.platform===Wo.EDITOR_CORE,o=i.customEnv,h=i.ignoreEditorOnly,l=null!==(s=i.reportMissingClass)&&void 0!==s?s:a.deserialize.reportMissingClass;e.init();const c=fg.pool.get(e,r,l,o,h);a.game._isCloning=!0;const u=c.deserialize(t);return a.game._isCloning=!1,fg.pool.put(c),n&&e.assignAssetsBy(((t,e)=>EditorExtends.serialize.asAsset(t,e.type))),u}fg.pool=new gg;const bg=[kr,Ms,ms,sr,Ls,Vr,Wr,vr];function vg(t,e){t.x=e[1],t.y=e[2],t.z=e[3],t.w=e[4]}const Sg=[(t,e)=>{t.x=e[1],t.y=e[2]},(t,e)=>{t.x=e[1],t.y=e[2],t.z=e[3]},vg,vg,(t,e)=>{Ls.fromUint32(t,e[1])},(t,e)=>{t.width=e[1],t.height=e[2]},(t,e)=>{t.x=e[1],t.y=e[2],t.width=e[3],t.height=e[4]},(t,e)=>{vr.fromArray(t,e,1)}],Tg=1,wg=0,xg=0,Cg=1,Ag=2,Dg=0,Eg=0;class Ig{constructor(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}init(t){t?(this.uuidObjList=t[8],this.uuidPropList=t[9],this.uuidList=t[10]):this.uuidList||(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.uuidTypeList=[])}reset(){this.uuidList&&(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.uuidTypeList.length=0)}push(t,e,i,s){this.uuidObjList.push(t),this.uuidPropList.push(e),this.uuidList.push(i),this.uuidTypeList.push(s||"")}}function Mg(t,e,i){const s=t.length-1;let r=0;const n=3*t[s];for(;r<n;r+=3){const s=t[r],n=e[t[r+2]],o=t[r+1];o>=0?s[i[o]]=n:s[~o]=n}for(;r<s;r+=3){const s=e[t[r]],n=e[t[r+2]],o=t[r+1];o>=0?s[i[o]]=n:s[~o]=n}}function Pg(t,e){const i=t[4][e[Eg]],s=i[Dg],r=new(0,s[xg]),n=s[Cg],o=s[Ag],a=i[i.length-1];let h=Dg+1;for(;h<a;++h)r[n[i[h]]]=e[h];for(;h<e.length;++h){const a=n[i[h]],l=s[i[h]+o];(0,Lg[l])(t,r,a,e[h])}return r}function Og(t,e,i){const s=new e;return s._deserialize?s._deserialize(i,t[0]):G(5303,xt(e)),s}function Rg(t,e,i,s){s>=0?e[i]=t[5][s]:t[7][3*~s]=e}function Bg(t){return(e,i,s,r)=>{for(let i=0;i<r.length;++i)t(e,r,i,r[i]);i[s]=r}}function Fg(t,e,i,s){e[i]=null,t[8][s]=e}function Ng(t,e,i,s){e[i]=Pg(t,s)}t("Details",Ig),Ig.pool=new Jt((t=>{t.reset()}),5),Ig.pool.get=function(){return this._get()||new Ig};const Lg=new Array(13);function kg(t){const e=t[5],i=t[6],s=i===wg?0:i.length;let r=e[e.length-1],n=e.length-s;"number"!=typeof r?r=0:(r<0&&(r=~r),--n);let o=0;for(;o<n;++o)e[o]=Pg(t,e[o]);const a=t[3];for(let r=0;r<s;++r,++o){let s=i[r];const n=e[o];if(s>=0){const i=a[s];e[o]=Og(t,i,n)}else s=~s,(0,Lg[s])(t,e,o,n)}return r}function zg(t,e,i){return t||i(e),Object}function Ug(t,e,i,s,r,n,o){let a=t(e);if(!a){if(r)return void(i[s]=(h=i,l=s,c=e,function(){const e=t(c)||zg(n,c,o);return h[l]=e,new e}));a=zg(n,e,o)}var h,l,c;i[s]=a}function Vg(t,e,i,s){const r=i||$t,n=t[3];for(let t=0;t<n.length;++t){const o=n[t];"string"!=typeof o?Ug(r,o[xg],o,xg,e,i,s):Ug(r,o,n,t,e,i,s)}}function jg(t){const e=t[4];if(e){const i=t[3];for(let t=0;t<e.length;++t){const s=e[t];s[Dg]=i[s[Dg]]}}}function Hg(t){const e=t[5],i=t[2],s=t[1],r=t[8],n=t[9],o=t[10];for(let t=0;t<r.length;++t){const a=r[t];"number"==typeof a&&(r[t]=e[a]);let h=n[t];"number"==typeof h&&(h=h>=0?i[h]:~h,n[t]=h);const l=o[t];"number"==typeof l&&(o[t]=s[l])}}function Gg(t){if(Array.isArray(t)){const e=t[0];return"number"==typeof e||e instanceof Yg}return!1}function Wg(t,e,i){var s;e.init(t),null!==(s=i)&&void 0!==s||(i={});let r=t[0],n=!1;if("object"==typeof r&&(n=r.preprocessed,r=r.version),r<Tg)throw new Error(q(5304,r));const o=i;var a;o._version=r,o.result=e,t[0]=o,n||(Vg(t,!1,i.classFinder,null!==(a=i.reportMissingClass)&&void 0!==a?a:Xg.reportMissingClass),jg(t))}function Xg(t,e,i){"string"==typeof t&&(t=JSON.parse(t));let s,r=!1;if(e||(e=Ig.pool.get(),r=!0),Gg(t)){Wg(t,e,i);const r=t;a.game._isCloning=!0;const n=r[5],o=kg(r);a.game._isCloning=!1,r[7]&&Mg(r[7],n,r[2]),Hg(r),s=n[o]}else s=yg(t,e,i);return r&&Ig.pool.put(e),s}Lg[0]=function(t,e,i,s){e[i]=s},Lg[1]=Rg,Lg[2]=Bg(Rg),Lg[3]=Bg(Fg),Lg[4]=Ng,Lg[5]=function(t,e,i,s){const r=s[0];{const t=e[i];(0,Sg[r])(t,s),e[i]=t}},Lg[6]=Fg,Lg[7]=function(t,e,i,s){e[i].set(s)},Lg[8]=function(t,e,i,s){const r=s[0],n=new bg[r];(0,Sg[r])(n,s),e[i]=n},Lg[9]=Bg(Ng),Lg[10]=function(t,e,i,s){const r=t[3][s[0]];e[i]=Og(t,r,s[1])},Lg[11]=function(t,e,i,s){const r=s[0];e[i]=r;for(let e=1;e<s.length;e+=3){const i=s[e],n=s[e+1],o=s[e+2];(0,Lg[n])(t,r,i,o)}},Lg[12]=function(t,e,i,s){const r=s[0];for(let e=0;e<r.length;++e){const i=r[e],n=s[e+1];0!==n&&(0,Lg[n])(t,r,e,i)}e[i]=r},Xg.Details=Ig,Xg.reportMissingClass=function(t){G(5302,t)};class Yg{constructor(t){this.preprocessed=!0,this.version=t}}function qg(t,e){if(t[0]<Tg)throw new Error(q(5304,t[0]));Vg(t,!0,e,Xg.reportMissingClass),jg(t);const i=new Yg(t[0]),s=t[1],r=t[2],n=t[3],o=t[4],a=t[5];for(let t=0;t<a.length;++t)a[t].unshift(i,s,r,n,o);return a}function $g(t,e,i){return[Tg,wg,wg,[t],wg,i?[e,-1]:[e],[0],wg,[],[],[]]}function Kg(t){const e=t[5],i=e[e.length-1];return"number"==typeof i&&i<0}function Zg(t){const e=t[1];return t[10].map((t=>e[t]))}a.deserialize=Xg;const Qg=new WeakMap,Jg=new WeakSet,tf=new WeakSet;function ef(t,e){let i;i=tg.safeFindClass;const s=Ig.pool.get();let r;try{r=Xg(t,s,{classFinder:i,customEnv:e})}catch(t){throw P(t),Ig.pool.put(s),t}r._uuid=e.__uuid__||"";const n=s.uuidList,o=s.uuidObjList,a=s.uuidPropList,h=s.uuidTypeList||[],l=[];for(let t=0;t<n.length;t++){const e=n[t];l[t]={uuid:rm(e),owner:o[t],prop:a[t],type:$t(h[t])}}return Qg.set(r,l),r._native&&Jg.add(r),Ig.pool.put(s),r}class sf{static get instance(){return this._instance||(this._instance=new sf),this._instance}constructor(){this._depends=new Vp}init(){this._depends.clear()}getNativeDep(t){const e=this._depends.get(t);return e&&e.nativeDep?{...e.nativeDep}:null}getDeps(t){return this._depends.has(t)?this._depends.get(t).deps:[]}getDepsRecursively(t){const e=Object.create(null),i=[];return this._descend(t,e,i),i}remove(t){this._depends.remove(t)}parse(t,e){let i=null;if(Array.isArray(e)||e.__type__||e instanceof rg){if(this._depends.has(t))return this._depends.get(t);if(Array.isArray(e)&&!Kg(e))i={deps:this._parseDepsFromJson(e)};else try{const s=ef(e,{__uuid__:t});i=this._parseDepsFromAsset(s),i.nativeDep&&(i.nativeDep.uuid=t),Wp.add(`${t}@import`,s)}catch(e){Gp.remove(`${t}@import`),i={deps:[]}}}else{if(this._depends.has(t)&&(i=this._depends.get(t),i.parsedFromExistAsset))return i;i=this._parseDepsFromAsset(e)}return this._depends.add(t,i),i}_parseDepsFromAsset(t){const e={deps:[],parsedFromExistAsset:!0},i=Qg.get(t);for(let t=0,s=i.length;t<s;t++)e.deps.push(i[t].uuid);return Jg.has(t)&&(e.nativeDep=t._nativeDep),e}_parseDepsFromJson(t){const e=Zg(t);return e.forEach(((t,i)=>e[i]=rm(t))),e}_descend(t,e,i){const s=this.getDeps(t);for(let t=0;t<s.length;t++){const r=s[t];e[r]||(e[r]=!0,i.push(r),this._descend(r,e,i))}}}sf._instance=void 0;var rf=sf.instance;const nf=jsb.TextureBase.prototype;nf._serialize=function(){return""},nf._deserialize=function(t){const e=t.split(",");e.unshift(""),e.length>=5&&(this.setFilters(parseInt(e[1]),parseInt(e[2])),this.setWrapMode(parseInt(e[3]),parseInt(e[4]))),e.length>=7&&(this.setMipFilter(parseInt(e[5])),this.setAnisotropy(parseInt(e[6])))},nf._getGFXDevice=function(){return yp.gfxDevice},nf._getGFXFormat=function(){return this._getGFXPixelFormat(this.format)},nf._setGFXFormat=function(t){this.format=void 0===t?ym.RGBA8888:t},nf._getGFXPixelFormat=function(t){return t===ym.RGBA_ETC1?t=ym.RGB_ETC1:t===ym.RGB_A_PVRTC_4BPPV1?t=ym.RGB_PVRTC_4BPPV1:t===ym.RGB_A_PVRTC_2BPPV1&&(t=ym.RGB_PVRTC_2BPPV1),t},nf.createNode=null;const of=jsb.TextureBase;of.Filter=vm,of.PixelFormat=ym,of.WrapMode=bm,nf._ctor=function(){jsb.Asset.prototype._ctor.apply(this,arguments),this._gfxSampler=null,this._samplerInfo=null,this._textureHash=0,this._registerGFXSamplerUpdatedListener()};const af=nf.getGFXSampler;nf.getGFXSampler=function(){return this._gfxSampler||(this._gfxSampler=af.call(this)),this._gfxSampler};const hf=nf.getHash;nf.getHash=function(){return 0===this._textureHash&&(this._textureHash=hf.call(this)),this._textureHash};const lf=nf.getSamplerInfo;nf.getSamplerInfo=function(){return this._samplerInfo||(this._samplerInfo=lf.call(this)),this._samplerInfo};const cf=nf.destroy;nf.destroy=function(){var t;return null!=(t=a.director.root)&&t.batcher2D&&a.director.root.batcher2D._releaseDescriptorSetCache(this.getGFXTexture(),this.getGFXSampler()),cf.call(this)},nf._onGFXSamplerUpdated=function(t,e){this._gfxSampler=t,this._samplerInfo=e},a.TextureBase=jsb.TextureBase,function(t,e=dm){const{TextureBase:i,PixelFormat:s,TextureFilter:r,WrapMode:n}={...t};e((()=>{vh(i.prototype,"_format",(()=>s.RGBA8888))}),"serializable","_format"),e((()=>{vh(i.prototype,"_minFilter",(()=>r.LINEAR))}),"serializable","_minFilter"),e((()=>{vh(i.prototype,"_magFilter",(()=>r.LINEAR))}),"serializable","_magFilter"),e((()=>{vh(i.prototype,"_mipFilter",(()=>r.NONE))}),"serializable","_mipFilter"),e((()=>{vh(i.prototype,"_wrapS",(()=>n.REPEAT))}),"serializable","_wrapS"),e((()=>{vh(i.prototype,"_wrapT",(()=>n.REPEAT))}),"serializable","_wrapT"),e((()=>{vh(i.prototype,"_wrapR",(()=>n.REPEAT))}),"serializable","_wrapR"),e((()=>{vh(i.prototype,"_anisotropy",(()=>0))}),"serializable","_anisotropy"),e((()=>{ah("cc.TextureBase")(i)}),"ccclass",null)}({TextureBase:of,TextureFilter:vm,WrapMode:bm,PixelFormat:ym});const uf=jsb.SimpleTexture,df=jsb.window;uf.Filter=vm,uf.PixelFormat=ym,uf.WrapMode=bm;const _f=jsb.SimpleTexture.prototype,pf=_f.uploadData;_f.uploadData=function(t,e=0,i=0){let s;t instanceof df.HTMLCanvasElement?s=t.data:t instanceof df.HTMLImageElement?s=t._data:ArrayBuffer.isView(t)&&(s=t.buffer),pf.call(this,s,e,i)},_f._ctor=function(){jsb.TextureBase.prototype._ctor.apply(this,arguments),this._gfxTexture=null,this._registerListeners()};const mf=_f.getGFXTexture;_f.getGFXTexture=function(){return this._gfxTexture||(this._gfxTexture=mf.call(this)),this._gfxTexture},_f._onGFXTextureUpdated=function(t){this._gfxTexture=t},_f._onAfterAssignImage=function(t){if(we.CLEANUP_IMAGE_CACHE){const e=rf.getDeps(this._uuid),i=e.indexOf(t._uuid);-1!==i&&(ie(e,i),t.decRef())}},function(t,e=dm){const{SimpleTexture:i}={...t};e((()=>{ah("cc.SimpleTexture")(i)}),"ccclass",null)}({SimpleTexture:uf}),a.SimpleTexture=jsb.SimpleTexture;const gf=jsb.Texture2D.prototype;gf.createNode=null;const ff=t("Texture2D",jsb.Texture2D);ff.Filter=vm,ff.PixelFormat=ym,ff.WrapMode=bm,gf._ctor=function(){uf.prototype._ctor.apply(this,arguments),this._mipmaps=[]},gf._serialize=function(){return null},gf._deserialize=function(t,e){const i=t;of.prototype._deserialize.call(this,i.base,void 0),this._mipmaps=new Array(i.mipmaps.length);for(let t=0;t<i.mipmaps.length;++t){if(this._mipmaps[t]=new Sm,!i.mipmaps[t])continue;const s=i.mipmaps[t];e.result.push(this._mipmaps,`${t}`,s,Qt(Sm))}};const yf=gf.onLoaded;function bf(t,e,i,s){t.drawTextureAt(e,i,s)}gf.onLoaded=function(){this.syncMipmapsForJS(this._mipmaps),yf.call(this)},Object.defineProperty(gf,"image",{configurable:!0,enumerable:!0,get(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set(t){this.mipmaps=t?[t]:[]}}),Object.defineProperty(gf,"mipmaps",{configurable:!0,enumerable:!0,get(){return this._mipmaps},set(t){for(let e=0,i=t.length;e<i;++e)t[e]._syncDataToNative();this._mipmaps=t,this.setMipmaps(t)}}),a.Texture2D=jsb.Texture2D,function(t,e=dm){const{Texture2D:i,ImageAsset:s}={...t};e((()=>{Xh([s])(i.prototype,"_mipmaps",(()=>[]))}),"type","_mipmaps"),e((()=>{ah("cc.Texture2D")(i)}),"ccclass",null)}({Texture2D:ff,ImageAsset:Sm});class vf{constructor(t,e){this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0;const i=new Sf;i.initWithSize(t,e),this._texture=i,this._width=t,this._height=e,this._x=2,this._y=2,this._nextY=2}insertSpriteFrame(t){const e=t.rect,i=t.texture,s=this._innerTextureInfos[i.getId()];let r=e.x,n=e.y;if(s)r+=s.x,n+=s.y;else{const t=i.width,e=i.height;if(this._x+t+2>this._width&&(this._x=2,this._y=this._nextY),this._y+e+2>this._nextY&&(this._nextY=this._y+e+2),this._nextY>this._height)return null;const s=this._texture,o=i.image;a.internal.dynamicAtlasManager.textureBleeding&&((t<=8||e<=8)&&(bf(s,o,this._x-1,this._y-1),bf(s,o,this._x-1,this._y+1),bf(s,o,this._x+1,this._y-1),bf(s,o,this._x+1,this._y+1)),bf(s,o,this._x-1,this._y),bf(s,o,this._x+1,this._y),bf(s,o,this._x,this._y-1),bf(s,o,this._x,this._y+1)),bf(s,o,this._x,this._y),this._innerTextureInfos[i.getId()]={x:this._x,y:this._y,texture:i},this._count++,r+=this._x,n+=this._y,this._x+=t+2}const o={x:r,y:n,texture:this._texture};return this._innerSpriteFrames.push(t),o}removeSpriteFrame(t){re(this._innerSpriteFrames,t)}deleteInnerTexture(t){t&&this._innerTextureInfos[t.getId()]&&(delete this._innerTextureInfos[t.getId()],this._count--)}isEmpty(){return this._count<=0}reset(){this._x=2,this._y=2,this._nextY=2;const t=this._innerSpriteFrames;for(let e=0,i=t.length;e<i;e++){const i=t[e];i.isValid&&i._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}}destroy(){this.reset(),this._texture.destroy()}}t("Atlas",vf);class Sf extends ff{initWithSize(t,e,i=35){this.reset({width:t,height:e,format:i})}drawTextureAt(t,e,i){const s=this.getGFXTexture();if(!t||!s)return;const r=this._getGFXDevice();if(!r)return void j(16363);const n=new t_;n.texOffset.x=e,n.texOffset.y=i,n.texExtent.width=t.width,n.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],s,[n])}}const Tf=t("SceneAsset",jsb.SceneAsset);a.SceneAsset=Tf;const wf=Tf.prototype;Object.defineProperty(wf,"scene",{enumerable:!0,configurable:!0,get(){return this._scene||(this._scene=this.getScene()),this._scene},set(t){this._scene=t,this.setScene(t)}}),wf._ctor=function(){jsb.Asset.prototype._ctor.apply(this,arguments),this._scene=null},function(t,e=dm){const{SceneAsset:i}={...t};e((()=>{vh(i.prototype,"scene",(()=>null))}),"serializable","scene"),e((()=>{Ph(i.prototype)}),"editable","scene"),e((()=>{ah("cc.SceneAsset")(i)}),"ccclass",null)}({SceneAsset:Tf}),at({SystemEventType:{newName:"Input.EventType",since:"3.3.0",removed:!1}}),at({SystemEvent:{newName:"Input",since:"3.4.0",removed:!1},systemEvent:{newName:"input",since:"3.4.0",removed:!1}});class xf{constructor(t,e){this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=t,this.bubbles=!!e}unuse(){this.type=xf.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=xf.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1}reuse(t,e){this.type=t,this.bubbles=e||!1}isStopped(){return this.propagationStopped||this.propagationImmediateStopped}getCurrentTarget(){return this.currentTarget}getType(){return this.type}}t("Event",xf),xf.NO_TYPE="no_type",xf.TOUCH="touch",xf.MOUSE="mouse",xf.KEYBOARD="keyboard",xf.ACCELERATION="acceleration",xf.NONE=0,xf.CAPTURING_PHASE=1,xf.AT_TARGET=2,xf.BUBBLING_PHASE=3,a.Event=xf;class Cf extends xf{constructor(t,e){super("devicemotion",e),this.acc=t}}t("EventAcceleration",Cf),xf.EventAcceleration=Cf;class Af extends xf{get isPressed(){return this._isPressed}constructor(t,e,i){"boolean"==typeof e&&(e=e?"keydown":"keyup"),super(e,i),this.rawEvent=void 0,this._isPressed="keyup"!==e,"number"==typeof t?this.keyCode=t:(this.keyCode=t.keyCode,this.rawEvent=t),this.windowId=0}}t("EventKeyboard",Af),xf.EventKeyboard=Af;class Df extends xf{get eventType(){return this._eventType}constructor(t,e,i,s){super(t,e),this.movementX=0,this.movementY=0,this.windowId=0,this.preventSwallow=!1,this._button=Df.BUTTON_MISSING,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0,this._eventType=t,i&&(this._prevX=i.x,this._prevY=i.y),this.windowId=null!=s?s:this.windowId}setScrollData(t,e){this._scrollX=t,this._scrollY=e}getScrollX(){return this._scrollX}getScrollY(){return this._scrollY}setLocation(t,e){this._x=t,this._y=e}getLocation(t){return t||(t=new kr),kr.set(t,this._x,this._y),t}getLocationInView(t){return t||(t=new kr),kr.set(t,this._x,a.view._designResolutionSize.height-this._y),t}getUILocation(t){return t||(t=new kr),kr.set(t,this._x,this._y),a.view._convertToUISpace(t),t}getPreviousLocation(t){return t||(t=new kr),kr.set(t,this._prevX,this._prevY),t}getUIPreviousLocation(t){return t||(t=new kr),kr.set(t,this._prevX,this._prevY),a.view._convertToUISpace(t),t}getDelta(t){return t||(t=new kr),kr.set(t,this._x-this._prevX,this._y-this._prevY),t}getDeltaX(){return this._x-this._prevX}getDeltaY(){return this._y-this._prevY}getUIDelta(t){t||(t=new kr);const e=a.view;return kr.set(t,(this._x-this._prevX)/e.getScaleX(),(this._y-this._prevY)/e.getScaleY()),t}getUIDeltaX(){return(this._x-this._prevX)/a.view.getScaleX()}getUIDeltaY(){return(this._y-this._prevY)/a.view.getScaleY()}setButton(t){this._button=t}getButton(){return this._button}getLocationX(){return this._x}getLocationY(){return this._y}getUILocationX(){const t=a.view,e=t.getViewportRect();return(this._x-e.x)/t.getScaleX()}getUILocationY(){const t=a.view,e=t.getViewportRect();return(this._y-e.y)/t.getScaleY()}}t("EventMouse",Df),Df.BUTTON_MISSING=-1,Df.BUTTON_LEFT=0,Df.BUTTON_RIGHT=2,Df.BUTTON_MIDDLE=1,Df.BUTTON_4=3,Df.BUTTON_5=4,Df.BUTTON_6=5,Df.BUTTON_7=6,Df.BUTTON_8=7,xf.EventMouse=Df;const Ef=new kr;class If extends xf{constructor(t,e,i,s=[]){super(i,e),this.touch=null,this.simulate=!1,this.windowId=0,this.preventSwallow=!1,this._eventCode=i,this._touches=t||[],this._allTouches=s}getEventCode(){return this._eventCode}getTouches(){return this._touches}getAllTouches(){return this._allTouches}setLocation(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)}getLocation(t){return this.touch?this.touch.getLocation(t):new kr}getUILocation(t){return this.touch?this.touch.getUILocation(t):new kr}getLocationInView(t){return this.touch?this.touch.getLocationInView(t):new kr}getPreviousLocation(t){return this.touch?this.touch.getPreviousLocation(t):new kr}getStartLocation(t){return this.touch?this.touch.getStartLocation(t):new kr}getUIStartLocation(t){return this.touch?this.touch.getUIStartLocation(t):new kr}getID(){return this.touch?this.touch.getID():null}getDelta(t){return this.touch?this.touch.getDelta(t):new kr}getUIDelta(t){return this.touch?this.touch.getUIDelta(t):new kr}getDeltaX(){return this.touch?this.touch.getDelta(Ef).x:0}getDeltaY(){return this.touch?this.touch.getDelta(Ef).y:0}getLocationX(){return this.touch?this.touch.getLocationX():0}getLocationY(){return this.touch?this.touch.getLocationY():0}}t("EventTouch",If),If.MAX_TOUCHES=5,xf.EventTouch=If;class Mf extends xf{constructor(t,e){super(t,!1),this.gamepad=e}}t("EventGamepad",Mf);class Pf extends xf{constructor(t,e){super(t,!1),this.handleInputDevice=e}}t("EventHandle",Pf);class Of extends xf{constructor(t,e){super(t,!1),this.hmdInputDevice=e}}t("EventHMD",Of);class Rf extends xf{constructor(t,e){super(t,!1),this.handheldInputDevice=e}}t("EventHandheld",Rf);class Bf{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.z=i,this.timestamp=s}}t("Acceleration",Bf);const Ff=t("SystemEventType",{TOUCH_START:"touch-start",TOUCH_MOVE:"touch-move",TOUCH_END:"touch-end",TOUCH_CANCEL:"touch-cancel",MOUSE_DOWN:"mouse-down",MOUSE_MOVE:"mouse-move",MOUSE_UP:"mouse-up",MOUSE_WHEEL:"mouse-wheel",MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave",KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion",TRANSFORM_CHANGED:"transform-changed",SCENE_CHANGED_FOR_PERSISTS:"scene-changed-for-persists",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",PARENT_CHANGED:"parent-changed",NODE_DESTROYED:"node-destroyed",LAYER_CHANGED:"layer-changed",SIBLING_ORDER_CHANGED:"sibling-order-changed"});a.SystemEventType=Ff,t("KeyCode",{NONE:0,MOBILE_BACK:6,BACKSPACE:8,TAB:9,ENTER:13,SHIFT_LEFT:16,CTRL_LEFT:17,ALT_LEFT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,INSERT:45,DELETE:46,DIGIT_0:48,DIGIT_1:49,DIGIT_2:50,DIGIT_3:51,DIGIT_4:52,DIGIT_5:53,DIGIT_6:54,DIGIT_7:55,DIGIT_8:56,DIGIT_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,NUM_0:96,NUM_1:97,NUM_2:98,NUM_3:99,NUM_4:100,NUM_5:101,NUM_6:102,NUM_7:103,NUM_8:104,NUM_9:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_SUBTRACT:109,NUM_DECIMAL:110,NUM_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUAL:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,BACK_QUOTE:192,BRACKET_LEFT:219,BACKSLASH:220,BRACKET_RIGHT:221,QUOTE:222,SHIFT_RIGHT:2e3,CTRL_RIGHT:2001,ALT_RIGHT:2002,NUM_ENTER:2003});const Nf=new kr;class Lf{get lastModified(){return this._lastModified}constructor(t,e,i=0){this._point=new kr,this._prevPoint=new kr,this._lastModified=0,this._id=0,this._startPoint=new kr,this._startPointCaptured=!1,this.setTouchInfo(i,t,e)}getLocation(t){return t||(t=new kr),t.set(this._point.x,this._point.y),t}getLocationX(){return this._point.x}getLocationY(){return this._point.y}getUILocation(t){return t||(t=new kr),t.set(this._point.x,this._point.y),a.view._convertToUISpace(t),t}getUILocationX(){const t=a.view,e=t.getViewportRect();return(this._point.x-e.x)/t.getScaleX()}getUILocationY(){const t=a.view,e=t.getViewportRect();return(this._point.y-e.y)/t.getScaleY()}getPreviousLocation(t){return t||(t=new kr),t.set(this._prevPoint.x,this._prevPoint.y),t}getUIPreviousLocation(t){return t||(t=new kr),t.set(this._prevPoint.x,this._prevPoint.y),a.view._convertToUISpace(t),t}getStartLocation(t){return t||(t=new kr),t.set(this._startPoint.x,this._startPoint.y),t}getUIStartLocation(t){return t||(t=new kr),t.set(this._startPoint.x,this._startPoint.y),a.view._convertToUISpace(t),t}getDelta(t){return t||(t=new kr),t.set(this._point),t.subtract(this._prevPoint),t}getUIDelta(t){t||(t=new kr),Nf.set(this._point),Nf.subtract(this._prevPoint);const e=a.view;return t.set(e.getScaleX(),e.getScaleY()),kr.divide(t,Nf,t),t}getLocationInView(t){return t||(t=new kr),t.set(this._point.x,a.view._designResolutionSize.height-this._point.y),t}getPreviousLocationInView(t){return t||(t=new kr),t.set(this._prevPoint.x,a.view._designResolutionSize.height-this._prevPoint.y),t}getStartLocationInView(t){return t||(t=new kr),t.set(this._startPoint.x,a.view._designResolutionSize.height-this._startPoint.y),t}getID(){return this._id}setTouchInfo(t=0,e=0,i=0){this._prevPoint=this._point,this._point=new kr(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=new kr(this._point),this._startPointCaptured=!0)}setPoint(t,e){"object"==typeof t?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t||0,this._point.y=e||0),this._lastModified=a.game.frameStartTime}setPrevPoint(t,e){this._prevPoint="object"==typeof t?new kr(t.x,t.y):new kr(t||0,e||0),this._lastModified=a.game.frameStartTime}clone(){const t=this.getID();this.getStartLocation(Nf);const e=new Lf(Nf.x,Nf.y,t);return this.getLocation(Nf),e.setPoint(Nf.x,Nf.y),this.getPreviousLocation(Nf),e.setPrevPoint(Nf),e}}t("Touch",Lf),a.Touch=Lf;class kf{constructor(){this._intervalInSeconds=.2,this._intervalId=void 0,this._isEnabled=!1,this._eventTarget=new zo,this._didAccelerateFunc=this._didAccelerate.bind(this)}_didAccelerate(){const t=jsb.device.getDeviceMotionValue();let e=.1*t[3],i=.1*t[4];const s=.1*t[5],r=pa.orientation,n=e;r===Te.LANDSCAPE_RIGHT?(e=-i,i=n):r===Te.LANDSCAPE_LEFT?(e=i,i=-n):r===Te.PORTRAIT_UPSIDE_DOWN&&(e=-e,i=-i),$o.os!==Go.ANDROID&&$o.os!==Go.OHOS&&$o.os!==Go.OPENHARMONY||(e=-e,i=-i);const o=performance.now(),a=new Bf(e,i,s,o),h=new Cf(a);this._eventTarget.emit("devicemotion",h)}start(){this._intervalId&&clearInterval(this._intervalId),this._intervalId=setInterval(this._didAccelerateFunc,1e3*this._intervalInSeconds),jsb.device.setAccelerometerInterval(this._intervalInSeconds),jsb.device.setAccelerometerEnabled(!0),this._isEnabled=!0}stop(){this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),jsb.device.setAccelerometerEnabled(!1),this._isEnabled=!1}setInterval(t){this._intervalInSeconds=t/1e3,jsb.device.setAccelerometerInterval(this._intervalInSeconds),this._isEnabled&&(jsb.device.setAccelerometerEnabled(!1),jsb.device.setAccelerometerEnabled(!0))}on(t,e,i){this._eventTarget.on(t,e,i)}}class zf{}class Uf extends zf{getValue(){throw new Error("Method not implemented.")}}class Vf extends zf{getValue(){throw new Error("Method not implemented.")}}class jf extends zf{getValue(){throw new Error("Method not implemented.")}}class Hf extends zf{getValue(){throw new Error("Method not implemented.")}}class Gf extends Uf{constructor(t){super(),this.positive=t.positive,this.negative=t.negative}getValue(){const t=this.positive.getValue(),e=this.negative.getValue();return Math.abs(t)>Math.abs(e)?t:-e}}class Wf extends Vf{constructor(t){super(),this.up=t.up,this.down=t.down,this.left=t.left,this.right=t.right,this.xAxis=new Gf({positive:this.right,negative:this.left}),this.yAxis=new Gf({positive:this.up,negative:this.down})}getValue(){return new kr(this.xAxis.getValue(),this.yAxis.getValue())}}class Xf extends Uf{getValue(){return super.getValue()}}class Yf extends Wf{}class qf extends Wf{}class $f extends Hf{getValue(){return super.getValue()}}class Kf extends jf{getValue(){return super.getValue()}}class Zf extends Uf{getValue(){return super.getValue()}}var Qf;!function(t){t[t.BUTTON_SOUTH=0]="BUTTON_SOUTH",t[t.BUTTON_EAST=1]="BUTTON_EAST",t[t.BUTTON_WEST=2]="BUTTON_WEST",t[t.BUTTON_NORTH=3]="BUTTON_NORTH",t[t.NS_MINUS=4]="NS_MINUS",t[t.NS_PLUS=5]="NS_PLUS",t[t.BUTTON_L1=6]="BUTTON_L1",t[t.BUTTON_L2=7]="BUTTON_L2",t[t.BUTTON_L3=8]="BUTTON_L3",t[t.BUTTON_R1=9]="BUTTON_R1",t[t.BUTTON_R2=10]="BUTTON_R2",t[t.BUTTON_R3=11]="BUTTON_R3",t[t.DPAD_UP=12]="DPAD_UP",t[t.DPAD_DOWN=13]="DPAD_DOWN",t[t.DPAD_LEFT=14]="DPAD_LEFT",t[t.DPAD_RIGHT=15]="DPAD_RIGHT",t[t.LEFT_STICK_UP=16]="LEFT_STICK_UP",t[t.LEFT_STICK_DOWN=17]="LEFT_STICK_DOWN",t[t.LEFT_STICK_LEFT=18]="LEFT_STICK_LEFT",t[t.LEFT_STICK_RIGHT=19]="LEFT_STICK_RIGHT",t[t.RIGHT_STICK_UP=20]="RIGHT_STICK_UP",t[t.RIGHT_STICK_DOWN=21]="RIGHT_STICK_DOWN",t[t.RIGHT_STICK_LEFT=22]="RIGHT_STICK_LEFT",t[t.RIGHT_STICK_RIGHT=23]="RIGHT_STICK_RIGHT",t[t.ROKID_MENU=24]="ROKID_MENU",t[t.ROKID_START=25]="ROKID_START"}(Qf||(Qf={}));const Jf={1:Qf.BUTTON_EAST,2:Qf.BUTTON_SOUTH,3:Qf.BUTTON_NORTH,4:Qf.BUTTON_WEST,5:Qf.BUTTON_L1,6:Qf.BUTTON_R1,7:Qf.NS_MINUS,8:Qf.NS_PLUS,9:Qf.BUTTON_L3,10:Qf.BUTTON_R3,11:Qf.ROKID_MENU,12:Qf.ROKID_START};class ty{get buttonNorth(){return this._buttonNorth}get buttonEast(){return this._buttonEast}get buttonWest(){return this._buttonWest}get buttonSouth(){return this._buttonSouth}get buttonL1(){return this._buttonL1}get buttonL2(){return this._buttonL2}get buttonL3(){return this._buttonL3}get buttonR1(){return this._buttonR1}get buttonR2(){return this._buttonR2}get buttonR3(){return this._buttonR3}get buttonShare(){return this._buttonShare}get buttonOptions(){return this._buttonOptions}get dpad(){return this._dpad}get leftStick(){return this._leftStick}get rightStick(){return this._rightStick}get buttonStart(){return this._buttonStart}get gripLeft(){return this._gripLeft}get gripRight(){return this._gripRight}get handLeftPosition(){return this._handLeftPosition}get handLeftOrientation(){return this._handLeftOrientation}get handRightPosition(){return this._handRightPosition}get handRightOrientation(){return this._handRightOrientation}get aimLeftPosition(){return this._aimLeftPosition}get aimLeftOrientation(){return this._aimLeftOrientation}get aimRightPosition(){return this._aimRightPosition}get aimRightOrientation(){return this._aimRightOrientation}get deviceId(){return this._deviceId}get connected(){return this._connected}constructor(t){this._deviceId=-1,this._connected=!1,this._nativeButtonState={[Qf.BUTTON_SOUTH]:0,[Qf.BUTTON_EAST]:0,[Qf.BUTTON_WEST]:0,[Qf.BUTTON_NORTH]:0,[Qf.NS_MINUS]:0,[Qf.NS_PLUS]:0,[Qf.BUTTON_L1]:0,[Qf.BUTTON_L2]:0,[Qf.BUTTON_L3]:0,[Qf.BUTTON_R1]:0,[Qf.BUTTON_R2]:0,[Qf.BUTTON_R3]:0,[Qf.DPAD_UP]:0,[Qf.DPAD_DOWN]:0,[Qf.DPAD_LEFT]:0,[Qf.DPAD_RIGHT]:0,[Qf.LEFT_STICK_UP]:0,[Qf.LEFT_STICK_DOWN]:0,[Qf.LEFT_STICK_LEFT]:0,[Qf.LEFT_STICK_RIGHT]:0,[Qf.RIGHT_STICK_UP]:0,[Qf.RIGHT_STICK_DOWN]:0,[Qf.RIGHT_STICK_LEFT]:0,[Qf.RIGHT_STICK_RIGHT]:0,[Qf.ROKID_MENU]:0,[Qf.ROKID_START]:0},this._deviceId=t,this._initInputSource()}static _init(){$o.hasFeature(Xo.EVENT_GAMEPAD)&&ty._registerEvent()}static _on(t,e,i){ty._eventTarget.on(t,e,i)}static _removeInputDevice(t){const e=ty.all.findIndex((e=>e.deviceId===t));-1!==e&&ie(ty.all,e)}static _getInputDevice(t){return ty.all.find((e=>e.deviceId===t))}static _createInputDevice(t,e){const i=new ty(t);return i._connected=e,ty.all.push(i),i}static _getOrCreateInputDevice(t,e){let i=ty._getInputDevice(t);return i||(i=ty._createInputDevice(t,e)),i._connected=e,i}static _registerEvent(){jsb.onControllerInput=t=>{for(let e=0;e<t.length;++e){const i=t[e],s=ty._getOrCreateInputDevice(i.id,!0);s._updateNativeButtonState(i),ty._eventTarget.emit("gamepad-input",new Mf("gamepad-input",s))}},jsb.onControllerChange=t=>{for(let e=0;e<t.length;++e){const i=t[e];let s=ty._getInputDevice(i);s||(s=ty._createInputDevice(i,!0),ty._eventTarget.emit("gamepad-change",new Mf("gamepad-change",s)))}const e=ty.all;for(let i=0;i<e.length;++i){const s=e[i];t.includes(s.deviceId)||(ty._removeInputDevice(s.deviceId),s._connected=!1,ty._eventTarget.emit("gamepad-change",new Mf("gamepad-change",s)))}}}_axisToButtons(t){const e=Math.abs(t);return t>0?{negative:0,positive:e}:t<0?{negative:e,positive:0}:{negative:0,positive:0}}_updateNativeButtonState(t){const{buttonInfoList:e,axisInfoList:i}=t;for(let t=0;t<e.length;++t){const i=e[t],s=Jf[i.code];this._nativeButtonState[s]=i.isPressed?1:0}for(let t=0;t<i.length;++t){const e=i[t],{code:s,value:r}=e;let n,o,a;switch(s){case 1:n=Qf.DPAD_LEFT,o=Qf.DPAD_RIGHT,a=this._axisToButtons(r);break;case 2:n=Qf.DPAD_DOWN,o=Qf.DPAD_UP,a=this._axisToButtons(r);break;case 3:n=Qf.LEFT_STICK_LEFT,o=Qf.LEFT_STICK_RIGHT,a=this._axisToButtons(r);break;case 4:n=Qf.LEFT_STICK_DOWN,o=Qf.LEFT_STICK_UP,a=this._axisToButtons(r);break;case 5:n=Qf.RIGHT_STICK_LEFT,o=Qf.RIGHT_STICK_RIGHT,a=this._axisToButtons(r);break;case 6:n=Qf.RIGHT_STICK_DOWN,o=Qf.RIGHT_STICK_UP,a=this._axisToButtons(r);break;default:7===s?this._nativeButtonState[Qf.BUTTON_L2]=r:8===s&&(this._nativeButtonState[Qf.BUTTON_R2]=r)}n&&o&&a&&(this._nativeButtonState[n]=a.negative,this._nativeButtonState[o]=a.positive)}}_initInputSource(){this._buttonNorth=new Xf,this._buttonNorth.getValue=()=>this._nativeButtonState[Qf.BUTTON_NORTH],this._buttonEast=new Xf,this._buttonEast.getValue=()=>this._nativeButtonState[Qf.BUTTON_EAST],this._buttonWest=new Xf,this._buttonWest.getValue=()=>this._nativeButtonState[Qf.BUTTON_WEST],this._buttonSouth=new Xf,this._buttonSouth.getValue=()=>this._nativeButtonState[Qf.BUTTON_SOUTH],this._buttonL1=new Xf,this._buttonL1.getValue=()=>this._nativeButtonState[Qf.BUTTON_L1],this._buttonL2=new Xf,this._buttonL2.getValue=()=>this._nativeButtonState[Qf.BUTTON_L2],this._buttonL3=new Xf,this._buttonL3.getValue=()=>this._nativeButtonState[Qf.BUTTON_L3],this._buttonR1=new Xf,this._buttonR1.getValue=()=>this._nativeButtonState[Qf.BUTTON_R1],this._buttonR2=new Xf,this._buttonR2.getValue=()=>this._nativeButtonState[Qf.BUTTON_R2],this._buttonR3=new Xf,this._buttonR3.getValue=()=>this._nativeButtonState[Qf.BUTTON_R3],this._buttonShare=new Xf,this._buttonShare.getValue=()=>this._nativeButtonState[Qf.NS_MINUS],this._buttonOptions=new Xf,this._buttonOptions.getValue=()=>this._nativeButtonState[Qf.NS_PLUS]||this._nativeButtonState[Qf.ROKID_MENU];const t=new Xf;t.getValue=()=>this._nativeButtonState[Qf.DPAD_UP];const e=new Xf;e.getValue=()=>this._nativeButtonState[Qf.DPAD_DOWN];const i=new Xf;i.getValue=()=>this._nativeButtonState[Qf.DPAD_LEFT];const s=new Xf;s.getValue=()=>this._nativeButtonState[Qf.DPAD_RIGHT],this._dpad=new Yf({up:t,down:e,left:i,right:s});const r=new Xf;r.getValue=()=>this._nativeButtonState[Qf.LEFT_STICK_UP];const n=new Xf;n.getValue=()=>this._nativeButtonState[Qf.LEFT_STICK_DOWN];const o=new Xf;o.getValue=()=>this._nativeButtonState[Qf.LEFT_STICK_LEFT];const a=new Xf;a.getValue=()=>this._nativeButtonState[Qf.LEFT_STICK_RIGHT],this._leftStick=new qf({up:r,down:n,left:o,right:a});const h=new Xf;h.getValue=()=>this._nativeButtonState[Qf.RIGHT_STICK_UP];const l=new Xf;l.getValue=()=>this._nativeButtonState[Qf.RIGHT_STICK_DOWN];const c=new Xf;c.getValue=()=>this._nativeButtonState[Qf.RIGHT_STICK_LEFT];const u=new Xf;u.getValue=()=>this._nativeButtonState[Qf.RIGHT_STICK_RIGHT],this._rightStick=new qf({up:h,down:l,left:c,right:u}),this._buttonStart=new Xf,this._buttonStart.getValue=()=>this._nativeButtonState[Qf.ROKID_START],this._gripLeft=new Xf,this._gripLeft.getValue=()=>0,this._gripRight=new Xf,this._gripRight.getValue=()=>0,this._handLeftPosition=new Kf,this._handLeftPosition.getValue=()=>Ms.ZERO,this._handLeftOrientation=new $f,this._handLeftOrientation.getValue=()=>sr.IDENTITY,this._handRightPosition=new Kf,this._handRightPosition.getValue=()=>Ms.ZERO,this._handRightOrientation=new $f,this._handRightOrientation.getValue=()=>sr.IDENTITY,this._aimLeftPosition=new Kf,this._aimLeftPosition.getValue=()=>Ms.ZERO,this._aimLeftOrientation=new $f,this._aimLeftOrientation.getValue=()=>sr.IDENTITY,this._aimRightPosition=new Kf,this._aimRightPosition.getValue=()=>Ms.ZERO,this._aimRightOrientation=new $f,this._aimRightOrientation.getValue=()=>sr.IDENTITY}}var ey,iy,sy,ry,ny;ty.all=[],ty.xr=null,ty._eventTarget=new zo,function(t){t[t.BUTTON_EAST=0]="BUTTON_EAST",t[t.BUTTON_SOUTH=1]="BUTTON_SOUTH",t[t.BUTTON_WEST=2]="BUTTON_WEST",t[t.BUTTON_NORTH=3]="BUTTON_NORTH",t[t.BUTTON_TRIGGER_LEFT=4]="BUTTON_TRIGGER_LEFT",t[t.BUTTON_TRIGGER_RIGHT=5]="BUTTON_TRIGGER_RIGHT",t[t.TRIGGER_LEFT=6]="TRIGGER_LEFT",t[t.TRIGGER_RIGHT=7]="TRIGGER_RIGHT",t[t.GRIP_LEFT=8]="GRIP_LEFT",t[t.GRIP_RIGHT=9]="GRIP_RIGHT",t[t.BUTTON_LEFT_STICK=10]="BUTTON_LEFT_STICK",t[t.LEFT_STICK_UP=11]="LEFT_STICK_UP",t[t.LEFT_STICK_DOWN=12]="LEFT_STICK_DOWN",t[t.LEFT_STICK_LEFT=13]="LEFT_STICK_LEFT",t[t.LEFT_STICK_RIGHT=14]="LEFT_STICK_RIGHT",t[t.BUTTON_RIGHT_STICK=15]="BUTTON_RIGHT_STICK",t[t.RIGHT_STICK_UP=16]="RIGHT_STICK_UP",t[t.RIGHT_STICK_DOWN=17]="RIGHT_STICK_DOWN",t[t.RIGHT_STICK_LEFT=18]="RIGHT_STICK_LEFT",t[t.RIGHT_STICK_RIGHT=19]="RIGHT_STICK_RIGHT",t[t.ROKID_MENU=20]="ROKID_MENU",t[t.ROKID_START=21]="ROKID_START"}(ey||(ey={})),function(t){t[t.HAND_LEFT=0]="HAND_LEFT",t[t.HAND_RIGHT=1]="HAND_RIGHT",t[t.AIM_LEFT=2]="AIM_LEFT",t[t.AIM_RIGHT=3]="AIM_RIGHT"}(iy||(iy={})),function(t){t[t.UNDEFINE=0]="UNDEFINE",t[t.A=1]="A",t[t.B=2]="B",t[t.X=3]="X",t[t.Y=4]="Y",t[t.L1=5]="L1",t[t.R1=6]="R1",t[t.MINUS=7]="MINUS",t[t.PLUS=8]="PLUS",t[t.L3=9]="L3",t[t.R3=10]="R3",t[t.MENU=11]="MENU",t[t.START=12]="START",t[t.TRIGGER_LEFT=13]="TRIGGER_LEFT",t[t.TRIGGER_RIGHT=14]="TRIGGER_RIGHT"}(sy||(sy={})),function(t){t[t.UNDEFINE=0]="UNDEFINE",t[t.X=1]="X",t[t.Y=2]="Y",t[t.LEFT_STICK_X=3]="LEFT_STICK_X",t[t.LEFT_STICK_Y=4]="LEFT_STICK_Y",t[t.RIGHT_STICK_X=5]="RIGHT_STICK_X",t[t.RIGHT_STICK_Y=6]="RIGHT_STICK_Y",t[t.L2=7]="L2",t[t.R2=8]="R2",t[t.LEFT_GRIP=9]="LEFT_GRIP",t[t.RIGHT_GRIP=10]="RIGHT_GRIP"}(ry||(ry={})),function(t){t[t.UNDEFINE=0]="UNDEFINE",t[t.A=1]="A",t[t.B=2]="B",t[t.X=3]="X",t[t.Y=4]="Y",t[t.LEFT_TRIGGER=5]="LEFT_TRIGGER",t[t.RIGHT_TRIGGER=6]="RIGHT_TRIGGER",t[t.LEFT_THUMBSTICK=7]="LEFT_THUMBSTICK",t[t.RIGHT_THUMBSTICK=8]="RIGHT_THUMBSTICK"}(ny||(ny={}));const oy={1:ey.BUTTON_EAST,2:ey.BUTTON_SOUTH,3:ey.BUTTON_NORTH,4:ey.BUTTON_WEST,9:ey.BUTTON_LEFT_STICK,10:ey.BUTTON_RIGHT_STICK,11:ey.ROKID_MENU,12:ey.ROKID_START,13:ey.BUTTON_TRIGGER_LEFT,14:ey.BUTTON_TRIGGER_RIGHT};class ay{get buttonNorth(){return this._buttonNorth}get buttonEast(){return this._buttonEast}get buttonWest(){return this._buttonWest}get buttonSouth(){return this._buttonSouth}get buttonTriggerLeft(){return this._buttonTriggerLeft}get buttonTriggerRight(){return this._buttonTriggerRight}get triggerLeft(){return this._triggerLeft}get triggerRight(){return this._triggerRight}get gripLeft(){return this._gripLeft}get gripRight(){return this._gripRight}get leftStick(){return this._leftStick}get rightStick(){return this._rightStick}get buttonLeftStick(){return this._buttonLeftStick}get buttonRightStick(){return this._buttonRightStick}get buttonOptions(){return this._buttonOptions}get buttonStart(){return this._buttonStart}get handLeftPosition(){return this._handLeftPosition}get handLeftOrientation(){return this._handLeftOrientation}get handRightPosition(){return this._handRightPosition}get handRightOrientation(){return this._handRightOrientation}get aimLeftPosition(){return this._aimLeftPosition}get aimLeftOrientation(){return this._aimLeftOrientation}get aimRightPosition(){return this._aimRightPosition}get aimRightOrientation(){return this._aimRightOrientation}get touchButtonA(){return this._touchButtonA}get touchButtonB(){return this._touchButtonB}get touchButtonX(){return this._touchButtonX}get touchButtonY(){return this._touchButtonY}get touchButtonTriggerLeft(){return this._touchButtonTriggerLeft}get touchButtonTriggerRight(){return this._touchButtonTriggerRight}get touchButtonThumbStickLeft(){return this._touchButtonThumbStickLeft}get touchButtonThumbStickRight(){return this._touchButtonThumbStickRight}constructor(){this._eventTarget=new zo,this._nativeButtonState={[ey.BUTTON_SOUTH]:0,[ey.BUTTON_EAST]:0,[ey.BUTTON_WEST]:0,[ey.BUTTON_NORTH]:0,[ey.BUTTON_TRIGGER_LEFT]:0,[ey.BUTTON_TRIGGER_RIGHT]:0,[ey.TRIGGER_LEFT]:0,[ey.TRIGGER_RIGHT]:0,[ey.GRIP_LEFT]:0,[ey.GRIP_RIGHT]:0,[ey.LEFT_STICK_UP]:0,[ey.LEFT_STICK_DOWN]:0,[ey.LEFT_STICK_LEFT]:0,[ey.LEFT_STICK_RIGHT]:0,[ey.RIGHT_STICK_UP]:0,[ey.RIGHT_STICK_DOWN]:0,[ey.RIGHT_STICK_LEFT]:0,[ey.RIGHT_STICK_RIGHT]:0,[ey.BUTTON_LEFT_STICK]:0,[ey.BUTTON_RIGHT_STICK]:0,[ey.ROKID_MENU]:0,[ey.ROKID_START]:0},this._nativeTouchState={[ny.UNDEFINE]:0,[ny.A]:0,[ny.B]:0,[ny.X]:0,[ny.Y]:0,[ny.LEFT_TRIGGER]:0,[ny.RIGHT_TRIGGER]:0,[ny.LEFT_THUMBSTICK]:0,[ny.RIGHT_THUMBSTICK]:0},this._nativePoseState={[iy.HAND_LEFT]:{position:Ms.ZERO,orientation:sr.IDENTITY},[iy.HAND_RIGHT]:{position:Ms.ZERO,orientation:sr.IDENTITY},[iy.AIM_LEFT]:{position:Ms.ZERO,orientation:sr.IDENTITY},[iy.AIM_RIGHT]:{position:Ms.ZERO,orientation:sr.IDENTITY}},this._initInputSource(),this._registerEvent()}_registerEvent(){jsb.onHandleInput=t=>{for(let e=0;e<t.length;++e){const i=t[e];this._updateNativeButtonState(i),this._eventTarget.emit("handle-input",new Pf("handle-input",this))}},jsb.onHandlePoseInput=t=>{for(let e=0;e<t.length;++e){const i=t[e];this._updateNativePoseState(i)}this._eventTarget.emit("handle-pose-input",new Pf("handle-pose-input",this))}}_on(t,e,i){this._eventTarget.on(t,e,i)}_axisToButtons(t){const e=Math.abs(t);return t>0?{negative:0,positive:e}:t<0?{negative:e,positive:0}:{negative:0,positive:0}}_updateNativeButtonState(t){const{buttonInfoList:e,axisInfoList:i,touchInfoList:s}=t;for(let t=0;t<e.length;++t){const i=e[t],s=oy[i.code];this._nativeButtonState[s]=i.isPressed?1:0}for(let t=0;t<i.length;++t){const e=i[t],{code:s,value:r}=e;let n,o,a;switch(s){case ry.LEFT_STICK_X:n=ey.LEFT_STICK_LEFT,o=ey.LEFT_STICK_RIGHT,a=this._axisToButtons(r);break;case ry.LEFT_STICK_Y:n=ey.LEFT_STICK_DOWN,o=ey.LEFT_STICK_UP,a=this._axisToButtons(r);break;case ry.RIGHT_STICK_X:n=ey.RIGHT_STICK_LEFT,o=ey.RIGHT_STICK_RIGHT,a=this._axisToButtons(r);break;case ry.RIGHT_STICK_Y:n=ey.RIGHT_STICK_DOWN,o=ey.RIGHT_STICK_UP,a=this._axisToButtons(r);break;case ry.L2:this._nativeButtonState[ey.TRIGGER_LEFT]=r;break;case ry.R2:this._nativeButtonState[ey.TRIGGER_RIGHT]=r;break;case ry.LEFT_GRIP:this._nativeButtonState[ey.GRIP_LEFT]=r;break;case ry.RIGHT_GRIP:this._nativeButtonState[ey.GRIP_RIGHT]=r}n&&o&&a&&(this._nativeButtonState[n]=a.negative,this._nativeButtonState[o]=a.positive)}if(s)for(let t=0;t<s.length;++t){const e=s[t],{code:i,value:r}=e;switch(i){case ny.A:case ny.B:case ny.X:case ny.Y:case ny.LEFT_TRIGGER:case ny.RIGHT_TRIGGER:case ny.LEFT_THUMBSTICK:case ny.RIGHT_THUMBSTICK:this._nativeTouchState[i]=r}}}_updateNativePoseState(t){switch(t.code){case 1:this._nativePoseState[iy.HAND_LEFT]={position:new Ms(t.x,t.y,t.z),orientation:new sr(t.quaternionX,t.quaternionY,t.quaternionZ,t.quaternionW)};break;case 2:this._nativePoseState[iy.AIM_LEFT]={position:new Ms(t.x,t.y,t.z),orientation:new sr(t.quaternionX,t.quaternionY,t.quaternionZ,t.quaternionW)};break;case 4:this._nativePoseState[iy.HAND_RIGHT]={position:new Ms(t.x,t.y,t.z),orientation:new sr(t.quaternionX,t.quaternionY,t.quaternionZ,t.quaternionW)};break;case 5:this._nativePoseState[iy.AIM_RIGHT]={position:new Ms(t.x,t.y,t.z),orientation:new sr(t.quaternionX,t.quaternionY,t.quaternionZ,t.quaternionW)}}}_initInputSource(){this._buttonNorth=new Xf,this._buttonNorth.getValue=()=>this._nativeButtonState[ey.BUTTON_NORTH],this._buttonEast=new Xf,this._buttonEast.getValue=()=>this._nativeButtonState[ey.BUTTON_EAST],this._buttonWest=new Xf,this._buttonWest.getValue=()=>this._nativeButtonState[ey.BUTTON_WEST],this._buttonSouth=new Xf,this._buttonSouth.getValue=()=>this._nativeButtonState[ey.BUTTON_SOUTH],this._buttonTriggerLeft=new Xf,this._buttonTriggerLeft.getValue=()=>this._nativeButtonState[ey.BUTTON_TRIGGER_LEFT],this._buttonTriggerRight=new Xf,this._buttonTriggerRight.getValue=()=>this._nativeButtonState[ey.BUTTON_TRIGGER_RIGHT],this._triggerLeft=new Xf,this._triggerLeft.getValue=()=>this._nativeButtonState[ey.TRIGGER_LEFT],this._triggerRight=new Xf,this._triggerRight.getValue=()=>this._nativeButtonState[ey.TRIGGER_RIGHT],this._gripLeft=new Xf,this._gripLeft.getValue=()=>this._nativeButtonState[ey.GRIP_LEFT],this._gripRight=new Xf,this._gripRight.getValue=()=>this._nativeButtonState[ey.GRIP_RIGHT],this._buttonLeftStick=new Xf,this._buttonLeftStick.getValue=()=>this._nativeButtonState[ey.BUTTON_LEFT_STICK];const t=new Xf;t.getValue=()=>this._nativeButtonState[ey.LEFT_STICK_UP];const e=new Xf;e.getValue=()=>this._nativeButtonState[ey.LEFT_STICK_DOWN];const i=new Xf;i.getValue=()=>this._nativeButtonState[ey.LEFT_STICK_LEFT];const s=new Xf;s.getValue=()=>this._nativeButtonState[ey.LEFT_STICK_RIGHT],this._leftStick=new qf({up:t,down:e,left:i,right:s}),this._buttonRightStick=new Xf,this._buttonRightStick.getValue=()=>this._nativeButtonState[ey.BUTTON_RIGHT_STICK];const r=new Xf;r.getValue=()=>this._nativeButtonState[ey.RIGHT_STICK_UP];const n=new Xf;n.getValue=()=>this._nativeButtonState[ey.RIGHT_STICK_DOWN];const o=new Xf;o.getValue=()=>this._nativeButtonState[ey.RIGHT_STICK_LEFT];const a=new Xf;a.getValue=()=>this._nativeButtonState[ey.RIGHT_STICK_RIGHT],this._rightStick=new qf({up:r,down:n,left:o,right:a}),this._buttonOptions=new Xf,this._buttonOptions.getValue=()=>this._nativeButtonState[ey.ROKID_MENU],this._buttonStart=new Xf,this._buttonStart.getValue=()=>this._nativeButtonState[ey.ROKID_START],this._handLeftPosition=new Kf,this._handLeftPosition.getValue=()=>this._nativePoseState[iy.HAND_LEFT].position,this._handLeftOrientation=new $f,this._handLeftOrientation.getValue=()=>this._nativePoseState[iy.HAND_LEFT].orientation,this._handRightPosition=new Kf,this._handRightPosition.getValue=()=>this._nativePoseState[iy.HAND_RIGHT].position,this._handRightOrientation=new $f,this._handRightOrientation.getValue=()=>this._nativePoseState[iy.HAND_RIGHT].orientation,this._aimLeftPosition=new Kf,this._aimLeftPosition.getValue=()=>this._nativePoseState[iy.AIM_LEFT].position,this._aimLeftOrientation=new $f,this._aimLeftOrientation.getValue=()=>this._nativePoseState[iy.AIM_LEFT].orientation,this._aimRightPosition=new Kf,this._aimRightPosition.getValue=()=>this._nativePoseState[iy.AIM_RIGHT].position,this._aimRightOrientation=new $f,this._aimRightOrientation.getValue=()=>this._nativePoseState[iy.AIM_RIGHT].orientation,this._touchButtonA=new Zf,this._touchButtonA.getValue=()=>this._nativeTouchState[ny.A],this._touchButtonB=new Zf,this._touchButtonB.getValue=()=>this._nativeTouchState[ny.B],this._touchButtonX=new Zf,this._touchButtonX.getValue=()=>this._nativeTouchState[ny.X],this._touchButtonY=new Zf,this._touchButtonY.getValue=()=>this._nativeTouchState[ny.Y],this._touchButtonTriggerLeft=new Zf,this._touchButtonTriggerLeft.getValue=()=>this._nativeTouchState[ny.LEFT_TRIGGER],this._touchButtonTriggerRight=new Zf,this._touchButtonTriggerRight.getValue=()=>this._nativeTouchState[ny.RIGHT_TRIGGER],this._touchButtonThumbStickLeft=new Zf,this._touchButtonThumbStickLeft.getValue=()=>this._nativeTouchState[ny.LEFT_THUMBSTICK],this._touchButtonThumbStickRight=new Zf,this._touchButtonThumbStickRight.getValue=()=>this._nativeTouchState[ny.RIGHT_THUMBSTICK]}}var hy,ly;!function(t){t[t.VIEW_LEFT=0]="VIEW_LEFT",t[t.VIEW_RIGHT=1]="VIEW_RIGHT",t[t.HEAD_MIDDLE=2]="HEAD_MIDDLE"}(hy||(hy={}));class cy{get viewLeftPosition(){return this._viewLeftPosition}get viewLeftOrientation(){return this._viewLeftOrientation}get viewRightPosition(){return this._viewRightPosition}get viewRightOrientation(){return this._viewRightOrientation}get headMiddlePosition(){return this._headMiddlePosition}get headMiddleOrientation(){return this._headMiddleOrientation}constructor(){this._eventTarget=new zo,this._nativePoseState={[hy.VIEW_LEFT]:{position:Ms.ZERO,orientation:sr.IDENTITY},[hy.VIEW_RIGHT]:{position:Ms.ZERO,orientation:sr.IDENTITY},[hy.HEAD_MIDDLE]:{position:Ms.ZERO,orientation:sr.IDENTITY}},this._initInputSource(),this._registerEvent()}_registerEvent(){jsb.onHMDPoseInput=t=>{for(let e=0;e<t.length;++e){const i=t[e];this._updateNativePoseState(i)}this._eventTarget.emit("hmd-pose-input",new Of("hmd-pose-input",this))}}_on(t,e,i){this._eventTarget.on(t,e,i)}_updateNativePoseState(t){switch(t.code){case 0:this._nativePoseState[hy.VIEW_LEFT]={position:new Ms(t.x,t.y,t.z),orientation:new sr(t.quaternionX,t.quaternionY,t.quaternionZ,t.quaternionW)};break;case 3:this._nativePoseState[hy.VIEW_RIGHT]={position:new Ms(t.x,t.y,t.z),orientation:new sr(t.quaternionX,t.quaternionY,t.quaternionZ,t.quaternionW)};break;case 6:this._nativePoseState[hy.HEAD_MIDDLE]={position:new Ms(t.x,t.y,t.z),orientation:new sr(t.quaternionX,t.quaternionY,t.quaternionZ,t.quaternionW)}}}_initInputSource(){this._viewLeftPosition=new Kf,this._viewLeftPosition.getValue=()=>this._nativePoseState[hy.VIEW_LEFT].position,this._viewLeftOrientation=new $f,this._viewLeftOrientation.getValue=()=>this._nativePoseState[hy.VIEW_LEFT].orientation,this._viewRightPosition=new Kf,this._viewRightPosition.getValue=()=>this._nativePoseState[hy.VIEW_RIGHT].position,this._viewRightOrientation=new $f,this._viewRightOrientation.getValue=()=>this._nativePoseState[hy.VIEW_RIGHT].orientation,this._headMiddlePosition=new Kf,this._headMiddlePosition.getValue=()=>this._nativePoseState[hy.HEAD_MIDDLE].position,this._headMiddleOrientation=new $f,this._headMiddleOrientation.getValue=()=>this._nativePoseState[hy.HEAD_MIDDLE].orientation}}!function(t){t[t.AR_MOBILE=0]="AR_MOBILE"}(ly||(ly={}));class uy{get handheldPosition(){return this._handheldPosition}get handheldOrientation(){return this._handheldOrientation}constructor(){this._eventTarget=new zo,this._nativePoseState={[ly.AR_MOBILE]:{position:Ms.ZERO,orientation:sr.IDENTITY}},this._initInputSource(),this._registerEvent()}_registerEvent(){jsb.onHandheldPoseInput=t=>{for(let e=0;e<t.length;++e){const i=t[e];this._updateNativePoseState(i)}this._eventTarget.emit("handheld-pose-input",new Rf("handheld-pose-input",this))}}_on(t,e,i){this._eventTarget.on(t,e,i)}_updateNativePoseState(t){7===t.code&&(this._nativePoseState[ly.AR_MOBILE]={position:new Ms(t.x,t.y,t.z),orientation:new sr(t.quaternionX,t.quaternionY,t.quaternionZ,t.quaternionW)})}_initInputSource(){this._handheldPosition=new Kf,this._handheldPosition.getValue=()=>this._nativePoseState[ly.AR_MOBILE].position,this._handheldOrientation=new $f,this._handheldOrientation.getValue=()=>this._nativePoseState[ly.AR_MOBILE].orientation}}const dy={Backspace:8,Tab:9,Enter:13,ShiftLeft:16,ControlLeft:17,AltLeft:18,ShiftRight:2e3,ControlRight:2001,AltRight:2002,Pause:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Insert:45,Delete:46,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDecimal:110,NumpadDivide:111,NumpadEnter:2003,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NumLock:144,ScrollLock:145,Semicolon:186,Equal:187,Comma:188,Minus:189,Period:190,Slash:191,Backquote:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222},_y={12:144,10048:96,10049:97,10050:98,10051:99,10052:100,10053:101,10054:102,10055:103,10056:104,10057:105,20013:2003,20016:2e3,20017:2001,20018:2002};function py(t){if(t.code){if(t.code in dy)return dy[t.code];console.error(`Can not find keyCode for code: ${t.code}`)}return _y[t.keyCode]||t.keyCode}class my{constructor(){this._eventTarget=new zo,this._keyStateMap={},this._handleKeyboardDown=void 0,this._handleKeyboardUp=void 0,this._handleKeyboardDown=t=>{const e=py(t);if(this._keyStateMap[e]){const e=this._getInputEvent(t,"key-pressing");this._eventTarget.emit("key-pressing",e)}else{const e=this._getInputEvent(t,"keydown");this._eventTarget.emit("keydown",e)}this._keyStateMap[e]=!0},this._handleKeyboardUp=t=>{const e=py(t),i=this._getInputEvent(t,"keyup");this._keyStateMap[e]=!1,this._eventTarget.emit("keyup",i)},this._registerEvent()}dispatchKeyboardDownEvent(t){this._handleKeyboardDown(t)}dispatchKeyboardUpEvent(t){this._handleKeyboardUp(t)}_registerEvent(){jsb.onKeyDown=this._handleKeyboardDown,jsb.onKeyUp=this._handleKeyboardUp}_getInputEvent(t,e){const i=py(t),s=new Af(i,e);return s.windowId=t.windowId,s}on(t,e,i){this._eventTarget.on(t,e,i)}}class gy{constructor(){this.type=null,this.mouseEvent={x:0,y:0,xDelta:0,yDelta:0,button:0,windowId:0,wheelDeltaX:0,wheelDeltaY:0}}}class fy{constructor(){this._events=[],this._length=0}push(t,e){const i=this._events,s=this._length;s>=i.length&&i.push(new gy);const r=i[s];r.type=t;const n=r.mouseEvent;e?Object.assign(n,e):(n.x=n.y=n.xDelta=n.yDelta=0,n.button=n.windowId=n.wheelDeltaX=n.wheelDeltaY=0),++this._length}clear(){this._length=0}forEach(t){for(let e=0,i=this._length;e<i;++e)t(this._events[e])}}class yy{constructor(){this._eventTarget=new zo,this._preMousePos=new kr,this._isPressed=!1,this._windowManager=void 0,this._pointLocked=!1,this._cache=new fy,this._handleMouseDown=void 0,this._handleMouseMove=void 0,this._handleMouseUp=void 0,this._handleWindowLeave=void 0,this._handleWindowEnter=void 0,this._handleMouseWheel=void 0,this._handleMouseDown=this._createEventCacheCallback("mouse-down"),this._handleMouseMove=this._createEventCacheCallback("mouse-move"),this._handleMouseUp=this._createEventCacheCallback("mouse-up"),this._handleWindowLeave=this._createEventCacheCallback("mouse-leave-window"),this._handleWindowEnter=this._createEventCacheCallback("mouse-enter-window"),this._handleMouseWheel=this._createEventCacheCallback("mouse-wheel"),this._registerEvent(),this._windowManager=jsb.ISystemWindowManager.getInstance()}dispatchMouseDownEvent(t){this._handleMouseDown(t)}dispatchMouseMoveEvent(t){this._handleMouseMove(t)}dispatchMouseUpEvent(t){this._handleMouseUp(t)}dispatchScrollEvent(t){this._handleMouseWheel(t)}_getLocation(t){const e=this._windowManager.getWindow(t.windowId).getViewSize(),i=pa.devicePixelRatio,s=t.x*i,r=e.height-t.y*i;return new kr(s,r)}_registerEvent(){jsb.onMouseDown=this._handleMouseDown,jsb.onMouseMove=this._handleMouseMove,jsb.onMouseUp=this._handleMouseUp,jsb.onMouseWheel=this._handleMouseWheel,jsb.onPointerlockChange=t=>{this._pointLocked=t},jsb.onWindowLeave=this._handleWindowLeave,jsb.onWindowEnter=this._handleWindowEnter}_createEventCacheCallback(t){return e=>{this._cache.push(t,e)}}dispatchEventsInCache(){const t=this._cache;t.forEach((t=>{switch(t.type){case"mouse-leave-window":this._dispatchWindowLeave();break;case"mouse-enter-window":this._dispatchWindowEnter();break;case"mouse-wheel":this._dispatchMouseWheel(t.mouseEvent);break;default:this._dispatchEvent(t.type,t.mouseEvent)}})),t.clear()}_dispatchEvent(t,e){const i=this._getLocation(e);let s=e.button;switch(t){case"mouse-down":this._isPressed=!0;break;case"mouse-up":this._isPressed=!1;break;case"mouse-move":this._isPressed||(s=Df.BUTTON_MISSING)}const r=new Df(t,!1,this._preMousePos,e.windowId);r.setLocation(i.x,i.y),r.setButton(s);const n=pa.devicePixelRatio;r.movementX=void 0===e.xDelta?0:e.xDelta*n,r.movementY=void 0===e.yDelta?0:e.yDelta*n,this._preMousePos.set(i.x,i.y),this._eventTarget.emit(t,r)}_dispatchMouseWheel(t){const e="mouse-wheel",i=this._getLocation(t),s=t.button,r=new Df(e,!1,this._preMousePos,t.windowId);r.setLocation(i.x,i.y),r.setButton(s),r.movementX=i.x-this._preMousePos.x,r.movementY=this._preMousePos.y-i.y;let n=0;$o.os===Go.OPENHARMONY?(n=5,r.setScrollData(t.wheelDeltaX,t.wheelDeltaY*n)):(n=120,r.setScrollData(t.wheelDeltaX*n,t.wheelDeltaY*n)),this._preMousePos.set(i.x,i.y),this._eventTarget.emit(e,r)}on(t,e,i){this._eventTarget.on(t,e,i)}_dispatchWindowLeave(){const t="mouse-leave-window",e=new Df(t,!1);this._eventTarget.emit(t,e)}_dispatchWindowEnter(){const t="mouse-enter-window",e=new Df(t,!1);this._eventTarget.emit(t,e)}}const by=new kr,vy=new class{constructor(){this._touchMap=new Map,this._maxTouches=8}_createTouch(t,e,i){if(this._touchMap.has(t))return void k(2301);if(this._checkTouchMapSizeMoreThanMax(t))return void k(2300);const s=new Lf(e,i,t);return this._touchMap.set(t,s),this._updateTouch(s,e,i),s}releaseTouch(t){this._touchMap.has(t)&&this._touchMap.delete(t)}getTouch(t){return this._touchMap.get(t)}getOrCreateTouch(t,e,i){let s=this.getTouch(t);return s?this._updateTouch(s,e,i):s=this._createTouch(t,e,i),s}getAllTouches(){const t=[];return this._touchMap.forEach((e=>{e&&t.push(e)})),t}getTouchCount(){return this._touchMap.size}_updateTouch(t,e,i){t.getLocation(by),t.setPrevPoint(by),t.setPoint(e,i)}_checkTouchMapSizeMoreThanMax(t){if(this._touchMap.has(t))return!1;const e=we.ENABLE_MULTI_TOUCH?this._maxTouches:1;if(this._touchMap.size<e)return!1;const i=performance.now();return this._touchMap.forEach((t=>{i-t.lastModified>we.TOUCH_TIMEOUT&&(k(2302,t.getID()),this.releaseTouch(t.getID()))})),e>=this._touchMap.size}};class Sy{constructor(){this.type=null,this.changedTouches=[],this.windowId=0}}class Ty{constructor(){this._events=[],this._length=0}push(t,e,i){const s=this._events,r=this._length;r>=s.length&&s.push(new Sy);const n=s[r],o=n.changedTouches;n.type=t,o.length=e.length,n.windowId=i;for(let t=0,i=e.length;t<i;++t){const i=e[t];let s=o[t];s||(o[t]=s={}),Object.assign(s,i)}++this._length}clear(){this._length=0}forEach(t){for(let e=0,i=this._length;e<i;++e)t(this._events[e])}}class wy{constructor(){this._eventTarget=new zo,this._windowManager=void 0,this._cache=new Ty,this._registerEvent(),this._windowManager=jsb.ISystemWindowManager.getInstance()}_registerEvent(){jsb.onTouchStart=this._createEventCacheCallback("touch-start"),jsb.onTouchMove=this._createEventCacheCallback("touch-move"),jsb.onTouchEnd=this._createEventCacheCallback("touch-end"),jsb.onTouchCancel=this._createEventCacheCallback("touch-cancel")}_createEventCacheCallback(t){return(e,i)=>{this._cache.push(t,e,i)}}dispatchEventsInCache(){const t=this._cache;t.forEach((t=>{this._dispatchEvent(t.type,t.changedTouches,t.windowId)})),t.clear()}_dispatchEvent(t,e,i){const s=[],r=e.length,n=this._windowManager.getWindow(i).getViewSize();for(let i=0;i<r;++i){const r=e[i],o=r.identifier;if(null===o)continue;const a=this._getLocation(r,n),h=vy.getOrCreateTouch(o,a.x,a.y);h&&("touch-end"!==t&&"touch-cancel"!==t||vy.releaseTouch(o),s.push(h))}if(s.length>0){const e=new If(s,!1,t,vy.getAllTouches());e.windowId=i,this._eventTarget.emit(t,e)}}_getLocation(t,e){const i=pa.devicePixelRatio,s=t.clientX*i,r=e.height-t.clientY*i;return new kr(s,r)}on(t,e,i){this._eventTarget.on(t,e,i)}}class xy{constructor(t){this.priority=0,this._inputEventTarget=t}onThrowException(){}dispatchEvent(t){return this._inputEventTarget.emit(t.type,t),!0}}const Cy={"mouse-down":"touch-start","mouse-move":"touch-move","mouse-up":"touch-end"};class Ay{constructor(){this._eventTarget=new zo,this._touchInput=new wy,this._mouseInput=new yy,this._keyboardInput=new my,this._accelerometerInput=new kf,this._eventKeyboardList=[],this._eventAccelerationList=[],this._eventGamepadList=[],this._eventHandleList=[],this._eventHMDList=[],this._eventHandheldList=[],this._needSimulateTouchMoveEvent=!1,this._eventDispatcherList=[],this._handleInput=new ay,this._hmdInput=new cy,this._handheldInput=new uy,this._registerEvent(),this._inputEventDispatcher=new xy(this._eventTarget),this._registerEventDispatcher(this._inputEventDispatcher),ty._init()}_dispatchMouseDownEvent(t){var e,i;null==(e=(i=this._mouseInput).dispatchMouseDownEvent)||e.call(i,t)}_dispatchMouseMoveEvent(t){var e,i;null==(e=(i=this._mouseInput).dispatchMouseMoveEvent)||e.call(i,t)}_dispatchMouseUpEvent(t){var e,i;null==(e=(i=this._mouseInput).dispatchMouseUpEvent)||e.call(i,t)}_dispatchMouseScrollEvent(t){var e,i;null==(e=(i=this._mouseInput).dispatchScrollEvent)||e.call(i,t)}_dispatchKeyboardDownEvent(t){var e,i;null==(e=(i=this._keyboardInput).dispatchKeyboardDownEvent)||e.call(i,t)}_dispatchKeyboardUpEvent(t){var e,i;null==(e=(i=this._keyboardInput).dispatchKeyboardUpEvent)||e.call(i,t)}on(t,e,i){return this._eventTarget.on(t,e,i),e}once(t,e,i){return this._eventTarget.once(t,e,i),e}off(t,e,i){this._eventTarget.off(t,e,i)}getTouch(t){return vy.getTouch(t)}getAllTouches(){return vy.getAllTouches()}getTouchCount(){return vy.getTouchCount()}setAccelerometerEnabled(t){t?this._accelerometerInput.start():this._accelerometerInput.stop()}setAccelerometerInterval(t){this._accelerometerInput.setInterval(t)}_simulateEventTouch(t){const e=Cy[t.type],i=vy.getOrCreateTouch(0,t.getLocationX(),t.getLocationY());if(!i)return;const s=[i],r=new If(s,!1,e,"touch-end"===e?[]:s);r.windowId=t.windowId,"touch-end"===e&&vy.releaseTouch(0),this._dispatchEventTouch(r)}_registerEventDispatcher(t){this._eventDispatcherList.push(t),this._eventDispatcherList.sort(((t,e)=>e.priority-t.priority))}_emitEvent(t){const e=this._eventDispatcherList.length;for(let i=0;i<e;++i){const e=this._eventDispatcherList[i];try{if(!e.dispatchEvent(t))break}catch(t){throw this._clearEvents(),e.onThrowException(),t}}}_registerEvent(){const t=this,e=t._touchInput,i=t._mouseInput,s=t._keyboardInput,r=t._handleInput;if(ga.hasFeature(ga.Feature.INPUT_TOUCH)&&(e.on("touch-start",(e=>{t._dispatchEventTouch(e)})),e.on("touch-move",(e=>{t._dispatchEventTouch(e)})),e.on("touch-end",(e=>{t._dispatchEventTouch(e)})),e.on("touch-cancel",(e=>{t._dispatchEventTouch(e)}))),ga.hasFeature(ga.Feature.EVENT_MOUSE)&&(i.on("mouse-down",(e=>{t._needSimulateTouchMoveEvent=!0,t._simulateEventTouch(e),t._dispatchEventMouse(e)})),i.on("mouse-move",(e=>{t._needSimulateTouchMoveEvent&&t._simulateEventTouch(e),t._dispatchEventMouse(e)})),i.on("mouse-up",(e=>{t._needSimulateTouchMoveEvent=!1,t._simulateEventTouch(e),t._dispatchEventMouse(e)})),i.on("mouse-wheel",(e=>{t._dispatchEventMouse(e)})),i.on("mouse-leave-window",(e=>{t._dispatchEventMouse(e)})),i.on("mouse-enter-window",(e=>{t._dispatchEventMouse(e)}))),ga.hasFeature(ga.Feature.EVENT_KEYBOARD)){const e=t._eventKeyboardList;s.on("keydown",(i=>{t._dispatchOrPushEvent(i,e)})),s.on("key-pressing",(i=>{t._dispatchOrPushEvent(i,e)})),s.on("keyup",(i=>{t._dispatchOrPushEvent(i,e)}))}if(ga.hasFeature(ga.Feature.EVENT_ACCELEROMETER)){const e=t._eventAccelerationList;t._accelerometerInput.on("devicemotion",(i=>{t._dispatchOrPushEvent(i,e)}))}if(ga.hasFeature(ga.Feature.EVENT_GAMEPAD)){const e=t._eventGamepadList;ty._on("gamepad-change",(i=>{t._dispatchOrPushEvent(i,e)})),ty._on("gamepad-input",(i=>{t._dispatchOrPushEvent(i,e)})),ty._on("handle-pose-input",(i=>{t._dispatchOrPushEvent(i,e)}))}if(ga.hasFeature(ga.Feature.EVENT_HANDLE)){const e=t._eventHandleList;r._on("handle-input",(i=>{t._dispatchOrPushEvent(i,e)})),r._on("handle-pose-input",(i=>{t._dispatchOrPushEvent(i,e)}))}if(ga.hasFeature(ga.Feature.EVENT_HMD)){const e=t._eventHMDList;t._hmdInput._on("hmd-pose-input",(i=>{t._dispatchOrPushEvent(i,e)}))}if(ga.hasFeature(ga.Feature.EVENT_HANDHELD)){const e=t._eventHandheldList;t._handheldInput._on("handheld-pose-input",(i=>{t._dispatchOrPushEvent(i,e)}))}}_clearEvents(){this._eventKeyboardList.length=0,this._eventAccelerationList.length=0,this._eventGamepadList.length=0,this._eventHandleList.length=0,this._eventHMDList.length=0}_dispatchOrPushEvent(t,e){e.push(t)}_dispatchEventMouse(t){this._emitEvent(t)}_dispatchEventTouch(t){const e=t.getTouches(),i=e.length;for(let s=0;s<i;++s)t.touch=e[s],t.propagationStopped=t.propagationImmediateStopped=!1,this._emitEvent(t)}_frameDispatchEvents(){const t=this._eventHMDList;for(let e=0,i=t.length;e<i;++e){const i=t[e];this._emitEvent(i)}const e=this._eventHandheldList;for(let t=0,i=e.length;t<i;++t){const i=e[t];this._emitEvent(i)}this._mouseInput.dispatchEventsInCache(),this._touchInput.dispatchEventsInCache();const i=this._eventKeyboardList;for(let t=0,e=i.length;t<e;++t){const e=i[t];this._emitEvent(e)}const s=this._eventAccelerationList;for(let t=0,e=s.length;t<e;++t){const e=s[t];this._emitEvent(e)}const r=this._eventGamepadList;for(let t=0,e=r.length;t<e;++t){const e=r[t];this._emitEvent(e)}const n=this._eventHandleList;for(let t=0,e=n.length;t<e;++t){const e=n[t];this._emitEvent(e)}this._clearEvents()}}t("Input",Ay),Ay.EventType={TOUCH_START:"touch-start",TOUCH_MOVE:"touch-move",TOUCH_END:"touch-end",TOUCH_CANCEL:"touch-cancel",MOUSE_DOWN:"mouse-down",MOUSE_MOVE:"mouse-move",MOUSE_UP:"mouse-up",MOUSE_LEAVE:"mouse-leave-window",MOUSE_ENTER:"mouse-enter-window",MOUSE_WHEEL:"mouse-wheel",KEY_DOWN:"keydown",KEY_PRESSING:"key-pressing",KEY_UP:"keyup",DEVICEMOTION:"devicemotion",GAMEPAD_INPUT:"gamepad-input",GAMEPAD_CHANGE:"gamepad-change",HANDLE_INPUT:"handle-input",HANDLE_POSE_INPUT:"handle-pose-input",HMD_POSE_INPUT:"hmd-pose-input",HANDHELD_POSE_INPUT:"handheld-pose-input"};const Dy=t("input",new Ay);class Ey extends zo{constructor(){super(),Dy.on("mouse-down",(t=>{this.emit("mouse-down",t)})),Dy.on("mouse-move",(t=>{this.emit("mouse-move",t)})),Dy.on("mouse-up",(t=>{this.emit("mouse-up",t)})),Dy.on("mouse-wheel",(t=>{this.emit("mouse-wheel",t)})),Dy.on("touch-start",(t=>{this.emit("touch-start",t.touch,t)})),Dy.on("touch-move",(t=>{this.emit("touch-move",t.touch,t)})),Dy.on("touch-end",(t=>{this.emit("touch-end",t.touch,t)})),Dy.on("touch-cancel",(t=>{this.emit("touch-cancel",t.touch,t)})),Dy.on("keydown",(t=>{this.emit("keydown",t)})),Dy.on("key-pressing",(t=>{this.emit("keydown",t)})),Dy.on("keyup",(t=>{this.emit("keyup",t)})),Dy.on("devicemotion",(t=>{this.emit("devicemotion",t)}))}setAccelerometerEnabled(t){Dy.setAccelerometerEnabled(t)}setAccelerometerInterval(t){Dy.setAccelerometerInterval(t)}on(t,e,i,s){return super.on(t,e,i,s),e}off(t,e,i){super.off(t,e,i)}}t("SystemEvent",Ey),Ey.EventType=Ff,a.SystemEvent=Ey;const Iy=t("systemEvent",new Ey);a.systemEvent=Iy,Q(Ff,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]),Q(xf,"Event",[{name:"ACCELERATION",newName:"DEVICEMOTION",target:Ey.EventType,targetName:"SystemEvent.EventType"}]),tt(xf,"Event",[{name:"TOUCH",suggest:"please use SystemEvent.EventType.TOUCH_START, SystemEvent.EventType.TOUCH_MOVE, SystemEvent.EventType.TOUCH_END and SystemEvent.EventType.TOUCH_CANCEL instead"},{name:"MOUSE",suggest:"please use SystemEvent.EventType.MOUSE_DOWN, SystemEvent.EventType.MOUSE_MOVE, SystemEvent.EventType.MOUSE_UP, SystemEvent.EventType.MOUSE_WHEEL, Node.EventType.MOUSE_ENTER and Node.EventType.MOUSE_LEAVE instead"},{name:"KEYBOARD",suggest:"please use SystemEvent.EventType.KEY_DOWN and SystemEvent.EventType.KEY_UP instead"}]),Q(Df,"EventMouse",["DOWN","UP","MOVE"].map((t=>({name:t,newName:`MOUSE_${t}`,target:Ey.EventType,targetName:"SystemEvent.EventType"})))),Q(Df,"EventMouse",[{name:"SCROLL",newName:"MOUSE_WHEEL",target:Ey.EventType,targetName:"SystemEvent.EventType"}]),tt(Df.prototype,"EventMouse.prototype",[{name:"eventType",suggest:"please use EventMouse.prototype.type instead"}]),Q(If,"EventTouch",[{name:"BEGAN",newName:"TOUCH_START",target:Ey.EventType,targetName:"SystemEvent.EventType"}]),Q(If,"EventTouch",[{name:"MOVED",newName:"TOUCH_MOVE",target:Ey.EventType,targetName:"SystemEvent.EventType"}]),Q(If,"EventTouch",[{name:"ENDED",newName:"TOUCH_END",target:Ey.EventType,targetName:"SystemEvent.EventType"}]),Q(If,"EventTouch",[{name:"CANCELLED",newName:"TOUCH_CANCEL",target:Ey.EventType,targetName:"SystemEvent.EventType"}]),tt(If.prototype,"EventTouch.prototype",[{name:"getEventCode",suggest:"please use EventTouch.prototype.type instead"}]),Q(If.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:If,targetName:"EventTouch"}]),tt(we.KEY,"macro.KEY",["back","menu","0","1","2","3","4","5","6","7","8","9","0","*","+","-","/",";","=",",",".","[","]","dpadLeft","dpadRight","dpadUp","dpadDown","dpadCenter"].map((t=>({name:t})))),tt(we.KEY,"macro.KEY",[{name:"shift",suggest:"please use KeyCode.SHIFT_LEFT instead"}]),tt(we.KEY,"macro.KEY",[{name:"ctrl",suggest:"please use KeyCode.CTRL_LEFT instead"}]),tt(we.KEY,"macro.KEY",[{name:"alt",suggest:"please use KeyCode.ALT_LEFT instead"}]),tt(we,"macro",[{name:"KEY",suggest:"please use KeyCode instead"}]),t("PipelineEventType",{RENDER_FRAME_BEGIN:"render-frame-begin",RENDER_FRAME_END:"render-frame-end",RENDER_CAMERA_BEGIN:"render-camera-begin",RENDER_CAMERA_END:"render-camera-end",ATTACHMENT_SCALE_CAHNGED:"attachment-scale-changed"});class My extends zo{constructor(){super(),this.eventTargetOn=super.on,this.eventTargetOnce=super.once}on(t,e,i,s){return this.eventTargetOn(t,e,i,s)}once(t,e,i){return this.eventTargetOnce(t,e,i)}}const Py=t("Root",jsb.Root);var Oy;!function(t){t[t.DIRECTIONAL=0]="DIRECTIONAL",t[t.SPHERE=1]="SPHERE",t[t.SPOT=2]="SPOT",t[t.POINT=3]="POINT",t[t.RANGED_DIRECTIONAL=4]="RANGED_DIRECTIONAL",t[t.UNKNOWN=5]="UNKNOWN"}(Oy||(Oy={}));const Ry=Py.prototype;Ry._createBatcher2D=function(){if(!this._batcher&&a.internal.Batcher2D){if(this._batcher=new a.internal.Batcher2D(this),!this._batcher.initialize())return this._batcher=null,void this.destroy();this._batcher._nativeObj=this.getBatcher2D()}},Object.defineProperty(Ry,"batcher2D",{configurable:!0,enumerable:!0,get(){return this._batcher}}),Object.defineProperty(Ry,"dataPoolManager",{configurable:!0,enumerable:!0,get(){return this._dataPoolMgr}}),Object.defineProperty(Ry,"pipelineEvent",{configurable:!0,enumerable:!0,get(){return this._pipelineEvent}}),Ry._ctor=function(t){this._device=t,this._dataPoolMgr=a.internal.DataPoolManager&&new a.internal.DataPoolManager(t),this._modelPools=new Map,this._lightPools=new Map,this._batcher=null,this._pipelineEvent=new My,this._registerListeners()},Ry.initialize=function(){var t;this._initialize(yp.swapchain);const e=Se.querySettings(ve.Category.ANIMATION,"customJointTextureLayouts")||[];null==(t=this._dataPoolMgr)||t.jointTexturePool.registerCustomTextureLayouts(e)},Ry.createModel=function(t){let e=this._modelPools.get(t);e||(this._modelPools.set(t,new vo((()=>new t),10,(t=>t.destroy()))),e=this._modelPools.get(t));const i=e.alloc();return i.initialize(),i},jsb.buildRenderPipeline=function(){a.director.buildRenderPipeline()},Ry.destroyModel=function(t){const e=this._modelPools.get(t.constructor);e?(e.free(t),t.scene&&t.scene.removeModel(t)):j(1300,t.constructor.name),t.destroy()},Ry.createLight=function(t){let e=this._lightPools.get(t);e||(this._lightPools.set(t,new vo((()=>new t),4,(t=>t.destroy()))),e=this._lightPools.get(t));const i=e.alloc();return i.initialize(),i},Ry.destroyLight=function(t){if(t.scene)switch(t.type){case Oy.DIRECTIONAL:t.scene.removeDirectionalLight(t);break;case Oy.SPHERE:t.scene.removeSphereLight(t);break;case Oy.SPOT:t.scene.removeSpotLight(t);break;case Oy.POINT:t.scene.removePointLight(t);break;case Oy.RANGED_DIRECTIONAL:t.scene.removeRangedDirLight(t)}t.destroy()},Ry.recycleLight=function(t){const e=this._lightPools.get(t.constructor);if(e&&(e.free(t),t.scene))switch(t.type){case Oy.DIRECTIONAL:t.scene.removeDirectionalLight(t);break;case Oy.SPHERE:t.scene.removeSphereLight(t);break;case Oy.SPOT:t.scene.removeSpotLight(t);break;case Oy.POINT:t.scene.removePointLight(t);break;case Oy.RANGED_DIRECTIONAL:t.scene.removeRangedDirLight(t)}},Ry._onDirectorBeforeCommit=function(){a.director.emit(a.Director.EVENT_BEFORE_COMMIT)},Ry._onDirectorBeforeRender=function(){a.director.emit(a.Director.EVENT_BEFORE_RENDER)},Ry._onDirectorAfterRender=function(){a.director.emit(a.Director.EVENT_AFTER_RENDER)},Ry._onDirectorPipelineChanged=function(){const t=a.director.getScene();t&&t._activate()};const By=Ry.onGlobalPipelineStateChanged;Ry.onGlobalPipelineStateChanged=function(){By.call(this);const t=a.rendering.getCustomPipeline(we.CUSTOM_PIPELINE_NAME);t&&("function"==typeof t.onGlobalPipelineStateChanged&&t.onGlobalPipelineStateChanged(),a.rendering.forceResizeAllWindows())};const Fy=Ry.frameMove;Ry.frameMove=function(t){Fy.call(this,t,a.director.getTotalFrames())};const Ny=Ry.setRenderPipeline;Ry.setRenderPipeline=function(t){let e;if(t)a.rendering.createCustomPipeline(),e=Ny.call(this,null),I(`Using custom pipeline: ${we.CUSTOM_PIPELINE_NAME}`);else if(a.legacy_rendering){const t=a.legacy_rendering.createDefaultPipeline();t.init(),e=Ny.call(this,t)}else I("No render pipeline: legacy-pipeline is not available");return this._createBatcher2D(),e},Ry.addBatch=function(){console.error("The Draw Batch class is implemented differently in the native platform and does not support this interface.")},Ry.removeBatch=function(){console.error("The Draw Batch class is implemented differently in the native platform and does not support this interface.")},Ry.removeBatches=function(){console.error("The Draw Batch class is implemented differently in the native platform and does not support this interface.")};const Ly=t("NodeEventType",{TOUCH_START:"touch-start",TOUCH_MOVE:"touch-move",TOUCH_END:"touch-end",TOUCH_CANCEL:"touch-cancel",MOUSE_DOWN:"mouse-down",MOUSE_MOVE:"mouse-move",MOUSE_UP:"mouse-up",MOUSE_WHEEL:"mouse-wheel",MOUSE_ENTER:"mouse-enter",MOUSE_LEAVE:"mouse-leave",KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion",TRANSFORM_CHANGED:"transform-changed",MOBILITY_CHANGED:"mobility-changed",SCENE_CHANGED_FOR_PERSISTS:"scene-changed-for-persists",SIZE_CHANGED:"size-changed",ANCHOR_CHANGED:"anchor-changed",COLOR_CHANGED:"color-changed",CHILD_ADDED:"child-added",CHILD_REMOVED:"child-removed",PARENT_CHANGED:"parent-changed",NODE_DESTROYED:"node-destroyed",LAYER_CHANGED:"layer-changed",SIBLING_ORDER_CHANGED:"sibling-order-changed",CHILDREN_ORDER_CHANGED:"sibling-order-changed",ACTIVE_IN_HIERARCHY_CHANGED:"active-in-hierarchy-changed",COMPONENT_ADDED:"component-added",COMPONENT_REMOVED:"component-removed",LIGHT_PROBE_CHANGED:"light-probe-changed",LIGHT_PROBE_BAKING_CHANGED:"light-probe-baking-changed",ACTIVE_CHANGED:"active-changed"});class ky{get uiTransformComp(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp}set uiTransformComp(t){this._uiTransformComp=t}get uiComp(){return this._uiComp}set uiComp(t){this._uiComp&&t?j(12002):this._uiComp=t}setOpacity(t){this._opacity=t}get opacity(){return this._opacity=this._node._getFinalOpacity(),this._opacity}get localOpacity(){return this._localOpacity}set localOpacity(t){this._localOpacity=t,this.colorDirty=!0;{const e=this._node;e._colorDirty=!0,e._setLocalOpacity(t)}}constructor(t){this._uiComp=null,this._opacity=1,this._localOpacity=1,this.colorDirty=!0,this._uiTransformComp=null,this._uiSkewComp=null,this._node=t}applyOpacity(t){this._opacity=this._localOpacity*t}static markOpacityTree(t,e=!0){}}const zy=t("NodeSpace",{LOCAL:0,WORLD:1}),Uy=t("TransformBit",{NONE:0,POSITION:1,ROTATION:2,SCALE:4,SKEW:8,RS:6,RSS:14,TRS:7,TRS_MASK:-8});h.internal.TransformBit=Uy;const Vy=t("MobilityMode",pe({Static:0,Stationary:1,Movable:2})),jy={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295};class Hy{constructor(){}static init(){const t=Se.querySettings("engine","customLayers");if(t)for(let e=0;e<t.length;e++){const i=t[e];Hy.addLayer(i.name,i.bit)}}static makeMaskInclude(t){return t.reduce(((t,e)=>t|e),0)}static makeMaskExclude(t){return~Hy.makeMaskInclude(t)}static addLayer(t,e){if(void 0===e)return void j(16364);if(e>19||e<0)return void j(16365);const i=1<<e;Hy.Enum[t],q(2104,t),Hy.Enum[t]=i,bt(Hy.Enum,String(i),t),Hy.BitMask[t]=i,bt(Hy.BitMask,String(i),t),ue.update(Hy.BitMask),pe.update(Hy.Enum)}static deleteLayer(t){if(t>19||t<0)return void j(16366);const e=1<<t;delete Hy.Enum[Hy.Enum[e]],delete Hy.Enum[e],delete Hy.BitMask[Hy.BitMask[e]],delete Hy.BitMask[e],ue.update(Hy.BitMask),pe.update(Hy.Enum)}static nameToLayer(t){return void 0===t?(j(16367),-1):p(Hy.Enum[t])}static layerToName(t){return t>31||t<0?(j(16368),""):Hy.Enum[1<<t]}}t("Layers",Hy),Hy.Enum=pe(jy),Hy.BitMask=ue({...jy}),h.Layers=Hy;const Gy=new Float32Array(jsb.createExternalArrayBuffer(80)),Wy=function(t){vr.set(t,Gy[0],Gy[1],Gy[2],Gy[3],Gy[4],Gy[5],Gy[6],Gy[7],Gy[8],Gy[9],Gy[10],Gy[11],Gy[12],Gy[13],Gy[14],Gy[15])};h.GAME_VIEW;const Xy=new vo((()=>new Array(16)),3);let Yy=null;const qy=new kr,$y=["touch-start","touch-move","touch-end","touch-cancel"],Ky=["mouse-down","mouse-enter","mouse-move","mouse-leave","mouse-up","mouse-wheel"],Zy=new Lo;class Qy{get isEnabled(){return this._isEnabled}get node(){return this._node}constructor(t){this.claimedTouchIdList=[],this.maskList=null,this.cachedCameraPriority=0,this.previousMouseIn=!1,this.bubblingTarget=null,this.capturingTarget=null,this.shouldHandleEventMouse=!1,this.shouldHandleEventTouch=!1,this._dispatchingTouch=null,this._isEnabled=!1,this._isMouseLeaveWindow=!1,this._node=t}setEnabled(t,e=!1){if(this._isEnabled===t)return;this._isEnabled=t;const i=this.node.children;if(t&&this._attachMask(),Zy.emit(2),e&&i.length>0)for(let e=0;e<i.length;++e)i[e].eventProcessor.setEnabled(t,!0)}reattach(){this.node.walk((t=>{const e=t.eventProcessor,i=e._searchComponentsInParent(Qy._maskComp);e.maskList=i}))}destroy(){if(Yy===this._node&&(Yy=null),this.capturingTarget&&this.capturingTarget.clear(),this.bubblingTarget&&this.bubblingTarget.clear(),Zy.emit(1,this),this._dispatchingTouch){const t=new If([this._dispatchingTouch],!0,"touch-cancel");t.touch=this._dispatchingTouch,this.dispatchEvent(t),this._dispatchingTouch=null}}on(t,e,i,s){let r;var n,o;return this._tryEmittingAddEvent(t),r=(s=!!s)?null!==(n=this.capturingTarget)&&void 0!==n?n:this.capturingTarget=this._newCallbacksInvoker():null!==(o=this.bubblingTarget)&&void 0!==o?o:this.bubblingTarget=this._newCallbacksInvoker(),r.on(t,e,i),e}once(t,e,i,s){let r;var n,o;return this._tryEmittingAddEvent(t),r=(s=!!s)?null!==(n=this.capturingTarget)&&void 0!==n?n:this.capturingTarget=this._newCallbacksInvoker():null!==(o=this.bubblingTarget)&&void 0!==o?o:this.bubblingTarget=this._newCallbacksInvoker(),r.on(t,e,i,!0),e}off(t,e,i,s){var r;let n;n=(s=!!s)?this.capturingTarget:this.bubblingTarget,null==(r=n)||r.off(t,e,i)}targetOff(t){var e,i;null==(e=this.capturingTarget)||e.removeAll(t),null==(i=this.bubblingTarget)||i.removeAll(t),this.shouldHandleEventTouch&&!this._hasTouchListeners()&&(this.shouldHandleEventTouch=!1),this.shouldHandleEventMouse&&!this._hasMouseListeners()&&(this.shouldHandleEventMouse=!1),this._hasPointerListeners()||Zy.emit(1,this)}emit(t,e,i,s,r,n){var o;null==(o=this.bubblingTarget)||o.emit(t,e,i,s,r,n)}dispatchEvent(t){const e=this.node;let i,s=0;t.target=e;const r=Xy.alloc();for(r.length=0,this.getCapturingTargets(t.type,r),t.eventPhase=1,s=r.length-1;s>=0;--s)if(i=r[s],i.eventProcessor.capturingTarget&&(t.currentTarget=i,i.eventProcessor.capturingTarget.emit(t.type,t,r),t.propagationStopped))return void Xy.free(r);if(t.eventPhase=2,t.currentTarget=e,this.capturingTarget&&this.capturingTarget.emit(t.type,t),!t.propagationImmediateStopped&&this.bubblingTarget&&this.bubblingTarget.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(r.length=0,this.getBubblingTargets(t.type,r),t.eventPhase=3,s=0;s<r.length;++s)if(i=r[s],i.eventProcessor.bubblingTarget&&(t.currentTarget=i,i.eventProcessor.bubblingTarget.emit(t.type,t),t.propagationStopped))return void Xy.free(r);Xy.free(r)}hasEventListener(t,e,i){let s=!1;return this.bubblingTarget&&(s=this.bubblingTarget.hasEventListener(t,e,i)),!s&&this.capturingTarget&&(s=this.capturingTarget.hasEventListener(t,e,i)),s}getCapturingTargets(t,e){let i=this._node.parent;for(;i;){var s;null!=(s=i.eventProcessor.capturingTarget)&&s.hasEventListener(t)&&e.push(i),i=i.parent}}getBubblingTargets(t,e){let i=this._node.parent;for(;i;){var s;null!=(s=i.eventProcessor.bubblingTarget)&&s.hasEventListener(t)&&e.push(i),i=i.parent}}onUpdatingSiblingIndex(){Zy.emit(2)}_searchComponentsInParent(t){const e=this.node;if(t){let i=0,s=[];for(let r=e;r&&a.Node.isNode(r);r=r.parent,++i){const e=r.getComponent(t);if(e){const t={index:i,comp:e};s.push(t)}}return s.length>0?s:null}return null}_attachMask(){this.maskList=this._searchComponentsInParent(Qy._maskComp)}_isTouchEvent(t){return-1!==$y.indexOf(t)}_isMouseEvent(t){return-1!==Ky.indexOf(t)}_hasTouchListeners(){for(let t=0;t<$y.length;++t){const e=$y[t];if(this.hasEventListener(e))return!0}return!1}_hasMouseListeners(){for(let t=0;t<Ky.length;++t){const e=Ky[t];if(this.hasEventListener(e))return!0}return!1}_hasPointerListeners(){return!!this._hasTouchListeners()||this._hasMouseListeners()}_tryEmittingAddEvent(t){const e=this._isTouchEvent(t),i=this._isMouseEvent(t);e?this.shouldHandleEventTouch=!0:i&&(this.shouldHandleEventMouse=!0),!e&&!i||this._hasPointerListeners()||Zy.emit(0,this)}_newCallbacksInvoker(){const t=new Lo;return t._registerOffCallback((()=>{this.shouldHandleEventTouch&&!this._hasTouchListeners()&&(this.shouldHandleEventTouch=!1),this.shouldHandleEventMouse&&!this._hasMouseListeners()&&(this.shouldHandleEventMouse=!1),this._hasPointerListeners()||Zy.emit(1,this)})),t}_handleEventMouse(t){switch(t.type){case"mouse-down":return this._handleMouseDown(t);case"mouse-move":return this._handleMouseMove(t);case"mouse-up":return this._handleMouseUp(t);case"mouse-wheel":return this._handleMouseWheel(t);case"mouse-leave-window":return this._handleMouseLeave(t);case"mouse-enter-window":return this._handleMouseEnter(t);default:return!1}}_handleMouseDown(t){const e=this._node,i=e._getUITransformComp();return!(!e||!i||(t.getLocation(qy),!i.hitTest(qy,t.windowId)||(t.type="mouse-down",t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))}_handleMouseMove(t){const e=this._node,i=e._getUITransformComp();return!(!e||!i||this._isMouseLeaveWindow)&&(t.getLocation(qy),i.hitTest(qy,t.windowId)?(this.previousMouseIn||(Yy&&Yy!==e&&(t.type="mouse-leave",Yy.dispatchEvent(t),Yy.eventProcessor.previousMouseIn=!1),Yy=e,t.type="mouse-enter",e.dispatchEvent(t),this.previousMouseIn=!0),t.type="mouse-move",t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,!0):(this.previousMouseIn&&(t.type="mouse-leave",e.dispatchEvent(t),this.previousMouseIn=!1,Yy=null),!1))}_handleMouseUp(t){const e=this._node,i=e._getUITransformComp();return!(!e||!i||(t.getLocation(qy),!i.hitTest(qy,t.windowId)||(t.type="mouse-up",t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))}_handleMouseWheel(t){const e=this._node,i=e._getUITransformComp();return!(!e||!i||(t.getLocation(qy),!i.hitTest(qy,t.windowId)||(t.type="mouse-wheel",t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))}_handleMouseLeave(t){return this._isMouseLeaveWindow=!0,this.previousMouseIn&&(t.type="mouse-leave",this._node.dispatchEvent(t),this.previousMouseIn=!1,Yy=null),!1}_handleMouseEnter(t){return this._isMouseLeaveWindow=!1,!1}_handleEventTouch(t){try{switch(t.type){case"touch-start":return this._handleTouchStart(t);case"touch-move":return this._handleTouchMove(t);case"touch-end":return this._handleTouchEnd(t);case"touch-cancel":return this._handleTouchCancel(t);default:return!1}}catch(t){throw this.claimedTouchIdList.length=0,t}}_handleTouchStart(t){const e=this.node,i=e._getUITransformComp();return!(!e||!i||(t.getLocation(qy),!i.hitTest(qy,t.windowId)||(t.type="touch-start",t.bubbles=!0,this._dispatchingTouch=t.touch,e.dispatchEvent(t),0)))}_handleTouchMove(t){const e=this.node;return!(!e||!e._getUITransformComp()||(t.type="touch-move",t.bubbles=!0,this._dispatchingTouch=t.touch,e.dispatchEvent(t),0))}_handleTouchEnd(t){const e=this.node,i=e._getUITransformComp();e&&i&&(t.getLocation(qy),i.hitTest(qy,t.windowId)?t.type="touch-end":t.type="touch-cancel",t.bubbles=!0,e.dispatchEvent(t),this._dispatchingTouch=null)}_handleTouchCancel(t){const e=this.node;e&&e._getUITransformComp()&&(t.type="touch-cancel",t.bubbles=!0,e.dispatchEvent(t),this._dispatchingTouch=null)}}Qy._maskComp=null,Qy.callbacksInvoker=Zy,a.NodeEventProcessor=Qy;const Jy=Symbol("ReserveContentsForAllSyncablePrefab"),tb=jsb.Node;t({Node:tb,BaseNode:tb}),a.Node=tb;const eb=new Ms,ib=tb;ib.reserveContentsForAllSyncablePrefabTag=Jy,ib.EventType=Ly,ib.NodeSpace=zy,ib.TransformDirtyBit=Uy,ib.TransformBit=Uy;const sb=Uy.TRS,rb=jsb.Node.prototype,nb=xo.Destroying;function ob(t){return t?"string"==typeof t?Kt(t):t:null}tb._setTempFloatArray(Gy.buffer),rb.attr=function(t){Ft(this,t)},rb.getComponent=function(t){const e=ob(t);return e?ib._findComponent(this,e):null},rb.getComponents=function(t){const e=ob(t),i=[];return e&&ib._findComponents(this,e,i),i},rb.getComponentInChildren=function(t){const e=ob(t);return e?ib._findChildComponent(this._children,e):null},rb.getComponentsInChildren=function(t){const e=ob(t),i=[];return e&&(ib._findComponents(this,e,i),ib._findChildComponents(this.children,e,i)),i},rb.addComponent=function(t){let e;if("string"==typeof t){if(e=Kt(t),!e)throw a._RF.peek()&&G(3808,t),TypeError(q(3807,t))}else{if(!t)throw TypeError(q(3804));e=t}if("function"!=typeof e)throw TypeError(q(3809));if(!kt(e,Km))throw TypeError(q(3810));const i=e._requireComponent;if(i){const t=t=>{this.getComponent(t)||this.addComponent(t)};Array.isArray(i)?i.forEach((e=>t(e))):t(i)}const s=new e;return s.node=this,this._components.push(s),this.emit(Ly.COMPONENT_ADDED,s),this._activeInHierarchy&&a.director._nodeActivator.activateComp(s),s},rb.removeComponent=function(t){if(!t)return void G(3813);let e=null;e=t instanceof Km?t:this.getComponent(t),e&&e.destroy()},rb.on=function(t,e,i,s=!1){switch(t){case Ly.TRANSFORM_CHANGED:this._eventMask|=1,1&this._registeredNodeEventTypeMask||(this._registerOnTransformChanged(),this._registeredNodeEventTypeMask|=1);break;case Ly.ACTIVE_CHANGED:this._eventMask|=2;break;case Ly.PARENT_CHANGED:2&this._registeredNodeEventTypeMask||(this._registerOnParentChanged(),this._registeredNodeEventTypeMask|=2);break;case Ly.MOBILITY_CHANGED:4&this._registeredNodeEventTypeMask||(this._registerOnMobilityChanged(),this._registeredNodeEventTypeMask|=4);break;case Ly.LAYER_CHANGED:8&this._registeredNodeEventTypeMask||(this._registerOnLayerChanged(),this._registeredNodeEventTypeMask|=8);break;case Ly.CHILDREN_ORDER_CHANGED:16&this._registeredNodeEventTypeMask||(this._registerOnSiblingOrderChanged(),this._registeredNodeEventTypeMask|=16);break;case Ly.LIGHT_PROBE_BAKING_CHANGED:32&this._registeredNodeEventTypeMask||(this._registerOnLightProbeBakingChanged(),this._registeredNodeEventTypeMask|=32)}this._eventProcessor.on(t,e,i,s)},rb.off=function(t,e,i,s=!1){if(this._eventProcessor.off(t,e,i,s),!this._eventProcessor.hasEventListener(t))switch(t){case Ly.TRANSFORM_CHANGED:this._eventMask&=-2;break;case Ly.ACTIVE_CHANGED:this._eventMask&=-3}},rb.once=function(t,e,i,s){this._eventProcessor.once(t,e,i,s)},rb.emit=function(t,e,i,s,r,n){this._eventProcessor.emit(t,e,i,s,r,n)},rb.dispatchEvent=function(t){this._eventProcessor.dispatchEvent(t)},rb.hasEventListener=function(t,e,i){return this._eventProcessor.hasEventListener(t,e,i)},rb.targetOff=function(t){this._eventProcessor.targetOff(t),1&this._eventMask&&!this._eventProcessor.hasEventListener(Ly.TRANSFORM_CHANGED)&&(this._eventMask&=-2),2&this._eventMask&&!this._eventProcessor.hasEventListener(Ly.ACTIVE_CHANGED)&&(this._eventMask&=-3)},rb.pauseSystemEvents=function(t){this._eventProcessor.setEnabled(!1,t)},rb.resumeSystemEvents=function(t){this._eventProcessor.setEnabled(!0,t)},rb.getWritableComponents=function(){return this._components},rb._setActiveInHierarchy=function(t){return this._activeInHierarchy=t},rb._removeComponent=function(t){if(t){if(!(this._objFlags&nb)){const e=this._components.indexOf(t);-1!==e?(this._components.splice(e,1),this.emit(Ly.COMPONENT_REMOVED,t)):t.node!==this&&G(3815)}}else G(3814)},rb._registerIfAttached=void 0,rb._onTransformChanged=function(t){this.emit(Ly.TRANSFORM_CHANGED,t)},rb._onParentChanged=function(t){this.emit(Ly.PARENT_CHANGED,t)},rb._onReAttach=function(){this._eventProcessor.reattach()},rb._onEditorAttached=function(){},rb._onRemovePersistRootNode=function(){a.game.removePersistRootNode(this)},rb._onDestroyComponents=function(){this._eventProcessor.destroy();const t=this._components;for(let e=0;e<t.length;++e)t[e]._destroyImmediate()},rb._onMobilityChanged=function(){this.emit(Ly.MOBILITY_CHANGED)},rb._onLayerChanged=function(t){this.emit(Ly.LAYER_CHANGED,t)},rb._onChildRemoved=function(t){const e=this._children.indexOf(t);e<0?G(1633):(this._children.splice(e,1),this.emit(Ly.CHILD_REMOVED,t))},rb._onChildAdded=function(t){this._children.push(t),this.emit(Ly.CHILD_ADDED,t)};const ab=rb._onPreDestroy;rb._onPreDestroy=function(){const t=ab.call(this);this.emit(Ly.NODE_DESTROYED,this),this._eventProcessor.destroy();const e=this._children;for(let t=0;t<e.length;++t)e[t]._destroyImmediate();const i=this._components;for(let t=0;t<i.length;++t)i[t]._destroyImmediate();return t},rb.destroyAllChildren=function(){const t=this._children;for(let e=0,i=t.length;e<i;++e)t[e].destroy()},rb._onSiblingOrderChanged=function(){this.emit(Ly.CHILDREN_ORDER_CHANGED)},rb._onActivateNode=function(t){a.director._nodeActivator.activateNode(this,t)},rb._onPostActivated=function(t){2&this._eventMask&&this.emit(Ly.ACTIVE_CHANGED,this,t);const e=this._eventProcessor;e.isEnabled===t&&Qy.callbacksInvoker.emit(2),e.setEnabled(t),t&&(this.invalidateChildren(Uy.TRS),this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.setTextureDirty(),this._uiProps.uiComp._markForUpdateRenderData()))},rb._onLightProbeBakingChanged=function(){this.emit(Ly.LIGHT_PROBE_BAKING_CHANGED)},ib._findComponent=function(t,e){const i=e,s=t._components;if(i._sealed)for(let t=0;t<s.length;++t){const i=s[t];if(i.constructor===e)return i}else for(let t=0;t<s.length;++t){const i=s[t];if(i instanceof e)return i}return null},ib._findComponents=function(t,e,i){const s=e,r=t._components;if(s._sealed)for(let t=0;t<r.length;++t){const s=r[t];s.constructor===e&&i.push(s)}else for(let t=0;t<r.length;++t){const s=r[t];s instanceof e&&i.push(s)}},ib._findChildComponent=function(t,e){for(let i=0;i<t.length;++i){const s=t[i];let r=ib._findComponent(s,e);if(r)return r;const n=s.children;if(n.length>0&&(r=ib._findChildComponent(n,e),r))return r}return null},ib._findChildComponents=function(t,e,i){for(let s=0;s<t.length;++s){const r=t[s];ib._findComponents(r,e,i);const n=r.children;n.length>0&&ib._findChildComponents(n,e,i)}},ib.isNode=function(t){return t instanceof jsb.Node&&(t.constructor===jsb.Node||!(t instanceof a.Scene))};let hb=new sr;rb.setRTS=function(t,e,i){if(t){let e=hb;t instanceof sr?e=t:sr.fromEuler(e,t.x,t.y,t.z),Gy[0]=4,Gy[1]=e.x,Gy[2]=e.y,Gy[3]=e.z,Gy[4]=e.w,this._lrot.set(e.x,e.y,e.z,e.w)}else Gy[0]=0;e?(Gy[5]=3,Gy[6]=e.x,Gy[7]=e.y,Gy[8]=e.z,this._lpos.set(e.x,e.y,e.z)):Gy[5]=0,i?(Gy[9]=3,Gy[10]=i.x,Gy[11]=i.y,Gy[12]=i.z,this._lscale.set(i.x,i.y,i.z)):Gy[9]=0,this._setRTS()},rb.getPosition=function(t){return t?Ms.set(t,this._lpos.x,this._lpos.y,this._lpos.z):Ms.copy(new Ms,this._lpos)},rb.setPosition=function(t,e,i){if(void 0===e&&void 0===i){Gy[0]=3;const e=t;this._lpos.x=Gy[1]=e.x,this._lpos.y=Gy[2]=e.y,this._lpos.z=Gy[3]=e.z}else void 0===i?(Gy[0]=2,this._lpos.x=Gy[1]=t,this._lpos.y=Gy[2]=e):(Gy[0]=3,this._lpos.x=Gy[1]=t,this._lpos.y=Gy[2]=e,this._lpos.z=Gy[3]=i);this._setPosition()},rb.getRotation=function(t){const e=this._lrot;return t?sr.set(t,e.x,e.y,e.z,e.w):sr.copy(new sr,e)},rb.setRotation=function(t,e,i,s){if(void 0===e||void 0===i||void 0===s){const e=t;this._lrot.x=Gy[0]=e.x,this._lrot.y=Gy[1]=e.y,this._lrot.z=Gy[2]=e.z,this._lrot.w=Gy[3]=e.w}else this._lrot.x=Gy[0]=t,this._lrot.y=Gy[1]=e,this._lrot.z=Gy[2]=i,this._lrot.w=Gy[3]=s;this._setRotation()},rb.setRotationFromEuler=function(t,e,i){const s=void 0===i?this._euler.z:i;if(void 0===e){const e=t;this._euler.x=Gy[0]=e.x,this._euler.y=Gy[1]=e.y,this._euler.z=Gy[2]=e.z}else this._euler.x=Gy[0]=t,this._euler.y=Gy[1]=e,this._euler.z=Gy[2]=s;this._setRotationFromEuler()},rb.getScale=function(t){return t?Ms.set(t,this._lscale.x,this._lscale.y,this._lscale.z):Ms.copy(new Ms,this._lscale)},rb.set2DTransform=function(t,e,i){Gy[0]=t,Gy[1]=e,Gy[2]=i,this._set2DTransform()},rb.setScale=function(t,e,i){if(void 0===e&&void 0===i){Gy[0]=3;const e=t;this._lscale.x=Gy[1]=e.x,this._lscale.y=Gy[2]=e.y,this._lscale.z=Gy[3]=e.z}else void 0===i?(Gy[0]=2,this._lscale.x=Gy[1]=t,this._lscale.y=Gy[2]=e):(Gy[0]=3,this._lscale.x=Gy[1]=t,this._lscale.y=Gy[2]=e,this._lscale.z=Gy[3]=i);this._setScale()},rb.getWorldPosition=function(t){return this._getWorldPosition(),(t=t||new Ms).set(Gy[0],Gy[1],Gy[2])},rb.getWorldRotation=function(t){return this._getWorldRotation(),(t=t||new sr).set(Gy[0],Gy[1],Gy[2],Gy[3])},rb.getWorldScale=function(t){return this._getWorldScale(),(t=t||new Ms).set(Gy[0],Gy[1],Gy[2])},rb.getWorldMatrix=function(t){return this._getWorldMatrix(),t=t||new vr,Wy(t),t},rb.getEulerAngles=function(t){return this._getEulerAngles(),(t=t||new Ms).set(Gy[0],Gy[1],Gy[2])},rb.getForward=function(t){return this._getForward(),(t=t||new Ms).set(Gy[0],Gy[1],Gy[2])},rb.getUp=function(t){return this._getUp(),(t=t||new Ms).set(Gy[0],Gy[1],Gy[2])},rb.getRight=function(t){return this._getRight(),(t=t||new Ms).set(Gy[0],Gy[1],Gy[2])},rb.inverseTransformPoint=function(t,e){return Gy[0]=e.x,Gy[1]=e.y,Gy[2]=e.z,this._inverseTransformPoint(),t.x=Gy[0],t.y=Gy[1],t.z=Gy[2],t},rb.getWorldRT=function(t){return t=t||new vr,this._getWorldRT(),Wy(t),t},rb.getWorldRS=function(t){return t=t||new vr,this._getWorldRS(),Wy(t),t},rb.isTransformDirty=function(){return this._transformFlags!==Uy.NONE},Object.defineProperty(rb,"name",{configurable:!0,enumerable:!0,get(){return this._name},set(t){this._name=t}}),Object.defineProperty(rb,"position",{configurable:!0,enumerable:!0,get(){return this._lpos},set(t){this.setPosition(t)}}),Object.defineProperty(rb,"x",{configurable:!0,enumerable:!0,get(){return this._lpos.x},set(t){this.setPosition(t,this._lpos.y,this._lpos.z)}}),Object.defineProperty(rb,"y",{configurable:!0,enumerable:!0,get(){return this._lpos.y},set(t){this.setPosition(this._lpos.x,t,this._lpos.z)}}),Object.defineProperty(rb,"z",{configurable:!0,enumerable:!0,get(){return this._lpos.z},set(t){this.setPosition(this._lpos.x,this._lpos.y,t)}}),Object.defineProperty(rb,"rotation",{configurable:!0,enumerable:!0,get(){return this._lrot},set(t){this.setRotation(t)}}),Object.defineProperty(rb,"scale",{configurable:!0,enumerable:!0,get(){return this._lscale},set(t){this.setScale(t)}}),Object.defineProperty(rb,"worldPosition",{configurable:!0,enumerable:!0,get(){return this.getWorldPosition()},set(t){this.setWorldPosition(t)}}),Object.defineProperty(rb,"worldPositionX",{configurable:!0,enumerable:!0,get(){return this.getWorldPosition(eb),eb.x},set(t){this.getWorldPosition(eb),eb.x=t,this.setWorldPosition(eb)}}),Object.defineProperty(rb,"worldPositionY",{configurable:!0,enumerable:!0,get(){return this.getWorldPosition(eb),eb.y},set(t){this.getWorldPosition(eb),eb.y=t,this.setWorldPosition(eb)}}),Object.defineProperty(rb,"worldPositionZ",{configurable:!0,enumerable:!0,get(){return this.getWorldPosition(eb),eb.z},set(t){this.getWorldPosition(eb),eb.z=t,this.setWorldPosition(eb)}}),Object.defineProperty(rb,"worldRotation",{configurable:!0,enumerable:!0,get(){return this.getWorldRotation()},set(t){this.setWorldRotation(t)}}),Object.defineProperty(rb,"worldScale",{configurable:!0,enumerable:!0,get(){return this.getWorldScale()},set(t){this.setWorldScale(t)}}),Object.defineProperty(rb,"_pos",{configurable:!0,enumerable:!0,get(){return this.getWorldPosition()}}),Object.defineProperty(rb,"_rot",{configurable:!0,enumerable:!0,get(){return this.getWorldRotation()}}),Object.defineProperty(rb,"_scale",{configurable:!0,enumerable:!0,get(){return this.getWorldScale()}}),Object.defineProperty(rb,"eulerAngles",{configurable:!0,enumerable:!0,get(){return this.getEulerAngles()},set(t){this.setRotationFromEuler(t.x,t.y,t.z)}}),Object.defineProperty(rb,"worldMatrix",{configurable:!0,enumerable:!0,get(){return this.getWorldMatrix()}}),Object.defineProperty(rb,"_mat",{configurable:!0,enumerable:!0,get(){return this.getWorldMatrix()}}),Object.defineProperty(rb,"activeInHierarchy",{configurable:!0,enumerable:!0,get(){return!!(1&this._sharedUint8Arr[0])},set(t){t?this._sharedUint8Arr[0]|=1:this._sharedUint8Arr[0]&=-2}}),Object.defineProperty(rb,"_activeInHierarchy",{configurable:!0,enumerable:!0,get(){return!!(1&this._sharedUint8Arr[0])},set(t){t?this._sharedUint8Arr[0]|=1:this._sharedUint8Arr[0]&=-2}}),Object.defineProperty(rb,"layer",{configurable:!0,enumerable:!0,get(){return this._sharedUint32Arr[1]},set(t){this._sharedUint32Arr[1]=t,this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp._markForUpdateRenderData()),this.emit(Ly.LAYER_CHANGED,t)}}),Object.defineProperty(rb,"_layer",{configurable:!0,enumerable:!0,get(){return this._sharedUint32Arr[1]},set(t){this._sharedUint32Arr[1]=t}}),Object.defineProperty(rb,"_eventMask",{configurable:!0,enumerable:!0,get(){return this._sharedUint32Arr[0]},set(t){this._sharedUint32Arr[0]=t}}),Object.defineProperty(rb,"_siblingIndex",{configurable:!0,enumerable:!0,get(){return this._sharedInt32Arr[0]},set(t){this._sharedInt32Arr[0]=t}}),Object.defineProperty(rb,"prefab",{configurable:!0,enumerable:!0,get(){return this._prefab}}),Object.defineProperty(rb,"siblingIndex",{configurable:!0,enumerable:!0,get(){return this._sharedInt32Arr[0]},set(t){this._sharedInt32Arr[0]=t}}),rb.getSiblingIndex=function(){return this._sharedInt32Arr[0]},Object.defineProperty(rb,"_transformFlags",{configurable:!0,enumerable:!0,get(){return this._sharedUint32Arr[2]},set(t){this._sharedUint32Arr[2]=t}}),Object.defineProperty(rb,"_active",{configurable:!0,enumerable:!0,get(){return!!(2&this._sharedUint8Arr[0])},set(t){t?this._sharedUint8Arr[0]|=2:this._sharedUint8Arr[0]&=-3}}),Object.defineProperty(rb,"active",{configurable:!0,enumerable:!0,get(){return!!(2&this._sharedUint8Arr[0])},set(t){this.setActive(!!t)}}),Object.defineProperty(rb,"_static",{configurable:!0,enumerable:!0,get(){return!!(4&this._sharedUint8Arr[0])},set(t){t?this._sharedUint8Arr[0]|=4:this._sharedUint8Arr[0]&=-5}}),Object.defineProperty(rb,"_colorDirty",{configurable:!0,enumerable:!0,get(){return!!(8&this._sharedUint8Arr[0])},set(t){t?this._sharedUint8Arr[0]|=8:this._sharedUint8Arr[0]&=-9}}),Object.defineProperty(rb,"_skewType",{configurable:!0,enumerable:!0,get(){return this._sharedUint8Arr[1]},set(t){this._sharedUint8Arr[1]=t}}),Object.defineProperty(rb,"forward",{configurable:!0,enumerable:!0,get(){return this.getForward()},set(t){this.setForward(t)}}),Object.defineProperty(rb,"up",{configurable:!0,enumerable:!0,get(){return this.getUp()}}),Object.defineProperty(rb,"right",{configurable:!0,enumerable:!0,get(){return this.getRight()}}),Object.defineProperty(rb,"eventProcessor",{configurable:!0,enumerable:!0,get(){return this._eventProcessor}}),Object.defineProperty(rb,"components",{configurable:!0,enumerable:!0,get(){return this._components}}),Object.defineProperty(rb,"_parent",{configurable:!0,enumerable:!0,get(){return this._parentRef=this._parentInternal,this._parentRef},set(t){this._parentRef=this._parentInternal=t}}),Object.defineProperty(rb,"parent",{configurable:!0,enumerable:!0,get(){return this._parentRef=this.getParent(),this._parentRef},set(t){this._parentRef=t,this.setParent(t)}}),Object.defineProperty(rb,"children",{configurable:!0,enumerable:!0,get(){return this._children},set(t){this._children=t}}),Object.defineProperty(rb,"scene",{configurable:!0,enumerable:!0,get(){return this._scene}}),Object.defineProperty(rb,"id",{configurable:!0,enumerable:!0,set(t){this._id=t}}),rb.rotate=function(t,e){Gy[1]=t.x,Gy[2]=t.y,Gy[3]=t.z,Gy[4]=t.w,e?(Gy[5]=e,Gy[0]=5):Gy[0]=4,this._rotateForJS();const i=this._lrot;i.x=Gy[0],i.y=Gy[1],i.z=Gy[2],i.w=Gy[3]},rb.addChild=function(t){t.setParent(this)},rb.insertChild=function(t,e){t.parent=this,t.setSiblingIndex(e)},rb[al]=function(t,e){t.writeThis();const i=()=>{var t;return!(null==(t=this[wo])||!t.mountedRoot)},s=()=>{var t,e,s,r;return(null==(t=this._prefab)||null==(e=t.root)||null==(s=e._prefab)?void 0:s.instance)&&((null==this||null==(r=this._prefab)?void 0:r.instance)||!i())};var r;if((()=>!(e.customArguments[Jy]||!s()||e.root===this))()){if((null==(r=this._prefab)?void 0:r.root)===this){let i=!1,s=this.getParent();for(;s;){var n;const t=null==(n=s._prefab)?void 0:n.nestedPrefabInstanceRoots;if(t&&t.length>0){i=!t.some((t=>t===this));break}s=s.getParent()}i||(t.writeProperty("_objFlags",this._objFlags),t.writeProperty("_parent",this._parent),t.writeProperty("_prefab",this._prefab),e.customArguments.keepNodeUuid&&t.writeProperty("_id",this._id)),t.writeProperty(wo,this[wo])}}else t.writeThis()},rb._onActiveNode=function(t){a.director._nodeActivator.activateNode(this,t)},rb._onBatchCreated=function(t){2&this._eventMask&&(this._activeInHierarchy||this.emit(Ly.ACTIVE_CHANGED,this,!1)),this.hasChangedFlags=sb;const e=this._children,i=e.length;let s;for(let r=0;r<i;++r)s=e[r],s._siblingIndex=r,s._onBatchCreated(t);_m(this)},rb._onSceneUpdated=function(t){this._scene=t},rb._onLocalPositionUpdated=function(t,e,i){const s=this._lpos;s.x=t,s.y=e,s.z=i},rb._onLocalRotationUpdated=function(t,e,i,s){const r=this._lrot;r.x=t,r.y=e,r.z=i,r.w=s},rb._onLocalScaleUpdated=function(t,e,i){const s=this._lscale;s.x=t,s.y=e,s.z=i},rb._onLocalPositionRotationScaleUpdated=function(t,e,i,s,r,n,o,a,h,l){const c=this._lpos;c.x=t,c.y=e,c.z=i;const u=this._lrot;u.x=s,u.y=r,u.z=n,u.w=o;const d=this._lscale;d.x=a,d.y=h,d.z=l},rb._instantiate=function(t,e){return t||(t=a.instantiate._clone(this,this)),t._prefab,t._parent=null,t._onBatchCreated(e),t},rb._getUITransformComp=function(){return this._uiProps.uiTransformComp},rb._onSiblingIndexChanged=function(t){const e=this._parent._children;t=-1!==t?t:e.length-1;const i=e.indexOf(this);t!==i&&(e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this),this._eventProcessor.onUpdatingSiblingIndex())},rb._setSkew=function(t){this._sharedFloat32Arr[0]=t.x,this._sharedFloat32Arr[1]=t.y},rb._getSkewX=function(){return this._sharedFloat32Arr[0]},rb._setSkewX=function(t){this._sharedFloat32Arr[0]=t},rb._getSkewY=function(){return this._sharedFloat32Arr[1]},rb._setSkewY=function(t){this._sharedFloat32Arr[1]=t},rb._getLocalOpacity=function(){return this._sharedFloat32Arr[2]},rb._setLocalOpacity=function(t){this._sharedFloat32Arr[2]=t},rb._getFinalOpacity=function(){return this._sharedFloat32Arr[3]},rb._setFinalOpacity=function(t){this._sharedFloat32Arr[3]=t},rb._ctor=function(){this.__nativeRefs={},this._parentRef=null,this.__jsb_ref_id=void 0,this._iN$t=null,this.__editorExtras__={editorOnly:!0},this._components=[],this._eventProcessor=new Qy(this),this._uiProps=new ky(this);const t=this._initAndReturnSharedBuffer();this._sharedUint32Arr=new Uint32Array(t,0,3),this._sharedInt32Arr=new Int32Array(t,12,1),this._sharedUint8Arr=new Uint8Array(t,16,4),this._sharedFloat32Arr=new Float32Array(t,20,4),this._sharedUint32Arr[1]=Hy.Enum.DEFAULT,this._scene=null,this._prefab=null,this._originalSceneId="",this._children=[],this._lpos=new Ms,this._lrot=new sr,this._lscale=new Ms(1,1,1),this._euler=new Ms,this._registeredNodeEventTypeMask=0},function(t,e=dm){const{Node:i,Vec3:s,Quat:r,MobilityMode:n,Layers:o}={...t},a=Object.getOwnPropertyDescriptor(i.prototype,"_persistNode");Object.getOwnPropertyDescriptor(i.prototype,"name"),Object.getOwnPropertyDescriptor(i.prototype,"children"),Object.getOwnPropertyDescriptor(i.prototype,"active"),Object.getOwnPropertyDescriptor(i.prototype,"activeInHierarchy"),Object.getOwnPropertyDescriptor(i.prototype,"parent");const h=Object.getOwnPropertyDescriptor(i.prototype,"eulerAngles");Object.getOwnPropertyDescriptor(i.prototype,"angle");const l=Object.getOwnPropertyDescriptor(i.prototype,"mobility");Object.getOwnPropertyDescriptor(i.prototype,"layer"),e((()=>{uh(i.prototype,"_persistNode",a)}),"property","_persistNode"),e((()=>{Ph(i.prototype)}),"editable","name"),e((()=>{Ph(i.prototype)}),"editable","children"),e((()=>{Ph(i.prototype)}),"editable","active"),e((()=>{Ph(i.prototype)}),"editable","activeInHierarchy"),e((()=>{Ph(i.prototype)}),"editable","parent"),e((()=>{vh(i.prototype,"_parent",(()=>null))}),"serializable","_parent"),e((()=>{vh(i.prototype,"_children",(()=>[]))}),"serializable","_children"),e((()=>{vh(i.prototype,"_active",(()=>!0))}),"serializable","_active"),e((()=>{vh(i.prototype,"_components",(()=>[]))}),"serializable","_components"),e((()=>{vh(i.prototype,"_prefab",(()=>null))}),"serializable","_prefab"),e((()=>{vh(i.prototype,"_lpos",(()=>new s))}),"serializable","_lpos"),e((()=>{vh(i.prototype,"_lrot",(()=>new r))}),"serializable","_lrot"),e((()=>{vh(i.prototype,"_lscale",(()=>new s(1,1,1)))}),"serializable","_lscale"),e((()=>{vh(i.prototype,"_mobility",(()=>n.Static))}),"serializable","_mobility"),e((()=>{vh(i.prototype,"_layer",(()=>o.Enum.DEFAULT))}),"serializable","_layer"),e((()=>{vh(i.prototype,"_euler",(()=>new s))}),"serializable","_euler"),e((()=>{Xh(s)(i.prototype,"eulerAngles",h)}),"type","eulerAngles"),e((()=>{Ph(i.prototype)}),"editable","angle"),e((()=>{Xh(n)(i.prototype,"mobility",l)}),"type","mobility"),e((()=>{Ph(i.prototype)}),"editable","mobility"),e((()=>{Ph(i.prototype)}),"editable","layer"),e((()=>{ah("cc.Node")(i)}),"ccclass",null)}({Node:tb,Vec3:Ms,Quat:sr,MobilityMode:Vy,Layers:Hy}),yi.Attr.setClassAttr(Um,"target","type","Object"),yi.Attr.setClassAttr(Um,"target","ctor",tb);const lb=jsb.TextureCube.prototype;var cb,ub;!function(t){t[t.right=0]="right",t[t.left=1]="left",t[t.top=2]="top",t[t.bottom=3]="bottom",t[t.front=4]="front",t[t.back=5]="back"}(cb||(cb={})),function(t){t[t.NONE=0]="NONE",t[t.AUTO=1]="AUTO",t[t.BAKED_CONVOLUTION_MAP=2]="BAKED_CONVOLUTION_MAP"}(ub||(ub={})),lb.createNode=null;const db=t("TextureCube",jsb.TextureCube);db.Filter=vm,db.PixelFormat=ym,db.WrapMode=bm,lb._ctor=function(){jsb.SimpleTexture.prototype._ctor.apply(this,arguments),this._mipmaps=null,this._mipmapAtlas=null},Object.defineProperty(lb,"mipmaps",{get(){return this._mipmaps},set(t){this._mipmaps=t,this.setMipmaps(t)}}),Object.defineProperty(lb,"image",{get(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set(t){this.mipmaps=t?[t]:[]}});const _b=lb.onLoaded;let pb;lb.onLoaded=function(){this._mipmapMode===ub.BAKED_CONVOLUTION_MAP?this.setMipmapAtlasForJS(this._mipmapAtlas):this.setMipmapsForJS(this._mipmaps),_b.apply(this)},lb._serialize=function(){return null},lb._deserialize=function(t,e){const i=t;if(jsb.TextureBase.prototype._deserialize.call(this,i.base,e),this.isRGBE=i.rgbe,null!=i.mipmapMode&&(this._mipmapMode=i.mipmapMode),this._mipmapMode===ub.BAKED_CONVOLUTION_MAP){const t=i.mipmapAtlas,s=i.mipmapLayout;if(this._mipmapAtlas={atlas:{},layout:s},this._mipmapAtlas.atlas={front:new jsb.ImageAsset,back:new jsb.ImageAsset,left:new jsb.ImageAsset,right:new jsb.ImageAsset,top:new jsb.ImageAsset,bottom:new jsb.ImageAsset},t){const i=Qt(jsb.ImageAsset);e.result.push(this._mipmapAtlas.atlas,"front",t.front,i),e.result.push(this._mipmapAtlas.atlas,"back",t.back,i),e.result.push(this._mipmapAtlas.atlas,"left",t.left,i),e.result.push(this._mipmapAtlas.atlas,"right",t.right,i),e.result.push(this._mipmapAtlas.atlas,"top",t.top,i),e.result.push(this._mipmapAtlas.atlas,"bottom",t.bottom,i)}}else{this._mipmaps=new Array(i.mipmaps.length);for(let t=0;t<i.mipmaps.length;++t){this._mipmaps[t]={front:new jsb.ImageAsset,back:new jsb.ImageAsset,left:new jsb.ImageAsset,right:new jsb.ImageAsset,top:new jsb.ImageAsset,bottom:new jsb.ImageAsset};const s=i.mipmaps[t],r=Qt(jsb.ImageAsset);e.result.push(this._mipmaps[t],"front",s.front,r),e.result.push(this._mipmaps[t],"back",s.back,r),e.result.push(this._mipmaps[t],"left",s.left,r),e.result.push(this._mipmaps[t],"right",s.right,r),e.result.push(this._mipmaps[t],"top",s.top,r),e.result.push(this._mipmaps[t],"bottom",s.bottom,r)}}},a.TextureCube=jsb.TextureCube,function(t,e=dm){const{TextureCube:i,MipmapMode:s}={...t};e((()=>{vh(i.prototype,"isRGBE",(()=>!1))}),"serializable","isRGBE"),e((()=>{vh(i.prototype,"_mipmapAtlas",(()=>null))}),"serializable","_mipmapAtlas"),e((()=>{vh(i.prototype,"_mipmapMode",(()=>s.NONE))}),"serializable","_mipmapMode"),e((()=>{vh(i.prototype,"_mipmaps",(()=>[]))}),"serializable","_mipmaps"),e((()=>{ah("cc.TextureCube")(i)}),"ccclass",null)}({TextureCube:db,MipmapMode:ub}),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SKINNING=1]="SKINNING",t[t.BAKED_SKINNING=2]="BAKED_SKINNING",t[t.BATCH_2D=3]="BATCH_2D",t[t.PARTICLE_BATCH=4]="PARTICLE_BATCH",t[t.LINE=5]="LINE"}(pb||(pb={}));const mb=jsb.Model,gb=mb.prototype;gb._ctor=function(){this._device=yp.gfxDevice};const fb=gb.createBoundingShape;gb.createBoundingShape=function(t,e){t&&e&&fb.call(this,t,e)};const yb=jsb.SubModel;let bb,vb,Sb,Tb,wb,xb,Cb,Ab,Db;!function(t){t[t.VERTICAL=0]="VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL"}(bb||(bb={})),function(t){t[t.ORTHO=0]="ORTHO",t[t.PERSPECTIVE=1]="PERSPECTIVE"}(vb||(vb={})),function(t){t[t.F1_8=0]="F1_8",t[t.F2_0=1]="F2_0",t[t.F2_2=2]="F2_2",t[t.F2_5=3]="F2_5",t[t.F2_8=4]="F2_8",t[t.F3_2=5]="F3_2",t[t.F3_5=6]="F3_5",t[t.F4_0=7]="F4_0",t[t.F4_5=8]="F4_5",t[t.F5_0=9]="F5_0",t[t.F5_6=10]="F5_6",t[t.F6_3=11]="F6_3",t[t.F7_1=12]="F7_1",t[t.F8_0=13]="F8_0",t[t.F9_0=14]="F9_0",t[t.F10_0=15]="F10_0",t[t.F11_0=16]="F11_0",t[t.F13_0=17]="F13_0",t[t.F14_0=18]="F14_0",t[t.F16_0=19]="F16_0",t[t.F18_0=20]="F18_0",t[t.F20_0=21]="F20_0",t[t.F22_0=22]="F22_0"}(Sb||(Sb={})),function(t){t[t.ISO100=0]="ISO100",t[t.ISO200=1]="ISO200",t[t.ISO400=2]="ISO400",t[t.ISO800=3]="ISO800"}(Tb||(Tb={})),function(t){t[t.D1=0]="D1",t[t.D2=1]="D2",t[t.D4=2]="D4",t[t.D8=3]="D8",t[t.D15=4]="D15",t[t.D30=5]="D30",t[t.D60=6]="D60",t[t.D125=7]="D125",t[t.D250=8]="D250",t[t.D500=9]="D500",t[t.D1000=10]="D1000",t[t.D2000=11]="D2000",t[t.D4000=12]="D4000"}(wb||(wb={})),function(t){t[t.DEFAULT=-1]="DEFAULT",t[t.LEFT_EYE=0]="LEFT_EYE",t[t.RIGHT_EYE=1]="RIGHT_EYE",t[t.MAIN=2]="MAIN"}(xb||(xb={})),function(t){t[t.NO_TRACKING=0]="NO_TRACKING",t[t.POSITION_AND_ROTATION=1]="POSITION_AND_ROTATION",t[t.POSITION=2]="POSITION",t[t.ROTATION=3]="ROTATION"}(Cb||(Cb={})),function(t){t[t.EDITOR=0]="EDITOR",t[t.GAME_VIEW=1]="GAME_VIEW",t[t.SCENE_VIEW=2]="SCENE_VIEW",t[t.PREVIEW=3]="PREVIEW",t[t.GAME=100]="GAME"}(Ab||(Ab={})),function(t){t[t.VALUE=Vd.STENCIL<<1]="VALUE"}(Db||(Db={}));const Eb=Db.VALUE,Ib=jsb.Camera,Mb=jsb.Camera.prototype;Object.defineProperty(Ib,"standardExposureValue",{configurable:!0,enumerable:!0,get:()=>Ib.getStandardExposureValue()}),Object.defineProperty(Ib,"standardLightMeterScale",{configurable:!0,enumerable:!0,get:()=>Ib.getStandardLightMeterScale()}),Object.defineProperty(Mb,"matView",{configurable:!0,enumerable:!0,get(){return this.getMatView(),Wy(this._matView),this._matView}}),Object.defineProperty(Mb,"matProj",{configurable:!0,enumerable:!0,get(){return this.getMatProj(),Wy(this._matProj),this._matProj}}),Object.defineProperty(Mb,"matProjInv",{configurable:!0,enumerable:!0,get(){return this.getMatProjInv(),Wy(this._matProjInv),this._matProjInv}}),Object.defineProperty(Mb,"matViewProj",{configurable:!0,enumerable:!0,get(){return this.getMatViewProj(),Wy(this._matViewProj),this._matViewProj}}),Object.defineProperty(Mb,"matViewProjInv",{configurable:!0,enumerable:!0,get(){return this.getMatViewProjInv(),Wy(this._matViewProjInv),this._matViewProjInv}});const Pb=Mb.initialize;Mb.initialize=function(){Pb.apply(this,arguments),this._matView=new vr,this._matProj=new vr,this._matProjInv=new vr,this._matViewProj=new vr,this._matViewProjInv=new vr};const Ob=Mb.screenPointToRay,Rb=Mb.screenToWorld,Bb=Mb.worldToScreen,Fb=Mb.worldMatrixToScreen;let Nb,Lb;Mb.screenPointToRay=function(t,e,i){return Gy[0]=e,Gy[1]=i,Ob.call(this),t.o.x=Gy[0],t.o.y=Gy[1],t.o.z=Gy[2],t.d.x=Gy[3],t.d.y=Gy[4],t.d.z=Gy[5],t},Mb.screenToWorld=function(t,e){return Gy[0]=e.x,Gy[1]=e.y,Gy[2]=e.z,Rb.call(this),Ms.set(t,Gy[0],Gy[1],Gy[2]),t},Mb.worldToScreen=function(t,e){return Gy[0]=e.x,Gy[1]=e.y,Gy[2]=e.z,Bb.call(this),Ms.set(t,Gy[0],Gy[1],Gy[2]),t},Mb.worldMatrixToScreen=function(t,e,i,s){return Gy[0]=e.m00,Gy[1]=e.m01,Gy[2]=e.m02,Gy[3]=e.m03,Gy[4]=e.m04,Gy[5]=e.m05,Gy[6]=e.m06,Gy[7]=e.m07,Gy[8]=e.m08,Gy[9]=e.m09,Gy[10]=e.m10,Gy[11]=e.m11,Gy[12]=e.m12,Gy[13]=e.m13,Gy[14]=e.m14,Gy[15]=e.m15,Gy[16]=i,Gy[17]=s,Fb.call(this),Wy(t),t},function(t){t[t.SKYBOX=Eb|Vd.DEPTH_STENCIL]="SKYBOX",t[t.SOLID_COLOR=Vd.ALL]="SOLID_COLOR"}(Nb||(Nb={})),function(t){t[t.CUBE=0]="CUBE",t[t.PLANAR=1]="PLANAR"}(Lb||(Lb={}));const kb=jsb.ReflectionProbe;jsb.ReflectionProbe.prototype._ctor=function(t){this._probeId=t};const zb=jsb.LODData,Ub=jsb.LODGroup,Vb=jsb.Ambient;let jb;a.Ambient=Vb,Vb.SUN_ILLUM=65e3,Vb.SKY_ILLUM=2e4,function(t){t[t.DIRECTIONAL=0]="DIRECTIONAL",t[t.SPHERE=1]="SPHERE",t[t.SPOT=2]="SPOT",t[t.POINT=3]="POINT",t[t.RANGED_DIRECTIONAL=4]="RANGED_DIRECTIONAL",t[t.UNKNOWN=5]="UNKNOWN"}(jb||(jb={}));const Hb=t=>4*Math.PI*Math.PI*t*t,Gb=jsb.Light;a.Light=jsb.Light;const Wb=jsb.DirectionalLight;a.DirectionalLight=jsb.DirectionalLight;const Xb=jsb.SpotLight;a.SpotLight=jsb.SpotLight;const Yb=jsb.SphereLight;a.SphereLight=jsb.SphereLight;const qb=jsb.PointLight;a.PointLight=jsb.PointLight;const $b=jsb.RangedDirectionalLight;a.RangedDirectionalLight=jsb.RangedDirectionalLight;const Kb=pe({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),Zb=Kb.LAYERED+1,Qb=jsb.FogInfo,Jb=jsb.Fog;a.Fog=Jb;const tv=pe({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048}),ev=pe({Planar:0,ShadowMap:1}),iv=pe({HARD:0,SOFT:1,SOFT_2X:2,SOFT_4X:3}),sv=pe({LEVEL_1:1,LEVEL_2:2,LEVEL_3:3,LEVEL_4:4}),rv=pe({NONE:1,RemoveDuplicates:2,DisableRotationFix:3}),nv=pe({HEMISPHERE_DIFFUSE:0,AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION:1,DIFFUSEMAP_WITH_REFLECTION:2}),ov=pe({DEFAULT:0,LINEAR:1}),av=jsb.ShadowsInfo,hv=jsb.Shadows;a.Shadows=hv,Object.defineProperty(hv,"MAX_FAR",{configurable:!0,enumerable:!0,get:()=>2e3});const lv=2*Math.sqrt(3);Object.defineProperty(hv,"COEFFICIENT_OF_EXPANSION",{configurable:!0,enumerable:!0,get:()=>lv});const cv=jsb.Skybox;a.Skybox=cv;const uv=jsb.PostSettings;a.PostSettings=uv;var dv=Object.freeze({__proto__:null,Ambient:Vb,CSMLevel:sv,CSMOptimizationMode:rv,Camera:Ib,get CameraAperture(){return Sb},get CameraFOVAxis(){return bb},get CameraISO(){return Tb},get CameraProjection(){return vb},get CameraShutter(){return wb},get CameraType(){return xb},get CameraUsage(){return Ab},ColorTemperatureToRGB:function(t,e){e<1e3?e=1e3:e>15e3&&(e=15e3);const i=e*e,s=(.860117757+.000154118254*e+1.28641212e-7*i)/(1+.000842420235*e+7.08145163e-7*i),r=(.317398726+422806245e-13*e+4.20481691e-8*i)/(1-289741816e-13*e+1.61456053e-7*i),n=2*s-8*r+4,o=3*s/n,a=2*r/n,h=1/a*o,l=1/a*(1-o-a);t.x=3.2404542*h-1.5371385+-.4985314*l,t.y=-.969266*h+1.8760108+.041556*l,t.z=.0556434*h-.2040259+1.0572252*l},DirectionalLight:Wb,EnvironmentLightingType:nv,FOG_TYPE_NONE:Zb,Fog:Jb,FogInfo:Qb,FogType:Kb,LODData:zb,LODGroup:Ub,Light:Gb,get LightType(){return jb},Model:mb,get ModelType(){return pb},PCFType:iv,PointLight:qb,PostSettings:uv,get ProbeClearFlag(){return Nb},get ProbeType(){return Lb},RangedDirectionalLight:$b,ReflectionProbe:kb,SKYBOX_FLAG:Eb,ShadowSize:tv,ShadowType:ev,Shadows:hv,ShadowsInfo:av,get SkyBoxFlagValue(){return Db},Skybox:cv,SphereLight:Yb,SpotLight:Xb,SubModel:yb,ToneMappingType:ov,get TrackingType(){return Cb},nt2lm:Hb});const _v=t("EffectAsset",jsb.EffectAsset);a.EffectAsset=_v,_v.prototype._ctor=function(){jsb.Asset.prototype._ctor.apply(this,arguments),this.hideInEditor=!1},function(t,e=dm){const{EffectAsset:i}={...t};e((()=>{Ph(i.prototype)}),"editable","techniques"),e((()=>{vh(i.prototype,"techniques",(()=>[]))}),"serializable","techniques"),e((()=>{Ph(i.prototype)}),"editable","shaders"),e((()=>{vh(i.prototype,"shaders",(()=>[]))}),"serializable","shaders"),e((()=>{Ph(i.prototype)}),"editable","combinations"),e((()=>{vh(i.prototype,"combinations",(()=>[]))}),"serializable","combinations"),e((()=>{Th(i.prototype,"hideInEditor",(()=>!1))}),"editorOnly","hideInEditor"),e((()=>{vh(i.prototype,"hideInEditor",(()=>!1))}),"serializable","hideInEditor"),e((()=>{ah("cc.EffectAsset")(i)}),"ccclass",null)}({EffectAsset:_v});const pv=jsb.Material.prototype;function mv(t,e,i,s,r){null!=r?t.call(e,i,s,r):t.call(e,i,s)}var gv;!function(t){t[t.VEC2=0]="VEC2",t[t.VEC3=1]="VEC3",t[t.VEC4=2]="VEC4",t[t.QUATERNION=3]="QUATERNION",t[t.MAT3=4]="MAT3",t[t.MAT4=5]="MAT4",t[t.SIZE=6]="SIZE",t[t.RECT=7]="RECT",t[t.COLOR=8]="COLOR"}(gv||(gv={})),pv.setProperty=function(t,e,i){if(Array.isArray(e)){const s=e[0];"number"==typeof s?Number.isInteger(s)?mv(this.setPropertyInt32Array,this,t,e,i):mv(this.setPropertyFloat32Array,this,t,e,i):s instanceof kr?mv(this.setPropertyVec2Array,this,t,e,i):s instanceof Ms?mv(this.setPropertyVec3Array,this,t,e,i):s instanceof ms?mv(this.setPropertyVec4Array,this,t,e,i):s instanceof Ls?mv(this.setPropertyColorArray,this,t,e,i):s instanceof js?mv(this.setPropertyMat3Array,this,t,e,i):s instanceof vr?mv(this.setPropertyMat4Array,this,t,e,i):s instanceof sr?mv(this.setPropertyQuatArray,this,t,e,i):s instanceof of?mv(this.setPropertyTextureBaseArray,this,t,e,i):s instanceof Rp?mv(this.setPropertyGFXTextureArray,this,t,e,i):a.error(`Material.setProperty Unknown type: ${e}`)}else"number"==typeof e?Number.isInteger(e)?mv(this.setPropertyInt32,this,t,e,i):mv(this.setPropertyFloat32,this,t,e,i):e instanceof kr?mv(this.setPropertyVec2,this,t,e,i):e instanceof Ms?mv(this.setPropertyVec3,this,t,e,i):e instanceof ms?mv(this.setPropertyVec4,this,t,e,i):e instanceof Ls?mv(this.setPropertyColor,this,t,e,i):e instanceof js?mv(this.setPropertyMat3,this,t,e,i):e instanceof vr?mv(this.setPropertyMat4,this,t,e,i):e instanceof sr?mv(this.setPropertyQuat,this,t,e,i):e instanceof of?mv(this.setPropertyTextureBase,this,t,e,i):e instanceof Rp?mv(this.setPropertyGFXTexture,this,t,e,i):null===e?i?this.setPropertyNull(t,i):this.setPropertyNull(t):a.error(`Material.setProperty Unknown type: ${e}`)},pv.getProperty=function(t,e){let i,s;if(i=void 0!==e?this._getProperty(t,e):this._getProperty(t),Array.isArray(i)){const t=i[0],e=[];if(t instanceof jsb.Vec2||t.type===gv.VEC2)for(let t=0,s=i.length;t<s;++t){const s=i[t];e.push(new kr(s.x,s.y))}else if(t.type===gv.VEC3)for(let t=0,s=i.length;t<s;++t){const s=i[t];e.push(new Ms(s.x,s.y,s.z))}else if(t.type===gv.VEC4)for(let t=0,s=i.length;t<s;++t){const s=i[t];e.push(new ms(s.x,s.y,s.z,s.w))}else if(t instanceof jsb.Color)for(let t=0,s=i.length;t<s;++t){const s=i[t];e.push(new Ls(s.r,s.g,s.b,s.a))}else if(t.type===gv.MAT3)for(let t=0,s=i.length;t<s;++t){const s=i[t];e.push(new js(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8]))}else if(t.type===gv.MAT4)for(let t=0,s=i.length;t<s;++t){const s=i[t];e.push(new vr(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8],s[9],s[10],s[11],s[12],s[13],s[14],s[15]))}else if(t.type===gv.QUATERNION)for(let t=0,s=i.length;t<s;++t){const s=i[t];e.push(new sr(s.x,s.y,s.z,s.w))}return e||i}if(null==i)return null;const r=i;return i instanceof jsb.Vec2||i.type===gv.VEC2?s=new Ms(r.x,r.y):i.type===gv.VEC3?s=new Ms(r.x,r.y,r.z):i.type===gv.VEC4?s=new ms(r.x,r.y,r.z,r.w):i instanceof jsb.Color?s=new Ls(r.r,r.g,r.b,r.a):i.type===gv.MAT3?s=new js(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8]):i.type===gv.MAT4?s=new vr(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15]):i.type===gv.QUATERNION&&(s=new sr(r.x,r.y,r.z,r.w)),s||i};const fv=t("Material",jsb.Material);a.Material=fv;const yv=fv.prototype;yv._ctor=function(){jsb.Asset.prototype._ctor.apply(this,arguments),this._props=[],this._passes=[],this._registerPassesUpdatedListener(),this._isCtorCalled=!0};const bv=yv.onLoaded;yv.onLoaded=function(){this._propsInternal=this._props,bv.call(this)},yv._onPassesUpdated=function(){this._passes=this.getPasses()},Object.defineProperty(yv,"passes",{enumerable:!0,configurable:!0,get(){return this._isCtorCalled||(this._ctor(),this._passes=this.getPasses()),this._passes}}),function(t,e=dm){const{Material:i,EffectAsset:s}={...t};e((()=>{Xh(s)(i.prototype,"_effectAsset",(()=>null))}),"type","_effectAsset"),e((()=>{vh(i.prototype,"_techIdx",(()=>0))}),"serializable","_techIdx"),e((()=>{vh(i.prototype,"_defines",(()=>[]))}),"serializable","_defines"),e((()=>{vh(i.prototype,"_states",(()=>[]))}),"serializable","_states"),e((()=>{vh(i.prototype,"_props",(()=>[]))}),"serializable","_props"),e((()=>{ah("cc.Material")(i)}),"ccclass",null)}({Material:fv,EffectAsset:_v});const vv=t("DEFAULT_WORLD_MIN_POS",new Ms(-1024,-1024,-1024)),Sv=t("DEFAULT_WORLD_MAX_POS",new Ms(1024,1024,1024)),Tv=t("DEFAULT_OCTREE_DEPTH",8),wv=t("FogType",pe({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3})),xv=t("ShadowSize",pe({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048})),Cv=t("ShadowType",pe({Planar:0,ShadowMap:1})),Av=t("AmbientInfo",jsb.AmbientInfo);h.AmbientInfo=Av;const Dv=t("SkyboxInfo",jsb.SkyboxInfo);h.SkyboxInfo=Dv;const Ev=t("FogInfo",jsb.FogInfo);h.FogInfo=Ev,Ev.FogType=wv;const Iv=t("ShadowsInfo",jsb.ShadowsInfo);h.ShadowsInfo=Iv;const Mv=t("OctreeInfo",jsb.OctreeInfo);h.OctreeInfo=Mv;const Pv=t("LightProbeInfo",jsb.LightProbeInfo),Ov=t("SceneGlobals",jsb.SceneGlobals);h.SceneGlobals=Ov;const Rv=t("SkinInfo",jsb.SkinInfo);h.SkinInfo=Rv;const Bv=t("PostSettingsInfo",jsb.PostSettingsInfo);var Fv;h.PostSettingsInfo=Bv,function(){const t=Ov.prototype;t._ctor=function(){this._ambientRef=this.getAmbientInfo(),this._shadowsRef=this.getShadowsInfo(),this._skyboxRef=this.getSkyboxInfo(),this._fogRef=this.getFogInfo(),this._octreeRef=this.getOctreeInfo(),this._lightProbeRef=this.getLightProbeInfo(),this._skinRef=this.getSkinInfo(),this._postSettingsRef=this.getPostSettingsInfo()},Object.defineProperty(t,"ambient",{enumerable:!0,configurable:!0,get(){return this._ambientRef},set(t){this._ambientRef=t,this.setAmbientInfo(t)}}),Object.defineProperty(t,"shadows",{enumerable:!0,configurable:!0,get(){return this._shadowsRef},set(t){this._shadowsRef=t,this.setShadowsInfo(t)}}),Object.defineProperty(t,"_skybox",{enumerable:!0,configurable:!0,get(){return this._skyboxRef},set(t){this._skyboxRef=t,this.setSkyboxInfo(t)}}),Object.defineProperty(t,"skybox",{enumerable:!0,configurable:!0,get(){return this._skyboxRef},set(t){this._skyboxRef=t,this.setSkyboxInfo(t)}}),Object.defineProperty(t,"fog",{enumerable:!0,configurable:!0,get(){return this._fogRef},set(t){this._fogRef=t,this.setFogInfo(t)}}),Object.defineProperty(t,"octree",{enumerable:!0,configurable:!0,get(){return this._octreeRef},set(t){this._octreeRef=t,this.setOctreeInfo(t)}}),Object.defineProperty(t,"lightProbeInfo",{enumerable:!0,configurable:!0,get(){return this._lightProbeRef},set(t){this._lightProbeRef=t,this.setLightProbeInfo(t)}}),Object.defineProperty(t,"skin",{enumerable:!0,configurable:!0,get(){return this._skinRef},set(t){this._skinRef=t,this.setSkinInfo(t)}}),Object.defineProperty(t,"postSettings",{enumerable:!0,configurable:!0,get(){return this._postSettingsRef},set(t){this._postSettingsRef=t,this.setPostSettingsInfo(t)}})}(),function(t,e=dm){const{SceneGlobals:i,AmbientInfo:s,ShadowsInfo:r,SkyboxInfo:n,FogInfo:o,OctreeInfo:a,SkinInfo:h,LightProbeInfo:l,PostSettingsInfo:c}={...t},u=Object.getOwnPropertyDescriptor(i.prototype,"skybox");e((()=>{Ph(i.prototype)}),"editable","ambient"),e((()=>{vh(i.prototype,"ambient",(()=>new s))}),"serializable","ambient"),e((()=>{Ph(i.prototype)}),"editable","shadows"),e((()=>{vh(i.prototype,"shadows",(()=>new r))}),"serializable","shadows"),e((()=>{vh(i.prototype,"_skybox",(()=>new n))}),"serializable","_skybox"),e((()=>{vh(i.prototype,"fog",(()=>new o))}),"serializable","fog"),e((()=>{Ph(i.prototype)}),"editable","fog"),e((()=>{Xh(n)(i.prototype,"skybox",u)}),"type","skybox"),e((()=>{Ph(i.prototype)}),"editable","skybox"),e((()=>{vh(i.prototype,"octree",(()=>new a))}),"serializable","octree"),e((()=>{Ph(i.prototype)}),"editable","octree"),e((()=>{vh(i.prototype,"skin",(()=>new h))}),"serializable","skin"),e((()=>{Ph(i.prototype)}),"editable","skin"),e((()=>{vh(i.prototype,"lightProbeInfo",(()=>new l))}),"serializable","lightProbeInfo"),e((()=>{Ph(i.prototype)}),"editable","lightProbeInfo"),e((()=>{vh(i.prototype,"postSettings",(()=>new c))}),"serializable","postSettings"),e((()=>{Ph(i.prototype)}),"editable","postSettings"),e((()=>{vh(i.prototype,"bakedWithStationaryMainLight",(()=>!1))}),"serializable","bakedWithStationaryMainLight"),e((()=>{Ph(i.prototype)}),"editable","bakedWithStationaryMainLight"),e((()=>{vh(i.prototype,"bakedWithHighpLightmap",(()=>!1))}),"serializable","bakedWithHighpLightmap"),e((()=>{Ph(i.prototype)}),"editable","bakedWithHighpLightmap"),e((()=>{ah("cc.SceneGlobals")(i)}),"ccclass",null)}({SceneGlobals:Ov,AmbientInfo:Av,SkyboxInfo:Dv,FogInfo:Ev,ShadowsInfo:Iv,LightProbeInfo:Pv,OctreeInfo:Mv,SkinInfo:Rv,PostSettingsInfo:Bv}),function(t,e=dm){const{OctreeInfo:i,CCInteger:s,Vec3:r,DEFAULT_WORLD_MIN_POS:n,DEFAULT_WORLD_MAX_POS:o,DEFAULT_OCTREE_DEPTH:a}={...t},h=Object.getOwnPropertyDescriptor(i.prototype,"enabled"),l=Object.getOwnPropertyDescriptor(i.prototype,"minPos"),c=Object.getOwnPropertyDescriptor(i.prototype,"maxPos"),u=Object.getOwnPropertyDescriptor(i.prototype,"depth");e((()=>{Fh()(i.prototype,"enabled",h)}),"tooltip","enabled"),e((()=>{Ph(i.prototype)}),"editable","enabled"),e((()=>{Bh()(i.prototype,"minPos",l)}),"displayName","minPos"),e((()=>{Fh()(i.prototype,"minPos",l)}),"tooltip","minPos"),e((()=>{Ph(i.prototype)}),"editable","minPos"),e((()=>{Bh()(i.prototype,"maxPos",c)}),"displayName","maxPos"),e((()=>{Fh()(i.prototype,"maxPos",c)}),"tooltip","maxPos"),e((()=>{Ph(i.prototype)}),"editable","maxPos"),e((()=>{Fh()(i.prototype,"depth",u)}),"tooltip","depth"),e((()=>{Xh(s)(i.prototype,"depth",u)}),"type","depth"),e((()=>{zh(i.prototype)}),"slide","depth"),e((()=>{Nh()(i.prototype,"depth",u)}),"range","depth"),e((()=>{Ph(i.prototype)}),"editable","depth"),e((()=>{vh(i.prototype,"_enabled",(()=>!1))}),"serializable","_enabled"),e((()=>{vh(i.prototype,"_minPos",(()=>new r(n)))}),"serializable","_minPos"),e((()=>{vh(i.prototype,"_maxPos",(()=>new r(o)))}),"serializable","_maxPos"),e((()=>{vh(i.prototype,"_depth",(()=>a))}),"serializable","_depth"),e((()=>{ah("cc.OctreeInfo")(i)}),"ccclass",null)}({OctreeInfo:Mv,CCInteger:Ge,Vec3:Ms,DEFAULT_WORLD_MAX_POS:Sv,DEFAULT_WORLD_MIN_POS:vv,DEFAULT_OCTREE_DEPTH:Tv}),function(t,e=dm){const{ShadowsInfo:i,ShadowType:s,CCFloat:r,CCInteger:n,ShadowSize:o,Vec3:a,Color:h,Vec2:l}={...t},c=Object.getOwnPropertyDescriptor(i.prototype,"enabled"),u=Object.getOwnPropertyDescriptor(i.prototype,"type"),d=Object.getOwnPropertyDescriptor(i.prototype,"shadowColor"),_=Object.getOwnPropertyDescriptor(i.prototype,"planeDirection"),p=Object.getOwnPropertyDescriptor(i.prototype,"planeHeight"),m=Object.getOwnPropertyDescriptor(i.prototype,"planeBias"),g=Object.getOwnPropertyDescriptor(i.prototype,"maxReceived"),f=Object.getOwnPropertyDescriptor(i.prototype,"shadowMapSize");e((()=>{Fh()(i.prototype,"enabled",c)}),"tooltip","enabled"),e((()=>{Ph(i.prototype)}),"editable","enabled"),e((()=>{Xh(s)(i.prototype,"type",u)}),"type","type"),e((()=>{Ph(i.prototype)}),"editable","type"),e((()=>{Fh()(i.prototype,"type",u)}),"tooltip","type"),e((()=>{Oh()(i.prototype,"shadowColor",d)}),"visible","shadowColor"),e((()=>{Fh()(i.prototype,"shadowColor",d)}),"tooltip","shadowColor"),e((()=>{Oh()(i.prototype,"planeDirection",_)}),"visible","planeDirection"),e((()=>{Fh()(i.prototype,"planeDirection",_)}),"tooltip","planeDirection"),e((()=>{Oh()(i.prototype,"planeHeight",p)}),"visible","planeHeight"),e((()=>{Xh(r)(i.prototype,"planeHeight",p)}),"type","planeHeight"),e((()=>{Ph(i.prototype)}),"editable","planeHeight"),e((()=>{Fh()(i.prototype,"planeHeight",p)}),"tooltip","planeHeight"),e((()=>{Oh()(i.prototype,"planeBias",m)}),"visible","planeBias"),e((()=>{Xh(r)(i.prototype,"planeBias",m)}),"type","planeBias"),e((()=>{Ph(i.prototype)}),"editable","planeBias"),e((()=>{Fh()(i.prototype,"planeBias",m)}),"tooltip","planeBias"),e((()=>{Oh()(i.prototype,"maxReceived",g)}),"visible","maxReceived"),e((()=>{Xh(n)(i.prototype,"maxReceived",g)}),"type","maxReceived"),e((()=>{Fh()(i.prototype,"maxReceived",g)}),"tooltip","maxReceived"),e((()=>{Oh()(i.prototype,"shadowMapSize",f)}),"visible","shadowMapSize"),e((()=>{Xh(o)(i.prototype,"shadowMapSize",f)}),"type","shadowMapSize"),e((()=>{Fh()(i.prototype,"shadowMapSize",f)}),"tooltip","shadowMapSize"),e((()=>{vh(i.prototype,"_enabled",(()=>!1))}),"serializable","_enabled"),e((()=>{vh(i.prototype,"_type",(()=>s.Planar))}),"serializable","_type"),e((()=>{vh(i.prototype,"_normal",(()=>new a(0,1,0)))}),"serializable","_normal"),e((()=>{vh(i.prototype,"_distance",(()=>0))}),"serializable","_distance"),e((()=>{vh(i.prototype,"_planeBias",(()=>1))}),"serializable","_planeBias"),e((()=>{vh(i.prototype,"_shadowColor",(()=>new h(0,0,0,76)))}),"serializable","_shadowColor"),e((()=>{vh(i.prototype,"_maxReceived",(()=>4))}),"serializable","_maxReceived"),e((()=>{vh(i.prototype,"_size",(()=>new l(1024,1024)))}),"serializable","_size"),e((()=>{ah("cc.ShadowsInfo")(i)}),"ccclass",null)}({ShadowsInfo:Iv,ShadowType:Cv,CCFloat:We,CCInteger:Ge,ShadowSize:xv,Vec3:Ms,Color:Ls,Vec2:kr}),function(t,e=dm){const{FogInfo:i,FogType:s,CCFloat:r,Color:n}={...t},o=Object.getOwnPropertyDescriptor(i.prototype,"enabled"),a=Object.getOwnPropertyDescriptor(i.prototype,"accurate"),h=Object.getOwnPropertyDescriptor(i.prototype,"fogColor"),l=Object.getOwnPropertyDescriptor(i.prototype,"type"),c=Object.getOwnPropertyDescriptor(i.prototype,"fogDensity"),u=Object.getOwnPropertyDescriptor(i.prototype,"fogStart"),d=Object.getOwnPropertyDescriptor(i.prototype,"fogEnd"),_=Object.getOwnPropertyDescriptor(i.prototype,"fogAtten"),p=Object.getOwnPropertyDescriptor(i.prototype,"fogTop"),m=Object.getOwnPropertyDescriptor(i.prototype,"fogRange");e((()=>{Uh()(i.prototype,"enabled",o)}),"displayOrder","enabled"),e((()=>{Fh()(i.prototype,"enabled",o)}),"tooltip","enabled"),e((()=>{Ph(i.prototype)}),"editable","enabled"),e((()=>{Uh()(i.prototype,"accurate",a)}),"displayOrder","accurate"),e((()=>{Fh()(i.prototype,"accurate",a)}),"tooltip","accurate"),e((()=>{Ph(i.prototype)}),"editable","accurate"),e((()=>{Fh()(i.prototype,"fogColor",h)}),"tooltip","fogColor"),e((()=>{Ph(i.prototype)}),"editable","fogColor"),e((()=>{Fh()(i.prototype,"type",l)}),"tooltip","type"),e((()=>{Uh()(i.prototype,"type",l)}),"displayOrder","type"),e((()=>{Xh(s)(i.prototype,"type",l)}),"type","type"),e((()=>{Ph(i.prototype)}),"editable","type"),e((()=>{Fh()(i.prototype,"fogDensity",c)}),"tooltip","fogDensity"),e((()=>{zh(i.prototype)}),"slide","fogDensity"),e((()=>{Nh()(i.prototype,"fogDensity",c)}),"range","fogDensity"),e((()=>{Xh(r)(i.prototype,"fogDensity",c)}),"type","fogDensity"),e((()=>{Oh()(i.prototype,"fogDensity",c)}),"visible","fogDensity"),e((()=>{Fh()(i.prototype,"fogStart",u)}),"tooltip","fogStart"),e((()=>{kh()(i.prototype,"fogStart",u)}),"rangeStep","fogStart"),e((()=>{Xh(r)(i.prototype,"fogStart",u)}),"type","fogStart"),e((()=>{Oh()(i.prototype,"fogStart",u)}),"visible","fogStart"),e((()=>{Fh()(i.prototype,"fogEnd",d)}),"tooltip","fogEnd"),e((()=>{kh()(i.prototype,"fogEnd",d)}),"rangeStep","fogEnd"),e((()=>{Xh(r)(i.prototype,"fogEnd",d)}),"type","fogEnd"),e((()=>{Oh()(i.prototype,"fogEnd",d)}),"visible","fogEnd"),e((()=>{Fh()(i.prototype,"fogAtten",_)}),"tooltip","fogAtten"),e((()=>{kh()(i.prototype,"fogAtten",_)}),"rangeStep","fogAtten"),e((()=>{Lh()(i.prototype,"fogAtten",_)}),"rangeMin","fogAtten"),e((()=>{Xh(r)(i.prototype,"fogAtten",_)}),"type","fogAtten"),e((()=>{Oh()(i.prototype,"fogAtten",_)}),"visible","fogAtten"),e((()=>{Fh()(i.prototype,"fogTop",p)}),"tooltip","fogTop"),e((()=>{kh()(i.prototype,"fogTop",p)}),"rangeStep","fogTop"),e((()=>{Xh(r)(i.prototype,"fogTop",p)}),"type","fogTop"),e((()=>{Oh()(i.prototype,"fogTop",p)}),"visible","fogTop"),e((()=>{Fh()(i.prototype,"fogRange",m)}),"tooltip","fogRange"),e((()=>{kh()(i.prototype,"fogRange",m)}),"rangeStep","fogRange"),e((()=>{Xh(r)(i.prototype,"fogRange",m)}),"type","fogRange"),e((()=>{Oh()(i.prototype,"fogRange",m)}),"visible","fogRange"),e((()=>{vh(i.prototype,"_type",(()=>s.LINEAR))}),"serializable","_type"),e((()=>{vh(i.prototype,"_fogColor",(()=>new n("#C8C8C8")))}),"serializable","_fogColor"),e((()=>{vh(i.prototype,"_enabled",(()=>!1))}),"serializable","_enabled"),e((()=>{vh(i.prototype,"_fogDensity",(()=>.3))}),"serializable","_fogDensity"),e((()=>{vh(i.prototype,"_fogStart",(()=>.5))}),"serializable","_fogStart"),e((()=>{vh(i.prototype,"_fogEnd",(()=>300))}),"serializable","_fogEnd"),e((()=>{vh(i.prototype,"_fogAtten",(()=>5))}),"serializable","_fogAtten"),e((()=>{vh(i.prototype,"_fogTop",(()=>1.5))}),"serializable","_fogTop"),e((()=>{vh(i.prototype,"_fogRange",(()=>1.2))}),"serializable","_fogRange"),e((()=>{vh(i.prototype,"_accurate",(()=>!1))}),"serializable","_accurate"),e((()=>{ah("cc.FogInfo")(i)}),"ccclass",null)}({FogInfo:Ev,FogType:wv,CCFloat:We,Color:Ls}),function(t,e=dm){const{SkyboxInfo:i,EnvironmentLightingType:s,TextureCube:r,CCFloat:n,Material:o}={...t},a=Object.getOwnPropertyDescriptor(i.prototype,"enabled"),h=Object.getOwnPropertyDescriptor(i.prototype,"envLightingType"),l=Object.getOwnPropertyDescriptor(i.prototype,"useHDR"),c=Object.getOwnPropertyDescriptor(i.prototype,"envmap"),u=Object.getOwnPropertyDescriptor(i.prototype,"rotationAngle"),d=Object.getOwnPropertyDescriptor(i.prototype,"diffuseMap"),_=Object.getOwnPropertyDescriptor(i.prototype,"reflectionMap"),p=Object.getOwnPropertyDescriptor(i.prototype,"skyboxMaterial");e((()=>{Fh()(i.prototype,"enabled",a)}),"tooltip","enabled"),e((()=>{Ph(i.prototype)}),"editable","enabled"),e((()=>{Fh()(i.prototype,"envLightingType",h)}),"tooltip","envLightingType"),e((()=>{Xh(s)(i.prototype,"envLightingType",h)}),"type","envLightingType"),e((()=>{Ph(i.prototype)}),"editable","envLightingType"),e((()=>{Fh()(i.prototype,"useHDR",l)}),"tooltip","useHDR"),e((()=>{Ph(i.prototype)}),"editable","useHDR"),e((()=>{Fh()(i.prototype,"envmap",c)}),"tooltip","envmap"),e((()=>{Xh(r)(i.prototype,"envmap",c)}),"type","envmap"),e((()=>{Ph(i.prototype)}),"editable","envmap"),e((()=>{Fh()(i.prototype,"rotationAngle",u)}),"tooltip","rotationAngle"),e((()=>{zh(i.prototype)}),"slide","rotationAngle"),e((()=>{Nh()(i.prototype,"rotationAngle",u)}),"range","rotationAngle"),e((()=>{Xh(n)(i.prototype,"rotationAngle",u)}),"type","rotationAngle"),e((()=>{Uh()(i.prototype,"diffuseMap",d)}),"displayOrder","diffuseMap"),e((()=>{Xh(r)(i.prototype,"diffuseMap",d)}),"type","diffuseMap"),e((()=>{Rh(i.prototype)}),"readOnly","diffuseMap"),e((()=>{Ph(i.prototype)}),"editable","diffuseMap"),e((()=>{Oh()(i.prototype,"diffuseMap",d)}),"visible","diffuseMap"),e((()=>{Uh()(i.prototype,"reflectionMap",_)}),"displayOrder","reflectionMap"),e((()=>{Xh(r)(i.prototype,"reflectionMap",_)}),"type","reflectionMap"),e((()=>{Rh(i.prototype)}),"readOnly","reflectionMap"),e((()=>{Ph(i.prototype)}),"editable","reflectionMap"),e((()=>{Oh()(i.prototype,"reflectionMap",_)}),"visible","reflectionMap"),e((()=>{Fh()(i.prototype,"skyboxMaterial",p)}),"tooltip","skyboxMaterial"),e((()=>{Xh(o)(i.prototype,"skyboxMaterial",p)}),"type","skyboxMaterial"),e((()=>{Ph(i.prototype)}),"editable","skyboxMaterial"),e((()=>{vh(i.prototype,"_envLightingType",(()=>s.HEMISPHERE_DIFFUSE))}),"serializable","_envLightingType"),e((()=>{Sh("_envmap")(i.prototype,"_envmapHDR",(()=>null))}),"formerlySerializedAs","_envmapHDR"),e((()=>{Xh(r)(i.prototype,"_envmapHDR",(()=>null))}),"type","_envmapHDR"),e((()=>{vh(i.prototype,"_envmapHDR",(()=>null))}),"serializable","_envmapHDR"),e((()=>{Xh(r)(i.prototype,"_envmapLDR",(()=>null))}),"type","_envmapLDR"),e((()=>{vh(i.prototype,"_envmapLDR",(()=>null))}),"serializable","_envmapLDR"),e((()=>{Xh(r)(i.prototype,"_diffuseMapHDR",(()=>null))}),"type","_diffuseMapHDR"),e((()=>{vh(i.prototype,"_diffuseMapHDR",(()=>null))}),"serializable","_diffuseMapHDR"),e((()=>{Xh(r)(i.prototype,"_diffuseMapLDR",(()=>null))}),"type","_diffuseMapLDR"),e((()=>{vh(i.prototype,"_diffuseMapLDR",(()=>null))}),"serializable","_diffuseMapLDR"),e((()=>{vh(i.prototype,"_enabled",(()=>!1))}),"serializable","_enabled"),e((()=>{vh(i.prototype,"_useHDR",(()=>!0))}),"serializable","_useHDR"),e((()=>{Xh(o)(i.prototype,"_editableMaterial",(()=>null))}),"type","_editableMaterial"),e((()=>{vh(i.prototype,"_editableMaterial",(()=>null))}),"serializable","_editableMaterial"),e((()=>{Xh(r)(i.prototype,"_reflectionHDR",(()=>null))}),"type","_reflectionHDR"),e((()=>{vh(i.prototype,"_reflectionHDR",(()=>null))}),"serializable","_reflectionHDR"),e((()=>{Xh(r)(i.prototype,"_reflectionLDR",(()=>null))}),"type","_reflectionLDR"),e((()=>{vh(i.prototype,"_reflectionLDR",(()=>null))}),"serializable","_reflectionLDR"),e((()=>{vh(i.prototype,"_rotationAngle",(()=>0))}),"serializable","_rotationAngle"),e((()=>{ah("cc.SkyboxInfo")(i)}),"ccclass",null)}({SkyboxInfo:Dv,EnvironmentLightingType:nv,TextureCube:db,CCFloat:We,Material:fv}),function(t,e=dm){const{AmbientInfo:i,legacyCC:s,CCFloat:r,Vec4:n,Ambient:o}={...t},a=Object.getOwnPropertyDescriptor(i.prototype,"skyLightingColor"),h=Object.getOwnPropertyDescriptor(i.prototype,"skyIllum"),l=Object.getOwnPropertyDescriptor(i.prototype,"groundLightingColor");e((()=>{Fh()(i.prototype,"skyLightingColor",a)}),"tooltip","skyLightingColor"),e((()=>{Ph(i.prototype)}),"editable","skyLightingColor"),e((()=>{Oh()(i.prototype,"skyLightingColor",a)}),"visible","skyLightingColor"),e((()=>{Nh()(i.prototype,"skyIllum",h)}),"range","skyIllum"),e((()=>{Fh()(i.prototype,"skyIllum",h)}),"tooltip","skyIllum"),e((()=>{Xh(r)(i.prototype,"skyIllum",h)}),"type","skyIllum"),e((()=>{Ph(i.prototype)}),"editable","skyIllum"),e((()=>{Fh()(i.prototype,"groundLightingColor",l)}),"tooltip","groundLightingColor"),e((()=>{Ph(i.prototype)}),"editable","groundLightingColor"),e((()=>{Oh()(i.prototype,"groundLightingColor",l)}),"visible","groundLightingColor"),e((()=>{Sh("_skyColor")(i.prototype,"_skyColorHDR",(()=>new n(.2,.5,.8,1)))}),"formerlySerializedAs","_skyColorHDR"),e((()=>{vh(i.prototype,"_skyColorHDR",(()=>new n(.2,.5,.8,1)))}),"serializable","_skyColorHDR"),e((()=>{Sh("_skyIllum")(i.prototype,"_skyIllumHDR",(()=>o.SKY_ILLUM))}),"formerlySerializedAs","_skyIllumHDR"),e((()=>{vh(i.prototype,"_skyIllumHDR",(()=>o.SKY_ILLUM))}),"serializable","_skyIllumHDR"),e((()=>{Sh("_groundAlbedo")(i.prototype,"_groundAlbedoHDR",(()=>new n(.2,.2,.2,1)))}),"formerlySerializedAs","_groundAlbedoHDR"),e((()=>{vh(i.prototype,"_groundAlbedoHDR",(()=>new n(.2,.2,.2,1)))}),"serializable","_groundAlbedoHDR"),e((()=>{vh(i.prototype,"_skyColorLDR",(()=>new n(.2,.5,.8,1)))}),"serializable","_skyColorLDR"),e((()=>{vh(i.prototype,"_skyIllumLDR",(()=>o.SKY_ILLUM))}),"serializable","_skyIllumLDR"),e((()=>{vh(i.prototype,"_groundAlbedoLDR",(()=>new n(.2,.2,.2,1)))}),"serializable","_groundAlbedoLDR"),e((()=>{ah("cc.AmbientInfo")(i)}),"ccclass",null)}({AmbientInfo:Av,Vec4:ms,Ambient:Vb,CCFloat:We,legacyCC:h}),function(t,e=dm){const{LightProbeInfo:i,CCFloat:s,CCInteger:r}={...t},n=Object.getOwnPropertyDescriptor(i.prototype,"giScale"),o=Object.getOwnPropertyDescriptor(i.prototype,"giSamples"),a=Object.getOwnPropertyDescriptor(i.prototype,"bounces"),h=Object.getOwnPropertyDescriptor(i.prototype,"reduceRinging"),l=Object.getOwnPropertyDescriptor(i.prototype,"showWireframe"),c=Object.getOwnPropertyDescriptor(i.prototype,"showConvex"),u=Object.getOwnPropertyDescriptor(i.prototype,"lightProbeSphereVolume");e((()=>{Bh()(i.prototype,"giScale",n)}),"displayName","giScale"),e((()=>{Fh()(i.prototype,"giScale",n)}),"tooltip","giScale"),e((()=>{Xh(s)(i.prototype,"giScale",n)}),"type","giScale"),e((()=>{Nh()(i.prototype,"giScale",n)}),"range","giScale"),e((()=>{Ph(i.prototype)}),"editable","giScale"),e((()=>{Bh()(i.prototype,"giSamples",o)}),"displayName","giSamples"),e((()=>{Fh()(i.prototype,"giSamples",o)}),"tooltip","giSamples"),e((()=>{Xh(r)(i.prototype,"giSamples",o)}),"type","giSamples"),e((()=>{Nh()(i.prototype,"giSamples",o)}),"range","giSamples"),e((()=>{Ph(i.prototype)}),"editable","giSamples"),e((()=>{Fh()(i.prototype,"bounces",a)}),"tooltip","bounces"),e((()=>{Xh(r)(i.prototype,"bounces",a)}),"type","bounces"),e((()=>{Nh()(i.prototype,"bounces",a)}),"range","bounces"),e((()=>{Ph(i.prototype)}),"editable","bounces"),e((()=>{Fh()(i.prototype,"reduceRinging",h)}),"tooltip","reduceRinging"),e((()=>{Xh(s)(i.prototype,"reduceRinging",h)}),"type","reduceRinging"),e((()=>{zh(i.prototype)}),"slide","reduceRinging"),e((()=>{Nh()(i.prototype,"reduceRinging",h)}),"range","reduceRinging"),e((()=>{Ph(i.prototype)}),"editable","reduceRinging"),e((()=>{Fh()(i.prototype,"showWireframe",l)}),"tooltip","showWireframe"),e((()=>{Ph(i.prototype)}),"editable","showWireframe"),e((()=>{Fh()(i.prototype,"showConvex",c)}),"tooltip","showConvex"),e((()=>{Ph(i.prototype)}),"editable","showConvex"),e((()=>{Fh()(i.prototype,"lightProbeSphereVolume",u)}),"tooltip","lightProbeSphereVolume"),e((()=>{Xh(s)(i.prototype,"lightProbeSphereVolume",u)}),"type","lightProbeSphereVolume"),e((()=>{Nh()(i.prototype,"lightProbeSphereVolume",u)}),"range","lightProbeSphereVolume"),e((()=>{Ph(i.prototype)}),"editable","lightProbeSphereVolume"),e((()=>{vh(i.prototype,"_giScale",(()=>1))}),"serializable","_giScale"),e((()=>{vh(i.prototype,"_giSamples",(()=>1024))}),"serializable","_giSamples"),e((()=>{vh(i.prototype,"_bounces",(()=>2))}),"serializable","_bounces"),e((()=>{vh(i.prototype,"_reduceRinging",(()=>0))}),"serializable","_reduceRinging"),e((()=>{vh(i.prototype,"_showProbe",(()=>!0))}),"serializable","_showProbe"),e((()=>{vh(i.prototype,"_showWireframe",(()=>!0))}),"serializable","_showWireframe"),e((()=>{vh(i.prototype,"_showConvex",(()=>!1))}),"serializable","_showConvex"),e((()=>{vh(i.prototype,"_data",(()=>null))}),"serializable","_data"),e((()=>{vh(i.prototype,"_lightProbeSphereVolume",(()=>1))}),"serializable","_lightProbeSphereVolume"),e((()=>{ah("cc.LightProbeInfo")(i)}),"ccclass",null)}({LightProbeInfo:Pv,CCFloat:We,CCInteger:Ge}),function(t,e=dm){const{SkinInfo:i,CCFloat:s}={...t},r=Object.getOwnPropertyDescriptor(i.prototype,"enabled"),n=Object.getOwnPropertyDescriptor(i.prototype,"blurRadius"),o=Object.getOwnPropertyDescriptor(i.prototype,"sssIntensity");e((()=>{Fh()(i.prototype,"enabled",r)}),"tooltip","enabled"),e((()=>{Rh(i.prototype)}),"readOnly","enabled"),e((()=>{Ph(i.prototype)}),"editable","enabled"),e((()=>{Fh()(i.prototype,"blurRadius",n)}),"tooltip","blurRadius"),e((()=>{Xh(s)(i.prototype,"blurRadius",n)}),"type","blurRadius"),e((()=>{zh(i.prototype)}),"slide","blurRadius"),e((()=>{Nh()(i.prototype,"blurRadius",n)}),"range","blurRadius"),e((()=>{Ph(i.prototype)}),"editable","blurRadius"),e((()=>{Oh()(i.prototype,"blurRadius",n)}),"visible","blurRadius"),e((()=>{Fh()(i.prototype,"sssIntensity",o)}),"tooltip","sssIntensity"),e((()=>{Xh(s)(i.prototype,"sssIntensity",o)}),"type","sssIntensity"),e((()=>{zh(i.prototype)}),"slide","sssIntensity"),e((()=>{Nh()(i.prototype,"sssIntensity",o)}),"range","sssIntensity"),e((()=>{Ph(i.prototype)}),"editable","sssIntensity"),e((()=>{vh(i.prototype,"_enabled",(()=>!0))}),"serializable","_enabled"),e((()=>{vh(i.prototype,"_blurRadius",(()=>.01))}),"serializable","_blurRadius"),e((()=>{vh(i.prototype,"_sssIntensity",(()=>3))}),"serializable","_sssIntensity"),e((()=>{ah("cc.SkinInfo")(i)}),"ccclass",null)}({SkinInfo:Rv,CCFloat:We}),function(t,e=dm){const{PostSettingsInfo:i,ToneMappingType:s}={...t},r=Object.getOwnPropertyDescriptor(i.prototype,"toneMappingType");e((()=>{Fh()(i.prototype,"toneMappingType",r)}),"tooltip","toneMappingType"),e((()=>{Xh(s)(i.prototype,"toneMappingType",r)}),"type","toneMappingType"),e((()=>{Ph(i.prototype)}),"editable","toneMappingType"),e((()=>{vh(i.prototype,"_toneMappingType",(()=>s.DEFAULT))}),"serializable","_toneMappingType"),e((()=>{ah("cc.PostSettingsInfo")(i)}),"ccclass",null)}({PostSettingsInfo:Bv,ToneMappingType:ov}),Q(tb.prototype,"Node",[{name:"childrenCount",newName:"children.length",customGetter(){return this.children.length}}]),Q(tb.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter(){return this._getUITransformComp().width},customSetter(t){this._getUITransformComp().width=t}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter(){return this._getUITransformComp().height},customSetter(t){this._getUITransformComp().height=t}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter(){return this._getUITransformComp().anchorX},customSetter(t){this._getUITransformComp().anchorX=t}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter(){return this._getUITransformComp().anchorY},customSetter(t){this._getUITransformComp().anchorY=t}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction(t){return t||(t=new kr),t.set(this._getUITransformComp().anchorPoint),t}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction(t,e){this._getUITransformComp().setAnchorPoint(t,e)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction(t){return t||(t=new Vr),t.set(this._getUITransformComp().contentSize),t}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction(t,e){"number"==typeof t?this._getUITransformComp().setContentSize(t,e):this._getUITransformComp().setContentSize(t)}}]),J(Ov.prototype,"SceneGlobals.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"},{name:"fixedArea"},{name:"pcf"},{name:"bias"},{name:"normalBias"},{name:"near"},{name:"far"},{name:"shadowDistance"},{name:"invisibleOcclusionRange"},{name:"orthoSize"},{name:"saturation"}]),Q(Ov.prototype,"SceneGlobals.prototype",[{name:"distance",newName:"planeHeight"},{name:"normal",newName:"planeDirection"},{name:"size",newName:"shadowMapSize"}]),J(tb.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),Q(ky.prototype,"NodeUIProperties",[{name:"opacityDirty",newName:"colorDirty"}]),J(Hy,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),Q(Hy,"Layers",[{name:"Default",newName:"DEFAULT",target:Hy.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:Hy.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:Hy.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:Hy.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:Hy.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:Hy.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:Hy.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:Hy.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:Hy,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:Hy,targetName:"Layers"}]),J(Hy.Enum,"Layers.Enum",[{name:"ALWAYS"}]),J(Hy.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);let Nv=t("PrivateNode",ah("cc.PrivateNode")(Fv=class extends tb{constructor(t){super(t),j(12003,this.name),this.hideFlags|=1032}})||Fv);var Lv,kv,zv,Uv,Vv,jv,Hv,Gv,Wv,Xv,Yv,qv,$v,Kv,Zv,Qv,Jv,tS,eS,iS,sS,rS,nS,oS,aS,hS,lS,cS,uS,dS,_S,pS,mS,gS,fS,yS,bS,vS,SS,TS,wS,xS,CS,AS,DS,ES,IS,MS,PS,OS,RS,BS,FS,NS,LS,kS,zS,US,VS,jS,HS,GS,WS,XS,YS,qS,$S,KS,ZS;Q(Ff,"SystemEventType",["MOUSE_ENTER","MOUSE_LEAVE","TRANSFORM_CHANGED","SCENE_CHANGED_FOR_PERSISTS","SIZE_CHANGED","ANCHOR_CHANGED","COLOR_CHANGED","CHILD_ADDED","CHILD_REMOVED","PARENT_CHANGED","NODE_DESTROYED","LAYER_CHANGED","SIBLING_ORDER_CHANGED"].map((t=>({name:t,target:tb.EventType,targetName:"Node.EventType"})))),Q(tb.EventType,"Node.EventType",[{name:"DEVICEMOTION",target:Ey.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_DOWN",target:Ey.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_UP",target:Ey.EventType,targetName:"SystemEvent.EventType"}]),h.PrivateNode=Nv,at({BaseNode:{newName:"Node",since:"3.7.0",removed:!1}});let QS=(Lv=ah("cc.TargetInfo"),kv=Xh([Ye]),Lv((Uv=class{constructor(){this.localID=Vv&&Vv()}},Vv=Za(Uv.prototype,"localID",[vh,kv],(function(){return[]})),zv=Uv))||zv),JS=(jv=ah("cc.TargetOverrideInfo"),Hv=Xh(Do),Gv=Xh(QS),Wv=Xh([Ye]),Xv=Xh(tb),Yv=Xh(QS),jv(($v=class{constructor(){this.source=Kv&&Kv(),this.sourceInfo=Zv&&Zv(),this.propertyPath=Qv&&Qv(),this.target=Jv&&Jv(),this.targetInfo=tS&&tS()}},Kv=Za($v.prototype,"source",[vh,Hv],(function(){return null})),Zv=Za($v.prototype,"sourceInfo",[vh,Gv],(function(){return null})),Qv=Za($v.prototype,"propertyPath",[vh,Wv],(function(){return[]})),Jv=Za($v.prototype,"target",[vh,Xv],(function(){return null})),tS=Za($v.prototype,"targetInfo",[vh,Yv],(function(){return null})),qv=$v))||qv),tT=ah("cc.CompPrefabInfo")((iS=class{constructor(){this.fileId=sS&&sS()}},sS=Za(iS.prototype,"fileId",[vh],(function(){return""})),eS=iS))||eS,eT=(rS=ah("CCPropertyOverrideInfo"),nS=Xh(QS),oS=Xh([Ye]),rS((hS=class{constructor(){this.targetInfo=lS&&lS(),this.propertyPath=cS&&cS(),this.value=uS&&uS()}isTarget(t,e){}},lS=Za(hS.prototype,"targetInfo",[vh,nS],(function(){return null})),cS=Za(hS.prototype,"propertyPath",[vh,oS],(function(){return[]})),uS=Za(hS.prototype,"value",[vh],null),aS=hS))||aS),iT=(dS=ah("cc.MountedChildrenInfo"),_S=Xh(QS),pS=Xh([tb]),dS((gS=class{constructor(){this.targetInfo=fS&&fS(),this.nodes=yS&&yS()}isTarget(t){}},fS=Za(gS.prototype,"targetInfo",[vh,_S],(function(){return null})),yS=Za(gS.prototype,"nodes",[vh,pS],(function(){return[]})),mS=gS))||mS),sT=(bS=ah("cc.MountedComponentsInfo"),vS=Xh(QS),SS=Xh([Km]),bS((wS=class{constructor(){this.targetInfo=xS&&xS(),this.components=CS&&CS()}isTarget(t){}},xS=Za(wS.prototype,"targetInfo",[vh,vS],(function(){return null})),CS=Za(wS.prototype,"components",[vh,SS],(function(){return[]})),TS=wS))||TS),rT=(AS=ah("cc.PrefabInstance"),DS=Xh(tb),ES=Xh([iT]),IS=Xh([sT]),MS=Xh([eT]),PS=Xh([QS]),AS((RS=class{constructor(){this.fileId=BS&&BS(),this.prefabRootNode=FS&&FS(),this.mountedChildren=NS&&NS(),this.mountedComponents=LS&&LS(),this.propertyOverrides=kS&&kS(),this.removedComponents=zS&&zS(),this.targetMap={},this.expanded=!1}findPropertyOverride(t,e){}removePropertyOverride(t,e){}},BS=Za(RS.prototype,"fileId",[vh],(function(){return""})),FS=Za(RS.prototype,"prefabRootNode",[vh,DS],null),NS=Za(RS.prototype,"mountedChildren",[vh,ES],(function(){return[]})),LS=Za(RS.prototype,"mountedComponents",[vh,IS],(function(){return[]})),kS=Za(RS.prototype,"propertyOverrides",[vh,MS],(function(){return[]})),zS=Za(RS.prototype,"removedComponents",[vh,PS],(function(){return[]})),OS=RS))||OS),nT=(US=ah("cc.PrefabInfo"),VS=Xh(tb),jS=Xh(rT),HS=Xh([JS]),US((WS=class{constructor(){this.root=XS&&XS(),this.asset=YS&&YS(),this.fileId=qS&&qS(),this.instance=$S&&$S(),this.targetOverrides=KS&&KS(),this.nestedPrefabInstanceRoots=ZS&&ZS()}},XS=Za(WS.prototype,"root",[vh,VS],null),YS=Za(WS.prototype,"asset",[vh],null),qS=Za(WS.prototype,"fileId",[vh],(function(){return""})),$S=Za(WS.prototype,"instance",[vh,jS],null),KS=Za(WS.prototype,"targetOverrides",[vh,HS],null),ZS=Za(WS.prototype,"nestedPrefabInstanceRoots",[vh],null),GS=WS))||GS);function oT(t){const e=null==t?void 0:t.prefab;if(!e)return;if(!e.instance)return;if(!e.asset)return G(3701,t.name),void(e.instance=void 0);const i=t._objFlags,s=t.getParent(),r=t.uuid;t[wo],a.game._isCloning=!0,e.asset._doInstantiate(t),a.game._isCloning=!1,t._objFlags=i,t.modifyParent(s),t.id=r,t.prefab&&(t.prefab.instance=e.instance)}function aT(t,e,i){var s;if(!e)return;if(!t)return;let r=e;const n=null==(s=t.prefab)?void 0:s.instance;!i&&n&&(e[n.fileId]={},r=e[n.fileId]);const o=t.prefab;o&&(r[o.fileId]=t),t.components.forEach((t=>{t.__prefab&&(r[t.__prefab.fileId]=t)})),t.children.forEach((t=>{aT(t,r,!1)}))}function hT(t,e){if(!t)return null;let i=null,s=e;for(let e=0;e<t.length;e++){if(!s)return null;s=s[t[e]]}return i=s,i}function lT(t,e,i){if(e)for(let t=0;t<e.length;t++){const s=e[t];if(s&&s.targetInfo){const t=hT(s.targetInfo.localID,i);if(!t)continue;let e=i;const r=s.targetInfo.localID;if(r.length>0)for(let t=0;t<r.length-1;t++)e=e[r[t]];if(s.nodes)for(let i=0;i<s.nodes.length;i++){const r=s.nodes[i];r&&!t.children.includes(r)&&(t.children.push(r),r.modifyParent(t),aT(r,e,!1),r.siblingIndex=t.children.length-1,pT(r,!0))}}}}function cT(t,e,i){if(e)for(let t=0;t<e.length;t++){const s=e[t];if(s&&s.targetInfo){const t=hT(s.targetInfo.localID,i);if(!t)continue;if(s.components)for(let e=0;e<s.components.length;e++){const i=s.components[e];i&&(i.node=t,t.getWritableComponents().push(i))}}}}function uT(t,e,i){if(e)for(let t=0;t<e.length;t++){const s=e[t];if(s){const t=hT(s.localID,i);if(!t||!t.node)continue;const e=t.node.components.indexOf(t);e>=0&&t.node.getWritableComponents().splice(e,1)}}}function dT(t,e,i){if(e.length<=0)return;let s=null;for(let t=0;t<e.length;t++){const r=e[t];if(r&&r.targetInfo){if(s=hT(r.targetInfo.localID,i),!s)continue;let t=s;const e=r.propertyPath.slice();if(e.length>0){const i=e.pop();if(!i)continue;for(let i=0;i<e.length&&(t=t[e[i]],t);i++);if(!t)continue;if(Array.isArray(t))if("length"===i)t[i]=r.value;else{const e=Number.parseInt(i);Number.isInteger(e)&&e<t.length&&(t[i]=r.value)}else t[i]instanceof ye?t[i].set(r.value):t[i]=r.value}}}}function _T(t){var e;const i=null==(e=t.prefab)?void 0:e.targetOverrides;if(i)for(let t=0;t<i.length;t++){var s;const e=i[t];let n=e.source;const o=e.sourceInfo;if(o){var r;const t=e.source,i=null==t||null==(r=t.prefab)?void 0:r.instance;i&&i.targetMap&&(n=hT(o.localID,i.targetMap))}if(!n)continue;let a=null;const h=e.targetInfo;if(!h)continue;const l=e.target,c=null==l||null==(s=l.prefab)?void 0:s.instance;if(!c||!c.targetMap)continue;if(a=hT(h.localID,c.targetMap),!a)continue;const u=e.propertyPath.slice();let d=n;if(u.length>0){const t=u.pop();if(!t)return;for(let t=0;t<u.length&&(d=d[u[t]],d);t++);if(!d)continue;d[t]=a}}}function pT(t,e=!1){var i;const s=null==t||null==(i=t.prefab)?void 0:i.instance;if(s&&!s.expanded){oT(t),e&&t&&t.children&&t.children.forEach((t=>{pT(t,!0)}));const i={};s.targetMap=i,aT(t,i,!0),lT(0,s.mountedChildren,i),uT(0,s.removedComponents,i),cT(0,s.mountedComponents,i),dT(0,s.propertyOverrides,i),s.expanded=!0}else e&&t&&t.children&&t.children.forEach((t=>{pT(t,!0)}))}function mT(t){const e=t.prefab;e&&e.nestedPrefabInstanceRoots&&e.nestedPrefabInstanceRoots.forEach((t=>{pT(t)}))}a._PrefabInfo=nT;var gT=Object.freeze({__proto__:null,CompPrefabInfo:tT,MountedChildrenInfo:iT,MountedComponentsInfo:sT,PrefabInfo:nT,PrefabInstance:rT,PropertyOverrideInfo:eT,TargetInfo:QS,TargetOverrideInfo:JS,applyMountedChildren:lT,applyMountedComponents:cT,applyNodeAndComponentId:function t(e,i){const{components:s,children:r}=e;for(let t=0;t<s.length;t++){var n,o;const e=s[t],r=null!==(n=null==(o=e.__prefab)?void 0:o.fileId)&&void 0!==n?n:"";e._id=`${i}${r}`}for(let e=0;e<r.length;e++){const s=r[e],n=s.prefab,o=null!=n&&n.instance?n.instance.fileId:null==n?void 0:n.fileId;o&&(s.id=`${i}${o}`,null!=n&&n.instance||t(s,i))}},applyPropertyOverrides:dT,applyRemovedComponents:uT,applyTargetOverrides:_T,createNodeWithPrefab:oT,expandNestedPrefabInstanceNode:mT,expandPrefabInstanceNode:pT,generateTargetMap:aT,getTarget:hT});const fT=t("Scene",jsb.Scene);h.Scene=fT;const yT=fT.prototype;Object.defineProperty(yT,"_globals",{enumerable:!0,configurable:!0,get(){return this.getSceneGlobals()},set(t){this._globalRef=t,this.setSceneGlobals(t)}}),Object.defineProperty(yT,"globals",{enumerable:!0,configurable:!0,get(){return this.getSceneGlobals()}}),Object.defineProperty(yT,"_renderScene",{enumerable:!0,configurable:!0,get(){return this._renderSceneInternal||(this._renderSceneInternal=this.getRenderScene()),this._renderSceneInternal}}),Object.defineProperty(yT,"renderScene",{enumerable:!0,configurable:!0,get(){return this._renderSceneInternal||(this._renderSceneInternal=this.getRenderScene()),this._renderSceneInternal}}),yT._ctor=function(){tb.prototype._ctor.apply(this,arguments),this._inited=!1,this._renderSceneInternal=null,this._globalRef=null,this._prefabSyncedInLiveReload=!1},yT._onBatchCreated=function(t){this._parent&&(this._siblingIndex=this._parent.children.indexOf(this));const e=this._children,i=e.length;let s;for(let r=0;r<i;++r)s=e[r],s._siblingIndex=r,s._onBatchCreated(t)};const bT=yT._load;function vT(t,e){if(!e){const t=h.director.getScene();if(!t)return null;e=t}return e.getChildByPath(t)}yT._load=function(){this._scene=this,this._inited||(mT(this),_T(this),this._onBatchCreated(n),this._inited=!0),pm(this),bT.call(this)},yT._activate=function(t){t=!1!==t,h.director._nodeActivator.activateNode(this,t),this._globals.activate(this),this._renderScene&&this._renderScene.activate()},yT._instantiate=function(){},function(t,e=dm){const{Scene:i,SceneGlobals:s}={...t};Object.getOwnPropertyDescriptor(i.prototype,"globals"),e((()=>{Ph(i.prototype)}),"editable","globals"),e((()=>{Ph(i.prototype)}),"editable","autoReleaseAssets"),e((()=>{vh(i.prototype,"autoReleaseAssets",(()=>!1))}),"serializable","autoReleaseAssets"),e((()=>{vh(i.prototype,"_globals",(()=>new s))}),"serializable","_globals"),e((()=>{ah("cc.Scene")(i)}),"ccclass",null)}({Scene:fT,SceneGlobals:Ov}),h.find=vT;const ST=ie,TT=65536,wT=2048;function xT(t,e){const i=e.constructor._executionOrder,s=e._id;let r=0;for(let e=t.length-1,n=e>>>1;r<=e;n=r+e>>>1){const o=t[n],a=o.constructor._executionOrder;if(a>i)e=n-1;else if(a<i)r=n+1;else{const t=o._id;if(t>s)e=n-1;else{if(!(t<s))return n;r=n+1}}}return~r}function CT(t,e){const i=t.array;let s=t.i+1;for(;s<i.length;){const r=i[s];r.node._activeInHierarchy?++s:(t.removeAt(s),e&&(r._objFlags&=~e))}}class AT{get zero(){return this._zero}get neg(){return this._neg}get pos(){return this._pos}constructor(t){const e=te;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t}}function DT(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}AT.stableRemoveInactive=CT;class ET extends AT{add(t){const e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)}remove(t){const e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)}cancelInactive(t){CT(this._zero,t),CT(this._neg,t),CT(this._pos,t)}invoke(){const t=this._neg;t.array.length>0&&(t.array.sort(DT),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;const e=this._pos;e.array.length>0&&(e.array.sort(DT),this._invoke(e),e.array.length=0)}}class IT extends AT{constructor(t){super(t)}add(t){const e=t.constructor._executionOrder;if(0===e)this._zero.array.push(t);else{const i=e<0?this._neg.array:this._pos.array,s=xT(i,t);s<0&&i.splice(~s,0,t)}}remove(t){const e=t.constructor._executionOrder;if(0===e)this._zero.fastRemove(t);else{const i=e<0?this._neg:this._pos,s=xT(i.array,t);s>=0&&i.removeAt(s)}}invoke(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)}}function MT(t,e,i){const s=`var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];${t}}`,r=e?Function("it","dt",s):Function("it",s);return PT(Function("c","dt",t),r,i)}function PT(t,e,i){return(s,r)=>{try{e(s,r)}catch(e){h._throw(e);const n=s.array;for(i&&(n[s.i]._objFlags|=i),++s.i;s.i<n.length;++s.i)try{t(n[s.i],r)}catch(t){h._throw(t),i&&(n[s.i]._objFlags|=i)}}}}const OT=MT("c.start();c._objFlags|=65536",!1,TT),RT=MT("c.update(dt)",!0),BT=MT("c.lateUpdate(dt)",!0),FT=t=>{const e=h.director._compScheduler,i=t.array;for(t.i=0;t.i<i.length;++t.i){const s=i[t.i];s._enabled&&(s.onEnable(),!s.node._activeInHierarchy||e._onEnabled(s))}};class NT{constructor(){this._deferredComps=[],this.unscheduleAll()}unscheduleAll(){this.startInvoker=new ET(OT),this.updateInvoker=new IT(RT),this.lateUpdateInvoker=new IT(BT),this._updating=!1}_onEnabled(t){h.director.getScheduler().resumeTarget(t),t._objFlags|=wT,this._updating?this._deferredComps.push(t):this._scheduleImmediate(t)}_onDisabled(t){h.director.getScheduler().pauseTarget(t),t._objFlags&=-2049;const e=this._deferredComps.indexOf(t);e>=0?ST(this._deferredComps,e):(!t.internalStart||t._objFlags&TT||this.startInvoker.remove(t),t.internalUpdate&&this.updateInvoker.remove(t),t.internalLateUpdate&&this.lateUpdateInvoker.remove(t))}enableComp(t,e){if(!(t._objFlags&wT)){if(t.internalOnEnable){if(e)return void e.add(t);if(t.internalOnEnable(),!t.node.activeInHierarchy)return}this._onEnabled(t)}}disableComp(t){t._objFlags&wT&&(t.internalOnDisable&&t.internalOnDisable(),this._onDisabled(t))}startPhase(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()}updatePhase(t){this.updateInvoker.invoke(t)}lateUpdatePhase(t){this.lateUpdateInvoker.invoke(t),this._updating=!1,this._startForNewComps()}_startForNewComps(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())}_scheduleImmediate(t){"function"!=typeof t.internalStart||t._objFlags&TT||this.startInvoker.add(t),"function"==typeof t.internalUpdate&&this.updateInvoker.add(t),"function"==typeof t.internalLateUpdate&&this.lateUpdateInvoker.add(t)}_deferredSchedule(){const t=this._deferredComps;for(let e=0,i=t.length;e<i;e++)this._scheduleImmediate(t[e]);t.length=0}}const LT=8192,kT=32768,zT=16384;class UT extends AT{constructor(t){super(t)}add(t){this._zero.array.push(t)}remove(t){this._zero.fastRemove(t)}cancelInactive(t){AT.stableRemoveInactive(this._zero,t)}invoke(){this._invoke(this._zero),this._zero.array.length=0}}const VT=MT("c.__preload();"),jT=MT("c.onLoad();c._objFlags|=16384",!1,zT),HT=new Jt(4);function GT(t,e,i){G(3817,t.name,i),I("Corrupted component value:",e),e?t._removeComponent(e):ee(t.getWritableComponents(),i)}HT.get=function(){const t=this._get()||{preload:new UT(VT),onLoad:new ET(jT),onEnable:new ET(FT)};t.preload.zero.i=-1;let e=t.onLoad;return e.zero.i=-1,e.neg.i=-1,e.pos.i=-1,e=t.onEnable,e.zero.i=-1,e.neg.i=-1,e.pos.i=-1,t};class WT{constructor(){this.reset()}reset(){this._activatingStack=[]}activateNode(t,e){if(e){const e=HT.get();e&&(this._activatingStack.push(e),this._activateNodeRecursively(t,e.preload,e.onLoad,e.onEnable),e.preload.invoke(),e.onLoad.invoke(),e.onEnable.invoke(),this._activatingStack.pop(),HT.put(e))}else{this._deactivateNodeRecursively(t);const e=this._activatingStack;for(const t of e)t.preload.cancelInactive(LT),t.onLoad.cancelInactive(kT),t.onEnable.cancelInactive(2048)}t.emit("active-in-hierarchy-changed",t)}activateComp(t,e,i,s){if(Mo(t,!0)&&(t._objFlags&LT||(t._objFlags|=LT,t.internalPreload&&(e?e.add(t):t.internalPreload())),t._objFlags&kT||(t._objFlags|=kT,t.internalOnLoad?i?i.add(t):(t.internalOnLoad(),t._objFlags|=zT):t._objFlags|=zT),t._enabled)){if(!t.node.activeInHierarchy)return;h.director._compScheduler.enableComp(t,s)}}destroyComp(t){h.director._compScheduler.disableComp(t),t.internalOnDestroy&&t._objFlags&zT&&t.internalOnDestroy()}_activateNodeRecursively(t,e,i,s){if(256&t._objFlags)return void G(3816,t.name);t._setActiveInHierarchy(!0);let r=t.components.length;for(let n=0;n<r;++n){const o=t.components[n];o instanceof h.Component?this.activateComp(o,e,i,s):(GT(t,o,n),--n,--r)}for(let r=0,n=t.children.length;r<n;++r){const n=t.children[r];n.active&&this._activateNodeRecursively(n,e,i,s)}t._onPostActivated(!0)}_deactivateNodeRecursively(t){t._objFlags|=256,t._setActiveInHierarchy(!1);const e=t.components.length;for(let i=0;i<e;++i){const e=t.components[i];if(e._enabled&&(h.director._compScheduler.disableComp(e),t.activeInHierarchy))return void(t._objFlags&=-257)}for(let e=0,i=t.children.length;e<i;++e){const i=t.children[e];if(i.activeInHierarchy&&(this._deactivateNodeRecursively(i),t.activeInHierarchy))return void(t._objFlags&=-257)}t._onPostActivated(!1),t._objFlags&=-257}}t("NodeActivator",WT);const XT=`${yi.Attr.DELIMETER}default`,YT=yi.IDENTIFIER_RE,qT="var ",$T="o",KT={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},ZT=yi.escapeForJS;class QT{constructor(t,e){this.varName=t,this.expression=e}toString(){return`${qT+this.varName}=${this.expression};`}}function JT(t,e){return e instanceof QT?new QT(e.varName,t+e.expression):t+e}function tw(t,e,i){Array.isArray(i)?(i[0]=JT(e,i[0]),t.push(i)):t.push(`${JT(e,i)};`)}class ew{constructor(t){this._exps=[],this._targetExp=t}setTargetExp(t){this._targetExp=t}append(t,e){this._exps.push([t,e])}writeCode(t){let e;if(this._exps.length>1)t.push(`t=${this._targetExp};`),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(let i=0;i<this._exps.length;i++){const s=this._exps[i];tw(t,`${e+iw(s[0])}=`,s[1])}}}function iw(t){return YT.test(t)?`.${t}`:`[${ZT(t)}]`}ew.pool=new Jt((t=>{t._exps.length=0,t._targetExp=null}),1),ew.pool.get=function(t){const e=this._get()||new ew;return e.setTargetExp(t),e};let sw=class{constructor(t,e){let i;this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.parent=e,this.funcModuleCache=wt(),Ft(this.funcModuleCache,KT),this.codeArray.push(`${qT+$T},t;`,"if(R){",`${$T}=R;`,"}else{",`${$T}=R=new ${this.getFuncModule(t.constructor,!0)}();`,"}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),this.globalVariables.length>0&&(i=`${qT+this.globalVariables.join(",")};`);const s=$u(["return (function(R){",i||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",s)(this.objs,this.funcs);for(let t=0,e=this.objsToClear_iN$t.length;t<e;++t)this.objsToClear_iN$t[t]._iN$t=null;this.objsToClear_iN$t.length=0}getFuncModule(t,e){const i=xt(t);if(i){const e=this.funcModuleCache[i];if(e)return e;if(void 0===e){let e=-1!==i.indexOf(".");if(e)try{if(e=t===Function(`return ${i}`)(),e)return this.funcModuleCache[i]=i,i}catch(t){}}}let s=this.funcs.indexOf(t);s<0&&(s=this.funcs.length,this.funcs.push(t));let r=`F[${s}]`;return e&&(r=`(${r})`),this.funcModuleCache[i]=r,r}getObjRef(t){let e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),`O[${e}]`}setValueType(t,e,i,s){const r=ew.pool.get(s);let n=e.constructor.__props__;n||(n=Object.keys(e));for(let t=0;t<n.length;t++){const s=n[t],o=i[s];if(e[s]===o)continue;const a=this.enumerateField(i,s,o);r.append(s,a)}r.writeCode(t),ew.pool.put(r)}enumerateCCClass(t,e,i){const s=i.__values__,r=yi.Attr.getClassAttrs(i);for(let i=0;i<s.length;i++){const n=s[i],o=e[n];let h=r[n+XT];if(!rw(h,o))if("object"==typeof o&&o instanceof a.ValueType&&(h=yi.getDefault(h),h&&h.constructor===o.constructor)){const e=$T+iw(n);this.setValueType(t,h,o,e)}else this.setObjProp(t,e,n,o)}}instantiateArray(t){if(0===t.length)return"[]";const e="a"+ ++this.localVariableId,i=[new QT(e,`new Array(${t.length})`)];t._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(t);for(let s=0;s<t.length;++s)tw(i,`${e}[${s}]=`,this.enumerateField(t,s,t[s]));return i}instantiateTypedArray(t){const e=t.constructor.name;if(0===t.length)return`new ${e}`;const i="a"+ ++this.localVariableId,s=[new QT(i,`new ${e}(${t.length})`)];t._iN$t={globalVar:"",source:s},this.objsToClear_iN$t.push(t);for(let e=0;e<t.length;++e)0!==t[e]&&tw(s,`${i}[${e}]=`,t[e]);return s}enumerateField(t,e,i){if("object"==typeof i&&i){const t=i._iN$t;if(t){let e=t.globalVar;if(!e){e=t.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(e);const i=t.source[0];t.source[0]=JT(`${e}=`,i)}return e}return ArrayBuffer.isView(i)?this.instantiateTypedArray(i):Array.isArray(i)?this.instantiateArray(i):this.instantiateObj(i)}return"function"==typeof i?this.getFuncModule(i):"string"==typeof i?ZT(i):("_objFlags"===e&&Io(t)&&(i&=-4192741),i)}setObjProp(t,e,i,s){tw(t,`${$T+iw(i)}=`,this.enumerateField(e,i,s))}enumerateObject(t,e){const i=e.constructor;if(bi(i))this.enumerateCCClass(t,e,i);else for(const i in e){if(!Object.prototype.hasOwnProperty.call(e,i)||95===i.charCodeAt(0)&&95===i.charCodeAt(1)&&"__type__"!==i)continue;const s=e[i];"object"==typeof s&&s&&s===e._iN$t||this.setObjProp(t,e,i,s)}}instantiateObj(t){if(t instanceof a.ValueType)return yi.getNewValueTypeCode(t);if(t instanceof a.Asset)return this.getObjRef(t);if(1&t._objFlags)return null;let e;const i=t.constructor;if(bi(i)){if(this.parent)if(this.parent instanceof a.Component){if(t instanceof a.Node||t instanceof a.Component)return this.getObjRef(t)}else if(this.parent instanceof a.Node)if(t instanceof a.Node){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof a.Component){var s;if(null==(s=t.node)||!s.isChildOf(this.parent))return this.getObjRef(t)}e=new QT($T,`new ${this.getFuncModule(i,!0)}()`)}else if(i===Object)e=new QT($T,"{}");else{if(i)return this.getObjRef(t);e=new QT($T,"Object.create(null)")}const r=[e];return t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t),this.enumerateObject(r,t),["(function(){",r,"return o;})();"]}};function rw(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e&&t.constructor===e.constructor)if(t instanceof a.ValueType){if(t.equals(e))return!0}else{if(Array.isArray(t))return 0===t.length&&0===e.length;if(t.constructor===Object)return yt(t)&&yt(e)}return!1}function nw(t){const e=t instanceof a.Node&&t;return new sw(t,e).result}var ow,aw,hw,lw,cw,uw;const dw=pe({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2});let _w=t("Prefab",ah("cc.Prefab")((uw=class t extends fm{constructor(){super(),this.data=hw&&hw(),this.optimizationPolicy=lw&&lw(),this.persistent=cw&&cw(),this._createFunction=null,this._instantiatedTimes=0}createNode(t){const e=h.instantiate(this);e.name=this.name,t(null,e)}compileCreateFunction(){this._createFunction=nw(this.data)}_doInstantiate(t){return this.data._prefab||j(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)}_instantiate(){let e,i=!1;return i=this.optimizationPolicy!==dw.SINGLE_INSTANCE&&(this.optimizationPolicy===dw.MULTI_INSTANCE||this._instantiatedTimes+1>=t.OptimizationPolicyThreshold),i?(e=this._doInstantiate(),this.data._instantiate(e)):e=this.data._instantiate(),++this._instantiatedTimes,e}initDefault(t){super.initDefault(t),this.data=new tb,this.data.name="(Missing Node)";const e=new h._PrefabInfo;e.asset=this,e.root=this.data,this.data._prefab=e}validate(){return!!this.data}onLoaded(){const t=this.data;mT(t),_T(t),pm(t)}},uw.OptimizationPolicy=dw,uw.OptimizationPolicyThreshold=3,hw=Za((aw=uw).prototype,"data",[vh],(function(){return null})),lw=Za(aw.prototype,"optimizationPolicy",[vh],(function(){return dw.AUTO})),cw=Za(aw.prototype,"persistent",[vh],(function(){return!1})),ow=aw))||ow);bt(_w,"_utils",gT),h.Prefab=_w,Ct(h,"cc._Prefab","Prefab");const pw=new class{constructor(){this._allRenderers=[],this._dirtyRenderers=[],this._dirtyVersion=0}addRenderer(t){-1===t._internalId&&(t._internalId=this._allRenderers.length,this._allRenderers.push(t))}removeRenderer(t){if(-1!==t._internalId){const e=t._internalId;this._allRenderers[this._allRenderers.length-1]._internalId=e,ie(this._allRenderers,e),t._internalId=-1,t._dirtyVersion===this._dirtyVersion&&(re(this._dirtyRenderers,t),t._dirtyVersion=-1)}}markDirtyRenderer(t){t._dirtyVersion!==this._dirtyVersion&&-1!==t._internalId&&(this._dirtyRenderers.push(t),t._dirtyVersion=this._dirtyVersion)}updateAllDirtyRenderers(){const t=this._dirtyRenderers;for(let e=0;e<this._dirtyRenderers.length;e++)t[e].updateRenderer();this._dirtyRenderers.length=0,this._dirtyVersion++}},mw=(t,e)=>!(t.length>e.length)||47===t.charCodeAt(e.length),gw=t=>{let e=t.uuids;const i=t.paths,s=t.types,r=t.deps,n=t.paths=Object.create(null);if(!1===t.debug){for(let t=0,i=e.length;t<i;t++)e[t]=rm(e[t]);for(const t in i){const e=i[t],r=e[1];e[1]=s[r]}}else{const t=Object.create(null);for(let i=0,s=e.length;i<s;i++){const s=e[i];e[i]=t[s]=rm(s)}e=t}for(const t in i){const s=i[t];n[e[t]]=s}const o=t.scenes;for(const t in o){const i=o[t];o[t]=e[i]}const a=t.packs;for(const t in a){const i=a[t];for(let t=0;t<i.length;++t)i[t]=e[i[t]]}const h=t.versions;if(h)for(const t in h){const i=h[t];for(let t=0;t<i.length;t+=2){const s=i[t];i[t]=e[s]||s}}const l=t.redirect;if(l)for(let t=0;t<l.length;t+=2)l[t]=e[l[t]],l[t+1]=r[l[t+1]];if(t.extensionMap)for(const i in t.extensionMap)Object.prototype.hasOwnProperty.call(t.extensionMap,i)&&t.extensionMap[i].forEach(((s,r)=>{t.extensionMap[i][r]=e[s]||s}))};class fw{constructor(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new Vp,this.scenes=new Vp,this.paths=new Vp}init(t){gw(t),this.importBase=t.importBase||"",this.nativeBase=t.nativeBase||"",this.base=t.base||"",this.name=t.name||"",this.deps=t.deps||[],this._initUuid(t.uuids),this._initPath(t.paths),this._initScene(t.scenes),this._initPackage(t.packs,t.extensionMap[".cconb"]),this._initVersion(t.versions),this._initRedirect(t.redirect);for(const e in t.extensionMap)Object.prototype.hasOwnProperty.call(t.extensionMap,e)&&t.extensionMap[e].forEach((t=>{const i=this.assetInfos.get(t);i&&(i.extension=e)}))}getInfoWithPath(t,e){if(!t)return null;t=lm(t);const i=this.paths.get(t);if(i){if(!e)return i[0];for(let t=0,s=i.length;t<s;t++){const s=i[t];if(kt(s.ctor,e))return s}}return null}getDirWithPath(t,e,i){"/"===(t=lm(t))[t.length-1]&&(t=t.slice(0,-1));const s=i||[];return this.paths.forEach(((i,r)=>{if(r.startsWith(t)&&mw(r,t)||!t)for(let t=0,r=i.length;t<r;t++){const r=i[t];e&&!kt(r.ctor,e)||s.push(r)}})),s}getAssetInfo(t){return this.assetInfos.get(t)||null}getSceneInfo(t){return t.endsWith(".scene")||(t+=".scene"),"/"===t[0]||t.startsWith("db://")||(t=`/${t}`),this.scenes.find(((e,i)=>i.endsWith(t)))}destroy(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()}_initUuid(t){if(t){this.assetInfos.clear();for(let e=0,i=t.length;e<i;e++){const i=t[e];this.assetInfos.add(i,{uuid:i})}}}_initPath(t){if(!t)return;const e=this.paths;e.clear();for(const i in t){const s=t[i],r=s[0],n=s[1],o=3===s.length,a=this.assetInfos.get(i);a.path=r,a.ctor=$t(n),e.has(r)?o?e.get(r).push(a):e.get(r).unshift(a):e.add(r,[a])}}_initScene(t){if(!t)return;const e=this.scenes;e.clear();const i=this.assetInfos;for(const s in t){const r=t[s],n=i.get(r);n.url=s,e.add(s,n)}}_initPackage(t,e){if(!t)return;const i=this.assetInfos;for(const s in t){const r=t[s],n={uuid:s,packedUuids:r,ext:(null==r?void 0:r.length)>0&&(null==e?void 0:e.includes(r[0]))?".bin":".json"};i.add(s,n);for(let t=0,e=r.length;t<e;t++){const s=r[t],o=i.get(s),a=o.packs;a?1===e?a.unshift(n):a.push(n):o.packs=[n]}}}_initVersion(t){if(!t)return;const e=this.assetInfos;let i=t.import;if(i)for(let t=0,s=i.length;t<s;t+=2){const s=i[t];e.get(s).ver=i[t+1]}if(i=t.native,i)for(let t=0,s=i.length;t<s;t+=2){const s=i[t];e.get(s).nativeVer=i[t+1]}}_initRedirect(t){if(!t)return;const e=this.assetInfos;for(let i=0,s=t.length;i<s;i+=2){const s=t[i];e.get(s).redirect=t[i+1]}}}function yw(t,e){t._uuid&&e.push(t._uuid)}function bw(t,e){const i=Object.getOwnPropertyNames(t);for(let s=0;s<i.length;s++){const r=i[s];if("node"===r||"__eventTargets"===r)continue;const n=t[r];if("object"==typeof n&&n)if(Array.isArray(n))for(let t=0;t<n.length;t++){const i=n[t];i instanceof fm&&yw(i,e)}else if(n.constructor&&n.constructor!==Object)n instanceof fm&&yw(n,e);else{const t=Object.getOwnPropertyNames(n);for(let i=0;i<t.length;i++){const s=n[t[i]];s instanceof fm&&yw(s,e)}}}}function vw(t,e){for(let i=0;i<t._components.length;i++)bw(t._components[i],e);for(let i=0;i<t._children.length;i++)vw(t._children[i],e)}function Sw(t,e,i,s){i.push(t._uuid);const r=rf.getDeps(t._uuid);for(let t=0,n=r.length;t<n;t++){const n=Hp.get(r[t]);if(!n)continue;const o=n._uuid;o in e?e[o]+=s:e[o]=n.refCount+s,i.includes(o)||Sw(n,e,i,s)}}const Tw=[];function ww(t){const e=Object.create(null);if(e[t._uuid]=t.refCount,Sw(t,e,Tw,-1),Tw.length=0,0!==e[t._uuid])return e[t._uuid];for(const t in e)0!==e[t]&&Sw(Hp.get(t),e,Tw,1);return Tw.length=0,e[t._uuid]}const xw=new class{constructor(){this._persistNodeDeps=new Vp,this._toDelete=new Vp,this._eventListener=!1,this._dontDestroyAssets=[]}addIgnoredAsset(t){this._dontDestroyAssets.push(t._uuid)}init(){this._persistNodeDeps.clear(),this._toDelete.clear()}_addPersistNodeRef(t){const e=[];vw(t,e);for(let t=0,i=e.length;t<i;t++){const i=Hp.get(e[t]);i&&i.addRef()}this._persistNodeDeps.add(t.uuid,e)}_removePersistNodeRef(t){if(!this._persistNodeDeps.has(t.uuid))return;const e=this._persistNodeDeps.get(t.uuid);for(let t=0,i=e.length;t<i;t++){const i=Hp.get(e[t]);i&&i.decRef()}this._persistNodeDeps.remove(t.uuid)}_autoRelease(t,e,i){if(t){const i=rf.getDeps(t.uuid);for(let e=0,s=i.length;e<s;e++){const s=Hp.get(i[e]);s&&s.decRef(t.autoReleaseAssets)}const s=rf._depends.get(t.uuid);if(s&&s.persistDeps){const e=s.persistDeps;for(let i=0,s=e.length;i<s;i++){const s=Hp.get(e[i]);s&&s.decRef(t.autoReleaseAssets)}}t.uuid!==e.uuid&&rf.remove(t.uuid)}const s=rf._depends.get(e.uuid);s&&(s.persistDeps=[]);for(const t in i){const e=i[t],r=this._persistNodeDeps.get(e.uuid);for(const t of r){const e=Hp.get(t);e&&e.addRef()}s&&s.persistDeps.push(...r)}}tryRelease(t,e=!1){t instanceof fm&&(e?this._free(t,e):(this._toDelete.add(t._uuid,t),this._eventListener||(this._eventListener=!0,Oe(this._freeAssets.bind(this)))))}_freeAssets(){this._eventListener=!1,this._toDelete.forEach((t=>{this._free(t)})),this._toDelete.clear()}_free(t,e=!1){const i=t._uuid;if(this._toDelete.remove(i),!Mo(t,!0)||-1!==this._dontDestroyAssets.indexOf(i))return;if(!e&&t.refCount>0&&ww(t)>0)return;Hp.remove(i);const s=rf.getDeps(i);for(let t=0,e=s.length;t<e;t++){const e=Hp.get(s[t]);e&&(e.decRef(!1),this._free(e,!1))}t.destroy(),rf.remove(i)}};let Cw=null;function Aw(t){for(let e=0,i=t.input.length;e<i;e++){const i=t.input[e];!i.isNative&&i.content instanceof fm&&i.content.decRef(!1),i.recycle()}t.input=null}function Dw(t,e){return e?/\?/.test(t)?`${t}&_t=${Date.now()}`:`${t}?_t=${Date.now()}`:t}function Ew(t,e,i,s,r=0){t(r,((n,o)=>{r++,!n||r>e?s&&s(n,o):setTimeout((()=>{Ew(t,e,i,s,r)}),i)}))}function Iw(t,e,i,s,r){try{const n=rf.parse(t,e);for(let t=0,e=n.deps.length;t<e;t++){const e=n.deps[t];e in i||(i[e]=!0,s.push({uuid:e,bundle:r&&r.name}))}n.nativeDep&&(r&&(n.nativeDep.bundle=r.name),s.push({...n.nativeDep}))}catch(t){P(t.message,t.stack)}}function Mw(t,e,i){e&&(i=void 0!==i?i:a.assetManager.cacheAsset,hm(e)||!i||e.isDefault||Hp.add(t,e))}function Pw(t,e,i){let s=!1;const r=Qg.get(e);if(r){for(let t=0,n=r.length;t<n;t++){const n=r[t],o=i[`${n.uuid}@import`];if(o)n.owner[n.prop]=o.addRef();else{if(G(16350,n.uuid),a.assetManager.dispatchAssetMissing(e,n.owner,n.prop,n.uuid),n.type&&n.type!==fm){const t=new n.type;t.initDefault(n.uuid),n.owner[n.prop]=t}s=!0}}Qg.delete(e)}return Jg.has(e)&&(i[`${t}@native`]?e._nativeAsset=i[`${t}@native`]:(s=!0,G(16351,t)),Jg.delete(e)),s}function Ow(t){const e=t.source;if(t.options.__outputAsArray__||1!==e.length){const i=t.output=[];for(let t=0,s=e.length;t<s;t++)i.push(e[t].content)}else t.output=e[0].content}function Rw(t,e,i){let s=0;const r=[],n=t.length;0===n&&i&&i(r);const o=t=>{t&&r.push(t),s++,s===n&&i&&i(r)};for(let i=0;i<n;i++)e(t[i],o)}function Bw(t,e,i){let s=t,r=e,n=i;if(void 0===i){const i="function"==typeof t;e?(n=e,i||(r=null)):void 0===e&&i&&(n=t,s=null,r=null),void 0!==e&&i&&(r=t,s=null)}return{options:s||Object.create(null),onProgress:r,onComplete:n}}function Fw(t,e,i){let s=t,r=e,n=i;if(void 0===i){const i=kt(t,fm);e?(n=e,i&&(r=null)):void 0!==e||i||(n=t,r=null,s=null),void 0===e||i||(r=t,s=null)}return{type:s,onProgress:r||Cw,onComplete:n}}function Nw(t,e,i,s={}){if(!i[e]||s[e])return!1;s[e]=!0;let r=!1;const n=rf.getDeps(e);if(n)for(let e=0,o=n.length;e<o;e++){const o=n[e];if(o===t||Nw(t,o,i,s)){r=!0;break}}return r}function Lw(t){return(e,i)=>{if(!t)return;const s=[];Array.isArray(i)?i.forEach((t=>t instanceof fm&&s.push(t.addRef()))):i instanceof fm&&s.push(i.addRef()),Oe((()=>{s.forEach((t=>t.decRef(!1))),t(e,i)}))}}class kw{constructor(){this._config=new fw}get config(){return this._config}get name(){return this._config.name}get deps(){return this._config.deps}get base(){return this._config.base}getInfoWithPath(t,e){return this._config.getInfoWithPath(t,e)}getDirWithPath(t,e,i){return this._config.getDirWithPath(t,e,i)}getAssetInfo(t){return this._config.getAssetInfo(t)}getSceneInfo(t){return this._config.getSceneInfo(t)}init(t){this._config.init(t),Xp.add(t.name,this)}load(t,e,i,s){const{type:r,onProgress:n,onComplete:o}=Fw(e,i,s),h={__requestType__:"path",type:r,bundle:this.name,__outputAsArray__:Array.isArray(t)};a.assetManager.loadAny(t,h,n,o)}preload(t,e,i,s){const{type:r,onProgress:n,onComplete:o}=Fw(e,i,s);a.assetManager.preloadAny(t,{__requestType__:"path",type:r,bundle:this.name},n,o)}loadDir(t,e,i,s){const{type:r,onProgress:n,onComplete:o}=Fw(e,i,s);a.assetManager.loadAny(t,{__requestType__:"dir",type:r,bundle:this.name,__outputAsArray__:!0},n,o)}preloadDir(t,e,i,s){const{type:r,onProgress:n,onComplete:o}=Fw(e,i,s);a.assetManager.preloadAny(t,{__requestType__:"dir",type:r,bundle:this.name},n,o)}loadScene(t,e,i,s){const{options:r,onProgress:n,onComplete:o}=Bw(e,i,s);r.preset=r.preset||"scene",r.bundle=this.name,a.assetManager.loadAny({scene:t},r,n,((t,e)=>{if(t)P(t.message,t.stack);else if(e.scene){const t=e.scene;t.id=e._uuid,t.name=e.name}else t=new Error(`The asset ${e._uuid} is not a scene`);o&&o(t,e)}))}preloadScene(t,e,i,s){const{options:r,onProgress:n,onComplete:o}=Bw(e,i,s);r.bundle=this.name,a.assetManager.preloadAny({scene:t},r,n,(e=>{e&&G(1210,t,e.message),o&&o(e)}))}get(t,e){const i=this.getInfoWithPath(t,e);return i&&Hp.get(i.uuid)||null}release(t,e){const i=this.get(t,e);i&&xw.tryRelease(i,!0)}releaseUnusedAssets(){Hp.forEach((t=>{const e=this.getAssetInfo(t._uuid);e&&!e.redirect&&xw.tryRelease(t)}))}releaseAll(){Hp.forEach((t=>{const e=this.getAssetInfo(t._uuid);e&&!e.redirect&&xw.tryRelease(t,!0)}))}_destroy(){this._config.destroy()}}const zw=t("resources",new kw);function Uw(t,e,i){const s=new c.Image;function r(){s.removeEventListener("load",r),s.removeEventListener("error",n),i&&i(null,s)}function n(){s.removeEventListener("load",r),s.removeEventListener("error",n),i&&i(new Error(q(4930,t)))}return"file:"!==c.location.protocol&&(s.crossOrigin="anonymous"),s.addEventListener("load",r),s.addEventListener("error",n),s.src=t,s}function Vw(t,e,i,s){const r=new XMLHttpRequest,n=`download failed: ${t}, status: `;if(r.open("GET",t,!0),void 0!==e.xhrResponseType&&(r.responseType=e.xhrResponseType),void 0!==e.xhrWithCredentials&&(r.withCredentials=e.xhrWithCredentials),void 0!==e.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(e.xhrMimeType),void 0!==e.xhrTimeout&&(r.timeout=e.xhrTimeout),e.xhrHeader)for(const t in e.xhrHeader)r.setRequestHeader(t,e.xhrHeader[t]);return r.onload=()=>{200===r.status||0===r.status?s&&s(null,r.response):s&&s(new Error(`${n}${r.status}(no response)`))},i&&(r.onprogress=t=>{t.lengthComputable&&i(t.loaded,t.total)}),r.onerror=()=>{s&&s(new Error(`${n}${r.status}(error)`))},r.ontimeout=()=>{s&&s(new Error(`${n}${r.status}(time out)`))},r.onabort=()=>{s&&s(new Error(`${n}${r.status}(abort)`))},r.send(null),r}a.resources=zw;const jw=c.document,Hw={};function Gw(t,e,i){if(Hw[t])return i&&i(null),null;const s=jw.createElement("script");function r(){s.parentNode.removeChild(s),s.removeEventListener("load",r,!1),s.removeEventListener("error",n,!1),Hw[t]=!0,i&&i(null)}function n(){s.parentNode.removeChild(s),s.removeEventListener("load",r,!1),s.removeEventListener("error",n,!1),i&&i(new Error(q(4928,t)))}return"file:"!==c.location.protocol&&(s.crossOrigin="anonymous"),s.async=e.scriptAsyncLoading||!1,s.src=t,s.addEventListener("load",r,!1),s.addEventListener("error",n,!1),jw.body.appendChild(s),s}const Ww=/^(?:\w+:\/\/|\.+\/).+/,Xw=(t,e,i)=>{(ga.hasFeature(ga.Feature.IMAGE_BITMAP)&&a.assetManager.allowImageBitmap?Yw:Uw)(t,e,i)},Yw=(t,e,i)=>{e.xhrResponseType="blob",Vw(t,e,e.onFileProgress,i)},qw=(t,e,i)=>{e.xhrResponseType="json",Vw(t,e,e.onFileProgress,i)},$w=(t,e,i)=>{e.xhrResponseType="arraybuffer",Vw(t,e,e.onFileProgress,i)},Kw=(t,e,i)=>{const s=(t,e)=>{try{e(null,ng(new Uint8Array(t)))}catch(t){e(t)}};tx._downloadArrayBuffer(t.replace(".cconb",".bin"),e,((r,n)=>{r?tx._downloadArrayBuffer(t,e,((t,e)=>{t?i(t):s(e,i)})):s(n,i)}))},Zw=(t,e,i)=>{e.xhrResponseType="text",Vw(t,e,e.onFileProgress,i)},Qw=(t,e,i)=>{const s=ia(t);let r=t;Ww.test(r)||(r=-1!==tx.remoteBundles.indexOf(s)?`${tx.remoteServerAddress}remote/${s}`:`assets/${s}`);const n=e.version||tx.bundleVers[s];let o=0,a=null,h=null;qw(`${r}/config.${n?`${n}.`:""}json`,e,((t,e)=>{h=t||h,a=e,a&&(a.base=`${r}/`),2==++o&&i(h,a)})),Gw(`${r}/index.${n?`${n}.`:""}js`,e,(t=>{h=t||h,2==++o&&i(h,a)}))};class Jw{static get instance(){return Jw._instance||(Jw._instance=new Jw),Jw._instance}get remoteServerAddress(){return this._remoteServerAddress}init(t="",e={},i=[]){this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=t,this.bundleVers=e,this.remoteBundles=i}get handlers(){return this._downloaders}register(t,e){"object"==typeof t?Ft(this._downloaders,t):this._downloaders[t]=e}download(t,e,i,s,r){const n=Gp.get(t);if(n)return void r(null,n);const o=this._downloading.get(t);if(o){o.push(r);const e=this._queue.find((e=>e.id===t));if(!e)return;const i=s.priority||0;return void(e.priority<i&&(e.priority=i,this._queueDirty=!0))}const a=void 0!==s.maxRetryCount?s.maxRetryCount:this.maxRetryCount,h=void 0!==s.maxConcurrency?s.maxConcurrency:this.maxConcurrency,l=void 0!==s.maxRequestsPerFrame?s.maxRequestsPerFrame:this.maxRequestsPerFrame,c=this._downloaders[i]||this._downloaders.default;Ew(((i,n)=>{if(0===i&&this._downloading.add(t,[r]),!this.limited)return void c(Dw(e,this.appendTimeStamp),s,n);this._updateTime();const o=(t,e)=>{this._totalNum--,this._handleQueueInNextFrame(h,l),n(t,e)};this._totalNum<h&&this._totalNumThisPeriod<l?(c(Dw(e,this.appendTimeStamp),s,o),this._totalNum++,this._totalNumThisPeriod++):(this._queue.push({id:t,priority:s.priority||0,url:e,options:s,done:o,handler:c}),this._queueDirty=!0,this._totalNum<h&&this._handleQueueInNextFrame(h,l))}),a,this.retryInterval,((e,i)=>{e||Gp.add(t,i);const s=this._downloading.remove(t);for(let t=0,r=s.length;t<r;t++)s[t](e,i)}))}loadSubpackage(t,e){a.assetManager.loadBundle(t,null,e)}constructor(){this.maxConcurrency=15,this.maxRequestsPerFrame=15,this.maxRetryCount=3,this.appendTimeStamp=!1,this.limited=!0,this.retryInterval=2e3,this.bundleVers={},this.remoteBundles=[],this.downloadDomImage=Uw,this.downloadDomAudio=null,this.downloadFile=Vw,this.downloadScript=Gw,this._downloadArrayBuffer=$w,this._downloadJson=qw,this._downloaders={".png":Xw,".jpg":Xw,".bmp":Xw,".jpeg":Xw,".gif":Xw,".ico":Xw,".tiff":Xw,".webp":Xw,".image":Xw,".pvr":$w,".pkm":$w,".astc":$w,".txt":Zw,".xml":Zw,".vsh":Zw,".fsh":Zw,".atlas":Zw,".tmx":Zw,".tsx":Zw,".json":qw,".ExportJson":qw,".plist":Zw,".cconb":Kw,".fnt":Zw,".binary":$w,".bin":$w,".dbbin":$w,".skel":$w,".js":Gw,bundle:Qw,default:Zw},this._downloading=new Vp,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}_updateTime(){const t=performance.now(),e=a.game.deltaTime,i=e>this._maxInterval?this._maxInterval:e;t-this._lastDate>1e3*i&&(this._totalNumThisPeriod=0,this._lastDate=t)}_handleQueue(t,e){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<t&&this._totalNumThisPeriod<e;){this._queueDirty&&(this._queue.sort(((t,e)=>t.priority-e.priority)),this._queueDirty=!1);const t=this._queue.pop();if(!t)break;this._totalNum++,this._totalNumThisPeriod++,t.handler(Dw(t.url,this.appendTimeStamp),t.options,t.done)}this._handleQueueInNextFrame(t,e)}_handleQueueInNextFrame(t,e){!this._checkNextPeriod&&this._queue.length>0&&(Oe(this._handleQueue.bind(this),t,e),this._checkNextPeriod=!0)}}Jw._instance=void 0;const tx=Jw.instance;var ex,ix,sx,rx=Jw.instance;let nx=t("JsonAsset",ah("cc.JsonAsset")((ix=class extends fm{constructor(t){super(t),this.json=sx&&sx()}},sx=Za(ix.prototype,"json",[vh],(function(){return null})),ex=ix))||ex);var ox,ax,hx;a.JsonAsset=nx;let lx=t("TextAsset",ah("cc.TextAsset")((ax=class extends fm{toString(){return this.text}constructor(t){super(t),this.text=hx&&hx()}},hx=Za(ax.prototype,"text",[vh],(function(){return""})),ox=ax))||ox);a.TextAsset=lx;const cx=t("BufferAsset",jsb.BufferAsset);function ux(t,e,i,s){let r=null,n=null;try{r=new Sm,r._nativeUrl=t,r._nativeAsset=e}catch(t){n=t}s(n,r)}function dx(t,e,i,s){const r=new nx;r.json=e,s(null,r)}function _x(t,e,i,s){const r=new lx;r.text=e,s(null,r)}function px(t,e,i,s){const r=new cx;r._nativeUrl=t,r._nativeAsset=e,s(null,r)}function mx(t,e,i,s){const r=new fm;r._nativeUrl=t,r._nativeAsset=e,s(null,r)}function gx(t,i,s,r){let n=Xp.get(i.name);n||(n="resources"===i.name?zw:new kw,i.base=i.base||`${t}/`,n.init(i)),e.import(`virtual:///prerequisite-imports/${n.name}`).then((()=>{r(null,n)})).catch(r)}a.BufferAsset=jsb.BufferAsset,function(t,e=dm){const{BufferAsset:i}={...t},s=Object.getOwnPropertyDescriptor(i.prototype,"_nativeAsset");e((()=>{Yh(i.prototype,"_nativeAsset",s)}),"override","_nativeAsset"),e((()=>{ah("cc.BufferAsset")(i)}),"ccclass",null)}({BufferAsset:cx});var fx=new class{constructor(){this._creating=new Vp,this._producers={".png":ux,".jpg":ux,".bmp":ux,".jpeg":ux,".gif":ux,".ico":ux,".tiff":ux,".webp":ux,".image":ux,".pvr":ux,".pkm":ux,".astc":ux,".txt":_x,".xml":_x,".vsh":_x,".fsh":_x,".atlas":_x,".tmx":_x,".tsx":_x,".fnt":_x,".json":dx,".ExportJson":dx,".binary":px,".bin":px,".dbbin":px,".skel":px,bundle:gx,default:mx}}register(t,e){"object"==typeof t?Ft(this._producers,t):this._producers[t]=e}create(t,e,i,s,r){const n=this._producers[i]||this._producers.default,o=Hp.get(t);if(!s.reloadAsset&&o)return void r(null,o);const a=this._creating.get(t);a?a.push(r):(this._creating.add(t,[r]),n(t,e,s,((e,i)=>{!e&&i instanceof fm&&(i._uuid=t,Mw(t,i,s.cacheAsset));const r=this._creating.remove(t);for(let t=0,s=r.length;t<s;t++)r[t](e,i)})))}};const yx=!0;function bx(t){const e=new DataView(t,0,t.byteLength);if("BINP"!==String.fromCharCode(...new Uint8Array(t.slice(0,4))))throw new Error("Invalid bin package format");const i=e.getUint32(4,yx);if(2!==i)return vx(t,e,i);const s=e.getUint32(8,yx),r=[],n=4*(3+2*s);for(let t=0;t<s;t++){const i=e.getUint32(4*(3+2*t),yx)+n,s=e.getUint32(4*(4+2*t),yx);r.push({offset:i,size:s})}return r.map((({offset:e,size:i})=>new Uint8Array(t,e,i)))}function vx(t,e,i){return{1:Sx}[i](t,e)}function Sx(t,e){const i=e.getUint32(8,yx),s=[];let r=4*(3+i);for(let t=0;t<i;t++){const i=e.getUint32(4*(3+t),yx);s.push({offset:r,size:i}),r+=i}return s.map((({offset:e,size:i})=>new Uint8Array(t,e,i)))}var Tx=new class{constructor(){this._loading=new Vp,this._unpackers={".json":this.unpackJson,".bin":this.unpackBin}}unpackJson(t,e,i,s){const r=wt(!0);let n=null;if(Array.isArray(e)){(e=qg(e)).length!==t.length&&G(4915);for(let i=0;i<t.length;i++)r[`${t[i]}@import`]=e[i]}else{const i=Qt(ff),o=Qt(Sm);if(e.type===i&&e.data){const s=e.data;s.length!==t.length&&G(4915);for(let e=0;e<t.length;e++)r[`${t[e]}@import`]=$g(i,{base:s[e][0],mipmaps:s[e][1]})}else{if(e.type!==o||!e.data)return n=new Error("unmatched type pack!"),void s(n,null);{const i=e.data;i.length!==t.length&&G(4915);for(let e=0;e<t.length;e++)r[`${t[e]}@import`]=i[e]}}}s(n,r)}unpackBin(t,e,i,s){const r=wt(!0);let n=null;try{const i=bx(e);t.forEach(((t,e)=>r[`${t}@import`]=ng(i[e])))}catch(t){n=t}s(n,r)}init(){this._loading.clear()}register(t,e){"object"==typeof t?Ft(this._unpackers,t):this._unpackers[t]=e}unpack(t,e,i,s,r){e?(0,this._unpackers[i])(t,e,s,r):r(new Error("package data is wrong!"))}load(t,e,i){if(t.isNative||!t.info||!t.info.packs)return void rx.download(t.id,t.url,t.ext,t.options,i);if(Gp.has(t.id))return void i(null,Gp.get(t.id));const s=t.info.packs,r=s.find((t=>this._loading.has(t.uuid)));if(r)return void this._loading.get(r.uuid).push({onComplete:i,id:t.id});const n=s[0];this._loading.add(n.uuid,[{onComplete:i,id:t.id}]),t.config;const o=cm(n.uuid,{ext:n.ext,bundle:t.config.name}),a=(e,i)=>{Gp.remove(n.uuid),e&&P(e.message,e.stack),this.unpack(n.packedUuids,i,n.ext,t.options,((t,i)=>{if(!t)for(const t in i)Gp.add(t,i[t]);const s=this._loading.remove(n.uuid);for(let r=0,n=s.length;r<n;r++){const n=s[r];if(e||t){n.onComplete(e||t);continue}const o=i[n.id];o?n.onComplete(null,o):n.onComplete(new Error("can not retrieve data from package"))}}))};".bin"===n.ext?rx._downloadArrayBuffer(o,t.options,a):".json"===n.ext?rx.download(n.uuid,o,n.ext,t.options,a):G(4916,n.ext)}};function wx(t,e){let i=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},i=!0);const{options:s,progress:r}=t,n=[],o=r.total,h=s.__exclude__=s.__exclude__||Object.create(null);t.output=[],Rw(t.input,((s,l)=>{if(!s.isNative&&Hp.has(s.uuid)){const e=Hp.get(s.uuid);return s.content=e.addRef(),t.output.push(s),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,s),void l()}Tx.load(s,t.options,((c,u)=>{c?t.isFinished||(!a.assetManager.force||i?(P(c.message,c.stack),r.canInvoke=!1,e(c)):(t.output.push(s),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,s))):t.isFinished||(s.file=u,t.output.push(s),s.isNative||(h[s.uuid]=!0,Iw(s.uuid,u,h,n,s.config),r.total=o+n.length),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,s)),l()}))}),(()=>{if(t.isFinished)return Aw(t),void t.dispatch("error");if(n.length>0){const o=Jp.create({input:n,progress:r,options:s,onProgress:t.onProgress,onError:Jp.prototype.recycle,onComplete:s=>{s||(t.output.push(...o.output),o.recycle()),i&&xx(t),e(s)}});qp.async(o)}else i&&xx(t),e()}))}function xx(t){const e=t.output;for(let t=0,i=e.length;t<i;t++)e[t].content&&e[t].content.decRef(!1)}class Cx{constructor(){this._parser=null,globalThis.DOMParser&&(this._parser=new DOMParser)}parse(t){return this._parseXML(t)}_parseXML(t){if(this._parser)return this._parser.parseFromString(t,"text/xml");throw new Error("Dom parser is not supported in this platform!")}}const Ax=new class extends Cx{parse(t){const e=this._parseXML(t).documentElement;if("plist"!==e.tagName)return j(5100),{};let i=null;for(let t=0,s=e.childNodes.length;t<s&&(i=e.childNodes[t],1!==i.nodeType);t++);return this._parseNode(i)}_parseNode(t){let e=null;const i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(let i=0;i<t.childNodes.length;i++)e+=t.childNodes[i].nodeValue}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e}_parseArray(t){const e=[];for(let i=0,s=t.childNodes.length;i<s;i++){const s=t.childNodes[i];1===s.nodeType&&e.push(this._parseNode(s))}return e}_parseDict(t){const e={};let i="";for(let s=0,r=t.childNodes.length;s<r;s++){const r=t.childNodes[s];1===r.nodeType&&("key"===r.tagName?i=r.firstChild.nodeValue:e[i]=this._parseNode(r))}return e}};class Dx{static get instance(){return this._instance||(this._instance=new Dx),this._instance}constructor(){this._parsing=new Vp,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.parseImport,".ccon":this.parseImport,".cconb":this.parseImport}}parseImage(t,e,i){t instanceof HTMLImageElement?i(null,t):createImageBitmap(t,{premultiplyAlpha:"none"}).then((t=>{i(null,t)}),(t=>{i(t,null)}))}parsePVRTex(t,e,i){let s=null,r=null;try{r=Sm.parseCompressedTextures(t,0)}catch(t){s=t,M(s)}i(s,r)}parsePKMTex(t,e,i){let s=null,r=null;try{r=Sm.parseCompressedTextures(t,1)}catch(t){s=t,M(s)}i(s,r)}parseASTCTex(t,e,i){let s=null,r=null;try{r=Sm.parseCompressedTextures(t,2)}catch(t){s=t,M(s)}i(s,r)}parsePlist(t,e,i){let s=null;const r=Ax.parse(t);r||(s=new Error("parse failed")),i(s,r)}parseImport(t,e,i){if(!t)return void i(new Error(q(3702,e.__uuid__)));let s=null,r=null;try{s=ef(t,e)}catch(t){r=t}i(r,s)}init(){this._parsing.clear()}register(t,e){"object"==typeof t?Ft(this._parsers,t):this._parsers[t]=e}parse(t,e,i,s,r){const n=Wp.get(t);if(n)return void r(null,n);const o=this._parsing.get(t);if(o)return void o.push(r);const a=this._parsers[i];a?(this._parsing.add(t,[r]),a(e,s,((e,i)=>{e?Gp.remove(t):hm(i)||Wp.add(t,i);const s=this._parsing.remove(t);for(let t=0,r=s.length;t<r;t++)s[t](e,i)}))):r(null,e)}}Dx._instance=void 0;var Ex=Dx.instance;function Ix(t,e){let i=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},i=!0);const{options:s,progress:r}=t;s.__exclude__=s.__exclude__||Object.create(null),t.output=[],Rw(t.input,((n,o)=>{const h=Jp.create({input:n,onProgress:t.onProgress,options:s,progress:r,onComplete:(s,l)=>{s&&!t.isFinished&&(!a.assetManager.force||i?(P(s.message,s.stack),r.canInvoke=!1,e(s)):r.canInvoke&&t.dispatch("progress",++r.finish,r.total,n)),t.output.push(l),h.recycle(),o(null)}});Mx.async(h)}),(()=>{if(s.__exclude__=null,t.isFinished)return Aw(t),void t.dispatch("error");Ow(t),Aw(t),e()}))}const Mx=new jp("loadOneAsset",[function(t,e){const i=t.output=t.input,{options:s,isNative:r,uuid:n,file:o}=i,{reloadAsset:a}=s;o||!a&&!r&&Hp.has(n)?e():Tx.load(i,t.options,((t,s)=>{i.file=s,e(t)}))},function(t,e){const i=t.output=t.input,s=t.progress,r=t.options.__exclude__,{id:n,file:o,options:a}=i;if(i.isNative)Ex.parse(n,o,i.ext,a,((r,o)=>{r?e(r):(i.content=o,s.canInvoke&&t.dispatch("progress",++s.finish,s.total,i),Gp.remove(n),Wp.remove(n),e())}));else{const{uuid:h}=i;if(h in r){const{finish:n,content:o,err:a,callbacks:l}=r[h];s.canInvoke&&t.dispatch("progress",++s.finish,s.total,i),n||Nw(h,h,r)?(o&&o.addRef(),i.content=o,e(a)):l.push({done:e,item:i})}else if(!a.reloadAsset&&Hp.has(h)){const r=Hp.get(h);i.content=r.addRef(),s.canInvoke&&t.dispatch("progress",++s.finish,s.total,i),e()}else a.__uuid__=h,Ex.parse(n,o,"import",a,((i,s)=>{i?e(i):Px(t,s,e)}))}}]);function Px(t,e,i){const{input:s,progress:r}=t,{uuid:n,id:o,options:a,config:h}=s,{cacheAsset:l}=a,c=[];e.addRef&&e.addRef(),Iw(n,e,Object.create(null),c,h),r.canInvoke&&t.dispatch("progress",++r.finish,r.total+=c.length,s);const u=t.options.__exclude__[n]={content:e,finish:!1,callbacks:[{done:i,item:s}]},d=Jp.create({input:c,options:t.options,onProgress:t.onProgress,onError:Jp.prototype.recycle,progress:r,onComplete:t=>{if(e.decRef&&e.decRef(!1),u.finish=!0,u.err=t,!t){const t=Array.isArray(d.output)?d.output:[d.output],i=Object.create(null);for(const e of t)e&&(i[e instanceof fm?`${e._uuid}@import`:`${n}@native`]=e);Pw(n,e,i);try{"function"!=typeof e.onLoaded||tf.has(e)||Jg.has(e)||(e.onLoaded(),tf.add(e))}catch(t){G(16352,n,t.message,t.stack)}Gp.remove(o),Wp.remove(o),Mw(n,e,l),d.recycle()}const i=u.callbacks;for(let s=0,r=i.length;s<r;s++){const r=i[s];e.addRef&&e.addRef(),r.item.content=e,r.done(t)}i.length=0}});Yp.async(d)}function Ox(t,e){const i=t.options,s=Object.create(null),r=Object.create(null);for(const t in i)switch(t){case"path":case"uuid":case"dir":case"scene":case"url":break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":s[t]=i[t];break;case"__exclude__":case"__outputAsArray__":r[t]=i[t];break;default:s[t]=i[t],r[t]=i[t]}t.options=r;const n=Jp.create({input:t.input,options:s});let o=null;try{t.output=t.source=$p.sync(n)}catch(t){o=t;for(let t=0,e=n.output.length;t<e;t++)n.output[t].recycle()}n.recycle(),e(o)}class Rx{constructor(){this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}get id(){return this._id||(this._id=`${this.overrideUuid||this.uuid}@${this.isNative?"native":"import"}`),this._id}static create(){let t;return t=0!==Rx._deadPool.length?Rx._deadPool.pop():new Rx,t}recycle(){Rx._deadPool.length!==Rx.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.overrideUuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),Rx._deadPool.push(this))}}Rx.MAX_DEAD_NUM=500,Rx._deadPool=[];const Bx=[];function Fx(t){var e;const i=t.options,s=Array.isArray(t.input)?t.input:[t.input];t.output=[];for(let n=0;n<s.length;n++){let o=s[n],a=Rx.create(),h=null,l=null;if("string"==typeof o&&(o=Object.create(null),o[i.__requestType__||"uuid"]=s[n]),"object"==typeof o){Bt(o,i),o.preset&&Bt(o,Zp[o.preset]);for(const t in o){switch(t){case"uuid":{var r;const t=a.uuid=rm(o.uuid);if(!o.bundle){const e=Xp.find((e=>!!e.getAssetInfo(t)));o.bundle=e&&e.name}if(Xp.has(o.bundle)){if(h=Xp.get(o.bundle).config,l=h.getAssetInfo(t),l&&l.redirect){if(!Xp.has(l.redirect))throw new Error(`Please load bundle ${l.redirect} first`);h=Xp.get(l.redirect).config,l=h.getAssetInfo(t)}a.config=h,a.info=l}a.ext=o.ext||(null==(r=l)?void 0:r.extension)||".json";break}case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case"dir":if(Xp.has(o.bundle)){Xp.get(o.bundle).config.getDirWithPath(o.dir,o.type,Bx);for(const t of Bx)s.push({uuid:t.uuid,__isNative__:!1,ext:t.extension||".json",bundle:o.bundle});Bx.length=0}a.recycle(),a=null;break;case"path":if(Xp.has(o.bundle)){if(h=Xp.get(o.bundle).config,l=h.getInfoWithPath(o.path,o.type),l&&l.redirect){if(!Xp.has(l.redirect))throw new Error(`you need to load bundle ${l.redirect} first`);h=Xp.get(l.redirect).config,l=h.getAssetInfo(l.uuid)}if(!l)throw a.recycle(),new Error(`Bundle ${o.bundle} doesn't contain ${o.path}`);a.config=h,a.uuid=l.uuid,a.info=l}a.ext=o.ext||(null==(e=l)?void 0:e.extension)||".json";break;case"scene":if(!o.bundle){const t=Xp.find((t=>!!t.getSceneInfo(o.scene)));o.bundle=t&&t.name}if(Xp.has(o.bundle)){if(h=Xp.get(o.bundle).config,l=h.getSceneInfo(o.scene),l&&l.redirect){if(!Xp.has(l.redirect))throw new Error(`you need to load bundle ${l.redirect} first`);h=Xp.get(l.redirect).config,l=h.getAssetInfo(l.uuid)}if(!l)throw a.recycle(),new Error(`Bundle ${h.name} doesn't contain scene ${o.scene}`);a.config=h,a.uuid=l.uuid,a.info=l}break;case"__isNative__":a.isNative=o.__isNative__;break;case"url":a.url=o.url,a.uuid=o.uuid||o.url,a.ext=o.ext||ta(o.url),a.isNative=void 0===o.__isNative__||o.__isNative__;break;default:a.options[t]=o[t]}if(!a)break}}if(a&&(t.output.push(a),!a.uuid&&!a.url))throw new Error(`Can not parse this input:${JSON.stringify(o)}`)}return null}function Nx(t){const e=t.output=t.input;for(let t=0;t<e.length;t++){const s=e[t];if(Kp.has(s.uuid)){const t=Kp.get(s.uuid),e=Xp.find((e=>!!e.getAssetInfo(t)));if(e){var i;s.overrideUuid=t;let r=e.config,n=r.getAssetInfo(t);if(n&&n.redirect){if(!Xp.has(n.redirect))throw new Error(`Please load bundle ${n.redirect} first`);r=Xp.get(n.redirect).config,n=r.getAssetInfo(t)}s.config=r,s.info=n,s.ext=s.isNative?s.ext:(null==(i=n)?void 0:i.extension)||".json"}else j(16201,t,s.uuid)}}}function Lx(t){const e=t.output=t.input;for(let t=0;t<e.length;t++){const i=e[t];if(i.url)continue;let s="",r="";const n=i.config;r=i.isNative?n&&n.nativeBase?n.base+n.nativeBase:a.assetManager.generalNativeBase:n&&n.importBase?n.base+n.importBase:a.assetManager.generalImportBase;const o=i.overrideUuid||i.uuid;let h="";i.info&&(h=i.isNative?i.info.nativeVer?`.${i.info.nativeVer}`:"":i.info.ver?`.${i.info.ver}`:""),s=".ttf"===i.ext?`${r}/${o.slice(0,2)}/${o}${h}/${i.options.__nativeName__}`:`${r}/${o.slice(0,2)}/${o}${h}${i.ext}`,i.url=s}return null}const kx=Se.querySettings.bind(Se),zx="assets",Ux="asset-missing";class Vx{static get instance(){return this._instance||(this._instance=new Vx),this._instance}constructor(){this.pipeline=Yp.append(Ox).append(Ix),this.fetchPipeline=qp.append(Ox).append(wx),this.transformPipeline=$p.append(Fx).append(Nx).append(Lx),this.bundles=Xp,this.assets=Hp,this.assetsOverrideMap=Kp,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=rf,this.force=!1,this.allowImageBitmap=!1,this.utils=um,this.downloader=rx,this.parser=Ex,this.packManager=Tx,this.cacheAsset=!0,this.cacheManager=null,this.presets=Zp,this.factory=fx,this.preprocessPipe=Ox,this.fetchPipe=wx,this.loadPipe=Ix,this.references=null,this._releaseManager=xw,this._files=Gp,this._parsed=Wp,this._parsePipeline=null,this._projectBundles=[],this._eventTarget=new zo}get files(){return this._files}getReleaseManager(){return this._releaseManager}get main(){return Xp.get("main")||null}get resources(){return Xp.get("resources")||null}onAssetMissing(t,e){this._eventTarget.on(Ux,t,e)}offAssetMissing(t,e){this._eventTarget.off(Ux,t,e)}dispatchAssetMissing(t,e,i,s){this._eventTarget.emit(Ux,t,e,i,s)}init(t={}){const e=t.server||kx(zx,"server")||"",i=t.bundleVers||kx(zx,"bundleVers")||{},s=t.remoteBundles||kx(zx,"remoteBundles")||[],r=t.downloadMaxConcurrency||kx(zx,"downloadMaxConcurrency");r&&r>0&&(this.downloader.maxConcurrency=r),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(e,i,s),this.parser.init(),this.dependUtil.init();let n=t.importBase||kx(zx,"importBase")||"";n&&n.endsWith("/")&&(n=n.substring(0,n.length-1));let o=t.nativeBase||kx(zx,"nativeBase")||"";o&&o.endsWith("/")&&(o=o.substring(0,o.length-1)),this.generalImportBase=n,this.generalNativeBase=o,this._projectBundles=kx(zx,"projectBundles")||[];const a=kx(zx,"assetsOverrides")||{};for(const t in a)this.assetsOverrideMap.set(t,a[t])}getBundle(t){return Xp.get(t)||null}removeBundle(t){t._destroy(),Xp.remove(t.name)}loadAny(t,e,i,s){const{options:r,onProgress:n,onComplete:o}=Bw(e,i,s);r.preset=r.preset||"default",t=Array.isArray(t)?t.slice():t;const a=Jp.create({input:t,onProgress:n,onComplete:Lw(o),options:r});Yp.async(a)}preloadAny(t,e,i,s){const{options:r,onProgress:n,onComplete:o}=Bw(e,i,s);r.preset=r.preset||"preload",t=Array.isArray(t)?t.slice():t;const a=Jp.create({input:t,onProgress:n,onComplete:Lw(o),options:r});qp.async(a)}loadRemote(t,e,i){const{options:s,onComplete:r}=Bw(e,void 0,i);s.reloadAsset||!this.assets.has(t)?(s.__isNative__=!0,s.preset=s.preset||"remote",this.loadAny({url:t},s,null,((e,i)=>{e?(P(e.message,e.stack),r&&r(e,i)):fx.create(t,i,s.ext||ta(t),s,((t,e)=>{r&&r(t,e)}))}))):Lw(r)(null,this.assets.get(t))}loadBundle(t,e,i){const{options:s,onComplete:r}=Bw(e,void 0,i),n=ia(t);this.bundles.has(n)?Lw(r)(null,this.getBundle(n)):(s.preset=s.preset||"bundle",s.ext="bundle",s.__isNative__=!0,this.loadAny({url:t},s,null,((e,i)=>{e?(P(e.message,e.stack),r&&r(e,i)):fx.create(t,i,"bundle",s,((t,e)=>{r&&r(t,e)}))})))}releaseAsset(t){xw.tryRelease(t,!0)}releaseUnusedAssets(){Hp.forEach((t=>{xw.tryRelease(t)}))}releaseAll(){Hp.forEach((t=>{xw.tryRelease(t,!0)}))}loadWithJson(t,e,i,s){throw new Error("Only valid in Editor")}}t("AssetManager",Vx),Vx._instance=void 0,Vx.Pipeline=jp,Vx.Task=Jp,Vx.Cache=Vp,Vx.RequestItem=Rx,Vx.Bundle=kw,Vx.BuiltinBundleName=Qp,Vx.CacheManager=class{constructor(){this.cacheDir=void 0,this.cacheEnabled=void 0,this.autoClear=void 0,this.cacheInterval=void 0,this.deleteInterval=void 0,this.cachedFiles=void 0}},Vx.Downloader=Jw,Vx.Parser=Dx,Vx.DependUtil=sf;const jx=t("assetManager",a.assetManager=Vx.instance);a.AssetManager=Vx;const Hx=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],Gx=[".mp3",".ogg",".wav",".m4a"];function Wx(){return!0}const Xx={transformURL(t){const e=om(t);if(!e)return t;const i=Xp.find((t=>!!t.getAssetInfo(e)));if(!i)return t;let s="";const r=i.getAssetInfo(e);if(s=t.startsWith(i.base+i.config.nativeBase)?r.nativeVer||"":r.ver||"",!s||-1!==t.indexOf(s))return t;let n=!1;if(".ttf"===ta(t)&&(n=!0),n){const e=sa(t),i=ia(t);t=`${e}.${s}/${i}`}else t=t.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,})/,(t=>`${t}.${s}`));return t}};class Yx{constructor(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=Fw}set onProgress(t){Cw=t}get _cache(){if(Hp instanceof Vp)return Hp.map;{const t={};return Hp.forEach(((e,i)=>{t[i]=e})),t}}load(t,e,i){void 0===i&&void 0!==e&&(i=e,e=null);const s=Array.isArray(t)?t:[t];for(let t=0;t<s.length;t++){const e=s[t];"string"==typeof e?s[t]={url:e,__isNative__:!0}:(e.type&&(e.ext=`.${e.type}`,e.type=void 0),e.url&&(e.__isNative__=!0))}const r=[],n=[];jx.loadAny(s,null,((t,i,s)=>{s.content&&(Hx.includes(s.ext)?r.push(s.content):Gx.includes(s.ext)&&n.push(s.content)),e&&e(t,i,s)}),((t,e)=>{let o=null;if(!t){e=Array.isArray(e)?e:[e];for(let t=0;t<e.length;t++){const i=e[t];if(!(i instanceof fm)){let o=i;const a=s[t].url;r.includes(o)?fx.create(a,i,".png",{},((i,s)=>{o=e[t]=s})):n.includes(o)&&fx.create(a,i,".mp3",{},((i,s)=>{o=e[t]=s})),Hp.add(a,o)}}if(e.length>1){const t=Object.create(null);e.forEach((e=>{t[e._uuid]=e})),o={isCompleted:Wx,_map:t}}else o=e[0]}i&&i(t,o)}))}getXMLHttpRequest(){return new XMLHttpRequest}getItem(t){return jx.assets.has(t)?{content:jx.assets.get(t)}:null}loadRes(t,e,i,s){const{type:r,onProgress:n,onComplete:o}=this._parseLoadResArgs(e,i,s),a=ta(t);a&&!zw.getInfoWithPath(t,r)&&(t=t.slice(0,-a.length)),zw.load(t,r,n,o)}loadResArray(t,e,i,s){const{type:r,onProgress:n,onComplete:o}=this._parseLoadResArgs(e,i,s);t.forEach(((e,i)=>{const s=ta(e);s&&!zw.getInfoWithPath(e,r)&&(t[i]=e.slice(0,-s.length))})),zw.load(t,r,n,o)}loadResDir(t,e,i,s){const{type:r,onProgress:n,onComplete:o}=this._parseLoadResArgs(e,i,s);zw.loadDir(t,r,n,((e,i)=>{let s=[];e||(s=zw.getDirWithPath(t,r).map((t=>t.path))),o&&o(e,i,s)}))}getRes(t,e){return Hp.has(t)?Hp.get(t):zw.get(t,e)}getResCount(){return Hp.count}getDependsRecursively(t){if(!t)return[];const e="string"==typeof t?t:t._uuid;return rf.getDepsRecursively(e).concat([e])}get md5Pipe(){return Xx}get downloader(){return rx}get loader(){return jx.parser}addDownloadHandlers(t){const e=Object.create(null);for(const i in t){const s=t[i];e[`.${i}`]=(t,e,i)=>{s({url:t},i)}}rx.register(e)}addLoadHandlers(t){const e=Object.create(null);for(const i in t){const s=t[i];e[`.${i}`]=(t,e,i)=>{s({content:t},i)}}Ex.register(e)}release(t){if(Array.isArray(t))for(let e=0;e<t.length;e++){let i=t[e];"string"==typeof i&&(i=Hp.get(i)),jx.releaseAsset(i)}else t&&("string"==typeof t&&(t=Hp.get(t)),jx.releaseAsset(t))}releaseAsset(t){jx.releaseAsset(t)}releaseRes(t,e){zw.release(t,e)}releaseAll(){jx.releaseAll(),Hp.clear()}removeItem(t){return!!Hp.remove(t)}setAutoRelease(t,e){"object"==typeof t&&(t=t._uuid),this._autoReleaseSetting[t]=!!e}setAutoReleaseRecursively(t,e){"object"==typeof t&&(t=t._uuid),e=!!e,this._autoReleaseSetting[t]=e;const i=rf.getDepsRecursively(t);for(let t=0;t<i.length;t++)this._autoReleaseSetting[i[t]]=e}isAutoRelease(t){return"object"==typeof t&&(t=t._uuid),!!this._autoReleaseSetting[t]}}t("CCLoader",Yx);const qx=t("loader",new Yx),$x=t("AssetLibrary",{init(t){t.importBase=t.libraryPath,t.nativeBase=t.rawAssetsBase,jx.init(t),t.rawAssets&&zw.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:"resources",importBase:t.importBase,nativeBase:t.nativeBase,paths:t.rawAssets.assets,uuids:Object.keys(t.rawAssets.assets),extensionMap:{}})},loadAsset(t,e,i){jx.loadAny(t,e)}}),Kx=t("url",{});Q(Kx,"url",[{name:"normalize",target:jx.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:t=>t.startsWith("resources/")?cm({path:ra(t.substring(10)),bundle:"resources",__isNative__:!0,ext:ta(t)}):""}]),J($x,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),J(qx,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"loader.assetLoader was removed, assetLoader and md5Pipe were merged into assetManager.transformPipeline"}]),Q(a,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:()=>qx},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:()=>$x},{name:"Pipeline",target:Vx,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:()=>Kx}]),J(a,"cc",[{name:"LoadingItems",suggest:q(1400,"LoadingItems","AssetManager.Task")}]),Q(we,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:rx,targetName:"assetManager.downloader",newName:"maxConcurrency"}]);const Zx=xw._autoRelease;xw._autoRelease=function(t,e,i){Zx.call(xw,t,e,i);const s=qx._autoReleaseSetting,r=Object.keys(s);for(let t=0;t<r.length;t++){const e=r[t];if(!0===s[e]){const t=Hp.get(e);t&&xw.tryRelease(t)}}};const Qx=jsb.Texture2D,Jx=jsb.ImageAsset,tC=jsb.BuiltinResMgr,eC=tC.prototype;eC.init=function(){this._resources={},this._materialsToBeCompiled=[];const t=this._resources,e=new Uint8Array(16);for(let t=0;t<4;t++){const i=4*t;e[i]=0,e[i+1]=0,e[i+2]=0,e[i+3]=255}const i=new Jx({width:2,height:2,_data:e,_compressed:!1,format:ym.RGBA8888}),s=new Qx;if(s._uuid="black-texture",s.image=i,t[s._uuid]=s,a.SpriteFrame){const e=new a.SpriteFrame,s=i,r=new Qx;r.image=s,e.texture=r,e._uuid="default-spriteframe",t[e._uuid]=e}this.initBuiltinRes()},eC.get=function(t){return this._resources[t]||this.getAsset(t)},eC.compileBuiltinMaterial=function(){for(let t=0;t<this._materialsToBeCompiled.length;++t){const e=this._materialsToBeCompiled[t];for(let t=0;t<e.passes.length;++t)e.passes[t].tryCompile()}this._materialsToBeCompiled.length=0},eC.loadBuiltinAssets=function(){const t=Se.querySettings(ve.Category.ENGINE,"builtinAssets");if(!t)return Promise.resolve();const e=this._resources;return new Promise(((i,s)=>{jx.loadBundle(Qp.INTERNAL,(r=>{r?s(r):jx.loadAny(t,((t,r)=>{t?s(t):(r.forEach((t=>{e[t.name]=t,t.nativeUrl,xw.addIgnoredAsset(t),this.addAsset(t.name,t),t instanceof a.Material&&this._materialsToBeCompiled.push(t)})),i())}))}))}))};const iC=t("builtinResMgr",a.builtinResMgr=tC.getInstance()),sC=t("DirectorEvent",{INIT:"director_init",RESET:"director_reset",BEFORE_SCENE_LOADING:"director_before_scene_loading",BEFORE_SCENE_LAUNCH:"director_before_scene_launch",AFTER_SCENE_LAUNCH:"director_after_scene_launch",BEFORE_UPDATE:"director_before_update",AFTER_UPDATE:"director_after_update",BEFORE_DRAW:"director_before_draw",AFTER_DRAW:"director_after_draw",BEFORE_COMMIT:"director_before_commit",BEFORE_RENDER:"director_before_render",AFTER_RENDER:"director_after_render",BEFORE_PHYSICS:"director_before_physics",AFTER_PHYSICS:"director_after_physics",BEGIN_FRAME:"director_begin_frame",END_FRAME:"director_end_frame"});class rC extends zo{constructor(){super(),this._compScheduler=new NT,this._nodeActivator=new WT,this._invalid=!1,this._paused=!1,this._root=null,this._loadingScene="",this._scene=null,this._totalFrames=0,this._scheduler=new Uu,this._systems=[],this._persistRootNodes={}}end(){this.once("director_end_frame",(()=>{this.purgeDirector()}))}pause(){this._paused=!0}purgeDirector(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),Mo(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),jx.releaseAll()}reset(){this.purgeDirector();for(const t in this._persistRootNodes)this.removePersistRootNode(this._persistRootNodes[t]);const t=this.getScene();t&&t.destroy(),this.emit("director_reset"),this.startAnimation()}runSceneImmediate(t,e,i){t instanceof Tf&&(t=t.scene),X(t instanceof fT,1216),t._load();const s=Object.keys(this._persistRootNodes).map((t=>this._persistRootNodes[t]));for(let e=0;e<s.length;e++){const i=s[e];i.emit("scene-changed-for-persists",t.renderScene);const r=t.uuid===i._originalSceneId&&t.getChildByUuid(i.uuid);if(r){const e=r.siblingIndex;i.hideFlags&=-9,i.hideFlags|=8&r.hideFlags,r._destroyImmediate(),t.insertChild(i,e)}else i.hideFlags|=8,i.parent=t}const r=this._scene;Mo(r)&&r.destroy(),xw._autoRelease(r,t,this._persistRootNodes),this._scene=null,Do._deferredDestroy(),e&&e(),this.emit("director_before_scene_launch",t),this._scene=t,t._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),i&&i(null,t),this.emit("director_after_scene_launch",t)}runScene(t,e,i){t instanceof Tf&&(t=t.scene),X(Boolean(t),1205),X(t instanceof fT,1216),this.once("director_end_frame",(()=>{this.runSceneImmediate(t,e,i)}))}loadScene(t,e,i){if(this._loadingScene)return j(1208,t,this._loadingScene),!1;const s=jx.bundles.find((e=>!!e.getSceneInfo(t)));return s?(this.emit("director_before_scene_loading",t),this._loadingScene=t,console.time(`LoadScene ${t}`),s.loadScene(t,((s,r)=>{console.timeEnd(`LoadScene ${t}`),this._loadingScene="",s?(P(s),e&&e(s)):this.runSceneImmediate(r,i,e)})),!0):(G(1209,t),!1)}preloadScene(t,e,i){const s=jx.bundles.find((e=>!!e.getSceneInfo(t)));if(s)s.preloadScene(t,null,e,i);else{const e=`Can not preload the scene "${t}" because it is not in the build settings.`;i&&i(new Error(e)),P(`preloadScene: ${e}`)}}resume(){this._paused=!1}get root(){return this._root}getScene(){return this._scene}getDeltaTime(){return a.game.deltaTime}getTotalTime(){return a.game.totalTime}getCurrentTime(){return a.game.frameStartTime}getTotalFrames(){return this._totalFrames}isPaused(){return this._paused}getScheduler(){return this._scheduler}setScheduler(t){this._scheduler!==t&&(this.unregisterSystem(this._scheduler),this._scheduler=t,this.registerSystem(Uu.ID,t,200))}registerSystem(t,e,i){e.id=t,e.priority=i,this._systems.push(e),this._systems.sort(Bu.sortByPriority)}unregisterSystem(t){re(this._systems,t),this._systems.sort(Bu.sortByPriority)}getSystem(t){return this._systems.find((e=>e.id===t))}getAnimationManager(){return this.getSystem(a.AnimationManager.ID)}startAnimation(){this._invalid=!1}stopAnimation(){this._invalid=!0}mainLoop(t){let e;e=a.game._calculateDT(!1),this.tick(e)}tick(t){if(!this._invalid){if(this.emit("director_begin_frame"),Dy._frameDispatchEvents(),!this._paused){this.emit("director_before_update"),this._compScheduler.startPhase(),this._compScheduler.updatePhase(t);for(let e=0;e<this._systems.length;++e)this._systems[e].update(t);this._compScheduler.lateUpdatePhase(t),this.emit("director_after_update"),Do._deferredDestroy();for(let e=0;e<this._systems.length;++e)this._systems[e].postUpdate(t)}this.emit("director_before_draw"),pw.updateAllDirtyRenderers(),this._root.frameMove(t),this.emit("director_after_draw"),tb.resetHasChangedFlags(),tb.clearNodeArray(),bo.update(t),this.emit("director_end_frame"),this._totalFrames++}}buildRenderPipeline(){if(!this._root)return;const t=this._root.customPipeline,e=this._root.cameraList;t.beginSetup();const i=a.rendering.getCustomPipeline(we.CUSTOM_PIPELINE_NAME);a.rendering.dispatchResizeEvents(e,i,t),i.setup(e,t),t.endSetup()}setupRenderPipelineBuilder(){""!==we.CUSTOM_PIPELINE_NAME&&a.rendering&&this._root&&this._root.usesCustomPipeline&&this.on("director_before_scene_launch",a.rendering.forceResizeAllWindows,a.rendering)}init(){this._totalFrames=0,this._paused=!1,this.registerSystem(Uu.ID,this._scheduler,200),this._root=new Py(yp.gfxDevice),this._root.initialize({}),this.setupRenderPipelineBuilder();for(let t=0;t<this._systems.length;t++)this._systems[t].init();this.emit("director_init")}addPersistRootNode(t){if(!tb.isNode(t)||!t.uuid)return void j(3800);const e=t.uuid;if(!this._persistRootNodes[e]){const i=this._scene;if(Mo(i))if(t.parent){if(!(t.parent instanceof fT))return void j(3801);if(t.parent!==i)return void j(3802);t._originalSceneId=i.uuid}else t.parent=i,t._originalSceneId=i.uuid;this._persistRootNodes[e]=t,t._persistNode=!0,xw._addPersistNodeRef(t)}}removePersistRootNode(t){const e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1,t._originalSceneId="",xw._removePersistNodeRef(t))}isPersistRootNode(t){return!!t._persistNode}}t("Director",rC),rC.EVENT_INIT="director_init",rC.EVENT_RESET="director_reset",rC.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",rC.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",rC.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",rC.EVENT_BEFORE_UPDATE="director_before_update",rC.EVENT_AFTER_UPDATE="director_after_update",rC.EVENT_BEFORE_DRAW="director_before_draw",rC.EVENT_AFTER_DRAW="director_after_draw",rC.EVENT_BEFORE_COMMIT="director_before_commit",rC.EVENT_BEFORE_RENDER="director_before_render",rC.EVENT_AFTER_RENDER="director_after_render",rC.EVENT_BEFORE_PHYSICS="director_before_physics",rC.EVENT_AFTER_PHYSICS="director_after_physics",rC.EVENT_BEGIN_FRAME="director_begin_frame",rC.EVENT_END_FRAME="director_end_frame",rC.instance=void 0,a.Director=rC,a.DirectorEvent=sC;const nC=t("director",rC.instance=a.director=new rC),oC=void 0!==globalThis.jsb&&void 0!==jsb.window?jsb.window:window,aC=oC.document;function hC(){const t=aC.createElement("div");return{frame:aC.documentElement,canvas:oC.__canvas,container:t}}class lC{constructor(){this._rafHandle=0,this._onTick=null,this._targetFrameRate=60,this._isPlaying=!1,this._updateCallback=()=>{this._isPlaying&&(this._rafHandle=requestAnimationFrame(this._updateCallback)),this._onTick&&this._onTick()}}get targetFrameRate(){return this._targetFrameRate}set targetFrameRate(t){this._targetFrameRate!==t&&(this._targetFrameRate=t,jsb.setPreferredFramesPerSecond(this._targetFrameRate),this._isPlaying&&(this.stop(),this.start()))}set onTick(t){this._onTick=t}get onTick(){return this._onTick}start(){this._isPlaying||(this._rafHandle=requestAnimationFrame(this._updateCallback),this._isPlaying=!0)}stop(){this._isPlaying&&(cancelAnimationFrame(this._rafHandle),this._rafHandle=0,this._isPlaying=!1)}}var cC,uC,dC,_C,pC,mC,gC,fC,yC,bC,vC,SC,TC,wC;const xC={DEFAULT:100,UI:200};a.RenderPassStage=xC;const CC={bindings:[],layouts:{}},AC={bindings:[],layouts:{}},DC=new r_([4,0,7,0],[4,0,9,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,2,1,3]);class EC{}cC=EC,EC.TIME_OFFSET=0,EC.SCREEN_SIZE_OFFSET=4,EC.NATIVE_SIZE_OFFSET=8,EC.PROBE_INFO_OFFSET=12,EC.DEBUG_VIEW_MODE_OFFSET=16,EC.COUNT=20,EC.SIZE=80,EC.NAME="CCGlobal",EC.BINDING=0,EC.DESCRIPTOR=new L_(cC.BINDING,1,1,63),EC.LAYOUT=new g_(0,cC.BINDING,cC.NAME,[new m_("cc_time",16,1),new m_("cc_screenSize",16,1),new m_("cc_nativeSize",16,1),new m_("cc_probeInfo",16,1),new m_("cc_debug_view_mode",16,1)],1),CC.layouts[EC.NAME]=EC.LAYOUT,CC.bindings[EC.BINDING]=EC.DESCRIPTOR;class IC{}uC=IC,IC.MAT_VIEW_OFFSET=0,IC.MAT_VIEW_INV_OFFSET=16,IC.MAT_PROJ_OFFSET=32,IC.MAT_PROJ_INV_OFFSET=48,IC.MAT_VIEW_PROJ_OFFSET=64,IC.MAT_VIEW_PROJ_INV_OFFSET=80,IC.CAMERA_POS_OFFSET=96,IC.SURFACE_TRANSFORM_OFFSET=100,IC.SCREEN_SCALE_OFFSET=104,IC.EXPOSURE_OFFSET=108,IC.MAIN_LIT_DIR_OFFSET=112,IC.MAIN_LIT_COLOR_OFFSET=116,IC.AMBIENT_SKY_OFFSET=120,IC.AMBIENT_GROUND_OFFSET=124,IC.GLOBAL_FOG_COLOR_OFFSET=128,IC.GLOBAL_FOG_BASE_OFFSET=132,IC.GLOBAL_FOG_ADD_OFFSET=136,IC.NEAR_FAR_OFFSET=140,IC.VIEW_PORT_OFFSET=144,IC.COUNT=148,IC.SIZE=592,IC.NAME="CCCamera",IC.BINDING=1,IC.DESCRIPTOR=new L_(uC.BINDING,1,1,63),IC.LAYOUT=new g_(0,uC.BINDING,uC.NAME,[new m_("cc_matView",25,1),new m_("cc_matViewInv",25,1),new m_("cc_matProj",25,1),new m_("cc_matProjInv",25,1),new m_("cc_matViewProj",25,1),new m_("cc_matViewProjInv",25,1),new m_("cc_cameraPos",16,1),new m_("cc_surfaceTransform",16,1),new m_("cc_screenScale",16,1),new m_("cc_exposure",16,1),new m_("cc_mainLitDir",16,1),new m_("cc_mainLitColor",16,1),new m_("cc_ambientSky",16,1),new m_("cc_ambientGround",16,1),new m_("cc_fogColor",16,1),new m_("cc_fogBase",16,1),new m_("cc_fogAdd",16,1),new m_("cc_nearFar",16,1),new m_("cc_viewPort",16,1)],1),CC.layouts[IC.NAME]=IC.LAYOUT,CC.bindings[IC.BINDING]=IC.DESCRIPTOR;class MC{}dC=MC,MC.MAT_LIGHT_VIEW_OFFSET=0,MC.MAT_LIGHT_VIEW_PROJ_OFFSET=16,MC.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET=32,MC.SHADOW_PROJ_DEPTH_INFO_OFFSET=36,MC.SHADOW_PROJ_INFO_OFFSET=40,MC.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET=44,MC.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET=48,MC.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET=52,MC.SHADOW_COLOR_OFFSET=56,MC.PLANAR_NORMAL_DISTANCE_INFO_OFFSET=60,MC.COUNT=64,MC.SIZE=256,MC.NAME="CCShadow",MC.BINDING=2,MC.DESCRIPTOR=new L_(dC.BINDING,1,1,63),MC.LAYOUT=new g_(0,dC.BINDING,dC.NAME,[new m_("cc_matLightView",25,1),new m_("cc_matLightViewProj",25,1),new m_("cc_shadowInvProjDepthInfo",16,1),new m_("cc_shadowProjDepthInfo",16,1),new m_("cc_shadowProjInfo",16,1),new m_("cc_shadowNFLSInfo",16,1),new m_("cc_shadowWHPBInfo",16,1),new m_("cc_shadowLPNNInfo",16,1),new m_("cc_shadowColor",16,1),new m_("cc_planarNDInfo",16,1)],1),CC.layouts[MC.NAME]=MC.LAYOUT,CC.bindings[MC.BINDING]=MC.DESCRIPTOR;class PC{}_C=PC,PC.CSM_LEVEL_COUNT=4,PC.CSM_VIEW_DIR_0_OFFSET=0,PC.CSM_VIEW_DIR_1_OFFSET=16,PC.CSM_VIEW_DIR_2_OFFSET=32,PC.CSM_ATLAS_OFFSET=48,PC.MAT_CSM_VIEW_PROJ_OFFSET=64,PC.CSM_PROJ_DEPTH_INFO_OFFSET=128,PC.CSM_PROJ_INFO_OFFSET=144,PC.CSM_SPLITS_INFO_OFFSET=160,PC.COUNT=164,PC.SIZE=656,PC.NAME="CCCSM",PC.BINDING=3,PC.DESCRIPTOR=new L_(_C.BINDING,1,1,16),PC.LAYOUT=new g_(0,_C.BINDING,_C.NAME,[new m_("cc_csmViewDir0",16,_C.CSM_LEVEL_COUNT),new m_("cc_csmViewDir1",16,_C.CSM_LEVEL_COUNT),new m_("cc_csmViewDir2",16,_C.CSM_LEVEL_COUNT),new m_("cc_csmAtlas",16,_C.CSM_LEVEL_COUNT),new m_("cc_matCSMViewProj",25,_C.CSM_LEVEL_COUNT),new m_("cc_csmProjDepthInfo",16,_C.CSM_LEVEL_COUNT),new m_("cc_csmProjInfo",16,_C.CSM_LEVEL_COUNT),new m_("cc_csmSplitsInfo",16,1)],1),CC.layouts[PC.NAME]=PC.LAYOUT,CC.bindings[PC.BINDING]=PC.DESCRIPTOR;const OC="cc_shadowMap",RC=new L_(4,16,1,16),BC=new f_(0,4,OC,28,1);CC.layouts[OC]=BC,CC.bindings[4]=RC;const FC="cc_environment",NC=new L_(5,16,1,16),LC=new f_(0,5,FC,31,1);CC.layouts[FC]=LC,CC.bindings[5]=NC;const kC="cc_diffuseMap",zC=new L_(7,16,1,16),UC=new f_(0,7,kC,31,1);CC.layouts[kC]=UC,CC.bindings[7]=zC;const VC="cc_spotShadowMap",jC=new L_(6,16,1,16),HC=new f_(0,6,VC,28,1);CC.layouts[VC]=HC,CC.bindings[6]=jC;class GC{}pC=GC,GC.MAT_WORLD_OFFSET=0,GC.MAT_WORLD_IT_OFFSET=16,GC.LIGHTINGMAP_UVPARAM=32,GC.LOCAL_SHADOW_BIAS=36,GC.REFLECTION_PROBE_DATA1=40,GC.REFLECTION_PROBE_DATA2=44,GC.REFLECTION_PROBE_BLEND_DATA1=48,GC.REFLECTION_PROBE_BLEND_DATA2=52,GC.COUNT=56,GC.SIZE=224,GC.NAME="CCLocal",GC.BINDING=0,GC.DESCRIPTOR=new L_(0,1,1,49,1,1),GC.LAYOUT=new g_(2,0,pC.NAME,[new m_("cc_matWorld",25,1),new m_("cc_matWorldIT",25,1),new m_("cc_lightingMapUVParam",16,1),new m_("cc_localShadowBias",16,1),new m_("cc_reflectionProbeData1",16,1),new m_("cc_reflectionProbeData2",16,1),new m_("cc_reflectionProbeBlendData1",16,1),new m_("cc_reflectionProbeBlendData2",16,1)],1),AC.layouts[GC.NAME]=GC.LAYOUT,AC.bindings[0]=GC.DESCRIPTOR;class WC{}mC=WC,WC.WORLD_BOUND_CENTER=0,WC.WORLD_BOUND_HALF_EXTENTS=mC.WORLD_BOUND_CENTER+4,WC.COUNT=mC.WORLD_BOUND_HALF_EXTENTS+4,WC.SIZE=4*mC.COUNT,WC.NAME="CCWorldBound",WC.BINDING=0,WC.DESCRIPTOR=new L_(mC.BINDING,1,1,33,1,1),WC.LAYOUT=new g_(2,mC.BINDING,mC.NAME,[new m_("cc_worldBoundCenter",16,1),new m_("cc_worldBoundHalfExtents",16,1)],1),AC.layouts[WC.NAME]=WC.LAYOUT,AC.bindings[WC.BINDING]=WC.DESCRIPTOR;class XC{}gC=XC,XC.BATCHING_COUNT=10,XC.MAT_WORLDS_OFFSET=0,XC.COUNT=16*gC.BATCHING_COUNT,XC.SIZE=4*gC.COUNT,XC.NAME="CCLocalBatched",XC.BINDING=0,XC.DESCRIPTOR=new L_(gC.BINDING,1,1,33,1,1),XC.LAYOUT=new g_(2,gC.BINDING,gC.NAME,[new m_("cc_matWorlds",25,gC.BATCHING_COUNT)],1),AC.layouts[XC.NAME]=XC.LAYOUT,AC.bindings[XC.BINDING]=XC.DESCRIPTOR;class YC{}fC=YC,YC.LIGHTS_PER_PASS=1,YC.LIGHT_POS_OFFSET=0,YC.LIGHT_COLOR_OFFSET=4,YC.LIGHT_SIZE_RANGE_ANGLE_OFFSET=8,YC.LIGHT_DIR_OFFSET=12,YC.LIGHT_BOUNDING_SIZE_VS_OFFSET=16,YC.COUNT=20,YC.SIZE=80,YC.NAME="CCForwardLight",YC.BINDING=1,YC.DESCRIPTOR=new L_(fC.BINDING,2,1,16,1,1),YC.LAYOUT=new g_(2,fC.BINDING,fC.NAME,[new m_("cc_lightPos",16,1),new m_("cc_lightColor",16,1),new m_("cc_lightSizeRangeAngle",16,1),new m_("cc_lightDir",16,1),new m_("cc_lightBoundingSizeVS",16,1)],1),AC.layouts[YC.NAME]=YC.LAYOUT,AC.bindings[YC.BINDING]=YC.DESCRIPTOR;class qC{}qC.LIGHTS_PER_PASS=10;class $C{}yC=$C,$C.JOINTS_TEXTURE_INFO_OFFSET=0,$C.COUNT=yC.JOINTS_TEXTURE_INFO_OFFSET+4,$C.SIZE=4*yC.COUNT,$C.NAME="CCSkinningTexture",$C.BINDING=3,$C.DESCRIPTOR=new L_(yC.BINDING,1,1,1,1,1),$C.LAYOUT=new g_(2,yC.BINDING,yC.NAME,[new m_("cc_jointTextureInfo",16,1)],1),AC.layouts[$C.NAME]=$C.LAYOUT,AC.bindings[$C.BINDING]=$C.DESCRIPTOR;class KC{}bC=KC,KC.JOINTS_ANIM_INFO_OFFSET=0,KC.COUNT=bC.JOINTS_ANIM_INFO_OFFSET+4,KC.SIZE=4*bC.COUNT,KC.NAME="CCSkinningAnimation",KC.BINDING=2,KC.DESCRIPTOR=new L_(bC.BINDING,1,1,1,1,1),KC.LAYOUT=new g_(2,bC.BINDING,bC.NAME,[new m_("cc_jointAnimInfo",16,1)],1),AC.layouts[KC.NAME]=KC.LAYOUT,AC.bindings[KC.BINDING]=KC.DESCRIPTOR;class ZC{static get JOINT_UNIFORM_CAPACITY(){return ZC._jointUniformCapacity}static get COUNT(){return ZC._count}static get SIZE(){return ZC._size}static initLayout(t){ZC._jointUniformCapacity=t,ZC._count=12*t,ZC._size=4*ZC._count,ZC.LAYOUT.members[0].count=3*t}}vC=ZC,ZC._jointUniformCapacity=0,ZC._count=0,ZC._size=0,ZC.NAME="CCSkinning",ZC.BINDING=3,ZC.DESCRIPTOR=new L_(vC.BINDING,1,1,1,1,1),ZC.LAYOUT=new g_(2,vC.BINDING,vC.NAME,[new m_("cc_joints",16,1)],1);class QC{}SC=QC,QC.MAX_MORPH_TARGET_COUNT=60,QC.OFFSET_OF_WEIGHTS=0,QC.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=240,QC.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=244,QC.OFFSET_OF_VERTICES_COUNT=248,QC.COUNT_BASE_4_BYTES=64,QC.SIZE=256,QC.NAME="CCMorph",QC.BINDING=4,QC.DESCRIPTOR=new L_(SC.BINDING,1,1,1,1,1),QC.LAYOUT=new g_(2,SC.BINDING,SC.NAME,[new m_("cc_displacementWeights",16,15),new m_("cc_displacementTextureInfo",16,1)],1),AC.layouts[QC.NAME]=QC.LAYOUT,AC.bindings[QC.BINDING]=QC.DESCRIPTOR;class JC{constructor(){}}TC=JC,JC.NAME="CCUILocal",JC.BINDING=5,JC.DESCRIPTOR=new L_(TC.BINDING,2,1,1,1,1),JC.LAYOUT=new g_(2,TC.BINDING,TC.NAME,[new m_("cc_local_data",16,1)],1),AC.layouts[JC.NAME]=JC.LAYOUT,AC.bindings[JC.BINDING]=JC.DESCRIPTOR;class tA{}wC=tA,tA.SH_LINEAR_CONST_R_OFFSET=0,tA.SH_LINEAR_CONST_G_OFFSET=4,tA.SH_LINEAR_CONST_B_OFFSET=8,tA.SH_QUADRATIC_R_OFFSET=12,tA.SH_QUADRATIC_G_OFFSET=16,tA.SH_QUADRATIC_B_OFFSET=20,tA.SH_QUADRATIC_A_OFFSET=24,tA.COUNT=28,tA.SIZE=112,tA.NAME="CCSH",tA.BINDING=6,tA.DESCRIPTOR=new L_(6,1,1,16,1,1),tA.LAYOUT=new g_(2,6,wC.NAME,[new m_("cc_sh_linear_const_r",16,1),new m_("cc_sh_linear_const_g",16,1),new m_("cc_sh_linear_const_b",16,1),new m_("cc_sh_quadratic_r",16,1),new m_("cc_sh_quadratic_g",16,1),new m_("cc_sh_quadratic_b",16,1),new m_("cc_sh_quadratic_a",16,1)],1),AC.layouts[tA.NAME]=tA.LAYOUT,AC.bindings[6]=tA.DESCRIPTOR;const eA="cc_jointTexture",iA=new L_(7,16,1,1,1,4),sA=new f_(2,7,eA,28,1);AC.layouts[eA]=sA,AC.bindings[7]=iA;const rA="cc_realtimeJoint",nA=new L_(7,16,1,1,1,4),oA=new f_(2,7,rA,28,1);AC.layouts[rA]=oA,AC.bindings[7]=nA;const aA="cc_PositionDisplacements",hA=new L_(8,16,1,1,1,4),lA=new f_(2,8,aA,28,1);AC.layouts[aA]=lA,AC.bindings[8]=hA;const cA="cc_NormalDisplacements",uA=new L_(9,16,1,1,1,4),dA=new f_(2,9,cA,28,1);AC.layouts[cA]=dA,AC.bindings[9]=uA;const _A="cc_TangentDisplacements",pA=new L_(10,16,1,1,1,4),mA=new f_(2,10,_A,28,1);AC.layouts[_A]=mA,AC.bindings[10]=pA;const gA="cc_lightingMap",fA=new L_(11,16,1,16,1,4),yA=new f_(2,11,gA,28,1);AC.layouts[gA]=yA,AC.bindings[11]=fA;const bA="cc_spriteTexture",vA=new L_(12,16,1,16,1,4),SA=new f_(2,12,bA,28,1);AC.layouts[bA]=SA,AC.bindings[12]=vA;const TA="cc_reflectionProbeCubemap",wA=new L_(13,16,1,16,1,9),xA=new f_(2,13,TA,31,1);AC.layouts[TA]=xA,AC.bindings[13]=wA;const CA="cc_reflectionProbePlanarMap",AA=new L_(14,16,1,16,1,4),DA=new f_(2,14,CA,28,1);AC.layouts[CA]=DA,AC.bindings[14]=AA;const EA="cc_reflectionProbeDataMap",IA=new L_(15,16,1,16,1,4),MA=new f_(2,15,EA,28,1);AC.layouts[EA]=MA,AC.bindings[15]=IA;const PA=Hy.makeMaskExclude([Hy.BitMask.UI_2D,Hy.BitMask.GIZMOS,Hy.BitMask.EDITOR,Hy.BitMask.SCENE_GIZMO,Hy.BitMask.PROFILER]),OA=Hy.makeMaskExclude([Hy.BitMask.UI_2D,Hy.BitMask.PROFILER]),RA=Hy.Enum.ALL;let BA;function FA(t){return!(3&~t.getFormatFeatures(11)||6===t.gfxAPI)}function NA(){return!(!a.rendering||!a.rendering.enableEffectImport)}t("pipeline",Object.freeze({__proto__:null,CAMERA_DEFAULT_MASK:PA,CAMERA_EDITOR_MASK:OA,ENABLE_PROBE_BLEND:!1,INST_JOINT_ANIM_INFO:"a_jointAnimInfo",INST_MAT_WORLD:"a_matWorld0",INST_SH:"a_sh_linear_const_r",JOINT_UNIFORM_CAPACITY:30,MODEL_ALWAYS_MASK:RA,ModelLocalBindings:{UBO_LOCAL:0,UBO_FORWARD_LIGHTS:1,UBO_SKINNING_ANIMATION:2,UBO_SKINNING_TEXTURE:3,UBO_MORPH:4,UBO_UI_LOCAL:5,UBO_SH:6,SAMPLER_JOINTS:7,SAMPLER_MORPH_POSITION:8,SAMPLER_MORPH_NORMAL:9,SAMPLER_MORPH_TANGENT:10,SAMPLER_LIGHTMAP:11,SAMPLER_SPRITE:12,SAMPLER_REFLECTION_PROBE_CUBE:13,SAMPLER_REFLECTION_PROBE_PLANAR:14,SAMPLER_REFLECTION_PROBE_DATA_MAP:15,COUNT:16},PIPELINE_FLOW_FORWARD:"ForwardFlow",PIPELINE_FLOW_MAIN:"MainFlow",PIPELINE_FLOW_SHADOW:"ShadowFlow",PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",PipelineGlobalBindings:{UBO_GLOBAL:0,UBO_CAMERA:1,UBO_SHADOW:2,UBO_CSM:3,SAMPLER_SHADOWMAP:4,SAMPLER_ENVIRONMENT:5,SAMPLER_SPOT_SHADOW_MAP:6,SAMPLER_DIFFUSEMAP:7,COUNT:8},RenderPassStage:xC,RenderPriority:{MIN:0,MAX:255,DEFAULT:128},SetIndex:{GLOBAL:0,MATERIAL:1,LOCAL:2,COUNT:3},UBOCSM:PC,UBOCSMEnum:{CSM_LEVEL_COUNT:4,CSM_VIEW_DIR_0_OFFSET:0,CSM_VIEW_DIR_1_OFFSET:16,CSM_VIEW_DIR_2_OFFSET:32,CSM_ATLAS_OFFSET:48,MAT_CSM_VIEW_PROJ_OFFSET:64,CSM_PROJ_DEPTH_INFO_OFFSET:128,CSM_PROJ_INFO_OFFSET:144,CSM_SPLITS_INFO_OFFSET:160,COUNT:164,SIZE:656},UBOCamera:IC,UBOCameraEnum:{MAT_VIEW_OFFSET:0,MAT_VIEW_INV_OFFSET:16,MAT_PROJ_OFFSET:32,MAT_PROJ_INV_OFFSET:48,MAT_VIEW_PROJ_OFFSET:64,MAT_VIEW_PROJ_INV_OFFSET:80,CAMERA_POS_OFFSET:96,SURFACE_TRANSFORM_OFFSET:100,SCREEN_SCALE_OFFSET:104,EXPOSURE_OFFSET:108,MAIN_LIT_DIR_OFFSET:112,MAIN_LIT_COLOR_OFFSET:116,AMBIENT_SKY_OFFSET:120,AMBIENT_GROUND_OFFSET:124,GLOBAL_FOG_COLOR_OFFSET:128,GLOBAL_FOG_BASE_OFFSET:132,GLOBAL_FOG_ADD_OFFSET:136,NEAR_FAR_OFFSET:140,VIEW_PORT_OFFSET:144,COUNT:148,SIZE:592},UBODeferredLight:qC,UBOForwardLight:YC,UBOForwardLightEnum:{LIGHTS_PER_PASS:1,LIGHT_POS_OFFSET:0,LIGHT_COLOR_OFFSET:4,LIGHT_SIZE_RANGE_ANGLE_OFFSET:8,LIGHT_DIR_OFFSET:12,LIGHT_BOUNDING_SIZE_VS_OFFSET:16,COUNT:20,SIZE:80},UBOGlobal:EC,UBOGlobalEnum:{TIME_OFFSET:0,SCREEN_SIZE_OFFSET:4,NATIVE_SIZE_OFFSET:8,PROBE_INFO_OFFSET:12,DEBUG_VIEW_MODE_OFFSET:16,COUNT:20,SIZE:80},UBOLocal:GC,UBOLocalBatched:XC,UBOLocalEnum:{MAT_WORLD_OFFSET:0,MAT_WORLD_IT_OFFSET:16,LIGHTINGMAP_UVPARAM:32,LOCAL_SHADOW_BIAS:36,REFLECTION_PROBE_DATA1:40,REFLECTION_PROBE_DATA2:44,REFLECTION_PROBE_BLEND_DATA1:48,REFLECTION_PROBE_BLEND_DATA2:52,COUNT:56,SIZE:224,BINDING:0},UBOMorph:QC,UBOMorphEnum:{MAX_MORPH_TARGET_COUNT:60,OFFSET_OF_WEIGHTS:0,OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH:240,OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT:244,OFFSET_OF_VERTICES_COUNT:248,COUNT_BASE_4_BYTES:64,SIZE:256},UBOSH:tA,UBOSHEnum:{SH_LINEAR_CONST_R_OFFSET:0,SH_LINEAR_CONST_G_OFFSET:4,SH_LINEAR_CONST_B_OFFSET:8,SH_QUADRATIC_R_OFFSET:12,SH_QUADRATIC_G_OFFSET:16,SH_QUADRATIC_B_OFFSET:20,SH_QUADRATIC_A_OFFSET:24,COUNT:28,SIZE:112,BINDING:6},UBOShadow:MC,UBOShadowEnum:{MAT_LIGHT_VIEW_OFFSET:0,MAT_LIGHT_VIEW_PROJ_OFFSET:16,SHADOW_INV_PROJ_DEPTH_INFO_OFFSET:32,SHADOW_PROJ_DEPTH_INFO_OFFSET:36,SHADOW_PROJ_INFO_OFFSET:40,SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET:44,SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET:48,SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET:52,SHADOW_COLOR_OFFSET:56,PLANAR_NORMAL_DISTANCE_INFO_OFFSET:60,COUNT:64,SIZE:256},UBOSkinning:ZC,UBOSkinningAnimation:KC,UBOSkinningTexture:$C,UBOUILocal:JC,UBOWorldBound:WC,UNIFORM_DIFFUSEMAP_BINDING:7,UNIFORM_ENVIRONMENT_BINDING:5,UNIFORM_JOINT_TEXTURE_BINDING:7,UNIFORM_LIGHTMAP_TEXTURE_BINDING:11,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:9,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:8,UNIFORM_REALTIME_JOINT_TEXTURE_BINDING:7,UNIFORM_REFLECTION_PROBE_BLEND_CUBEMAP_BINDING:16,UNIFORM_REFLECTION_PROBE_CUBEMAP_BINDING:13,UNIFORM_REFLECTION_PROBE_DATA_MAP_BINDING:15,UNIFORM_REFLECTION_PROBE_TEXTURE_BINDING:14,UNIFORM_SHADOWMAP_BINDING:4,UNIFORM_SPOT_SHADOW_MAP_TEXTURE_BINDING:6,UNIFORM_SPRITE_TEXTURE_BINDING:12,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:10,bindingMappingInfo:DC,getDefaultShadowTexture:function(t){if(BA)return BA;const e=new d_(1,0,FA(t)?11:35,16,16,0,1,1,1,1);return BA=t.createTexture(e),BA},getPassPool:function(){return new So((()=>({priority:0,hash:0,depth:0,shaderId:0,subModel:null,passIdx:0})),64)},globalDescriptorSetLayout:CC,isEnableEffect:NA,localDescriptorSetLayout:AC,localDescriptorSetLayout_ResizeMaxJoints:function(t){ZC.initLayout(t),AC.layouts[ZC.NAME]=ZC.LAYOUT,AC.bindings[ZC.BINDING]=ZC.DESCRIPTOR},supportsR16HalfFloatTexture:function(t){return!(3&~t.getFormatFeatures(8))},supportsR32FloatTexture:FA,supportsRGBA16HalfFloatTexture:function(t){return!(3&~t.getFormatFeatures(41))},supportsRGBA32FloatTexture:function(t){return!(3&~t.getFormatFeatures(44))}}));const LA=t("getPhaseID",(()=>{const t=new Map;let e=0;return i=>"number"==typeof i?i:(t.has(i)||(t.set(i,1<<e),e++),t.get(i))})());t("PipelineInputAssemblerData",class{constructor(){this.quadIB=null,this.quadVB=null,this.quadIA=null}}),t("InstancedBuffer",nr.InstancedBuffer);const kA=t("PipelineStateManager",nr.PipelineStateManager);let zA=nr.PipelineStateManager.getOrCreatePipelineState;nr.PipelineStateManager.getOrCreatePipelineState=function(t,e,i,s,r){return zA(e,i,s,r)};const UA=jr(),VA={[we.ORIENTATION_AUTO]:Te.AUTO,[we.ORIENTATION_LANDSCAPE]:Te.LANDSCAPE,[we.ORIENTATION_PORTRAIT]:Te.PORTRAIT};class jA extends(ko(Bu)){constructor(){super(),this._designResolutionSize=jr(0,0),this._scaleX=1,this._scaleY=1,this._viewportRect=Xr(),this._visibleRect=Xr(),this._autoFullScreen=!1,this._retinaEnabled=!1,this._resizeCallback=null;const t=HA,e=GA;this._rpExactFit=new WA(t.EQUAL_TO_FRAME,e.EXACT_FIT),this._rpShowAll=new WA(t.EQUAL_TO_FRAME,e.SHOW_ALL),this._rpNoBorder=new WA(t.EQUAL_TO_FRAME,e.NO_BORDER),this._rpFixedHeight=new WA(t.EQUAL_TO_FRAME,e.FIXED_HEIGHT),this._rpFixedWidth=new WA(t.EQUAL_TO_FRAME,e.FIXED_WIDTH),this._resolutionPolicy=this._rpShowAll}init(){const t=ma.windowSize,e=t.width,i=t.height;this._designResolutionSize.width=e,this._designResolutionSize.height=i,this._viewportRect.width=e,this._viewportRect.height=i,this._visibleRect.width=e,this._visibleRect.height=i,UA.width=this._visibleRect.width,UA.height=this._visibleRect.height,fa.init(this._visibleRect);{this.resizeWithBrowserSize(!0);const t=Se.querySettings("screen","designResolution");t&&this.setDesignResolutionSize(Number(t.width),Number(t.height),t.policy||WA.FIXED_HEIGHT)}ma.on("window-resize",this._updateAdaptResult,this),ma.on("fullscreen-change",this._updateAdaptResult,this)}resizeWithBrowserSize(t){pa.handleResizeEvent=t}setResizeCallback(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)}setOrientation(t){pa.orientation=VA[t]}adjustViewportMeta(t){}enableRetina(t){this._retinaEnabled=!!t}isRetinaEnabled(){return this._retinaEnabled}enableAutoFullScreen(t){t!==this._autoFullScreen&&(this._autoFullScreen=t,t&&ma.requestFullScreen().catch((()=>{})))}isAutoFullScreenEnabled(){return this._autoFullScreen}setCanvasSize(t,e){pa.resolutionScale=1;const i=pa.devicePixelRatio,s=new Vr(t*i,e*i);ma.windowSize=s}getCanvasSize(){return ma.windowSize}getFrameSize(){const t=pa.devicePixelRatio,e=ma.windowSize;return e.width/=t,e.height/=t,e}setFrameSize(t,e){const i=pa.devicePixelRatio;ma.windowSize=new Vr(t*i,e*i)}getVisibleSize(){return new Vr(this._visibleRect.width,this._visibleRect.height)}getVisibleSizeInPixel(){return new Vr(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)}getVisibleOrigin(){return new kr(this._visibleRect.x,this._visibleRect.y)}getVisibleOriginInPixel(){return new kr(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)}getResolutionPolicy(){return this._resolutionPolicy}_updateResolutionPolicy(t){if(t instanceof WA)this._resolutionPolicy=t;else{const e=WA;t===e.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),t===e.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),t===e.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),t===e.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),t===e.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}}setResolutionPolicy(t){this._updateResolutionPolicy(t);const e=XA.getDesignResolutionSize();XA.setDesignResolutionSize(e.width,e.height,t)}setDesignResolutionSize(t,e,i){if(!(t>0&&e>0))return void G(2200);this._updateResolutionPolicy(i);const s=this._resolutionPolicy;s&&s.preApply(this),this._designResolutionSize.width=t,this._designResolutionSize.height=e;const r=s.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){const t=this._viewportRect,e=this._visibleRect,i=r.viewport;t.x=i.x,t.y=i.y,t.width=i.width,t.height=i.height,e.x=0,e.y=0,e.width=i.width/this._scaleX,e.height=i.height/this._scaleY}s.postApply(this),UA.width=this._visibleRect.width,UA.height=this._visibleRect.height,fa.init(this._visibleRect),this.emit("design-resolution-changed")}getDesignResolutionSize(){return new Vr(this._designResolutionSize.width,this._designResolutionSize.height)}setRealPixelResolution(t,e,i){this.setDesignResolutionSize(t,e,i)}getViewportRect(){return this._viewportRect}getScaleX(){return this._scaleX}getScaleY(){return this._scaleY}getDevicePixelRatio(){return pa.devicePixelRatio}convertToLocationInView(t,e,i,s=new kr){const r=pa.devicePixelRatio*(t-i.left),n=pa.devicePixelRatio*(i.top+i.height-e);return pa.isFrameRotated?(s.x=ma.windowSize.width-n,s.y=r):(s.x=r,s.y=n),s}_convertToUISpace(t){const e=this._viewportRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY}_updateAdaptResult(t,e,i){a.director.root.resize(t,e,void 0===i||0===i?1:i);const s=this._designResolutionSize,r=s.width,n=s.height;t>0&&e>0?this.setDesignResolutionSize(r,n,this._resolutionPolicy):O(!1,"_updateAdaptResult Invalid size."),this.emit("canvas-resize"),this._resizeCallback&&this._resizeCallback()}}t("View",jA),jA.instance=void 0;class HA{constructor(){this.name="ContainerStrategy"}preApply(t){}apply(t,e){}postApply(t){}_setupCanvas(){const t=a.game.canvas;if(t){const e=ma.windowSize;t.width!==e.width&&(t.width=e.width),t.height!==e.height&&(t.height=e.height)}}}HA.EQUAL_TO_FRAME=void 0,HA.PROPORTION_TO_FRAME=void 0;class GA{get strategy(){return this._strategy}constructor(){this.name="ContentStrategy",this._result={scale:[1,1],viewport:null},this._strategy=WA.UNKNOWN}preApply(t){}apply(t,e){return{scale:[1,1]}}postApply(t){}_buildResult(t,e,i,s,r,n){Math.abs(t-i)<2&&(i=t),Math.abs(e-s)<2&&(s=e);const o=new Wr(Math.round((t-i)/2),Math.round((e-s)/2),i,s),a=this._result;return a.scale=[r,n],a.viewport=o,a}}HA.EQUAL_TO_FRAME=new class extends HA{constructor(){super(),this.name="EqualToFrame"}apply(t,e){pa.isProportionalToFrame=!1,this._setupCanvas()}},HA.PROPORTION_TO_FRAME=new class extends HA{constructor(){super(),this.name="ProportionalToFrame"}apply(t,e){pa.isProportionalToFrame=!0,this._setupCanvas()}};class WA{constructor(t,e){this.name="ResolutionPolicy",this._containerStrategy=t,this._contentStrategy=e}get canvasSize(){return ma.windowSize}preApply(t){this._contentStrategy.preApply(t)}apply(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)}postApply(t){this._contentStrategy.postApply(t)}setContainerStrategy(t){this._containerStrategy=t}setContentStrategy(t){this._contentStrategy=t}getContentStrategy(){return this._contentStrategy}}t("ResolutionPolicy",WA),WA.EXACT_FIT=0,WA.NO_BORDER=1,WA.SHOW_ALL=2,WA.FIXED_HEIGHT=3,WA.FIXED_WIDTH=4,WA.UNKNOWN=5,WA.ContainerStrategy=HA,WA.ContentStrategy=GA,a.ResolutionPolicy=WA,GA.EXACT_FIT=new class extends GA{constructor(){super(),this.name="ExactFit",this._strategy=WA.EXACT_FIT}apply(t,e){const i=ma.windowSize,s=i.width,r=i.height,n=s/e.width,o=r/e.height;return this._buildResult(s,r,s,r,n,o)}},GA.SHOW_ALL=new class extends GA{constructor(){super(),this.name="ShowAll",this._strategy=WA.SHOW_ALL}apply(t,e){const i=ma.windowSize,s=i.width,r=i.height,n=e.width,o=e.height,a=s/n,h=r/o;let l,c,u=0;return a<h?(u=a,l=s,c=o*u):(u=h,l=n*u,c=r),this._buildResult(s,r,l,c,u,u)}},GA.NO_BORDER=new class extends GA{constructor(){super(),this.name="NoBorder",this._strategy=WA.NO_BORDER}apply(t,e){const i=ma.windowSize,s=i.width,r=i.height,n=e.width,o=e.height,a=s/n,h=r/o;let l,c,u;return a<h?(l=h,c=n*l,u=r):(l=a,c=s,u=o*l),this._buildResult(s,r,c,u,l,l)}},GA.FIXED_HEIGHT=new class extends GA{constructor(){super(),this.name="FixedHeight",this._strategy=WA.FIXED_HEIGHT}apply(t,e){const i=ma.windowSize,s=i.width,r=i.height,n=r/e.height,o=s,a=r;return this._buildResult(s,r,o,a,n,n)}},GA.FIXED_WIDTH=new class extends GA{constructor(){super(),this.name="FixedWidth",this._strategy=WA.FIXED_WIDTH}apply(t,e){const i=ma.windowSize,s=i.width,r=i.height,n=s/e.width,o=s,a=r;return this._buildResult(s,r,o,a,n,n)}};const XA=t("view",jA.instance=a.view=new jA);nC.registerSystem("view",XA,0),a.winSize=UA;const YA=new kr;function qA(t,e,i,s){t.setProperty(e,i,s)}class $A{get isFinished(){return this._curTime>=this.settings.totalTime}set curTime(t){this._curTime=t}get curTime(){return this._curTime}init(){var t,e,i,s,r,n,o;let h=WA.SHOW_ALL;{const t=Se.querySettings("screen","designResolution");null!==t&&(h=t.policy)}if(this.settings={policy:null!==(t=h)&&void 0!==t?t:WA.SHOW_ALL,displayRatio:null!==(e=Se.querySettings("splashScreen","displayRatio"))&&void 0!==e?e:.4,totalTime:null!==(i=Se.querySettings("splashScreen","totalTime"))&&void 0!==i?i:3e3,watermarkLocation:null!==(s=Se.querySettings("splashScreen","watermarkLocation"))&&void 0!==s?s:"default",autoFit:null===(r=Se.querySettings("splashScreen","autoFit"))||void 0===r||r,logo:null!==(n=Se.querySettings("splashScreen","logo"))&&void 0!==n?n:void 0,background:null!==(o=Se.querySettings("splashScreen","background"))&&void 0!==o?o:void 0},this._curTime=0,!(this.settings.totalTime<=0||void 0===this.settings.logo||void 0===this.settings.background)){this.device=a.director.root.device,this.swapchain=a.director.root.mainWindow.swapchain,this.preInit(),this.initLayout(),"default"===this.settings.logo.type&&this.initWaterMark();let t=Promise.resolve(),e=Promise.resolve();return"custom"===this.settings.background.type&&(t=new Promise(((t,e)=>{this.bgImage=new c.Image,this.bgImage.onload=()=>{this.initBG(),t()},this.bgImage.onerror=()=>{e()},this.bgImage.src=this.settings.background.base64}))),"none"!==this.settings.logo.type&&(e=new Promise(((t,e)=>{this.logoImage=new c.Image,this.logoImage.onload=()=>{this.initLogo(),t()},this.logoImage.onerror=()=>{e()},this.logoImage.src=this.settings.logo.base64}))),Promise.all([t,e])}return this.settings.totalTime=0,Promise.resolve([])}preInit(){var t;const e=null==(t=this.settings.background)?void 0:t.color;this.clearColors=e?[new i_(e.x,e.y,e.z,e.w)]:[new i_(0,0,0,1)];const{device:i,swapchain:s}=this,{capabilities:r}=i;this.renderArea=new qd(0,0,s.width,s.height),this.cmdBuff=i.commandBuffer;const n=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]);this.vertexBuffers=i.createBuffer(new a_(10,1,64,16)),this.vertexBuffers.update(n);const o=new Uint16Array([0,1,2,1,3,2]);this.indicesBuffers=i.createBuffer(new a_(6,1,12,2)),this.indicesBuffers.update(o);const a=[new x_("a_position",21),new x_("a_texCoord",21)],h=new A_(a,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=i.createInputAssembler(h),this.projection=new vr,vr.ortho(this.projection,-1,1,-1,1,-1,1,r.clipSpaceMinZ,r.clipSpaceSignY,s.surfaceTransform),this.isMobile=ga.isMobile}initLayout(){this.isMobile?(this.bgWidth=812,this.bgHeight=375,this.logoWidthTemp=70,this.logoHeightTemp=100,this.textSize=12,this.textHeight=this.textSize+this.textExpandSize,this.textXTrans=.5,this.textYExtraTrans=16):(this.bgWidth=1920,this.bgHeight=1080,this.logoWidthTemp=140,this.logoHeightTemp=200,this.textSize=24,this.textHeight=this.textSize+this.textExpandSize,this.textXTrans=.5,this.textYExtraTrans=32),this.logoXTrans=.5,this.logoYTrans=1/6+2.5/6,this.initScale()}initScale(){const t=this.swapchain.width,e=this.swapchain.height;let i=this.isMobile?375:1080,s=this.isMobile?812:1920;if(t>e){const t=s;s=i,i=t}this.scaleSize=t/e>16/9?e/s:t/i}update(t){const e=this.settings,{device:i,swapchain:s}=this,{capabilities:r}=i;vr.ortho(this.projection,-1,1,-1,1,-1,1,r.clipSpaceMinZ,r.clipSpaceSignY,s.surfaceTransform);const n=s.width,o=s.height;this.initScale(),this._curTime+=1e3*t;const a=ml(Bi(this._curTime/e.totalTime));let h=1,l=1;const c=this.bgImage;if("custom"===e.background.type){e.policy===WA.FIXED_WIDTH?(h=n,l=n/c.width*c.height):e.policy===WA.FIXED_HEIGHT?(h=o/c.height*c.width,l=o):e.policy===WA.SHOW_ALL?c.width/this.bgHeight>n/o?(h=n,l=n/c.width*c.height):(h=o/c.height*c.width,l=o):e.policy===WA.NO_BORDER?c.width/c.height>n/o?(h=o/c.height*c.width,l=o):(h=n,l=n/c.width*c.height):(h=n,l=o);const t=this.bgMat;qA(t,"resolution",YA.set(n,o),0),qA(t,"scale",YA.set(h,l),0),qA(t,"translate",YA.set(.5*n,.5*o),0),qA(t,"percent",1),qA(t,"u_projection",this.projection),t.passes[0].update()}const u=o*this.logoYTrans;if("none"!==this.settings.logo.type){l=.185*o*e.displayRatio,h=this.logoWidth*(.185*o/this.logoHeight)*e.displayRatio;const t=this.logoMat;qA(t,"resolution",YA.set(n,o),0),qA(t,"scale",YA.set(h,l),0),qA(t,"translate",YA.set(n*this.logoXTrans,u),0),qA(t,"percent",a),qA(t,"u_projection",this.projection),t.passes[0].update()}if("default"===this.settings.logo.type&&this.watermarkMat){const t=this.watermarkTexture.width,i=this.watermarkTexture.height;h=t,l=i;const s=u-(.5*this.logoHeight*e.displayRatio+this.textYExtraTrans)*this.scaleSize-.5*i,r=this.watermarkMat;qA(r,"resolution",YA.set(n,o),0),qA(r,"scale",YA.set(h,l),0),qA(r,"translate",YA.set(n*this.textXTrans,s),0),qA(r,"percent",a),qA(r,"u_projection",this.projection),r.passes[0].update()}this.frame()}initBG(){const t=this.device;this.bgMat=new fv,this.bgMat.initialize({effectName:"util/splash-screen"});const e=new p_;e.addressU=2,e.addressV=2,e.addressW=2,this.sampler=t.getSampler(e),this.bgTexture=t.createTexture(new d_(1,6,35,this.bgImage.width,this.bgImage.height));const i=this.bgMat.passes[0],s=i.getBinding("mainTexture");i.bindTexture(s,this.bgTexture),this.shader=i.getShaderVariant();const r=i.descriptorSet;r.bindSampler(s,this.sampler),r.update();const n=new t_,o=n.texExtent;o.width=this.bgImage.width,o.height=this.bgImage.height,o.depth=1,t.copyTexImagesToTexture([this.bgImage],this.bgTexture,[n])}initLogo(){const t=this.device;this.logoMat=new fv,this.logoMat.initialize({effectName:"util/splash-screen"});const e=new p_;e.addressU=2,e.addressV=2,e.addressW=2,this.sampler=t.getSampler(e),this.logoTexture=t.createTexture(new d_(1,6,35,this.logoImage.width,this.logoImage.height));const i=this.logoMat.passes[0],s=i.getBinding("mainTexture");i.bindTexture(s,this.logoTexture),this.shader=i.getShaderVariant();const r=i.descriptorSet;r.bindSampler(s,this.sampler),r.update();const n=new t_,o=n.texExtent;o.width=this.logoImage.width,o.height=this.logoImage.height,o.depth=1,t.copyTexImagesToTexture([this.logoImage],this.logoTexture,[n]);const a=this.logoImage.width/this.logoImage.height;a<1?(this.logoWidth=this.logoWidthTemp,this.logoHeight=this.logoWidthTemp/a):(this.logoWidth=this.logoHeightTemp*a,this.logoHeight=this.logoHeightTemp)}initWaterMark(){const t=c.document.createElement("canvas");t.height=this.textHeight*this.scaleSize,t.style.width=`${t.width}`,t.style.height=`${t.height}`;const e="Created with Cocos",i=t.getContext("2d");i.font=this.textSize*this.scaleSize+"px Arial",i.textBaseline="top",i.textAlign="center",i.fillStyle="#707070";const s=i.measureText(e).width+10;t.width=s,i.font=this.textSize*this.scaleSize+"px Arial",i.textBaseline="top",i.textAlign="center",i.fillStyle="#707070",i.fillText(e,t.width/2,0);const r=new t_,n=r.texExtent;n.width=t.width,n.height=t.height,n.depth=1,this.watermarkTexture=this.device.createTexture(new d_(1,6,35,t.width,t.height)),this.device.copyTexImagesToTexture([t],this.watermarkTexture,[r]),this.watermarkMat=new fv,this.watermarkMat.initialize({effectName:"util/splash-screen"});const o=this.watermarkMat.passes[0],a=o.getBinding("mainTexture");o.bindTexture(a,this.watermarkTexture),o.descriptorSet.update()}frame(){const{device:t,swapchain:e,projection:i,bgMat:s,logoMat:r,watermarkMat:n,settings:o,quadAssmebler:l}=this;if(!ga.isXR||xr.entry.isRenderAllowable()){const i=ga.isXR?2:1;for(let c=0;c<i;c++){t.enableAutoBarrier(!0),t.acquire([e]);const i=this.cmdBuff,c=a.director.root.mainWindow.framebuffer,u=this.renderArea;if(u.width=e.width,u.height=e.height,i.begin(),i.beginRenderPass(c.renderPass,c,u,this.clearColors,1,0),a.director.root.pipeline,"custom"===o.background.type){const e=s.passes[0],r=kA.getOrCreatePipelineState(t,e,this.shader,c.renderPass,l);i.bindPipelineState(r),i.bindDescriptorSet(1,e.descriptorSet),i.bindInputAssembler(l),i.draw(l)}if("none"!==o.logo.type){const e=r.passes[0],s=kA.getOrCreatePipelineState(t,e,this.shader,c.renderPass,l);i.bindPipelineState(s),i.bindDescriptorSet(1,e.descriptorSet),i.bindInputAssembler(l),i.draw(l)}if("default"===o.logo.type&&n){const e=this.watermarkMat.passes[0],s=kA.getOrCreatePipelineState(t,e,this.shader,c.renderPass,l);i.bindPipelineState(s),i.bindDescriptorSet(1,e.descriptorSet),i.bindInputAssembler(l),i.draw(l)}i.endRenderPass(),i.end(),t.flushCommands([i]),t.queue.submit([i]),t.present(),t.enableAutoBarrier(!h.rendering)}}}destroy(){this.device=null,this.swapchain=null,this.clearColors=null,this.bgImage&&(this.bgImage.destroy&&this.bgImage.destroy(),this.bgImage=null),this.bgMat&&(this.bgMat.destroy(),this.bgMat=null),this.bgTexture&&(this.bgTexture.destroy(),this.bgTexture=null),this.logoImage&&(this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null),this.logoMat&&(this.logoMat.destroy(),this.logoMat=null),this.logoTexture&&(this.logoTexture.destroy(),this.logoTexture=null),this.renderArea=null,this.cmdBuff=null,this.shader=null,this.quadAssmebler&&(this.quadAssmebler.destroy(),this.quadAssmebler=null),this.vertexBuffers&&(this.vertexBuffers.destroy(),this.vertexBuffers=null),this.indicesBuffers&&(this.indicesBuffers.destroy(),this.indicesBuffers=null),this.sampler=null,this.watermarkMat&&(this.watermarkMat.destroy(),this.watermarkMat=null),this.watermarkTexture&&(this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null}static get instance(){return $A._ins}static createInstance(){return $A._ins=new $A,$A._ins}static releaseInstance(){$A._ins&&($A._ins.destroy(),$A._ins=null)}constructor(){this.settings=void 0,this._curTime=0,this.device=void 0,this.swapchain=void 0,this.shader=void 0,this.sampler=void 0,this.cmdBuff=void 0,this.quadAssmebler=void 0,this.vertexBuffers=void 0,this.indicesBuffers=void 0,this.renderArea=void 0,this.clearColors=void 0,this.projection=void 0,this.isMobile=!1,this.bgMat=void 0,this.bgImage=void 0,this.bgTexture=void 0,this.logoMat=void 0,this.logoImage=void 0,this.logoTexture=void 0,this.watermarkMat=void 0,this.watermarkTexture=void 0,this.bgWidth=1920,this.bgHeight=1080,this.logoWidthTemp=140,this.logoHeightTemp=200,this.logoWidth=0,this.logoHeight=0,this.logoXTrans=.5,this.logoYTrans=1/6+2.5/6,this.textSize=24,this.textHeight=24,this.textXTrans=.5,this.textYExtraTrans=32,this.textExpandSize=4,this.scaleSize=1}}$A._ins=null,a.internal.SplashScreen=$A;const KA=new class{constructor(){this._data=null}init(t=""){return h.rendering&&h.rendering.enableEffectImport&&t?new Promise(((e,i)=>{if(t.startsWith("http")){const s=new XMLHttpRequest;s.open("GET",t),s.responseType="arraybuffer",s.onload=()=>{this._data=s.response,e()},s.onerror=()=>{i(new Error("request effect settings failed!"))},s.send(null)}else globalThis.fsUtils.readArrayBuffer(t,((t,s)=>{t?i(t):(this._data=s,e())}))})):Promise.resolve()}get data(){return this._data}};h.effectSettings=KA;const ZA=Se.querySettings.bind(Se);class QA extends zo{constructor(){super(),this.frame=null,this.container=null,this.canvas=null,this.renderType=-1,this.eventTargetOn=super.on,this.eventTargetOnce=super.once,this.config={},this.onStart=null,this.frameTime=1e3/60,this._isCloning=!1,this._inited=!1,this._engineInited=!1,this._rendererInitialized=!1,this._paused=!0,this._pausedByEngine=!1,this._frameRate=60,this._pacer=null,this._initTime=0,this._startTime=0,this._deltaTime=0,this._useFixedDeltaTime=!1,this._shouldLoadLaunchScene=!0,this.onPreBaseInitDelegate=new Uo,this.onPostBaseInitDelegate=new Uo,this.onPreInfrastructureInitDelegate=new Uo,this.onPostInfrastructureInitDelegate=new Uo,this.onPreSubsystemInitDelegate=new Uo,this.onPostSubsystemInitDelegate=new Uo,this.onPreProjectInitDelegate=new Uo,this.onPostProjectInitDelegate=new Uo}get inited(){return this._inited}get frameRate(){return this._frameRate}set frameRate(t){"number"!=typeof t&&(t=parseInt(t,10),Number.isNaN(t)&&(t=60)),this._frameRate=t,this.frameTime=1e3/t,this._pacer&&(this._pacer.targetFrameRate=this._frameRate)}get deltaTime(){return this._useFixedDeltaTime?this.frameTime/1e3:this._deltaTime}get totalTime(){return performance.now()-this._initTime}get frameStartTime(){return this._startTime}setFrameRate(t){this.frameRate=t}getFrameRate(){return this.frameRate}step(){nC.tick(this._calculateDT(!0))}pauseByEngine(){this._paused||(this._pausedByEngine=!0,this.pause())}resumeByEngine(){this._pausedByEngine&&(this.resume(),this._pausedByEngine=!1)}pause(){var t;this._paused||(this._paused=!0,null==(t=this._pacer)||t.stop(),this.emit(QA.EVENT_PAUSE))}resume(){var t;this._paused&&(Dy._clearEvents(),this._paused=!1,null==(t=this._pacer)||t.start(),this.emit(QA.EVENT_RESUME))}isPaused(){return this._paused}restart(){return new Promise((t=>{nC.once("director_end_frame",(()=>t()))})).then((()=>{nC.reset(),a.Object._deferredDestroy(),this.pause(),this.resume(),this._shouldLoadLaunchScene=!0})).then((()=>$A.createInstance().init())).then((()=>{this._safeEmit(QA.EVENT_RESTART)}))}end(){$o.close()}on(t,e,i,s){return this.canRegisterEvent(t)&&e.call(i),this.eventTargetOn(t,e,i,s)}once(t,e,i){return this.canRegisterEvent(t)?e.call(i):this.eventTargetOnce(t,e,i)}canRegisterEvent(t){return this._engineInited&&t===QA.EVENT_ENGINE_INITED||this._inited&&t===QA.EVENT_GAME_INITED||this._rendererInitialized&&t===QA.EVENT_RENDERER_INITED}init(t){return this._compatibleWithOldParams(t),Promise.resolve().then((()=>(this.emit(QA.EVENT_PRE_BASE_INIT),this.onPreBaseInitDelegate.dispatch()))).then((()=>{B(t.debugMode||0)})).then((()=>ga.init())).then((()=>{this._initEvents()})).then((()=>Se.init(t.settingsPath,t.overrideSettings))).then((()=>(this.emit(QA.EVENT_POST_BASE_INIT),this.onPostBaseInitDelegate.dispatch()))).then((()=>(this.emit(QA.EVENT_PRE_INFRASTRUCTURE_INIT),this.onPreInfrastructureInitDelegate.dispatch()))).then((()=>{we.init(),this._initXR();const t=hC();return this.canvas=t.canvas,this.frame=t.frame,this.container=t.container,ma.init(),Xu.init(),yp.init(this.canvas,DC)})).then((()=>{if(ZA("rendering","customPipeline")){if(!a.rendering)return void G(12109);we.CUSTOM_PIPELINE_NAME||(we.CUSTOM_PIPELINE_NAME="Builtin")}else a.rendering=void 0;jx.init(),iC.init(),Hy.init(),this.initPacer()})).then((()=>(this.emit(QA.EVENT_POST_INFRASTRUCTURE_INIT),this.onPostInfrastructureInitDelegate.dispatch()))).then((()=>(this.emit(QA.EVENT_PRE_SUBSYSTEM_INIT),this.onPreSubsystemInitDelegate.dispatch()))).then((()=>KA.init(ZA("rendering","effectSettingsPath")))).then((()=>{if(!a.rendering||!a.rendering.enableEffectImport)return;if(3===ZA("rendering","renderMode"))return void a.rendering.init(yp.gfxDevice,null);const t=KA.data;null!==t?a.rendering.init(yp.gfxDevice,t):G(1102)})).then((()=>{const t=ZA("scripting","scriptPackages");return t?Promise.all(t.map((t=>e.import(t)))):Promise.resolve([])})).then((()=>(nC.init(),iC.loadBuiltinAssets()))).then((()=>(this.emit(QA.EVENT_POST_SUBSYSTEM_INIT),this.onPostSubsystemInitDelegate.dispatch()))).then((()=>{I(`Cocos Creator v${l}`),this.emit(QA.EVENT_ENGINE_INITED),this._engineInited=!0})).then((()=>(this.emit(QA.EVENT_PRE_PROJECT_INIT),this.onPreProjectInitDelegate.dispatch()))).then((()=>{const t=ZA("plugins","jsList");let e=Promise.resolve();return t&&t.forEach((t=>{e=e.then((()=>{return e=`src/${t}`,window.oh&&"napi"===window.scriptEngineType?(window.oh.loadModule(e),Promise.resolve()):require(`${e}`);var e}))})),e})).then((()=>this._loadProjectBundles())).then((()=>this._loadCCEScripts())).then((()=>this._setupRenderPipeline())).then((()=>this._loadPreloadAssets())).then((()=>(iC.compileBuiltinMaterial(),$A.createInstance().init()))).then((()=>(this.emit(QA.EVENT_POST_PROJECT_INIT),this.onPostProjectInitDelegate.dispatch()))).then((()=>{this._inited=!0,this._safeEmit(QA.EVENT_GAME_INITED)}))}_initXR(){}_compatibleWithOldParams(t){const e=t.overrideSettings=t.overrideSettings||{};"showFPS"in t&&(e.profiling=e.profiling||{},e.profiling.showFPS=t.showFPS),"frameRate"in t&&(e.screen=e.screen||{},e.screen.frameRate=t.frameRate),"renderMode"in t&&(e.rendering=e.rendering||{},e.rendering.renderMode=t.renderMode),"renderPipeline"in t&&(e.rendering=e.rendering||{},e.rendering.renderPipeline=t.renderPipeline),"assetOptions"in t&&(e.assets=e.assets||{},Object.assign(e.assets,t.assetOptions)),"customJointTextureLayouts"in t&&(e.animation=e.animation||{},e.animation.customJointTextureLayouts=t.customJointTextureLayouts),"physics"in t&&(e.physics=e.physics||{},Object.assign(e.physics,t.physics)),"orientation"in t&&(e.screen=e.screen||{},e.screen.orientation=t.orientation),"exactFitScreen"in t&&(e.screen=e.screen||{},e.screen.exactFitScreen=t.exactFitScreen)}_loadPreloadAssets(){const t=ZA("assets","preloadAssets");return t?Promise.all(t.map((t=>new Promise(((e,i)=>{jx.loadAny(t,(t=>{t?i(t):e()}))}))))):Promise.resolve([])}_loadCCEScripts(){return new Promise((t=>{t()}))}_loadProjectBundles(){const t=ZA("assets","preloadBundles");return t?Promise.all(t.map((({bundle:t,version:e})=>new Promise(((i,s)=>{const r={};e&&(r.version=e),jx.loadBundle(t,r,(t=>{t?s(t):i()}))}))))):Promise.resolve([])}run(t){t&&(this.onStart=t),this._inited&&this.resume()}_calculateDT(t){if(this._useFixedDeltaTime=t,t)return this._startTime=performance.now(),this.frameTime/1e3;const e=performance.now();return this._deltaTime=e>this._startTime?(e-this._startTime)/1e3:0,this._deltaTime>QA.DEBUG_DT_THRESHOLD&&(this._deltaTime=this.frameTime/1e3),this._startTime=e,this._deltaTime}_updateCallback(){if(this._inited)if($A.instance&&!$A.instance.isFinished)$A.instance.update(this._calculateDT(!1));else if(this._shouldLoadLaunchScene){$A.releaseInstance(),this._shouldLoadLaunchScene=!1;const e=ZA("launch","launchScene");var t;e?nC.loadScene(e,(()=>{var t;k(1103,e),this._initTime=performance.now(),nC.startAnimation(),null==(t=this.onStart)||t.call(this)})):(this._initTime=performance.now(),nC.startAnimation(),null==(t=this.onStart)||t.call(this))}else nC.tick(this._calculateDT(!1))}initPacer(){var t;const e=null!==(t=ZA("screen","frameRate"))&&void 0!==t?t:60;O("number"==typeof e),this._pacer=new lC,this._pacer.onTick=this._updateCallback.bind(this),this.frameRate=e}_initEvents(){$o.on("show",this._onShow,this),$o.on("hide",this._onHide,this),$o.on("close",this._onClose,this)}_onHide(){this.emit(QA.EVENT_HIDE),this.pauseByEngine()}_onShow(){this.emit(QA.EVENT_SHOW),this.resumeByEngine()}_onClose(){this.emit(QA.EVENT_CLOSE),$o.exit()}addPersistRootNode(t){nC.addPersistRootNode(t)}removePersistRootNode(t){nC.removePersistRootNode(t)}isPersistRootNode(t){return nC.isPersistRootNode(t)}_setupRenderPipeline(){const t=ZA("rendering","customPipeline");return this._setRenderPipeline(!!t)}_setRenderPipeline(t){nC.root.setRenderPipeline(t)?(this._rendererInitialized=!0,this._safeEmit(QA.EVENT_RENDERER_INITED)):G(1222)}_safeEmit(t){this.emit(t)}}t("Game",QA),QA.EVENT_HIDE="game_on_hide",QA.EVENT_SHOW="game_on_show",QA.EVENT_LOW_MEMORY="game_on_low_memory",QA.EVENT_GAME_INITED="game_inited",QA.EVENT_ENGINE_INITED="engine_inited",QA.EVENT_RENDERER_INITED="renderer_inited",QA.EVENT_PRE_BASE_INIT="pre_base_init",QA.EVENT_POST_BASE_INIT="post_base_init",QA.EVENT_PRE_INFRASTRUCTURE_INIT="pre_infrastructure_init",QA.EVENT_POST_INFRASTRUCTURE_INIT="post_infrastructure_init",QA.EVENT_PRE_SUBSYSTEM_INIT="pre_subsystem_init",QA.EVENT_POST_SUBSYSTEM_INIT="post_subsystem_init",QA.EVENT_PRE_PROJECT_INIT="pre_project_init",QA.EVENT_POST_PROJECT_INIT="post_project_init",QA.EVENT_RESTART="game_on_restart",QA.EVENT_PAUSE="game_on_pause",QA.EVENT_RESUME="game_on_resume",QA.EVENT_CLOSE="game_on_close",QA.RENDER_TYPE_CANVAS=0,QA.RENDER_TYPE_WEBGL=1,QA.RENDER_TYPE_OPENGL=2,QA.RENDER_TYPE_HEADLESS=3,QA.DEBUG_DT_THRESHOLD=1,a.Game=QA;const JA=t("game",a.game=new QA);tt(rC.prototype,"director",[{name:"calculateDeltaTime"},{name:"getDeltaTime",suggest:"Use game.deltaTime instead"},{name:"getTotalTime",suggest:"Use game.totalTime instead"},{name:"getCurrentTime",suggest:"Use game.frameStartTime instead"}]),J(rC.prototype,"director",[{name:"setAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getRunningScene",suggest:"please use getScene instead"},{name:"setDepthTest",suggest:"please use camera API instead"},{name:"setClearColor",suggest:"please use camera API instead"},{name:"getWinSize",suggest:"please use view.getVisibleSize instead"},{name:"getWinSizeInPixels"},{name:"purgeCachedData",suggest:"please use assetManager.releaseAll instead"},{name:"convertToGL"},{name:"convertToUI"}]),Q(nC,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:t=>{var e;return jx.main?null==(e=jx.main.getSceneInfo(t))?void 0:e.uuid:""}}]),tt(JA,"game",[{name:"collisionMatrix"},{name:"groupList"}]),Q(JA,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:()=>{const t=[];return jx.main&&jx.main.config.scenes.forEach((e=>{t.push(e)})),t}}]);class tD extends Bu{constructor(){super(),this._atlases=[],this._atlasIndex=-1,this._maxAtlasCount=5,this._textureSize=2048,this._maxFrameSize=512,this._textureBleeding=!0,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){this._enabled!==t&&(t?(this.reset(),nC.on("director_before_scene_launch",this.beforeSceneLoad,this)):(this.reset(),nC.off("director_before_scene_launch",this.beforeSceneLoad,this)),this._enabled=t)}get maxAtlasCount(){return this._maxAtlasCount}set maxAtlasCount(t){this._maxAtlasCount=t}get atlasCount(){return this._atlases.length}get textureBleeding(){return this._textureBleeding}set textureBleeding(t){this._textureBleeding=t}get textureSize(){return this._textureSize}set textureSize(t){this._textureSize=t}get maxFrameSize(){return this._maxFrameSize}set maxFrameSize(t){this._maxFrameSize=t}newAtlas(){let t=this._atlases[++this._atlasIndex];return!t&&this._atlasIndex<this.maxAtlasCount&&(t=new vf(this._textureSize,this._textureSize),this._atlases.push(t)),t}beforeSceneLoad(){this.reset()}init(){this.enabled=!we.CLEANUP_IMAGE_CACHE}insertSpriteFrame(t){if(!this._enabled||this._atlasIndex>=this._maxAtlasCount||!t||t.original)return null;if(!t.packable)return null;const e=t.texture.getSamplerInfo();if(2!==e.minFilter||2!==e.magFilter||0!==e.mipFilter)return null;let i=this._atlases[this._atlasIndex];i||(i=this.newAtlas());const s=i?i.insertSpriteFrame(t):null;return!s&&this._atlasIndex<this._maxAtlasCount?(i=this.newAtlas(),i?i.insertSpriteFrame(t):null):s}reset(){for(let t=0,e=this._atlases.length;t<e;t++)this._atlases[t].destroy();this._atlases.length=0,this._atlasIndex=-1}deleteAtlasSpriteFrame(t){if(!t.original)return;let e;for(let i=this._atlases.length-1;i>=0;i--)e=this._atlases[i],e.removeSpriteFrame(t);const i=t.original._texture;this.deleteAtlasTexture(i)}deleteAtlasTexture(t){if(t)for(let e=this._atlases.length-1;e>=0;e--)this._atlases[e].deleteInnerTexture(t),this._atlases[e].isEmpty()&&(this._atlases[e].destroy(),this._atlases.splice(e,1),this._atlasIndex--)}packToDynamicAtlas(t,e){if(this._enabled&&e&&!e.original&&e.packable&&e.texture&&e.texture.width>0&&e.texture.height>0){const t=this.insertSpriteFrame(e);t&&e._setDynamicAtlasFrame(t)}}}t("DynamicAtlasManager",tD),tD.instance=void 0;const eD=t("dynamicAtlasManager",tD.instance=new tD);nC.registerSystem("dynamicAtlasManager",eD,0),a.internal.dynamicAtlasManager=eD;const iD={1:"Uint",2:"Int",3:"Uint",4:"Int",5:"Float",6:"Float",default:"Uint"};function sD(t){return`${iD[t.type]||iD.default}${t.size/t.count*8}`}function rD(t,e,i=11,s=0,r=0){const n=tp[i];r||(r=n.size);const o=`set${sD(n)}`,a=n.size/n.count,h=Math.floor(e.length/n.count),l=ga.isLittleEndian;for(let i=0;i<h;++i){const h=s+r*i;for(let s=0;s<n.count;++s){const r=h+a*s;t[o](r,e[n.count*i+s],l)}}}function nD(t,e=11,i=0,s=t.byteLength-i,r=0,n=[]){const o=tp[e];r||(r=o.size);const a=`get${sD(o)}`,h=o.size/o.count,l=Math.floor(s/r),c=ga.isLittleEndian;for(let e=0;e<l;++e){const s=i+r*e;for(let i=0;i<o.count;++i){const r=s+h*i;n[o.count*e+i]=t[a](r,c)}}return n}function oD(t,e,i=11,s=0,r=t.byteLength-s,n=0,o){o||(o=new DataView(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)));const a=tp[i];n||(n=a.size);const h=`set${sD(a)}`,l=`get${sD(a)}`,c=a.size/a.count,u=Math.floor(r/n),d=ga.isLittleEndian;for(let i=0;i<u;++i){const r=s+n*i;for(let i=0;i<a.count;++i){const s=r+c*i,n=t[l](s,d);o[h](s,e(n,i,t),d)}}return o}const aD={positions:"a_position",normals:"a_normal",uvs:"a_texCoord",colors:"a_color"},hD=jsb.MeshUtils,lD=hD.createMesh;hD.createDynamicMesh,a.MeshUtils=jsb.MeshUtils;var cD,uD,dD=Object.freeze({__proto__:null,MeshUtils:hD,createMesh:lD,find:vT,mapBuffer:oD,readBuffer:nD,readMesh:function(t,e=0){const i={positions:[]},s=new DataView(t.data.buffer,t.data.byteOffset,t.data.byteLength),r=t.struct,n=r.primitives[e];n.vertexBundelIndices.forEach((t=>{const e=r.vertexBundles[t];let n=e.view.offset;const{length:o,stride:a}=e.view;e.attributes.forEach((t=>{const e=aD[t.name];e&&(i[e]=(i[e]||[]).concat(nD(s,t.format,n,o,a))),n+=tp[t.format].size}))}));const o=n.indexView;return i.indices=nD(s,sd[`R${8*o.stride}UI`],o.offset,o.length),i},toPPM:function(t,e,i){return`P3 ${e} ${i} 255\n${t.filter(((t,e)=>e%4<3)).toString()}\n`},writeBuffer:rD});t("utils",dD);const _D=Ps(),pD=wr(),mD=Ms.transformMat4,gD=Ms.toArray,fD=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}];t("SpriteFrameEvent",{UV_UPDATED:"uv_updated"});let yD=t("SpriteFrame",ah("cc.SpriteFrame")((uD=class t extends fm{static createWithImage(e){const i=e instanceof Sm?e:new Sm(e),s=new ff;s.image=i;const r=new t;return r.texture=s,r}get insetTop(){return this._capInsets[1]}set insetTop(t){this._capInsets[1]!==t&&(this._capInsets[1]=t,this._texture&&this._calculateSlicedUV())}get insetBottom(){return this._capInsets[3]}set insetBottom(t){this._capInsets[3]!==t&&(this._capInsets[3]=t,this._texture&&this._calculateSlicedUV())}get insetLeft(){return this._capInsets[0]}set insetLeft(t){this._capInsets[0]!==t&&(this._capInsets[0]=t,this._texture&&this._calculateSlicedUV())}get insetRight(){return this._capInsets[2]}set insetRight(t){this._capInsets[2]!==t&&(this._capInsets[2]=t,this._texture&&this._calculateSlicedUV())}get rect(){return this._rect}set rect(t){this._rect.equals(t)||(this._rect.set(t),this._texture&&this._calculateUV(),this._calcTrimmedBorder())}get originalSize(){return this._originalSize}set originalSize(t){this._originalSize.equals(t)||(this._originalSize.set(t),this._texture&&this._calculateUV(),this._calcTrimmedBorder())}get offset(){return this._offset}set offset(t){this._offset.set(t),this._calcTrimmedBorder()}get rotated(){return this._rotated}set rotated(t){this._rotated!==t&&(this._rotated=t,this._texture&&this._calculateUV())}get texture(){return this._texture}set texture(t){t?t!==this._texture&&this.reset({texture:t},!0):j(3122,this.name)}get atlasUuid(){return this._atlasUuid}set atlasUuid(t){this._atlasUuid=t}get width(){return this._texture.width}get height(){return this._texture.height}set _textureSource(t){globalThis.Build?this._texture=t:t&&(this._refreshTexture(t),this._calculateUV())}get flipUVX(){return this._isFlipUVX}set flipUVX(t){this._isFlipUVX=t,this._calculateUV()}get flipUVY(){return this._isFlipUVY}set flipUVY(t){this._isFlipUVY=t,this._calculateUV()}get packable(){return this._packable}set packable(t){this._packable=t}get original(){return this._original}get pixelsToUnit(){return this._pixelsToUnit}get pivot(){return this._pivot}get mesh(){return this._mesh}get trimmedBorder(){return this._trimmedBorder}constructor(t){super(t),this.vertices=null,this.uv=[],this.unbiasUV=[],this.uvSliced=[],this._rect=Xr(),this._trimmedBorder=gs(),this._offset=zr(),this._originalSize=jr(),this._rotated=!1,this._capInsets=[0,0,0,0],this._atlasUuid="",this._texture=void 0,this._isFlipUVY=!1,this._isFlipUVX=!1,this._original=null,this._packable=!0,this._pixelsToUnit=100,this._pivot=zr(.5,.5),this._meshType=0,this._extrude=0,this._customOutLine=[],this._mesh=null,this._minPos=Ps(),this._maxPos=Ps()}textureLoaded(){return!!this.texture}isRotated(){return this._rotated}setRotated(t){this.rotated=t}getRect(t){return t?(t.set(this._rect),t):this._rect.clone()}setRect(t){this.rect=t}getOriginalSize(t){return t?(t.set(this._originalSize),t):this._originalSize.clone()}setOriginalSize(t){this.originalSize=t}getOffset(t){return t?(t.set(this._offset),t):this._offset.clone()}setOffset(t){this.offset=t}getGFXTexture(){return this._texture.getGFXTexture()}getGFXSampler(){return this._texture.getGFXSampler()}getHash(){return this._texture.getHash()}getSamplerInfo(){return this._texture.getSamplerInfo()}reset(t,e=!1){const i=this;let s=!1;if(e&&(i._originalSize.set(0,0),i._rect.set(0,0,0,0),i._offset.set(0,0),i._capInsets=[0,0,0,0],i._rotated=!1,s=!0),t){t.texture&&(i._rect.set(0,0,t.texture.width,t.texture.height),i._refreshTexture(t.texture),i.checkRect(i._texture)),t.originalSize&&i._originalSize.set(t.originalSize),t.rect&&i._rect.set(t.rect),t.offset&&i._offset.set(t.offset);const e=i._capInsets;void 0!==t.borderTop&&(e[1]=t.borderTop),void 0!==t.borderBottom&&(e[3]=t.borderBottom),void 0!==t.borderLeft&&(e[0]=t.borderLeft),void 0!==t.borderRight&&(e[2]=t.borderRight),void 0!==t.isRotate&&(i._rotated=!!t.isRotate),void 0!==t.isFlipUv&&(i._isFlipUVY=!!t.isFlipUv),s=!0}s&&i.texture&&i._calculateUV(),i._calcTrimmedBorder()}checkRect(t){const e=this._rect;let i=e.x,s=e.y;return this._rotated?(i+=e.height,s+=e.width):(i+=e.width,s+=e.height),i>t.width?(G(3300,`${this.name}/${t.name}`,i,t.width),!1):!(s>t.height&&(G(3301,`${this.name}/${t.name}`,s,t.height),1))}_calcTrimmedBorder(){const t=this,e=t._originalSize.width,i=t._originalSize.height,s=.5*(e-t._rect.width),r=.5*(i-t._rect.height),n=t._offset,o=t._trimmedBorder;o.x=n.x+s,o.y=n.x-s,o.z=n.y+r,o.w=n.y-r}ensureMeshData(){this._mesh||(this._initVertices(),this._createMesh())}destroy(){return this._packable&&eD&&eD.deleteAtlasSpriteFrame(this),super.destroy()}_calculateSlicedUV(){const t=this,e=t._rect,i=t.texture,s=t._capInsets,r=i.width,n=i.height,o=s[0],a=s[2],h=e.width-o-a,l=s[1],c=s[3],u=e.height-l-c,d=t.uvSliced;if(d.length=0,t._rotated){fD[0].u=e.x/r,fD[1].u=(e.x+c)/r,fD[2].u=(e.x+c+u)/r,fD[3].u=(e.x+e.height)/r,fD[3].v=e.y/n,fD[2].v=(e.y+o)/n,fD[1].v=(e.y+o+h)/n,fD[0].v=(e.y+e.width)/n;for(let t=0;t<4;++t){const e=fD[t];for(let t=0;t<4;++t){const i=fD[3-t];d.push({u:e.u,v:i.v})}}}else{fD[0].u=e.x/r,fD[1].u=(e.x+o)/r,fD[2].u=(e.x+o+h)/r,fD[3].u=(e.x+e.width)/r,fD[3].v=e.y/n,fD[2].v=(e.y+l)/n,fD[1].v=(e.y+l+u)/n,fD[0].v=(e.y+e.height)/n;for(let t=0;t<4;++t){const e=fD[t];for(let t=0;t<4;++t){const i=fD[t];d.push({u:i.u,v:e.v})}}}this.emit("uv_updated",this)}_calculateUV(){const t=ae,e=this,i=e._rect,s=e.uv,r=e.unbiasUV,n=e.texture,o=n.width,a=n.height;if(e._rotated){const n=0===o?0:i.x/o,h=0===o?1:(i.x+i.height)/o,l=0===a?0:i.y/a,c=0===a?1:(i.y+i.width)/a;e._isFlipUVX&&e._isFlipUVY?t(s,h,c,h,l,n,c,n,l):e._isFlipUVX?t(s,h,l,h,c,n,l,n,c):e._isFlipUVY?t(s,n,c,n,l,h,c,h,l):t(s,n,l,n,c,h,l,h,c);const u=0===o?0:i.x/o,d=0===o?1:(i.x+i.height)/o,_=0===a?0:i.y/a,p=0===a?1:(i.y+i.width)/a;e._isFlipUVX&&e._isFlipUVY?t(r,d,p,d,_,u,p,u,_):e._isFlipUVX?t(r,d,_,d,p,u,_,u,p):e._isFlipUVY?t(r,u,p,u,_,d,p,d,_):t(r,u,_,u,p,d,_,d,p)}else{const n=0===o?0:i.x/o,h=0===o?1:(i.x+i.width)/o,l=0===a?1:(i.y+i.height)/a,c=0===a?0:i.y/a;e._isFlipUVX&&e._isFlipUVY?t(s,h,c,n,c,h,l,n,l):e._isFlipUVX?t(s,h,l,n,l,h,c,n,c):e._isFlipUVY?t(s,n,c,h,c,n,l,h,l):t(s,n,l,h,l,n,c,h,c);const u=0===o?0:i.x/o,d=0===o?1:(i.x+i.width)/o,_=0===a?1:(i.y+i.height)/a,p=0===a?0:i.y/a;e._isFlipUVX&&e._isFlipUVY?t(r,d,p,u,p,d,_,u,_):e._isFlipUVX?t(r,d,_,u,_,d,p,u,p):e._isFlipUVY?t(r,u,p,d,p,u,_,d,_):t(r,u,_,d,_,u,p,d,p)}e._calculateSlicedUV()}_setDynamicAtlasFrame(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())}_resetDynamicAtlasFrame(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())}_checkPackable(){const t=eD;if(!t)return;const e=this._texture;if(!(e instanceof ff)||e.isCompressed)return void(this._packable=!1);const i=this.width,s=this.height;if(!e.image||i>t.maxFrameSize||s>t.maxFrameSize)return void(this._packable=!1);const r=c.HTMLCanvasElement;e.image&&e.image instanceof r&&(this._packable=!0)}_serialize(t){return null}_deserialize(t,e){const i=this,s=t,r=s.rect;r&&(i._rect=new Wr(r.x,r.y,r.width,r.height));const n=s.offset;s.offset&&(i._offset=zr(n.x,n.y));const o=s.originalSize;s.originalSize&&(i._originalSize=jr(o.width,o.height)),i._rotated=!!s.rotated,i._name=s.name,i._packable=!!s.packable,i._pixelsToUnit=s.pixelsToUnit;const a=s.pivot;a&&(i._pivot=zr(a.x,a.y)),i._meshType=s.meshType;const h=s.capInsets;if(h){const t=i._capInsets;t[0]=h[0],t[1]=h[1],t[2]=h[2],t[3]=h[3]}const l=s.vertices;if(l){i.vertices||(i.vertices={rawPosition:[],positions:[],indexes:l.indexes,uv:l.uv,nuv:l.nuv,minPos:Ps(l.minPos.x,l.minPos.y,l.minPos.z),maxPos:Ps(l.maxPos.x,l.maxPos.y,l.maxPos.z)}),i.vertices.rawPosition.length=0;const t=l.rawPosition;for(let e=0;e<t.length;e+=3)i.vertices.rawPosition.push(Ps(t[e],t[e+1],t[e+2]));i._updateMeshVertices()}}clone(){const e=this,i=new t,s=e.vertices;return i.vertices=s?{rawPosition:s.rawPosition.slice(0),positions:s.positions.slice(0),indexes:s.indexes.slice(0),uv:s.uv.slice(0),nuv:s.nuv.slice(0),minPos:s.minPos.clone(),maxPos:s.maxPos.clone()}:null,i.uv.splice(0,i.uv.length,...e.uv),i.unbiasUV.splice(0,i.unbiasUV.length,...e.unbiasUV),i.uvSliced.splice(0,i.uvSliced.length,...e.uvSliced),i._rect.set(e._rect),i._trimmedBorder.set(e._trimmedBorder),i._offset.set(e._offset),i._originalSize.set(e._originalSize),i._rotated=e._rotated,i._capInsets.splice(0,i._capInsets.length,...e._capInsets),i._atlasUuid=e._atlasUuid,i._texture=e._texture,i._isFlipUVX=e._isFlipUVX,i._isFlipUVY=e._isFlipUVY,e._original?i._original={_texture:e._original._texture,_x:e._original._x,_y:e._original._y}:i._original=null,i._packable=e._packable,i._pixelsToUnit=e._pixelsToUnit,i._pivot.set(e._pivot),i._meshType=e._meshType,i._extrude=e._extrude,i._customOutLine.splice(0,i._customOutLine.length,...e._customOutLine),i._minPos=e._minPos,i._maxPos=e._maxPos,e._mesh&&i._createMesh(),i}_refreshTexture(t){const e=this;e._texture=t;const i=e._texture,s={};let r=!1;0!==e._rect.width&&0!==e._rect.height&&e.checkRect(i)||(s.rect=Xr(0,0,i.width,i.height),r=!0),(0===e._originalSize.width||0===e._originalSize.height||r)&&(s.originalSize=jr(i.width,i.height),r=!0),r&&e.reset(s),e._checkPackable(),e._mesh&&e._updateMesh()}onLoaded(){this._calcTrimmedBorder()}initDefault(t){super.initDefault(t);const e=new ff;e.initDefault(),this._refreshTexture(e),this._calculateUV()}validate(){return this._texture&&this._rect&&0!==this._rect.width&&0!==this._rect.height}_initVertices(){const t=this;if(t.vertices){const e=t.vertices;e.rawPosition.length=0,e.positions.length=0,e.indexes.length=0,e.uv.length=0,e.nuv.length=0,e.minPos.set(0,0,0),e.maxPos.set(0,0,0)}else t.vertices={rawPosition:[],positions:[],indexes:[],uv:[],nuv:[],minPos:Ps(),maxPos:Ps()};const e=t.vertices;if(1===t._meshType);else{const i=t.texture,s=i.width,r=i.height,n=t.rect,o=n.width,a=n.height,h=n.x,l=r-n.y-a,c=o/2,u=a/2,d=0===s?0:h/s,_=0===s?1:(h+o)/s,p=0===r?1:(l+a)/r,m=0===r?0:l/r,g=e.uv,f=e.nuv,y=e.rawPosition,b=e.indexes;_D.set(-c,-u,0),y.push(_D.clone()),g.push(h,l+a),f.push(d,m),e.minPos.set(_D),_D.set(c,-u,0),y.push(_D.clone()),g.push(h+o,l+a),f.push(_,m),_D.set(-c,u,0),y.push(_D.clone()),g.push(h,l),f.push(d,p),_D.set(c,u,0),y.push(_D.clone()),g.push(h+o,l),f.push(_,p),e.maxPos.set(_D),b.push(0,1,2,2,1,3)}this._updateMeshVertices()}_updateMeshVertices(){pD.identity();const t=1/this._pixelsToUnit,e=Ps(-(this._pivot.x-.5)*this.rect.width*t,-(this._pivot.y-.5)*this.rect.height*t,0);pD.transform(e),e.set(t,t,1),pD.scale(e);const i=this.vertices;for(let t=0;t<i.rawPosition.length;t++){const s=i.rawPosition[t];mD(e,s,pD),gD(i.positions,e,3*t)}mD(this._minPos,i.minPos,pD),mD(this._maxPos,i.maxPos,pD)}_createMesh(){this._mesh=lD({primitiveMode:7,positions:this.vertices.positions,uvs:this.vertices.nuv,indices:this.vertices.indexes,minPos:this._minPos,maxPos:this._maxPos,attributes:[new x_("a_position",32),new x_("a_texCoord",21)]})}_updateMesh(){this._mesh&&this._mesh.destroy(),this._initVertices(),this._createMesh()}},uD.EVENT_UV_UPDATED="uv_updated",uD.MeshType={RECT:0,POLYGON:1},cD=uD))||cD);a.SpriteFrame=yD;const bD=jsb.RenderTexture.prototype,vD=jsb.TextureBase.prototype;bD.createNode=null;const SD=t("RenderTexture",jsb.RenderTexture);SD.Filter=vm,SD.PixelFormat=ym,SD.WrapMode=bm,bD._serialize=function(){return{}},bD._deserialize=function(t,e){const i=t;this._width=i.w,this._height=i.h,this._name=i.n,vD._deserialize.call(this,i.base,e)};const TD=bD.readPixels;bD.readPixels=function(t,e,i,s){t=t||0,e=e||0,i=i||this.width,s=s||this.height;let r=TD.call(this,t,e,i,s);return 0==r.length?null:r},a.RenderTexture=jsb.RenderTexture,function(t,e=dm){const{RenderTexture:i}={...t};e((()=>{ah("cc.RenderTexture")(i)}),"ccclass",null)}({RenderTexture:SD}),J(of.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),Q(SD.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction(){return this.window}}]);const wD=t("RenderingSubMesh",jsb.RenderingSubMesh),xD=wD.prototype;var CD,AD,DD;xD._ctor=function(t,e,i,s=null,r=null){jsb.Asset.prototype._ctor.apply(this,arguments),this._attributes=e,this._vertexBuffers=t,this._indexBuffer=s,this._indirectBuffer=r},Object.defineProperty(xD,"geometricInfo",{configurable:!0,enumerable:!0,get(){let t=this.getGeometricInfo();return t.positions||t.indices||(t.positions=new Float32Array,t.indices=new Uint8Array),t}}),Object.defineProperty(xD,"attributes",{configurable:!0,enumerable:!0,get(){return this._attributes||(this._attributes=this.getAttributes()),this._attributes}}),Object.defineProperty(xD,"vertexBuffers",{configurable:!0,enumerable:!0,get(){return this._vertexBuffers||(this._vertexBuffers=this.getVertexBuffers()),this._vertexBuffers}}),Object.defineProperty(xD,"indexBuffer",{configurable:!0,enumerable:!0,get(){return this._indexBuffer||(this._indexBuffer=this.getIndexBuffer()),this._indexBuffer}}),Object.defineProperty(xD,"indirectBuffer",{configurable:!0,enumerable:!0,get(){return this._indirectBuffer||(this._indirectBuffer=this.getIndexBuffer()),this._indirectBuffer}});let ED=t("SpriteAtlas",ah("cc.SpriteAtlas")((AD=class extends fm{constructor(t){super(t),this.spriteFrames=DD&&DD()}getTexture(){const t=Object.keys(this.spriteFrames);if(t.length>0){const e=this.spriteFrames[t[0]];return e&&e.texture}return null}getSpriteFrame(t){const e=this.spriteFrames[t];return e?(e.name||(e.name=t),e):null}getSpriteFrames(){const t=[],e=this.spriteFrames;for(const i in e)t.push(e[i]);return t}_serialize(t){return null}_deserialize(t,e){const i=t;this._name=i.name;const s=i.spriteFrames;this.spriteFrames=wt();for(let t=0;t<s.length;t+=2)e.result.push(this.spriteFrames,s[t],s[t+1],Qt(yD))}},DD=Za(AD.prototype,"spriteFrames",[vh],(function(){return wt()})),CD=AD))||CD);var ID;a.SpriteAtlas=ED;let MD=t("Font",ah("cc.Font")(ID=class extends fm{constructor(t){super(t)}})||ID);var PD,OD,RD;a.Font=MD;let BD=t("TTFFont",ah("cc.TTFFont")((OD=class extends MD{constructor(){super(),this._fontFamily=RD&&RD()}get _nativeAsset(){return this._fontFamily}set _nativeAsset(t){this._fontFamily=t||"Arial"}get _nativeDep(){return{uuid:this._uuid,__nativeName__:this._native,ext:ta(this._native),__isNative__:!0}}initDefault(t){this._fontFamily="Arial",super.initDefault(t)}},RD=Za(OD.prototype,"_fontFamily",[vh],(function(){return null})),s(OD.prototype,"_nativeAsset",[Yh,Wh],Object.getOwnPropertyDescriptor(OD.prototype,"_nativeAsset"),OD.prototype),s(OD.prototype,"_nativeDep",[Yh],Object.getOwnPropertyDescriptor(OD.prototype,"_nativeDep"),OD.prototype),PD=OD))||PD);a.TTFFont=BD;const FD={},ND=t("BASELINE_RATIO",.26);let LD=0;const kD=t("MIDDLE_RATIO",(ND+1)/2-ND);function zD(){return LD}const UD=new Jt(2);UD.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};class VD{constructor(t){this.count=0,this.limit=0,this.datas={},this.head=null,this.tail=null,this.limit=t}moveToHead(t){t.next=this.head,t.prev=null,this.head&&(this.head.prev=t),this.head=t,this.tail||(this.tail=t),this.count++,this.datas[t.key]=t}put(t,e){const i=UD.get();if(i.key=t,i.value=e,this.count>=this.limit){const t=this.tail;delete this.datas[t.key],this.count--,this.tail=t.prev,this.tail.next=null,t.prev=null,t.next=null,UD.put(t)}this.moveToHead(i)}remove(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--}get(t){const e=this.datas[t];return e?(this.remove(e),this.moveToHead(e),e.value):null}clear(){this.count=0,this.datas={},this.head=null,this.tail=null}has(t){return!!this.datas[t]}delete(t){const e=this.datas[t];this.remove(e)}}t("LRUCache",VD);const jD=new VD(100),HD=/([a-zA-Z0-9--]+|\S)/,GD=/^[!,.:;'}\]%\?>]/,WD="[a-zA-Z0-9--iI]",XD=new RegExp(`(${WD}+|\\S)$`),YD=new RegExp(`${WD}+$`),qD=new RegExp(`^${WD}`);function $D(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)}function KD(t){const e=t.charCodeAt(0);return e>=9&&e<=13||32===e||133===e||160===e||5760===e||e>=8192&&e<=8202||8232===e||8233===e||8239===e||8287===e||12288===e}function ZD(t,e,i){const s=`${i||t.font}${e}`,r=jD.get(s);if(null!==r)return r;const n=t.measureText(e),o=n&&n.width||0;return jD.put(s,o),o}function QD(t){const e=t.length;let i=0,s=0;for(let r=0;r<e;r++)s=t.charCodeAt(r),8205!==s&&(s>=55296&&s<=56319&&(s=t.charCodeAt(r+1),s>=56320&&s<=57343)?((r+2>=e||8205!==t.charCodeAt(r+2))&&i++,r++):i++);return i}function JD(t,e){const i=t.length;let s=0,r=0,n=0,o=0;for(let a=0;a<i;a++)if(o=t.charCodeAt(a),8205!==o)if(o>=55296&&o<=56319&&(s++,o=t.charCodeAt(a+1),o>=56320&&o<=57343)){if(s++,a+2>=i||8205!==t.charCodeAt(a+2)){if(e===r)return t.slice(n,n+s);n+=s,r++,s=0}a++}else{if(e===r)return t.charAt(a);n=a+1,r++,s=0}else s++;return""}function tE(t,e){const i=JD(t,e);if(1===i.length)return`${i.charCodeAt(0)}`;let s="";for(let t=0;t<i.length;t++)s+=`${i.charCodeAt(t)}`;return`${s}`}function eE(t,e){if(e>=t.length)return t.length;let i=e,s=t[i];for(;i>=0&&(""===s&&(i--,s=t[i]),s>="\udc00"&&s<="\udfff"&&i-1>=0&&(i--,s=t[i]),s>="\ud800"&&s<="\udbff")&&i-1>=0&&""===t[i-1];)i--,s=t[i];return i}function iE(t,e){let i=e,s=e,r=t[s];for(;s<t.length;)if(""===r&&(s++,i++,r=t[s],r>="\ud800"&&r<="\udbff"&&(s++,i++,r=t[s])),r>="\ud800"&&r<="\udbff")s++,i++,r=t[s];else{if(!(r>="\udc00"&&r<="\udfff"))break;if(s++,r=t[s],!(s<t.length&&""===t[s]))break;i++,r=t[s]}return i}function sE(t,e,i){let s=eE(t,e);s<e&&(s=iE(t,e)+1);let r=i;if(void 0!==i){r=iE(t,i=Math.max(0,i-1));const n=eE(t,i);n<s||n===s&&e>s?r=s:r+=1}return t.substring(s,r)}function rE(t){return qD.exec(t)}function nE(t){return YD.exec(t)}function oE(t,e,i,s){const r=[];if(0===t.length||i<0)return r.push(""),r;let n=t;for(;e>i&&n.length>1;){let t=n.length*(i/e)|0,o=sE(n,t),a=e-s(o),h=o,l=0,c=0;const u=100;for(;a>i&&c++<u;)t*=i/a,t|=0,o=sE(n,t),a=e-s(o);for(c=0;o&&a<=i&&c++<u;){const i=HD.exec(o);l=i?i[0].length:1,h=o,t+=l,o=sE(n,t),a=e-s(o)}t-=l,0===t?(t=1,h=sE(n,1)):1===t&&n[0]>="\ud800"&&n[0]<="\udbff"&&(t=2,h=sE(n,2));let d,_=sE(n,0,t);GD.test(h||o)&&(d=XD.exec(_),t-=d?d[0].length:0,0===t&&(t=1),h=sE(n,t),_=sE(n,0,t)),qD.test(h)&&(d=YD.exec(_),d&&_!==d[0]&&(t-=d[0].length,h=sE(n,t),_=sE(n,0,t))),0===r.length?r.push(_):(_=_.trim(),_.length>0&&r.push(_)),n=h||o,e=s(n)}return 0===r.length?r.push(n):(n=n.trim(),n.length>0&&r.push(n)),r}const aE=c.document;let hE=null,lE=-1;const cE="BES bswy:->@123",uE=Object.create(null),dE=[],_E=3e3,pE=(()=>{let t;return()=>{if(void 0===t)if("FontFace"in c){const e=/Gecko.*Firefox\/(\d+)/.exec(c.navigator.userAgent),i=/OS X.*Version\/10\..*Safari/.exec(c.navigator.userAgent)&&/Apple/.exec(c.navigator.vendor);t=e?parseInt(e[1],10)>42:!i}else t=!1;return t}})();function mE(){let t=!0;const e=Date.now();for(let i=dE.length-1;i>=0;i--){const s=dE[i],r=s.fontFamilyName;if(e-s.startTime>_E){j(4933,r),s.onComplete(null,r),dE.splice(i,1);continue}const n=s.refWidth,o=`40px ${r}`;hE.font=o,n!==ZD(hE,cE,o)?(dE.splice(i,1),s.onComplete(null,r)):t=!1}t&&(clearInterval(lE),lE=-1)}function gE(t,e,i){const s=new Promise(((i,s)=>{const r=()=>{Date.now()-t>=_E?s():aE.fonts.load(`40px ${e}`).then((t=>{t.length>=1?i():setTimeout(r,100)}),(()=>{s()}))};r()}));let r=null;const n=new Promise(((t,e)=>{r=setTimeout(e,_E)}));Promise.race([n,s]).then((()=>{r&&(clearTimeout(r),r=null),i(null,e)}),(()=>{j(4933,e),i(null,e)}))}function fE(t,e,i){const s=yE(t);if(uE[s])return void i(null,s);if(!hE){const t=aE.createElement("canvas");t.width=100,t.height=100,hE=t.getContext("2d")}const r=`40px ${s}`,n=aE.createElement("style");n.type="text/css";let o="";Number.isNaN(s)?o+=`@font-face { font-family:${s}; src:`:o+=`@font-face { font-family:"${s}"; src:`,o+=`url("${t}");`,n.textContent=`${o}}`,aE.body.appendChild(n);const a=aE.createElement("div"),h=a.style;if(h.fontFamily=s,a.innerHTML=".",h.position="absolute",h.left="-100px",h.top="-100px",aE.body.appendChild(a),pE())gE(Date.now(),s,i);else{const t={fontFamilyName:s,refWidth:ZD(hE,cE,r),onComplete:i,startTime:Date.now()};dE.push(t),-1===lE&&(lE=setInterval(mE,100))}uE[s]=n}function yE(t){const e=t.lastIndexOf(".ttf");if(-1===e)return t;const i=t.lastIndexOf("/");let s;return s=-1===i?`${t.substring(0,e)}_LABEL`:`${t.substring(i+1,e)}_LABEL`,-1!==s.indexOf(" ")&&(s=`"${s}"`),s}function bE(t,e,i,s){const r=new BD;r._nativeUrl=t,r._nativeAsset=e,s(null,r)}rx.register({".font":fE,".eot":fE,".ttf":fE,".woff":fE,".svg":fE,".ttc":fE}),fx.register({".font":bE,".eot":bE,".ttf":bE,".woff":bE,".svg":bE,".ttc":bE});const vE=/^(click)(\s)*=|(param)(\s)*=/,SE=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;class TE{constructor(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}parse(t){this._resultObjectArray.length=0,this._stack.length=0;let e=0;const i=t.length;for(;e<i;){let s=t.indexOf(">",e),r=-1;if(s>=0&&(r=t.lastIndexOf("<",s),r<e-1&&(r=t.indexOf("<",s+1),s=t.indexOf(">",r+1))),r<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{let i=t.substring(e,r);const n=t.substring(r+1,s);""===n&&(i=t.substring(e,s+1)),this._processResult(i),-1===s?s=r:"/"===t.charAt(r+1)?this._stack.pop():this._addToStack(n),e=s+1}}return this._resultObjectArray}_attributeToObject(t){t=t.trim();const e={};let i=/^(color|size)(\s)*=/.exec(t),s="",r=0,n="";if(i){if(s=i[0],""===(t=t.substring(s.length).trim()))return e;switch(r=t.indexOf(" "),s[0]){case"c":e.color=r>-1?t.substring(0,r).trim():t;break;case"s":e.size=parseInt(t)}return r>-1&&(n=t.substring(r+1).trim(),e.event=this._processEventHandler(n)),e}if(i=/^(br(\s)*\/)/.exec(t),i&&i[0].length>0&&(s=i[0].trim(),s.startsWith("br")&&"/"===s[s.length-1]))return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;i=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t);let o="",a=-1;if(i&&i[0].length>0&&(s=i[0].trim(),s.startsWith("img")&&"/"===s[s.length-1])){let n;i=SE.exec(t);let h=!1;for(;i;){s=(t=t.substring(t.indexOf(i[0]))).substring(0,i[0].length);const l=s.length;if(s=s.replace(/[^a-zA-Z]/g,"").trim(),s=s.toLowerCase(),o=t.substring(l).trim(),a="src"===s?this.getRightQuotationIndex(o):-1,r=o.indexOf(" ",a+1>=o.length?-1:a+1),n=r>-1?o.substring(0,r):o,t=o.substring(r).trim(),n.endsWith("/")&&(n=n.slice(0,-1)),"src"===s){switch(n.charCodeAt(0)){case 34:case 39:h=!0,n=n.slice(1,-1)}e.isImage=!0,e.src=n}else if("height"===s)e.imageHeight=parseInt(n);else if("width"===s)e.imageWidth=parseInt(n);else if("align"===s){switch(n.charCodeAt(0)){case 34:case 39:n=n.slice(1,-1)}e.imageAlign=n.toLowerCase()}else"offset"===s?e.imageOffset=n:"click"===s&&(e.event=this._processEventHandler(`${s}=${n}`));e.event&&"param"===s&&(e.event[s]=n.replace(/^"|"$/g,"")),i=SE.exec(t)}return h&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(i=/^(outline(\s)*[^>]*)/.exec(t),i){const n={color:"#ffffff",width:1};if(t=i[0].substring(7).trim()){const a=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;let h;for(i=a.exec(t);i;)s=(t=t.substring(t.indexOf(i[0]))).substring(0,i[0].length),o=t.substring(s.length).trim(),r=o.indexOf(" "),h=r>-1?o.substring(0,r):o,s=s.replace(/[^a-zA-Z]/g,"").trim(),s=s.toLowerCase(),t=o.substring(r).trim(),"click"===s?e.event=this._processEventHandler(`${s}=${h}`):"color"===s?n.color=h:"width"===s&&(n.width=parseInt(h)),e.event&&"param"===s&&(e.event[s]=h.replace(/^"|"$/g,"")),i=a.exec(t)}e.outline=n}if(i=/^(on|u|b|i)(\s)*/.exec(t),i&&i[0].length>0){switch(s=i[0],t=t.substring(s.length).trim(),s[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e}getRightQuotationIndex(t){let e=-1,i=-1;const s=t.indexOf("'"),r=t.indexOf('"'),n=r>-1&&(r<s||-1===s);return s>-1&&(s<r||-1===r)?(e=s,i=t.indexOf("'",e+1>=t.length?-1:e+1)):n&&(e=r,i=t.indexOf('"',e+1>=t.length?-1:e+1)),i}_processEventHandler(t){const e={};let i=0,s=!1,r=vE.exec(t);for(;r;){let n=r[0],o="";if(s=!1,'"'===(t=t.substring(n.length).trim()).charAt(0))i=t.indexOf('"',1),i>-1&&(o=t.substring(1,i).trim(),s=!0),i++;else if("'"===t.charAt(0))i=t.indexOf("'",1),i>-1&&(o=t.substring(1,i).trim(),s=!0),i++;else{const e=/(\S)+/.exec(t);o=e?e[0]:"",i=o.length}s&&(n=n.substring(0,n.length-1).trim(),e[n]=o),t=t.substring(i).trim(),r=vE.exec(t)}return e}_addToStack(t){const e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;const t=this._stack[this._stack.length-1];for(const i in t)e[i]||(e[i]=t[i]);this._stack.push(e)}}_processResult(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))}_escapeSpecialSymbol(t){for(const e of this._specialSymbolArray){const i=e[0],s=e[1];t=t.replace(i,s)}return t}}var wE,xE,CE,AE,DE,EE,IE,ME;t("HtmlTextParser",TE);class PE{constructor(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0}}class OE{constructor(t){this.letterDefinitions={},this._texture=null,this.texture=t}set texture(t){const e=this._texture;e!==t&&(e&&(e.decRef(!1),e.refCount<=0&&e.destroy()),t&&t.addRef(),this._texture=t)}get texture(){return this._texture}addLetterDefinitions(t,e){this.letterDefinitions[t]=e}cloneLetterDefinition(){const t={};for(const e in this.letterDefinitions){const i=new PE;Ft(i,this.letterDefinitions[e]),t[e]=i}return t}getTexture(){return this._texture}getLetter(t){return this.letterDefinitions[t]}getLetterDefinitionForChar(t,e){const i=tE(t,0);let s=null;return Object.prototype.hasOwnProperty.call(this.letterDefinitions,i)&&(s=this.letterDefinitions[i]),s}clear(){this.letterDefinitions={}}}let RE=t("BitmapFont",(wE=ah("cc.BitmapFont"),xE=Xh(yD),wE((AE=class extends MD{constructor(){super(),this.fntDataStr=DE&&DE(),this.spriteFrame=EE&&EE(),this.fontSize=IE&&IE(),this.fntConfig=ME&&ME()}onLoaded(){const t=this.spriteFrame;!this.fontDefDictionary&&t&&(this.fontDefDictionary=new OE(t.texture));const e=this.fntConfig;if(!e)return void j(16376);const i=e.fontDefDictionary;for(const t in i){const e=i[t],s=new PE,r=e.rect;s.offsetX=e.xOffset,s.offsetY=e.yOffset,s.w=r.width,s.h=r.height,s.u=r.x,s.v=r.y,s.valid=!0,s.xAdvance=e.xAdvance,this.fontDefDictionary.addLetterDefinitions(t,s)}}},DE=Za(AE.prototype,"fntDataStr",[vh],(function(){return""})),EE=Za(AE.prototype,"spriteFrame",[xE],(function(){return null})),IE=Za(AE.prototype,"fontSize",[vh],(function(){return-1})),ME=Za(AE.prototype,"fntConfig",[vh],(function(){return null})),CE=AE))||CE));var BE;a.BitmapFont=RE;let FE,NE=t("LabelAtlas",ah("cc.LabelAtlas")(BE=class extends RE{})||BE);a.LabelAtlas=NE;class LE{static getInstance(){return FE||(FE=new LE),FE}constructor(){this.pool=[]}get(){let t=this.pool.pop();if(!t){const e=c.document.createElement("canvas"),i=e.getContext("2d");t={canvas:e,context:i}}return t}put(t){if(this.pool.length>=we.MAX_LABEL_CANVAS_POOL_SIZE){const e=t.canvas;e&&e._destroy&&e._destroy(),t.canvas=null,t.context=null}else this.pool.push(t)}}const kE=Ls.WHITE.clone(),zE=`rgba(255, 255, 255, ${(1/255).toFixed(3)})`,UE=zD();class VE{constructor(t,e){this.image=null,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.char=t,this.labelInfo=e,this.hash=`${tE(t,0)}${e.hash}`}updateRenderData(){this._updateProperties(),this._updateTexture()}destroy(){this.image=null,LE.getInstance().put(this.data),this.data=null}_updateProperties(){if(this.data=LE.getInstance().get(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){const t=this.labelInfo.fontScale;this.context.font=this.labelInfo.fontDesc;const e=ZD(this.context,this.char,this.labelInfo.fontDesc),i=2*this.labelInfo.margin+2;this.width=parseFloat(e.toFixed(2))*t+i,this.height=(1+ND)*this.labelInfo.fontSize*t+i,this.offsetY=-this.labelInfo.fontSize*ND*t/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new Sm),this.image.reset(this.canvas)}_updateTexture(){if(!this.context||!this.canvas)return;const t=this.context,e=this.labelInfo,i=this.canvas.width,s=this.canvas.height,r=e.fontScale;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,i,s),t.fillStyle=zE,t.fillRect(0,0,i,s),t.font=e.fontDesc.replace(/(\d+)(\.\d+)?(px|em|rem|pt)/g,((t,e,i,s)=>(+e*r+(+i||0)*r).toString()+s));const n=e.fontSize*r,o=i/2,a=s/2+n*kD+n*UE,h=e.color;if(t.lineJoin="round",t.fillStyle=`rgba(${h.r}, ${h.g}, ${h.b}, 1)`,e.isOutlined){const i=e.out||kE;t.strokeStyle=`rgba(${i.r}, ${i.g}, ${i.b}, ${i.a/255})`,t.lineWidth=2*e.margin*r,t.strokeText(this.char,o,a)}t.fillText(this.char,o,a)}}class jE extends ff{initWithSize(t,e,i=35){this.reset({width:t,height:e,format:i})}drawTextureAt(t,e,i){const s=this.getGFXTexture();if(!t||!s)return;const r=this._getGFXDevice();if(!r)return void j(16363);const n=new t_;n.texOffset.x=e,n.texOffset.y=i,n.texExtent.width=t.width,n.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],s,[n])}}class HE{get width(){return this._width}get height(){return this._height}constructor(t,e){this._x=0,this._y=0,this._nextY=0,this._width=0,this._height=0,this._halfBleed=0,this._dirty=!1;const i=new jE;i.initWithSize(t,e),this.fontDefDictionary=new OE(i),this._halfBleed=1,this._width=t,this._height=e,nC.on("director_before_scene_launch",this.beforeSceneLoad,this)}insertLetterTexture(t){const e=t.image,i=nC.root.device;if(!e||!this.fontDefDictionary||!i)return null;const s=e.width,r=e.height;if(this._x+s+0>this._width&&(this._x=0,this._y=this._nextY),this._y+r>this._nextY&&(this._nextY=this._y+r+0),this._nextY>this._height)return j(12100),null;if(!this.fontDefDictionary.texture)return null;this.fontDefDictionary.texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;const n=new PE;return n.u=this._x+this._halfBleed,n.v=this._y+this._halfBleed,n.valid=!0,n.w=t.width-2,n.h=t.height-2,n.xAdvance=n.w,n.offsetY=t.offsetY,this._x+=s+0,this.fontDefDictionary.addLetterDefinitions(t.hash,n),n}update(){this._dirty&&(this._dirty=!1)}reset(){this._x=0,this._y=0,this._nextY=0,this.fontDefDictionary.clear()}destroy(){this.reset();const t=this.fontDefDictionary;t&&t.texture&&(t.texture=null)}getTexture(){return this.fontDefDictionary.getTexture()}beforeSceneLoad(){this.clearAllCache()}clearAllCache(){this.destroy();const t=new jE;t.initWithSize(this._width,this._height),this.fontDefDictionary.texture=t}getLetter(t){return this.fontDefDictionary.letterDefinitions[t]}getLetterDefinitionForChar(t,e){const i=tE(t,0)+e.hash;let s=this.fontDefDictionary.letterDefinitions[i];if(!s){const i=new VE(t,e);i.updateRenderData(),s=this.insertLetterTexture(i),i.destroy()}return s}}const GE={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:Ls.WHITE.clone(),isOutlined:!1,out:Ls.WHITE.clone(),margin:0,fontScale:1};function WE(t){const e=t.color.toHEX();let i="";return t.isOutlined&&t.margin>0&&(i=i+t.margin+t.out.toHEX()),""+t.fontSize+t.fontFamily+e+i}const XE="a_position",YE="a_color",qE="a_texCoord",$E="a_color2",KE=[new x_(XE,32)],ZE=[new x_(XE,32),new x_(YE,44)],QE=[new x_(XE,32),new x_(qE,21),new x_(YE,44)],JE=[new x_(XE,32),new x_(qE,21),new x_(YE,35,!0)],tI=[new x_(XE,32),new x_(qE,21),new x_(YE,44),new x_($E,44)],eI=[new x_(XE,32),new x_(qE,21),new x_(YE,35,!0),new x_($E,35,!0)];function iI(t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];e+=tp[s.format].count}return e}function sI(t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];e+=tp[s.format].size}return e}a.internal.vfmtPosUvColor=QE,a.internal.vfmtPosUvTwoColor=tI,a.internal.vfmtPosUvColor4B=JE,a.internal.vfmtPosUvTwoColor4B=eI,t("UIVertexFormat",Object.freeze({__proto__:null,getAttributeStride:sI,getComponentPerVertex:iI,vfmt:KE,vfmtPosColor:ZE,vfmtPosUvColor:QE,vfmtPosUvColor4B:JE,vfmtPosUvTwoColor:tI,vfmtPosUvTwoColor4B:eI}));const rI=n2d.RenderDrawInfo;n2d.Batcher2d;const nI=n2d.UIMeshBuffer,oI=n2d.RenderEntity,aI=n2d.UIModelProxy;n2d.StencilManager;class hI{get attributes(){return this._attributes}get vertexFormatBytes(){return this._vertexFormatBytes}get byteOffset(){return this._byteOffset}set byteOffset(t){this._byteOffset=t,this._sharedBuffer[0]=t}get vertexOffset(){return this._vertexOffset}set vertexOffset(t){this._vertexOffset=t,this._sharedBuffer[1]=t}get indexOffset(){return this._indexOffset}set indexOffset(t){this._indexOffset=t,this._sharedBuffer[2]=t}get dirty(){return this._dirty}set dirty(t){this._dirty=t,this._sharedBuffer[3]=t?1:0}get floatsPerVertex(){return this._floatsPerVertex}set floatsPerVertex(t){this._floatsPerVertex=t}get vData(){return this._vData}set vData(t){this._vData=t,this._nativeObj.vData=t}get iData(){return this._iData}set iData(t){this._iData=t,this._nativeObj.iData=t}get nativeObj(){return this._nativeObj}get sharedBuffer(){return this._sharedBuffer}initSharedBuffer(){this._sharedBuffer=new Uint32Array(4)}syncSharedBufferToNative(){this._nativeObj.syncSharedBufferToNative(this._sharedBuffer)}constructor(){this._byteOffset=0,this._vertexOffset=0,this._indexOffset=0,this._dirty=!1,this._floatsPerVertex=0,this._vData=null,this._iData=null,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=0,this._attributes=null,this._iaPool=[],this._iaInfo=null,this._nextFreeIAHandle=0,this._nativeObj=new nI,this.initSharedBuffer(),this.syncSharedBufferToNative()}initialize(t,e,i,s){this._initVDataCount=i,this._initIDataCount=s,this._attributes=e,this.floatsPerVertex=sI(e)>>2,this._initVDataCount,this._floatsPerVertex,q(9005),this.vData&&this.iData||(this.vData=new Float32Array(this._initVDataCount),this.iData=new Uint16Array(this._initIDataCount)),this._iaPool.push(this.createNewIA(t)),this._nativeObj.initialize(e)}reset(){this._nextFreeIAHandle=0,this.dirty=!1}destroy(){this.reset(),this._attributes=null,this._iaInfo=null,this.vData=null,this.iData=null;for(let t=0;t<this._iaPool.length;++t){const e=this._iaPool[t],i=e.vertexBuffers[0];i&&i.destroy();const s=e.indexBuffer;s&&s.destroy(),e.ia.destroy()}this._iaPool.length=0}setDirty(){this.dirty=!0}request(t,e){return j(9002),!1}requireFreeIA(t){return this._iaPool.length<=this._nextFreeIAHandle&&this._iaPool.push(this.createNewIA(t)),this._iaPool[this._nextFreeIAHandle++].ia}recycleIA(t){const e=this._iaPool;for(let i=0;i<this._nextFreeIAHandle;++i)if(t===e[i].ia){const t=e[i];return e[i]=e[--this._nextFreeIAHandle],void(e[this._nextFreeIAHandle]=t)}}checkCapacity(t,e){const i=(this.vertexOffset+t)*this._floatsPerVertex,s=this.indexOffset+e;return!(i>this._initVDataCount||s>this._initIDataCount)}uploadBuffers(){if(0===this.byteOffset||!this._dirty)return;const t=ga.__isWebIOS14OrIPadOS14Env,e=t?this._nextFreeIAHandle:1;if(t&&e/this._iaPool.length<.5){const t=e/.5;for(let e=this._iaPool.length-1;e>=t;e--){const t=this._iaPool[e];t.vertexBuffers[0]&&t.vertexBuffers[0].destroy(),t.indexBuffer&&t.indexBuffer.destroy(),t.ia.destroy()}this._iaPool.length=t}const i=this.byteOffset,s=this.indexOffset;for(let t=0;t<e;++t){const e=this._iaPool[t],r=new Float32Array(this.vData.buffer,0,i>>2),n=new Uint16Array(this.iData.buffer,0,s),o=e.vertexBuffers[0];i>o.size&&o.resize(i),o.update(r),2*s>e.indexBuffer.size&&e.indexBuffer.resize(2*s),e.indexBuffer.update(n)}this.dirty=!1}createNewIA(t){let e,i,s;if(ga.__isWebIOS14OrIPadOS14Env||!this._iaPool[0]){const r=this._vertexFormatBytes=4*this._floatsPerVertex,n=2,o=t.createBuffer(new a_(10,3,r,r));s=t.createBuffer(new a_(6,3,n,n)),i=[o],this._iaInfo=new A_(this._attributes,i,s),e=t.createInputAssembler(this._iaInfo)}else e=t.createInputAssembler(this._iaInfo),i=this._iaInfo.vertexBuffers,s=this._iaInfo.indexBuffer;return{ia:e,vertexBuffers:i,indexBuffer:s}}}t("MeshBuffer",hI);class lI{get attributes(){return this._attributes}get vertexFormatBytes(){return this._vertexFormatBytes}get floatsPerVertex(){return this._floatsPerVertex}constructor(t,e){this._buffers=[],this._device=t,this._attributes=e,this._floatsPerVertex=sI(e)>>2,this._vertexFormatBytes=4*this._floatsPerVertex}initialize(){}reset(){}request(t=4,e=6){}appendBuffers(t,e){}uploadBuffers(){}destroy(){this._attributes.length=0}}const cI=new vo((()=>({offset:0,length:0})),32);class uI{get ib(){return this._ib}constructor(t,e,i,s,r,n){this.vertexAccessor=t,this.bufferId=e,this.meshBuffer=i,this.vertexOffset=s,this.vb=r,this.indexCount=n,this._ib=new Uint16Array(n),t.getMeshBuffer(e)}setIndexBuffer(t){t.length,this.ib.length;for(let e=0;e<t.length;++e){const i=t[e];this._ib[e]=this.vertexOffset+i}}}class dI extends lI{get id(){return this._id}constructor(t,e,i,s){super(t,e),this._freeLists=[],this._vCount=0,this._iCount=0,this._id=0,this._vCount=i||Math.floor(1024*we.BATCHER2D_MEM_INCREMENT/this._vertexFormatBytes),this._iCount=s||this._vCount*dI.IB_SCALE,this._id=dI.generateID(),this._allocateBuffer()}destroy(){for(let t=0;t<this._buffers.length;++t){this._buffers[t].destroy();const e=this._freeLists[t];for(let t=0;t<e.length;++t)cI.free(e[t])}this._buffers.length=0,this._freeLists.length=0,super.destroy()}reset(){for(let t=0;t<this._buffers.length;++t){const e=this._buffers[t];e.indexOffset=0,e.reset()}}getVertexBuffer(t){return this._buffers[t].vData}getIndexBuffer(t){return this._buffers[t].iData}getMeshBuffer(t){return this._buffers[t]}uploadBuffers(){for(let t=0;t<this._buffers.length;++t){const e=this._freeLists[t][0],i=this._buffers[t];(!e||e.length<i.vData.byteLength)&&i.uploadBuffers()}}appendIndices(t,e){const i=this._buffers[t];if(e.length){const t=i.indexOffset+e.length;if(i.iData.length<t){const e=Math.floor(1.25*t),s=new Uint16Array(e);s.set(i.iData),i.iData=s}i.iData.set(e,i.indexOffset),i.indexOffset+=e.length}}allocateChunk(t,e){const i=t*this.vertexFormatBytes;if(t>this._vCount||e>this._iCount)return G(9004,i),null;let s,r=null,n=0,o=-1,a=null;for(let t=0;t<this._buffers.length;++t){r=this._buffers[t],s=this._freeLists[t];for(let e=0;e<s.length;++e)if(s[e].length>=i){a=s[e],n=t,o=e;break}if(a)break}if(a||(n=this._allocateBuffer(),r=this._buffers[n],r&&(o=0,a=this._freeLists[n][o])),a){const t=a.offset/this.vertexFormatBytes,s=new Float32Array(r.vData.buffer,a.offset,i>>2).fill(0);return this._allocateChunkFromEntry(n,o,a,i),new uI(this,n,r,t,s,e)}return null}recycleChunk(t){const e=this._freeLists[t.bufferId],i=this._buffers[t.bufferId];let s=t.vertexOffset*this.vertexFormatBytes,r=t.vb.byteLength;if(0===r)return;let n=!1,o=0,a=null,h=e[o];for(;h&&h.offset<s;)a=h,h=e[++o];if(a&&0==s-(a.offset+a.length)&&(a.length+=r,s=a.offset,r=a.length,h&&h.offset-(s+r)==0&&(a.length+=h.length,e.splice(o,1),cI.free(h),h=null),n=!0),!n&&h){if(0==h.offset-(s+r))h.offset=s,h.length+=r;else{const t=cI.alloc();t.offset=s,t.length=r,e.splice(o,0,t)}n=!0}if(n)s+r===i.byteOffset&&(i.byteOffset=s);else{const t=cI.alloc();t.offset=s,t.length=r,e.push(t)}}_allocateChunkFromEntry(t,e,i,s){const r=i.length-s,n=i.offset+s,o=this._buffers[t];o.byteOffset<n&&(o.byteOffset=n),X(r>=0,9004,t,i.offset,i.length),0===r?(this._freeLists[t].splice(e,1),cI.free(i)):(i.offset+=s,i.length=r)}_allocateBuffer(){X(this._buffers.length===this._freeLists.length,9003);const t=new hI,e=this._vCount*this._floatsPerVertex;t.initialize(this._device,this._attributes,e,this._iCount),this._buffers.push(t);const i=cI.alloc();i.offset=0,i.length=t.vData.byteLength;const s=[i];return this._freeLists.push(s),nC.root.batcher2D.syncMeshBuffersToNative(this.id,this._buffers),this._buffers.length-1}static generateID(){return dI.ID_COUNT++}}function _I(t,e,i){t[e]|=1<<i}function pI(t,e,i){t[e]&=~(1<<i)}dI.IB_SCALE=4,dI.ID_COUNT=0;class mI{constructor(t){this._accId=-1,this._bufferId=-1,this._vertexOffset=0,this._indexOffset=0,this._vb=null,this._ib=null,this._vData=null,this._iData=null,this._vertDirty=!1,this._vbCount=0,this._ibCount=0,this._dataHash=0,this._isMeshBuffer=!1,this._material=null,this._texture=null,this._sampler=null,this._stride=0,this._useLocal=!1,this._model=null,this._drawInfoType=0,this._subNode=null,this._render2dBuffer=null;{this.init(t);const e=this._nativeObj.getAttrSharedBufferForJS();let i=0;this._uint8SharedBuffer=new Uint8Array(e,i,4),i+=4,this._uint16SharedBuffer=new Uint16Array(e,i,2),i+=4,this._uint32SharedBuffer=new Uint32Array(e,i,5)}}get nativeObj(){return this._nativeObj}get render2dBuffer(){return this._render2dBuffer}init(t){t&&(this._nativeObj=t),this._nativeObj||(this._nativeObj=new rI)}clear(){this._bufferId=0,this._vertexOffset=0,this._indexOffset=0,this._vertDirty=!1}setAccId(t){this._accId!==t&&(this._uint16SharedBuffer[1]=t),this._accId=t}setBufferId(t){this._bufferId!==t&&(this._uint16SharedBuffer[0]=t,this._nativeObj.changeMeshBuffer()),this._bufferId=t}setAccAndBuffer(t,e){this._accId===t&&this._bufferId===e||(this._uint16SharedBuffer[1]=t,this._uint16SharedBuffer[0]=e,this._nativeObj.changeMeshBuffer()),this._bufferId=e,this._accId=t}setVertexOffset(t){this._vertexOffset=t,this._uint32SharedBuffer[0]=t}setIndexOffset(t){this._indexOffset=t,this._uint32SharedBuffer[1]=t}setVB(t){this._nativeObj.vbBuffer=t}setIB(t){this._nativeObj.ibBuffer=t}setVData(t){this._nativeObj.vDataBuffer=t}setIData(t){this._nativeObj.iDataBuffer=t}setVBCount(t){this._uint32SharedBuffer[2]=t,this._vbCount=t}setIBCount(t){this._uint32SharedBuffer[3]=t}setVertDirty(t){this._uint8SharedBuffer[1]=t?1:0,this._vertDirty=t}setDataHash(t){this._uint32SharedBuffer[4]=t,this._dataHash=t}setIsMeshBuffer(t){t?_I(this._uint8SharedBuffer,2,0):pI(this._uint8SharedBuffer,2,0),this._isMeshBuffer=t}setVertexPositionInWorld(t){t?_I(this._uint8SharedBuffer,2,1):pI(this._uint8SharedBuffer,2,1)}setMaterial(t){this._material!==t&&(this._nativeObj.material=t),this._material=t}setTexture(t){this._texture!==t&&(this._nativeObj.texture=t),this._texture=t}setSampler(t){this._sampler!==t&&(this._nativeObj.sampler=t),this._sampler=t}setModel(t){this._model!==t&&(this._nativeObj.model=t)}setDrawInfoType(t){this._drawInfoType!==t&&(this._uint8SharedBuffer[0]=t),this._drawInfoType=t}setSubNode(t){this._subNode!==t&&(this._nativeObj.subNode=t),this._subNode=t}setStride(t){this._uint8SharedBuffer[3]=t,this._stride=t}initRender2dBuffer(){this._render2dBuffer=new Float32Array(this._vbCount*this._stride),this._nativeObj.setRender2dBufferToNative(this._render2dBuffer)}fillRender2dBuffer(t){{if(!this._render2dBuffer)return;const e=Math.min(this._vbCount,t.length);let i=0;for(let s=0;s<e;s++){const e=t[s];this._render2dBuffer[i]=e.x,this._render2dBuffer[i+1]=e.y,this._render2dBuffer[i+2]=e.z,i+=this._stride}}}}const gI=sI(QE)>>2;class fI{get vertexCount(){return this._vc}get indexCount(){return this._ic}get stride(){return this._floatStride<<2}get floatStride(){return this._floatStride}get vertexFormat(){return this._vertexFormat}get drawInfoType(){return this._drawInfoType}set drawInfoType(t){this._drawInfoType=t,this._renderDrawInfo&&this._renderDrawInfo.setDrawInfoType(t)}get renderDrawInfo(){return this._renderDrawInfo}get material(){return this._material}set material(t){this._material=t,this._renderDrawInfo&&this._renderDrawInfo.setMaterial(t)}get dataHash(){return this._dataHash}set dataHash(t){this._dataHash=t,this._renderDrawInfo&&this._renderDrawInfo.setDataHash(t)}get multiOwner(){return this._multiOwner}set multiOwner(t){this._multiOwner=t}get batcher(){return this._batcher||(this._batcher=nC.root.batcher2D),this._batcher}constructor(t=QE){this.chunk=null,this._renderDrawInfo=null,this._material=null,this._dataHash=0,this._isMeshBuffer=!1,this._vc=0,this._ic=0,this._floatStride=0,this._vertexFormat=QE,this._drawInfoType=0,this._multiOwner=!1,this._batcher=null,this._floatStride=t===QE?gI:sI(t)>>2,this._vertexFormat=t}isValid(){return this._ic>0&&this.chunk.vertexAccessor}initRenderDrawInfo(t,e=0){{const i=t.renderEntity;if(0===i.renderEntityType){if(!this._renderDrawInfo){const t=i.getStaticRenderDrawInfo();t&&(this._renderDrawInfo=t)}}else!1===this.multiOwner&&(this._renderDrawInfo||(this._renderDrawInfo=new mI,i.addDynamicRenderDrawInfo(this._renderDrawInfo)));this.drawInfoType=e,this.setRenderDrawInfoAttributes()}}removeRenderDrawInfo(t){{const e=t.renderEntity;1===e.renderEntityType?e.removeDynamicRenderDrawInfo():0===e.renderEntityType&&e.clearStaticRenderDrawInfos()}}setRenderDrawInfoAttributes(){{const t=this._renderDrawInfo;if(!t)return;const e=this.chunk;if(e){t.setBufferId(e.bufferId),t.setVertexOffset(e.vertexOffset),t.setVB(e.vb),t.setIB(e.ib);const i=e.meshBuffer;i&&(t.setIndexOffset(i.indexOffset),t.setVData(i.vData.buffer),t.setIData(i.iData.buffer))}t.setVBCount(this._vc),t.setIBCount(this._ic),t.setDataHash(this.dataHash),t.setIsMeshBuffer(this._isMeshBuffer),t.setMaterial(this.material),t.setDrawInfoType(this._drawInfoType)}}}t("BaseRenderData",fI);class yI extends fI{static add(t=QE,e=null){const i=new yI(t,e);return e||(e=nC.root.batcher2D.switchBufferAccessor(i._vertexFormat)),i._accessor=e,i}static remove(t){t.clear(),t._accessor=null}get dataLength(){return this._data.length}set dataLength(t){const e=this._data;if(e.length!==t){for(let i=e.length;i<t;i++)e.push({x:0,y:0,z:0,u:0,v:0,color:Ls.WHITE.clone()});e.length=t}this.syncRender2dBuffer()}get data(){return this._data}get vertDirty(){return this._vertDirty}set vertDirty(t){this._vertDirty=t,this._renderDrawInfo&&t&&this._renderDrawInfo.setVertDirty(t)}get textureHash(){return this._textureHash}set textureHash(t){this._textureHash=t}set frame(t){this._frame=t,this._renderDrawInfo&&(this._frame?(this._renderDrawInfo.setTexture(this._frame.getGFXTexture()),this._renderDrawInfo.setSampler(this._frame.getGFXSampler())):(this._renderDrawInfo.setTexture(null),this._renderDrawInfo.setSampler(null)))}get frame(){return this._frame}get accessor(){return this._accessor}constructor(t=QE,e=null){super(t),this._vertDirty=!0,this._textureHash=0,this.indices=null,this.layer=0,this.nodeDirty=!0,this.passDirty=!0,this.textureDirty=!0,this.hashDirty=!0,this._data=[],this._frame=null,this._accessor=null,this.vertexRow=1,this.vertexCol=1,e||(e=this.batcher.switchBufferAccessor(this._vertexFormat)),this._accessor=e}resize(t,e){if((t!==this._vc||e!==this._ic||!this.chunk)&&(this._vc=t,this._ic=e,this.chunk&&(this._accessor.recycleChunk(this.chunk),this.chunk=null),this.chunk=this._accessor.allocateChunk(t,e),this.updateHash(),!1===this.multiOwner&&this._renderDrawInfo)){const t=this._renderDrawInfo,e=this.chunk,i=e.meshBuffer;t.setDrawInfoType(this._drawInfoType),t.setBufferId(e.bufferId),t.setVertexOffset(e.vertexOffset),t.setIndexOffset(i.indexOffset),t.setVB(e.vb),t.setIB(e.ib),t.setVData(i.vData.buffer),t.setIData(i.iData.buffer),t.setVBCount(this._vc),t.setIBCount(this._ic)}}setRenderDrawInfoAttributes(){this._renderDrawInfo&&(this._renderDrawInfo.setAccId(this._accessor.id),super.setRenderDrawInfoAttributes(),this._renderDrawInfo.setTexture(this.frame?this.frame.getGFXTexture():null),this._renderDrawInfo.setSampler(this.frame?this.frame.getGFXSampler():null))}fillDrawInfoAttributes(t){t&&(t.setDrawInfoType(this._drawInfoType),t.setAccAndBuffer(this._accessor.id,this.chunk.bufferId),t.setVertexOffset(this.chunk.vertexOffset),t.setIndexOffset(this.chunk.meshBuffer.indexOffset),t.setVB(this.chunk.vb),t.setIB(this.chunk.ib),t.setVData(this.chunk.meshBuffer.vData.buffer),t.setIData(this.chunk.meshBuffer.iData.buffer),t.setVBCount(this._vc),t.setIBCount(this._ic),t.setDataHash(this.dataHash),t.setIsMeshBuffer(this._isMeshBuffer))}syncRender2dBuffer(){if(!1===this.multiOwner){if(!this._renderDrawInfo)return;this.renderDrawInfo.setStride(this.floatStride),this.renderDrawInfo.setVBCount(this.dataLength),this.renderDrawInfo.initRender2dBuffer()}}resizeAndCopy(t,e){if(t===this._vc&&e===this._ic&&this.chunk)return;this._vc=t,this._ic=e;const i=this.chunk;this.chunk=this._accessor.allocateChunk(t,e),i&&(this.chunk.vb.set(i.vb),this._accessor.recycleChunk(i)),this.updateHash()}getMeshBuffer(){return this.chunk&&this._accessor?this._accessor.getMeshBuffer(this.chunk.bufferId):null}updateNode(t){this.layer=t.node.layer,this.nodeDirty=!1,this.hashDirty=!0}updatePass(t){this.material=t.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0}updateTexture(t){this.frame=t,this.textureHash=t.getHash(),this.textureDirty=!1,this.hashDirty=!0}updateHash(){const t=`${this.chunk?this.chunk.bufferId:-1}${this.layer} ${this.textureHash}`;this.dataHash=Gu(t,666),this.hashDirty=!1}updateRenderData(t,e){if(this.passDirty&&(this.material=t.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0,this._renderDrawInfo&&this._renderDrawInfo.setMaterial(this.material)),this.nodeDirty){const e=t.node.scene?t._getRenderScene():null;this.layer=t.node.layer,null!==e&&(this.nodeDirty=!1),this.hashDirty=!0}this.textureDirty&&(this.frame=e,this.textureHash=e.getHash(),this.textureDirty=!1,this.hashDirty=!0,this._renderDrawInfo&&(this._renderDrawInfo.setTexture(this.frame?this.frame.getGFXTexture():null),this._renderDrawInfo.setSampler(this.frame?this.frame.getGFXSampler():null))),this.hashDirty&&(this.updateHash(),this._renderDrawInfo&&this._renderDrawInfo.setDataHash(this.dataHash)),!1===this.multiOwner&&this._renderDrawInfo.fillRender2dBuffer(this._data)}clear(){this.resize(0,0),this._data.length=0,this.indices=null,this.vertDirty=!0,this.material=null,this.nodeDirty=!0,this.passDirty=!0,this.textureDirty=!0,this.hashDirty=!0,this.layer=0,this.frame=null,this.textureHash=0,this.dataHash=0,this._renderDrawInfo&&this._renderDrawInfo.clear()}static createStaticVBAccessor(t,e,i){const s=nC.root.device;return new dI(s,t,e,i)}}t("RenderData",yI);class bI extends fI{static add(t=QE){const e=new bI;return e._floatStride=t===QE?gI:sI(t)>>2,e._vertexFormat=t,e}static remove(t){t.clear()}set formatByte(t){}get formatByte(){return this.stride}get floatStride(){return this._floatStride}get vDataOffset(){return this._byteLength>>>2}constructor(t=QE){super(t),this._isMeshBuffer=!0,this.vertexStart=0,this.vertexRange=0,this.indexStart=0,this.indexRange=0,this.lastFilledIndex=0,this.lastFilledVertex=0,this.frame=null,this._byteLength=0,this._vertexBuffers=[],this._indexBuffer=null,this._iaPool=null,this._iaInfo=null,this.vData=new Float32Array(256*this.stride),this.iData=new Uint16Array(1536)}request(t,e){const i=this._byteLength+t*this.stride;return!!this.reserve(t,e)&&(this._vc+=t,this._ic+=e,this._byteLength=i,this.vertexRange=this._vc,this.indexRange=this._ic,!0)}reserve(t,e){const i=this._byteLength+t*this.stride,s=this.indexCount+e;if(t+this.vertexCount>65535)return!1;let r=this.vData.byteLength,n=this.iData.length,o=this.vData.length,a=this.iData.length;if(i>r||s>n){for(;r<i||n<s;)o*=2,a*=2,r=4*o,n=a;this._reallocBuffer(o,a)}return!0}resize(t,e){const i=t*this.stride;t>=0&&e>=0&&i<=this.vData.byteLength&&this.iData.length,this._vc=t,this._ic=e,this._byteLength=i,this.updateRange(0,t,0,e)}updateRange(t,e,i,s){e>=0&&s>=0&&e<=this._vc&&this._ic,this.vertexStart=t,this.indexStart=i,this.vertexRange=e,this.indexRange=s}requestIA(t){this._initIAInfo(t);const e=this._iaPool.add();return e.firstIndex=this.indexStart,e.indexCount=this.indexRange,e}uploadBuffers(){if(0===this._byteLength||!this._vertexBuffers[0]||!this._indexBuffer)return;const t=this._ic,e=new Float32Array(this.vData.buffer,0,this._byteLength>>2),i=new Uint16Array(this.iData.buffer,0,t),s=this._vertexBuffers[0];this._byteLength>s.size&&s.resize(this._byteLength),s.update(e);const r=t<<1;r>this._indexBuffer.size&&this._indexBuffer.resize(r),this._indexBuffer.update(i)}freeIAPool(){this._iaPool&&this._iaPool.reset()}reset(){this._vc=0,this._ic=0,this._byteLength=0,this.vertexStart=0,this.vertexRange=0,this.indexStart=0,this.indexRange=0,this.lastFilledIndex=0,this.lastFilledVertex=0,this.material=null,this.freeIAPool()}clear(){this.reset(),this._iaPool&&this._iaPool.destroy(),this._vertexBuffers[0]&&(this._vertexBuffers[0].destroy(),this._vertexBuffers=[]),this._iaInfo=null,this.vData=new Float32Array(256*this.stride),this.iData=new Uint16Array(1536)}_initIAInfo(t){if(!this._iaInfo){const e=this.stride,i=this._vertexBuffers;i.length||i.push(t.createBuffer(new a_(10,1,e,e)));const s=2;this._indexBuffer||(this._indexBuffer=t.createBuffer(new a_(6,1,s,s))),this._iaInfo=new A_(this._vertexFormat,i,this._indexBuffer),this._iaPool=new So((()=>t.createInputAssembler(this._iaInfo)),1,(t=>{t.destroy()}))}}_reallocBuffer(t,e){const i=this.vData;this.vData=new Float32Array(t),i&&this.vData.set(i,0);const s=this.iData;this.iData=new Uint16Array(e),s&&this.iData.set(s,0)}setRenderDrawInfoAttributes(){{const t=this._renderDrawInfo;if(!t)return;t.setVData(this.vData.buffer),t.setIData(this.iData.buffer),t.setVBCount(this._vc),t.setIBCount(this._ic),t.setVertexOffset(this.vertexStart),t.setIndexOffset(this.indexStart),t.setIsMeshBuffer(this._isMeshBuffer),t.setMaterial(this.material);const e=this.frame;e&&(t.setTexture(e.getGFXTexture()),t.setSampler(e.getGFXSampler()))}}particleInitRenderDrawInfo(t){if(0===t.renderEntityType&&!this._renderDrawInfo){const e=t.getStaticRenderDrawInfo();e&&(this._renderDrawInfo=e)}}}var vI,SI,TI,wI,xI;t("MeshRenderData",bI);const CI=new kr,AI=new kr,DI=new Ms,EI=new vr,II=new vr,MI=new vr,PI=new vr(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),OI=new Wr;let RI=ah("cc.UITransform")(vI=lh(110)(vI=ch((xI=class t extends Km{constructor(){super(),this._priority=0,this._contentSize=TI&&TI(),this._anchorPoint=wI&&wI()}get contentSize(){return this._contentSize}set contentSize(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit("size-changed"),this._markRenderDataDirty())}get width(){return this._contentSize.width}set width(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit("size-changed"),this._markRenderDataDirty())}get height(){return this._contentSize.height}set height(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit("size-changed"),this._markRenderDataDirty())}get anchorPoint(){return this._anchorPoint}set anchorPoint(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit("anchor-changed",this._anchorPoint),this._markRenderDataDirty())}get anchorX(){return this._anchorPoint.x}set anchorX(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit("anchor-changed",this._anchorPoint),this._markRenderDataDirty())}get anchorY(){return this._anchorPoint.y}set anchorY(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit("anchor-changed",this._anchorPoint),this._markRenderDataDirty())}get priority(){return this._priority}set priority(e){this._priority!==e&&(this.node.getComponent("cc.RenderRoot2D")?j(6706):(this._priority=e,this.node.parent&&t.insertChangeMap(this.node.parent)))}get visibility(){const t=nC.root.batcher2D.getFirstRenderCamera(this.node);return t?t.visibility:0}get cameraPriority(){const t=nC.root.batcher2D.getFirstRenderCamera(this.node);return t?t.priority:0}__preload(){this.node._uiProps.uiTransformComp=this}onLoad(){this.node.parent&&t.insertChangeMap(this.node.parent)}onEnable(){this.node.on("parent-changed",this._parentChanged,this),this._markRenderDataDirty()}onDisable(){this.node.off("parent-changed",this._parentChanged,this)}onDestroy(){this.node._uiProps.uiTransformComp=null}setContentSize(t,e){const i=this._contentSize;let s,r;if(void 0===e){if(Oi(t.width,i.width,Mi)&&Oi(t.height,i.height,Mi))return;s=t.width,r=t.height}else{if(Oi(t,i.width,Mi)&&Oi(e,i.height,Mi))return;s=t,r=e}i.width=s,i.height=r,this.node.emit("size-changed"),this._markRenderDataDirty()}setAnchorPoint(t,e){const i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this.node.emit("anchor-changed",this._anchorPoint),this._markRenderDataDirty()}isHit(t){const e=this._contentSize.width,i=this._contentSize.height,s=CI,r=AI,n=this._getRenderScene().cameras;for(let o=0;o<n.length;o++){const a=n[o];if(!(a.visibility&this.node.layer))continue;a.node.getWorldRT(EI);const h=EI.m12,l=EI.m13,c=fa.center;if(EI.m12=c.x-(EI.m00*h+EI.m04*l),EI.m13=c.y-(EI.m01*h+EI.m05*l),vr.invert(EI,EI),kr.transformMat4(s,t,EI),this.node.getWorldMatrix(MI),vr.invert(EI,MI),vr.strictEquals(EI,PI))continue;kr.transformMat4(r,s,EI),r.x+=this._anchorPoint.x*e,r.y+=this._anchorPoint.y*i;let u=!1;if(r.x>=0&&r.y>=0&&r.x<=e&&r.y<=i&&(u=this._maskTest(s)),u)return!0}return!1}hitTest(t,e=0){const i=this._contentSize.width,s=this._contentSize.height,r=DI,n=CI,o=AI,a=this._getRenderScene().cameras;for(let h=0;h<a.length;h++){const l=a[h];if(!(l.visibility&this.node.layer)||l.window&&!l.window.swapchain)continue;if(l.systemWindowId!==e)continue;if(Ms.set(r,t.x,t.y,0),l.screenToWorld(r,r),kr.set(n,r.x,r.y),this.node.getWorldMatrix(MI),vr.invert(EI,MI),vr.strictEquals(EI,PI))continue;kr.transformMat4(o,n,EI),o.x+=this._anchorPoint.x*i,o.y+=this._anchorPoint.y*s;let c=!1;if(o.x>=0&&o.y>=0&&o.x<=i&&o.y<=s&&(c=this._maskTest(n)),c)return!0}return!1}_maskTest(t){var e,i;const s=null==(e=this.node)||null==(i=e.eventProcessor)?void 0:i.maskList;if(s){let e=this.node;const i=s.length;for(let r=0,n=0;e&&n<i;++r,e=e.parent){const i=s[n];if(r===i.index){if(e!==i.comp.node){s.length=n;break}{const e=i.comp;if(e&&e._enabled&&!e.isHit(t))return!1;n++}}else if(r>i.index){s.length=n;break}}}return!0}convertToNodeSpaceAR(t,e){return this.node.getWorldMatrix(MI),vr.invert(EI,MI),e||(e=new Ms),Ms.transformMat4(e,t,EI)}convertToWorldSpaceAR(t,e){return this.node.getWorldMatrix(MI),e||(e=new Ms),Ms.transformMat4(e,t,MI)}getBoundingBox(){const t=new Wr;return this._selfBoundingBox(t),vr.fromSRT(II,this.node.rotation,this.node.position,this.node.scale),t.transformMat4(II),t}getBoundingBoxToWorld(){const e=new Wr,i=this.node.children;for(let s=0;s<i.length;++s){const r=i[s];if(r&&r.active){const i=r.getComponent(t);i&&i.contentSize.width&&i.contentSize.height&&(i._selfBoundingBox(OI),OI.transformMat4(r.worldMatrix),0===e.width?e.set(OI):Wr.union(e,e,OI))}}return this._contentSize.width&&this._contentSize.height&&(this._selfBoundingBox(OI),OI.transformMat4(this.node.worldMatrix),0===e.width?e.set(OI):Wr.union(e,e,OI)),e}getBoundingBoxTo(e){const i=new Wr,s=this.node.children;vr.invert(EI,e);for(let e=0;e<s.length;++e){const r=s[e];if(r&&r.active){const e=r.getComponent(t);e&&e.contentSize.width&&e.contentSize.height&&(e._selfBoundingBox(OI),vr.multiply(II,r.worldMatrix,EI),OI.transformMat4(II),0===i.width?i.set(OI):Wr.union(i,i,OI))}}return this._contentSize.width&&this._contentSize.height&&(this._selfBoundingBox(OI),vr.multiply(II,this.node.worldMatrix,EI),OI.transformMat4(II),0===i.width?i.set(OI):Wr.union(i,i,OI)),i}getComputeAABB(t){const e=this._contentSize.width,i=this._contentSize.height;OI.set(-this._anchorPoint.x*e,-this._anchorPoint.y*i,e,i),OI.transformMat4(this.node.worldMatrix);const s=OI.x+.5*OI.width,r=OI.y+.5*OI.height,n=this.node.worldPosition.z,o=OI.width/2,a=OI.height/2;return null!=t?(Ca.set(t,s,r,n,o,a,.001),t):new Ca(s,r,n,o,a,.001)}_selfBoundingBox(t){const e=this._contentSize.width,i=this._contentSize.height;return t.set(-this._anchorPoint.x*e,-this._anchorPoint.y*i,e,i),t}_parentChanged(e){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&t.insertChangeMap(this.node.parent)}_markRenderDataDirty(){const t=this.node._uiProps.uiComp;t&&t._markForUpdateRenderData()}static insertChangeMap(e){const i=e.uuid;t.priorityChangeNodeMap.has(i)||t.priorityChangeNodeMap.set(i,e)}static _sortChildrenSibling(t){const e=t.children;e&&e.sort(((t,e)=>{const i=t._getUITransformComp(),s=e._getUITransformComp(),r=(i?i._priority:0)-(s?s._priority:0);return 0===r?t.siblingIndex-e.siblingIndex:r}))}static _sortSiblings(){t.priorityChangeNodeMap.forEach((e=>{t._sortChildrenSibling(e),e._updateSiblingIndex(),e.emit("childrenSiblingOrderChanged")})),t.priorityChangeNodeMap.clear()}static _cleanChangeMap(){t.priorityChangeNodeMap.clear()}},xI.EventType=Ly,xI.priorityChangeNodeMap=new Map,TI=Za((SI=xI).prototype,"_contentSize",[vh],(function(){return new Vr(100,100)})),wI=Za(SI.prototype,"_anchorPoint",[vh],(function(){return new kr(.5,.5)})),vI=SI))||vI)||vI)||vI;t({UITransform:RI,UITransformComponent:RI}),nC.on("director_after_update",RI._sortSiblings),nC.on("director_before_scene_launch",RI._cleanChangeMap);const BI=jsb.MaterialInstance,FI=jsb.MaterialInstance.prototype;var NI,LI,kI,zI,UI,VI;Object.defineProperty(FI,"parent",{configurable:!0,enumerable:!0,get(){return this._parent}}),Object.defineProperty(FI,"owner",{configurable:!0,enumerable:!0,get(){return this._owner}}),FI._ctor=function(t){jsb.Material.prototype._ctor.apply(this,arguments),this._registerListeners(),this._parent=t.parent,this._owner=t.owner||null,this._subModelIdx=t.subModelIdx||0,this._passes=this.getPasses()},FI._onRebuildPSO=function(){this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)};const jI={parent:null,owner:null,subModelIdx:0},{ccclass:HI,serializable:GI,disallowMultiple:WI,type:XI,displayOrder:YI,displayName:qI}=il;let $I=t("Renderer",(NI=HI("cc.Renderer"),LI=XI(fv),kI=XI([fv]),NI(zI=WI((s((UI=class extends Km{constructor(){super(),this._materials=VI&&VI(),this._materialInstances=[]}get sharedMaterial(){return this.getSharedMaterial(0)}get sharedMaterials(){return this._materials}set sharedMaterials(t){for(let e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setSharedMaterial(t[e],e);if(t.length<this._materials.length){for(let e=t.length;e<this._materials.length;e++)this.setSharedMaterial(null,e);this._materials.splice(t.length)}}get material(){return this.getMaterialInstance(0)}set material(t){(1!==this._materials.length||this._materialInstances[0]||this._materials[0]!==t)&&this.setMaterialInstance(t,0)}get materials(){for(let t=0;t<this._materials.length;t++)this._materialInstances[t]=this.getMaterialInstance(t);return this._materialInstances}set materials(t){const e=t.length,i=this._materials.length;for(let t=e;t<i;t++)this.setMaterialInstance(null,t);this._materials.length=e,this._materialInstances.length=e;for(let i=0;i<e;i++)this._materialInstances[i]!=t[i]&&this.setMaterialInstance(t[i],i)}getMaterial(t){return this.getSharedMaterial(t)}setMaterial(t,e){this.setSharedMaterial(t,e)}getSharedMaterial(t){return t<0||t>=this._materials.length?null:this._materials[t]}setSharedMaterial(t,e,i=!1){if(t&&t instanceof BI&&G(12012),!i&&this._materials[e]===t)return;this._materials[e]=t;const s=this._materialInstances[e];s&&(s.destroy(),this._materialInstances[e]=null),this._onMaterialModified(e,this._materials[e])}getMaterialInstance(t){if(!this._materials[t])return null;if(!this._materialInstances[t]){jI.parent=this._materials[t],jI.owner=this,jI.subModelIdx=t;const e=new BI(jI);jI.parent=null,jI.owner=null,jI.subModelIdx=0,this.setMaterialInstance(e,t)}return this._materialInstances[t]}setMaterialInstance(t,e){if("number"==typeof t){j(12007);const i=t;t=e,e=i}const i=this._materialInstances[e];t&&t.parent?t!==i&&(this._materialInstances[e]=t,this._onMaterialModified(e,t)):(t!==this._materials[e]||i)&&this.setSharedMaterial(t,e)}getRenderMaterial(t){return this._materialInstances[t]||this._materials[t]}_onMaterialModified(t,e){}_onRebuildPSO(t,e){}_clearMaterials(){}}).prototype,"sharedMaterials",[LI],Object.getOwnPropertyDescriptor(UI.prototype,"sharedMaterials"),UI.prototype),VI=Za(UI.prototype,"_materials",[kI],(function(){return[]})),zI=UI))||zI)||zI));class KI{get nativeObj(){return this._nativeObj}get renderDrawInfoArr(){return this._dynamicDrawInfoArr}get renderEntityType(){return this._renderEntityType}setPriority(t){this._uint32SharedBuffer[0]=t}get color(){return this._color}set color(t){this._color=t,this._uint8SharedBuffer[0]=t.r,this._uint8SharedBuffer[1]=t.g,this._uint8SharedBuffer[2]=t.b,this._uint8SharedBuffer[3]=t.a}get colorDirty(){return this._node&&(this._colorDirty=this._node._colorDirty),this._colorDirty}set colorDirty(t){this._colorDirty=t,this._node&&(this._node._colorDirty=t)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,t?this._boolSharedBuffer[0]|=1:this._boolSharedBuffer[0]&=-2}setUseLocal(t){this._useLocal=t,t?this._boolSharedBuffer[0]|=2:this._boolSharedBuffer[0]&=-3}constructor(t){this._renderEntityType=0,this._dynamicDrawInfoArr=[],this._node=null,this._renderTransform=null,this._stencilStage=0,this._colorDirty=!0,this._enabled=!1,this._useLocal=!1,this._maskMode=0,this._color=Ls.WHITE.clone(),this._nativeObj||(this._nativeObj=new oI(t)),this._renderEntityType=t,this.initSharedBuffer()}addDynamicRenderDrawInfo(t){t&&(this._dynamicDrawInfoArr.push(t),this._nativeObj.addDynamicRenderDrawInfo(t.nativeObj))}removeDynamicRenderDrawInfo(){this._dynamicDrawInfoArr.pop(),this._nativeObj.removeDynamicRenderDrawInfo()}clearDynamicRenderDrawInfos(){this._dynamicDrawInfoArr.length=0,this._nativeObj.clearDynamicRenderDrawInfos()}clearStaticRenderDrawInfos(){this._nativeObj.clearStaticRenderDrawInfos()}clearRenderDrawInfos(){1===this._renderEntityType?this.removeDynamicRenderDrawInfo():0===this._renderEntityType&&this.clearStaticRenderDrawInfos()}setDynamicRenderDrawInfo(t,e){t&&(this._dynamicDrawInfoArr.length<e+1?(this._dynamicDrawInfoArr.push(t),this._nativeObj.addDynamicRenderDrawInfo(t.nativeObj)):(this._dynamicDrawInfoArr[e]=t,this._nativeObj.setDynamicRenderDrawInfo(t.nativeObj,e)))}setMaskMode(t){this._uint8SharedBuffer[4]=t,this._maskMode=t}setFillColorType(t){this._uint8SharedBuffer[5]=t}getStaticRenderDrawInfo(){{const t=this._nativeObj.getStaticRenderDrawInfo(this._nativeObj.staticDrawInfoSize++);return new mI(t)}}setNode(t){this._node!==t&&(this._nativeObj.node=t),this._node=t}setRenderTransform(t){this._renderTransform!==t&&(this._nativeObj.renderTransform=t),this._renderTransform=t}setStencilStage(t){this._stencilStage!==t&&(this._nativeObj.stencilStage=t),this._stencilStage=t}initSharedBuffer(){{const t=this._nativeObj.getEntitySharedBufferForJS();let e=0;this._uint32SharedBuffer=new Uint32Array(t,e,1),e+=4,this._uint8SharedBuffer=new Uint8Array(t,e,6),e+=6,this._boolSharedBuffer=new Uint8Array(t,e,1)}}}const ZI={default:0};JA.on(QA.EVENT_POST_SUBSYSTEM_INIT,(()=>{QI.init()}));class QI{static getSortingPriority(t=0,e=0){return(t+32768<<16|e+32768)>>>0}static getDefaultPriority(){return this.getSortingPriority(ZI.default,0)}static getLayerIndex(t=0){let e=0;return this.indexMap.has(t)?e=this.indexMap.get(t):G(2105),e}static getLayerIndexByName(t){const e=this.getLayerByName(t);return this.getLayerIndex(e)}static getLayerName(t=0){let e="";return this.nameMap.has(t)?e=this.nameMap.get(t):G(2105),e}static getLayerByName(t){const e=this.nameMap.size,i=this.nameMap.keys();let s=0;for(let r=0;r<e;r++)if(s=i.next().value,this.nameMap.get(s)===t)return s;return G(2106),0}static isLayerValid(t){return!!this.indexMap.has(t)||(G(2105),!1)}static getBuiltinLayers(){return[{id:0,name:"default",value:0}]}static init(){let t=Se.querySettings("engine","sortingLayers");t&&0!==t.length||(t=this.getBuiltinLayers()),QI.resetState();for(let e=0;e<t.length;e++){const i=t[e];QI.setLayer(i.id,i.name,i.value),QI.Enum[i.name]=i.id}pe.update(QI.Enum),pe.sortList(QI.Enum,((t,e)=>QI.getLayerIndex(t.value)-QI.getLayerIndex(e.value)))}static setLayer(t,e,i){this.nameMap.set(t,e),this.indexMap.set(t,i)}static resetState(){const t=Object.keys(QI.Enum);for(let e=0;e<t.length;e++)delete QI.Enum[QI.Enum[t[e]]],delete QI.Enum[t[e]];QI.indexMap.clear(),QI.nameMap.clear()}}var JI,tM,eM,iM,sM,rM,nM,oM,aM,hM,lM,cM;t("SortingLayers",QI),QI.nameMap=new Map,QI.indexMap=new Map,QI.Enum=pe(ZI),fe(Td),fe(wd),fe(xd),t("InstanceMaterialType",{ADD_COLOR:0,ADD_COLOR_AND_TEXTURE:1,GRAYSCALE:2,USE_ALPHA_SEPARATED:3,USE_ALPHA_SEPARATED_AND_GRAY:4});let uM=(JI=ah("cc.UIRenderer"),tM=hh(RI),eM=Xh(fv),iM=Xh(fv),JI(sM=tM((cM=class t extends $I{constructor(){super(),this._renderData=null,this._materials=nM&&nM(),this._customMaterial=oM&&oM(),this._srcBlendFactor=aM&&aM(),this._dstBlendFactor=hM&&hM(),this._color=lM&&lM(),this._stencilStage=0,this._assembler=null,this._postAssembler=null,this._renderFlag=!0,this._instanceMaterialType=-1,this._srcBlendFactorCache=2,this._dstBlendFactorCache=4,this._dirtyVersion=-1,this._internalId=-1,this._flagChangedVersion=-1,this._priority=0,this._fillColorType=0,this._lastParent=null,this._renderEntity=this.createRenderEntity()}get sharedMaterials(){return this._materials}set sharedMaterials(t){for(let e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setSharedMaterial(t[e],e);if(t.length<this._materials.length){for(let e=t.length;e<this._materials.length;e++)this.setSharedMaterial(null,e);this._materials.splice(t.length)}}get customMaterial(){return this._customMaterial}set customMaterial(t){this._customMaterial=t,this.updateMaterial()}get color(){return this._color}set color(t){this._color.equals(t)||(this._color.set(t),this._updateColor())}get renderData(){return this._renderData}setRenderData(t){this._renderData=t}get stencilStage(){return this._stencilStage}set stencilStage(t){this._stencilStage=t,this._renderEntity.setStencilStage(t)}get srcBlendFactor(){return this._srcBlendFactor}set srcBlendFactor(t){this._srcBlendFactor=t}get priority(){return this._priority}set priority(t){this._priority=t,this._renderEntity.setPriority(t)}get batcher(){return nC.root.batcher2D}get renderEntity(){return this._renderEntity}getFillColorType(){return this._fillColorType}setFillColorType(t){this._fillColorType=t,this._renderEntity.setFillColorType(t)}set _useVertexOpacity(t){this.setFillColorType(1)}get _useVertexOpacity(){return 1===this._fillColorType}get useVertexOpacity(){return 1===this._fillColorType}onLoad(){this._renderEntity.setNode(this.node)}__preload(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()}onEnable(){this.node.on("anchor-changed",this._nodeStateChange,this),this.node.on("size-changed",this._nodeStateChange,this),this.node.on("parent-changed",this._colorDirty,this),!this._renderData&&this._flushAssembler&&this._flushAssembler(),this.updateMaterial(),this._colorDirty(),pw.addRenderer(this),this._markForUpdateRenderData()}onRestore(){this.updateMaterial(),this._markForUpdateRenderData()}_destroyData(){if(this.destroyRenderData(),this._materials)for(let t=0;t<this._materials.length;t++)this.setSharedMaterial(null,t,!0)}onDisable(){this.node.off("anchor-changed",this._nodeStateChange,this),this.node.off("size-changed",this._nodeStateChange,this),this.node.off("parent-changed",this._colorDirty,this),this._destroyData(),pw.removeRenderer(this),this._renderFlag=!1,this._renderEntity.enabled=!1}onDestroy(){this._renderEntity.setNode(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this._destroyData()}markForUpdateRenderData(t=!0){this._markForUpdateRenderData(t)}_markForUpdateRenderData(t=!0){if(t){const t=this._renderData;t&&(t.vertDirty=!0),pw.markDirtyRenderer(this)}}requestRenderData(t=0){const e=yI.add();return e.initRenderDrawInfo(this,t),this._renderData=e,e}destroyRenderData(){this.renderEntity.clearRenderDrawInfos(),this._renderData&&(yI.remove(this._renderData),this._renderData=null)}updateRenderer(){const t=this._assembler;t&&t.updateRenderData&&t.updateRenderData(this),this._renderFlag=this._canRender(),this._renderEntity.enabled=this._renderFlag}fillBuffers(t){this._renderFlag&&this._render(t)}postUpdateAssembler(t){this._postAssembler&&this._renderFlag&&this._postRender(t)}_render(t){}_postRender(t){}_canRender(){return null!==this.getSharedMaterial(0)&&this._enabled&&this._color.a>0}_postCanRender(){}updateMaterial(){if(this._customMaterial)return void(this.getSharedMaterial(0)!==this._customMaterial&&this.setSharedMaterial(this._customMaterial,0));const t=this._updateBuiltinMaterial();this.setSharedMaterial(t,0),2!==this.stencilStage&&6!==this.stencilStage||this.getMaterialInstance(0).recompileShaders({USE_ALPHA_TEST:!0}),this._updateBlendFunc()}_updateColor(){this.node._uiProps.colorDirty=!0,this.setEntityColorDirty(!0),this.setEntityColor(this._color);const t=this._assembler;if(t){t.updateColor&&t.updateColor(this);const e=this._renderFlag;if(this._renderFlag=this._canRender(),this.setEntityEnabled(this._renderFlag),e!==this._renderFlag){const t=this.renderData;t&&(t.vertDirty=!0)}}}setEntityColorDirty(t){this._renderEntity.colorDirty=t}setEntityColor(t){this._renderEntity.color=t}setEntityOpacity(t){this.node._setLocalOpacity(t)}setEntityEnabled(t){this._renderEntity.enabled=t}_updateBlendFunc(){let t=this.getRenderMaterial(0).passes[0].blendState.targets[0];if(this._dstBlendFactorCache=t.blendDst,this._srcBlendFactorCache=t.blendSrc,this._dstBlendFactorCache!==this._dstBlendFactor||this._srcBlendFactorCache!==this._srcBlendFactor){t=this.getMaterialInstance(0).passes[0].blendState.targets[0],t.blend=!0,t.blendDstAlpha=4,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor;const e=this.getMaterialInstance(0).passes[0];e.blendState.setTarget(0,t),e._updatePassHash(),this._dstBlendFactorCache=this._dstBlendFactor,this._srcBlendFactorCache=this._srcBlendFactor}}_nodeStateChange(e){this._renderData&&this._markForUpdateRenderData();for(let e=0;e<this.node.children.length;++e){const i=this.node.children[e].getComponent(t);i&&i._markForUpdateRenderData()}}_colorDirty(){this.node._uiProps.colorDirty=!0,this.setEntityColorDirty(!0)}_onMaterialModified(t,e){this._renderData&&(this._markForUpdateRenderData(),this._renderData.passDirty=!0),super._onMaterialModified(t,e)}_updateBuiltinMaterial(){let t;switch(this._instanceMaterialType){case 0:t=iC.get("ui-base-material");break;case 2:t=iC.get("ui-sprite-gray-material");break;case 3:t=iC.get("ui-sprite-alpha-sep-material");break;case 4:t=iC.get("ui-sprite-gray-alpha-sep-material");break;default:t=iC.get("ui-sprite-material")}return t}setNodeDirty(){this._renderData&&(this._renderData.nodeDirty=!0)}setTextureDirty(){this._renderData&&(this._renderData.textureDirty=!0)}createRenderEntity(){return new KI(0)}},cM.BlendState=Td,cM.Assembler=null,cM.PostAssembler=null,s((rM=cM).prototype,"sharedMaterials",[Yh],Object.getOwnPropertyDescriptor(rM.prototype,"sharedMaterials"),rM.prototype),s(rM.prototype,"customMaterial",[eM],Object.getOwnPropertyDescriptor(rM.prototype,"customMaterial"),rM.prototype),nM=Za(rM.prototype,"_materials",[Yh],(function(){return[]})),oM=Za(rM.prototype,"_customMaterial",[iM],(function(){return null})),aM=Za(rM.prototype,"_srcBlendFactor",[vh],(function(){return 2})),hM=Za(rM.prototype,"_dstBlendFactor",[vh],(function(){return 4})),lM=Za(rM.prototype,"_color",[vh],(function(){return Ls.WHITE.clone()})),sM=rM))||sM)||sM);t({UIRenderer:uM,RenderComponent:uM,UIRenderable:uM,Renderable2D:uM}),a.internal.UIRenderer=uM;class dM{constructor(){this.isBold=!1,this.isItalic=!1,this.isUnderline=!1,this.underlineHeight=1,this.isOutlined=!1,this.outlineColor=Ls.WHITE.clone(),this.outlineWidth=1,this.hasShadow=!1,this.shadowColor=Ls.BLACK.clone(),this.shadowBlur=2,this.shadowOffsetX=0,this.shadowOffsetY=0,this.color=Ls.WHITE.clone(),this.fontSize=40,this.actualFontSize=0,this.isSystemFontUsed=!1,this.originFontSize=0,this.bmfontScale=1,this.fontFamily="Arial",this.fontDesc="",this.fntConfig=null,this.spriteFrame=null,this.fontScale=1}reset(){this.isBold=!1,this.isItalic=!1,this.isUnderline=!1,this.underlineHeight=1,this.isOutlined=!1,this.outlineColor.set(),this.outlineWidth=1,this.hasShadow=!1,this.shadowColor.set(),this.shadowBlur=2,this.shadowOffsetX=0,this.shadowOffsetY=0}}class _M{constructor(){this.horizontalAlign=0,this.verticalAlign=0,this.wrapping=!0,this.overFlow=0,this.lineHeight=10,this.maxLineWidth=0,this.spacingX=0,this.textWidthTemp=0,this.textHeightTemp=0,this.textDimensions=new Vr,this.horizontalKerning=[],this.numberOfLines=1,this.linesOffsetX=[],this.letterOffsetY=0,this.tailoredTopY=0,this.tailoredBottomY=0,this.textDesiredHeight=0,this.linesWidth=[]}reset(){this.horizontalAlign=0,this.verticalAlign=0,this.wrapping=!0,this.overFlow=0,this.lineHeight=10,this.maxLineWidth=0,this.spacingX=0,this.textWidthTemp=0,this.textHeightTemp=0,this.textDimensions.set(),this.horizontalKerning.length=0,this.numberOfLines=1,this.linesOffsetX.length=0,this.letterOffsetY=0,this.tailoredTopY=0,this.tailoredBottomY=0,this.textDesiredHeight=0,this.linesWidth.length=0}}class pM{constructor(){this.parsedString=[],this.nodeContentSize=Vr.ZERO.clone(),this.canvasSize=new Vr,this.canvasPadding=new Wr,this.contentSizeExtend=Vr.ZERO.clone(),this.startPosition=kr.ZERO.clone()}reset(){this.parsedString.length=0,this.nodeContentSize.set(0,0),this.canvasSize.set(),this.canvasPadding.set(),this.contentSizeExtend.set(),this.startPosition.set()}}class mM{constructor(){this.quadCount=0,this.vertexBuffer=[],this.texture=null,this.uiTransAnchorX=.5,this.uiTransAnchorY=.5}reset(){this.quadCount=0,this.vertexBuffer.length=0,this.texture=null,this.uiTransAnchorX=.5,this.uiTransAnchorY=.5}}var gM,fM,yM,bM,vM,SM,TM,wM,xM,CM,AM,DM,EM,IM,MM,PM,OM,RM,BM,FM,NM,LM,kM,zM,UM,VM,jM,HM,GM,WM,XM,YM,qM,$M;const KM=Ls.WHITE.clone(),ZM=t("HorizontalTextAlignment",{LEFT:0,CENTER:1,RIGHT:2});fe(ZM);const QM=t("VerticalTextAlignment",{TOP:0,CENTER:1,BOTTOM:2});fe(QM);const JM=t("Overflow",{NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3});fe(JM);const tP=t("CacheMode",{NONE:0,BITMAP:1,CHAR:2});fe(tP);let eP=(gM=ah("cc.Label"),fM=lh(110),yM=Xh(ZM),bM=Xh(QM),vM=Xh(JM),SM=Xh(MD),TM=Xh(tP),gM(wM=fM(($M=class t extends uM{get string(){return this._string}set string(t){t=null==t?"":t.toString(),this._string!==t&&(this._string=t,this._markForUpdateRenderData())}get horizontalAlign(){return this._horizontalAlign}set horizontalAlign(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this._markForUpdateRenderData())}get verticalAlign(){return this._verticalAlign}set verticalAlign(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._markForUpdateRenderData())}get actualFontSize(){return this._actualFontSize}set actualFontSize(t){this._actualFontSize=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this._markForUpdateRenderData())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this._markForUpdateRenderData())}get spacingX(){return this._spacingX}set spacingX(t){this._spacingX!==t&&(this._spacingX=t,this._markForUpdateRenderData())}get overflow(){return this._overflow}set overflow(t){this._overflow!==t&&(this._overflow=t,this._markForUpdateRenderData())}get enableWrapText(){return this._enableWrapText}set enableWrapText(t){this._enableWrapText!==t&&(this._enableWrapText=t,this._markForUpdateRenderData())}get useSystemFont(){return this._isSystemFontUsed}set useSystemFont(t){this._isSystemFontUsed!==t&&(this.destroyRenderData(),this._isSystemFontUsed=!!t,t&&(this.font=null),this._flushAssembler(),this._markForUpdateRenderData())}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this._markForUpdateRenderData())}get font(){return this._font}set font(t){this._font!==t&&(this._isSystemFontUsed=!t,this._font=t,this.destroyRenderData(),this._fontAtlas=null,this.updateRenderData(!0))}get cacheMode(){return this._cacheMode}set cacheMode(t){const e=this._cacheMode;e!==t&&(1!==e||this._font instanceof RE||!this._ttfSpriteFrame||this._ttfSpriteFrame._resetDynamicAtlasFrame(),2===e&&(this._ttfSpriteFrame=null,this.destroyLetterTexture()),this._cacheMode=t,this.updateRenderData(!0))}get isBold(){return this._isBold}set isBold(t){this._isBold!==t&&(this._isBold=t,this._markForUpdateRenderData())}get isItalic(){return this._isItalic}set isItalic(t){this._isItalic!==t&&(this._isItalic=t,this._markForUpdateRenderData())}get isUnderline(){return this._isUnderline}set isUnderline(t){this._isUnderline!==t&&(this._isUnderline=t,this._markForUpdateRenderData())}get underlineHeight(){return this._underlineHeight}set underlineHeight(t){this._underlineHeight!==t&&(this._underlineHeight=t,this._markForUpdateRenderData())}get enableOutline(){return this._enableOutline}set enableOutline(t){this._enableOutline!==t&&(this._enableOutline=t,this._markForUpdateRenderData())}get outlineColor(){return this._outlineColor}set outlineColor(t){this._outlineColor!==t&&(this._outlineColor.set(t),this._markForUpdateRenderData())}get outlineWidth(){return this._outlineWidth}set outlineWidth(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._markForUpdateRenderData())}get enableShadow(){return this._enableShadow}set enableShadow(t){this._enableShadow!==t&&(this._enableShadow=t,this._markForUpdateRenderData())}get shadowColor(){return this._shadowColor}set shadowColor(t){this._shadowColor!==t&&(this._shadowColor.set(t),this._markForUpdateRenderData())}get shadowOffset(){return this._shadowOffset}set shadowOffset(t){this._shadowOffset!==t&&(this._shadowOffset.set(t),this._markForUpdateRenderData())}get shadowBlur(){return this._shadowBlur}set shadowBlur(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._markForUpdateRenderData())}get spriteFrame(){return this._texture}get ttfSpriteFrame(){return this._ttfSpriteFrame}get assemblerData(){return this._assemblerData}get fontAtlas(){return this._fontAtlas}set fontAtlas(t){this._fontAtlas=t}get _bmFontOriginalSize(){return this._font instanceof RE?this._font.fontSize:-1}get textStyle(){return this._textStyle}get textLayout(){return this._textLayout}get textRenderData(){return this._textRenderData}get textLayoutData(){return this._textLayoutData}get contentWidth(){return this._contentWidth}set contentWidth(t){this._contentWidth=t}constructor(){super(),this._string=CM&&CM(),this._horizontalAlign=AM&&AM(),this._verticalAlign=DM&&DM(),this._actualFontSize=EM&&EM(),this._fontSize=IM&&IM(),this._fontFamily=MM&&MM(),this._lineHeight=PM&&PM(),this._overflow=OM&&OM(),this._enableWrapText=RM&&RM(),this._font=BM&&BM(),this._isSystemFontUsed=FM&&FM(),this._spacingX=NM&&NM(),this._isItalic=LM&&LM(),this._isBold=kM&&kM(),this._isUnderline=zM&&zM(),this._underlineHeight=UM&&UM(),this._cacheMode=VM&&VM(),this._enableOutline=jM&&jM(),this._outlineColor=HM&&HM(),this._outlineWidth=GM&&GM(),this._enableShadow=WM&&WM(),this._shadowColor=XM&&XM(),this._shadowOffset=YM&&YM(),this._shadowBlur=qM&&qM(),this._N$file=null,this._texture=null,this._ttfSpriteFrame=null,this._userDefinedFont=null,this._assemblerData=null,this._fontAtlas=null,this._letterTexture=null,this._contentWidth=0,this._textStyle=null,this._textLayout=null,this._textRenderData=null,this._textLayoutData=null,this._ttfSpriteFrame=null,this._textStyle=new dM,this._textLayout=new _M,this._textLayoutData=new pM,this._textRenderData=new mM}onEnable(){super.onEnable(),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this._applyFontTexture()}destroyTtfSpriteFrame(){if(!this._ttfSpriteFrame)return;this._ttfSpriteFrame._resetDynamicAtlasFrame();const t=this._ttfSpriteFrame.texture;if(this._ttfSpriteFrame.destroy(),t){const e=t;e.image&&e.image.destroy(),t.destroy()}this._ttfSpriteFrame=null}_onPreDestroy(){super._onPreDestroy(),this._isOnLoadCalled||this.destroyTtfSpriteFrame()}onDestroy(){this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this.destroyTtfSpriteFrame(),this.destroyLetterTexture(),super.onDestroy()}destroyLetterTexture(){const t=this._letterTexture;t&&(t.decRef(!1),t.refCount<=0&&t.destroy()),this._letterTexture=null}updateRenderData(t=!1){t&&(this._flushAssembler(),this.renderData&&(this.renderData.vertDirty=!0),this._applyFontTexture()),this._assembler&&this._assembler.updateRenderData(this)}_render(t){t.commitComp(this,this.renderData,this._texture,this._assembler,null)}_updateColor(){super._updateColor(),this._markForUpdateRenderData()}setEntityColor(t){this._font instanceof RE?this._renderEntity.color=t:(KM.set(255,255,255,t.a),this._renderEntity.color=KM)}_canRender(){if(!super._canRender()||!this._string)return!1;const t=this._font;if(t&&t instanceof RE){const e=t.spriteFrame;if(!e||!e.texture)return!1}return!0}_flushAssembler(){const e=t.Assembler.getAssembler(this);this._assembler!==e&&(this.destroyRenderData(),this._assembler=e,this.textStyle.reset(),this.textLayout.reset(),this.textLayoutData.reset(),this.textRenderData.reset()),this.renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.renderData.material=this.material,this._updateColor())}_applyFontTexture(){this._markForUpdateRenderData();const t=this._font;if(t instanceof RE){const e=t.spriteFrame;e&&e.texture&&(this._texture=e,this.renderData&&(this.renderData.textureDirty=!0),this.changeMaterialForDefine(),this._assembler&&this._assembler.updateRenderData(this))}else{if(2===this.cacheMode){const t=this._letterTexture,e=this._assembler.getAssemblerData();e!==t&&(this.destroyLetterTexture(),e&&e.addRef()),this._texture=this._letterTexture=e}else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new yD,this._assemblerData=this._assembler.getAssemblerData();const t=new Sm(this._assemblerData.canvas),e=new ff;e.image=t,this._ttfSpriteFrame.texture=e}2!==this.cacheMode&&(this._texture=this._ttfSpriteFrame),this.changeMaterialForDefine()}}changeMaterialForDefine(){if(!this._texture)return;let t=!1;if(2!==this.cacheMode){const e=this._texture.texture;if(e instanceof of){const i=e.getPixelFormat();t=1026===i||1025===i||1024===i}}this._instanceMaterialType=t?3:1,this.updateMaterial()}_updateBlendFunc(){super._updateBlendFunc()}},$M.HorizontalAlign=ZM,$M.VerticalAlign=QM,$M.Overflow=JM,$M.CacheMode=tP,$M._canvasPool=LE.getInstance(),s((xM=$M).prototype,"horizontalAlign",[yM],Object.getOwnPropertyDescriptor(xM.prototype,"horizontalAlign"),xM.prototype),s(xM.prototype,"verticalAlign",[bM],Object.getOwnPropertyDescriptor(xM.prototype,"verticalAlign"),xM.prototype),s(xM.prototype,"overflow",[vM],Object.getOwnPropertyDescriptor(xM.prototype,"overflow"),xM.prototype),s(xM.prototype,"font",[SM],Object.getOwnPropertyDescriptor(xM.prototype,"font"),xM.prototype),s(xM.prototype,"cacheMode",[TM],Object.getOwnPropertyDescriptor(xM.prototype,"cacheMode"),xM.prototype),CM=Za(xM.prototype,"_string",[vh],(function(){return"label"})),AM=Za(xM.prototype,"_horizontalAlign",[vh],(function(){return 1})),DM=Za(xM.prototype,"_verticalAlign",[vh],(function(){return 1})),EM=Za(xM.prototype,"_actualFontSize",[vh],(function(){return 0})),IM=Za(xM.prototype,"_fontSize",[vh],(function(){return 40})),MM=Za(xM.prototype,"_fontFamily",[vh],(function(){return"Arial"})),PM=Za(xM.prototype,"_lineHeight",[vh],(function(){return 40})),OM=Za(xM.prototype,"_overflow",[vh],(function(){return 0})),RM=Za(xM.prototype,"_enableWrapText",[vh],(function(){return!0})),BM=Za(xM.prototype,"_font",[vh],(function(){return null})),FM=Za(xM.prototype,"_isSystemFontUsed",[vh],(function(){return!0})),NM=Za(xM.prototype,"_spacingX",[vh],(function(){return 0})),LM=Za(xM.prototype,"_isItalic",[vh],(function(){return!1})),kM=Za(xM.prototype,"_isBold",[vh],(function(){return!1})),zM=Za(xM.prototype,"_isUnderline",[vh],(function(){return!1})),UM=Za(xM.prototype,"_underlineHeight",[vh],(function(){return 2})),VM=Za(xM.prototype,"_cacheMode",[vh],(function(){return 0})),jM=Za(xM.prototype,"_enableOutline",[vh],(function(){return!1})),HM=Za(xM.prototype,"_outlineColor",[vh],(function(){return new Ls(0,0,0,255)})),GM=Za(xM.prototype,"_outlineWidth",[vh],(function(){return 2})),WM=Za(xM.prototype,"_enableShadow",[vh],(function(){return!1})),XM=Za(xM.prototype,"_shadowColor",[vh],(function(){return new Ls(0,0,0,255)})),YM=Za(xM.prototype,"_shadowOffset",[vh],(function(){return new kr(2,2)})),qM=Za(xM.prototype,"_shadowBlur",[vh],(function(){return 2})),wM=xM))||wM)||wM);var iP,sP,rP,nP,oP,aP,hP,lP,cP,uP,dP,_P,pP,mP,gP,fP,yP,bP,vP,SP;t({Label:eP,LabelComponent:eP}),a.Label=eP;const TP={SIMPLE:0,SLICED:1,TILED:2,FILLED:3};fe(TP);const wP={HORIZONTAL:0,VERTICAL:1,RADIAL:2};fe(wP);const xP={CUSTOM:0,TRIMMED:1,RAW:2};fe(xP);let CP=(iP=ah("cc.Sprite"),sP=lh(110),rP=Xh(ED),nP=Xh(yD),oP=Xh(TP),aP=Xh(wP),hP=Xh(xP),iP(lP=sP((SP=class t extends uM{constructor(){super(),this._spriteFrame=uP&&uP(),this._type=dP&&dP(),this._fillType=_P&&_P(),this._sizeMode=pP&&pP(),this._fillCenter=mP&&mP(),this._fillStart=gP&&gP(),this._fillRange=fP&&fP(),this._isTrimmedMode=yP&&yP(),this._useGrayscale=bP&&bP(),this._atlas=vP&&vP()}get spriteAtlas(){return this._atlas}set spriteAtlas(t){this._atlas!==t&&(this._atlas=t)}get spriteFrame(){return this._spriteFrame}set spriteFrame(t){if(this._spriteFrame===t)return;const e=this._spriteFrame;this._spriteFrame=t,this._markForUpdateRenderData(),this._applySpriteFrame(e)}get type(){return this._type}set type(t){this._type!==t&&(this._type=t,this._flushAssembler())}get fillType(){return this._fillType}set fillType(t){this._fillType!==t&&(2===t||2===this._fillType?this.destroyRenderData():this.renderData&&this._markForUpdateRenderData(!0)),this._fillType=t,this._flushAssembler()}get fillCenter(){return this._fillCenter}set fillCenter(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,3===this._type&&this.renderData&&this._markForUpdateRenderData()}get fillStart(){return this._fillStart}set fillStart(t){this._fillStart=Ri(t,0,1),3===this._type&&this.renderData&&(this._markForUpdateRenderData(),this._updateUVs())}get fillRange(){return this._fillRange}set fillRange(t){this._fillRange=Ri(t,-1,1),3===this._type&&this.renderData&&(this._markForUpdateRenderData(),this._updateUVs())}get trim(){return this._isTrimmedMode}set trim(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,0===this._type&&this.renderData&&this._markForUpdateRenderData(!0))}get grayscale(){return this._useGrayscale}set grayscale(t){this._useGrayscale!==t&&(this._useGrayscale=t,this.changeMaterialForDefine(),this.updateMaterial())}get sizeMode(){return this._sizeMode}set sizeMode(t){this._sizeMode!==t&&(this._sizeMode=t,0!==t&&this._applySpriteSize())}__preload(){this.changeMaterialForDefine(),super.__preload()}onEnable(){super.onEnable(),this._activateMaterial();const t=this._spriteFrame;t&&(this._updateUVs(),1===this._type&&t.on("uv_updated",this._updateUVs,this))}onDisable(){super.onDisable(),this._spriteFrame&&1===this._type&&this._spriteFrame.off("uv_updated",this._updateUVs,this)}onDestroy(){super.onDestroy()}changeSpriteFrameFromAtlas(t){if(!this._atlas)return void j(16377);const e=this._atlas.getSpriteFrame(t);this.spriteFrame=e}changeMaterialForDefine(){let t;const e=this._instanceMaterialType;this._spriteFrame&&(t=this._spriteFrame.texture);let i=!1;if(t instanceof of){const e=t.getPixelFormat();i=1026===e||1025===e||1024===e}i&&this.grayscale?this._instanceMaterialType=4:i?this._instanceMaterialType=3:this.grayscale?this._instanceMaterialType=2:this._instanceMaterialType=1,e!==this._instanceMaterialType&&this.updateMaterial()}_updateBuiltinMaterial(){let t=super._updateBuiltinMaterial();if(this.spriteFrame&&this.spriteFrame.texture instanceof SD){const e=`rt-${t.name}`;let i=iC.get(e);i||(i=new fv(e),i.copy(t,{defines:{SAMPLE_FROM_RT:!0}}),iC.addAsset(e,i)),t=i}return t}_render(t){t.commitComp(this,this.renderData,this._spriteFrame,this._assembler,null)}_canRender(){if(!super._canRender())return!1;const t=this._spriteFrame;return!(!t||!t.texture)}_flushAssembler(){const e=this,i=t.Assembler.getAssembler(e);e._assembler!==i&&(e.destroyRenderData(),e._assembler=i),!e._renderData&&i&&i.createData&&((e._renderData=i.createData(e)).material=e.getRenderMaterial(0),e._markForUpdateRenderData(),e.spriteFrame&&i.updateUVs(e),e._updateColor());const s=e._spriteFrame;s&&(1===e._type?s.on("uv_updated",e._updateUVs,e):s.off("uv_updated",e._updateUVs,e))}_applySpriteSize(){const t=this,e=t._spriteFrame;if(e){const i=t.node._uiProps;if(2===t._sizeMode){const t=e.originalSize;i.uiTransformComp.setContentSize(t)}else if(1===t._sizeMode){const t=e.rect;i.uiTransformComp.setContentSize(t.width,t.height)}}}_resized(){}_activateMaterial(){const t=this._spriteFrame,e=this.getRenderMaterial(0);t&&e&&this._markForUpdateRenderData(),this.renderData&&(this.renderData.material=e)}_updateUVs(){this._assembler&&this._assembler.updateUVs(this)}_applySpriteFrame(t){const e=this,i=e._spriteFrame;t&&1===e._type&&t.off("uv_updated",e._updateUVs,e);let s=!1;i&&(t&&t.texture===i.texture||(s=!0),s&&(e.renderData&&(e.renderData.textureDirty=!0),(!!t&&t.texture instanceof SD)!=i.texture instanceof SD&&(e._instanceMaterialType=-1),e.changeMaterialForDefine()),e._applySpriteSize(),1===e._type&&i.on("uv_updated",e._updateUVs,e))}},SP.FillType=wP,SP.Type=TP,SP.SizeMode=xP,SP.EventType={SPRITE_FRAME_CHANGED:"spriteframe-changed"},s((cP=SP).prototype,"spriteAtlas",[rP],Object.getOwnPropertyDescriptor(cP.prototype,"spriteAtlas"),cP.prototype),s(cP.prototype,"spriteFrame",[nP],Object.getOwnPropertyDescriptor(cP.prototype,"spriteFrame"),cP.prototype),s(cP.prototype,"type",[oP],Object.getOwnPropertyDescriptor(cP.prototype,"type"),cP.prototype),s(cP.prototype,"fillType",[aP],Object.getOwnPropertyDescriptor(cP.prototype,"fillType"),cP.prototype),s(cP.prototype,"sizeMode",[hP],Object.getOwnPropertyDescriptor(cP.prototype,"sizeMode"),cP.prototype),uP=Za(cP.prototype,"_spriteFrame",[vh],(function(){return null})),dP=Za(cP.prototype,"_type",[vh],(function(){return 0})),_P=Za(cP.prototype,"_fillType",[vh],(function(){return 0})),pP=Za(cP.prototype,"_sizeMode",[vh],(function(){return 1})),mP=Za(cP.prototype,"_fillCenter",[vh],(function(){return new kr(0,0)})),gP=Za(cP.prototype,"_fillStart",[vh],(function(){return 0})),fP=Za(cP.prototype,"_fillRange",[vh],(function(){return 0})),yP=Za(cP.prototype,"_isTrimmedMode",[vh],(function(){return!0})),bP=Za(cP.prototype,"_useGrayscale",[vh],(function(){return!1})),vP=Za(cP.prototype,"_atlas",[vh],(function(){return null})),lP=cP))||lP)||lP);var AP;t({Sprite:CP,SpriteComponent:CP}),a.Sprite=CP;let DP=ah("cc.UIMeshRenderer")(AP=lh(110)(AP=class extends Km{constructor(){super(),this._modelComponent=null,this._dirtyVersion=-1,this._internalId=-1,this.stencilStage=0,this._renderData=null,this._renderEntity=new KI(1),this._UIModelNativeProxy=new aI}get modelComponent(){return this._modelComponent}__preload(){this.node._uiProps.uiComp=this}onEnable(){pw.addRenderer(this),this._markForUpdateRenderData()}onDisable(){pw.removeRenderer(this),this.renderEntity.enabled=this._canRender()}onLoad(){this.node._getUITransformComp()||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.ModelRenderer"),this._modelComponent?(this._UIModelNativeProxy.attachNode(this.node),this.renderEntity.setNode(this.node)):j(16378,this.node?this.node.name:"")}onDestroy(){this.renderEntity.setNode(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this._modelComponent=this.getComponent("cc.ModelRenderer"),this._modelComponent&&(this._modelComponent._sceneGetter=null)}_render(t){if(this._modelComponent){const e=this._modelComponent._collectModels();this._modelComponent._detachFromScene();for(let i=0;i<e.length;i++)e[i].enabled&&t.commitModel(this,e[i],this._modelComponent.material);return!0}return!1}fillBuffers(t){this.enabled&&this._render(t)}updateRenderer(){if(this.renderEntity.enabled=this._canRender(),this._modelComponent){const t=this._modelComponent._collectModels();this._modelComponent._detachFromScene(),this._UIModelNativeProxy.clearModels(),this._renderEntity.clearDynamicRenderDrawInfos();for(let e=0;e<t.length;e++)t[e].enabled&&(this._uploadRenderData(e),this._UIModelNativeProxy.updateModels(t[e]));this._UIModelNativeProxy.attachDrawInfo()}}_uploadRenderData(t){{const e=bI.add();e.initRenderDrawInfo(this,1),this._renderData=e,this._renderData.material=this._modelComponent.getMaterialInstance(t)}}postUpdateAssembler(t){}update(){this._modelComponent&&this._markForUpdateRenderData(),this._fitUIRenderQueue()}_fitUIRenderQueue(){if(!this._modelComponent)return;const t=this._modelComponent.sharedMaterials.length;for(let e=0;e<t;e++){const t=this._modelComponent.getMaterialInstance(e);if(null==t)continue;const i=t.passes,s=i.length;for(let e=0;e<s;e++)i[e].setPriority(244),t.recompileShaders({CC_FORCE_FORWARD_SHADING:!0},e)}}markForUpdateRenderData(t=!0){this._markForUpdateRenderData(t)}_markForUpdateRenderData(t=!0){pw.markDirtyRenderer(this)}setNodeDirty(){}setTextureDirty(){}_canRender(){return this.enabled&&null!==this._modelComponent}get renderEntity(){return this._renderEntity}get renderData(){return this._renderData}})||AP)||AP;var EP;t({UIMeshRenderer:DP,UIModelComponent:DP}),a.UIMeshRenderer=DP;let IP,MP=ah("cc.LabelOutline")(EP=lh(110)(EP=hh(eP)(EP=class extends Km{get color(){return this.node.getComponent(eP).outlineColor}set color(t){this.node.getComponent(eP).outlineColor=t}get width(){return this.node.getComponent(eP).outlineWidth}set width(t){this.node.getComponent(eP).outlineWidth=t}onEnable(){this.node.getComponent(eP).enableOutline=!0}onDisable(){this.node.getComponent(eP).enableOutline=!1}})||EP)||EP)||EP;t({LabelOutline:MP,LabelOutlineComponent:MP}),a.LabelOutline=MP,function(t){t[t.NONE=0]="NONE",t[t.INSTANCING=1]="INSTANCING"}(IP||(IP={}));const PP=jsb.Pass;PP.prototype.getUniform=function(t,e){const i=this._getUniform(t);if("object"==typeof i)if(i.type)switch(i.type){case 0:kr.copy(e,i);break;case 1:Ms.copy(e,i);break;case 2:ms.copy(e,i);break;case 8:e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w;break;case 4:js.copy(e,i);break;case 5:vr.copy(e,i);break;case 3:sr.copy(e,i);break;default:console.error(`getUniform, unknown object type: ${i.type}`)}else console.error(`getUniform, unknown object: ${i}`);else"number"==typeof i?e=i:console.error(`getUniform, not supported: ${i}`);return e};const OP=Hy.Enum.NONE|Hy.Enum.UI_3D;class RP{constructor(){this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._passes=[],this._shaders=[],this.visFlags=OP,this.inputAssembler=null,this.descriptorSet=null}get passes(){return this._passes}get shaders(){return this._shaders}destroy(t){this._passes=[]}clear(){this.inputAssembler=null,this.descriptorSet=null,this.texture=null,this.sampler=null,this.textureHash=0,this.samplerHash=0,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=OP}fillPasses(t,e,i,s){if(t){const r=t.passes;if(!r)return;this._shaders.length=r.length;for(let t=0;t<r.length;t++){this._passes[t]||(this._passes[t]=new PP(a.director.root));const n=r[t],o=this._passes[t];n.update(),e||(e=n.depthStencilState,i=0),o._initPassFromTarget(n,e,i),this._shaders[t]=o.getShaderVariant(s)}}}}var BP,FP;let NP=ah("cc.UIStaticBatch")(BP=lh(110)((FP=class extends uM{constructor(){super(),this._init=!1,this._bufferAccessor=null,this._dirty=!0,this._uiDrawBatchList=[]}get color(){return this._color}set color(t){this._color!==t&&this._color.set(t)}get drawBatchList(){return this._uiDrawBatchList}postUpdateAssembler(t){}markAsDirty(){}_requireDrawBatch(){const t=new RP;return t.isStatic=!0,this._uiDrawBatchList.push(t),t}_clearData(){if(this._bufferAccessor){this._bufferAccessor.reset();const t=this._getBatcher();for(let e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1}_getBatcher(){return nC.root&&nC.root.batcher2D?nC.root.batcher2D:(j(9301),null)}},s(FP.prototype,"color",[Yh],Object.getOwnPropertyDescriptor(FP.prototype,"color"),FP.prototype),BP=FP))||BP)||BP;var LP;t({UIStaticBatch:NP,UIStaticBatchComponent:NP});let kP=t("LabelShadow",ah("cc.LabelShadow")(LP=lh(110)(LP=hh(eP)(LP=class extends Km{get color(){return this.node.getComponent(eP).shadowColor}set color(t){this.node.getComponent(eP).shadowColor=t}get offset(){return this.node.getComponent(eP).shadowOffset}set offset(t){this.node.getComponent(eP).shadowOffset=t}get blur(){return this.node.getComponent(eP).shadowBlur}set blur(t){this.node.getComponent(eP).shadowBlur=t}onEnable(){this.node.getComponent(eP).enableShadow=!0}onDisable(){this.node.getComponent(eP).enableShadow=!1}})||LP)||LP)||LP);var zP,UP,VP;let jP=ah("cc.UIOpacity")(zP=lh(110)(zP=ch((UP=class extends Km{constructor(){super(),this._opacity=VP&&VP()}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(t=Ri(t,0,255),this._opacity=t,this._syncLocalOpacity(t/255))}onEnable(){this._syncLocalOpacity(this._opacity/255)}onDisable(){this._syncLocalOpacity(1)}_syncLocalOpacity(t){this.node._uiProps.localOpacity=t}},VP=Za(UP.prototype,"_opacity",[vh],(function(){return 255})),zP=UP))||zP)||zP)||zP;t({UIOpacity:jP,UIOpacityComponent:jP});const HP=4227858432,GP=66060288,WP=1044480,XP=t=>(t&HP)>>>26,YP=t=>(t&GP)>>>20,qP={0:(t,e,i=0)=>j(12010,i),5:(t,e,i=0)=>t[i],6:(t,e,i=0)=>kr.fromArray(e,t,i),7:(t,e,i=0)=>Ms.fromArray(e,t,i),8:(t,e,i=0)=>ms.fromArray(e,t,i),13:(t,e,i=0)=>t[i],14:(t,e,i=0)=>kr.fromArray(e,t,i),15:(t,e,i=0)=>Ms.fromArray(e,t,i),16:(t,e,i=0)=>ms.fromArray(e,t,i),21:(t,e,i=0)=>js.fromArray(e,t,i),25:(t,e,i=0)=>vr.fromArray(e,t,i)},$P={0:(t,e,i=0)=>j(12010,i),5:(t,e,i=0)=>t[i]=e,6:(t,e,i=0)=>kr.toArray(t,e,i),7:(t,e,i=0)=>Ms.toArray(t,e,i),8:(t,e,i=0)=>ms.toArray(t,e,i),13:(t,e,i=0)=>t[i]=e,14:(t,e,i=0)=>kr.toArray(t,e,i),15:(t,e,i=0)=>Ms.toArray(t,e,i),16:(t,e,i=0)=>ms.toArray(t,e,i),21:(t,e,i=0)=>js.toArray(t,e,i),25:(t,e,i=0)=>vr.toArray(t,e,i)},KP={5:t=>"number"==typeof t,13:t=>"number"==typeof t,6:t=>!!(t instanceof kr),14:t=>!!(t instanceof kr),7:t=>!!(t instanceof Ms),15:t=>!!(t instanceof Ms),8:t=>!!(t instanceof ms),16:t=>!!(t instanceof ms||t instanceof Ls||t instanceof sr),21:t=>!!(t instanceof js),25:t=>!!(t instanceof vr)},ZP=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function QP(t){switch(t){case 1:case 5:case 9:case 13:return ZP[0];case 2:case 6:case 10:case 14:return ZP[1];case 4:case 8:case 12:case 16:return ZP[2];case 25:return ZP[3];case 28:return"default-texture";case 31:return"default-cube-texture";case 29:return"default-array-texture";case 30:return"default-3d-texture"}return ZP[0]}function JP(t){switch(t){case 28:return"-texture";case 31:return"-cube-texture";case 29:return"-array-texture";case 30:return"-3d-texture";default:return"-unknown"}}function tO(t,e){const i=Object.entries(e);let s=!1;for(let e=0;e<i.length;e++)t[i[e][0]]!==i[e][1]&&(t[i[e][0]]=i[e][1],s=!0);return s}const eO=jsb.ProgramLib.getInstance();function iO(t){return--t,t|=t>>16,t|=t>>8,t|=t>>4,t|=t>>2,t|=t>>1,++t}function sO(t,e){return Math.ceil(t/e)*e}a.programLib=eO;class rO{constructor(t){this._format=0,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new t_,this._region1=new t_,this._region2=new t_,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=t}initialize(t){const e=tp[t.format];this._format=t.format,this._formatSize=e.size,this._channels=e.count,this._bufferViewCtor=ap(e),this._roundUpFn=t.roundUpFn||null,this._alignment=t.alignment||1,t.inOrderFree&&(this.alloc=this._McDonaldAlloc)}destroy(){for(let t=0;t<this._chunkCount;++t)this._chunks[t].texture.destroy();this._chunks.length=0,this._handles.length=0}alloc(t,e){t=sO(t,this._alignment);let i=-1,s=-1;if(void 0!==e&&(i=e,s=this._findAvailableSpace(t,i)),s<0)for(let e=0;e<this._chunkCount&&(i=e,s=this._findAvailableSpace(t,i),!(s>=0));++e);if(s>=0){const e=this._chunks[i];e.start+=t;const r={chunkIdx:i,start:s,end:s+t,texture:e.texture};return this._handles.push(r),r}const r=Math.sqrt(t/this._formatSize),n=this._roundUpFn&&this._roundUpFn(r,this._formatSize)||Math.max(1024,iO(r)),o=this._chunks[this.createChunk(n)];o.start+=t;const a={chunkIdx:this._chunkCount-1,start:0,end:t,texture:o.texture};return this._handles.push(a),a}free(t){for(let e=0;e<this._handles.length;++e)if(this._handles[e]===t)return this._chunks[t.chunkIdx].end=t.end,void this._handles.splice(e,1)}createChunk(t){const e=t*t*this._formatSize;R(`TextureBufferPool: Allocate chunk ${this._chunkCount}, size: ${e}, format: ${this._format}`);const i={texture:this._device.createTexture(new d_(1,6,this._format,t,t)),size:e,start:0,end:e};return this._chunks[this._chunkCount]=i,this._chunkCount++}update(t,e){const i=[],s=[],r=t.start/this._formatSize;let n=e.byteLength/this._formatSize,o=r%t.texture.width,a=Math.floor(r/t.texture.width),h=Math.min(t.texture.width-o,n),l=0;o>0&&(this._region0.texOffset.x=o,this._region0.texOffset.y=a,this._region0.texExtent.width=h,this._region0.texExtent.height=1,i.push(new this._bufferViewCtor(e,l*this._formatSize,h*this._channels)),s.push(this._region0),o=0,a+=1,n-=h,l+=h),n>0&&(this._region1.texOffset.x=o,this._region1.texOffset.y=a,n>t.texture.width?(this._region1.texExtent.width=t.texture.width,this._region1.texExtent.height=Math.floor(n/t.texture.width),h=this._region1.texExtent.width*this._region1.texExtent.height):(h=n,this._region1.texExtent.width=h,this._region1.texExtent.height=1),i.push(new this._bufferViewCtor(e,l*this._formatSize,h*this._channels)),s.push(this._region1),o=0,a+=this._region1.texExtent.height,n-=h,l+=h),n>0&&(this._region2.texOffset.x=o,this._region2.texOffset.y=a,this._region2.texExtent.width=n,this._region2.texExtent.height=1,i.push(new this._bufferViewCtor(e,l*this._formatSize,n*this._channels)),s.push(this._region2)),this._device.copyBuffersToTexture(i,t.texture,s)}_findAvailableSpace(t,e){const i=this._chunks[e];let s=!1,r=i.start;if(r+t<=i.size)s=!0;else{r=0;const n=this._handles.filter((t=>t.chunkIdx===e)).sort(((t,e)=>t.start-e.start));for(let e=0;e<n.length;e++){const i=n[e];if(r+t<=i.start){s=!0;break}r=i.end}!s&&r+t<=i.size&&(s=!0)}return s?r:-1}_McDonaldAlloc(t){t=sO(t,this._alignment);for(let e=0;e<this._chunkCount;++e){const i=this._chunks[e];let s=!1,r=i.start;if(r+t<=i.end?s=!0:r>i.end?r+t<=i.size?s=!0:t<=i.end&&(i.start=r=0,s=!0):r===i.end&&(i.start=r=0,i.end=i.size,t<=i.end&&(s=!0)),s){i.start+=t;const s={chunkIdx:e,start:r,end:r+t,texture:i.texture};return this._handles.push(s),s}}const e=Math.sqrt(t/this._formatSize),i=this._roundUpFn&&this._roundUpFn(e,this._formatSize)||Math.max(1024,iO(e)),s=this._chunks[this.createChunk(i)];s.start+=t;const r={chunkIdx:this._chunkCount,start:0,end:t,texture:s.texture};return this._handles.push(r),r}}const nO=jsb.NativeBufferPool;jsb.NativeObjectPool,jsb.NativeBufferAllocator;class oO{constructor(t,e,i,s,r=8){this._arrayBuffers=[],this._freeLists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._elementCount=s.COUNT,this._entryBits=r,this._dataType=e,this._dataMembers=i,this._stride=4*this._elementCount,this._entriesPerChunk=1<<r,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new nO(t,r,this._stride);let n=2,o=!1,a=!1;for(const t in e){if(o=this._hasFloat32,a=this._hasUint32,a&&o)break;n=e[t],o||1!==n?a||0!==n||(this._hasUint32=!0):this._hasFloat32=!0}}alloc(){let t=0;for(;t<this._freeLists.length;t++){const e=this._freeLists[t];if(e.length){const i=e[e.length-1];return e.length--,(t<<this._entryBits)+i+this._poolFlag}}const e=this._nativePool.allocateNewChunk(),i=[],s=[],r=[],n=this._hasFloat32,o=this._hasUint32;for(let t=0;t<this._entriesPerChunk;t++)n&&i.push(new Float32Array(e,this._stride*t,this._elementCount)),o&&s.push(new Uint32Array(e,this._stride*t,this._elementCount)),t&&r.push(t);return o&&this._uint32BufferViews.push(s),n&&this._float32BufferViews.push(i),this._freeLists.push(r),this._arrayBuffers.push(e),(t<<this._entryBits)+this._poolFlag}getBuffer(t){const e=(this._chunkMask&t)>>this._entryBits,i=this._entryMask&t;return(this._hasFloat32?this._float32BufferViews:this._uint32BufferViews)[e][i]}getTypedArray(t,e){const i=(this._chunkMask&t)>>this._entryBits,s=this._entryMask&t,r=e,n=(0===this._dataType[e]?this._uint32BufferViews:this._float32BufferViews)[i][s],o=this._dataMembers[e];return n.subarray(r,r+o)}free(t){const e=(this._chunkMask&t)>>this._entryBits,i=this._entryMask&t;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[e][i].fill(0),this._freeLists[e].push(i)}}const aO={POSITION:0,UV:3,COLOR:5,COUNT:9},hO=new oO(3,{0:1,3:1,5:0,9:2},{0:3,3:2,5:4,9:1},aO),lO={DIRTY_FLAG:0,LAYER:1,WORLD_SCALE:2,WORLD_POSITION:5,WORLD_ROTATION:8,WORLD_MATRIX:12,LOCAL_SCALE:28,LOCAL_POSITION:31,LOCAL_ROTATION:34,COUNT:38},cO=new oO(0,{0:0,1:0,2:1,5:1,8:1,12:1,28:1,31:1,34:1,38:2},{0:1,1:1,2:3,5:3,8:4,12:16,28:3,31:3,34:4,38:1},lO),uO={PRIORITY:0,STAGE:1,PHASE:2,PRIMITIVE:3,BATCHING_SCHEME:4,DYNAMIC_STATE:5,HASH:6,COUNT:7},dO=new oO(1,{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:2},{0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1},uO),_O={CENTER:0,HALFEXTENTS:3,COUNT:6},pO=new oO(2,{0:1,3:1,6:2},{0:3,3:3,6:1},_O),mO=jsb.RenderScene.prototype;Object.defineProperty(mO,"mainLight",{enumerable:!0,configurable:!0,get(){return this.getMainLight()}});const gO=jsb.RenderScene,fO=jsb.RenderWindow;pe({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048});const yO=pe({Planar:0,ShadowMap:1});pe({HARD:0,SOFT:1,SOFT_2X:2,SOFT_4X:3}),pe({LEVEL_1:1,LEVEL_2:2,LEVEL_3:3,LEVEL_4:4}),pe({NONE:1,RemoveDuplicates:2,DisableRotationFix:3});const bO=yO.ShadowMap+1;class vO{constructor(){this.fixedSphere=new gn(0,0,0,.01),this.maxReceived=4,this._matLight=new vr,this._material=null,this._instancingMaterial=null,this._enabled=!1,this._type=bO,this._distance=0,this._planeBias=1,this._normal=new Ms(0,1,0),this._shadowColor=new Ls(0,0,0,76),this._size=new kr(1024,1024),this._shadowMapDirty=!1}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this.activate()}get type(){return this._type}set type(t){this._type=this.enabled?t:bO,this.activate()}get normal(){return this._normal}set normal(t){Ms.copy(this._normal,t)}get distance(){return this._distance}set distance(t){this._distance=t}get planeBias(){return this._planeBias}set planeBias(t){this._planeBias=t}get shadowColor(){return this._shadowColor}set shadowColor(t){this._shadowColor=t}get size(){return this._size}set size(t){this._size.set(t)}get shadowMapDirty(){return this._shadowMapDirty}set shadowMapDirty(t){this._shadowMapDirty=t}get matLight(){return this._matLight}get material(){return this._material}get instancingMaterial(){return this._instancingMaterial}getPlanarShader(t){this._material||(this._material=new fv,this._material.initialize({effectName:"pipeline/planar-shadow"}));const e=this._material.passes;return e.length>0?e[0].getShaderVariant(t):null}initialize(t){this._enabled=t.enabled,this._type=this.enabled?t.type:bO,this.normal=t.planeDirection,this.distance=t.planeHeight,this.planeBias=t.planeBias,this.shadowColor=t.shadowColor,this.maxReceived=t.maxReceived,t.shadowMapSize!==this._size.x&&(this.size.set(t.shadowMapSize,t.shadowMapSize),this._shadowMapDirty=!0)}activate(){if(this._enabled)if(this.type===yO.Planar)this._updatePlanarInfo();else{const t=a.director.root;t.pipeline.macros.CC_SHADOW_TYPE=2,t.onGlobalPipelineStateChanged()}else{const t=a.director.root;t.pipeline.macros.CC_SHADOW_TYPE=0,t.onGlobalPipelineStateChanged()}}_updatePlanarInfo(){this._material||(this._material=new fv,this._material.initialize({effectName:"pipeline/planar-shadow"}));const t=a.director.root;t.pipeline.macros.CC_SHADOW_TYPE=1,t.onGlobalPipelineStateChanged()}destroy(){this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this.fixedSphere.destroy()}}vO.MAX_FAR=2e3,vO.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),a.Shadows=vO,J(gO.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),J(gO.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]),J(mb.prototype,"Model.prototype",[{name:"isInstancingEnabled"},{name:"instancedAttributes"}]);const SO={};J(SO,"CameraVisFlags",[{name:"GENERAL"}]),Q(SO,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:Hy.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Hy.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Hy.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Hy.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Hy.BitMask,targetName:"UI_2D"}]),h.CameraVisFlags=SO;const TO={};J(TO,"VisibilityFlags",[{name:"GENERAL"}]),Q(TO,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:Hy.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:Hy.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Hy.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Hy.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Hy.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Hy.Enum,targetName:"UI_2D"}]),h.VisibilityFlags=TO,Q(PP.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),J(Ib.prototype,"Camera.prototype",[{name:"getSplitFrustum"},{name:"setMatView"},{name:"setMatViewInv"},{name:"setMatProjInv"},{name:"setMatViewProjInv"},{name:"setMatProj"},{name:"setMatViewProj"},{name:"getMatViewInv"}]),J(vO.prototype,"Shadows.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"},{name:"fixedArea"},{name:"pcf"},{name:"bias"},{name:"normalBias"},{name:"near"},{name:"far"},{name:"shadowDistance"},{name:"invisibleOcclusionRange"},{name:"orthoSize"},{name:"saturation"}]),J(Xb.prototype,"SpotLight.prototype",[{name:"aspect"}]),Q(yb.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),J(yb.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]);var wO=Object.freeze({__proto__:null,AABBPool:pO,AABBView:_O,get BatchingSchemes(){return IP},CameraVisFlags:SO,MaterialInstance:BI,NULL_HANDLE:0,NodePool:cO,NodeView:lO,Pass:PP,PassInstance:class extends PP{get parent(){return this._parent}constructor(t,e){super(t.root),this._dontNotify=!1,this._parent=t,this._owner=e,this._doInit(this._parent,!0),this._shaderInfo.blocks.forEach((t=>{const e=this._blocks[t.binding],i=this._parent.blocks[t.binding];e.set(i)})),this._rootBufferDirty=!0;const i=this._parent,s=this._descriptorSet;this._shaderInfo.samplerTextures.forEach((t=>{for(let e=0;e<t.count;e++){const r=i._descriptorSet,n=t.binding,o=r.getSampler(n,e),a=r.getTexture(n,e);s.bindSampler(n,o,e),s.bindTexture(n,a,e)}})),super.tryCompile()}overridePipelineStates(t,e){this._bs.reset(),this._rs.reset(),this._dss.reset(),PP.fillPipelineInfo(this,t),PP.fillPipelineInfo(this,e),this._onStateChange()}tryCompile(t){if(t&&!tO(this._defines,t))return!1;const e=super.tryCompile();return this._onStateChange(),e}beginChangeStatesSilently(){this._dontNotify=!0}endChangeStatesSilently(){this._dontNotify=!1}_syncBatchingScheme(){this._defines.USE_INSTANCING=!1,this._batchingScheme=0}_onStateChange(){this._hash=PP.getPassHash(this),this._owner.onPassStateChange(this._dontNotify)}},PassPool:dO,PassStage:{DEFAULT:1,FORWARD:2,SHADOWCAST:4},PassView:uO,PoolType:{NODE:0,PASS:1,AABB:2,RENDER2D:3},Render2dPool:hO,Render2dView:aO,RenderQueue:{OPAQUE:0,TRANSPARENT:1,OVERLAY:2},RenderScene:gO,RenderWindow:fO,TextureBufferPool:rO,VisibilityFlags:TO,createIA:function(t,e){if(!e.positions)return G(16306),null;const i=[],s=e.positions.length/3;for(let t=0;t<s;++t)i.push(e.positions[3*t],e.positions[3*t+1],e.positions[3*t+2]),e.normals&&i.push(e.normals[3*t],e.normals[3*t+1],e.normals[3*t+2]),e.uvs&&i.push(e.uvs[2*t],e.uvs[2*t+1]),e.colors&&i.push(e.colors[3*t],e.colors[3*t+1],e.colors[3*t+2]);const r=[];r.push(new x_("a_position",32)),e.normals&&r.push(new x_("a_normal",32)),e.uvs&&r.push(new x_("a_texCoord",21)),e.colors&&r.push(new x_("a_color",32));const n=t.createBuffer(new a_(10,1,4*i.length,4*i.length/s));n.update(new Float32Array(i));let o=null;return e.indices&&(o=t.createBuffer(new a_(6,1,2*e.indices.length,2)),o.update(new Uint16Array(e.indices))),t.createInputAssembler(new A_(r,[n],o))},customizeType:(t,e)=>67108863&t|e<<26&HP,genHandle:(t,e,i,s=0)=>e<<26&HP|t<<20&GP|i<<12&WP|4095&s,getBindingFromHandle:YP,getCountFromHandle:t=>(t&WP)>>>12,getDefaultFromType:QP,getDeviceShaderVersion:function(t){switch(t.gfxAPI){case td.GLES2:case td.WEBGL:return"glsl1";case td.GLES3:case td.WEBGL2:return"glsl3";default:return"glsl4"}},getOffsetFromHandle:t=>4095&t,getStringFromType:JP,getTypeFromHandle:XP,nearestPOT:iO,overrideMacros:tO,programLib:eO,scene:dv,type2reader:qP,type2validator:KP,type2writer:$P});t("renderer",wO);const xO={BUTT:0,ROUND:1,SQUARE:2};fe(xO);const CO={BEVEL:0,ROUND:1,MITER:2};fe(CO),fe({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});const AO=Math.PI,DO=Math.min,EO=Math.max,IO=Math.cos,MO=Math.sin,PO=Math.abs,OO=Math.sign,RO=.5522847493;function BO(t,e,i,s,r,n,o){let a=0,h=0,l=0,c=0,u=0,d=0,_=0,p=0,m=0,g=0,f=0,y=0,b=0,v=0,S=0,T=0;if(h=n-r,o=o||!1)if(PO(h)>=2*AO)h=2*AO;else for(;h<0;)h+=2*AO;else if(PO(h)>=2*AO)h=2*-AO;else for(;h>0;)h-=2*AO;for(T=0|EO(1,DO(PO(h)/(.5*AO)+.5,5)),l=h/T/2,c=PO(4/3*(1-IO(l))/MO(l)),o||(c=-c),S=0;S<=T;S++)a=r+h*(S/T),u=IO(a),d=MO(a),_=e+u*s,p=i+d*s,m=-d*s*c,g=u*s*c,0===S?t.moveTo(_,p):t.bezierCurveTo(f+b,y+v,_-m,p-g,_,p),f=_,y=p,b=m,v=g}function FO(t,e,i,s,r){t.moveTo(e-s,i),t.bezierCurveTo(e-s,i+r*RO,e-s*RO,i+r,e,i+r),t.bezierCurveTo(e+s*RO,i+r,e+s,i+r*RO,e+s,i),t.bezierCurveTo(e+s,i-r*RO,e+s*RO,i-r,e,i-r),t.bezierCurveTo(e-s*RO,i-r,e-s,i-r*RO,e-s,i),t.close()}function NO(t,e,i,s,r,n){if(n<.1)t.rect(e,i,s,r);else{const o=DO(n,.5*PO(s))*OO(s),a=DO(n,.5*PO(r))*OO(r);t.moveTo(e,i+a),t.lineTo(e,i+r-a),t.bezierCurveTo(e,i+r-a*(1-RO),e+o*(1-RO),i+r,e+o,i+r),t.lineTo(e+s-o,i+r),t.bezierCurveTo(e+s-o*(1-RO),i+r,e+s,i+r-a*(1-RO),e+s,i+r-a),t.lineTo(e+s,i+a),t.bezierCurveTo(e+s,i+a*(1-RO),e+s-o*(1-RO),i,e+s-o,i),t.lineTo(e+o,i),t.bezierCurveTo(e+o*(1-RO),i,e,i+a*(1-RO),e,i+a),t.close()}}function LO(t,e,i,s,r,n,o,a,h,l,c){let u=0,d=0,_=0,p=0,m=0,g=0,f=0,y=0,b=0,v=0,S=0,T=0,w=0,x=0,C=0,A=0;l>10||(u=.5*(e+s),d=.5*(i+r),_=.5*(s+n),p=.5*(r+o),m=.5*(n+a),g=.5*(o+h),f=.5*(u+_),y=.5*(d+p),w=a-e,x=h-i,C=PO((s-a)*x-(r-h)*w),A=PO((n-a)*x-(o-h)*w),(C+A)*(C+A)<t.tessTol*(w*w+x*x)?t.addPoint(a,h,0===c?4|c:c):(b=.5*(_+m),v=.5*(p+g),S=.5*(f+b),T=.5*(y+v),LO(t,e,i,u,d,f,y,S,T,l+1,0),LO(t,S,T,b,v,m,g,a,h,l+1,c)))}let kO=class extends kr{constructor(t,e){super(t,e),this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0}reset(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0}};class zO{constructor(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[]}reset(){this.closed=!1,this.bevel=0,this.complex=!0,this.points.length=0}}class UO{constructor(t){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=Ls.WHITE.clone(),this.lineCap=0,this.strokeColor=Ls.BLACK.clone(),this.lineJoin=2,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null,this._comp=t}moveTo(t,e){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(t,e,1),this._commandX=t,this._commandY=e}lineTo(t,e){this.addPoint(t,e,1),this._commandX=t,this._commandY=e}bezierCurveTo(t,e,i,s,r,n){const o=this._curPath,a=o.points[o.points.length-1];a&&(a.x!==t||a.y!==e||i!==r||s!==n?(LO(this,a.x,a.y,t,e,i,s,r,n,0,1),this._commandX=r,this._commandY=n):this.lineTo(r,n))}quadraticCurveTo(t,e,i,s){const r=this._commandX,n=this._commandY;this.bezierCurveTo(r+2/3*(t-r),n+2/3*(e-n),i+2/3*(t-i),s+2/3*(e-s),i,s)}arc(t,e,i,s,r,n){BO(this,t,e,i,s,r,n)}ellipse(t,e,i,s){FO(this,t,e,i,s),this._curPath.complex=!1}circle(t,e,i){FO(this,t,e,i,i),this._curPath.complex=!1}rect(t,e,i,s){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+s),this.lineTo(t,e+s),this.close(),this._curPath.complex=!1}roundRect(t,e,i,s,r){NO(this,t,e,i,s,r),this._curPath.complex=!1}clear(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;const t=this._renderDataList;for(let e=0,i=t.length;e<i;e++){const i=t[e];i&&(bI.remove(i),this._comp.renderEntity.clearRenderDrawInfos())}this._renderDataList.length=0}close(){this._curPath.closed=!0}requestRenderData(){const t=bI.add();return this._renderDataList.push(t),t.initRenderDrawInfo(this._comp,1),t.material=this._comp.getMaterialInstance(0),this._comp.setRenderData(t),t}getRenderDataList(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList}addPoint(t,e,i){const s=this._curPath;if(!s)return;const r=this._points,n=s.points;let o=r[this.pointsOffset++];o?(o.x=t,o.y=e):(o=new kO(t,e),r.push(o)),o.flags=i,n.push(o)}_addPath(){const t=this.pathLength;let e=this.paths[t];return e?e.reset():(e=new zO,this.paths.push(e)),this.pathLength++,this._curPath=e,e}}var VO,jO,HO,GO,WO,XO,YO,qO,$O,KO,ZO,QO,JO;const tR=ZE.concat([new x_("a_dist",11)]),eR=iI(tR),iR=sI(tR);let sR=(VO=ah("cc.Graphics"),jO=lh(110),HO=Xh(CO),GO=Xh(xO),VO(WO=jO((JO=class t extends uM{get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.impl&&(this.impl.lineWidth=t)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin=t,this.impl&&(this.impl.lineJoin=t)}get lineCap(){return this._lineCap}set lineCap(t){this._lineCap=t,this.impl&&(this.impl.lineCap=t)}get strokeColor(){return this._strokeColor}set strokeColor(t){this.impl&&(this._strokeColor.set(t),this.impl.strokeColor=this._strokeColor)}get fillColor(){return this._fillColor}set fillColor(t){this.impl&&(this._fillColor.set(t),this.impl.fillColor=this._fillColor)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit=t}get color(){return this._color}set color(t){this._color!==t&&this._color.set(t)}get graphicsNativeProxy(){return this._graphicsNativeProxy}constructor(){super(),this.impl=null,this.model=null,this._lineWidth=YO&&YO(),this._strokeColor=qO&&qO(),this._lineJoin=$O&&$O(),this._lineCap=KO&&KO(),this._fillColor=ZO&&ZO(),this._miterLimit=QO&&QO(),this._isDrawing=!1,this._isNeedUploadData=!0,this._graphicsUseSubMeshes=[],this._instanceMaterialType=0,this.impl=new UO(this),this._graphicsNativeProxy=new aI}onRestore(){this.impl||this._flushAssembler()}onLoad(){super.onLoad(),this._graphicsNativeProxy.initModel(this.node),this.model=this._graphicsNativeProxy.getModel(),this._flushAssembler()}onEnable(){super.onEnable(),this._updateMtlForGraphics()}onDestroy(){this._sceneGetter=null,this._graphicsNativeProxy.destroy(),this.model=null,this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null),super.onDestroy()}moveTo(t,e){this.impl&&this.impl.moveTo(t,e)}lineTo(t,e){this.impl&&this.impl.lineTo(t,e)}bezierCurveTo(t,e,i,s,r,n){this.impl&&this.impl.bezierCurveTo(t,e,i,s,r,n)}quadraticCurveTo(t,e,i,s){this.impl&&this.impl.quadraticCurveTo(t,e,i,s)}arc(t,e,i,s,r,n){this.impl&&this.impl.arc(t,e,i,s,r,n)}ellipse(t,e,i,s){this.impl&&this.impl.ellipse(t,e,i,s)}circle(t,e,i){this.impl&&this.impl.circle(t,e,i)}rect(t,e,i,s){this.impl&&this.impl.rect(t,e,i,s)}roundRect(t,e,i,s,r){this.impl&&this.impl.roundRect(t,e,i,s,r)}fillRect(t,e,i,s){this.rect(t,e,i,s),this.fill()}clear(){this.impl&&(this.impl.clear(),this._isDrawing=!1,this._graphicsNativeProxy.clear(),this._markForUpdateRenderData())}close(){this.impl&&this.impl.close()}stroke(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)}fill(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)}_updateMtlForGraphics(){let t;this._customMaterial?t=this.getMaterialInstance(0):(t=iC.get("ui-graphics-material"),this.setSharedMaterial(t,0),t=this.getMaterialInstance(0),t.recompileShaders({USE_LOCAL:!0}))}activeSubModel(t){if(this.model){if(this.model.subModels.length<=t){const e=yp.gfxDevice,i=e.createBuffer(new a_(10,1,65535*iR,iR)),s=e.createBuffer(new a_(6,1,262140,2)),r=new wD([i],tR,7,s);r.subMeshIdx=0,this.model.initSubModel(t,r,this.getMaterialInstance(0)),this._graphicsUseSubMeshes.push(r)}}else j(4500,this.node.name)}_uploadData(){const t=this.impl;if(!t)return;const e=t&&t.getRenderDataList();if(e.length<=0||!this.model)return;const i=this.model.subModels;for(let t=0;t<e.length;t++){const s=e[t],r=i[t].inputAssembler;if(s.lastFilledVertex===s.vertexStart)continue;const n=new Float32Array(s.vData.buffer,0,s.vertexStart*eR);r.vertexBuffers[0].update(n),r.vertexCount=s.vertexStart;const o=new Uint16Array(s.iData.buffer,0,s.indexStart);r.indexBuffer.update(o),r.indexCount=s.indexStart,s.lastFilledVertex=s.vertexStart,s.lastFilledIndex=s.indexStart}this._isNeedUploadData=!1}_render(t){if(this._isNeedUploadData){if(this.impl){const t=this.impl.getRenderDataList(),e=this.model.subModels.length;if(t.length>e)for(let i=e;i<t.length;i++)this.activeSubModel(i)}this._uploadData()}t.commitModel(this,this.model,this.getMaterialInstance(0))}_flushAssembler(){const e=t.Assembler.getAssembler(this);this._assembler!==e&&(this._assembler=e)}_canRender(){return!!super._canRender()&&this._isDrawing}updateRenderer(){if(super.updateRenderer(),this._isNeedUploadData){if(this.impl){const t=this.impl.getRenderDataList();for(let e=0;e<t.length;e++)t[e].setRenderDrawInfoAttributes();this._graphicsNativeProxy.activeSubModels()}this._graphicsNativeProxy.uploadData(),this._isNeedUploadData=!1}}createRenderEntity(){return new KI(1)}},JO.LineJoin=CO,JO.LineCap=xO,s((XO=JO).prototype,"lineJoin",[HO],Object.getOwnPropertyDescriptor(XO.prototype,"lineJoin"),XO.prototype),s(XO.prototype,"lineCap",[GO],Object.getOwnPropertyDescriptor(XO.prototype,"lineCap"),XO.prototype),s(XO.prototype,"color",[Yh],Object.getOwnPropertyDescriptor(XO.prototype,"color"),XO.prototype),YO=Za(XO.prototype,"_lineWidth",[vh],(function(){return 1})),qO=Za(XO.prototype,"_strokeColor",[vh],(function(){return Ls.BLACK.clone()})),$O=Za(XO.prototype,"_lineJoin",[vh],(function(){return 2})),KO=Za(XO.prototype,"_lineCap",[vh],(function(){return 0})),ZO=Za(XO.prototype,"_fillColor",[vh],(function(){return Ls.WHITE.clone()})),QO=Za(XO.prototype,"_miterLimit",[vh],(function(){return 10})),WO=XO))||WO)||WO);var rR,nR,oR,aR,hR,lR,cR,uR,dR,_R;t({GraphicsComponent:sR,Graphics:sR}),a.Graphics=sR;const pR=new vr,mR=new kr,gR=new vr,fR=[];function yR(t,e,i){fR.length=0;const s=2*Math.PI/i;for(let r=0;r<i;++r)fR.push(new Ms(e.x*Math.cos(s*r)+t.x,e.y*Math.sin(s*r)+t.y,0));return fR}const bR=t("MaskType",{GRAPHICS_RECT:0,GRAPHICS_ELLIPSE:1,GRAPHICS_STENCIL:2,SPRITE_STENCIL:3});fe(bR);let vR=(rR=ah("cc.Mask"),nR=lh(110),oR=Xh(bR),rR(aR=nR((_R=class extends Km{constructor(){super(),this._type=lR&&lR(),this._inverted=cR&&cR(),this._segments=uR&&uR(),this._alphaThreshold=dR&&dR(),this._sprite=null,this._graphics=null,this._stencilStage=0}get type(){return this._type}set type(t){this._type!==t&&(this._type=t,3!==this._type?(this._sprite&&(this.node.removeComponent(CP),this._sprite._destroyImmediate(),this._sprite=null),this._changeRenderType(),this._updateGraphics(),this.subComp.renderEntity.setMaskMode(this._inverted?2:1)):(this._graphics&&(this._graphics.clear(),this.node.removeComponent(sR),this._graphics._destroyImmediate(),this._graphics=null),this._changeRenderType(),this.subComp.renderEntity.setMaskMode(this._inverted?2:1)))}get inverted(){return this._inverted}set inverted(t){this._inverted=t,this.subComp.stencilStage=this.inverted?6:2,this.subComp.renderEntity.setMaskMode(this._inverted?2:1)}get segments(){return this._segments}set segments(t){this._segments!==t&&(this._segments=Ri(t,3,1e4),this._updateGraphics())}get spriteFrame(){return this._sprite?this._sprite.spriteFrame:null}set spriteFrame(t){this._sprite?this._sprite.spriteFrame=t:G(16307)}get alphaThreshold(){return this._alphaThreshold}set alphaThreshold(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,3===this.type&&this._sprite)&&this._sprite.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold)}get subComp(){return this._graphics||this._sprite}onLoad(){this._changeRenderType(),this.subComp&&this.subComp.renderEntity.setMaskMode(this._inverted?2:1)}onEnable(){this._changeRenderType(),this._updateGraphics(),this._enableRender(),this.node.on("anchor-changed",this._nodeStateChange,this),this.node.on("size-changed",this._nodeStateChange,this)}onRestore(){this._changeRenderType(),this._updateGraphics()}onDisable(){this._disableRender(),this.node.off("anchor-changed",this._nodeStateChange,this),this.node.off("size-changed",this._nodeStateChange,this)}onDestroy(){this._removeMaskNode()}isHit(t){const e=this.node._getUITransformComp(),i=e.contentSize,s=i.width,r=i.height,n=mR;this.node.getWorldMatrix(pR),vr.invert(gR,pR),kr.transformMat4(n,t,gR);const o=e.anchorPoint;n.x+=o.x*s,n.y+=o.y*r;let a=!1;if(0===this.type||2===this.type||3===this.type)a=n.x>=0&&n.y>=0&&n.x<=s&&n.y<=r;else if(1===this.type){const t=s/2,e=r/2,i=n.x-.5*s,o=n.y-.5*r;a=i*i/(t*t)+o*o/(e*e)<1}return this._inverted&&(a=!a),a}_nodeStateChange(t){this._updateGraphics()}_changeRenderType(){3!==this._type?this._createGraphics():this._createSprite()}_createSprite(){if(!this._sprite){let t=this._sprite=this.node.getComponent(CP);if(!t){const e=this.node;t=this._sprite=e.addComponent(CP)}}this._sprite.stencilStage=this.inverted?6:2,this._sprite.updateMaterial()}_createGraphics(){if(!this._graphics){let t=this._graphics=this.node.getComponent(sR);if(!t){const e=this.node;t=this._graphics=e.addComponent(sR)}t.lineWidth=1;const e=Ls.WHITE.clone();e.a=0,t.fillColor=e}this._graphics.stencilStage=this.inverted?6:2}_updateGraphics(){if(!this._graphics||0!==this._type&&1!==this._type)return;const t=this.node._getUITransformComp(),e=this._graphics;e.clear();const i=t.contentSize,s=i.width,r=i.height,n=t.anchorPoint,o=-s*n.x,a=-r*n.y;if(0===this._type)e.rect(o,a,s,r);else if(1===this._type){const t=yR(new Ms(o+s/2,a+r/2,0),new Ms(s/2,r/2,0),this._segments);for(let i=0;i<t.length;++i){const s=t[i];0===i?e.moveTo(s.x,s.y):e.lineTo(s.x,s.y)}e.close()}e.fill()}_enableRender(){this.subComp&&(this.subComp.enabled=!0)}_disableRender(){this.subComp&&(this.subComp.stencilStage=0,this.subComp.updateMaterial(),this.node.activeInHierarchy&&(this.subComp.enabled=!1))}_removeMaskNode(){this._sprite&&(this._sprite=null),this._graphics&&(this._graphics=null)}get customMaterial(){return j(9007),this.subComp?this.subComp.customMaterial:null}set customMaterial(t){j(9007),this.subComp&&(this.subComp.customMaterial=t)}get color(){return j(9007),this.subComp?this.subComp.color:null}set color(t){j(9007),this.subComp&&t&&(this.subComp.color=t)}markForUpdateRenderData(t=!0){j(9007),this.subComp&&this.subComp._markForUpdateRenderData(t)}requestRenderData(t){j(9007)}destroyRenderData(){j(9007)}updateRenderer(){j(9007),this.subComp&&this.subComp.updateRenderer()}fillBuffers(t){j(9007)}postUpdateAssembler(t){j(9007)}setNodeDirty(){j(9007),this.subComp&&this.subComp.setNodeDirty()}setTextureDirty(){j(9007),this.subComp&&this.subComp.setTextureDirty()}get sharedMaterial(){return j(9007),this.subComp?this.subComp.sharedMaterial:null}get sharedMaterials(){return j(9007),this.subComp?this.subComp.sharedMaterials:null}set sharedMaterials(t){j(9007),this.subComp&&t&&(this.subComp.sharedMaterials=t)}get material(){return j(9007),this.subComp?this.subComp.material:null}set material(t){j(9007),this.subComp&&(this.subComp.material=t)}get materials(){return j(9007),this.subComp?this.subComp.materials:[null]}set materials(t){j(9007),this.subComp&&(this.subComp.materials=t)}getMaterial(t){return j(9007),this.subComp?this.subComp.getSharedMaterial(t):null}setMaterial(t,e){j(9007),this.subComp&&this.subComp.setMaterial(t,e)}getMaterialInstance(t){return j(9007),this.subComp?this.subComp.getMaterialInstance(t):null}setMaterialInstance(t,e){j(9007),this.subComp&&this.subComp.setMaterialInstance(t,e)}getRenderMaterial(t){return j(9007),this.subComp?this.subComp.getRenderMaterial(t):null}},_R.Type=bR,s((hR=_R).prototype,"type",[oR],Object.getOwnPropertyDescriptor(hR.prototype,"type"),hR.prototype),lR=Za(hR.prototype,"_type",[vh],(function(){return 0})),cR=Za(hR.prototype,"_inverted",[vh],(function(){return!1})),uR=Za(hR.prototype,"_segments",[vh],(function(){return 64})),dR=Za(hR.prototype,"_alphaThreshold",[vh],(function(){return.1})),aR=hR))||aR)||aR);var SR,TR,wR,xR,CR,AR;t({MaskComponent:vR,Mask:vR}),Qy._maskComp=vR,a.Mask=vR,at({RenderComponent:{newName:"UIRenderer",since:"1.2.0",removed:!0},UITransformComponent:{newName:"UITransform",since:"1.2.0",removed:!1},CanvasComponent:{newName:"Canvas",since:"1.2.0",removed:!1}}),at({UIRenderable:{newName:"UIRenderer",since:"3.0.0",removed:!0}}),at({Renderable2D:{newName:"UIRenderer",since:"3.6.0",removed:!1}});let DR=ah("cc.PostProcess")(SR=ch((AR=class t extends Km{constructor(){super(),this.global=wR&&wR(),this._shadingScale=xR&&xR(),this.enableShadingScaleInEditor=CR&&CR(),this.settings=new Map}get shadingScale(){return this._shadingScale}set shadingScale(t){this._shadingScale=t}addSetting(t){this.settings.set(t.constructor,t)}removeSetting(t){this.settings.delete(t.constructor)}getSetting(t){return this.settings.get(t)}onEnable(){t.all.push(this)}onDisable(){const e=t.all.indexOf(this);-1!==e&&t.all.splice(e,1)}},AR.all=[],wR=Za((TR=AR).prototype,"global",[uh,vh],(function(){return!0})),xR=Za(TR.prototype,"_shadingScale",[vh],(function(){return 1})),s(TR.prototype,"shadingScale",[uh],Object.getOwnPropertyDescriptor(TR.prototype,"shadingScale"),TR.prototype),CR=Za(TR.prototype,"enableShadingScaleInEditor",[uh,vh],(function(){return!1})),SR=TR))||SR)||SR;var ER,IR,MR,PR,OR,RR,BR,FR,NR,LR,kR,zR,UR,VR,jR,HR,GR,WR,XR,YR,qR,$R,KR,ZR,QR,JR,tB,eB,iB,sB,rB,nB,oB,aB,hB;const lB=new Ms,cB=pe(vb),uB=pe(bb),dB=pe(Sb),_B=pe(wb),pB=pe(Tb),mB=pe({SKYBOX:14,SOLID_COLOR:7,DEPTH_ONLY:6,DONT_CLEAR:0});let gB=(ER=ah("cc.Camera"),IR=Xh(Hy.BitMask),MR=Xh(mB),PR=Xh(cB),OR=Xh(uB),RR=Xh(dB),BR=Xh(_B),FR=Xh(pB),NR=Xh(SD),LR=Xh(DR),ER((hB=class extends Km{constructor(){super(),this._projection=UR&&UR(),this._priority=VR&&VR(),this._fov=jR&&jR(),this._fovAxis=HR&&HR(),this._orthoHeight=GR&&GR(),this._near=WR&&WR(),this._far=XR&&XR(),this._color=YR&&YR(),this._depth=qR&&qR(),this._stencil=$R&&$R(),this._clearFlags=KR&&KR(),this._rect=ZR&&ZR(),this._aperture=QR&&QR(),this._shutter=JR&&JR(),this._iso=tB&&tB(),this._screenScale=eB&&eB(),this._visibility=iB&&iB(),this._targetTexture=sB&&sB(),this._postProcess=rB&&rB(),this._usePostProcess=nB&&nB(),this._camera=null,this._inEditorMode=!1,this._flows=void 0,this._cameraType=oB&&oB(),this._trackingType=aB&&aB()}get camera(){return this._camera}get priority(){return this._priority}set priority(t){this._priority=t,this._camera&&(this._camera.priority=t)}get visibility(){return this._visibility}set visibility(t){this._visibility=t,this._camera&&(this._camera.visibility=t)}get clearFlags(){return this._clearFlags}set clearFlags(t){this._clearFlags=t,this._camera&&(this._camera.clearFlag=t)}get clearColor(){return this._color}set clearColor(t){this._color.set(t),this._camera&&(this._camera.clearColor=this._color)}get clearDepth(){return this._depth}set clearDepth(t){this._depth=t,this._camera&&(this._camera.clearDepth=t)}get clearStencil(){return this._stencil}set clearStencil(t){this._stencil=t,this._camera&&(this._camera.clearStencil=t)}get projection(){return this._projection}set projection(t){this._projection=t,this._camera&&(this._camera.projectionType=t)}get fovAxis(){return this._fovAxis}set fovAxis(t){t!==this._fovAxis&&(this._fovAxis=t,this._camera&&(this._camera.fovAxis=t,this.fov=0===t?this._fov*this._camera.aspect:this._fov/this._camera.aspect))}get fov(){return this._fov}set fov(t){this._fov=t,this._camera&&(this._camera.fov=Ni(t))}get orthoHeight(){return this._orthoHeight}set orthoHeight(t){this._orthoHeight=t,this._camera&&(this._camera.orthoHeight=t)}get near(){return this._near}set near(t){this._near=t,this._camera&&(this._camera.nearClip=t)}get far(){return this._far}set far(t){this._far=t,this._camera&&(this._camera.farClip=t)}get aperture(){return this._aperture}set aperture(t){this._aperture=t,this._camera&&(this._camera.aperture=t)}get shutter(){return this._shutter}set shutter(t){this._shutter=t,this._camera&&(this._camera.shutter=t)}get iso(){return this._iso}set iso(t){this._iso=t,this._camera&&(this._camera.iso=t)}get rect(){return this._rect}set rect(t){this._rect=t,this._camera&&this._camera.setViewportInOrientedSpace(t)}get targetTexture(){return this._targetTexture}set targetTexture(t){if(this._targetTexture===t)return;const e=this._targetTexture;this._targetTexture=t,this._checkTargetTextureEvent(e),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0),this.node.emit("tex-change",this)}get usePostProcess(){return this._usePostProcess}set usePostProcess(t){this._usePostProcess=t,this._camera&&(this._camera.usePostProcess=t)}get postProcess(){return this._postProcess}set postProcess(t){this._postProcess=t,this._camera&&(this._camera.postProcess=t)}get screenScale(){return this._screenScale}set screenScale(t){this._screenScale=t,this._camera&&(this._camera.screenScale=t)}get inEditorMode(){return this._inEditorMode}set inEditorMode(t){if(this._inEditorMode=t,this._camera){const e=a.director.root;this._camera.changeTargetWindow(t?e&&e.mainWindow:e&&e.tempWindow)}}get cameraType(){return this._cameraType}set cameraType(t){this._cameraType!==t&&(this._cameraType=t,this.camera&&(this.camera.cameraType=t))}get trackingType(){return this._trackingType}set trackingType(t){this._trackingType!==t&&(this._trackingType=t,this.camera&&(this.camera.trackingType=t))}onLoad(){this._createCamera()}onEnable(){this.node.hasChangedFlags|=1,this._camera&&this._attachToScene()}onDisable(){this._camera&&this._detachFromScene()}onDestroy(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")}screenPointToRay(t,e,i){return i||(i=cn.create()),this._camera&&this._camera.screenPointToRay(i,t,e),i}worldToScreen(t,e){return e||(e=new Ms),this._camera&&this._camera.worldToScreen(e,t),e}screenToWorld(t,e){return e||(e=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(e,t),e}convertToUINode(t,e,i){if(i||(i=new Ms),!this._camera)return i;this.worldToScreen(t,lB);const s=e.getComponent("cc.UITransform"),r=a.view,n=r.getVisibleSize(),o=lB.x-.5*this._camera.width,h=lB.y-.5*this._camera.height;return lB.x=o/r.getScaleX()+.5*n.width,lB.y=h/r.getScaleY()+.5*n.height,s&&s.convertToNodeSpaceAR(lB,i),i}_createCamera(){this._camera||(this._camera=a.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?a.director.root&&a.director.root.mainWindow:a.director.root&&a.director.root.tempWindow,priority:this._priority,cameraType:this.cameraType,trackingType:this.trackingType}),this._camera.setViewportInOrientedSpace(this._rect),this._camera.fovAxis=this._fovAxis,this._camera.fov=Ni(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso,this._camera.postProcess=this._postProcess,this._camera.usePostProcess=this._usePostProcess,this._camera.update()),this._updateTargetTexture()}_attachToScene(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))}_detachFromScene(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)}_checkTargetTextureEvent(t){t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(t=>{this._camera&&this._camera.setFixedSize(t.width,t.height)}),this)}_updateTargetTexture(){if(this._camera&&this._targetTexture){const t=this._targetTexture.window;this._camera.changeTargetWindow(t),this._camera.setFixedSize(t.width,t.height)}}},hB.ProjectionType=cB,hB.FOVAxis=uB,hB.ClearFlag=mB,hB.Aperture=dB,hB.Shutter=_B,hB.ISO=pB,hB.TARGET_TEXTURE_CHANGE="tex-change",UR=Za((zR=hB).prototype,"_projection",[vh],(function(){return cB.PERSPECTIVE})),VR=Za(zR.prototype,"_priority",[vh],(function(){return 0})),jR=Za(zR.prototype,"_fov",[vh],(function(){return 45})),HR=Za(zR.prototype,"_fovAxis",[vh],(function(){return uB.VERTICAL})),GR=Za(zR.prototype,"_orthoHeight",[vh],(function(){return 10})),WR=Za(zR.prototype,"_near",[vh],(function(){return 1})),XR=Za(zR.prototype,"_far",[vh],(function(){return 1e3})),YR=Za(zR.prototype,"_color",[vh],(function(){return new Ls("#333333")})),qR=Za(zR.prototype,"_depth",[vh],(function(){return 1})),$R=Za(zR.prototype,"_stencil",[vh],(function(){return 0})),KR=Za(zR.prototype,"_clearFlags",[vh],(function(){return mB.SOLID_COLOR})),ZR=Za(zR.prototype,"_rect",[vh],(function(){return new Wr(0,0,1,1)})),QR=Za(zR.prototype,"_aperture",[vh],(function(){return dB.F16_0})),JR=Za(zR.prototype,"_shutter",[vh],(function(){return _B.D125})),tB=Za(zR.prototype,"_iso",[vh],(function(){return pB.ISO100})),eB=Za(zR.prototype,"_screenScale",[vh],(function(){return 1})),iB=Za(zR.prototype,"_visibility",[vh],(function(){return PA})),sB=Za(zR.prototype,"_targetTexture",[vh],(function(){return null})),rB=Za(zR.prototype,"_postProcess",[vh],(function(){return null})),nB=Za(zR.prototype,"_usePostProcess",[vh],(function(){return!1})),oB=Za(zR.prototype,"_cameraType",[vh],(function(){return-1})),aB=Za(zR.prototype,"_trackingType",[vh],(function(){return 0})),s(zR.prototype,"visibility",[IR],Object.getOwnPropertyDescriptor(zR.prototype,"visibility"),zR.prototype),s(zR.prototype,"clearFlags",[MR],Object.getOwnPropertyDescriptor(zR.prototype,"clearFlags"),zR.prototype),s(zR.prototype,"projection",[PR],Object.getOwnPropertyDescriptor(zR.prototype,"projection"),zR.prototype),s(zR.prototype,"fovAxis",[OR],Object.getOwnPropertyDescriptor(zR.prototype,"fovAxis"),zR.prototype),s(zR.prototype,"aperture",[RR],Object.getOwnPropertyDescriptor(zR.prototype,"aperture"),zR.prototype),s(zR.prototype,"shutter",[BR],Object.getOwnPropertyDescriptor(zR.prototype,"shutter"),zR.prototype),s(zR.prototype,"iso",[FR],Object.getOwnPropertyDescriptor(zR.prototype,"iso"),zR.prototype),s(zR.prototype,"targetTexture",[NR],Object.getOwnPropertyDescriptor(zR.prototype,"targetTexture"),zR.prototype),s(zR.prototype,"usePostProcess",[uh],Object.getOwnPropertyDescriptor(zR.prototype,"usePostProcess"),zR.prototype),s(zR.prototype,"postProcess",[LR],Object.getOwnPropertyDescriptor(zR.prototype,"postProcess"),zR.prototype),kR=zR))||kR);var fB;t({Camera:gB,CameraComponent:gB}),a.Camera=gB;let yB=t("RenderRoot2D",ah("cc.RenderRoot2D")(fB=lh(100)(fB=hh(RI)(fB=ch(fB=class extends Km{onEnable(){a.director.root.batcher2D.addScreen(this)}onDisable(){a.director.root.batcher2D.removeScreen(this)}onDestroy(){a.director.root.batcher2D.removeScreen(this)}})||fB)||fB)||fB)||fB);var bB,vB,SB,TB,wB,xB,CB,AB;const DB=new Ms;let EB=(bB=ah("cc.Canvas"),vB=lh(100),SB=Xh(gB),TB=Xh(gB),bB(wB=vB(wB=ch((xB=class extends yB{get renderMode(){return this._renderMode}set renderMode(t){this._renderMode=t,this._cameraComponent&&(this._cameraComponent.priority=this._getViewPriority())}get cameraComponent(){return this._cameraComponent}set cameraComponent(t){this._cameraComponent!==t&&(this._cameraComponent=t,this._onResizeCamera())}get alignCanvasWithScreen(){return this._alignCanvasWithScreen}set alignCanvasWithScreen(t){this._alignCanvasWithScreen=t,this._onResizeCamera()}constructor(){super(),this._cameraComponent=CB&&CB(),this._alignCanvasWithScreen=AB&&AB(),this._pos=new Ms,this._renderMode=0,this._thisOnCameraResized=this._onResizeCamera.bind(this)}__preload(){const t=this.getComponent("cc.Widget");t&&t.updateAlignment(),this._cameraComponent&&(this._cameraComponent._createCamera(),this._cameraComponent.node.on("tex-change",this._thisOnCameraResized)),this._onResizeCamera(),XA.on("canvas-resize",this._thisOnCameraResized,this),XA.on("design-resolution-changed",this._thisOnCameraResized,this)}onEnable(){super.onEnable(),this._cameraComponent&&this._cameraComponent.node.on("tex-change",this._thisOnCameraResized)}onDisable(){super.onDisable(),this._cameraComponent&&this._cameraComponent.node.off("tex-change",this._thisOnCameraResized)}onDestroy(){super.onDestroy(),XA.off("canvas-resize",this._thisOnCameraResized,this),XA.off("design-resolution-changed",this._thisOnCameraResized,this)}_onResizeCamera(){if(this._cameraComponent&&this._alignCanvasWithScreen){if(this._cameraComponent.targetTexture)this._cameraComponent.orthoHeight=fa.height/2;else{const t=ma.windowSize;this._cameraComponent.orthoHeight=t.height/XA.getScaleY()/2}this.node.getWorldPosition(DB),this._cameraComponent.node.setWorldPosition(DB.x,DB.y,1e3)}}_getViewPriority(){if(this._cameraComponent){var t;let e=null==(t=this.cameraComponent)?void 0:t.priority;return e=0===this._renderMode?e|1<<30:-1073741825&e,e}return 0}},s(xB.prototype,"cameraComponent",[SB],Object.getOwnPropertyDescriptor(xB.prototype,"cameraComponent"),xB.prototype),CB=Za(xB.prototype,"_cameraComponent",[TB],(function(){return null})),AB=Za(xB.prototype,"_alignCanvasWithScreen",[vh],(function(){return!0})),wB=xB))||wB)||wB)||wB);var IB;function MB(t,e,i){const s=t.o,r=t.d,n=1/r.x,o=1/r.y,a=1/r.z,h=(e.x-s.x)*n,l=(i.x-s.x)*n,c=(e.y-s.y)*o,u=(i.y-s.y)*o,d=(e.z-s.z)*a,_=(i.z-s.z)*a,p=Math.max(Math.max(Math.min(h,l),Math.min(c,u)),Math.min(d,_)),m=Math.min(Math.min(Math.max(h,l),Math.max(c,u)),Math.max(d,_));return m<0||p>m?0:p>0?p:m}t({Canvas:EB,CanvasComponent:EB}),a.Canvas=EB,J(t("UIComponent",ah("cc.UIComponent")(IB=hh(RI)(IB=lh(110)(IB=ch(IB=class extends Km{constructor(){super(),this._lastParent=null,this.stencilStage=0}__preload(){this.node._uiProps.uiComp=this}onEnable(){}onDisable(){}onDestroy(){const t=this.node._uiProps;t.uiComp===this&&(t.uiComp=null)}postUpdateAssembler(t){}markForUpdateRenderData(t=!0){}setNodeDirty(){}setTextureDirty(){}})||IB)||IB)||IB)||IB).prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),Q(EB.prototype,"Canvas.prototype",[{name:"camera",newName:"cameraComponent.camera",customGetter(){var t;return null==(t=this._cameraComponent)?void 0:t.camera}},{name:"clearFlag",newName:"cameraComponent.clearFlags",customGetter(){return this._cameraComponent?this._cameraComponent.clearFlags:0},customSetter(t){this._cameraComponent&&(this._cameraComponent.clearFlags=t)}},{name:"color",newName:"cameraComponent.clearColor",customGetter(){return this._cameraComponent?this._cameraComponent.clearColor:Ls.BLACK},customSetter(t){this._cameraComponent&&(this._cameraComponent.clearColor=t)}},{name:"priority",newName:"cameraComponent.priority",customGetter(){return this._cameraComponent?this._cameraComponent.priority:0},customSetter(t){this._cameraComponent&&(this._cameraComponent.priority=t)}},{name:"targetTexture",newName:"cameraComponent.targetTexture",customGetter(){return this._cameraComponent?this._cameraComponent.targetTexture:null},customSetter(t){this._cameraComponent&&(this._cameraComponent.targetTexture=t)}},{name:"visibility",newName:"cameraComponent.visibility",customGetter(){return this._cameraComponent?this._cameraComponent.visibility:0}}]),tt(RI.prototype,"UITransform.prototype",[{name:"priority",suggest:"Please use setSiblingIndex to change index of the current node in its parent's children array."}]),a.UITransformComponent=RI,Xt(RI,"cc.UITransformComponent"),Xt(uM,"cc.RenderComponent"),a.CanvasComponent=EB,Xt(EB,"cc.CanvasComponent"),a.internal.Renderable2D=uM,Xt(uM,"cc.Renderable2D");const PB=function(){const t=fo.create(),e={distance:1/0,doubleSided:!1,mode:2};let i=0;const s=(t,e,s,r,n,o)=>{1===t?(i>e||0===i)&&(i=e,o&&(0===o.length?o.push({distance:e,vertexIndex0:s/3,vertexIndex1:r/3,vertexIndex2:n/3}):(o[0].distance=e,o[0].vertexIndex0=s/3,o[0].vertexIndex1=r/3,o[0].vertexIndex2=n/3))):(i=e,o&&o.push({distance:e,vertexIndex0:s/3,vertexIndex1:r/3,vertexIndex2:n/3}))},r=(e,r,n,o,a)=>{if(7===n){const i=r.length;for(let n=0;n<i;n+=3){const i=3*r[n],h=3*r[n+1],l=3*r[n+2];Ms.set(t.a,e[i],e[i+1],e[i+2]),Ms.set(t.b,e[h],e[h+1],e[h+2]),Ms.set(t.c,e[l],e[l+1],e[l+2]);const c=co.rayTriangle(o,t,a.doubleSided);if(!(0===c||c>a.distance)&&(s(a.mode,c,i,h,l,a.result),2===a.mode))return c}}else if(8===n){const i=r.length-2;let n=0;for(let h=0;h<i;h+=1){const i=3*r[h-n],l=3*r[h+n+1],c=3*r[h+2];Ms.set(t.a,e[i],e[i+1],e[i+2]),Ms.set(t.b,e[l],e[l+1],e[l+2]),Ms.set(t.c,e[c],e[c+1],e[c+2]),n=~n;const u=co.rayTriangle(o,t,a.doubleSided);if(!(0===u||u>a.distance)&&(s(a.mode,u,i,l,c,a.result),2===a.mode))return u}}else if(9===n){const i=r.length-1,n=3*r[0];Ms.set(t.a,e[n],e[n+1],e[n+2]);for(let h=1;h<i;h+=1){const i=3*r[h],l=3*r[h+1];Ms.set(t.b,e[i],e[i+1],e[i+2]),Ms.set(t.c,e[l],e[l+1],e[l+2]);const c=co.rayTriangle(o,t,a.doubleSided);if(!(0===c||c>a.distance)&&(s(a.mode,c,n,i,l,a.result),2===a.mode))return c}}return i};return function(t,s,n){if(i=0,0===s.geometricInfo.positions.length)return i;const o=void 0===n?e:n;if(MB(t,s.geometricInfo.boundingBox.min,s.geometricInfo.boundingBox.max)){const e=s.primitiveMode,{positions:i,indices:n}=s.geometricInfo;r(i,n,e,t,o)}return i}}(),OB=function(){let t=0;const e={distance:1/0,doubleSided:!1,mode:2};return function(i,s,r){t=0;const n=void 0===r?e:r,o=s.renderingSubMeshes.length,a=s.struct.minPosition,h=s.struct.maxPosition;if(a&&h&&!MB(i,a,h))return t;for(let e=0;e<o;e++){const r=s.renderingSubMeshes[e],o=PB(i,r,n);if(o)if(1===n.mode)(0===t||t>o)&&(t=o,n.subIndices&&(n.subIndices[0]=e));else if(t=o,n.subIndices&&n.subIndices.push(e),2===n.mode)return o}return t&&1===n.mode&&(n.result&&(n.result[0].distance=t,n.result.length=1),n.subIndices&&(n.subIndices.length=1)),t}}(),RB=function(){let t=0;const e={distance:1/0,doubleSided:!1,mode:2},i=new cn,s=new vr;return function(r,n,o){t=0;const a=void 0===o?e:o,h=n.worldBounds;if(h&&!co.rayAABB(r,h))return t;cn.copy(i,r),n.node&&(vr.invert(s,n.node.getWorldMatrix(s)),Ms.transformMat4(i.o,r.o,s),Ms.transformMat4Normal(i.d,r.d,s));const l=n.subModels;for(let e=0;e<l.length;e++){const s=l[e].subMesh,r=PB(i,s,a);if(r)if(1===a.mode)(0===t||t>r)&&(t=r,a.subIndices&&(a.subIndices[0]=e));else if(t=r,a.subIndices&&a.subIndices.push(e),2===a.mode)return r}return t&&1===a.mode&&(a.result&&(a.result[0].distance=t,a.result.length=1),a.subIndices&&(a.subIndices.length=1)),t}}();var BB,FB,NB;co.rayModel=RB,co.raySubMesh=PB,co.rayMesh=OB,LA("specular-pass");let LB=ah("cc.ModelRenderer")((FB=class extends $I{constructor(){super(),this._visFlags=NB&&NB(),this._models=[],this._priority=0}get visibility(){return this._visFlags}set visibility(t){this._visFlags=t,this._onVisibilityChange(t)}get priority(){return this._priority}set priority(t){t!==this._priority&&(this._priority=t,this._updatePriority())}_collectModels(){return this._models}onEnable(){this._updatePriority()}_attachToScene(){}_detachFromScene(){}_onVisibilityChange(t){}_updatePriority(){if(this._models.length>0)for(let t=0;t<this._models.length;t++)this._models[t].priority=this._priority}},NB=Za(FB.prototype,"_visFlags",[vh],(function(){return Hy.Enum.NONE})),BB=FB))||BB;var kB,zB,UB,VB,jB;t({ModelRenderer:LB,RenderableComponent:LB});const{ccclass:HB,serializable:GB,type:WB,visible:XB}=il;var YB,qB,$B,KB,ZB,QB,JB,tF,eF,iF,sF,rF,nF,oF,aF,hF,lF,cF,uF,dF,_F,pF,mF,gF,fF,yF,bF,vF,SF,TF,wF,xF,CF,AF,DF,EF,IF;t("PrefabLink",(kB=HB("cc.PrefabLink"),zB=WB(_w),kB((VB=class extends Km{constructor(){super(),this.prefab=jB&&jB()}},jB=Za(VB.prototype,"prefab",[zB,GB],(function(){return null})),UB=VB))||UB)),Q(gB,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),Q(gB.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),tt($I.prototype,"Renderer.prototype",[{name:"getMaterial",suggest:"please use renderer.getSharedMaterial instead."}]),a.CameraComponent=gB,Xt(gB,"cc.CameraComponent"),a.RenderableComponent=LB,Xt(LB,"cc.RenderableComponent"),t("SpriteRenderer",(YB=ah("cc.SpriteRenderer"),qB=lh(100),$B=Xh(yD),YB(KB=qB((ZB=class extends LB{constructor(){super(),this._spriteFrame=QB&&QB(),this._mode=JB&&JB(),this._color=tF&&tF(),this._flipX=eF&&eF(),this._flipY=iF&&iF(),this._size=sF&&sF(),this._model=null}get spriteFrame(){return this._spriteFrame}set spriteFrame(t){this._spriteFrame!==t&&(this._spriteFrame,this._spriteFrame=t,this._spriteFrame&&(this._spriteFrame.ensureMeshData(),this._spriteFrame.mesh.initialize()),this._updateModels(),this.enabledInHierarchy&&this._attachToScene())}get model(){return this._model}onLoad(){this._spriteFrame&&(this._spriteFrame.mesh||this._spriteFrame.ensureMeshData(),this._spriteFrame.mesh.initialize()),this._updateModels()}onRestore(){this._updateModels(),this.enabledInHierarchy&&this._attachToScene()}onEnable(){super.onEnable(),this._model||this._updateModels(),this._attachToScene()}onDisable(){this._model&&this._detachFromScene()}onDestroy(){this._model&&(a.director.root.destroyModel(this._model),this._model=null,this._models.length=0)}_updateModels(){if(!this._spriteFrame)return;const t=this._model;if(t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this._model){const t=this._spriteFrame.mesh;this._model.createBoundingShape(t.struct.minPosition,t.struct.maxPosition),this._updateModelParams(),this._onUpdateLocalDescriptorSet()}}_createModel(){const t=this._model=a.director.root.createModel(mb);t.visFlags=this.visibility,t.node=t.transform=this.node,this._models.length=0,this._models.push(this._model)}_updateModelParams(){if(!this._spriteFrame||!this._model)return;this._spriteFrame.ensureMeshData();const t=this._spriteFrame.mesh;this.node.hasChangedFlags|=1,this._model.transform.hasChangedFlags|=1;const e=t?t.renderingSubMeshes:null;if(e){const t=e.length;for(let i=0;i<t;++i){let t=this.getRenderMaterial(i);t&&!t.isValid&&(t=null);const s=e[i];s&&this._model.initSubModel(i,s,t||this._getBuiltinMaterial())}}this._model.enabled=!0}_getBuiltinMaterial(){return iC.get("missing-material")}_onMaterialModified(t,e){super._onMaterialModified(t,e),this._spriteFrame&&this._model&&this._model.inited&&this._onRebuildPSO(t,e||this._getBuiltinMaterial())}_onRebuildPSO(t,e){this._model&&this._model.inited&&(this._model.setSubModelMaterial(t,e),this._onUpdateLocalDescriptorSet())}_onUpdateLocalDescriptorSet(){if(!this._spriteFrame||!this._model||!this._model.inited)return;const t=this._spriteFrame.getGFXTexture(),e=this._spriteFrame.getGFXSampler(),i=this._model.subModels;for(let s=0;s<i.length;s++){const{descriptorSet:r}=i[s];r.bindTexture(12,t),r.bindSampler(12,e),r.update()}}_attachToScene(){if(!this.node.scene||!this._model)return;const t=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),t.addModel(this._model)}_detachFromScene(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)}},s(ZB.prototype,"spriteFrame",[$B],Object.getOwnPropertyDescriptor(ZB.prototype,"spriteFrame"),ZB.prototype),QB=Za(ZB.prototype,"_spriteFrame",[vh],(function(){return null})),JB=Za(ZB.prototype,"_mode",[vh],(function(){return 0})),tF=Za(ZB.prototype,"_color",[vh],(function(){return Ls.WHITE.clone()})),eF=Za(ZB.prototype,"_flipX",[vh],(function(){return!1})),iF=Za(ZB.prototype,"_flipY",[vh],(function(){return!1})),sF=Za(ZB.prototype,"_size",[vh],(function(){return new kr})),KB=ZB))||KB)||KB));const MF=new TE,PF="RICHTEXT_CHILD",OF="RICHTEXT_Image_CHILD",RF=new kr,BF=new kr,FF=new Jt((t=>{if(!a.isValid(t.node))return!1;{const e=t.node.getComponent(eP);e&&(e.outlineWidth=0)}return!0}),20),NF=new Jt((t=>a.isValid(t.node)),10);function LF(t){return{node:new tb(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function kF(t,e){let i;t===PF?i=FF._get():t===OF&&(i=NF._get()),i=i||LF(t);let s=i.node;return s||(s=new tb(t)),s.hideFlags|=1032,s.active=!0,t===OF?(i.comp=s.getComponent(CP)||s.addComponent(CP),i.comp.spriteFrame=e,i.comp.type=CP.Type.SLICED,i.comp.sizeMode=0):(i.comp=s.getComponent(eP)||s.addComponent(eP),i.comp.string=e,i.comp.horizontalAlign=0,i.comp.verticalAlign=0,i.comp.underlineHeight=2),s.setPosition(0,0,0),s._getUITransformComp().setAnchorPoint(.5,.5),i.node=s,i.lineCount=0,i.styleIndex=0,i.imageOffset="",i.clickParam="",i.clickHandler="",i}let zF=(rF=ah("cc.RichText"),nF=hh(RI),oF=lh(110),aF=Xh(ZM),hF=Xh(QM),lF=Xh(Ls),cF=Xh(MD),uF=Xh(tP),dF=Xh(ED),rF(_F=nF(_F=oF((IF=class extends Km{get string(){return this._string}set string(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}get horizontalAlign(){return this._horizontalAlign}set horizontalAlign(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}get verticalAlign(){return this._verticalAlign}set verticalAlign(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}get fontColor(){return this._fontColor}set fontColor(t){this._fontColor!==t&&(this._fontColor=t,this._updateTextDefaultColor())}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}get font(){return this._font}set font(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}get useSystemFont(){return this._isSystemFontUsed}set useSystemFont(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}get cacheMode(){return this._cacheMode}set cacheMode(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}get imageAtlas(){return this._imageAtlas}set imageAtlas(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}get handleTouchEvent(){return this._handleTouchEvent}set handleTouchEvent(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}constructor(){super(),this._lineHeight=mF&&mF(),this._string=gF&&gF(),this._horizontalAlign=fF&&fF(),this._verticalAlign=yF&&yF(),this._fontSize=bF&&bF(),this._fontColor=vF&&vF(),this._maxWidth=SF&&SF(),this._fontFamily=TF&&TF(),this._font=wF&&wF(),this._isSystemFontUsed=xF&&xF(),this._userDefinedFont=CF&&CF(),this._cacheMode=AF&&AF(),this._imageAtlas=DF&&DF(),this._handleTouchEvent=EF&&EF(),this._textArray=[],this._segments=[],this._labelSegmentsCache=[],this._linesWidth=[],this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0,this._lineOffsetX=0,this._labelChildrenNum=0,this._updateRichTextStatus=this._updateRichText}onLoad(){this.node.on("layer-changed",this._applyLayer,this),this.node.on("anchor-changed",this._updateRichTextPosition,this)}onEnable(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)}onDisable(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)}onRestore(){}onDestroy(){this._segments.forEach((t=>{t.node.removeFromParent(),t.type===PF?FF.put(t):t.type===OF&&NF.put(t)})),this.node.off("anchor-changed",this._updateRichTextPosition,this),this.node.off("layer-changed",this._applyLayer,this)}_addEventListeners(){this.node.on("touch-end",this._onTouchEnded,this)}_removeEventListeners(){this.node.off("touch-end",this._onTouchEnded,this)}_updateLabelSegmentTextAttributes(){this._segments.forEach((t=>{this._applyTextAttribute(t)}))}_createFontLabel(t){return kF(PF,t)}_createImage(t){return kF(OF,t)}_onTTFLoaded(){this._font,this._layoutDirty=!0,this._updateRichText()}splitLongStringApproximatelyIn2048(t,e){const i=[];if(t.length*this.fontSize<=1638.4)return i.push(t),i;if(this._calculateSize(RF,e,t),RF.x<2048)i.push(t);else{const s=t.split("\n");for(let t=0;t<s.length;t++)if(this._calculateSize(RF,e,s[t]),RF.x<2048)i.push(s[t]);else{const r=this.splitLongStringOver2048(s[t],e);i.push(...r)}}return i}splitLongStringOver2048(t,e){const i=[],s=t;let r=0,n=s.length/2,o=s.substring(r,n),a=s.substring(n);const h=this._calculateSize(RF,e,o),l=this._calculateSize(BF,e,a);let c=this._maxWidth;0===this._maxWidth&&(c=2047.9);const u=1*c;for(;h.x>u;){if(n/=2,n<1){n*=2;break}o=o.substring(r,n),a=s.substring(n),this._calculateSize(h,e,o)}let d=1e3,_=1;for(;d&&r<t.length;){for(;d&&h.x<u;){const t=rE(a);t&&t.length>0&&(_=t[0].length),n+=_,o=s.substring(r,n),a=s.substring(n),this._calculateSize(h,e,o),d--}for(;d&&o.length>=2&&h.x>u;)n-=_,o=s.substring(r,n),this._calculateSize(h,e,o),_=1,d--;if(o.length>=2){const t=nE(o);t&&t.length>0&&o!==t[0]&&(n-=t[0].length,o=s.substring(r,n))}if(i.push(o),r=n,n+=o.length,o=s.substring(r,n),a=s.substring(n),this._calculateSize(l,e,a),this._calculateSize(h,e,o),d--,l.x<2048&&h.x<u){i.push(o),r=t.length,n=t.length,o=a,""!==a&&i.push(o);break}}return i}_measureText(t,e){const i=e=>this._calculateSize(RF,t,e).x;return e?i(e):i}_calculateSize(t,e,i){let s;0===this._labelSegmentsCache.length?(s=this._createFontLabel(i),this._labelSegmentsCache.push(s)):(s=this._labelSegmentsCache[0],s.node.getComponent(eP).string=i),s.styleIndex=e,this._applyTextAttribute(s);const r=s.node._getUITransformComp().contentSize;return kr.set(t,r.x,r.y),t}_onTouchEnded(t){const e=this.node.getComponents(Km);this._segments.forEach((i=>{const s=i.clickHandler,r=i.clickParam;s&&this._containsTouchLocation(i,t.touch.getUILocation())&&(e.forEach((e=>{const i=e[s];e.enabledInHierarchy&&i&&i.call(e,t,r)})),t.propagationStopped=!0)}))}_containsTouchLocation(t,e){const i=t.node.getComponent(RI);return!!i&&i.getBoundingBoxToWorld().contains(e)}_resetState(){const t=this.node.children;for(let e=t.length-1;e>=0;e--){const i=t[e];if(i.name===PF||i.name===OF){i.parent=null;const t=LF(i.name);t.node=i,i.name===PF?(t.comp=i.getComponent(eP),FF.put(t)):(t.comp=i.getComponent(CP),NF.put(t)),this._labelChildrenNum--}}this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0}_activateChildren(t){for(let e=this.node.children.length-1;e>=0;e--){const i=this.node.children[e];i.name!==PF&&i.name!==OF||(i.active=t)}}_addLabelSegment(t,e){let i;if(0===this._labelSegmentsCache.length)i=this._createFontLabel(t);else{i=this._labelSegmentsCache.pop();const e=i.node.getComponent(eP);e&&(e.string=t)}const s=i.comp;return s.verticalAlign!==this._verticalAlign&&(s.verticalAlign=this._verticalAlign),i.styleIndex=e,i.lineCount=this._lineCount,i.node._getUITransformComp().setAnchorPoint(0,0),i.node.layer=this.node.layer,this.node.insertChild(i.node,this._labelChildrenNum++),this._applyTextAttribute(i),this._segments.push(i),i}_updateRichTextWithMaxWidth(t,e,i){let s,r=e;if(this._lineOffsetX>0&&r+this._lineOffsetX>this._maxWidth){let e=0;for(;this._lineOffsetX<=this._maxWidth;){const s=this._getFirstWordLen(t,e,t.length),n=t.substr(e,s),o=this._measureText(i,n);if(!(this._lineOffsetX+o<=this._maxWidth)){if(e>0){const s=t.substr(0,e);this._addLabelSegment(s,i),t=t.substr(e,t.length),r=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=o,e+=s}}if(r>this._maxWidth){const e=oE(t,r,this._maxWidth,this._measureText(i));for(let t=0;t<e.length;++t){const r=e[t];s=this._addLabelSegment(r,i);const n=s.node._getUITransformComp().contentSize;this._lineOffsetX+=n.width,e.length>1&&t<e.length-1&&this._updateLineInfo()}}else this._lineOffsetX+=r,this._addLabelSegment(t,i)}_isLastComponentCR(t){return t.length-1===t.lastIndexOf("\n")}_updateLineInfo(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++}_needsUpdateTextLayout(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(let e=0;e<this._textArray.length;e++){const i=this._textArray[e],s=t[e];if(i.text!==s.text)return!0;{const t=i.style,e=s.style;if(t){if(e){if(!!e.outline!=!!t.outline)return!0;if(t.size!==e.size||t.italic!==e.italic||t.isImage!==e.isImage)return!0;if(t.src!==e.src||t.imageAlign!==e.imageAlign||t.imageHeight!==e.imageHeight||t.imageWidth!==e.imageWidth||t.imageOffset!==e.imageOffset)return!0}else if(t.size||t.italic||t.isImage||t.outline)return!0}else if(e&&(e.size||e.italic||e.isImage||e.outline))return!0}}return!1}_addRichTextImageElement(t){if(!t.style)return;const e=t.style,i=e.src,s=this._imageAtlas&&i&&this._imageAtlas.getSpriteFrame(i);if(s){const t=this._createImage(s),i=t.node._getUITransformComp();switch(e.imageAlign){case"top":i.setAnchorPoint(0,1);break;case"center":i.setAnchorPoint(0,.5);break;default:i.setAnchorPoint(0,0)}e.imageOffset&&(t.imageOffset=e.imageOffset),t.node.layer=this.node.layer,this.node.insertChild(t.node,this._labelChildrenNum++),this._segments.push(t);const r=s.rect.clone();let n=1,o=r.width,a=r.height;const h=e.imageWidth||0,l=e.imageHeight||0;l>0?(n=l/a,o*=n,a*=n):(n=this._lineHeight/a,o*=n,a*=n),h>0&&(o=h),this._maxWidth>0?(this._lineOffsetX+o>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=o):(this._lineOffsetX+=o,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),i.setContentSize(o,a),t.lineCount=this._lineCount,t.clickHandler="",t.clickParam="";const c=e.event;c&&(t.clickHandler=c.click,t.clickParam=c.param)}else j(4400)}_updateTextDefaultColor(){for(let i=0;i<this._segments.length;++i){var t,e;const s=this._segments[i],r=s.node.getComponent(eP);r&&(null!=(t=this._textArray[s.styleIndex])&&null!=(e=t.style)&&e.color||(r.color=this._fontColor))}}_updateRichText(){if(!this.enabledInHierarchy)return;const t=MF.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();let e,i=!1;for(let t=0;t<this._textArray.length;++t){const s=this._textArray[t];let r=s.text;if(void 0===r)continue;if(""===r){if(s.style&&s.style.isNewLine){this._updateLineInfo();continue}if(s.style&&s.style.isImage&&this._imageAtlas){this._addRichTextImageElement(s);continue}}r=this.splitLongStringApproximatelyIn2048(r,t).join("\n");const n=r.split("\n");for(let s=0;s<n.length;++s){const o=n[s];if(""!==o)if(i=!1,this._maxWidth>0){const e=this._measureText(t,o);this._updateRichTextWithMaxWidth(o,e,t),n.length>1&&s<n.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(o,t),this._lineOffsetX+=e.node._getUITransformComp().width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),n.length>1&&s<n.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(r)&&s===n.length-1)continue;this._updateLineInfo(),i=!0}}}i||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+ND)*this._lineHeight,this.node._getUITransformComp().setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}_getFirstWordLen(t,e,i){let s=JD(t,e);if($D(s)||KD(s))return 1;let r=1;for(let n=e+1;n<i&&(s=JD(t,n),!KD(s)&&!$D(s));++n)r++;return r}_updateRichTextPosition(){let t=0,e=1;const i=this._lineCount,s=this.node._getUITransformComp(),r=s.anchorX,n=s.anchorY;for(let s=0;s<this._segments.length;++s){const o=this._segments[s],a=o.lineCount;a>e&&(t=0,e=a);let h=this._labelWidth*(.5*this._horizontalAlign-r);switch(this._horizontalAlign){case 0:break;case 1:h-=this._linesWidth[a-1]/2;break;case 2:h-=this._linesWidth[a-1]}const l=o.node,c=l.position;if(l.setPosition(t+h,this._lineHeight*(i-a)-this._labelHeight*n,c.z),a===e&&(t+=l._getUITransformComp().width),l.getComponent(CP)){const t=l.position.clone(),e=this._lineHeight,i=this._lineHeight*(1+ND);switch(l._getUITransformComp().anchorY){case 1:t.y+=e+(i-e)/2;break;case.5:t.y+=i/2;break;default:t.y+=(i-e)/2}if(o.imageOffset){const e=o.imageOffset.split(",");if(1===e.length&&e[0]){const i=parseFloat(e[0]);Number.isInteger(i)&&(t.y+=i)}else if(2===e.length){const i=parseFloat(e[0]),s=parseFloat(e[1]);Number.isInteger(i)&&(t.x+=i),Number.isInteger(s)&&(t.y+=s)}}l.position=t}const u=l.getComponent(eP);if(u&&u.enableOutline){const t=l.position.clone();t.y-=u.outlineWidth,l.position=t}}}_convertLiteralColorValue(t){const e=t.toUpperCase();return Ls[e]?Ls[e]:(new Ls).fromHEX(t)}_applyTextAttribute(t){const e=t.node.getComponent(eP);if(!e)return;this._resetLabelState(e);const i=t.styleIndex;let s;if(this._textArray[i]&&(s=this._textArray[i].style),s){s.color?e.color=this._convertLiteralColorValue(s.color):e.color=this._fontColor,e.isBold=!!s.bold,e.isItalic=!!s.italic,e.isUnderline=!!s.underline,s.outline&&(e.enableOutline=!0,e.outlineColor=this._convertLiteralColorValue(s.outline.color),e.outlineWidth=s.outline.width),e.fontSize=s.size||this._fontSize,t.clickHandler="",t.clickParam="";const i=s.event;i&&(t.clickHandler=i.click||"",t.clickParam=i.param||"")}e.cacheMode=this._cacheMode,this._font instanceof MD&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0)}_applyLayer(){this._segments.forEach((t=>{t.node.layer=this.node.layer}))}_resetLabelState(t){t.fontSize=this._fontSize,t.color=this._fontColor,t.isBold=!1,t.isItalic=!1,t.isUnderline=!1}},IF.HorizontalAlign=ZM,IF.VerticalAlign=QM,s((pF=IF).prototype,"horizontalAlign",[aF],Object.getOwnPropertyDescriptor(pF.prototype,"horizontalAlign"),pF.prototype),s(pF.prototype,"verticalAlign",[hF],Object.getOwnPropertyDescriptor(pF.prototype,"verticalAlign"),pF.prototype),s(pF.prototype,"fontColor",[lF],Object.getOwnPropertyDescriptor(pF.prototype,"fontColor"),pF.prototype),s(pF.prototype,"font",[cF],Object.getOwnPropertyDescriptor(pF.prototype,"font"),pF.prototype),s(pF.prototype,"cacheMode",[uF],Object.getOwnPropertyDescriptor(pF.prototype,"cacheMode"),pF.prototype),s(pF.prototype,"imageAtlas",[dF],Object.getOwnPropertyDescriptor(pF.prototype,"imageAtlas"),pF.prototype),mF=Za(pF.prototype,"_lineHeight",[vh],(function(){return 40})),gF=Za(pF.prototype,"_string",[vh],(function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"})),fF=Za(pF.prototype,"_horizontalAlign",[vh],(function(){return 0})),yF=Za(pF.prototype,"_verticalAlign",[vh],(function(){return 0})),bF=Za(pF.prototype,"_fontSize",[vh],(function(){return 40})),vF=Za(pF.prototype,"_fontColor",[vh],(function(){return Ls.WHITE.clone()})),SF=Za(pF.prototype,"_maxWidth",[vh],(function(){return 0})),TF=Za(pF.prototype,"_fontFamily",[vh],(function(){return"Arial"})),wF=Za(pF.prototype,"_font",[vh],(function(){return null})),xF=Za(pF.prototype,"_isSystemFontUsed",[vh],(function(){return!0})),CF=Za(pF.prototype,"_userDefinedFont",[vh],(function(){return null})),AF=Za(pF.prototype,"_cacheMode",[vh],(function(){return 0})),DF=Za(pF.prototype,"_imageAtlas",[vh],(function(){return null})),EF=Za(pF.prototype,"_handleTouchEvent",[vh],(function(){return!0})),_F=pF))||_F)||_F)||_F);t({RichTextComponent:zF,RichText:zF}),a.RichText=zF,a.MaskComponent=vR,Xt(vR,"cc.MaskComponent"),a.LabelComponent=eP,Xt(eP,"cc.LabelComponent"),a.LabelOutlineComponent=MP,Xt(MP,"cc.LabelOutlineComponent"),a.RichTextComponent=zF,Xt(zF,"cc.RichTextComponent"),a.SpriteComponent=CP,Xt(CP,"cc.SpriteComponent"),a.UIModelComponent=DP,Xt(DP,"cc.UIModelComponent"),a.GraphicsComponent=sR,Xt(sR,"cc.GraphicsComponent"),Xt(NP,"cc.UIStaticBatchComponent"),Xt(jP,"cc.UIOpacityComponent"),Q(vR.prototype,"Mask",[{name:"graphics",newName:"subComp",target:vR.prototype,targetName:"Mask"}]),Q(bR,"MaskType",[{name:"RECT",newName:"GRAPHICS_RECT",target:bR,targetName:"MaskType"},{name:"ELLIPSE",newName:"GRAPHICS_ELLIPSE",target:bR,targetName:"MaskType"},{name:"IMAGE_STENCIL",newName:"SPRITE_STENCIL",target:bR,targetName:"MaskType"}]),tt(MP.prototype,"LabelOutline",[{name:"width",suggest:"Please use Label.outlineWidth instead."},{name:"color",suggest:"Please use Label.outlineColor instead."}]),tt(kP.prototype,"LabelShadow",[{name:"color",suggest:"Please use Label.shadowColor instead."},{name:"offset",suggest:"Please use Label.shadowOffset instead."},{name:"blur",suggest:"Please use Label.shadowBlur instead."}]);const UF=["left","center","right"],VF=2048,jF=zD(),HF=(1/255).toFixed(3);class GF{constructor(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""}}class WF{constructor(){this._context=null,this._canvas=null,this._canvasData=null,this._lettersInfo=[],this._tmpRect=new Wr,this._maxFontSize=100,this._fontScale=1;const t=this._canvasData=LE.getInstance().get();this._canvas=t.canvas,this._context=t.context}destroy(){LE.getInstance().put(this._canvasData),this._canvasData=null,this._canvas=null,this._context=null,this._lettersInfo.length=0}processingString(t,e,i,s,r,n){if(t)e.fntConfig?this._fontScale=1:this._fontScale=this._getStyleFontScale(e.originFontSize,e.fontScale),GE.fontScale=this._fontScale,this._setupBMFontOverflowMetrics(i,s),this._updateFontScale(e),this._computeHorizontalKerningForText(e,i,r),this._alignText(e,i,s,r);else{let t=0;for(this._fontScale=this._getStyleFontScale(e.fontSize,e.fontScale),this._updatePaddingRect(e,s),this._calculateLabelFont(e,i,s,r);(s.canvasSize.width>VF||s.canvasSize.height>VF)&&t<=3;){if(t++,t>3)this._fontScale=1;else{const t=Math.max(s.canvasSize.width,s.canvasSize.height),e=VF/t;this._fontScale*=e,this._fontScale=Math.max(1,this._fontScale)}this._updatePaddingRect(e,s),this._calculateLabelFont(e,i,s,r)}}n&&(n=s.parsedString)}generateRenderInfo(t,e,i,s,r,n,o){t?(this._computeAlignmentOffset(e,i,s),this.generateVertexData(t,e,i,s,r,n,o)):(this._updateLabelDimensions(e,i,s),this._updateTexture(e,i,s,r),this.generateVertexData(t,e,i,s,r,n,o))}setCanvasUsed(t,e){this._canvas=t,this._context=e}_getStyleFontScale(t,e){let i=e;const s=this._maxFontSize;return i*t>s&&t<s&&(i=s/t),i<1&&(i=1),i}_calculateLabelFont(t,e,i,s){if(!this._context)return;t.actualFontSize=t.fontSize*this._fontScale,t.actualFontSize=Math.floor(t.actualFontSize),this._fontScale=t.actualFontSize/t.fontSize;const r=s.split("\n"),n=i.parsedString=r,o=this._getFontDesc(t.actualFontSize,t.fontFamily,t.isBold,t.isItalic);this._context.font=t.fontDesc=o;const{canvasSize:a,nodeContentSize:h,canvasPadding:l,contentSizeExtend:c}=i,u=this._fontScale;switch(e.overFlow){case 0:{let i=0,s=0;for(let t=0;t<r.length;++t){const e=ZD(this._context,r[t],o);i=i>e?i:e}s=(n.length+ND)*this._getLineHeight(e.lineHeight,t.actualFontSize,t.fontSize);const d=i,_=s;a.width=d+l.width*u,a.height=_+l.height*u,h.width=(d+c.width*u)/u,h.height=(_+c.height*u)/u;break}case 2:this._calculateShrinkFont(r,t,e,i),this._calculateWrapText(r,t,e,i),a.width=h.width*u,a.height=h.height*u;break;case 1:this._calculateWrapText(r,t,e,i),a.width=h.width*u,a.height=h.height*u;break;case 3:{this._calculateWrapText(r,t,e,i);const s=(i.parsedString.length+ND)*this._getLineHeight(e.lineHeight,t.actualFontSize,t.fontSize);a.width=h.width*u,a.height=s+l.height*u,h.height=(s+c.height*u)/u;break}}}_getFontDesc(t,e,i,s){let r=`${t.toString()}px `;return r+=e,i&&(r=`bold ${r}`),s&&(r=`italic ${r}`),r}_getLineHeight(t,e,i){let s=t;return s=0===s?e:s*e/i,s}_calculateShrinkFont(t,e,i,s){if(!this._context)return;let r=this._getFontDesc(e.actualFontSize,e.fontFamily,e.isBold,e.isItalic);this._context.font=r;const n=this._calculateParagraphLength(t,this._context,r);let o=0,a=0,h=0,l=e.actualFontSize;const{canvasSize:c,nodeContentSize:u,canvasPadding:d}=s,_=this._fontScale;if(i.wrapping){const s=u.width*_,n=u.height*_;if(s<0||n<0)return;a=n+1;let h=[],c=0,d=0|e.actualFontSize+1,p=0;for(;c<d;){if(p=c+d+1>>1,p<=0){k(4003);break}l=p,r=this._getFontDesc(l,e.fontFamily,e.isBold,e.isItalic),this._context.font=r;const u=this._getLineHeight(i.lineHeight,l,e.fontSize);for(a=0,o=0;o<t.length;++o){const e=ZD(this._context,t[o],r);h=oE(t[o],e,s,this._measureText(this._context,r)),a+=h.length*u}a>n?d=p-1:c=p}0===c?k(4003):(l=c,r=this._getFontDesc(l,e.fontFamily,e.isBold,e.isItalic),this._context.font=r)}else{for(a=t.length*this._getLineHeight(i.lineHeight,l,e.fontSize),o=0;o<t.length;++o)h<n[o]&&(h=n[o]);const s=(c.width-d.width)*_/h,u=c.height*_/a;l=e.actualFontSize*Math.min(1,s,u)|0,r=this._getFontDesc(l,e.fontFamily,e.isBold,e.isItalic),this._context.font=r}e.actualFontSize=l,e.fontDesc=r}_calculateWrapText(t,e,i,s){if(!i.wrapping||!this._context)return;let r=[];const n=s.nodeContentSize.width*this._fontScale,o=this._getFontDesc(e.actualFontSize,e.fontFamily,e.isBold,e.isItalic);this._context.font=o;for(let e=0;e<t.length;++e){const i=ZD(this._context,t[e],o),s=oE(t[e],i,n,this._measureText(this._context,o));r=r.concat(s)}s.parsedString=r,e.fontDesc=o}_measureText(t,e){return i=>ZD(t,i,e)}_calculateParagraphLength(t,e,i){return t.map((t=>ZD(e,t,i)))}_updatePaddingRect(t,e){let i=0,s=0,r=0,n=0,o=0;const{contentSizeExtend:a,canvasPadding:h}=e;if(a.width=a.height=0,t.isOutlined&&(o=t.outlineWidth,i=s=r=n=o,a.width=a.height=2*o),t.hasShadow){const e=t.shadowBlur+o,a=t.shadowOffsetX,h=t.shadowOffsetY;r=Math.max(r,-a+e),n=Math.max(n,a+e),i=Math.max(i,h+e),s=Math.max(s,-h+e)}if(t.isItalic){const e=t.fontSize*Math.tan(.20943951);n+=e,a.width+=e}h.x=r,h.y=i,h.width=r+n,h.height=i+s}_updateLabelDimensions(t,e,i){const{canvasSize:s}=i;s.width=Math.min(s.width,VF),s.height=Math.min(s.height,VF);const r=this._canvas,n=this._context;r.width=s.width,r.height=s.height,n.font=t.fontDesc,n.textAlign=UF[e.horizontalAlign],n.textBaseline="alphabetic"}_calculateFillTextStartPosition(t,e,i){let s=0;const{canvasSize:r,canvasPadding:n}=i;2===e.horizontalAlign?s=r.width-n.width:1===e.horizontalAlign&&(s=(r.width-n.width)/2);const o=this._getLineHeight(e.lineHeight,t.actualFontSize,t.fontSize)*(i.parsedString.length-1);let a=t.actualFontSize*(1-ND/2);if(0!==e.verticalAlign){let i=o+n.height+t.actualFontSize-r.height;2===e.verticalAlign?(i+=ND/2*t.actualFontSize,a-=i):a-=i/2}a+=jF*t.actualFontSize,i.startPosition.set(s+n.x,a+n.y)}_updateTexture(t,e,i,s){const r=this._context,n=this._canvas;if(!r||!n)return;r.clearRect(0,0,n.width,n.height),r.font=t.fontDesc,this._calculateFillTextStartPosition(t,e,i);const o=this._getLineHeight(e.lineHeight,t.actualFontSize,t.fontSize);r.lineJoin="round",t.isOutlined?(r.fillStyle=`rgba(${t.outlineColor.r}, ${t.outlineColor.g}, ${t.outlineColor.b}, ${HF})`,r.fillRect(0,0,n.width,n.height)):(r.fillStyle=`rgba(${t.color.r}, ${t.color.g}, ${t.color.b}, ${HF})`,r.fillRect(0,0,n.width,n.height)),r.fillStyle=`rgb(${t.color.r}, ${t.color.g}, ${t.color.b})`;const{startPosition:a}=i,h=new kr(a.x,a.y),l=h.x;let c=0;this._drawTextEffect(h,o,t,e,i);const{parsedString:u}=i;for(let e=0;e<u.length;++e)c=h.y+e*o,t.hasShadow&&(this._setupShadow(t),r.fillText(u[e],l,c)),t.isOutlined&&(this._setupOutline(t),r.strokeText(u[e],l,c)),t.hasShadow&&!t.isOutlined||r.fillText(u[e],l,c);t.hasShadow&&(r.shadowColor="transparent"),this._uploadTexture(s)}_uploadTexture(t){const e=this._canvas;if(t.texture&&e){let i;if(i=t.texture instanceof yD?t.texture.texture:t.texture,0!==e.width&&0!==e.height){const s=i.getGFXTexture(),r=i.getGFXSampler();i.reset({width:e.width,height:e.height,mipmapLevel:1}),i.uploadData(e),i.setWrapMode(2,2),t.texture instanceof yD&&(t.texture.rect=new Wr(0,0,e.width,e.height),t.texture._calculateUV()),a.director.root&&a.director.root.batcher2D&&a.director.root.batcher2D._releaseDescriptorSetCache(s,r)}}}_drawTextEffect(t,e,i,s,r){if(!i.hasShadow&&!i.isOutlined&&!i.isUnderline)return;const n=this._context,{parsedString:o}=r,a=o.length>1&&i.hasShadow,h=this._measureText(this._context,i.fontDesc);let l=0,c=0;for(let r=0;r<o.length;++r)if(l=t.x,c=t.y+r*e,a&&(i.hasShadow&&(this._setupShadow(i),n.fillText(o[r],l,c)),i.isOutlined&&(this._setupOutline(i),n.strokeText(o[r],l,c)),i.hasShadow&&!i.isOutlined||n.fillText(o[r],l,c)),i.isUnderline){const e=h(o[r]),a=new kr;2===s.horizontalAlign?a.x=t.x-e:1===s.horizontalAlign?a.x=t.x-e/2:a.x=t.x,a.y=c+i.actualFontSize/8,n.fillRect(a.x,a.y,e,i.underlineHeight*this._fontScale)}a&&(n.shadowColor="transparent")}_setupOutline(t){const e=this._context;e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.strokeStyle=`rgba(${t.outlineColor.r}, ${t.outlineColor.g}, ${t.outlineColor.b}, ${t.outlineColor.a/255})`,e.lineWidth=2*t.outlineWidth*this._fontScale}_setupShadow(t){const e=this._context,i=this._fontScale;e.shadowColor=`rgba(${t.shadowColor.r}, ${t.shadowColor.g}, ${t.shadowColor.b}, ${t.shadowColor.a/255})`,e.shadowBlur=t.shadowBlur*i,e.shadowOffsetX=t.shadowOffsetX*i,e.shadowOffsetY=-t.shadowOffsetY*i}generateVertexData(t,e,i,s,r,n,o){t?this._updateQuads(e,i,s,r,n,o):(this.updateQuatCount(r),o(e,s,r))}updateQuatCount(t){const e=t.vertexBuffer,i=t.quadCount;if(e.length!==i){for(let t=e.length;t<i;t++)e.push({x:0,y:0,z:0,u:0,v:0,color:Ls.WHITE.clone()});e.length=i}}_setupBMFontOverflowMetrics(t,e){const{nodeContentSize:i}=e;let s=i.width,r=i.height;3===t.overFlow&&(r=0),0===t.overFlow&&(s=0,r=0),t.textWidthTemp=s,t.textHeightTemp=r,t.textDimensions.width=s,t.textDimensions.height=r,t.maxLineWidth=s}_updateFontScale(t){t.bmfontScale=t.actualFontSize/(t.originFontSize*this._fontScale)}_computeHorizontalKerningForText(t,e,i){const s=i,r=s.length;if(!t.fntConfig)return;const n=t.fntConfig.kerningDict,o=e.horizontalKerning;if(!n||0===n.length)return;let a=-1;for(let t=0;t<r;++t){const e=s.charCodeAt(t),i=n[a<<16|65535&e]||0;o[t]=t<r-1?i:0,a=e}}_alignText(t,e,i,s){this._multilineTextWrap(t,e,i,s,this._getFirstWordLen),2===e.overFlow&&(t.fontSize>0&&this._isVerticalClamp(t,e,i,s,this)&&this._shrinkLabelToContentSize(t,e,i,s,this._isVerticalClamp),t.fontSize>0&&this._isHorizontalNeedShrink(e,i)&&this._shrinkLabelToContentSize(t,e,i,s,this._isHorizontalClamp)),this._parsedString(i,s)}_parsedString(t,e){let i=[],s="";for(let t=0,r=0,n=QD(e);t<n;++t){const e=this._lettersInfo[t];e.valid&&(r===e.line?s+=e.char:(i=i.concat(s),r=e.line,s=""))}i=i.concat(s),t.parsedString=i}_multilineTextWrap(t,e,i,s,r){e.linesWidth.length=0;const n=s,o=n.length;let a=0,h=0,l=0,c=0,u=0,d=0,_=0,p=null;for(let i=0;i<o;){let s=JD(n,i);if("\n"===s){e.linesWidth.push(u),u=0,a++,h=0,l-=e.lineHeight*this._getFontScale(t,e)+0,this._recordPlaceholderInfo(i,s),i++;continue}const m=r(t,e,n,i,o);let g=d,f=_,y=u,b=h,v=!1;const S=new kr;for(let r=0;r<m;++r){const c=i+r;if(s=JD(n,c),"\r"===s){this._recordPlaceholderInfo(c,s);continue}if(p=GE.fontAtlas.getLetterDefinitionForChar(s,GE),!p){this._recordPlaceholderInfo(c,s),null!=t.fntConfig?k(16354,t.fntConfig.atlasName,s):k(16355,t.fontFamily,s);continue}const d=b+p.offsetX*t.bmfontScale-GE.margin;if(e.wrapping&&e.maxLineWidth>0&&h>0&&d+p.w*t.bmfontScale>e.maxLineWidth&&!KD(s)){e.linesWidth.push(u),u=0,a++,h=0,l-=e.lineHeight*this._getFontScale(t,e)+0,v=!0;break}S.x=d,S.y=l-p.offsetY*t.bmfontScale,this._recordLetterInfo(S,s,c,a),c+1<e.horizontalKerning.length&&c<o-1&&(b+=e.horizontalKerning[c+1]*t.bmfontScale),b+=p.xAdvance*t.bmfontScale+e.spacingX,y=S.x+p.w*t.bmfontScale,g<S.y&&(g=S.y),f>S.y-p.h*t.bmfontScale&&(f=S.y-p.h*t.bmfontScale)}v||(h=b,u=y,d<g&&(d=g),_>f&&(_=f),c<u&&(c=u),i+=m)}e.linesWidth.push(u),e.numberOfLines=a+1,e.textDesiredHeight=e.numberOfLines*e.lineHeight*this._getFontScale(t,e),e.numberOfLines>1&&(e.textDesiredHeight+=0*(e.numberOfLines-1));const{nodeContentSize:m}=i;return m.width=e.textWidthTemp,m.height=e.textHeightTemp,e.textWidthTemp<=0&&(m.width=parseFloat(c.toFixed(2))+2*GE.margin),e.textHeightTemp<=0&&(m.height=parseFloat(e.textDesiredHeight.toFixed(2))+2*GE.margin),e.tailoredTopY=m.height,e.tailoredBottomY=0,d>0&&(e.tailoredTopY=m.height+d),_<-e.textDesiredHeight&&(e.tailoredBottomY=e.textDesiredHeight+_),!0}_recordPlaceholderInfo(t,e){const i=this._lettersInfo;if(t>=i.length){const t=new GF;i.push(t)}i[t].char=e,i[t].hash=`${tE(e,0)}${GE.hash}`,i[t].valid=!1}_recordLetterInfo(t,e,i,s){const r=this._lettersInfo;if(i>=r.length){const t=new GF;r.push(t)}const n=`${tE(e,0)}${GE.hash}`;r[i].line=s,r[i].char=e,r[i].hash=n,r[i].valid=GE.fontAtlas.getLetter(n).valid,r[i].x=t.x,r[i].y=t.y}_getFirstWordLen(t,e,i,s,r){let n=JD(i,s);if($D(n)||"\n"===n||KD(n))return 1;const o=GE.fontAtlas;let a=1,h=o.getLetterDefinitionForChar(n,GE);if(!h)return a;let l=h.xAdvance*t.bmfontScale+e.spacingX,c=0;for(let u=s+1;u<r&&(n=JD(i,u),h=o.getLetterDefinitionForChar(n,GE),h);++u){if(c=l+h.offsetX*t.bmfontScale,c+h.w*t.bmfontScale>e.maxLineWidth&&!KD(n)&&e.maxLineWidth>0)return a;if(l+=h.xAdvance*t.bmfontScale+e.spacingX,"\n"===n||KD(n)||$D(n))break;a++}return a}_computeAlignmentOffset(t,e,i){const{nodeContentSize:s}=i;switch(e.linesOffsetX.length=0,e.letterOffsetY=0,e.horizontalAlign){case 0:for(let t=0;t<e.numberOfLines;++t)e.linesOffsetX.push(0);break;case 1:for(let t=0,i=e.linesWidth.length;t<i;t++)e.linesOffsetX.push((s.width-e.linesWidth[t])/2);break;case 2:for(let t=0,i=e.linesWidth.length;t<i;t++)e.linesOffsetX.push(s.width-e.linesWidth[t])}if(e.letterOffsetY=s.height,0!==e.verticalAlign){const i=s.height-e.textDesiredHeight+e.lineHeight*this._getFontScale(t,e)-t.originFontSize*this._fontScale*t.bmfontScale;2===e.verticalAlign?e.letterOffsetY-=i:e.letterOffsetY-=i/2}}_getFontScale(t,e){return 2===e.overFlow?t.bmfontScale:1}_isVerticalClamp(t,e,i,s,r){return e.textDesiredHeight>i.nodeContentSize.height}_isHorizontalClamp(t,e,i,s,r){let n=!1;for(let o=0,a=QD(s);o<a;++o){const s=r._lettersInfo[o];if(s.valid){const r=GE.fontAtlas.getLetterDefinitionForChar(s.char,GE);if(!r)continue;const o=s.x+r.w*t.bmfontScale,a=s.line;if(e.textWidthTemp>0){const{nodeContentSize:t}=i;if(e.wrapping){if(e.linesWidth[a]>t.width&&(o>t.width||o<0)){n=!0;break}}else if(o>t.width){n=!0;break}}}}return n}_isHorizontalNeedShrink(t,e){let i=0;for(let s=0,r=t.linesWidth.length;s<r;++s)if(i=t.linesWidth[s],i>e.nodeContentSize.width)return!0;return!1}_shrinkLabelToContentSize(t,e,i,s,r){let n=0,o=0|t.actualFontSize,a=0;for(;n<o;){a=n+o+1>>1;const h=a;if(h<=0)break;t.bmfontScale=h/(t.originFontSize*this._fontScale),this._multilineTextWrap(t,e,i,s,this._getFirstWordLen),this._computeAlignmentOffset(t,e,i),r(t,e,i,s,this)?o=a-1:n=a}n>=0&&this._scaleFontSizeDown(t,e,i,s,n)}_scaleFontSizeDown(t,e,i,s,r){let n=!0;r||(r=.1,n=!1),t.actualFontSize=r,n&&(this._updateFontScale(t),this._multilineTextWrap(t,e,i,s,this._getFirstWordLen))}_updateQuads(t,e,i,s,r,n){const o=GE.fontAtlas,a=t.spriteFrame?t.spriteFrame.texture:o.getTexture(),{nodeContentSize:h}=i,l=s.uiTransAnchorX*h.width,c=s.uiTransAnchorY*h.height;for(let h=0,u=QD(r);h<u;++h){const r=this._lettersInfo[h];if(!r.valid)continue;const u=o.getLetter(r.hash);if(!u){j(16353);continue}const d=this._tmpRect;d.height=u.h,d.width=u.w,d.x=u.u,d.y=u.v;let _=r.y+e.letterOffsetY;if(e.textHeightTemp>0){if(_>e.tailoredTopY){const t=_-e.tailoredTopY;d.y+=t,d.height-=t,_-=t}_-d.height*t.bmfontScale<e.tailoredBottomY&&1===e.overFlow&&(d.height=_<e.tailoredBottomY?0:(_-e.tailoredBottomY)/t.bmfontScale)}const p=r.line,m=r.x+u.w/2*t.bmfontScale+e.linesOffsetX[p];if(e.textWidthTemp>0&&this._isHorizontalClamped(e,i,m,p)&&1===e.overFlow&&(d.width=0),d.height>0&&d.width>0){const o=this._determineRect(t),h=r.x+e.linesOffsetX[r.line],u=s.quadCount;s.quadCount+=4,this.updateQuatCount(s),n(t,i,s,u,a,d,o,h-l,_-c)}}return!0}_isHorizontalClamped(t,e,i,s){const{nodeContentSize:r}=e,n=t.linesWidth[s],o=i>r.width||i<0;return t.wrapping?n>r.width&&o:o}_determineRect(t){const e=t.spriteFrame;if(!e)return!1;const i=e.isRotated(),s=e.getOriginalSize(),r=e.getRect(),n=e.getOffset(),o=n.x+(s.width-r.width)/2,a=n.y-(s.height-r.height)/2,h=this._tmpRect;if(i){const t=h.x;h.x=r.x+r.height-h.y-h.height-a,h.y=t+r.y-o,h.y<0&&(h.height+=a)}else h.x+=r.x-o,h.y+=r.y+a;return i}}WF.instance=void 0,WF.instance=new WF;const XF=new HE(64,64),YF=new OE(null);let qF=null,$F=null,KF=null,ZF=null,QF=null;class JF{updateProcessingData(t,e,i,s,r,n){t.fontSize=r.fontSize,t.actualFontSize=r.fontSize,t.originFontSize=KF?KF.fontSize:r.fontSize,e.horizontalAlign=r.horizontalAlign,e.verticalAlign=r.verticalAlign,e.spacingX=r.spacingX;const o=r.overflow;e.overFlow=o,e.lineHeight=r.lineHeight;const a=i.nodeContentSize;a.width=n.width,a.height=n.height,0===o?(e.wrapping=!1,a.width+=2*GE.margin,a.height+=2*GE.margin):3===o?(e.wrapping=!0,a.height+=2*GE.margin):e.wrapping=r.enableWrapText,s.uiTransAnchorX=n.anchorX,s.uiTransAnchorY=n.anchorY,GE.lineHeight=r.lineHeight,GE.fontSize=r.fontSize,t.spriteFrame=ZF,t.fntConfig=KF,t.fontFamily=GE.fontFamily,t.color.set(r.color)}updateRenderData(t){if(t.renderData&&qF!==t){if(t.renderData.vertDirty){qF=t,$F=qF.node._getUITransformComp();const e=t.renderData,i=WF.instance,s=t.textStyle,r=t.textLayout,n=t.textLayoutData,o=t.textRenderData;s.fontScale=XA.getScaleX(),this._updateFontFamily(t),this.updateProcessingData(s,r,n,o,t,$F),this._updateLabelInfo(t),s.fontDesc=GE.fontDesc,i.processingString(!0,s,r,n,t.string),o.quadCount=0,i.generateRenderInfo(!0,s,r,n,o,t.string,this.generateVertexData);let a=!1;e.dataLength!==o.quadCount&&(this.resetRenderData(t),e.dataLength=o.quadCount,e.resize(e.dataLength,e.dataLength/2*3),a=!0);const h=e.data;for(let t=0,e=o.quadCount;t<e;t++)h[t]=o.vertexBuffer[t];const l=e.indexCount;this.createQuadIndices(l),e.chunk.setIndexBuffer(QF),qF.actualFontSize=s.actualFontSize,$F.setContentSize(n.nodeContentSize),this.updateUVs(t),(qF.renderEntity.colorDirty||a)&&(this.updateColor(t),qF.node._uiProps.colorDirty=!1),e.vertDirty=!1,qF=null,this._resetProperties()}t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame)}}updateUVs(t){const e=t.renderData;if(!e)return;const i=e.chunk.vb,s=e.vertexCount,r=e.floatStride,n=e.data;let o=3;for(let t=0;t<s;t++){const e=n[t];i[o]=e.u,i[o+1]=e.v,o+=r}}updateColor(t){const e=t.renderData;if(e){const i=e.vertexCount;if(0===i)return;const s=e.chunk.vb,r=e.floatStride;let n=5;const o=t.color,a=o.r/255,h=o.g/255,l=o.b/255,c=o.a/255;for(let t=0;t<i;t++)s[n]=a,s[n+1]=h,s[n+2]=l,s[n+3]=c,n+=r}}resetRenderData(t){const e=t.renderData;e&&(e.dataLength=0,e.resize(0,0))}generateVertexData(t,e,i,s,r,n,o,a,h){const l=s,c=t.bmfontScale,u=i.vertexBuffer,d=r.width,_=r.height,p=n.width,m=n.height;let g=0,f=0,y=0,b=0;o?(g=n.x/d,b=(n.x+m)/d,f=(n.y+p)/_,y=n.y/_,u[l].u=g,u[l].v=y,u[l+1].u=g,u[l+1].v=f,u[l+2].u=b,u[l+2].v=y,u[l+3].u=b,u[l+3].v=f):(g=n.x/d,b=(n.x+p)/d,f=(n.y+m)/_,y=n.y/_,u[l].u=g,u[l].v=f,u[l+1].u=b,u[l+1].v=f,u[l+2].u=g,u[l+2].v=y,u[l+3].u=b,u[l+3].v=y),u[l].x=a,u[l].y=h-m*c,u[l+1].x=a+p*c,u[l+1].y=h-m*c,u[l+2].x=a,u[l+2].y=h,u[l+3].x=a+p*c,u[l+3].y=h}_updateFontFamily(t){const e=t.font;ZF=e.spriteFrame,KF=e.fntConfig,GE.fontAtlas=e.fontDefDictionary,GE.fontAtlas||(2===t.cacheMode?GE.fontAtlas=XF:GE.fontAtlas=YF),eD.packToDynamicAtlas(t,ZF)}_updateLabelInfo(t){GE.hash="",GE.margin=0}_resetProperties(){KF=null,ZF=null,GE.hash="",GE.margin=0}createQuadIndices(t){if(t%6!=0)return void G(16308);const e=t/6;QF=new Uint16Array(t);let i=0;for(let t=0;t<e;t++)QF[i++]=0+4*t,QF[i++]=1+4*t,QF[i++]=2+4*t,QF[i++]=1+4*t,QF[i++]=3+4*t,QF[i++]=2+4*t}}const tN=new Ls(255,255,255,255),eN=new class extends JF{createData(t){const e=t.requestRenderData();return e.resize(0,0),e}fillBuffers(t,e){const i=t.node;tN.set(t.color),tN.a=255*i._uiProps.opacity,zp(i,0,t.renderData,tN)}};let iN=null;class sN extends JF{getAssemblerData(){return iN||(iN=new HE(1024,1024)),iN.getTexture()}_updateFontFamily(t){GE.fontAtlas=iN,GE.fontFamily=this._getFontFamily(t),t.enableOutline&&t.outlineWidth>0?(GE.isOutlined=!0,GE.margin=t.outlineWidth,GE.out=t.outlineColor.clone(),GE.out.a=t.outlineColor.a*t.color.a/255):(GE.isOutlined=!1,GE.margin=0)}_getFontFamily(t){let e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(e=t.font._nativeAsset||"Arial"),e}_updateLabelInfo(t){GE.fontDesc=this._getFontDesc(),GE.color.set(t.color),GE.hash=WE(GE)}_getFontDesc(){let t=`${GE.fontSize.toString()}px `;return t+=GE.fontFamily,t}}const rN=new Ls(255,255,255,255),nN=new class extends sN{createData(t){const e=t.requestRenderData();return e.resize(0,0),e}fillBuffers(t,e){if(!t.renderData)return;const i=t.node;rN.a=255*i._uiProps.opacity,zp(i,0,t.renderData,rN)}updateColor(t){const e=t.renderData;if(e){const t=e.vertexCount;if(0===t)return;const i=e.chunk.vb,s=e.floatStride;let r=5;for(let e=0;e<t;e++)i[r]=1,i[r+1]=1,i[r+2]=1,i[r+3]=1,r+=s}}};eP.Overflow;class oN{updateProcessingData(t,e,i,s,r,n){t.isSystemFontUsed=r.useSystemFont,t.fontSize=r.fontSize,i.nodeContentSize.width=i.canvasSize.width=n.width,i.nodeContentSize.height=i.canvasSize.height=n.height,e.lineHeight=r.lineHeight,e.overFlow=r.overflow,0===r.overflow?e.wrapping=!1:3===r.overflow?e.wrapping=!0:e.wrapping=r.enableWrapText,t.isBold=r.isBold,t.isItalic=r.isItalic,t.isUnderline=r.isUnderline,t.underlineHeight=r.underlineHeight,r.enableOutline&&r.outlineWidth>0?(t.isOutlined=!0,t.outlineColor.set(r.outlineColor),t.outlineWidth=r.outlineWidth):t.isOutlined=!1,r.enableShadow&&(r.shadowBlur>0||!Oi(r.shadowOffset.x,0)||!Oi(r.shadowOffset.y,0))?(t.hasShadow=!0,t.shadowColor.set(r.shadowColor),t.shadowBlur=r.shadowBlur,t.shadowOffsetX=r.shadowOffset.x,t.shadowOffsetY=r.shadowOffset.y):t.hasShadow=!1,t.color.set(r.color),s.texture=r.spriteFrame,s.uiTransAnchorX=n.anchorX,s.uiTransAnchorY=n.anchorY,e.horizontalAlign=r.horizontalAlign,e.verticalAlign=r.verticalAlign}getAssemblerData(){const t=eP._canvasPool.get();return t.canvas.width=t.canvas.height=1,t}resetAssemblerData(t){t&&eP._canvasPool.put(t)}updateRenderData(t){const e=t.renderData;if(e){if(e.vertDirty){const i=t.node._getUITransformComp(),s=WF.instance,r=t.textStyle,n=t.textLayout,o=t.textLayoutData,a=t.textRenderData;r.fontScale=XA.getScaleX(),this.updateProcessingData(r,n,o,a,t,i),s.setCanvasUsed(t.assemblerData.canvas,t.assemblerData.context),r.fontFamily=this._updateFontFamily(t),this._resetDynamicAtlas(t),s.processingString(!1,r,n,o,t.string),s.generateRenderInfo(!1,r,n,o,a,t.string,this.generateVertexData),e.textureDirty=!0,this._calDynamicAtlas(t,o),t.actualFontSize=r.actualFontSize,i.setContentSize(o.nodeContentSize);const h=e.data,l=a.vertexBuffer;h[0]=l[0],h[1]=l[1],h[2]=l[2],h[3]=l[3],this.updateUVs(t),e.vertDirty=!1,t.contentWidth=o.nodeContentSize.width}t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame)}}generateVertexData(t,e,i){const s=i.vertexBuffer,r=e.nodeContentSize,n=r.width,o=r.height,a=i.uiTransAnchorX*n,h=i.uiTransAnchorY*o;s[0].x=-a,s[0].y=-h,s[1].x=n-a,s[1].y=-h,s[2].x=-a,s[2].y=o-h,s[3].x=n-a,s[3].y=o-h}updateVertexData(t){}updateUVs(t){}_updateFontFamily(t){let e="";return e=t.useSystemFont?t.fontFamily||"Arial":t.font&&t.font._nativeAsset||"Arial",e}_calDynamicAtlas(t,e){if(1!==t.cacheMode||e.canvasSize.width<=0||e.canvasSize.height<=0)return;const i=t.ttfSpriteFrame;eD.packToDynamicAtlas(t,i)}_resetDynamicAtlas(t){if(1!==t.cacheMode)return;const e=t.ttfSpriteFrame;eD.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame()}}const aN=Ls.WHITE.clone(),hN=Uint16Array.from([0,1,2,1,3,2]),lN=new class extends oN{createData(t){const e=t.requestRenderData();e.dataLength=4,e.resize(4,6),t.textRenderData.quadCount=4;const i=e.chunk.vb,s=e.floatStride,r=[{u:0,v:1},{u:1,v:1},{u:0,v:0},{u:1,v:0}];let n=3;for(let t=0,o=e.dataLength;t<o;++t)i[n]=r[t].u,i[n+1]=r[t].v,n+=s;let o=5;for(let t=0;t<e.dataLength;t++)Ls.toArray(i,aN,o),o+=s;return e.chunk.setIndexBuffer(hN),e}fillBuffers(t,e){const i=t.renderData;if(!i)return;const s=i.chunk,r=i.data,n=t.node,o=s.vb,a=n.worldMatrix,h=i.floatStride;let l=0;const c=r.length;for(let t=0;t<c;t++){const e=r[t],i=e.x,s=e.y;let n=a.m03*i+a.m07*s+a.m15;n=n?1/n:1,l=t*h,o[l+0]=(a.m00*i+a.m04*s+a.m12)*n,o[l+1]=(a.m01*i+a.m05*s+a.m13)*n,o[l+2]=(a.m02*i+a.m06*s+a.m14)*n}const u=s.vertexOffset,d=s.meshBuffer,_=s.meshBuffer.iData;let p=d.indexOffset;_[p++]=u,_[p++]=u+1,_[p++]=u+2,_[p++]=u+2,_[p++]=u+1,_[p++]=u+3,d.indexOffset+=6}updateVertexData(t){const e=t.renderData;if(!e)return;const i=t.node._getUITransformComp(),s=i.width,r=i.height,n=i.anchorX*s,o=i.anchorY*r,a=e.data;a[0].x=-n,a[0].y=-o,a[1].x=s-n,a[1].y=-o,a[2].x=-n,a[2].y=r-o,a[3].x=s-n,a[3].y=r-o}updateUVs(t){const e=t.renderData;if(!e||!t.ttfSpriteFrame)return;const i=e.chunk.vb,s=t.ttfSpriteFrame.uv,r=e.floatStride;let n=3;for(let t=0;t<e.dataLength;++t){const e=2*t;i[n]=s[e],i[n+1]=s[e+1],n+=r}}updateColor(t){}},cN=t("labelAssembler",{getAssembler(t){let e=lN;return t.font instanceof RE?e=eN:2===t.cacheMode&&(e=nN),e}});eP.Assembler=cN,CP.FillType;const uN=new vr,dN=Uint16Array.from([0,1,2,1,3,2]),_N=new class{updateRenderData(t){const e=t.spriteFrame;eD.packToDynamicAtlas(t,e);const i=t.renderData;if(i&&e){if(!i.vertDirty)return;let s=t.fillStart,r=t.fillRange;r<0&&(s+=r,r=-r),r=s+r,s=s>1?1:s,s=s<0?0:s,r=r>1?1:r,r=r<0?0:r,r-=s,r=r<0?0:r;let n=s+r;n=n>1?1:n,this.updateUVs(t,s,n),this.updateVertexData(t,s,n),i.updateRenderData(t,e)}}updateUVs(t,e,i){const s=t.spriteFrame,r=t.renderData;if(!r)return;const n=r.chunk.vb,o=s.width,a=s.height,h=s.rect;let l=0,c=0,u=0,d=0,_=0,p=0,m=0,g=0,f=0,y=0,b=0,v=0;s.isRotated()?(l=h.x/o,c=(h.y+h.width)/a,u=(h.x+h.height)/o,d=h.y/a,_=m=l,f=b=u,g=v=c,p=y=d):(l=h.x/o,c=(h.y+h.height)/a,u=(h.x+h.width)/o,d=h.y/a,_=f=l,m=b=u,p=g=c,y=v=d);const S=r.floatStride;let T=3;switch(t.fillType){case 0:n[T]=_+(m-_)*e,n[T+1]=p+(g-p)*e,T+=S,n[T]=_+(m-_)*i,n[T+1]=p+(g-p)*i,T+=S,n[T]=f+(b-f)*e,n[T+1]=y+(v-y)*e,T+=S,n[T]=f+(b-f)*i,n[T+1]=y+(v-y)*i;break;case 1:n[T]=_+(f-_)*e,n[T+1]=p+(y-p)*e,T+=S,n[T]=m+(b-m)*e,n[T+1]=g+(v-g)*e,T+=S,n[T]=_+(f-_)*i,n[T+1]=p+(y-p)*i,T+=S,n[T]=m+(b-m)*i,n[T+1]=g+(v-g)*i;break;default:G(2626)}}updateVertexData(t,e,i){const s=t.renderData;if(!s)return;const r=s.data,n=t.node._getUITransformComp(),o=n.width,a=n.height,h=n.anchorX*o,l=n.anchorY*a;let c=-h,u=-l,d=o-h,_=a-l,p=0,m=0;switch(t.fillType){case 0:p=c+(d-c)*e,m=c+(d-c)*i,c=p,d=m;break;case 1:p=u+(_-u)*e,m=u+(_-u)*i,u=p,_=m;break;default:G(2626)}r[0].x=c,r[0].y=u,r[1].x=d,r[1].y=u,r[2].x=c,r[2].y=_,r[3].x=d,r[3].y=_}createData(t){const e=t.requestRenderData();return e.dataLength=4,e.resize(4,6),e.chunk.setIndexBuffer(dN),e.data.forEach((t=>{t.z=0})),e}updateWorldVertexData(t,e){t.node.getWorldMatrix(uN);const i=t.renderData;if(!i)return;const s=i.floatStride,r=t.renderData.data,n=e.vb;let o=0;for(let t=0;t<4;t++){const e=r[t],i=e.x,a=e.y;let h=uN.m03*i+uN.m07*a+uN.m15;h=h?1/h:1,o=t*s,n[o]=(uN.m00*i+uN.m04*a+uN.m12)*h,n[o+1]=(uN.m01*i+uN.m05*a+uN.m13)*h,n[o+2]=(uN.m02*i+uN.m06*a+uN.m14)*h}}fillBuffers(t,e){const i=t.renderData;if(!i)return;const s=i.chunk;(t._flagChangedVersion!==t.node.flagChangedVersion||i.vertDirty)&&(this.updateWorldVertexData(t,s),i.vertDirty=!1,t._flagChangedVersion=t.node.flagChangedVersion),s.bufferId;const r=s.vertexOffset,n=s.meshBuffer,o=s.meshBuffer.iData;let a=n.indexOffset;o[a++]=r,o[a++]=r+1,o[a++]=r+2,o[a++]=r+2,o[a++]=r+1,o[a++]=r+3,n.indexOffset+=6}updateColor(t){const e=t.renderData;if(!e)return;const i=e.chunk.vb,s=e.floatStride;let r=5;const n=t.color,o=n.r/255,a=n.g/255,h=n.b/255,l=t.node._uiProps.opacity;for(let t=0;t<4;t++)i[r]=o,i[r+1]=a,i[r+2]=h,i[r+3]=l,r+=s}},pN=2*Math.PI,mN=1e-6,gN=new vr,fN=[new kr,new kr,new kr,new kr],yN=new Array(4),bN=new Array(8),vN=[new kr,new kr,new kr,new kr],SN=[new kr,new kr,new kr,new kr],TN=new kr,wN=[new kr,new kr,new kr,new kr];let xN=null;function CN(t,e,i,s,r,n,o){let a=Math.sin(n);a=Math.abs(a)>mN?a:0;let h=Math.cos(n);h=Math.abs(h)>mN?h:0;let l=0,c=0;if(0!==h){if(l=a/h,(t-r.x)*h>0){const e=r.y+l*(t-r.x);o[0].x=t,o[0].y=e}if((e-r.x)*h>0){const t=r.y+l*(e-r.x);o[2].x=e,o[2].y=t}}if(0!==a){if(c=h/a,(s-r.y)*a>0){const t=r.x+c*(s-r.y);o[3].x=t,o[3].y=s}if((i-r.y)*a>0){const t=r.x+c*(i-r.y);o[1].x=t,o[1].y=i}}}function AN(t){const e=t.node._getUITransformComp(),i=e.width,s=e.height,r=e.anchorX*i,n=e.anchorY*s,o=-r,a=-n,h=i-r,l=s-n,c=yN;c[0]=o,c[1]=a,c[2]=h,c[3]=l;const u=t.fillCenter,d=TN.x=Math.min(Math.max(0,u.x),1)*(h-o)+o,_=TN.y=Math.min(Math.max(0,u.y),1)*(l-a)+a;fN[0].x=fN[3].x=o,fN[1].x=fN[2].x=h,fN[0].y=fN[1].y=a,fN[2].y=fN[3].y=l,wN.forEach((t=>{kr.set(t,0,0)})),d!==c[0]&&kr.set(wN[0],3,0),d!==c[2]&&kr.set(wN[2],1,2),_!==c[1]&&kr.set(wN[1],0,1),_!==c[3]&&kr.set(wN[3],2,3)}function DN(t){const e=t.width,i=t.height,s=t.getRect();let r=0,n=0,o=0,a=0;const h=bN;t.isRotated()?(r=s.x/e,n=(s.x+s.height)/e,o=s.y/i,a=(s.y+s.width)/i,h[0]=h[2]=r,h[4]=h[6]=n,h[3]=h[7]=a,h[1]=h[5]=o):(r=s.x/e,n=(s.x+s.width)/e,o=s.y/i,a=(s.y+s.height)/i,h[0]=h[4]=r,h[2]=h[6]=n,h[1]=h[3]=a,h[5]=h[7]=o)}function EN(t,e){const i=e.x-t.x,s=e.y-t.y;if(0===i&&0===s)return 0;if(0===i)return s>0?.5*Math.PI:1.5*Math.PI;{let t=Math.atan(s/i);return i<0&&(t+=Math.PI),t}}function IN(t,e,i,s,r){const n=yN,o=n[0],a=n[1],h=n[2],l=n[3];t[e].x=i.x,t[e].y=i.y,t[e+1].x=s.x,t[e+1].y=s.y,t[e+2].x=r.x,t[e+2].y=r.y;let c=0,u=0;c=(i.x-o)/(h-o),u=(i.y-a)/(l-a),MN(c,u,t,e),c=(s.x-o)/(h-o),u=(s.y-a)/(l-a),MN(c,u,t,e+1),c=(r.x-o)/(h-o),u=(r.y-a)/(l-a),MN(c,u,t,e+2)}function MN(t,e,i,s){const r=bN,n=r[0]+(r[2]-r[0])*t,o=r[4]+(r[6]-r[4])*t,a=r[1]+(r[3]-r[1])*t,h=r[5]+(r[7]-r[5])*t,l=i[s];l.u=n+(o-n)*e,l.v=a+(h-a)*e}const PN=new class{createData(t){return t.requestRenderData()}updateRenderData(t){const e=t.spriteFrame;eD.packToDynamicAtlas(t,e),this.updateUVs(t);const i=t.renderData;if(i&&e){if(!i.vertDirty)return;const s=i.data;let r=t.fillStart,n=t.fillRange;for(n<0&&(r+=n,n=-n);r>=1;)r-=1;for(;r<0;)r+=1;r*=pN,n*=pN;const o=r+n;AN(t),DN(e),CN(yN[0],yN[2],yN[1],yN[3],TN,r,vN),CN(yN[0],yN[2],yN[1],yN[3],TN,r+n,SN);let a=0;for(let t=0;t<4;++t){const e=wN[t];if(!e)continue;if(n>=pN){i.dataLength=a+3,IN(s,a,TN,fN[e.x],fN[e.y]),a+=3;continue}let h=EN(TN,fN[e.x]),l=EN(TN,fN[e.y]);l<h&&(l+=pN),h-=pN,l-=pN;for(let n=0;n<3;++n)h>=o||(h>=r?(i.dataLength=a+3,IN(s,a,TN,fN[e.x],l>=o?SN[t]:fN[e.y]),a+=3):l>r&&(l<=o?(i.dataLength=a+3,IN(s,a,TN,vN[t],fN[e.y]),a+=3):(i.dataLength=a+3,IN(s,a,TN,vN[t],SN[t]),a+=3))),h+=pN,l+=pN}0===a&&(i.dataLength=0),i.resize(a,a);{const e=i.indexCount;this.createQuadIndices(e),i.chunk.setIndexBuffer(xN),this.updateWorldUVData(t),t.renderEntity.colorDirty=!0}i.updateRenderData(t,e)}}createQuadIndices(t){xN=null,xN=new Uint16Array(t);let e=0;for(let i=0;i<t;i++)xN[e++]=i}fillBuffers(t,e){const i=t.node,s=t.renderData;if(!s)return;const r=s.chunk;(t._flagChangedVersion!==i.flagChangedVersion||s.vertDirty)&&(this.updateWorldVertexAndUVData(t,r),s.vertDirty=!1,t._flagChangedVersion=i.flagChangedVersion),this.updateColorLate(t),r.bufferId;const n=r.vertexOffset,o=r.meshBuffer,a=r.meshBuffer.iData,h=o.indexOffset;for(let t=0;t<s.indexCount;t++)a[h+t]=n+t;o.indexOffset+=s.indexCount,o.setDirty()}updateWorldUVData(t){const e=t.renderData;if(!e)return;const i=e.floatStride,s=e.data,r=e.chunk.vb;for(let t=0;t<s.length;t++){const e=t*i;r[e+3]=s[t].u,r[e+4]=s[t].v}}updateWorldVertexAndUVData(t,e){t.node.getWorldMatrix(gN);const i=t.renderData;if(!i)return;const s=i.floatStride,r=t.renderData.data,n=e.vb,o=i.vertexCount;let a=0;for(let t=0;t<o;t++){const e=r[t],i=e.x,o=e.y;let h=gN.m03*i+gN.m07*o+gN.m15;h=h?1/h:1,n[a+0]=(gN.m00*i+gN.m04*o+gN.m12)*h,n[a+1]=(gN.m01*i+gN.m05*o+gN.m13)*h,n[a+2]=(gN.m02*i+gN.m06*o+gN.m14)*h,n[a+3]=e.u,n[a+4]=e.v,a+=s}}updateUVs(t){const e=t.renderData;e&&(e.vertDirty=!0,t._markForUpdateRenderData())}updateColorLate(t){const e=t.renderData;if(!e)return;const i=e.chunk.vb,s=e.floatStride,r=e.vertexCount;let n=5;const o=t.color,a=o.r/255,h=o.g/255,l=o.b/255,c=t.node._uiProps.opacity;for(let t=0;t<r;t++)i[n]=a,i[n+1]=h,i[n+2]=l,i[n+3]=c,n+=s}updateColor(t){}},ON=Uint16Array.from([0,1,2,1,3,2]),RN=new class{createData(t){const e=t.requestRenderData();return e.dataLength=4,e.resize(4,6),e.chunk.setIndexBuffer(ON),e}updateRenderData(t){const e=t.spriteFrame;eD.packToDynamicAtlas(t,e),this.updateUVs(t);const i=t.renderData;i&&e&&(i.vertDirty&&this.updateVertexData(t),i.updateRenderData(t,e))}updateWorldVerts(t,e){const i=t.renderData;if(!i)return;const s=e.vb,r=i.data,n=t.node.worldMatrix,o=n.m00,a=n.m01,h=n.m02,l=n.m03,c=n.m04,u=n.m05,d=n.m06,_=n.m07,p=n.m12,m=n.m13,g=n.m14,f=n.m15,y=i.floatStride;let b=0;const v=r.length;for(let t=0;t<v;++t){const e=r[t],i=e.x,n=e.y;let v=l*i+_*n+f;v=v?1/v:1,b=t*y,s[b+0]=(o*i+c*n+p)*v,s[b+1]=(a*i+u*n+m)*v,s[b+2]=(h*i+d*n+g)*v}}fillBuffers(t,e){if(null===t)return;const i=t.renderData;if(!i)return;const s=i.chunk;(t._flagChangedVersion!==t.node.flagChangedVersion||i.vertDirty)&&(this.updateWorldVerts(t,s),i.vertDirty=!1,t._flagChangedVersion=t.node.flagChangedVersion);const r=s.vertexOffset,n=s.meshBuffer,o=s.meshBuffer.iData;let a=n.indexOffset;const h=r;o[a++]=h,o[a++]=h+1,o[a++]=h+2,o[a++]=h+1,o[a++]=h+3,o[a++]=h+2,n.indexOffset+=6}updateVertexData(t){const e=t.renderData;if(!e)return;const i=t.node._getUITransformComp(),s=e.data,r=i.width,n=i.height,o=i.anchorX*r,a=i.anchorY*n;let h=0,l=0,c=0,u=0;if(t.trim)h=-o,l=-a,c=r-o,u=n-a;else{const e=t.spriteFrame,i=e.originalSize,s=r/i.width,d=n/i.height,_=e.trimmedBorder;h=_.x*s-o,l=_.z*d-a,c=r+_.y*s-o,u=n+_.w*d-a}s[0].x=h,s[0].y=l,s[1].x=c,s[1].y=l,s[2].x=h,s[2].y=u,s[3].x=c,s[3].y=u,e.vertDirty=!0}updateUVs(t){const e=t.renderData;if(!t.spriteFrame||!e)return;const i=e.chunk.vb,s=t.spriteFrame.uv,r=e.floatStride;let n=3;for(let t=0;t<e.dataLength;++t){const e=2*t;i[n]=s[e],i[n+1]=s[e+1],n+=r}}updateColor(t){const e=t.renderData;if(!e)return;const i=e.chunk.vb;let s=5;const r=t.color,n=r.r/255,o=r.g/255,a=r.b/255,h=r.a/255;for(let t=0;t<4;t++,s+=e.floatStride)i[s]=n,i[s+1]=o,i[s+2]=a,i[s+3]=h}},BN=[];for(let t=0;t<4;t++)BN.push({x:0,y:0,z:0,u:0,v:0,color:new Ls});const FN=new class{constructor(){this.QUAD_INDICES=void 0}createData(t){const e=t.requestRenderData();e.dataLength=16,e.resize(16,54);const i=this.QUAD_INDICES=new Uint16Array(54);return this.createQuadIndices(4,4),e.chunk.setIndexBuffer(i),e}createQuadIndices(t,e){let i=0;const s=this.QUAD_INDICES;for(let r=0;r<t-1;r++)for(let t=0;t<e-1;t++){const n=r*e+t;s[i++]=n,s[i++]=n+1,s[i++]=n+e,s[i++]=n+1,s[i++]=n+1+e,s[i++]=n+e}}updateRenderData(t){const e=t.spriteFrame;eD.packToDynamicAtlas(t,e),this.updateUVs(t);const i=t.renderData;i&&e&&(i.vertDirty&&this.updateVertexData(t),i.updateRenderData(t,e))}updateVertexData(t){const e=t.renderData;if(!e)return;const i=e.data,s=t.node._getUITransformComp(),r=s.width,n=s.height,o=s.anchorX*r,a=s.anchorY*n,h=t.spriteFrame,l=h.insetLeft,c=h.insetRight,u=h.insetTop,d=h.insetBottom;let _=r-l-c,p=n-u-d,m=r/(l+c),g=n/(u+d);m=Number.isNaN(m)||m>1?1:m,g=Number.isNaN(g)||g>1?1:g,_=_<0?0:_,p=p<0?0:p,BN[0].x=-o,BN[0].y=-a,BN[1].x=l*m-o,BN[1].y=d*g-a,BN[2].x=BN[1].x+_,BN[2].y=BN[1].y+p,BN[3].x=r-o,BN[3].y=n-a;for(let t=0;t<4;t++)for(let s=0;s<4;s++){const r=4*t+s;r<e.dataLength&&t<BN.length&&s<BN.length&&(i[r].x=BN[s].x,i[r].y=BN[t].y)}}fillBuffers(t,e){const i=t.renderData;if(!i)return;const s=i.chunk;(t._flagChangedVersion!==t.node.flagChangedVersion||i.vertDirty)&&(this.updateWorldVertexData(t,s),i.vertDirty=!1,t._flagChangedVersion=t.node.flagChangedVersion),s.bufferId;const r=s.vertexOffset,n=s.meshBuffer,o=s.meshBuffer.iData;let a=n.indexOffset;for(let t=0;t<3;++t)for(let e=0;e<3;++e){const i=r+4*t+e;o[a++]=i,o[a++]=i+1,o[a++]=i+4,o[a++]=i+1,o[a++]=i+5,o[a++]=i+4}n.indexOffset=a}updateWorldVertexData(t,e){const i=t.renderData;if(!i)return;const s=i.floatStride,r=i.data,n=e.vb,o=t.node.worldMatrix,a=o.m00,h=o.m01,l=o.m02,c=o.m03,u=o.m04,d=o.m05,_=o.m06,p=o.m07,m=o.m12,g=o.m13,f=o.m14,y=o.m15;let b=0;for(let t=0;t<4;++t){const e=r[4*t];for(let i=0;i<4;++i){const o=r[i].x,v=e.y;let S=c*o+p*v+y;S=S?1/S:1,b=(4*t+i)*s,n[b+0]=(a*o+u*v+m)*S,n[b+1]=(h*o+d*v+g)*S,n[b+2]=(l*o+_*v+f)*S}}}updateUVs(t){const e=t.renderData;if(!t.spriteFrame||!e)return;const i=e.chunk.vb,s=e.floatStride,r=t.spriteFrame.uvSliced;let n=3;for(let t=0;t<16;t++)i[n]=r[t].u,i[n+1]=r[t].v,n+=s}updateColor(t){const e=t.renderData;if(!e)return;const i=e.chunk.vb,s=e.floatStride;let r=5;const n=t.color,o=n.r/255,a=n.g/255,h=n.b/255,l=t.node._uiProps.opacity;for(let t=0;t<16;t++)i[r]=o,i[r+1]=a,i[r+2]=h,i[r+3]=l,r+=s}},NN=new vr;let LN,kN,zN,UN,VN,jN,HN,GN=0;const WN=[];let XN=null;function YN(t){return t&&(t.insetTop>0||t.insetBottom>0||t.insetLeft>0||t.insetRight>0)?2:0}const qN=new class{createData(t){return t.requestRenderData()}updateRenderData(t){const e=t.renderData;if(!e)return;const i=t.spriteFrame;if(!i||!e)return;if(eD.packToDynamicAtlas(t,i),!e.vertDirty)return;const s=t.node._getUITransformComp(),r=Math.abs(s.width),n=Math.abs(s.height),o=i.getRect(),a=i.insetLeft,h=i.insetRight,l=o.width-a-h,c=i.insetTop,u=i.insetBottom,d=o.height-c-u;let _=r-a-h,p=n-c-u;_=_>0?_:0,p=p>0?p:0;const m=0===l?_:_/l,g=0===d?p:p/d,f=YN(i),y=Math.ceil(g+f),b=Math.ceil(m+f);e.dataLength=4*y*b,this.updateVerts(t,_,p,y,b),e.vertexCount!==y*b*4&&(t.renderEntity.colorDirty=!0),e.resize(y*b*4,y*b*6);{const i=e.indexCount;this.createQuadIndices(i),e.chunk.setIndexBuffer(XN),this.updateWorldUVData(t)}e.updateRenderData(t,i)}createQuadIndices(t){if(t%6!=0)return void G(16308);const e=t/6;XN=new Uint16Array(t);let i=0;for(let t=0;t<e;t++)XN[i++]=0+4*t,XN[i++]=1+4*t,XN[i++]=2+4*t,XN[i++]=1+4*t,XN[i++]=3+4*t,XN[i++]=2+4*t}updateUVs(t){const e=t.renderData;e&&(e.vertDirty=!0,t._markForUpdateRenderData())}fillBuffers(t,e){const i=t.node,s=t.renderData;if(!s)return;const r=s.chunk;if(null===r)return;(t._flagChangedVersion!==i.flagChangedVersion||s.vertDirty)&&(this.updateWorldVertexAndUVData(t,r),s.vertDirty=!1,t._flagChangedVersion=i.flagChangedVersion),this.updateColorLate(t),r.bufferId;let n=r.vertexOffset;const o=r.meshBuffer,a=r.meshBuffer.iData;let h=o.indexOffset;for(let t=0;t<s.indexCount;t+=6)a[h++]=n,a[h++]=n+1,a[h++]=n+2,a[h++]=n+1,a[h++]=n+3,a[h++]=n+2,n+=4,o.indexOffset+=6;o.setDirty()}updateWorldUVData(t){const e=t.renderData;if(!e)return;const i=e.floatStride,s=e.data,r=e.chunk.vb;for(let t=0;t<s.length;t++){const e=t*i;r[e+3]=s[t].u,r[e+4]=s[t].v}}updateWorldVertexAndUVData(t,e){const i=t.renderData;if(!i)return;t.node.getWorldMatrix(NN);const s=i.floatStride,r=i.data,n=e.vb,o=r.length;for(let t=0;t<o;t++){const e=r[t].x,i=r[t].y,o=r[t].z;let a=NN.m03*e+NN.m07*i+NN.m11*o+NN.m15;a=a?1/a:1;const h=t*s;n[h]=(NN.m00*e+NN.m04*i+NN.m08*o+NN.m12)*a,n[h+1]=(NN.m01*e+NN.m05*i+NN.m09*o+NN.m13)*a,n[h+2]=(NN.m02*e+NN.m06*i+NN.m10*o+NN.m14)*a}this.updateWorldUVData(t)}updateVerts(t,e,i,s,r){const n=t.node._getUITransformComp(),o=t.renderData;if(!o)return;const a=o.data,h=t.spriteFrame,l=h.rect,c=Math.abs(n.width),u=Math.abs(n.height),d=n.anchorX*c,_=n.anchorY*u,p=h.insetLeft,m=h.insetRight,g=l.width-p-m,f=h.insetTop,y=h.insetBottom,b=l.height-f-y,v=n.width/(p+m)>1?1:n.width/(p+m),S=n.height/(f+y)>1?1:n.height/(f+y);let T=0,w=0;T=g>0?Math.floor(1e3*e)/1e3%g==0?g:e%g:e,w=b>0?Math.floor(1e3*i)/1e3%b==0?b:i%b:i,WN.length=0,GN=Math.max(s+1,r+1);for(let t=0;t<GN;t++)WN.push({x:0,y:0,z:0,u:0,v:0,color:new Ls});const x=YN(h);if(0===x)for(let t=0;t<GN;t++)WN[t].x=t>=r?c-d:t*g-d,WN[t].y=t>=s?u-_:t*b-_;else for(let t=0;t<GN;t++)0===t?WN[t].x=-d:1===t?WN[t].x=p*v-d:t>1&&t<r-1?WN[t].x=g>0?p*v-d+g*(t-1):p+e-d:t===r-1?WN[t].x=p*v-d+T+g*(t-2):t>=r&&(WN[t].x=Math.min(p+e+m,c)-d),0===t?WN[t].y=-_:1===t?WN[t].y=y*S-_:t>1&&t<s-1?WN[t].y=b>0?y*S-_+b*(t-1):y+i-_:t===s-1?WN[t].y=y*S-_+w+b*(t-2):t>=s&&(WN[t].y=Math.min(y+i+f,u)-_);let C=0,A=0,D=0,E=0;for(let t=0;t<s;++t){D=WN[t].y,E=WN[t+1].y;for(let e=0;e<r;++e){C=WN[e].x,A=WN[e+1].x;const i=4*(t*r+e);a[i].x=C,a[i].y=D,a[i+1].x=A,a[i+1].y=D,a[i+2].x=C,a[i+2].y=E,a[i+3].x=A,a[i+3].y=E}}const I=h.rotated;h.uv;const M=h.uvSliced;LN=M[0],kN=M[1],zN=M[2],UN=M[3],VN=M[4],jN=M[8],HN=M[12];let P=0,O=0;const R=0===g?e:e/g,B=0===b?i:i/b,F=[],N=[];for(let t=0;t<s;++t){O=i>b?i>=(x>0?t:t+1)*b?1:B%1:B;for(let i=0;i<r;++i){P=e>g?e>=(x>0?i:i+1)*g?1:R%1:R,I?(0===x?(F[0]=VN.u,F[1]=VN.u,F[2]=VN.u+(jN.u-VN.u)*O,N[0]=kN.v,N[1]=kN.v+(zN.v-kN.v)*P,N[2]=kN.v):(0===t?(F[0]=LN.u,F[1]=LN.u,F[2]=VN.u):t<s-1?(F[0]=VN.u,F[1]=VN.u,F[2]=VN.u+(jN.u-VN.u)*O):t===s-1&&(F[0]=jN.u,F[1]=jN.u,F[2]=HN.u),0===i?(N[0]=LN.v,N[1]=kN.v,N[2]=LN.v):i<r-1?(N[0]=kN.v,N[1]=kN.v+(zN.v-kN.v)*P,N[2]=kN.v):i===r-1&&(N[0]=zN.v,N[1]=UN.v,N[2]=zN.v)),F[3]=F[2],N[3]=N[1]):(0===x?(F[0]=kN.u,F[1]=kN.u+(zN.u-kN.u)*P,F[2]=kN.u,N[0]=VN.v,N[1]=VN.v,N[2]=VN.v+(jN.v-VN.v)*O):(0===i?(F[0]=LN.u,F[1]=kN.u,F[2]=LN.u):i<r-1?(F[0]=kN.u,F[1]=kN.u+(zN.u-kN.u)*P,F[2]=kN.u):i===r-1&&(F[0]=zN.u,F[1]=UN.u,F[2]=zN.u),0===t?(N[0]=LN.v,N[1]=LN.v,N[2]=VN.v):t<s-1?(N[0]=VN.v,N[1]=VN.v,N[2]=VN.v+(jN.v-VN.v)*O):t===s-1&&(N[0]=jN.v,N[1]=jN.v,N[2]=HN.v)),F[3]=F[1],N[3]=N[2]);const n=4*(t*r+i);a[n].u=F[0],a[n].v=N[0],a[n+1].u=F[1],a[n+1].v=N[1],a[n+2].u=F[2],a[n+2].v=N[2],a[n+3].u=F[3],a[n+3].v=N[3]}}}updateColorLate(t){const e=t.renderData;if(!e)return;const i=e.chunk.vb,s=e.floatStride,r=e.vertexCount;let n=5;const o=t.color,a=o.r/255,h=o.g/255,l=o.b/255,c=t.node._uiProps.opacity;for(let t=0;t<r;t++)i[n]=a,i[n+1]=h,i[n+2]=l,i[n+3]=c,n+=s}updateColor(t){}};CP.Type,CP.FillType;const $N=t("spriteAssembler",{getAssembler(t){let e=RN;const i=t;switch(i.type){case 1:e=FN;break;case 2:e=qN;break;case 3:e=2===i.fillType?PN:_N}return e}});CP.Assembler=$N;class KN{constructor(){this._maskStack=[],this._stencilPattern={stencilTest:!0,func:7,stencilMask:65535,writeMask:65535,failOp:1,zFailOp:1,passOp:1,ref:1},this._stage=0,this.stencilStateMap=new Map,this.stencilStateMapWithDepth=new Map}get stage(){return this._stage}set stage(t){this._stage=t}get pattern(){return this._stencilPattern}pushMask(t){this._maskStack.push(t)}clear(t){return 2!==t.stencilStage?5:1}enableMask(){this.stage=3}exitMask(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=0:this.stage=3)}getWriteMask(){return 1<<this._maskStack.length-1}getExitWriteMask(){return 1<<this._maskStack.length}getStencilRef(){let t=0;for(let e=0;e<this._maskStack.length;++e)t+=1<<e;return t}getMaskStackSize(){return this._maskStack.length}reset(){this._maskStack.length=0,this.stage=0}destroy(){this.stencilStateMap.forEach((t=>{t.destroy()})),this.stencilStateMap.clear()}getStencilStage(t,e){let i=0,s=!1,r=!1,n=1,o=this.stencilStateMap;if(e&&e.passes[0]){const a=e.passes[0].depthStencilState;let h=0,l=0;a.depthTest&&(h=1),a.depthWrite&&(l=1),i=h|l<<1|a.depthFunc<<2|t<<6|this._maskStack.length<<9,s=a.depthTest,r=a.depthWrite,n=a.depthFunc,o=this.stencilStateMapWithDepth}else i=t<<16|this._maskStack.length;if(o&&o.has(i))return o.get(i);this.setStateFromStage(t);const a=this._stencilPattern,h=new _p(s,r,n,a.stencilTest,a.func,a.stencilMask,a.writeMask,a.failOp,a.zFailOp,a.passOp,a.ref,a.stencilTest,a.func,a.stencilMask,a.writeMask,a.failOp,a.zFailOp,a.passOp,a.ref);return o.set(i,h),h}getStencilHash(t){return t<<8|this._maskStack.length}setStateFromStage(t){const e=this._stencilPattern;0===t?(e.stencilTest=!1,e.func=7,e.failOp=1,e.stencilMask=e.writeMask=65535,e.ref=1):(e.stencilTest=!0,3===t?(e.func=2,e.failOp=1,e.stencilMask=e.ref=this.getStencilRef(),e.writeMask=this.getWriteMask()):1===t?(e.func=0,e.failOp=0,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):5===t||2===t?(e.func=0,e.failOp=2,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):6===t&&(e.func=0,e.failOp=0,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()))}}t("StencilManager",KN),KN.sharedManager=null,KN.sharedManager=new KN;const ZN=["mouse-down","mouse-move","mouse-up","mouse-wheel","mouse-leave-window","mouse-enter-window"],QN=["touch-start","touch-move","touch-end","touch-cancel"],JN=t=>!!(128&t._objFlags||1&t._objFlags);new class{constructor(){this.priority=1,this._isListDirty=!1,this._inDispatchCount=0,this._pointerEventProcessorList=[],this._processorListToAdd=[],this._processorListToRemove=[],Dy._registerEventDispatcher(this);const t=Qy.callbacksInvoker;t.on(0,this.addPointerEventProcessor,this),t.on(1,this.removePointerEventProcessor,this),t.on(2,this._markListDirty,this)}onThrowException(){this._inDispatchCount=0}dispatchEvent(t){const e=t.type;return QN.includes(e)?this.dispatchEventTouch(t):!ZN.includes(e)||this.dispatchEventMouse(t)}addPointerEventProcessor(t){0===this._inDispatchCount?this._pointerEventProcessorList.includes(t)||(this._pointerEventProcessorList.push(t),this._isListDirty=!0):this._processorListToAdd.includes(t)||this._processorListToAdd.push(t),se(this._processorListToRemove,t)}removePointerEventProcessor(t){0===this._inDispatchCount?(se(this._pointerEventProcessorList,t),this._isListDirty=!0):this._processorListToRemove.includes(t)||this._processorListToRemove.push(t),se(this._processorListToAdd,t)}dispatchEventMouse(t){this._inDispatchCount++,this._sortPointerEventProcessorList();const e=this._pointerEventProcessorList,i=e.length;let s=!0;for(let r=0;r<i;++r){const i=e[r];if(i.isEnabled&&i.shouldHandleEventMouse&&i._handleEventMouse(t)){if(s=!1,!t.preventSwallow)break;t.preventSwallow=!1}}return--this._inDispatchCount<=0&&this._updatePointerEventProcessorList(),s}dispatchEventTouch(t){this._inDispatchCount++,this._sortPointerEventProcessorList();const e=this._pointerEventProcessorList,i=e.length,s=t.touch;let r=!0;for(let n=0;n<i;++n){const i=e[n];if(i.isEnabled&&i.shouldHandleEventTouch)if("touch-start"===t.type){if(i._handleEventTouch(t)){if(i.isEnabled)i.claimedTouchIdList.push(s.getID());else{const e=new If([t.touch],!0,"touch-cancel");e.touch=t.touch,i.dispatchEvent(e),i.claimedTouchIdList.length=0}if(r=!1,!t.preventSwallow)break;t.preventSwallow=!1}}else if(i.claimedTouchIdList.length>0){const e=i.claimedTouchIdList.indexOf(s.getID());if(-1!==e){if(i._handleEventTouch(t),"touch-end"!==t.type&&"touch-cancel"!==t.type||(ee(i.claimedTouchIdList,e),t.preventSwallow||this._removeClaimedTouch(n+1,s.getID())),r=!1,!t.preventSwallow)break;t.preventSwallow=!1}}}return--this._inDispatchCount<=0&&this._updatePointerEventProcessorList(),r}_removeClaimedTouch(t,e){const i=this._pointerEventProcessorList,s=i.length;for(let r=t;r<s;++r){const t=i[r],s=t.claimedTouchIdList.indexOf(e);-1!==s&&ee(t.claimedTouchIdList,s)}}_updatePointerEventProcessorList(){const t=this._processorListToAdd,e=t.length;for(let i=0;i<e;++i)this.addPointerEventProcessor(t[i]);t.length=0;const i=this._processorListToRemove,s=i.length;for(let t=0;t<s;++t)this.removePointerEventProcessor(i[t]);i.length=0}_sortPointerEventProcessorList(){if(!this._isListDirty)return;const t=this._pointerEventProcessorList,e=t.length;for(let i=0;i<e;++i){const e=t[i],s=e.node;if(s._uiProps){const t=s._getUITransformComp();e.cachedCameraPriority=t.cameraPriority}}t.sort(this._sortByPriority),this._isListDirty=!1}_sortByPriority(t,e){const i=t.node,s=e.node;if(!(e&&s&&!JN(s)&&s.activeInHierarchy&&s._getUITransformComp()))return-1;if(!t||!i||JN(i)||!i.activeInHierarchy||!i._getUITransformComp())return 1;if(t.cachedCameraPriority!==e.cachedCameraPriority)return e.cachedCameraPriority-t.cachedCameraPriority;let r=i,n=s,o=!1;for(;(null==(a=r.parent)?void 0:a.uuid)!==(null==(h=n.parent)?void 0:h.uuid);){var a,h,l,c,u,d;r=null===(null==(l=r)||null==(c=l.parent)?void 0:c.parent)?(o=!0)&&s:r&&r.parent,n=null===(null==(u=n)||null==(d=u.parent)?void 0:d.parent)?(o=!0)&&i:n&&n.parent}if(r.uuid===n.uuid){if(r.uuid===s.uuid)return-1;if(r.uuid===i.uuid)return 1}const _=r?r.siblingIndex:0,p=n?n.siblingIndex:0;return o?_-p:p-_}_markListDirty(){this._isListDirty=!0}};const tL=new z_(null),eL=new vr;new So((()=>({uiRenderer:null,finalOpacity:0,opacityDirty:!1})),128);class iL{get nativeObj(){return this._nativeObj}get currBufferAccessor(){return this._staticVBBuffer||(this._staticVBBuffer=this.switchBufferAccessor()),this._staticVBBuffer}get batches(){return this._batches}set currStaticRoot(t){this._currStaticRoot=t}set currIsStatic(t){}constructor(t){this._screens=[],this._staticVBBuffer=null,this._bufferAccessors=new Map,this._currBID=-1,this._indexStart=0,this._emptyMaterial=new fv,this._currRenderData=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currHash=0,this._currIsMiddleware=!1,this._middlewareEnableBatch=!1,this._middlewareBuffer=null,this._middlewareIndexStart=0,this._middlewareIndexCount=0,this._pOpacity=1,this._opacityDirty=0,this._descriptorSetCache=new rL,this._meshDataArray=[],this._maskClearModel=null,this._maskClearMtl=null,this._maskModelMesh=null,this._recordedRendererInfoQueue=[],this._root=t,this.device=t.device,this._batches=new To(64),this._drawBatchPool=new vo((()=>new RP),128,(t=>t.destroy(this)))}getRecordedRendererInfoQueue(){return this._recordedRendererInfoQueue}initialize(){return!0}destroy(){this._recordedRendererInfoQueue.length=0;for(let t=0;t<this._batches.length;t++)this._batches.array[t]&&this._batches.array[t].destroy(this);this._batches.destroy();for(const t of this._bufferAccessors.values())t.destroy();this._bufferAccessors.clear(),this._drawBatchPool&&this._drawBatchPool.destroy(),this._descriptorSetCache.destroy(),KN.sharedManager.destroy(),this._maskClearModel&&this._maskModelMesh&&(a.director.root.destroyModel(this._maskClearModel),this._maskModelMesh.destroy()),this._maskClearMtl&&this._maskClearMtl.destroy()}syncRootNodesToNative(){{const t=[];for(const e of this._screens)t.push(e.node);this._nativeObj.syncRootNodesToNative(t)}}addScreen(t){this._screens.push(t),this._screens.sort(this._screenSort),this.syncRootNodesToNative()}removeScreen(t){const e=this._screens.indexOf(t);-1!==e&&(this._screens.splice(e,1),this.syncRootNodesToNative())}sortScreens(){this._screens.sort(this._screenSort),this.syncRootNodesToNative()}getFirstRenderCamera(t){if(t.scene&&t.scene.renderScene){const e=t.scene.renderScene.cameras;for(let i=0;i<e.length;i++){const s=e[i];if(s.visibility&t.layer)return s}}return null}update(){}uploadBuffers(){this._nativeObj.uploadBuffers()}reset(){this._nativeObj.reset()}switchBufferAccessor(t=QE){const e=t===QE?36:sI(t);if(!this._staticVBBuffer||this._staticVBBuffer.vertexFormatBytes!==e){let i=this._bufferAccessors.get(e);i||(i=new dI(this.device,t),this._bufferAccessors.set(e,i)),this._staticVBBuffer=i,this._currBID=-1}return this._staticVBBuffer}registerBufferAccessor(t,e){this._bufferAccessors.set(t,e)}updateBuffer(t,e){const i=this.switchBufferAccessor(t);this._currBID!==e&&(this._currBID=e,this._indexStart=i.getMeshBuffer(e).indexOffset)}commitComp(t,e,i,s,r){let n,o=0,a=-1;if(e&&e.chunk){if(!e.isValid())return;o=e.dataHash,n=e.material,a=e.chunk.bufferId}2===t.stencilStage||6===t.stencilStage?this._insertMaskBatch(t):t.stencilStage=KN.sharedManager.stage;const h=t.stencilStage;this._currHash===o&&0!==o&&this._currMaterial===n&&this._currDepthStencilStateStage===h||(this.autoMergeBatches(this._currComponent),e&&!e._isMeshBuffer&&this.updateBuffer(e.vertexFormat,a),this._currRenderData=e,this._currHash=e?e.dataHash:0,this._currComponent=t,this._currTransform=r,this._currMaterial=t.getRenderMaterial(0),this._currDepthStencilStateStage=h,this._currLayer=t.node.layer,i?(this._currTexture=i.getGFXTexture(),this._currSampler=i.getGFXSampler(),this._currTextureHash=i.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0)),s.fillBuffers&&s.fillBuffers(t,this)}commitIA(t,e,i,s,r){this._currMaterial!==this._emptyMaterial&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates());let n=null,o=0;t&&(t.stencilStage=KN.sharedManager.stage,n=null!==t.customMaterial?KN.sharedManager.getStencilStage(t.stencilStage,s):KN.sharedManager.getStencilStage(t.stencilStage),o=KN.sharedManager.getStencilHash(t.stencilStage));const a=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();a.visFlags=t.node.layer,a.inputAssembler=e,a.useLocalData=r||null,i&&(a.texture=i.getGFXTexture(),a.sampler=i.getGFXSampler(),a.textureHash=i.getHash(),a.samplerHash=a.sampler.hash),a.fillPasses(s||null,n,o,null),this._batches.push(a)}commitMiddleware(t,e,i,s,r,n,o){const a=r.getGFXTexture();o&&this._middlewareEnableBatch&&this._middlewareBuffer===e&&this._currTexture===a&&this._currMaterial.hash===n.hash&&this._middlewareIndexStart+this._middlewareIndexCount===i&&this._currLayer===t.node.layer?this._middlewareIndexCount+=s:(this.autoMergeBatches(this._currComponent),this.resetRenderStates(),this._currComponent=t,this._currTexture=a,this._currSampler=r.getGFXSampler(),this._currTextureHash=r.getHash(),this._currLayer=t.node.layer,this._currSamplerHash=this._currSampler.hash,this._currHash=0,this._currTransform=o?null:t.node,this._middlewareEnableBatch=o,this._middlewareBuffer=e,this._currMaterial=n,this._middlewareIndexStart=i,this._middlewareIndexCount=s),this._currIsMiddleware=!0}commitModel(t,e,i){this._currMaterial!==this._emptyMaterial&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates());let s=null,r=0;i&&(2===t.stencilStage||6===t.stencilStage?this._insertMaskBatch(t):t.stencilStage=KN.sharedManager.stage,s=KN.sharedManager.getStencilStage(t.stencilStage,i),r=KN.sharedManager.getStencilHash(t.stencilStage));const n=a.director.getTotalFrames();e&&(e.updateTransform(n),e.updateUBOs(n));for(let n=0;n<e.subModels.length;n++){const o=this._drawBatchPool.alloc(),a=e.subModels[n];o.visFlags=t.node.layer,o.model=e,o.texture=null,o.sampler=null,o.useLocalData=null,s||(s=null),o.fillPasses(i,s,r,a.patches),o.inputAssembler=a.inputAssembler,o.model.visFlags=o.visFlags,o.descriptorSet=a.descriptorSet,this._batches.push(o)}}setupStaticBatch(t,e){this.finishMergeBatches(),this._staticVBBuffer=e,this.currStaticRoot=t}endStaticBatch(){this.finishMergeBatches(),this.currStaticRoot=null,this._staticVBBuffer=null,this.switchBufferAccessor()}commitStaticBatch(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()}autoMergeBatches(t){if(this._currIsMiddleware)return void this.mergeBatchesForMiddleware(t);const e=this._currMaterial;if(!e)return;let i;const s=this._currRenderData,r=this._staticVBBuffer;if(s&&s._isMeshBuffer)i=s.requestIA(this.device),-1===this._meshDataArray.indexOf(s)&&this._meshDataArray.push(s);else if(r){const t=this._currBID,e=r.getMeshBuffer(t);if(!e)return;const s=e.indexOffset-this._indexStart;if(s<=0)return;this._indexStart,e.indexOffset,e.setDirty(),i=e.requireFreeIA(this.device),i.firstIndex=this._indexStart,i.indexCount=s,this._indexStart=e.indexOffset}if(this._currBID=-1,!i||!this._currTexture)return;let n=null,o=0;t&&(n=null!==t.customMaterial?KN.sharedManager.getStencilStage(t.stencilStage,e):KN.sharedManager.getStencilStage(t.stencilStage),o=KN.sharedManager.getStencilHash(t.stencilStage));const a=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();a.visFlags=this._currLayer,a.texture=this._currTexture,a.sampler=this._currSampler,a.inputAssembler=i,a.useLocalData=this._currTransform,a.textureHash=this._currTextureHash,a.samplerHash=this._currSamplerHash,a.fillPasses(e,n,o,null),this._batches.push(a)}mergeBatchesForMiddleware(t){let e=null,i=0;t.stencilStage=KN.sharedManager.stage,e=null!==t.customMaterial?KN.sharedManager.getStencilStage(t.stencilStage,this._currMaterial):KN.sharedManager.getStencilStage(t.stencilStage),i=KN.sharedManager.getStencilHash(t.stencilStage);const s=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();s.visFlags=t.node.layer;const r=this._middlewareBuffer.requireFreeIA(this.device);r.firstIndex=this._middlewareIndexStart,r.indexCount=this._middlewareIndexCount,s.inputAssembler=r,s.useLocalData=this._currTransform,s.texture=this._currTexture,s.sampler=this._currSampler,s.textureHash=this._currTextureHash,s.samplerHash=this._currSamplerHash,s.fillPasses(this._currMaterial||null,e,i,null),this._batches.push(s),this._currIsMiddleware=!1,this._middlewareBuffer=null}forceMergeBatches(t,e,i){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=i.node.layer,this.autoMergeBatches(i)}resetRenderStates(){this._currMaterial=this._emptyMaterial,this._currRenderData=null,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0}finishMergeBatches(){this.autoMergeBatches(),this.resetRenderStates()}flushMaterial(t){this._currMaterial=t}_handleUIRenderer(t,e,i){const s=t?t.renderData:null,r=s?s.vertexCount:0;if(t&&t.enabledInHierarchy&&t.fillBuffers(this),i&&r>0){0===t.getFillColorType()&&Up(s,e);const i=s.getMeshBuffer();i&&i.setDirty()}}_recordUIRenderer(t,e,i){return null}_flushRecordedUIRenderers(){}walk(t,e=0){if(!t.activeInHierarchy)return;const i=t.children,s=t._uiProps,r=s.uiComp,n=this._pOpacity;let o=n;const a=r&&r.color?r.color.a/255:1;this._pOpacity=o*=a*s.localOpacity,s.setOpacity(o);const h=!Oi(o,0,Mi);if(h){if(s.colorDirty&&this._opacityDirty++,r&&this._handleUIRenderer(r,o,!!this._opacityDirty),i.length>0&&!t._static)for(let t=0;t<i.length;++t){const s=i[t];this.walk(s,e)}s.colorDirty&&(this._opacityDirty--,s.colorDirty=!1)}this._pOpacity=n,r&&r.enabledInHierarchy&&(r.postUpdateAssembler(this),!h||2!==r.stencilStage&&6!==r.stencilStage||KN.sharedManager.getMaskStackSize()>0&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates(),KN.sharedManager.exitMask())),e+=1}_screenSort(t,e){return t.node.siblingIndex-e.node.siblingIndex}_releaseDescriptorSetCache(t,e=null){this._nativeObj.releaseDescriptorSetCache(t,e)}_createClearModel(){if(!this._maskClearModel){this._maskClearMtl=iC.get("default-clear-stencil"),this._maskClearModel=a.director.root.createModel(mb);const t=sI(KE),e=yp.gfxDevice,i=e.createBuffer(new a_(10,1,4*t,t)),s=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);i.update(s);const r=e.createBuffer(new a_(6,1,12,2)),n=new Uint16Array([0,1,2,2,1,3]);r.update(n),this._maskModelMesh=new wD([i],KE,7,r),this._maskModelMesh.subMeshIdx=0,this._maskClearModel.initSubModel(0,this._maskModelMesh,this._maskClearMtl)}}_insertMaskBatch(t){this.autoMergeBatches(this._currComponent),this.resetRenderStates(),this._createClearModel(),this._maskClearModel.node=this._maskClearModel.transform=t.node;const e=KN.sharedManager;e.pushMask(1);const i=e.clear(t);let s=null,r=0;const n=this._maskClearMtl;n&&(s=e.getStencilStage(i,n),r=e.getStencilHash(i));const o=this._maskClearModel,h=a.director.getTotalFrames();o&&(o.updateTransform(h),o.updateUBOs(h));for(let e=0;e<o.subModels.length;e++){const i=this._drawBatchPool.alloc(),a=o.subModels[e];i.visFlags=t.node.layer,i.model=o,i.texture=null,i.sampler=null,i.useLocalData=null,s||(s=null),i.fillPasses(n,s,r,a.patches),i.inputAssembler=a.inputAssembler,i.model.visFlags=i.visFlags,i.descriptorSet=a.descriptorSet,this._batches.push(i)}e.enableMask()}syncMeshBuffersToNative(t,e){{const i=e.map((t=>t.nativeObj));this._nativeObj.syncMeshBuffersToNative(t,i)}}}t("UI",iL);class sL{getDescriptorSet(){return this._descriptorSet}constructor(){this._descriptorSet=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;const t=yp.gfxDevice;this._localData=new Float32Array(56),this._localBuffer=t.createBuffer(new a_(18,3,224,224))}initialize(t){const e=yp.gfxDevice;this._transform=t.useLocalData,this._textureHash=t.textureHash,this._samplerHash=t.samplerHash,tL.layout=t.passes[0].localSetLayout,this._descriptorSet=e.createDescriptorSet(tL),this._descriptorSet.bindBuffer(0,this._localBuffer),this._descriptorSet.bindTexture(12,t.texture),this._descriptorSet.bindSampler(12,t.sampler),this._descriptorSet.update(),this._transformUpdate=!0}updateTransform(t){t!==this._transform&&(this._transform=t,this._transformUpdate=!0,this.uploadLocalData())}equals(t,e,i){return this._transform===t&&this._textureHash===e&&this._samplerHash===i}reset(){this._transform=null,this._textureHash=0,this._samplerHash=0}destroy(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null),this._localData=null}isValid(){return this._transform&&this._transform.isValid}uploadLocalData(){const t=this._transform;if((t.hasChangedFlags||t.isTransformDirty())&&(t.updateWorldTransform(),this._transformUpdate=!0),this._transformUpdate){const e=t.worldMatrix;vr.toArray(this._localData,e,0),vr.invert(eL,e),vr.transpose(eL,eL),vr.toArray(this._localData,eL,16),this._localBuffer.update(this._localData),this._transformUpdate=!1}}}class rL{constructor(){this._descriptorSetCache=new Map,this._dsCacheHashByTexture=new Map,this._localDescriptorSetCache=[],this._localCachePool=new vo((()=>new sL),16,(t=>t.destroy()))}getDescriptorSet(t){if(t.useLocalData){const e=this._localDescriptorSetCache;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(s.equals(t.useLocalData,t.textureHash,t.samplerHash))return s.getDescriptorSet()}const i=this._localCachePool.alloc();return i.initialize(t),this._localDescriptorSetCache.push(i),i.getDescriptorSet()}{const e=t.textureHash^t.samplerHash;if(this._descriptorSetCache.has(e))return this._descriptorSetCache.get(e);{tL.layout=t.passes[0].localSetLayout;const i=yp.gfxDevice.createDescriptorSet(tL),s=12;return i.bindTexture(s,t.texture),i.bindSampler(s,t.sampler),i.update(),this._descriptorSetCache.set(e,i),this._dsCacheHashByTexture.set(t.textureHash,e),i}}}update(){const t=this._localDescriptorSetCache,e=t.length;if(0===e)return;const i=[];for(let s=0;s<e;s++){const e=t[s];if(e.isValid())e.uploadLocalData();else{e.reset();const s=t.indexOf(e);i.push(s)}}for(let e=i.length-1;e>=0;e--){const s=i[e],r=t[s];t.splice(s,1),this._localCachePool.free(r)}}reset(){const t=this._localDescriptorSetCache,e=t.length;for(let i=0;i<e;i++){const e=t[i];this._localCachePool.free(e)}this._localDescriptorSetCache.length=0}releaseDescriptorSetCache(t){const e=this._dsCacheHashByTexture.get(t);e&&this._descriptorSetCache.has(e)&&(this._descriptorSetCache.get(e).destroy(),this._descriptorSetCache.delete(e),this._dsCacheHashByTexture.delete(t))}destroy(){for(const t of this._descriptorSetCache.values())t.destroy();this._descriptorSetCache.clear(),this._dsCacheHashByTexture.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy()}}var nL,oL,aL,hL,lL,cL;a.internal.Batcher2D=iL,t("UIDrawBatch",class extends RP{}),tt(hI.prototype,"MeshBuffer",["byteStart","vertexStart","indicesStart","request"].map((t=>({name:t,suggest:`please use meshBuffer.accessor.${t} instead`})))),Q(hI.prototype,"MeshBuffer",[{name:"indicesOffset",newName:"indexOffset"}]),J(hI.prototype,"MeshBuffer",[{name:"vertexBuffers"},{name:"indexBuffer"}]),Q(iL.prototype,"Batcher2D",[{name:"currBufferBatch",newName:"currBufferAccessor"},{name:"acquireBufferBatch",newName:"switchBufferAccessor"}]),J(bI.prototype,"MeshRenderData",[{name:"formatByte"},{name:"byteStart"},{name:"byteCount"}]),Q(bI.prototype,"MeshRenderData",[{name:"indicesStart",newName:"indexStart"}]),t("QuadRenderData",class extends bI{constructor(t){super(t),j(9006)}}),a.UI={MeshBuffer:hI,spriteAssembler:$N,labelAssembler:cN,RenderData:yI,MeshRenderData:bI},t("Sorting",(nL=ah("cc.Sorting"),oL=Xh(QI.Enum),nL(aL=ch((s((hL=class extends Km{constructor(){super(),this._sortingLayer=lL&&lL(),this._sortingOrder=cL&&cL(),this._modelRenderer=null}get sortingLayer(){return this._sortingLayer}set sortingLayer(t){t!==this._sortingLayer&&QI.isLayerValid(t)&&(this._sortingLayer=t,this._updateSortingPriority())}get sortingOrder(){return this._sortingOrder}set sortingOrder(t){t!==this._sortingOrder&&(this._sortingOrder=Ri(t,-32768,32767),this._updateSortingPriority())}__preload(){this._modelRenderer=this.getComponent("cc.ModelRenderer"),this._modelRenderer||j(16301,this.node.name),this._updateSortingPriority()}_updateSortingPriority(){const t=QI.getLayerIndex(this._sortingLayer),e=QI.getSortingPriority(t,this._sortingOrder);this._modelRenderer&&this._modelRenderer.isValid&&(this._modelRenderer.priority=e)}}).prototype,"sortingLayer",[oL],Object.getOwnPropertyDescriptor(hL.prototype,"sortingLayer"),hL.prototype),lL=Za(hL.prototype,"_sortingLayer",[vh],(function(){return QI.Enum.default})),cL=Za(hL.prototype,"_sortingOrder",[vh],(function(){return 0})),aL=hL))||aL)||aL));const uL=t("Mesh",jsb.Mesh),dL=jsb.Mesh.IStruct.prototype;Object.defineProperty(dL,"minPosition",{configurable:!0,enumerable:!0,get(){const t=this.getMinPosition();return t?this._minPositionCache?this._minPositionCache.set(t.x,t.y,t.z):this._minPositionCache=new Ms(t.x,t.y,t.z):this._minPositionCache=void 0,this._minPositionCache},set(t){this.setMinPosition(t)}}),Object.defineProperty(dL,"maxPosition",{configurable:!0,enumerable:!0,get(){const t=this.getMaxPosition();return t?this._maxPositionCache?this._maxPositionCache.set(t.x,t.y,t.z):this._maxPositionCache=new Ms(t.x,t.y,t.z):this._maxPositionCache=void 0,this._maxPositionCache},set(t){this.setMaxPosition(t)}});const _L=jsb.Mesh.prototype;_L.createNode=null;const pL=_L.onLoaded;_L._ctor=function(){jsb.Asset.prototype._ctor.apply(this,arguments),this._struct={vertexBundles:[],primitives:[]},this._minPosition=void 0,this._maxPosition=void 0},Object.defineProperty(_L,"struct",{configurable:!0,enumerable:!0,get(){return this.getStruct()}}),Object.defineProperty(_L,"minPosition",{configurable:!0,enumerable:!0,get(){const t=this.getMinPosition();return t?this._minPosition?this._minPosition.set(t.x,t.y,t.z):this._minPosition=new Ms(t.x,t.y,t.z):this._minPosition=void 0,this._minPosition}}),Object.defineProperty(_L,"maxPosition",{configurable:!0,enumerable:!0,get(){const t=this.getMaxPosition();return t?this._maxPosition?this._maxPosition.set(t.x,t.y,t.z):this._maxPosition=new Ms(t.x,t.y,t.z):this._maxPosition=void 0,this._maxPosition}}),_L.onLoaded=function(){const t=this._struct;t&&(0===t.vertexBundles.length&&0===t.primitives.length||this.setStruct(this._struct)),this._struct=null,pL.apply(this)},a.Mesh=jsb.Mesh,function(t,e=dm){const{Mesh:i}={...t};e((()=>{vh(i.prototype,"_struct",(()=>({vertexBundles:[],primitives:[]})))}),"serializable","_struct"),e((()=>{vh(i.prototype,"_hash",(()=>0))}),"serializable","_hash"),e((()=>{vh(i.prototype,"_allowDataAccess",(()=>!0))}),"serializable","_allowDataAccess"),e((()=>{ah("cc.Mesh")(i)}),"ccclass",null)}({Mesh:uL});const mL=jsb.MorphModel;a.MorphModel=jsb.MorphModel;const gL=t("ReflectionProbeType",{NONE:0,BAKED_CUBEMAP:1,PLANAR_REFLECTION:2,BLEND_PROBES:3,BLEND_PROBES_AND_SKYBOX:4});function fL(){return a.director.root.pipeline.pipelineSceneData}var yL,bL,vL,SL,TL,wL,xL,CL,AL,DL,EL,IL,ML,PL,OL,RL,BL,FL,NL,LL,kL,zL,UL,VL,jL,HL,GL,WL,XL,YL,qL,$L,KL,ZL,QL,JL,tk,ek,ik,sk,rk,nk;const{ccclass:ok,help:ak,executeInEditMode:hk,executionOrder:lk,menu:ck,visible:uk,type:dk,formerlySerializedAs:_k,serializable:pk,editable:mk,disallowAnimation:gk}=il;let fk=LA("specular-pass");function yk(t){const e=t.passes,i=a.rendering;NA()&&(fk=i.getPhaseID(i.getPassID("specular-pass"),"default"));for(let t=0;t<e.length;t++)if((!i||!i.enableEffectImport)&&e[t].phase===fk||NA()&&e[t].phaseID===fk)return t;return-1}const bk=pe({OFF:0,ON:1}),vk=pe({OFF:0,ON:1});let Sk=(yL=ok("cc.ModelBakeSettings"),bL=_k("_recieveShadow"),vL=dk(Ge),SL=dk(Xe),TL=dk(Xe),wL=dk(pe(gL)),xL=dk(Xe),yL(((LL=class extends zo{constructor(){super(),this.texture=DL&&DL(),this.uvParam=EL&&EL(),this._bakeable=IL&&IL(),this._castShadow=ML&&ML(),this._receiveShadow=PL&&PL(),this._lightmapSize=OL&&OL(),this._useLightProbe=RL&&RL(),this._bakeToLightProbe=BL&&BL(),this._reflectionProbeType=FL&&FL(),this._bakeToReflectionProbe=NL&&NL(),this.probeCubemap=null,this.probeBlendCubemap=null,this.probePlanarmap=null}get bakeable(){return this._bakeable}set bakeable(t){this._bakeable=t}get castShadow(){return this._castShadow}set castShadow(t){this._castShadow=t}get receiveShadow(){return this._receiveShadow}set receiveShadow(t){this._receiveShadow=t}get lightmapSize(){return this._lightmapSize}set lightmapSize(t){this._lightmapSize=t}get useLightProbe(){return this._useLightProbe}set useLightProbe(t){this._useLightProbe=t,this.emit("use_light_probe_changed")}get bakeToLightProbe(){return this._bakeToLightProbe}set bakeToLightProbe(t){this._bakeToLightProbe=t}get reflectionProbe(){return this._reflectionProbeType}set reflectionProbe(t){this._reflectionProbeType=t,this.emit("reflection_probe_changed")}get bakeToReflectionProbe(){return this._bakeToReflectionProbe}set bakeToReflectionProbe(t){this._bakeToReflectionProbe=t,this.emit("bake_to_reflection_probe_changed")}}).USE_LIGHT_PROBE_CHANGED="use_light_probe_changed",LL.REFLECTION_PROBE_CHANGED="reflection_probe_changed",LL.BAKE_TO_REFLECTION_PROBE_CHANGED="bake_to_reflection_probe_changed",DL=Za((AL=LL).prototype,"texture",[pk],(function(){return null})),EL=Za(AL.prototype,"uvParam",[pk],(function(){return new ms})),IL=Za(AL.prototype,"_bakeable",[pk],(function(){return!1})),ML=Za(AL.prototype,"_castShadow",[pk],(function(){return!1})),PL=Za(AL.prototype,"_receiveShadow",[bL],(function(){return!1})),OL=Za(AL.prototype,"_lightmapSize",[pk],(function(){return 64})),RL=Za(AL.prototype,"_useLightProbe",[pk],(function(){return!1})),BL=Za(AL.prototype,"_bakeToLightProbe",[pk],(function(){return!0})),FL=Za(AL.prototype,"_reflectionProbeType",[pk],(function(){return 0})),NL=Za(AL.prototype,"_bakeToReflectionProbe",[pk],(function(){return!0})),s(AL.prototype,"lightmapSize",[vL],Object.getOwnPropertyDescriptor(AL.prototype,"lightmapSize"),AL.prototype),s(AL.prototype,"useLightProbe",[SL],Object.getOwnPropertyDescriptor(AL.prototype,"useLightProbe"),AL.prototype),s(AL.prototype,"bakeToLightProbe",[TL],Object.getOwnPropertyDescriptor(AL.prototype,"bakeToLightProbe"),AL.prototype),s(AL.prototype,"reflectionProbe",[wL],Object.getOwnPropertyDescriptor(AL.prototype,"reflectionProbe"),AL.prototype),s(AL.prototype,"bakeToReflectionProbe",[xL],Object.getOwnPropertyDescriptor(AL.prototype,"bakeToReflectionProbe"),AL.prototype),CL=AL))||CL),Tk=(kL=ok("cc.MeshRenderer"),zL=lk(100),UL=dk(We),VL=dk(We),jL=dk(bk),HL=dk(vk),GL=dk(uL),WL=dk(Xe),kL(XL=zL((nk=class extends LB{get shadowBias(){return this._shadowBias}set shadowBias(t){this._shadowBias=t,this._updateShadowBias(),this._onUpdateLocalShadowBiasAndProbeId()}get shadowNormalBias(){return this._shadowNormalBias}set shadowNormalBias(t){this._shadowNormalBias=t,this._updateShadowNormalBias(),this._onUpdateLocalShadowBiasAndProbeId()}get shadowCastingMode(){return this._shadowCastingMode}set shadowCastingMode(t){this._shadowCastingMode=t,this._updateCastShadow()}get shadowCastingModeForInspector(){return this.shadowCastingMode===bk.ON}set shadowCastingModeForInspector(t){this.shadowCastingMode=!0===t?bk.ON:bk.OFF}onUpdateReceiveDirLight(t,e=!1){this._model&&(e?this._model.receiveDirLight=!1:this.node&&(t&this.node.layer)===this.node.layer||t&this._model.visFlags?this._model.receiveDirLight=!0:this._model.receiveDirLight=!1)}get receiveShadow(){return this._shadowReceivingMode}set receiveShadow(t){this._shadowReceivingMode=t,this._updateReceiveShadow()}get receiveShadowForInspector(){return this._shadowReceivingMode===vk.ON}set receiveShadowForInspector(t){this._shadowReceivingMode=!0===t?vk.ON:vk.OFF,this._updateReceiveShadow()}get mesh(){return this._mesh}set mesh(t){const e=this._mesh,i=this._mesh=t;null==i||i.initialize(),this._initSubMeshShapesWeights(),this._watchMorphInMesh(),this._onMeshChanged(e),this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateUseLightProbe(),this._updateUseReflectionProbe(),this._updateReceiveDirLight()}get model(){return this._model}get enableMorph(){return this._enableMorph}set enableMorph(t){this._enableMorph=t}get isGlobalStandardSkinObject(){return this._enabledGlobalStandardSkinObject}set isGlobalStandardSkinObject(t){fL().standardSkinMeshRenderer=t?this:null,this._enabledGlobalStandardSkinObject=t}clearGlobalStandardSkinObjectFlag(){this._enabledGlobalStandardSkinObject=!1}constructor(){super(),this.bakeSettings=qL&&qL(),this._mesh=$L&&$L(),this._shadowCastingMode=KL&&KL(),this._shadowReceivingMode=ZL&&ZL(),this._shadowBias=QL&&QL(),this._shadowNormalBias=JL&&JL(),this._reflectionProbeId=tk&&tk(),this._reflectionProbeBlendId=ek&&ek(),this._reflectionProbeBlendWeight=ik&&ik(),this._enabledGlobalStandardSkinObject=sk&&sk(),this._reflectionProbeDataMap=null,this._subMeshShapesWeights=[],this._modelType=mb,this._model=null,this._morphInstance=null,this._enableMorph=rk&&rk(),Se.querySettings("rendering","highQualityMode")&&(this._shadowCastingMode=bk.ON,this.bakeSettings.castShadow=!0,this.bakeSettings.receiveShadow=!0)}onLoad(){this._mesh&&this._mesh.initialize(),this._validateShapeWeights()||this._initSubMeshShapesWeights(),this._watchMorphInMesh(),this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias(),this._updateUseLightProbe(),this._updateBakeToReflectionProbe(),this._updateUseReflectionProbe(),this._updateReceiveDirLight(),this._updateStandardSkin()}onRestore(){this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias(),this._updateUseLightProbe(),this._updateBakeToReflectionProbe(),this._updateUseReflectionProbe(),this._updateReceiveDirLight(),this._updateStandardSkin()}onEnable(){super.onEnable(),this.node.on("mobility-changed",this.onMobilityChanged,this),this.node.on("light-probe-baking-changed",this.onLightProbeBakingChanged,this),this.bakeSettings.on("use_light_probe_changed",this.onUseLightProbeChanged,this),this.bakeSettings.on("reflection_probe_changed",this.onReflectionProbeChanged,this),this.bakeSettings.on("bake_to_reflection_probe_changed",this.onBakeToReflectionProbeChanged,this),this._model||this._updateModels(),this._model.onGlobalPipelineStateChanged(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias(),this._updateBakeToReflectionProbe(),this._updateUseReflectionProbe(),this._onUpdateLocalShadowBiasAndProbeId(),this._updateUseLightProbe(),this._updateReceiveDirLight(),this._onUpdateReflectionProbeDataMap(),this._onUpdateLocalReflectionProbeData(),this._updateStandardSkin(),this._attachToScene()}onDisable(){this._model&&this._detachFromScene(),this.node.off("mobility-changed",this.onMobilityChanged,this),this.node.off("light-probe-baking-changed",this.onLightProbeBakingChanged,this),this.bakeSettings.off("use_light_probe_changed",this.onUseLightProbeChanged,this),this.bakeSettings.off("reflection_probe_changed",this.onReflectionProbeChanged,this),this.bakeSettings.off("bake_to_reflection_probe_changed",this.onBakeToReflectionProbeChanged,this)}onDestroy(){this._model&&(a.director.root.destroyModel(this._model),this._model=null,this._models.length=0),this._morphInstance&&this._morphInstance.destroy()}onGeometryChanged(){if(this._model&&this._mesh){const t=this._mesh.struct;this._model.createBoundingShape(t.minPosition,t.maxPosition),this._model.updateWorldBound(),this._model.onGeometryChanged()}}getWeight(t,e){const{_subMeshShapesWeights:i}=this;i.length;const s=this._subMeshShapesWeights[t];return s.length,s[e]}setWeights(t,e){const{_subMeshShapesWeights:i}=this;e>=i.length||i[e].length===t.length&&(i[e]=t.slice(0),this._uploadSubMeshShapesWeights(e))}setWeight(t,e,i){const{_subMeshShapesWeights:s}=this;if(e>=s.length)return;const r=s[e];i>=r.length||(r[i]=t,this._uploadSubMeshShapesWeights(e))}setInstancedAttribute(t,e){this.model&&this.model._setInstancedAttribute(t,e)}_updateLightmap(t,e,i,s,r){this.bakeSettings.texture=t,this.bakeSettings.uvParam.x=e,this.bakeSettings.uvParam.y=i,this.bakeSettings.uvParam.z=s,this.bakeSettings.uvParam.w=r,this._onUpdateLightingmap(),this._updateReceiveDirLight()}updateProbeCubemap(t){this.bakeSettings.probeCubemap&&this.bakeSettings.probeCubemap===t||(this.bakeSettings.probeCubemap=t,null!==this.model&&this.model.updateReflectionProbeCubemap(this.bakeSettings.probeCubemap))}updateProbeBlendCubemap(t){this.bakeSettings.probeBlendCubemap&&this.bakeSettings.probeBlendCubemap===t||(this.bakeSettings.probeBlendCubemap=t,null!==this.model&&this.model.updateReflectionProbeBlendCubemap(this.bakeSettings.probeBlendCubemap))}updateProbePlanarMap(t){this.bakeSettings.probePlanarmap!==t&&(this.bakeSettings.probePlanarmap=t,null!==this.model&&this.model.updateReflectionProbePlanarMap(this.bakeSettings.probePlanarmap))}updateReflectionProbeDataMap(t){this._reflectionProbeDataMap=t,null!==this.model&&this.model.updateReflectionProbeDataMap(t)}updateReflectionProbeId(t){this._reflectionProbeId=t,this.model&&(this.model.reflectionProbeId=t),this._onUpdateLocalShadowBiasAndProbeId()}updateReflectionProbeBlendId(t){this._reflectionProbeBlendId=t,this.model&&(this.model.reflectionProbeBlendId=t),this._onUpdateLocalShadowBiasAndProbeId()}updateReflectionProbeBlendWeight(t){this._reflectionProbeBlendWeight=t,this.model&&(this.model.reflectionProbeBlendWeight=t),this._onUpdateLocalReflectionProbeData()}_updateReflectionProbeTexture(){if(!this.model)return;const t=this.bakeSettings,e=t.reflectionProbe,i=t.probeBlendCubemap,s=t.probePlanarmap,r=t.probeCubemap;1===e?(this.model.updateReflectionProbeCubemap(r),this.model.updateReflectionProbePlanarMap(null),this.model.updateReflectionProbeBlendCubemap(null)):3===e||4===e?(this.model.updateReflectionProbeCubemap(r),this.model.updateReflectionProbeBlendCubemap(i),this.model.updateReflectionProbePlanarMap(null)):2===e?(this.model.updateReflectionProbePlanarMap(s),this.model.updateReflectionProbeCubemap(null),this.model.updateReflectionProbeBlendCubemap(null)):(this.model.updateReflectionProbeCubemap(null),this.model.updateReflectionProbePlanarMap(null),this.model.updateReflectionProbeBlendCubemap(null))}_updateModels(){if(!this.enabledInHierarchy)return;const t=this._model;if(t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this._model){if(this._mesh){const t=this._mesh.struct;this._model.createBoundingShape(t.minPosition,t.maxPosition),this._model.updateWorldBound()}this._model.initLightingmap(this.bakeSettings.texture,this.bakeSettings.uvParam),this._updateUseLightProbe(),this._updateUseReflectionProbeType(),this._updateModelParams(),this._onUpdateLightingmap(),this._onUpdateLocalShadowBiasAndProbeId(),this._updateUseReflectionProbe(),this._updateReceiveDirLight(),this._onUpdateReflectionProbeDataMap(),this._onUpdateLocalReflectionProbeData()}}_updateReceiveDirLight(){if(!this._model)return;const t=this.node.scene;if(!t||!t.renderScene)return;const e=t.renderScene.mainLight;if(!e)return;const i=e.visibility;if(e.node)if(e.node.mobility===Vy.Static){const t=this.node.scene.globals,e=t.lightProbeInfo.data;let s=!1;this.bakeSettings.texture&&!t.disableLightmap&&(s=!0),e&&e.hasCoefficients()&&this._model.useLightProbe&&(s=!0),this.onUpdateReceiveDirLight(i,s)}else this.onUpdateReceiveDirLight(i)}_createModel(){const t=this._morphInstance&&this._modelType===mb?mL:this._modelType,e=this._model=a.director.root.createModel(t);e.visFlags=this.visibility,e.node=e.transform=this.node,this._models.length=0,this._models.push(e),this._morphInstance&&e instanceof mL&&e.setMorphRendering(this._morphInstance)}_attachToScene(){if(!this.node.scene||!this._model)return;const t=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),t.addModel(this._model)}_detachFromScene(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)}_updateModelParams(){if(!this._mesh||!this._model)return;this.node.hasChangedFlags|=1,this._model.transform.hasChangedFlags|=1,this._model.isDynamicBatching=this._isBatchingEnabled();const t=this._mesh?this._mesh.renderingSubMeshes.length:0,e=this._mesh.renderingSubMeshes;if(e)for(let i=0;i<t;++i){let t=this.getRenderMaterial(i);t&&!t.isValid&&(t=null);const s=e[i];s&&this._model.initSubModel(i,s,t||this._getBuiltinMaterial())}this._model.enabled=!0}_onUpdateLightingmap(){null!==this.model&&this.model.updateLightingmap(this.bakeSettings.texture,this.bakeSettings.uvParam),this.setInstancedAttribute("a_lightingMapUVParam",[this.bakeSettings.uvParam.x,this.bakeSettings.uvParam.y,this.bakeSettings.uvParam.z,this.bakeSettings.uvParam.w])}_onUpdateLocalShadowBiasAndProbeId(){null!==this.model&&(this.model.updateLocalShadowBias(),this.model.updateReflectionProbeId()),this.setInstancedAttribute("a_localShadowBiasAndProbeId",[this._shadowBias,this._shadowNormalBias,this._reflectionProbeId,this._reflectionProbeBlendId])}_onUpdateLocalReflectionProbeData(){1!==this.bakeSettings.reflectionProbe&&3!==this.bakeSettings.reflectionProbe&&4!==this.bakeSettings.reflectionProbe||(null!==this.model&&this.model.updateReflectionProbeId(),this.setInstancedAttribute("a_reflectionProbeData",[this._reflectionProbeBlendWeight,0,0,0]))}_onUpdateReflectionProbeDataMap(){null!==this.model&&this.model.updateReflectionProbeDataMap(this._reflectionProbeDataMap)}_onMaterialModified(t,e){this._model&&this._model.inited&&(this._onRebuildPSO(t,e||this._getBuiltinMaterial()),this._updateStandardSkin())}_onRebuildPSO(t,e){this._model&&this._model.inited&&(this._model.isDynamicBatching=this._isBatchingEnabled(),this._model.setSubModelMaterial(t,e),this._onUpdateLightingmap(),this._onUpdateLocalShadowBiasAndProbeId(),this._updateReflectionProbeTexture(),this._onUpdateReflectionProbeDataMap(),this._onUpdateLocalReflectionProbeData())}_onMeshChanged(t){}_clearMaterials(){if(!this._model)return;const t=this._model.subModels;for(let e=0;e<t.length;++e)this._onMaterialModified(e,null)}_getBuiltinMaterial(){return iC.get("missing-material")}_onVisibilityChange(t){this._model&&(this._model.visFlags=t)}_updateShadowBias(){this._model&&(this._model.shadowBias=this._shadowBias)}_updateShadowNormalBias(){this._model&&(this._model.shadowNormalBias=this._shadowNormalBias)}_updateCastShadow(){this._model&&(this._shadowCastingMode===bk.OFF?this._model.castShadow=!1:(this._shadowCastingMode,bk.ON,this._shadowCastingMode,this._model.castShadow=!0))}_updateReceiveShadow(){this._model&&(this._shadowReceivingMode===vk.OFF?this._model.receiveShadow=!1:this._model.receiveShadow=!0)}onMobilityChanged(){this._updateUseLightProbe(),this._updateReceiveDirLight()}onLightProbeBakingChanged(){this._updateReceiveDirLight()}onUseLightProbeChanged(){this._updateUseLightProbe()}onReflectionProbeChanged(){this._updateUseReflectionProbe(),this._onUpdateLocalShadowBiasAndProbeId();const t=a.internal.reflectionProbeManager,e=this._model;1===this.bakeSettings.reflectionProbe||3===this.bakeSettings.reflectionProbe||4===this.bakeSettings.reflectionProbe?(t.selectReflectionProbe(e),t.getUsedReflectionProbe(e,!1)||j(16302)):2===this.bakeSettings.reflectionProbe&&(t.selectPlanarReflectionProbe(e),t.getUsedReflectionProbe(e,!0)||j(16302))}onBakeToReflectionProbeChanged(){this._updateBakeToReflectionProbe()}_updateUseLightProbe(){if(!this._model)return;const t=this.node;this._mesh&&t&&t.mobility===Vy.Movable&&this.bakeSettings.useLightProbe?this._model.useLightProbe=!0:this._model.useLightProbe=!1}_isBatchingEnabled(){for(let t=0;t<this._materials.length;++t){const e=this._materials[t];if(e)for(let t=0;t<e.passes.length;++t)if(e.passes[t].batchingScheme)return!0}return!1}_updateUseReflectionProbe(){this._model&&(this._model.reflectionProbeType=this.bakeSettings.reflectionProbe,this._updateReflectionProbeTexture())}_updateUseReflectionProbeType(){this._model&&(this._model.reflectionProbeType=this.bakeSettings.reflectionProbe)}_updateBakeToReflectionProbe(){this._model&&(this._model.bakeToReflectionProbe=this.bakeSettings.bakeToReflectionProbe)}_watchMorphInMesh(){if(this._morphInstance&&(this._morphInstance.destroy(),this._morphInstance=null),!this._enableMorph)return;if(!this._mesh||!this._mesh.struct.morph||!this._mesh.morphRendering)return;this._morphInstance=this._mesh.morphRendering.createInstance();const t=this._mesh.struct.primitives.length;for(let e=0;e<t;++e)this._uploadSubMeshShapesWeights(e);this._model&&this._model instanceof mL&&this._model.setMorphRendering(this._morphInstance)}_initSubMeshShapesWeights(){const{_mesh:t}=this;if(this._subMeshShapesWeights.length=0,!t)return;const e=t.struct.morph;if(!e)return;const i=e.weights;this._subMeshShapesWeights=e.subMeshMorphs.map((t=>t?t.weights?t.weights.slice(0):i?(i.length,t.targets.length,i.slice(0)):new Array(t.targets.length).fill(0):[]))}_validateShapeWeights(){const{_mesh:t,_subMeshShapesWeights:e}=this;if(!t||!t.struct.morph)return 0===e.length;const{morph:i}=t.struct;return i.subMeshMorphs.length===e.length&&e.every((({length:t},e)=>{var s,r;return(null!==(s=null==(r=i.subMeshMorphs[e])?void 0:r.targets.length)&&void 0!==s?s:0)===t}))}_uploadSubMeshShapesWeights(t){var e;null==(e=this._morphInstance)||e.setWeights(t,this._subMeshShapesWeights[t])}_updateStandardSkin(){const t=fL();if(this._enabledGlobalStandardSkinObject&&(t.standardSkinMeshRenderer=this,t.standardSkinModel=this.model),!t.skinMaterialModel&&this._model){const e=this._model.subModels;for(let i=0;i<e.length;i++)if(!(yk(e[i])<0))return void(t.skinMaterialModel=this._model)}}},nk.ShadowCastingMode=bk,nk.ShadowReceivingMode=vk,qL=Za((YL=nk).prototype,"bakeSettings",[pk],(function(){return new Sk})),$L=Za(YL.prototype,"_mesh",[pk],(function(){return null})),KL=Za(YL.prototype,"_shadowCastingMode",[pk],(function(){return bk.OFF})),ZL=Za(YL.prototype,"_shadowReceivingMode",[pk],(function(){return vk.ON})),QL=Za(YL.prototype,"_shadowBias",[pk],(function(){return 0})),JL=Za(YL.prototype,"_shadowNormalBias",[pk],(function(){return 0})),tk=Za(YL.prototype,"_reflectionProbeId",[pk],(function(){return-1})),ek=Za(YL.prototype,"_reflectionProbeBlendId",[pk],(function(){return-1})),ik=Za(YL.prototype,"_reflectionProbeBlendWeight",[pk],(function(){return 0})),sk=Za(YL.prototype,"_enabledGlobalStandardSkinObject",[pk],(function(){return!1})),s(YL.prototype,"shadowBias",[UL],Object.getOwnPropertyDescriptor(YL.prototype,"shadowBias"),YL.prototype),s(YL.prototype,"shadowNormalBias",[VL],Object.getOwnPropertyDescriptor(YL.prototype,"shadowNormalBias"),YL.prototype),s(YL.prototype,"shadowCastingMode",[jL],Object.getOwnPropertyDescriptor(YL.prototype,"shadowCastingMode"),YL.prototype),s(YL.prototype,"receiveShadow",[HL],Object.getOwnPropertyDescriptor(YL.prototype,"receiveShadow"),YL.prototype),s(YL.prototype,"mesh",[GL],Object.getOwnPropertyDescriptor(YL.prototype,"mesh"),YL.prototype),s(YL.prototype,"isGlobalStandardSkinObject",[WL],Object.getOwnPropertyDescriptor(YL.prototype,"isGlobalStandardSkinObject"),YL.prototype),rk=Za(YL.prototype,"_enableMorph",[pk],(function(){return!0})),XL=YL))||XL)||XL);function wk(t,e){const i=t.sharedMaterials.length;if(i!==e.sharedMaterials.length)return!1;for(let s=0;s<i;s++)if(t.getRenderMaterial(s)!==e.getRenderMaterial(s))return!1;return!0}t({MeshRenderer:Tk,ModelComponent:Tk}),t("BatchingUtility",class{static batchStaticModel(t,e){const i=t.getComponentsInChildren(Tk);if(i.length<2)return console.error("the number of static models to batch is less than 2,it needn't batch."),!1;for(let t=1;t<i.length;t++){if(!i[0].mesh.validateMergingMesh(i[t].mesh))return console.error(`the meshes of ${i[0].node.name} and ${i[t].node.name} can't be merged`),!1;if(!wk(i[0],i[t]))return console.error(`the materials of ${i[0].node.name} and ${i[t].node.name} can't be merged`),!1}const s=new uL,r=new vr,n=new vr;t.getWorldMatrix(n),vr.invert(n,n);for(let t=0;t<i.length;t++){const e=i[t];e.node.getWorldMatrix(r),vr.multiply(r,n,r),s.merge(i[t].mesh,r),e.enabled=!1}const o=e.addComponent(Tk);return o.mesh=s,o.sharedMaterials=i[0].sharedMaterials,!0}static unbatchStaticModel(t,e){const i=t.getComponentsInChildren(Tk);for(let t=0;t<i.length;t++)i[t].enabled=!0;const s=e.getComponent(Tk);return s&&(s.mesh&&s.mesh.destroyRenderingMesh(),s.destroy()),!0}}),Q(uL.prototype,"Mesh.prototype",[{name:"renderingMesh",newName:"renderingSubMeshes"}]),J(uL.prototype,"Mesh.prototype",[{name:"hasFlatBuffers"},{name:"destroyFlatBuffers"}]);const xk=t("Skeleton",jsb.Skeleton);a.Skeleton=xk;const Ck=xk.prototype;Object.defineProperty(Ck,"bindposes",{enumerable:!0,configurable:!0,get(){return this._bindposes},set(t){this._bindposes=t,this._setBindposes(t)}}),Ck._ctor=function(){jsb.Asset.prototype._ctor.apply(this,arguments),this._bindposes=[]},Ck.destroy=function(){var t,e;return null==(t=a.director.root)||null==(e=t.dataPoolManager)||e.releaseSkeleton(this),fm.prototype.destroy.call(this)};const Ak=Ck.onLoaded;var Dk,Ek,Ik,Mk,Pk,Ok,Rk,Bk,Fk,Nk,Lk,kk,zk,Uk,Vk,jk;Ck.onLoaded=function(){this._setBindposes(this._bindposes),Ak.call(this)},function(t,e=dm){const{Skeleton:i,CCString:s,Mat4:r}={...t};e((()=>{Xh([s])(i.prototype,"_joints",(()=>[]))}),"type","_joints"),e((()=>{Xh([r])(i.prototype,"_bindposes",(()=>[]))}),"type","_bindposes"),e((()=>{vh(i.prototype,"_hash",(()=>0))}),"serializable","_hash"),e((()=>{ah("cc.Skeleton")(i)}),"ccclass",null)}({Skeleton:xk,CCString:Ye,Mat4:vr}),J(Tk.prototype,"MeshRenderer.prototype",[{name:"enableDynamicBatching"},{name:"recieveShadows"}]),a.ModelComponent=Tk,Xt(Tk,"cc.ModelComponent");const Hk=new Ms,Gk=pe({LUMINOUS_FLUX:0,LUMINANCE:1});let Wk=ah("cc.StaticLightSettings")((Ek=class{constructor(){this._baked=Ik&&Ik(),this._editorOnly=Mk&&Mk(),this._castShadow=Pk&&Pk()}get editorOnly(){return this._editorOnly}set editorOnly(t){this._editorOnly=t}get baked(){return this._baked}set baked(t){this._baked=t}get castShadow(){return this._castShadow}set castShadow(t){this._castShadow=t}},Ik=Za(Ek.prototype,"_baked",[vh],(function(){return!1})),Mk=Za(Ek.prototype,"_editorOnly",[vh],(function(){return!1})),Pk=Za(Ek.prototype,"_castShadow",[vh],(function(){return!1})),Dk=Ek))||Dk,Xk=(Ok=ah("cc.Light"),Rk=Xh(Wk),Bk=Xh(Hy.BitMask),Ok(((jk=class extends Km{get color(){return this._color}set color(t){this._color=t.clone(),this._light&&(Hk.x=t.r/255,Hk.y=t.g/255,Hk.z=t.b/255,this._light.color=Hk)}get useColorTemperature(){return this._useColorTemperature}set useColorTemperature(t){this._useColorTemperature=t,this._light&&(this._light.useColorTemperature=t)}get colorTemperature(){return this._colorTemperature}set colorTemperature(t){this._colorTemperature=t,this._light&&(this._light.colorTemperature=t)}get staticSettings(){return this._staticSettings}set staticSettings(t){this._staticSettings=t}get type(){return this._type}get baked(){return this.staticSettings.baked}set baked(t){this.staticSettings.baked=t,null!==this._light&&(this._light.baked=t)}set visibility(t){this._visibility=t,this._light&&(this._light.visibility=t),this._onUpdateReceiveDirLight()}get visibility(){return this._visibility}constructor(){super(),this._color=Lk&&Lk(),this._useColorTemperature=kk&&kk(),this._colorTemperature=zk&&zk(),this._staticSettings=Uk&&Uk(),this._visibility=Vk&&Vk(),this._type=5,this._lightType=void 0,this._light=null,this._lightType=Gb}onLoad(){this._createLight()}onEnable(){this._attachToScene()}onDisable(){this._detachFromScene()}onDestroy(){this._destroyLight()}_createLight(){this._light||(this._light=a.director.root.createLight(this._lightType)),this.color=this._color,this.useColorTemperature=this._useColorTemperature,this.colorTemperature=this._colorTemperature,this._light.node=this.node,this._light.baked=this.baked,this._light.visibility=this.visibility}_destroyLight(){this._light&&(a.director.root.recycleLight(this._light),this._light=null)}_attachToScene(){if(this._detachFromScene(),this._light&&!this._light.scene&&this.node.scene){const t=this._getRenderScene();switch(this._type){case 0:t.addDirectionalLight(this._light),t.setMainLight(this._light);break;case 1:t.addSphereLight(this._light);break;case 2:t.addSpotLight(this._light);break;case 3:t.addPointLight(this._light);break;case 4:t.addRangedDirLight(this._light)}}}_detachFromScene(){if(this._light&&this._light.scene){const t=this._light.scene;switch(this._type){case 0:t.removeDirectionalLight(this._light),t.unsetMainLight(this._light);break;case 1:t.removeSphereLight(this._light);break;case 2:t.removeSpotLight(this._light);break;case 3:t.removePointLight(this._light);break;case 4:t.removeRangedDirLight(this._light)}}}_onUpdateReceiveDirLight(){}}).Type=jb,jk.PhotometricTerm=Gk,Lk=Za((Nk=jk).prototype,"_color",[vh],(function(){return Ls.WHITE.clone()})),kk=Za(Nk.prototype,"_useColorTemperature",[vh],(function(){return!1})),zk=Za(Nk.prototype,"_colorTemperature",[vh],(function(){return 6550})),Uk=Za(Nk.prototype,"_staticSettings",[vh],(function(){return new Wk})),Vk=Za(Nk.prototype,"_visibility",[vh],(function(){return PA})),s(Nk.prototype,"staticSettings",[Rk],Object.getOwnPropertyDescriptor(Nk.prototype,"staticSettings"),Nk.prototype),s(Nk.prototype,"visibility",[Bk],Object.getOwnPropertyDescriptor(Nk.prototype,"visibility"),Nk.prototype),Fk=Nk))||Fk);var Yk,qk,$k,Kk,Zk,Qk,Jk,tz,ez,iz,sz,rz,nz,oz,az,hz,lz,cz,uz,dz,_z,pz,mz,gz,fz,yz,bz,vz,Sz,Tz,wz,xz,Cz,Az,Dz,Ez,Iz,Mz,Pz,Oz,Rz,Bz,Fz,Nz,Lz,kz,zz,Uz,Vz,jz,Hz,Gz,Wz,Xz,Yz,qz,$z,Kz,Zz,Qz;t({Light:Xk,LightComponent:Xk});const{ccclass:Jz,menu:tU,executeInEditMode:eU,property:iU,serializable:sU,formerlySerializedAs:rU,tooltip:nU,help:oU,visible:aU,type:hU,editable:lU,slide:cU,range:uU}=il;let dU=(Yk=Jz("cc.DirectionalLight"),qk=rU("_illuminance"),$k=hU(Ge),Kk=iU({group:{name:"DynamicShadowSettings",displayOrder:1}}),Zk=hU(Xe),Qk=iU({group:{name:"DynamicShadowSettings",displayOrder:5}}),Jk=hU(iv),tz=iU({group:{name:"DynamicShadowSettings",displayOrder:6}}),ez=hU(We),iz=iU({group:{name:"DynamicShadowSettings",displayOrder:7}}),sz=hU(We),rz=iU({group:{name:"DynamicShadowSettings",displayOrder:8}}),nz=hU(We),oz=iU({group:{name:"DynamicShadowSettings",displayOrder:9}}),az=hU(We),hz=iU({group:{name:"DynamicShadowSettings",displayOrder:22}}),lz=hU(We),cz=iU({group:{name:"DynamicShadowSettings",displayOrder:10}}),uz=hU(sv),dz=iU({group:{name:"DynamicShadowSettings",displayOrder:11}}),_z=hU(Xe),pz=iU({group:{name:"DynamicShadowSettings",displayOrder:12}}),mz=hU(We),gz=iU({group:{name:"DynamicShadowSettings",displayOrder:13}}),fz=hU(rv),yz=iU({group:{name:"DynamicShadowSettings",displayOrder:14}}),bz=hU(Xe),vz=iU({group:{name:"DynamicShadowSettings",displayOrder:15}}),Sz=hU(We),Tz=iU({group:{name:"DynamicShadowSettings",displayOrder:16}}),wz=hU(We),xz=iU({group:{name:"DynamicShadowSettings",displayOrder:17}}),Cz=hU(We),Az=iU({group:{name:"DynamicShadowSettings",displayOrder:19}}),Dz=hU(Xe),Ez=iU({group:{name:"DynamicShadowSettings",displayOrder:20}}),Iz=hU(Xe),Mz=iU({group:{name:"DynamicShadowSettings",displayOrder:21}}),Pz=hU(We),Yk((Rz=class extends Xk{get illuminance(){return fL().isHDR?this._illuminanceHDR:this._illuminanceLDR}set illuminance(t){fL().isHDR?(this._illuminanceHDR=t,this._light&&(this._light.illuminanceHDR=this._illuminanceHDR)):(this._illuminanceLDR=t,this._light&&(this._light.illuminanceLDR=this._illuminanceLDR))}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(t){this._shadowEnabled=t,this._light&&(this._light.shadowEnabled=this._shadowEnabled)}get shadowPcf(){return this._shadowPcf}set shadowPcf(t){this._shadowPcf=t,this._light&&(this._light.shadowPcf=this._shadowPcf)}get shadowBias(){return this._shadowBias}set shadowBias(t){this._shadowBias=t,this._light&&(this._light.shadowBias=this._shadowBias)}get shadowNormalBias(){return this._shadowNormalBias}set shadowNormalBias(t){this._shadowNormalBias=t,this._light&&(this._light.shadowNormalBias=this._shadowNormalBias)}get shadowSaturation(){return this._shadowSaturation}set shadowSaturation(t){this._shadowSaturation=Ri(t,0,1),this._light&&(this._light.shadowSaturation=this._shadowSaturation)}get shadowDistance(){return this._shadowDistance}set shadowDistance(t){this._shadowDistance=Math.min(t,hv.MAX_FAR),this._shadowDistance/.1<10&&j(15003,this._shadowDistance),this._light&&(this._light.shadowDistance=this._shadowDistance,this._light.csmNeedUpdate=!0)}get shadowInvisibleOcclusionRange(){return this._shadowInvisibleOcclusionRange}set shadowInvisibleOcclusionRange(t){this._shadowInvisibleOcclusionRange=Math.min(t,hv.MAX_FAR),this._light&&(this._light.shadowInvisibleOcclusionRange=this._shadowInvisibleOcclusionRange)}get csmLevel(){return this._csmLevel}set csmLevel(t){this._csmLevel=t,this._light&&(this._light.csmLevel=this._csmLevel,this._light.csmNeedUpdate=!0)}get enableCSM(){return this._csmLevel>sv.LEVEL_1}set enableCSM(t){this._csmLevel=t?sv.LEVEL_4:sv.LEVEL_1,this._light&&(this._light.csmLevel=this._csmLevel,this._light.csmNeedUpdate=!0)}get csmLayerLambda(){return this._csmLayerLambda}set csmLayerLambda(t){this._csmLayerLambda=t,this._light&&(this._light.csmLayerLambda=this._csmLayerLambda,this._light.csmNeedUpdate=!0)}get csmOptimizationMode(){return this._csmOptimizationMode}set csmOptimizationMode(t){this._csmOptimizationMode=t,this._light&&(this._light.csmOptimizationMode=this._csmOptimizationMode)}get shadowFixedArea(){return this._shadowFixedArea}set shadowFixedArea(t){this._shadowFixedArea=t,this._light&&(this._light.shadowFixedArea=this._shadowFixedArea)}get shadowNear(){return this._shadowNear}set shadowNear(t){this._shadowNear=t,this._light&&(this._light.shadowNear=this._shadowNear)}get shadowFar(){return this._shadowFar}set shadowFar(t){this._shadowFar=Math.min(t,hv.MAX_FAR),this._light&&(this._light.shadowFar=this._shadowFar)}get shadowOrthoSize(){return this._shadowOrthoSize}set shadowOrthoSize(t){this._shadowOrthoSize=t,this._light&&(this._light.shadowOrthoSize=this._shadowOrthoSize)}get csmAdvancedOptions(){return this._csmAdvancedOptions}set csmAdvancedOptions(t){this._csmAdvancedOptions=t}get csmLayersTransition(){return this._csmLayersTransition}set csmLayersTransition(t){this._csmLayersTransition=t,this._light&&(this._light.csmLayersTransition=t)}get csmTransitionRange(){return this._csmTransitionRange}set csmTransitionRange(t){this._csmTransitionRange=t,this._light&&(this._light.csmTransitionRange=t)}constructor(){super(),this._illuminanceHDR=Bz&&Bz(),this._illuminanceLDR=Fz&&Fz(),this._shadowEnabled=Nz&&Nz(),this._shadowPcf=Lz&&Lz(),this._shadowBias=kz&&kz(),this._shadowNormalBias=zz&&zz(),this._shadowSaturation=Uz&&Uz(),this._shadowDistance=Vz&&Vz(),this._shadowInvisibleOcclusionRange=jz&&jz(),this._csmLevel=Hz&&Hz(),this._csmLayerLambda=Gz&&Gz(),this._csmOptimizationMode=Wz&&Wz(),this._csmAdvancedOptions=Xz&&Xz(),this._csmLayersTransition=Yz&&Yz(),this._csmTransitionRange=qz&&qz(),this._shadowFixedArea=$z&&$z(),this._shadowNear=Kz&&Kz(),this._shadowFar=Zz&&Zz(),this._shadowOrthoSize=Qz&&Qz(),this._lightType=Wb,Se.querySettings("rendering","highQualityMode")&&(this._shadowPcf=iv.SOFT_2X,this._shadowDistance=50,this.enableCSM=!0,this.staticSettings.castShadow=!0)}_createLight(){if(super._createLight(),this._type=0,this._light){const t=this._light;t.illuminanceHDR=this._illuminanceHDR,t.illuminanceLDR=this._illuminanceLDR,t.shadowEnabled=this._shadowEnabled,t.shadowPcf=this._shadowPcf,t.shadowBias=this._shadowBias,t.shadowNormalBias=this._shadowNormalBias,t.shadowSaturation=this._shadowSaturation,t.shadowDistance=this._shadowDistance,t.shadowInvisibleOcclusionRange=this._shadowInvisibleOcclusionRange,t.shadowFixedArea=this._shadowFixedArea,t.shadowNear=this._shadowNear,t.shadowFar=this._shadowFar,t.shadowOrthoSize=this._shadowOrthoSize,t.csmLevel=this._csmLevel,t.csmLayerLambda=this._csmLayerLambda,t.csmOptimizationMode=this._csmOptimizationMode,t.csmLayersTransition=this._csmLayersTransition,t.csmTransitionRange=this._csmTransitionRange}}_onUpdateReceiveDirLight(){if(!this._light)return;super._onUpdateReceiveDirLight();const t=this.node.scene;if(!t||!t.renderScene)return;if(t.renderScene.mainLight!==this._light)return;const e=t.renderScene.models;for(let t=0;t<e.length;t++){const i=e[t];if(!i.node)continue;const s=i.node.getComponent(Tk);s&&s.onUpdateReceiveDirLight(this._visibility)}}},Bz=Za(Rz.prototype,"_illuminanceHDR",[iU,qk],(function(){return 65e3})),Fz=Za(Rz.prototype,"_illuminanceLDR",[sU],(function(){return 65e3*Ib.standardExposureValue})),Nz=Za(Rz.prototype,"_shadowEnabled",[sU],(function(){return!1})),Lz=Za(Rz.prototype,"_shadowPcf",[sU],(function(){return iv.HARD})),kz=Za(Rz.prototype,"_shadowBias",[sU],(function(){return 1e-5})),zz=Za(Rz.prototype,"_shadowNormalBias",[sU],(function(){return 0})),Uz=Za(Rz.prototype,"_shadowSaturation",[sU],(function(){return 1})),Vz=Za(Rz.prototype,"_shadowDistance",[sU],(function(){return 50})),jz=Za(Rz.prototype,"_shadowInvisibleOcclusionRange",[sU],(function(){return 200})),Hz=Za(Rz.prototype,"_csmLevel",[sU],(function(){return sv.LEVEL_4})),Gz=Za(Rz.prototype,"_csmLayerLambda",[sU],(function(){return.75})),Wz=Za(Rz.prototype,"_csmOptimizationMode",[sU],(function(){return rv.RemoveDuplicates})),Xz=Za(Rz.prototype,"_csmAdvancedOptions",[sU],(function(){return!1})),Yz=Za(Rz.prototype,"_csmLayersTransition",[sU],(function(){return!1})),qz=Za(Rz.prototype,"_csmTransitionRange",[sU],(function(){return.05})),$z=Za(Rz.prototype,"_shadowFixedArea",[sU],(function(){return!1})),Kz=Za(Rz.prototype,"_shadowNear",[sU],(function(){return.1})),Zz=Za(Rz.prototype,"_shadowFar",[sU],(function(){return 10})),Qz=Za(Rz.prototype,"_shadowOrthoSize",[sU],(function(){return 5})),s(Rz.prototype,"illuminance",[$k],Object.getOwnPropertyDescriptor(Rz.prototype,"illuminance"),Rz.prototype),s(Rz.prototype,"shadowEnabled",[Kk,Zk],Object.getOwnPropertyDescriptor(Rz.prototype,"shadowEnabled"),Rz.prototype),s(Rz.prototype,"shadowPcf",[Qk,Jk],Object.getOwnPropertyDescriptor(Rz.prototype,"shadowPcf"),Rz.prototype),s(Rz.prototype,"shadowBias",[tz,ez],Object.getOwnPropertyDescriptor(Rz.prototype,"shadowBias"),Rz.prototype),s(Rz.prototype,"shadowNormalBias",[iz,sz],Object.getOwnPropertyDescriptor(Rz.prototype,"shadowNormalBias"),Rz.prototype),s(Rz.prototype,"shadowSaturation",[rz,nz],Object.getOwnPropertyDescriptor(Rz.prototype,"shadowSaturation"),Rz.prototype),s(Rz.prototype,"shadowDistance",[oz,az],Object.getOwnPropertyDescriptor(Rz.prototype,"shadowDistance"),Rz.prototype),s(Rz.prototype,"shadowInvisibleOcclusionRange",[hz,lz],Object.getOwnPropertyDescriptor(Rz.prototype,"shadowInvisibleOcclusionRange"),Rz.prototype),s(Rz.prototype,"csmLevel",[cz,uz],Object.getOwnPropertyDescriptor(Rz.prototype,"csmLevel"),Rz.prototype),s(Rz.prototype,"enableCSM",[dz,_z],Object.getOwnPropertyDescriptor(Rz.prototype,"enableCSM"),Rz.prototype),s(Rz.prototype,"csmLayerLambda",[pz,mz],Object.getOwnPropertyDescriptor(Rz.prototype,"csmLayerLambda"),Rz.prototype),s(Rz.prototype,"csmOptimizationMode",[gz,fz],Object.getOwnPropertyDescriptor(Rz.prototype,"csmOptimizationMode"),Rz.prototype),s(Rz.prototype,"shadowFixedArea",[yz,bz],Object.getOwnPropertyDescriptor(Rz.prototype,"shadowFixedArea"),Rz.prototype),s(Rz.prototype,"shadowNear",[vz,Sz],Object.getOwnPropertyDescriptor(Rz.prototype,"shadowNear"),Rz.prototype),s(Rz.prototype,"shadowFar",[Tz,wz],Object.getOwnPropertyDescriptor(Rz.prototype,"shadowFar"),Rz.prototype),s(Rz.prototype,"shadowOrthoSize",[xz,Cz],Object.getOwnPropertyDescriptor(Rz.prototype,"shadowOrthoSize"),Rz.prototype),s(Rz.prototype,"csmAdvancedOptions",[Az,Dz],Object.getOwnPropertyDescriptor(Rz.prototype,"csmAdvancedOptions"),Rz.prototype),s(Rz.prototype,"csmLayersTransition",[Ez,Iz],Object.getOwnPropertyDescriptor(Rz.prototype,"csmLayersTransition"),Rz.prototype),s(Rz.prototype,"csmTransitionRange",[Mz,Pz],Object.getOwnPropertyDescriptor(Rz.prototype,"csmTransitionRange"),Rz.prototype),Oz=Rz))||Oz);var _U,pU,mU,gU,fU,yU,bU,vU,SU,TU,wU,xU,CU,AU;t({DirectionalLight:dU,DirectionalLightComponent:dU});let DU=(_U=ah("cc.SphereLight"),pU=Sh("_luminance"),mU=Xh(Ge),gU=Xh(Ge),fU=Xh(Gk),yU=Xh(We),bU=Xh(We),_U((SU=class extends Xk{get luminousFlux(){return fL().isHDR?this._luminanceHDR*Hb(this._size):this._luminanceLDR}set luminousFlux(t){let e=0;fL().isHDR?(this._luminanceHDR=t/Hb(this._size),e=this._luminanceHDR):(this._luminanceLDR=t,e=this._luminanceLDR),this._light&&(this._light.luminance=e)}get luminance(){return fL().isHDR?this._luminanceHDR:this._luminanceLDR}set luminance(t){fL().isHDR?(this._luminanceHDR=t,this._light&&(this._light.luminanceHDR=this._luminanceHDR)):(this._luminanceLDR=t,this._light&&(this._light.luminanceLDR=this._luminanceLDR))}get term(){return this._term}set term(t){this._term=t}get size(){return this._size}set size(t){this._size=t,this._light&&(this._light.size=t)}get range(){return this._range}set range(t){this._range=t,this._light&&(this._light.range=t)}constructor(){super(),this._size=TU&&TU(),this._luminanceHDR=wU&&wU(),this._luminanceLDR=xU&&xU(),this._term=CU&&CU(),this._range=AU&&AU(),this._lightType=Yb}_createLight(){super._createLight(),this._type=1,this.size=this._size,this.range=this._range,this._light&&(this._light.luminanceHDR=this._luminanceHDR,this._light.luminanceLDR=this._luminanceLDR)}},TU=Za(SU.prototype,"_size",[vh],(function(){return.15})),wU=Za(SU.prototype,"_luminanceHDR",[vh,pU],(function(){return 1700/Hb(.15)})),xU=Za(SU.prototype,"_luminanceLDR",[vh],(function(){return 1700/Hb(.15)*Ib.standardExposureValue*Ib.standardLightMeterScale})),CU=Za(SU.prototype,"_term",[vh],(function(){return Gk.LUMINOUS_FLUX})),AU=Za(SU.prototype,"_range",[vh],(function(){return 1})),s(SU.prototype,"luminousFlux",[mU],Object.getOwnPropertyDescriptor(SU.prototype,"luminousFlux"),SU.prototype),s(SU.prototype,"luminance",[gU],Object.getOwnPropertyDescriptor(SU.prototype,"luminance"),SU.prototype),s(SU.prototype,"term",[fU],Object.getOwnPropertyDescriptor(SU.prototype,"term"),SU.prototype),s(SU.prototype,"size",[yU],Object.getOwnPropertyDescriptor(SU.prototype,"size"),SU.prototype),s(SU.prototype,"range",[bU],Object.getOwnPropertyDescriptor(SU.prototype,"range"),SU.prototype),vU=SU))||vU);var EU,IU,MU,PU,OU,RU,BU,FU,NU,LU,kU,zU,UU,VU,jU,HU,GU,WU,XU,YU,qU,$U,KU,ZU,QU;t({SphereLight:DU,SphereLightComponent:DU});const{ccclass:JU,range:tV,slide:eV,type:iV,editable:sV,displayOrder:rV,help:nV,executeInEditMode:oV,menu:aV,tooltip:hV,serializable:lV,formerlySerializedAs:cV,visible:uV,property:dV}=il;let _V=(EU=JU("cc.SpotLight"),IU=cV("_luminance"),MU=iV(Gk),PU=iV(We),OU=dV({group:{name:"DynamicShadowSettings",displayOrder:1}}),RU=iV(Xe),BU=dV({group:{name:"DynamicShadowSettings",displayOrder:2}}),FU=iV(iv),NU=dV({group:{name:"DynamicShadowSettings",displayOrder:3}}),LU=iV(We),kU=dV({group:{name:"DynamicShadowSettings",displayOrder:4}}),zU=iV(We),EU((VU=class extends Xk{get luminousFlux(){return fL().isHDR?this._luminanceHDR*Hb(this._size):this._luminanceLDR}set luminousFlux(t){let e=0;fL().isHDR?(this._luminanceHDR=t/Hb(this._size),e=this._luminanceHDR):(this._luminanceLDR=t,e=this._luminanceLDR),this._light&&(this._light.luminance=e)}get luminance(){return fL().isHDR?this._luminanceHDR:this._luminanceLDR}set luminance(t){fL().isHDR?(this._luminanceHDR=t,this._light&&(this._light.luminanceHDR=this._luminanceHDR)):(this._luminanceLDR=t,this._light&&(this._light.luminanceLDR=this._luminanceLDR))}get term(){return this._term}set term(t){this._term=t}get size(){return this._size}set size(t){this._size=t,this._light&&(this._light.size=t)}get range(){return this._range}set range(t){this._range=t,this._light&&(this._light.range=t)}get spotAngle(){return this._spotAngle}set spotAngle(t){this._spotAngle=t,this._light&&(this._light.spotAngle=Ni(t))}get angleAttenuationStrength(){return this._angleAttenuationStrength}set angleAttenuationStrength(t){this._angleAttenuationStrength=t,this._light&&(this._light.angleAttenuationStrength=t)}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(t){this._shadowEnabled=t,this._light&&(this._light.shadowEnabled=t)}get shadowPcf(){return this._shadowPcf}set shadowPcf(t){this._shadowPcf=t,this._light&&(this._light.shadowPcf=t)}get shadowBias(){return this._shadowBias}set shadowBias(t){this._shadowBias=t,this._light&&(this._light.shadowBias=t)}get shadowNormalBias(){return this._shadowNormalBias}set shadowNormalBias(t){this._shadowNormalBias=t,this._light&&(this._light.shadowNormalBias=t)}constructor(){super(),this._size=jU&&jU(),this._luminanceHDR=HU&&HU(),this._luminanceLDR=GU&&GU(),this._term=WU&&WU(),this._range=XU&&XU(),this._spotAngle=YU&&YU(),this._angleAttenuationStrength=qU&&qU(),this._shadowEnabled=$U&&$U(),this._shadowPcf=KU&&KU(),this._shadowBias=ZU&&ZU(),this._shadowNormalBias=QU&&QU(),this._lightType=Xb}_createLight(){if(super._createLight(),this._type=2,this.size=this._size,this.range=this._range,this.spotAngle=this._spotAngle,this.angleAttenuationStrength=this._angleAttenuationStrength,this._light){const t=this._light;t.luminanceHDR=this._luminanceHDR,t.luminanceLDR=this._luminanceLDR,t.shadowEnabled=this._shadowEnabled,t.shadowPcf=this._shadowPcf,t.shadowBias=this._shadowBias,t.shadowNormalBias=this._shadowNormalBias}}},jU=Za(VU.prototype,"_size",[lV],(function(){return.15})),HU=Za(VU.prototype,"_luminanceHDR",[lV,IU],(function(){return 1700/Hb(.15)})),GU=Za(VU.prototype,"_luminanceLDR",[lV],(function(){return 1700/Hb(.15)*Ib.standardExposureValue*Ib.standardLightMeterScale})),WU=Za(VU.prototype,"_term",[lV],(function(){return Gk.LUMINOUS_FLUX})),XU=Za(VU.prototype,"_range",[lV],(function(){return 1})),YU=Za(VU.prototype,"_spotAngle",[lV],(function(){return 60})),qU=Za(VU.prototype,"_angleAttenuationStrength",[lV],(function(){return 0})),$U=Za(VU.prototype,"_shadowEnabled",[lV],(function(){return!1})),KU=Za(VU.prototype,"_shadowPcf",[lV],(function(){return iv.HARD})),ZU=Za(VU.prototype,"_shadowBias",[lV],(function(){return 1e-5})),QU=Za(VU.prototype,"_shadowNormalBias",[lV],(function(){return 0})),s(VU.prototype,"term",[MU],Object.getOwnPropertyDescriptor(VU.prototype,"term"),VU.prototype),s(VU.prototype,"size",[PU],Object.getOwnPropertyDescriptor(VU.prototype,"size"),VU.prototype),s(VU.prototype,"shadowEnabled",[OU,RU],Object.getOwnPropertyDescriptor(VU.prototype,"shadowEnabled"),VU.prototype),s(VU.prototype,"shadowPcf",[BU,FU],Object.getOwnPropertyDescriptor(VU.prototype,"shadowPcf"),VU.prototype),s(VU.prototype,"shadowBias",[NU,LU],Object.getOwnPropertyDescriptor(VU.prototype,"shadowBias"),VU.prototype),s(VU.prototype,"shadowNormalBias",[kU,zU],Object.getOwnPropertyDescriptor(VU.prototype,"shadowNormalBias"),VU.prototype),UU=VU))||UU);var pV,mV,gV,fV,yV,bV,vV,SV,TV,wV,xV,CV,AV,DV,EV,IV,MV,PV,OV;t({SpotLight:_V,SpotLightComponent:_V}),t("PointLight",(pV=ah("cc.PointLight"),mV=Sh("_luminance"),gV=Xh(Ge),fV=Xh(Ge),yV=Xh(Gk),bV=Xh(We),pV((SV=class extends Xk{get luminousFlux(){return fL().isHDR?this._luminanceHDR*Hb(1):this._luminanceLDR}set luminousFlux(t){let e=0;fL().isHDR?(this._luminanceHDR=t/Hb(1),e=this._luminanceHDR):(this._luminanceLDR=t,e=this._luminanceLDR),this._light&&(this._light.luminance=e)}get luminance(){return fL().isHDR?this._luminanceHDR:this._luminanceLDR}set luminance(t){fL().isHDR?(this._luminanceHDR=t,this._light&&(this._light.luminanceHDR=this._luminanceHDR)):(this._luminanceLDR=t,this._light&&(this._light.luminanceLDR=this._luminanceLDR))}get term(){return this._term}set term(t){this._term=t}get range(){return this._range}set range(t){this._range=t,this._light&&(this._light.range=t)}constructor(){super(),this._luminanceHDR=TV&&TV(),this._luminanceLDR=wV&&wV(),this._term=xV&&xV(),this._range=CV&&CV(),this._lightType=qb}_createLight(){super._createLight(),this._type=3,this.range=this._range,this._light&&(this._light.luminanceHDR=this._luminanceHDR,this._light.luminanceLDR=this._luminanceLDR)}},TV=Za(SV.prototype,"_luminanceHDR",[vh,mV],(function(){return 1700/Hb(.15)})),wV=Za(SV.prototype,"_luminanceLDR",[vh],(function(){return 1700/Hb(.15)*Ib.standardExposureValue*Ib.standardLightMeterScale})),xV=Za(SV.prototype,"_term",[vh],(function(){return Gk.LUMINOUS_FLUX})),CV=Za(SV.prototype,"_range",[vh],(function(){return 1})),s(SV.prototype,"luminousFlux",[gV],Object.getOwnPropertyDescriptor(SV.prototype,"luminousFlux"),SV.prototype),s(SV.prototype,"luminance",[fV],Object.getOwnPropertyDescriptor(SV.prototype,"luminance"),SV.prototype),s(SV.prototype,"term",[yV],Object.getOwnPropertyDescriptor(SV.prototype,"term"),SV.prototype),s(SV.prototype,"range",[bV],Object.getOwnPropertyDescriptor(SV.prototype,"range"),SV.prototype),vV=SV))||vV)),t("RangedDirectionalLight",(AV=ah("cc.RangedDirectionalLight"),DV=Sh("_illuminance"),EV=Xh(Ge),AV((MV=class extends Xk{get illuminance(){return fL().isHDR?this._illuminanceHDR:this._illuminanceLDR}set illuminance(t){fL().isHDR?(this._illuminanceHDR=t,this._light&&(this._light.illuminanceHDR=this._illuminanceHDR)):(this._illuminanceLDR=t,this._light&&(this._light.illuminanceLDR=this._illuminanceLDR))}constructor(){super(),this._illuminanceHDR=PV&&PV(),this._illuminanceLDR=OV&&OV(),this._lightType=$b}_createLight(){super._createLight(),this._type=4,this._light&&(this._light.illuminanceHDR=this._illuminanceHDR,this._light.illuminanceLDR=this._illuminanceLDR)}},PV=Za(MV.prototype,"_illuminanceHDR",[uh,DV],(function(){return 65e3})),OV=Za(MV.prototype,"_illuminanceLDR",[vh],(function(){return 65e3*Ib.standardExposureValue})),s(MV.prototype,"illuminance",[EV],Object.getOwnPropertyDescriptor(MV.prototype,"illuminance"),MV.prototype),IV=MV))||IV)),a.LightComponent=Xk,Xt(Xk,"cc.LightComponent"),a.DirectionalLightComponent=dU,Xt(dU,"cc.DirectionalLightComponent"),a.SphereLightComponent=DU,Xt(DU,"cc.SphereLightComponent"),a.SpotLightComponent=_V,Xt(_V,"cc.SpotLightComponent"),Q(_V.prototype,"SpotLight.prototype",[{name:"luminousPower",newName:"luminousFlux",customGetter(){return this.luminousFlux},customSetter(t){this.luminousFlux=t}}]),Q(DU.prototype,"SphereLight.prototype",[{name:"luminousPower",newName:"luminousFlux",customGetter(){return this.luminousFlux},customSetter(t){this.luminousFlux=t}}]),Q(Xk.PhotometricTerm,"Light.PhotometricTerm",[{name:"LUMINOUS_POWER",newName:"LUMINOUS_FLUX"}]);const RV=jsb.SkinningModel;a.SkinningModel=jsb.SkinningModel;const BV=jsb.BakedSkinningModel;a.BakedSkinningModel=jsb.BakedSkinningModel,jsb.MorphModel;const FV=BV.prototype;FV._ctor=function(){jsb.Model.prototype._ctor.call(this),this.uploadedAnim=void 0,this._dataPoolManager=a.director.root.dataPoolManager;const t=new Float32Array(4),e=this._dataPoolManager.jointAnimationInfo.getData();this._jointsMedium={buffer:null,jointTextureInfo:t,animInfo:e,texture:null,boundsInfo:null},this._skeleton=null,this._mesh=null};const NV=FV.destroy;FV.destroy=function(){this.uploadedAnim=void 0,this._jointsMedium.boundsInfo=null,this._applyJointTexture(),NV.call(this)};const LV=FV.bindSkeleton;var kV,zV,UV,VV,jV,HV,GV,WV,XV,YV;FV.bindSkeleton=function(t=null,e=null,i=null){if(this._skeleton=t,this._mesh=i,!t||!e||!i)return;this.transform=e;const s=this._dataPoolManager;this._jointsMedium.animInfo=s.jointAnimationInfo.getData(e.uuid);const r=this._jointsMedium.animInfo;this.syncAnimInfoForJS(r.buffer,r.data,r.dirtyForJSB),LV.apply(this,arguments)},FV.uploadAnimation=function(t){var e;if(!this._skeleton||!this._mesh||this.uploadedAnim===t)return;this.uploadedAnim=t,this.setUploadedAnimForJS(!!t);const i=this._dataPoolManager;let s=null,r=null;t?(s=i.jointTexturePool.getSequencePoseTexture(this._skeleton,t,this._mesh,this.transform),this._jointsMedium.boundsInfo=s&&s.bounds.get(this._mesh.hash),r=null):(s=i.jointTexturePool.getDefaultPoseTexture(this._skeleton,this._mesh,this.transform),this._jointsMedium.boundsInfo=null,r=s&&s.bounds.get(this._mesh.hash)[0]),this._applyJointTexture(s);const{jointTextureInfo:n}=this._jointsMedium,o=null==(e=s)?void 0:e.handle.texture;this.syncDataForJS(this._jointsMedium.boundsInfo,r,n[0],n[1],n[2],n[3],o,this._jointsMedium.animInfo.data)},FV._applyJointTexture=function(t=null){const e=this._jointsMedium.texture;if(e&&e!==t&&this._dataPoolManager.jointTexturePool.releaseHandle(e),this._jointsMedium.texture=t,!t)return;const{jointTextureInfo:i}=this._jointsMedium;i[0]=t.handle.texture.width,i[1]=this._skeleton.joints.length,i[2]=t.pixelOffset+.1,i[3]=1/i[0]};let qV=(kV=ah("cc.SkinnedMeshRenderer"),zV=lh(100),UV=Xh(xk),VV=Xh(tb),jV=Xh(xk),HV=Xh(tb),kV(GV=zV((WV=class extends Tk{get skeleton(){return this._skeleton}set skeleton(t){t!==this._skeleton&&(this._skeleton=t,this._update())}get skinningRoot(){return this._skinningRoot}set skinningRoot(t){t!==this._skinningRoot&&(this._skinningRoot=t,this._tryBindAnimation(),this._update())}get model(){return this._model}constructor(){super(),this._skeleton=XV&&XV(),this._skinningRoot=YV&&YV(),this._clip=null,this.associatedAnimation=null,this._modelType=BV}onLoad(){super.onLoad(),this._tryBindAnimation()}onDestroy(){this.associatedAnimation&&(this.associatedAnimation.notifySkinnedMeshRemoved(this),this.associatedAnimation),super.onDestroy()}uploadAnimation(t){this._clip=t,this.model&&this.model.uploadAnimation&&this.model.uploadAnimation(t)}setUseBakedAnimation(t=!0,e=!1){const i=t?BV:RV;(e||this._modelType!==i)&&(this._modelType=i,this._model&&(a.director.root.destroyModel(this._model),this._model=null,this._models.length=0,this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateUseLightProbe(),this.enabledInHierarchy&&this._attachToScene()))}setSharedMaterial(t,e){super.setSharedMaterial(t,e),this._modelType===RV&&this.getMaterialInstance(e)}_updateModelParams(){this._update(),super._updateModelParams()}_tryBindAnimation(){const{_skinningRoot:t}=this;if(!t)return;let e=!1;for(let i=this.node;i;i=i.parent)if(i===t){e=!0;break}if(!e)return;const i=t.getComponent("cc.SkeletalAnimation");i&&i.enabledInHierarchy?i.notifySkinnedMeshAdded(this):this.setUseBakedAnimation(!1)}_update(){this.model&&(this.model.bindSkeleton(this._skeleton,this._skinningRoot,this._mesh),this.model.uploadAnimation&&this.model.uploadAnimation(this._clip))}},XV=Za(WV.prototype,"_skeleton",[UV],(function(){return null})),YV=Za(WV.prototype,"_skinningRoot",[VV],(function(){return null})),s(WV.prototype,"skeleton",[jV],Object.getOwnPropertyDescriptor(WV.prototype,"skeleton"),WV.prototype),s(WV.prototype,"skinningRoot",[HV],Object.getOwnPropertyDescriptor(WV.prototype,"skinningRoot"),WV.prototype),GV=WV))||GV)||GV);t({SkinnedMeshRenderer:qV,SkinningModelComponent:qV});const $V=new vr;function KV(t,e,i){for(vr.identity(i);t!==e;)vr.fromRTS($V,t.rotation,t.position,t.scale),vr.multiply(i,$V,i),t=t.parent;return i}var ZV,QV,JV,tj,ej,ij,sj,rj,nj,oj,aj,hj,lj,cj,uj,dj,_j,pj,mj,gj,fj,yj;const bj=new x_("a_batch_id",11),vj=new x_("a_batch_uv",21),Sj=tp[bj.format].size+tp[vj.format].size;let Tj=(ZV=ah("cc.SkinnedMeshUnit"),QV=Xh(uL),JV=Xh(xk),tj=Xh(fv),ej=Xh(qV),ZV((sj=class{constructor(){this.mesh=rj&&rj(),this.skeleton=nj&&nj(),this.material=oj&&oj(),this._localTransform=aj&&aj(),this._offset=hj&&hj(),this._size=lj&&lj()}set offset(t){kr.copy(this._offset,t)}get offset(){return this._offset}set size(t){kr.copy(this._size,t)}get size(){return this._size}set copyFrom(t){t&&(this.mesh=t.mesh,this.skeleton=t.skeleton,this.material=t.getSharedMaterial(0),t.skinningRoot&&KV(t.node,t.skinningRoot,this._localTransform))}get copyFrom(){return null}},rj=Za(sj.prototype,"mesh",[QV],(function(){return null})),nj=Za(sj.prototype,"skeleton",[JV],(function(){return null})),oj=Za(sj.prototype,"material",[tj],(function(){return null})),aj=Za(sj.prototype,"_localTransform",[vh],(function(){return new vr})),hj=Za(sj.prototype,"_offset",[vh],(function(){return new kr(0,0)})),lj=Za(sj.prototype,"_size",[vh],(function(){return new kr(1,1)})),s(sj.prototype,"copyFrom",[ej],Object.getOwnPropertyDescriptor(sj.prototype,"copyFrom"),sj.prototype),ij=sj))||ij);t({SkinnedMeshUnit:Tj,SkinningModelUnit:Tj});const wj=new vr;new vr;const xj=new Ms;let Cj=(cj=ah("cc.SkinnedMeshBatchRenderer"),uj=lh(100),dj=Xh([Ye]),_j=Xh([Tj]),cj(pj=uj((mj=class extends qV{constructor(){super(),this.atlasSize=gj&&gj(),this.batchableTextureNames=fj&&fj(),this.units=yj&&yj(),this._textures={},this._batchMaterial=null}get mesh(){return super.mesh}set mesh(t){super.mesh=t}get skeleton(){return super.skeleton}set skeleton(t){super.skeleton=t}onLoad(){super.onLoad(),this.cook()}onDestroy(){for(const t in this._textures)this._textures[t].destroy();this._textures={},this._mesh&&(this._mesh.destroy(),this._mesh=null),super.onDestroy()}_onMaterialModified(t,e){this.cookMaterials(),super._onMaterialModified(t,this.getMaterialInstance(t))}cook(){this.cookMaterials(),this.cookSkeletons(),this.cookMeshes()}cookMaterials(){this._batchMaterial||(this._batchMaterial=this.getSharedMaterial(0));const t=this.getMaterialInstance(0);if(!t||!this._batchMaterial||!this._batchMaterial.effectAsset)return void M("incomplete batch material!");t.copy(this._batchMaterial),this.resizeAtlases();const e=t.effectAsset.techniques[t.technique];for(let i=0;i<e.passes.length;i++){const s=e.passes[i];if(s.properties)for(const e in s.properties)if(s.properties[e].type>=26){let s=null;this.batchableTextureNames.find((t=>t===e))?(s=this._textures[e],s||(s=this.createTexture(e)),this.cookTextures(s,e,i)):this.units.some((t=>s=t.material&&t.material.getProperty(e,i))),s&&t.setProperty(e,s,i)}else{const s=[];for(let t=0;t<this.units.length;t++){const r=this.units[t];r.material&&s.push(r.material.getProperty(e.slice(0,-3),i))}t.setProperty(e,s,i)}}}cookSkeletons(){if(!this._skinningRoot)return void M("no skinning root specified!");const t=[],e=[];for(let i=0;i<this.units.length;i++){const s=this.units[i];if(!s||!s.skeleton)continue;const r=s.skeleton;vr.invert(wj,s._localTransform);for(let i=0;i<r.joints.length;i++){const s=r.joints[i];t.findIndex((t=>t===s))>=0||(t.push(s),e.push(vr.multiply(new vr,r.bindposes[i]||vr.IDENTITY,wj)))}}const i=Array.from(Array(t.length).keys()).sort(((e,i)=>t[e]>t[i]?1:t[e]<t[i]?-1:0)),s=new xk;s.joints=t.map(((t,e,s)=>s[i[e]])),s.bindposes=e.map(((t,e,s)=>s[i[e]])),this._skeleton&&this._skeleton.destroy(),this.skeleton=s}cookMeshes(){let t=!1;for(let e=0;e<this.units.length;e++)if(this.units[e].mesh){t=!0;break}if(!t||!this._skinningRoot)return;this._mesh?this._mesh.destroyRenderingMesh():this._mesh=new uL;let e=0,i=0,s=0,r=0,n=0,o=0,a=0,h=0,l=0,c=0;const u=new Array(this.units.length),d=this.units.length;for(let t=0;t<d;t++){const e=this.units[t];e&&e.skeleton&&(u[t]=e.skeleton.joints.map((t=>this._skeleton.joints.findIndex((e=>t===e)))))}for(let t=0;t<d;t++){const d=this.units[t];if(!d||!d.mesh||!d.mesh.data)continue;const _=this._createUnitMesh(t,d.mesh),p=new DataView(_.data.buffer);vr.invert(wj,d._localTransform),vr.transpose(wj,wj);const{offset:m}=d,{size:g}=d;for(let f=0;f<_.struct.vertexBundles.length;f++){const y=_.struct.vertexBundles[f];e=y.view.offset,i=0;for(let t=0;t<y.attributes.length;t++){const s=y.attributes[t];if("a_position"===s.name){i=s.format;break}e+=tp[s.format].size}if(i){const t=nD(p,i,e,y.view.length,y.view.stride);for(let e=0;e<t.length;e+=3)Ms.fromArray(xj,t,e),Ms.transformMat4(xj,xj,d._localTransform),Ms.toArray(t,xj,e);rD(p,t,i,e,y.view.stride)}s=y.view.offset,r=0;for(let t=0;t<y.attributes.length;t++){const e=y.attributes[t];if("a_normal"===e.name){r=e.format;break}s+=tp[e.format].size}if(r){const t=nD(p,r,s,y.view.length,y.view.stride);for(let e=0;e<t.length;e+=3)Ms.fromArray(xj,t,e),Ms.transformMat4Normal(xj,xj,wj),Ms.toArray(t,xj,e);rD(p,t,r,s,y.view.stride)}n=y.view.offset,o=0;for(let t=0;t<y.attributes.length;t++){const e=y.attributes[t];if("a_tangent"===e.name){o=e.format;break}n+=tp[e.format].size}if(o){const t=nD(p,o,n,y.view.length,y.view.stride);for(let e=0;e<t.length;e+=3)Ms.fromArray(xj,t,e),Ms.transformMat4Normal(xj,xj,wj),Ms.toArray(t,xj,e);rD(p,t,o,n,y.view.stride)}a=y.view.offset,h=0;for(let t=0;t<y.attributes.length;t++){const e=y.attributes[t];if("a_batch_uv"===e.name){h=e.format;break}a+=tp[e.format].size}h&&oD(p,((t,e)=>{var i;const s=0===e?"x":"y";return(t=(i=t)-Math.floor(i))*g[s]+m[s]}),h,a,y.view.length,y.view.stride,p);const b=u[t];if(b){l=y.view.offset,c=0;for(let t=0;t<y.attributes.length;t++){const e=y.attributes[t];if("a_joints"===e.name){c=e.format;break}l+=tp[e.format].size}c&&oD(p,(t=>b[t]),c,l,y.view.length,y.view.stride,p)}}this._mesh.merge(_)}this._onMeshChanged(this._mesh),this._updateModels()}cookTextures(t,e,i){const s=[],r=[],n=[],o=[];for(let t=0;t<this.units.length;t++){const a=this.units[t];if(!a.material)continue;const h=a.material.getProperty(e,i);if(h&&h.image&&h.image.data){const t=new t_;t.texOffset.x=a.offset.x*this.atlasSize,t.texOffset.y=a.offset.y*this.atlasSize,t.texExtent.width=a.size.x*this.atlasSize,t.texExtent.height=a.size.y*this.atlasSize;const{data:e}=h.image;ArrayBuffer.isView(e)?(n.push(e),o.push(t)):(s.push(e),r.push(t))}}const h=t.getGFXTexture(),{device:l}=a.director.root;n.length>0&&l.copyBuffersToTexture(n,h,o),s.length>0&&l.copyTexImagesToTexture(s,h,r)}createTexture(t){const e=new ff;return e.setFilters(2,2),e.setMipFilter(1),e.reset({width:this.atlasSize,height:this.atlasSize,format:35}),this._textures[t]=e,e}resizeAtlases(){for(const t in this._textures)this._textures[t].reset({width:this.atlasSize,height:this.atlasSize,format:35})}_createUnitMesh(t,e){const i=JSON.parse(JSON.stringify(e.struct)),s={};for(let t=0;t<e.struct.primitives.length;t++){const r=e.struct.primitives[t];let n=0,o=0,a=0;for(;a<r.vertexBundelIndices.length;a++){const t=e.struct.vertexBundles[r.vertexBundelIndices[a]];n=t.view.offset,o=0;for(let e=0;e<t.attributes.length;e++){const i=t.attributes[e];if("a_texCoord"===i.name){o=i.format;break}n+=tp[i.format].size}if(o)break}if(void 0!==s[a])continue;s[a]=[o,n];const h=i.vertexBundles[a];h.attributes.push(bj),h.attributes.push(vj),h.view.offset=0,h.view.length+=h.view.count*Sj,h.view.stride+=Sj}let r=0;for(let t=0;t<i.vertexBundles.length;t++)r+=i.vertexBundles[t].view.length;for(let t=0;t<i.primitives.length;t++){const e=i.primitives[t];e.indexView&&(e.indexView.offset=r,r+=e.indexView.length)}const n=new Uint8Array(r),o=e.data,h=new DataView(n.buffer),l=new DataView(o.buffer),{isLittleEndian:c}=a.sys;for(const r in s){const a=i.vertexBundles[r],u=e.struct.vertexBundles[r],[d,_]=s[r],p=nD(l,d,_,u.view.length,u.view.stride),m=u.view,g=a.view,f=m.stride,y=g.stride;let b=m.offset,v=g.offset;for(let e=0;e<g.count;e++){const i=o.subarray(b,b+f);n.set(i,v),h.setFloat32(v+f,t),h.setFloat32(v+f+4,p[2*e],c),h.setFloat32(v+f+8,p[2*e+1],c),v+=y,b+=f}}for(let t=0;t<i.primitives.length;t++){const s=e.struct.primitives[t],r=i.primitives[t];if(s.indexView&&r.indexView){const t=s.indexView.stride,e=r.indexView.stride;let i=s.indexView.offset,a=r.indexView.offset;for(let s=0;s<r.indexView.count;s++){const s=o.subarray(i,i+t);n.set(s,a),a+=e,i+=t}}}const u=new uL;return u.reset({struct:i,data:n}),u}},gj=Za(mj.prototype,"atlasSize",[vh],(function(){return 1024})),fj=Za(mj.prototype,"batchableTextureNames",[dj,vh],(function(){return[]})),yj=Za(mj.prototype,"units",[_j,vh],(function(){return[]})),s(mj.prototype,"mesh",[Yh],Object.getOwnPropertyDescriptor(mj.prototype,"mesh"),mj.prototype),s(mj.prototype,"skeleton",[Yh],Object.getOwnPropertyDescriptor(mj.prototype,"skeleton"),mj.prototype),pj=mj))||pj)||pj);var Aj,Dj,Ej,Ij,Mj,Pj,Oj,Rj,Bj,Fj,Nj,Lj,kj,zj,Uj,Vj,jj;t({SkinnedMeshBatchRenderer:Cj,BatchedSkinningModelComponent:Cj}),a.SkinningModelComponent=qV,Xt(qV,"cc.SkinningModelComponent"),a.SkinningModelUnit=Tj,Xt(Tj,"cc.SkinningModelUnit"),a.BatchedSkinningModelComponent=Cj,Xt(Cj,"cc.BatchedSkinningModelComponent");const Hj=[.25,.125,.01];let Gj=t("LOD",(Aj=ah("cc.LOD"),Dj=Xh([Tk]),Ej=Xh(We),Ij=Xh([Tk]),Mj=Xh([Ge]),Aj((Oj=class{constructor(){this._screenUsagePercentage=Rj&&Rj(),this._renderers=Bj&&Bj(),this._LODData=new zb,this._modelAddedCallback=void 0,this._LODData.screenUsagePercentage=this._screenUsagePercentage,this._modelAddedCallback=null}get screenUsagePercentage(){return this._screenUsagePercentage}set screenUsagePercentage(t){this._screenUsagePercentage=t,this._LODData.screenUsagePercentage=t}get renderers(){return this._renderers}set renderers(t){if(t===this._renderers)return;let e=!1;this._renderers.length=0,this._LODData.clearModels();for(let s=0;s<t.length;s++){var i;this._renderers[s]=t[s];const r=null==(i=t[s])?void 0:i.model;r&&(e=!0,this._LODData.addModel(r))}this._modelAddedCallback&&e&&this._modelAddedCallback()}get triangleCount(){const t=[];return this._renderers.forEach((e=>{let i=0;if(e&&e.mesh){const t=e.mesh.struct.primitives;null==t||t.forEach((t=>{t&&t.indexView&&(i+=t.indexView.count)}))}t.push(i/3)})),t}get rendererCount(){return this._renderers.length}get lodData(){return this._LODData}set modelAddedCallback(t){this._modelAddedCallback=t}insertRenderer(t,e){(t<0||t>this._renderers.length)&&(t=this._renderers.length),this._renderers.splice(t,0,e);let i=!1;return e.model&&(i=!0,this._LODData.addModel(e.model)),this._modelAddedCallback&&i&&this._modelAddedCallback(),e}deleteRenderer(t){var e;const i=this._renderers.splice(t,1),s=i.length>0?null==(e=i[0])?void 0:e.model:null;return s&&this._LODData.eraseModel(s),i[0]}getRenderer(t){return this._renderers[t]||null}setRenderer(t,e){t<0||t>=this.rendererCount?P("setRenderer to LOD error, index out of range"):(this.deleteRenderer(t),this.insertRenderer(t,e))}},Rj=Za(Oj.prototype,"_screenUsagePercentage",[vh],(function(){return 1})),Bj=Za(Oj.prototype,"_renderers",[Dj,vh],(function(){return[]})),s(Oj.prototype,"screenUsagePercentage",[Ej],Object.getOwnPropertyDescriptor(Oj.prototype,"screenUsagePercentage"),Oj.prototype),s(Oj.prototype,"renderers",[Ij],Object.getOwnPropertyDescriptor(Oj.prototype,"renderers"),Oj.prototype),s(Oj.prototype,"triangleCount",[Mj],Object.getOwnPropertyDescriptor(Oj.prototype,"triangleCount"),Oj.prototype),Pj=Oj))||Pj));t("LODGroup",(Fj=ah("cc.LODGroup"),Nj=Xh(We),Lj=Xh([Gj]),Fj((zj=class extends Km{constructor(){super(),this._localBoundaryCenter=Uj&&Uj(),this._objectSize=Vj&&Vj(),this._LODs=jj&&jj(),this._lodGroup=new Ub,this._eventRegistered=!1,this._forceUsedLevels=[]}set localBoundaryCenter(t){this._localBoundaryCenter.set(t),this._lodGroup.localBoundaryCenter=t}get localBoundaryCenter(){return this._localBoundaryCenter.clone()}get lodCount(){return this._LODs.length}set objectSize(t){this._objectSize=t,this._lodGroup.objectSize=t}get objectSize(){return this._objectSize}get LODs(){return this._LODs}set LODs(t){t!==this._LODs?(this._LODs.length=0,this.lodGroup.clearLODs(),t.forEach(((t,e)=>{this.lodGroup.insertLOD(e,t.lodData),this._LODs[e]=t,t.modelAddedCallback=this.onLodModelAddedCallback.bind(this)})),this._updateDataToScene()):this._updateDataToScene()}get lodGroup(){return this._lodGroup}onLodModelAddedCallback(){0===this.objectSize&&this.recalculateBounds()}insertLOD(t,e,i){if((t<0||t>this.lodCount)&&(t=this.lodCount),i||(i=new Gj),i.modelAddedCallback=this.onLodModelAddedCallback.bind(this),!e){const i=this.getLOD(t-1),s=this.getLOD(t);if(i&&s)e=(i.screenUsagePercentage+s.screenUsagePercentage)/2;else if(i&&!s)(e=i.screenUsagePercentage/2)>.01&&(e=.01);else if(s&&!i){e=s.screenUsagePercentage;const i=this.getLOD(t+1);s.screenUsagePercentage=(e+(i?i.screenUsagePercentage:0))/2}else e=Hj[0]}return i.screenUsagePercentage=e,this._LODs.splice(t,0,i),this._lodGroup.insertLOD(t,i.lodData),this._updateDataToScene(),this.node&&this._emitChangeNode(this.node),i}eraseLOD(t){if(t<0||t>=this.lodCount)return M("eraseLOD error, index out of range"),null;const e=this._LODs[t];return e?(this._LODs.splice(t,1),this._lodGroup.eraseLOD(t),this._updateDataToScene(),this._emitChangeNode(this.node),e):(M("eraseLOD error, LOD not exist at specified index."),null)}getLOD(t){return t<0||t>=this.lodCount?(M("getLOD error, index out of range"),null):this._LODs[t]}setLOD(t,e){t<0||t>=this.lodCount?M("setLOD error, index out of range"):(this._LODs[t]=e,e.modelAddedCallback=this.onLodModelAddedCallback.bind(this),this.lodGroup.updateLOD(t,e.lodData),this._updateDataToScene())}recalculateBounds(){const t=new Ms,e=new Ms;let i=null,s=new Ms;for(let o=0;o<this.lodCount;++o){const a=this.getLOD(o);if(a)for(let o=0;o<a.rendererCount;++o){var r,n;const h=a.getRenderer(o);if(!h)continue;null==(r=h.model)||r.updateWorldBound();let l=null==(n=h.model)?void 0:n.worldBounds;if(l){{const t=l.center,e=l.halfExtents;l=Ca.create(t.x,t.y,t.z,e.x,e.y,e.z)}l.getBoundary(t,e),i?(Ms.min(i,i,t),Ms.max(s,s,e)):(i=t.clone(),s=e.clone())}}}if(i){const t=i,e=new Ms(.5*(s.x+t.x),.5*(s.y+t.y),.5*(s.z+t.z)),r=new Ms(.5*(s.x-t.x),.5*(s.y-t.y),.5*(s.z-t.z)),[n,o]=function(t,e,i){let s,r;const n=new Array(new Ms(t.x-e.x,t.y-e.y,t.z-e.z),new Ms(t.x-e.x,t.y+e.y,t.z-e.z),new Ms(t.x+e.x,t.y+e.y,t.z-e.z),new Ms(t.x+e.x,t.y-e.y,t.z-e.z),new Ms(t.x-e.x,t.y-e.y,t.z+e.z),new Ms(t.x-e.x,t.y+e.y,t.z+e.z),new Ms(t.x+e.x,t.y+e.y,t.z+e.z),new Ms(t.x+e.x,t.y-e.y,t.z+e.z));s=n[0].transformMat4(i),r=s.clone();for(let t=1;t<8;++t){const e=n[t].transformMat4(i);s=Ms.min(s,s,e),r=Ms.max(r,r,e)}return[s,r]}(e,r,this.node.worldMatrix.clone().invert());e.set(.5*(o.x+n.x),.5*(o.y+n.y),.5*(o.z+n.z)),r.set(.5*(o.x-n.x),.5*(o.y-n.y),.5*(o.z-n.z)),this.localBoundaryCenter=e,this.objectSize=2*Math.max(r.x,r.y,r.z)}else this.localBoundaryCenter=new Ms(0,0,0),this.objectSize=0;this._emitChangeNode(this.node)}resetObjectSize(){if(1===this.objectSize)return;0===this.objectSize&&(this.objectSize=1);const t=1/this.objectSize;this.objectSize=1;for(let e=0;e<this.lodCount;++e){const i=this.getLOD(e);i&&(i.screenUsagePercentage*=t)}this._emitChangeNode(this.node)}forceLOD(t){this._forceUsedLevels=t<0?[]:[t],this.lodGroup.lockLODLevels(this._forceUsedLevels)}forceLODs(t){}onLoad(){this._lodGroup.node=this.node,this._lodGroup.objectSize=this._objectSize,this._lodGroup.localBoundaryCenter=this._localBoundaryCenter,this._eventRegistered||(this.node.on("component-removed",this._onRemove,this),this._eventRegistered=!0),this._constructLOD()}_onRemove(t){t===this&&this.onDisable()}_constructLOD(){if(this.lodCount<1){const t=Hj.length;for(let e=0;e<t;e++)this.insertLOD(e,Hj[e])}}onRestore(){this._constructLOD(),this.enabledInHierarchy&&this._attachToScene()}onEnable(){this._attachToScene(),0===this.objectSize&&this.recalculateBounds(),this.lodGroup.lockLODLevels(this._forceUsedLevels),this.lodCount>0&&this._lodGroup.lodCount<1&&this._LODs.forEach(((t,e)=>{t.lodData.screenUsagePercentage=t.screenUsagePercentage;const i=t.renderers;if(null!==i&&i.length>0)for(let e=0;e<i.length;e++){const s=t.lodData,r=i[e];s&&r&&r.model&&s.addModel(r.model)}this._lodGroup.insertLOD(e,t.lodData)}))}onDisable(){this._detachFromScene(),this.lodGroup.lockLODLevels([])}_attachToScene(){if(this.node&&this.node.scene){const t=this._getRenderScene();this._lodGroup.scene&&this._detachFromScene(),t.addLODGroup(this._lodGroup)}}_detachFromScene(){this._lodGroup.scene&&this._lodGroup.scene.removeLODGroup(this._lodGroup)}_emitChangeNode(t){}_updateDataToScene(){this._detachFromScene(),this._attachToScene()}},Uj=Za(zj.prototype,"_localBoundaryCenter",[vh],(function(){return new Ms(0,0,0)})),Vj=Za(zj.prototype,"_objectSize",[vh],(function(){return 0})),jj=Za(zj.prototype,"_LODs",[vh],(function(){return[]})),s(zj.prototype,"objectSize",[Nj],Object.getOwnPropertyDescriptor(zj.prototype,"objectSize"),zj.prototype),s(zj.prototype,"LODs",[Lj],Object.getOwnPropertyDescriptor(zj.prototype,"LODs"),zj.prototype),kj=zj))||kj));const Wj=Hy.makeMaskExclude([Hy.BitMask.UI_2D,Hy.BitMask.UI_3D,Hy.BitMask.GIZMOS,Hy.BitMask.EDITOR,Hy.BitMask.SCENE_GIZMO,Hy.BitMask.PROFILER,Hy.Enum.IGNORE_RAYCAST]);class Xj{constructor(){this._probes=[],this._useCubeModels=new Map,this._usePlanarModels=new Map,this._updateForRuntime=!0,this._dataTexture=null,this._registeredEvent=!1}set updateForRuntime(t){this._updateForRuntime=t}get updateForRuntime(){return this._updateForRuntime}registerEvent(){this._registeredEvent||(a.director.on(a.DirectorEvent.BEFORE_UPDATE,this.onUpdateProbes,this),this._registeredEvent=!0)}onUpdateProbes(){if(0===this._probes.length)return;const t=a.director.getScene();if(!t||!t.renderScene)return;const e=t.renderScene.models;for(let t=0;t<e.length;t++){const i=e[t];i.node&&i.node.layer&Wj&&(1===i.reflectionProbeType||this._isUsedBlending(i)?this.selectReflectionProbe(i):2===i.reflectionProbeType&&this.selectPlanarReflectionProbe(i))}}filterModelsForPlanarReflection(){if(0===this._probes.length)return;const t=a.director.getScene();if(!t||!t.renderScene)return;const e=t.renderScene.models;for(let t=0;t<e.length;t++){const i=e[t];i.node&&i.node.layer&Wj&&2===i.reflectionProbeType&&this.selectPlanarReflectionProbe(i)}}clearPlanarReflectionMap(t){for(const e of this._usePlanarModels.entries())e[1]===t&&this._updatePlanarMapOfModel(e[0],null,null)}register(t){-1===this._probes.indexOf(t)&&(this._probes.push(t),this.updateProbeData())}unregister(t){for(let e=0;e<this._probes.length;e++)if(this._probes[e]===t){const t=this._probes.splice(e,1);t[0]&&this._removeDependentModels(t[0]);break}this.updateProbeData()}exists(t){if(0===this._probes.length)return!1;for(let e=0;e<this._probes.length;e++)if(this._probes[e].getProbeId()===t)return!0;return!1}getNewReflectionProbeId(){let t=0;for(;;){if(!this.exists(t))return t;t++}}getProbes(){return this._probes}getProbeById(t){for(let e=0;e<this._probes.length;e++)if(this._probes[e].getProbeId()===t)return this._probes[e];return null}clearAll(){this._probes=[]}getProbeByCamera(t){for(let e=0;e<this._probes.length;e++)if(this._probes[e].camera===t)return this._probes[e];return null}updateBakedCubemap(t){const e=this._getModelsByProbe(t);if(t.cubemap){for(let i=0;i<e.length;i++){const s=e[i];this._updateCubemapOfModel(s,t)}if(t.needRefresh=!1,0===e.length)for(const e of this._useCubeModels.entries())e[0].reflectionProbeBlendId===t.getProbeId()&&this._updateBlendCubemap(e[0],t)}}updatePlanarMap(t,e){if(!t.node||!t.node.scene)return;const i=this._getModelsByProbe(t);for(let s=0;s<i.length;s++)this._updatePlanarMapOfModel(i[s],e,t);if(t.previewPlane){const i=t.previewPlane.getComponent(Tk);i&&i.updateProbePlanarMap(e)}}selectPlanarReflectionProbe(t){if(t.node&&t.worldBounds&&2===t.reflectionProbeType){for(let e=0;e<this._probes.length;e++){const i=this._probes[e];1===i.probeType&&t.node.layer&Wj&&(t.updateWorldBound(),co.aabbWithAABB(t.worldBounds,i.boundingBox)?this._usePlanarModels.set(t,i):this._usePlanarModels.has(t)&&this._usePlanarModels.get(t)===i&&(this._usePlanarModels.delete(t),this._updatePlanarMapOfModel(t,null,null)))}for(let t=0;t<this._probes.length;t++)1===this._probes[t].probeType&&(this._probes[t].realtimePlanarTexture?this.updatePlanarMap(this._probes[t],this._probes[t].realtimePlanarTexture.getGFXTexture()):this.updatePlanarMap(this._probes[t],null))}}selectReflectionProbe(t){if(t.node&&t.worldBounds&&t.node.layer&Wj){t.updateWorldBound();const e=this._getNearestProbe(t);e?this._useCubeModels.has(t)?(this._useCubeModels.get(t)!==e&&this._useCubeModels.set(t,e),e.needRefresh=!0):(this._useCubeModels.set(t,e),e.needRefresh=!0):(this._updateCubemapOfModel(t,null),this._useCubeModels.delete(t))}for(let e=0;e<this._probes.length;e++)(this._probes[e].needRefresh&&0===this._probes[e].probeType||this._isUsedBlending(t))&&this.updateBakedCubemap(this._probes[e])}updatePreviewSphere(t){if(!t||!t.previewSphere)return;const e=t.previewSphere.getComponent(Tk);e&&(e.updateProbeCubemap(t.cubemap),e.updateReflectionProbeId(t.getProbeId()))}updatePreviewPlane(t){t&&t.previewPlane&&t.previewPlane.getComponent(Tk)&&t.realtimePlanarTexture&&this.updatePlanarMap(t,t.realtimePlanarTexture.getGFXTexture())}updateProbeData(){if(0===this._probes.length)return;const t=this.getMaxProbeId(),e=t+1;this._dataTexture&&this._dataTexture.destroy();const i=new Float32Array(12*e);let s=0;for(let e=0;e<=t;e++){const t=this.getProbeById(e);if(t){if(0===t.probeType){i[s]=t.node.worldPosition.x,i[s+1]=t.node.worldPosition.y,i[s+2]=t.node.worldPosition.z,i[s+3]=0,i[s+4]=t.size.x,i[s+5]=t.size.y,i[s+6]=t.size.z,i[s+7]=0;const e=t.isRGBE()?1e3:0;i[s+8]=t.cubemap?t.cubemap.mipmapLevel+e:1+e}else i[s]=t.node.up.x,i[s+1]=t.node.up.y,i[s+2]=t.node.up.z,i[s+3]=1,i[s+4]=1,i[s+5]=1,i[s+6]=0,i[s+7]=0,i[s+8]=1;s+=12}else s+=12}const r=new Uint8Array(i.buffer),n=new Sm({_data:r,_compressed:!1,width:12,height:e,format:35});this._dataTexture=new ff,this._dataTexture.setFilters(0,0),this._dataTexture.setMipFilter(0),this._dataTexture.setWrapMode(2,2,2),this._dataTexture.image=n,this._dataTexture.uploadData(r);for(let t=0;t<this._probes.length;t++){const e=this._probes[t],i=this._getModelsByProbe(e);for(let t=0;t<i.length;t++){const e=i[t].node.getComponent(Tk);e&&e.updateReflectionProbeDataMap(this._dataTexture)}}}getMaxProbeId(){return 0===this._probes.length?-1:1===this._probes.length?this._probes[0].getProbeId():(this._probes.sort(((t,e)=>t.getProbeId()-e.getProbeId())),this._probes[this._probes.length-1].getProbeId())}getUsedReflectionProbe(t,e){if(e){if(this._usePlanarModels.has(t))return this._usePlanarModels.get(t)}else if(this._useCubeModels.has(t))return this._useCubeModels.get(t);return null}setReflectionProbe(t,e,i=null){e&&(this._useCubeModels.set(t,e),this._updateCubemapOfModel(t,e),i&&this._updateBlendProbeInfo(t,e,i))}updateProbeOfModels(){if(0===this._probes.length)return;const t=a.director.getScene();if(!t||!t.renderScene)return;const e=t.renderScene.models;for(let t=0;t<e.length;t++){const i=e[t];i.node&&i.node.layer&Wj&&(1===i.reflectionProbeType||2===i.reflectionProbeType||this._isUsedBlending(i))&&i.updateReflectionProbeId()}}_getNearestProbe(t){if(!t.node||!t.worldBounds||0===this._probes.length)return null;let e=null,i=1/0;for(const s of this._probes){if(0!==s.probeType||!s.validate()||!co.aabbWithAABB(t.worldBounds,s.boundingBox))continue;const r=Ms.distance(t.node.worldPosition,s.node.worldPosition);r<i&&(i=r,e=s)}return e}_getBlendProbe(t){if(!t||!t.node||!t.worldBounds||this._probes.length<2)return null;const e=[];for(let i=0;i<this._probes.length;i++)0===this._probes[i].probeType&&this._probes[i].validate()&&co.aabbWithAABB(t.worldBounds,this._probes[i].boundingBox)&&e.push(this._probes[i]);return e.sort(((e,i)=>Ms.distance(t.node.worldPosition,e.node.worldPosition)-Ms.distance(t.node.worldPosition,i.node.worldPosition))),e.length>1?e[1]:null}_getModelsByProbe(t){const e=[];let i=this._useCubeModels;1===t.probeType&&(i=this._usePlanarModels);for(const s of i.entries())s[1]===t&&e.push(s[0]);return e}_removeDependentModels(t){for(const e of this._useCubeModels.keys()){const i=this._useCubeModels.get(e);void 0!==i&&i===t&&(this._useCubeModels.delete(e),this.selectReflectionProbe(e))}for(const e of this._usePlanarModels.keys()){const i=this._usePlanarModels.get(e);void 0!==i&&i===t&&(this._usePlanarModels.delete(e),this.selectPlanarReflectionProbe(e))}}_updateCubemapOfModel(t,e){const i=t.node;if(!i)return;const s=i.getComponent(Tk);if(s&&(s.updateProbeCubemap(e?e.cubemap:null),s.updateReflectionProbeId(e&&e.cubemap?e.getProbeId():-1),e&&(s.updateReflectionProbeDataMap(this._dataTexture),this._isUsedBlending(t)))){const i=this._getBlendProbe(t);this._updateBlendProbeInfo(t,e,i)}}_updatePlanarMapOfModel(t,e,i){const s=t.node.getComponent(Tk);s&&(s.updateProbePlanarMap(e),i?(s.updateReflectionProbeId(i.getProbeId()),s.updateReflectionProbeDataMap(this._dataTexture)):s.updateReflectionProbeId(-1))}_isUsedBlending(t){return 3===t.reflectionProbeType||4===t.reflectionProbeType}_updateBlendProbeInfo(t,e,i){const s=t.node;if(!s)return;const r=s.getComponent(Tk);r&&(r.updateReflectionProbeBlendId(-1),4===t.reflectionProbeType&&r.updateReflectionProbeBlendWeight(this._calculateBlendWeight(t,e,i)))}_updateBlendCubemap(t,e){const i=t.node;if(!i)return;if(!this._isUsedBlending(t))return;const s=i.getComponent(Tk);s&&s.updateProbeBlendCubemap(e.cubemap)}_calculateBlendWeight(t,e,i){if(i){const s=Ms.distance(t.node.worldPosition,e.node.worldPosition),r=Ms.distance(t.node.worldPosition,i.node.worldPosition);return 1-r/(s+r)}return 3===t.reflectionProbeType?0:4===t.reflectionProbeType?this._calculateBlendOfSkybox(t.worldBounds,e.boundingBox):0}_calculateBlendOfSkybox(t,e){if(!t)return 1;const i=new Ms,s=new Ms,r=new Ms,n=new Ms;if(Ms.subtract(i,t.center,t.halfExtents),Ms.add(s,t.center,t.halfExtents),Ms.subtract(r,e.center,e.halfExtents),Ms.add(n,e.center,e.halfExtents),i.x<=n.x&&s.x>=r.x&&i.y<=n.y&&s.y>=r.y&&i.z<=n.z&&s.z>=r.z){const e=new Ms;Ms.multiplyScalar(e,t.halfExtents,2);const o=i.x+e.x<=n.x&&s.x+e.x>=r.x,a=i.x-e.x<=n.x&&s.x-e.x>=r.x,h=i.y+e.y<=n.y&&s.y+e.y>=r.y,l=i.y-e.y<=n.y&&s.y-e.y>=r.y,c=i.z+e.z<=n.z&&s.z+e.z>=r.z,u=i.z-e.z<=n.z&&s.z-e.z>=r.z,d=[];if(!o){const t=s.x-n.x;d.push(t/e.x)}if(!a){const t=Math.abs(i.x-r.x);d.push(t/e.x)}if(!h){const t=s.y-n.y;d.push(t/e.y)}if(!l){const t=Math.abs(i.y-r.y);d.push(t/e.y)}if(!c){const t=s.z-n.z;d.push(t/e.z)}if(!u){const t=Math.abs(i.z-r.z);d.push(t/e.z)}return d.length>0?(d.sort(((t,e)=>e-t)),d[0]):0}return 1}}function Yj(t){return void 0===(t=t||{}).includeNormal&&(t.includeNormal=!0),void 0===t.includeUV&&(t.includeUV=!0),t}t("ReflectionProbeManager",Xj),Xj.probeManager=void 0,Xj.probeManager=new Xj,a.internal.reflectionProbeManager=Xj.probeManager;const qj=new Ms,$j=new Ms,Kj=new Ms,Zj=new Ms,Qj=new Ms,Jj=new Ms,tH=new Ms,eH=new Ms,iH=new Ms,sH=new Ms,rH=new Ms,nH=new Ms,oH=new Ms(0,0,0),aH=new Ms(0,0,0);function hH(t=.5,e=.5,i=2,s={}){const r=.5*i,n=s.radialSegments||32,o=s.heightSegments||1,a=void 0===s.capped||s.capped,h=s.arc||2*Math.PI;let l=0;a&&(t>0&&l++,e>0&&l++);let c=(n+1)*(o+1);a&&(c+=(n+1)*l+n*l);let u=n*o*6;a&&(u+=n*l*3);const d=new Array(u),_=new Array(3*c),p=new Array(3*c),m=new Array(2*c),g=Math.max(t,e),f=new Ms(-g,-r,-g),y=new Ms(g,r,g),b=Math.sqrt(g*g+r*r);let v=0,S=0;return function(){const s=[],a=t-e,l=a*a/i*Math.sign(a);for(let t=0;t<=o;t++){const c=[],u=t/o,d=u*a+e;for(let t=0;t<=n;++t){const e=t/n,s=e*h,o=Math.sin(s),a=Math.cos(s);_[3*v]=d*o,_[3*v+1]=u*i-r,_[3*v+2]=d*a,Ms.normalize(oH,Ms.set(aH,o,-l,a)),p[3*v]=oH.x,p[3*v+1]=oH.y,p[3*v+2]=oH.z,m[2*v]=2*(1-e)%1,m[2*v+1]=u,c.push(v),++v}s.push(c)}for(let t=0;t<o;++t)for(let e=0;e<n;++e){const i=s[t][e],r=s[t+1][e],n=s[t+1][e+1],o=s[t][e+1];d[S]=i,++S,d[S]=o,++S,d[S]=r,++S,d[S]=o,++S,d[S]=n,++S,d[S]=r,++S}}(),a&&(e>0&&T(!1),t>0&&T(!0)),{positions:_,normals:p,uvs:m,indices:d,minPos:f,maxPos:y,boundingRadius:b};function T(i){const s=i?t:e,o=i?1:-1,a=v;for(let t=1;t<=n;++t)_[3*v]=0,_[3*v+1]=r*o,_[3*v+2]=0,p[3*v]=0,p[3*v+1]=o,p[3*v+2]=0,m[2*v]=.5,m[2*v+1]=.5,++v;const l=v;for(let t=0;t<=n;++t){const e=t/n*h,i=Math.cos(e),a=Math.sin(e);_[3*v]=s*a,_[3*v+1]=r*o,_[3*v+2]=s*i,p[3*v]=0,p[3*v+1]=o,p[3*v+2]=0,m[2*v]=.5-.5*a*o,m[2*v+1]=.5+.5*i,++v}for(let t=0;t<n;++t){const e=a+t,s=l+t;i?(d[S]=s+1,++S,d[S]=e,++S,d[S]=s,++S):(d[S]=e,++S,d[S]=s+1,++S,d[S]=s,++S)}}}function lH(t){return(t=Yj(t)).width=t.width||10,t.length=t.length||10,t.widthSegments=t.widthSegments||10,t.lengthSegments=t.lengthSegments||10,t}const cH=new Ms(0,0,0),uH=new Ms(0,0,0),dH=new Ms(0,0,0),_H=new Ms(0,0,0),pH=new Ms(0,0,0),mH=new Ms(0,0,0),gH=new Ms(0,0,0),fH=new Ms(0,0,0),yH=new Ms(0,0,0);function bH(t){return(t=Yj(t)).segments=64,t}var vH=Object.freeze({__proto__:null,applyDefaultGeometryOptions:Yj,box:function(t){const e=(t=t||{}).widthSegments||1,i=t.heightSegments||1,s=t.lengthSegments||1,r=(t.width||1)/2,n=(t.height||1)/2,o=(t.length||1)/2,a=[Ms.set(Qj,-r,-n,o),Ms.set(Jj,r,-n,o),Ms.set(tH,r,n,o),Ms.set(eH,-r,n,o),Ms.set(iH,r,-n,-o),Ms.set(sH,-r,-n,-o),Ms.set(rH,-r,n,-o),Ms.set(nH,r,n,-o)],h=[[2,3,1],[4,5,7],[7,6,2],[1,0,4],[1,4,2],[5,0,6]],l=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],c=[[-1,0,0,1],[-1,0,0,1],[-1,0,0,1],[-1,0,0,1],[0,0,-1,1],[0,0,1,1]],u=[],d=[],_=[],p=[],m=[],g=new Ms(-r,-n,-o),f=new Ms(r,n,o),y=Math.sqrt(r*r+n*n+o*o);function b(t,e,i){let s,r,n,o;const g=u.length/3,f=h[t],y=l[t],b=c[t];for(o=0;o<=i;o++)for(n=0;n<=e;n++)if(s=n/e,r=o/i,Ms.lerp(qj,a[f[0]],a[f[1]],s),Ms.lerp($j,a[f[0]],a[f[2]],r),Ms.subtract(Kj,$j,a[f[0]]),Ms.add(Zj,qj,Kj),u.push(Zj.x,Zj.y,Zj.z),d.push(y[0],y[1],y[2]),_.push(s,r),p.push(b[0],b[1],b[2],b[3]),n<e&&o<i){const t=e+1,i=n+o*t,s=n+(o+1)*t,r=n+1+(o+1)*t,a=n+1+o*t;m.push(g+i,g+a,g+s),m.push(g+s,g+a,g+r)}}return b(0,e,i),b(4,s,i),b(1,e,i),b(5,s,i),b(3,e,s),b(2,e,s),{positions:u,normals:d,uvs:_,tangents:p,indices:m,minPos:g,maxPos:f,boundingRadius:y}},capsule:function(t=.5,e=.5,i=2,s={}){const r=i-t-e,n=s.sides||32,o=s.heightSegments||32,a=e/i,h=r/i,l=t/i,c=Math.floor(o*a),u=Math.floor(o*l),d=Math.floor(o*h),_=r+e-i/2,p=e-i/2,m=e-i/2,g=s.arc||2*Math.PI,f=[],y=[],b=[],v=[],S=Math.max(t,e),T=new Ms(-S,-i/2,-S),w=new Ms(S,i/2,S),x=i/2;let C=0;const A=[];return function(){for(let t=0;t<=c;++t){const i=t*Math.PI/c/2,s=Math.sin(i),r=-Math.cos(i);for(let i=0;i<=n;++i){const a=2*i*Math.PI/n-Math.PI/2,h=Math.sin(a)*s,l=r,u=Math.cos(a)*s,d=i/n,_=t/o;if(f.push(h*e,l*e+m,u*e),y.push(h,l,u),b.push(d,_),t<c&&i<n){const e=n+1,s=e*t+i,r=e*(t+1)+i,o=e*(t+1)+i+1,a=e*t+i+1;v.push(s,a,r),v.push(a,o,r)}++C}}}(),function(){const i=(t-e)/r;for(let s=0;s<=d;s++){const o=[],l=s/d,c=l*(t-e)+e;for(let t=0;t<=n;++t){const e=t/n,s=l*h+a,u=e*g-g/4,d=Math.sin(u),_=Math.cos(u);f.push(c*d),f.push(l*r+p),f.push(c*_),Ms.normalize(fH,Ms.set(yH,d,-i,_)),y.push(fH.x),y.push(fH.y),y.push(fH.z),b.push(e,s),o.push(C),++C}A.push(o)}for(let t=0;t<d;++t)for(let e=0;e<n;++e){const i=A[t][e],s=A[t+1][e],r=A[t+1][e+1],n=A[t][e+1];v.push(i),v.push(n),v.push(s),v.push(n),v.push(r),v.push(s)}}(),function(){for(let e=0;e<=u;++e){const i=e*Math.PI/u/2+Math.PI/2,s=Math.sin(i),r=-Math.cos(i);for(let i=0;i<=n;++i){const a=2*i*Math.PI/n-Math.PI/2,h=Math.sin(a)*s,c=r,p=Math.cos(a)*s,m=i/n,g=e/o+(1-l);if(f.push(h*t,c*t+_,p*t),y.push(h,c,p),b.push(m,g),e<u&&i<n){const t=n+1,s=t*e+i+A[d][n]+1,r=t*(e+1)+i+A[d][n]+1,o=t*(e+1)+i+1+A[d][n]+1,a=t*e+i+1+A[d][n]+1;v.push(s,a,r),v.push(a,o,r)}}}}(),{positions:f,normals:y,uvs:b,indices:v,minPos:T,maxPos:w,boundingRadius:x}},circle:function(t){const e=bH(t).segments,i=new Array(3*(e+1));i[0]=0,i[1]=0,i[2]=0;const s=new Array(1+2*e);s[0]=0;const r=2*Math.PI/e;for(let t=0;t<e;++t){const e=r*t,n=Math.cos(e),o=Math.sin(e),a=3*(t+1);i[a+0]=n,i[a+1]=o,i[a+2]=0;const h=2*t;s[1+h]=t+1,s[1+(h+1)]=t+2}return e>0&&(s[s.length-1]=1),{positions:i,indices:s,minPos:{x:1,y:1,z:0},maxPos:{x:-1,y:-1,z:0},boundingRadius:1,primitiveMode:9}},cone:function(t=.5,e=1,i={}){return hH(0,t,e,i)},cylinder:hH,invWinding:function(t){const e=[];for(let i=0;i<t.length;i+=3)e.push(t[i],t[i+2],t[i+1]);return e},normals:function(t,e,i=1){const s=new Array(2*t.length);for(let r=0;r<t.length/3;++r){const n=3*r,o=6*r;s[o+0]=t[n+0],s[o+1]=t[n+1],s[o+2]=t[n+2],s[o+3]=t[n+0]+e[n+0]*i,s[o+4]=t[n+1]+e[n+1]*i,s[o+5]=t[n+2]+e[n+2]*i}return s},plane:function(t){const e=lH(t),{width:i,length:s,widthSegments:r,lengthSegments:n}=e,o=.5*i,a=.5*s,h=[],l=[],c=[],u=new Ms(-o,0,-a),d=new Ms(o,0,a),_=Math.sqrt(i*i+s*s);Ms.set(pH,-o,0,a),Ms.set(mH,o,0,a),Ms.set(gH,-o,0,-a);for(let t=0;t<=n;t++)for(let i=0;i<=r;i++){const s=i/r,o=t/n;if(Ms.lerp(cH,pH,mH,s),Ms.lerp(uH,pH,gH,o),Ms.subtract(dH,uH,pH),Ms.add(_H,cH,dH),h.push(_H.x,_H.y,_H.z),e.includeUV&&l.push(s,o),i<r&&t<n){const e=r+1,s=i+t*e,n=i+(t+1)*e,o=i+1+(t+1)*e,a=i+1+t*e;c.push(s,a,n),c.push(a,o,n)}}const p={positions:h,indices:c,minPos:u,maxPos:d,boundingRadius:_};if(e.includeNormal){const t=(n+1)*(r+1),e=new Array(3*t);p.normals=e;for(let i=0;i<t;++i)e[3*i+0]=0,e[3*i+1]=1,e[3*i+2]=0}return e.includeUV&&(p.uvs=l),p},quad:function(t){const e=Yj(t),i={positions:[-.5,-.5,0,-.5,.5,0,.5,.5,0,.5,-.5,0],indices:[0,3,1,3,2,1],minPos:{x:-.5,y:-.5,z:0},maxPos:{x:.5,y:.5,z:0},boundingRadius:Math.sqrt(.5)};return!1!==e.includeNormal&&(i.normals=[0,0,1,0,0,1,0,0,1,0,0,1]),!1!==e.includeUV&&(i.uvs=[0,0,0,1,1,1,1,0]),i},scale:function(t,e){var i,s,r;const n=null!==(i=e.x)&&void 0!==i?i:1,o=null!==(s=e.y)&&void 0!==s?s:1,a=null!==(r=e.z)&&void 0!==r?r:1,h=Math.floor(t.positions.length/3);for(let e=0;e<h;++e){const i=3*e,s=3*e+1,r=3*e+2;t.positions[i]*=n,t.positions[s]*=o,t.positions[r]*=a}const{minPos:l,maxPos:c}=t;if(l&&(l.x*=n,l.y*=o,l.z*=a),c&&(c.x*=n,c.y*=o,c.z*=a),l&&c){if(n<0){const t=l.x;l.x=c.x,c.x=t}if(o<0){const t=l.y;l.y=c.y,c.y=t}if(a<0){const t=l.z;l.z=c.z,c.z=t}}return void 0!==t.boundingRadius&&(t.boundingRadius*=Math.max(Math.max(Math.abs(n),Math.abs(o)),Math.abs(a))),t},sphere:function(t=.5,e={}){const i=void 0!==e.segments?e.segments:32,s=[],r=[],n=[],o=[],a=new Ms(-t,-t,-t),h=new Ms(t,t,t),l=t;for(let e=0;e<=i;++e){const a=e*Math.PI/i,h=Math.sin(a),l=-Math.cos(a);for(let a=0;a<=i;++a){const c=2*a*Math.PI/i-Math.PI/2,u=Math.sin(c)*h,d=l,_=Math.cos(c)*h,p=a/i,m=e/i;if(s.push(u*t,d*t,_*t),r.push(u,d,_),n.push(p,m),e<i&&a<i){const t=i+1,s=t*e+a,r=t*(e+1)+a,n=t*(e+1)+a+1,h=t*e+a+1;o.push(s,h,r),o.push(h,n,r)}}}return{positions:s,indices:o,normals:r,uvs:n,minPos:a,maxPos:h,boundingRadius:l}},toWavefrontOBJ:function(t,e=1){if(!t.indices||!t.uvs||!t.normals||void 0!==t.primitiveMode&&7!==t.primitiveMode)return"";const i=t.positions,s=t.uvs,r=t.normals,n=t.indices,o=t=>`${n[t]+1}/${n[t]+1}/${n[t]+1}`;let a="";for(let t=0;t<i.length;t+=3)a+=`v ${i[t]*e} ${i[t+1]*e} ${i[t+2]*e}\n`;for(let t=0;t<s.length;t+=2)a+=`vt ${s[t]} ${s[t+1]}\n`;for(let t=0;t<r.length;t+=3)a+=`vn ${r[t]} ${r[t+1]} ${r[t+2]}\n`;for(let t=0;t<n.length;t+=3)a+=`f ${o(t)} ${o(t+1)} ${o(t+2)}\n`;return a},torus:function(t=.4,e=.1,i={}){const s=i.radialSegments||32,r=i.tubularSegments||32,n=i.arc||2*Math.PI,o=[],a=[],h=[],l=[],c=new Ms(-t-e,-e,-t-e),u=new Ms(t+e,e,t+e),d=t+e;for(let i=0;i<=s;i++)for(let c=0;c<=r;c++){const u=c/r,d=i/s,_=u*n,p=d*Math.PI*2,m=(t+e*Math.cos(p))*Math.sin(_),g=e*Math.sin(p),f=(t+e*Math.cos(p))*Math.cos(_),y=Math.sin(_)*Math.cos(p),b=Math.sin(p),v=Math.cos(_)*Math.cos(p);if(o.push(m,g,f),a.push(y,b,v),h.push(u,d),c<r&&i<s){const t=r+1,e=t*i+c,s=t*(i+1)+c,n=t*(i+1)+c+1,o=t*i+c+1;l.push(e,o,s),l.push(o,n,s)}}return{positions:o,normals:a,uvs:h,indices:l,minPos:c,maxPos:u,boundingRadius:d}},translate:function(t,e){const i=e.x||0,s=e.y||0,r=e.z||0,n=Math.floor(t.positions.length/3);for(let e=0;e<n;++e){const n=3*e,o=3*e+1,a=3*e+2;t.positions[n]+=i,t.positions[o]+=s,t.positions[a]+=r}return t.minPos&&(t.minPos.x+=i,t.minPos.y+=s,t.minPos.z+=r),t.maxPos&&(t.maxPos.x+=i,t.maxPos.y+=s,t.maxPos.z+=r),t},wireframe:function(t){const e=[[0,1],[1,2],[2,0]],i=[],s={};for(let r=0;r<t.length;r+=3)for(let n=0;n<3;++n){const o=t[r+e[n][0]],a=t[r+e[n][1]],h=o>a?a<<16|o:o<<16|a;void 0===s[h]&&(s[h]=0,i.push(o,a))}return i},wireframed:function(t){const{indices:e}=t;if(!e)return t;if(t.primitiveMode&&7!==t.primitiveMode)return t;const i=[[0,1],[1,2],[2,0]],s=[],r={};for(let t=0;t<e.length;t+=3)for(let n=0;n<3;++n){const o=e[t+i[n][0]],a=e[t+i[n][1]],h=o>a?a<<16|o:o<<16|a;void 0===r[h]&&(r[h]=0,s.push(o,a))}return t.indices=s,t.primitiveMode=1,t}});t("primitives",vH);const SH=new Ms;function TH(t){return t.x=Math.abs(t.x),t.y=Math.abs(t.y),t.z=Math.abs(t.z),t}var wH,xH,CH,AH,DH,EH,IH,MH,PH,OH,RH,BH,FH,NH,LH,kH,zH,UH,VH,jH,HH,GH,WH,XH=Object.freeze({__proto__:null,CharacterTriggerEventObject:{type:"onControllerTriggerEnter",collider:null,characterController:null,impl:null},CollisionEventObject:{type:"onCollisionEnter",selfCollider:null,otherCollider:null,contacts:[],impl:null},TriggerEventObject:{type:"onTriggerEnter",selfCollider:null,otherCollider:null,impl:null},VEC3_0:SH,absolute:TH,cylinder:hH,getWrap:function(t){return t.__cc_wrapper__},maxComponent:function(t){return Math.max(t.x,Math.max(t.y,t.z))},setWrap:function(t,e){t.__cc_wrapper__=e},shrinkPositions:function(t){const e=[],i={};if(t.length>=3){e[0]=t[0],e[1]=t[1],e[2]=t[2];const s=t.length;for(let r=3;r<s;r+=3){const s=t[r],n=t[r+1],o=t[r+2],a=String(s)+String(n)+String(o),h=Gu(a,666);i[h]!==a&&(i[h]=a,e.push(s),e.push(n),e.push(o))}}return e}});const YH=Ps();t("ReflectionProbe",(wH=ah("cc.ReflectionProbe"),xH=Xh(Ms),CH=Xh(pe(Lb)),AH=Xh(pe({Low_256x256:256,Medium_512x512:512,High_768x768:768})),DH=Xh(pe(Nb)),EH=Xh(Ls),IH=Xh(Hy.BitMask),MH=Xh(gB),PH=Xh(Xe),OH=Xh(db),wH((WH=class t extends Km{constructor(...t){super(...t),this._lastSize=Ps(),this._resolution=FH&&FH(),this._clearFlag=NH&&NH(),this._backgroundColor=LH&&LH(),this._visibility=kH&&kH(),this._probeType=zH&&zH(),this._cubemap=UH&&UH(),this._size=VH&&VH(),this._sourceCamera=jH&&jH(),this._probeId=HH&&HH(),this._fastBake=GH&&GH(),this._probe=null,this._previewSphere=null,this._previewPlane=null,this._sourceCameraPos=Ps(),this._position=Ps()}set size(t){this._size.set(t),TH(this._size),this.probe.size=this._size,this.probe&&(this.probe.updateBoundingBox(),Xj.probeManager.onUpdateProbes(),Xj.probeManager.updateProbeData(),Xj.probeManager.updateProbeOfModels())}get size(){return this._size}set probeType(e){if(this.probe.probeType=e,e!==this._probeType){const i=this._size.clone(),s=Ms.equals(this._lastSize,Ms.ZERO);this._probeType=e,0===this._probeType?(s&&this._size.set(t.DEFAULT_CUBE_SIZE),this.probe.switchProbeType(e,null),Xj.probeManager.clearPlanarReflectionMap(this.probe)):(s&&this._size.set(t.DEFAULT_PLANER_SIZE),this._sourceCamera?this.probe.switchProbeType(e,this._sourceCamera.camera):M("the reflection camera is invalid, please set the reflection camera")),s||this._size.set(this._lastSize),this._lastSize.set(i),this.size=this._size}}get probeType(){return this._probeType}set resolution(t){this._resolution=t,this.probe.resolution=t}get resolution(){return this._resolution}set clearFlag(t){this._clearFlag=t,this.probe.clearFlag=this._clearFlag}get clearFlag(){return this._clearFlag}set backgroundColor(t){this._backgroundColor=t,this.probe.backgroundColor=this._backgroundColor}get backgroundColor(){return this._backgroundColor}get visibility(){return this._visibility}set visibility(t){this._visibility=t,this.probe.visibility=this._visibility}set sourceCamera(t){this._sourceCamera=t,t&&(this.visibility=t.visibility,this.clearFlag=t.clearFlags,this.backgroundColor=t.clearColor,1===this.probeType&&this.probe.switchProbeType(this.probeType,t.camera))}get sourceCamera(){return this._sourceCamera}get fastBake(){return this._fastBake}set fastBake(t){this._fastBake=t}set cubemap(t){this._cubemap=t,this.probe.cubemap=t,Xj.probeManager.onUpdateProbes()}get cubemap(){return this._cubemap}get probe(){return this._probe}set previewSphere(t){this._previewSphere=t,this.probe&&(this.probe.previewSphere=t,this._previewSphere&&Xj.probeManager.updatePreviewSphere(this.probe))}get previewSphere(){return this._previewSphere}set previewPlane(t){this._previewPlane=t,this.probe&&(this.probe.previewPlane=t,this._previewPlane&&Xj.probeManager.updatePreviewPlane(this.probe))}get previewPlane(){return this._previewPlane}onLoad(){this._createProbe()}_handleResize$(){this.probe&&this.sourceCamera&&1===this.probeType&&this.probe.renderPlanarReflection(this.sourceCamera.camera)}onEnable(){if(this._probe){const t=Xj.probeManager.getProbeById(this._probeId);null!==t&&t!==this._probe&&(this._probeId=Xj.probeManager.getNewReflectionProbeId(),this._probe.updateProbeId(this._probeId)),Xj.probeManager.register(this._probe),Xj.probeManager.onUpdateProbes(),this._probe.enable()}ma.on("window-resize",this._handleResize$,this),ma.on("fullscreen-change",this._handleResize$,this)}onDisable(){this._probe&&(Xj.probeManager.unregister(this._probe),this._probe.disable()),ma.off("window-resize",this._handleResize$,this),ma.off("fullscreen-change",this._handleResize$,this)}start(){this._sourceCamera&&1===this.probeType&&(this.probe.renderPlanarReflection(this.sourceCamera.camera),Xj.probeManager.filterModelsForPlanarReflection()),Xj.probeManager.updateProbeData(),this.node.getWorldPosition(this._position)}onDestroy(){this.probe&&this.probe.destroy()}update(t){this.probe&&(1===this.probeType&&this.sourceCamera&&(7&this.sourceCamera.node.hasChangedFlags||!this._sourceCameraPos.equals(this.sourceCamera.node.getWorldPosition()))&&(this._sourceCameraPos=this.sourceCamera.node.getWorldPosition(),this.probe.renderPlanarReflection(this.sourceCamera.camera)),1&this.node.hasChangedFlags&&(this.probe.updateBoundingBox(),Xj.probeManager.onUpdateProbes(),Xj.probeManager.updateProbeData()),this.node.getWorldPosition(YH),this._position.equals(YH)||(this._position.set(YH),this.probe.updateBoundingBox(),Xj.probeManager.updateProbeData(),Xj.probeManager.updateProbeOfModels()))}clearBakedCubemap(){this.cubemap=null,Xj.probeManager.updateBakedCubemap(this.probe),Xj.probeManager.updatePreviewSphere(this.probe)}_createProbe(){if((-1===this._probeId||Xj.probeManager.exists(this._probeId))&&(this._probeId=Xj.probeManager.getNewReflectionProbeId()),this._probe=new kb(this._probeId),this._probe){const t=new tb("ReflectionProbeCamera");t.hideFlags|=1032,this.node.scene.addChild(t),this._probe.initialize(this.node,t),this.enabled&&Xj.probeManager.register(this._probe),this._probe.resolution=this._resolution,this._probe.clearFlag=this._clearFlag,this._probe.backgroundColor=this._backgroundColor,this._probe.visibility=this._visibility,this._probe.probeType=this._probeType,this._probe.size=this._size,this._probe.cubemap=this._cubemap}}},WH.DEFAULT_CUBE_SIZE=Ps(1,1,1),WH.DEFAULT_PLANER_SIZE=Ps(5,.5,5),FH=Za((BH=WH).prototype,"_resolution",[vh],(function(){return 256})),NH=Za(BH.prototype,"_clearFlag",[vh],(function(){return 14})),LH=Za(BH.prototype,"_backgroundColor",[vh],(function(){return new Ls(0,0,0,255)})),kH=Za(BH.prototype,"_visibility",[vh],(function(){return PA})),zH=Za(BH.prototype,"_probeType",[vh],(function(){return 0})),UH=Za(BH.prototype,"_cubemap",[vh],(function(){return null})),VH=Za(BH.prototype,"_size",[vh],(function(){return Ps(1,1,1)})),jH=Za(BH.prototype,"_sourceCamera",[vh],(function(){return null})),HH=Za(BH.prototype,"_probeId",[vh],(function(){return-1})),GH=Za(BH.prototype,"_fastBake",[vh],(function(){return!1})),s(BH.prototype,"size",[xH],Object.getOwnPropertyDescriptor(BH.prototype,"size"),BH.prototype),s(BH.prototype,"probeType",[CH],Object.getOwnPropertyDescriptor(BH.prototype,"probeType"),BH.prototype),s(BH.prototype,"resolution",[AH],Object.getOwnPropertyDescriptor(BH.prototype,"resolution"),BH.prototype),s(BH.prototype,"clearFlag",[DH],Object.getOwnPropertyDescriptor(BH.prototype,"clearFlag"),BH.prototype),s(BH.prototype,"backgroundColor",[EH],Object.getOwnPropertyDescriptor(BH.prototype,"backgroundColor"),BH.prototype),s(BH.prototype,"visibility",[IH],Object.getOwnPropertyDescriptor(BH.prototype,"visibility"),BH.prototype),s(BH.prototype,"sourceCamera",[MH],Object.getOwnPropertyDescriptor(BH.prototype,"sourceCamera"),BH.prototype),s(BH.prototype,"fastBake",[PH],Object.getOwnPropertyDescriptor(BH.prototype,"fastBake"),BH.prototype),s(BH.prototype,"cubemap",[OH],Object.getOwnPropertyDescriptor(BH.prototype,"cubemap"),BH.prototype),RH=BH))||RH)),h.utils=dD;class qH{static identity(){return new qH}static clone(t){return new qH(t.a,t.b,t.c,t.d,t.tx,t.ty)}static concat(t,e,i){const s=e.a,r=e.b,n=e.c,o=e.d,a=e.tx,h=e.ty;t.a=s*i.a+r*i.c,t.b=s*i.b+r*i.d,t.c=n*i.a+o*i.c,t.d=n*i.b+o*i.d,t.tx=a*i.a+h*i.c+i.tx,t.ty=a*i.b+h*i.d+i.ty}static invert(t,e){const i=1/(e.a*e.d-e.b*e.c);t.a=i*e.d,t.b=-i*e.b,t.c=-i*e.c,t.d=i*e.a,t.tx=i*(e.c*e.ty-e.d*e.tx),t.ty=i*(e.b*e.tx-e.a*e.ty)}static fromMat4(t,e){t.a=e.m00,t.b=e.m01,t.c=e.m04,t.d=e.m05,t.tx=e.m12,t.ty=e.m13}static transformVec2(t,e,i,s){let r,n;s?(r=e,n=i):(s=i,r=e.x,n=e.y),t.x=s.a*r+s.c*n+s.tx,t.y=s.b*r+s.d*n+s.ty}static transformSize(t,e,i){t.width=i.a*e.width+i.c*e.height,t.height=i.b*e.width+i.d*e.height}static transformRect(t,e,i){const s=e.x+e.width,r=e.y+e.height,n=i.a*e.x+i.c*e.y+i.tx,o=i.b*e.x+i.d*e.y+i.ty,a=i.a*s+i.c*e.y+i.tx,h=i.b*s+i.d*e.y+i.ty,l=i.a*e.x+i.c*r+i.tx,c=i.b*e.x+i.d*r+i.ty,u=i.a*s+i.c*r+i.tx,d=i.b*s+i.d*r+i.ty,_=Math.min(n,a,l,u),p=Math.max(n,a,l,u),m=Math.min(o,h,c,d),g=Math.max(o,h,c,d);t.x=_,t.y=m,t.width=p-_,t.height=g-m}static transformObb(t,e,i,s,r,n,o=!0){const a=n.a*r.x+n.c*r.y+n.tx,h=n.b*r.x+n.d*r.y+n.ty,l=n.a*r.width,c=n.b*r.width,u=n.c*r.height,d=n.d*r.height;o?(e.x=a,e.y=h,i.x=l+a,i.y=c+h,t.x=u+a,t.y=d+h,s.x=l+u+a,s.y=c+d+h):(t.x=a,t.y=h,s.x=l+a,s.y=c+h,e.x=u+a,e.y=d+h,i.x=l+u+a,i.y=c+d+h)}constructor(t=1,e=0,i=0,s=1,r=0,n=0){this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=n}}t("AffineTransform",qH),h.AffineTransform=qH;const $H="cc.animation.",KH=Symbol("CreateEval");var ZH,QH,JH,tG,eG;ah(`${$H}EmbeddedPlayer`)((ZH=class extends qh{constructor(...t){super(...t),this.begin=QH&&QH(),this.end=JH&&JH(),this.reconciledSpeed=tG&&tG(),this.playable=eG&&eG()}},QH=Za(ZH.prototype,"begin",[vh],(function(){return 0})),JH=Za(ZH.prototype,"end",[vh],(function(){return 0})),tG=Za(ZH.prototype,"reconciledSpeed",[vh],(function(){return!1})),eG=Za(ZH.prototype,"playable",[vh],(function(){return null})),ZH));class iG{}class sG{constructor(t){this._randomAccess=t}get randomAccess(){return this._randomAccess}setTime(t){}}class rG{constructor(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get isMotionless(){return!this.isPlaying||this.isPaused}play(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(q(3912)):(this._isPlaying=!0,this.onPlay())}stop(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)}pause(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())}resume(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())}step(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()}update(t){}onPlay(){}onPause(){}onResume(){}onStop(){}onError(t){}}const nG={Default:0,Normal:1,Reverse:36,Loop:2,LoopReverse:38,PingPong:22,PingPongReverse:54};fe(nG);class oG{constructor(t){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,t&&this.set(t)}set(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex}}class aG{constructor(t){this.weight=0,this._pose=void 0,this._blendStateWriters=[],this._pose=t}destroy(){for(let t=0;t<this._blendStateWriters.length;++t)this._pose.destroyWriter(this._blendStateWriters[t]);this._blendStateWriters.length=0}createPoseWriter(t,e,i){const s=this._pose.createWriter(t,e,this,i);return this._blendStateWriters.push(s),s}}function hG(){return a.director.getAnimationManager()}const lG={PLAY:"play",STOP:"stop",PAUSE:"pause",RESUME:"resume",LASTFRAME:"lastframe",FINISHED:"finished"};fe(lG);let cG=class extends rG{get clip(){return this._clip}get name(){return this._name}get length(){return this.duration}get wrapMode(){return this._wrapMode}set wrapMode(t){var e;this._wrapMode=t,this.time=0,this.repeatCount=2&t?1/0:1,null==(e=this._clipEventEval)||e.setWrapMode(t)}get repeatCount(){return this._repeatCount}set repeatCount(t){this._repeatCount=t;const e=4&this._wrapMode,i=!(36&~this.wrapMode);this._useSimpleProcess=t===1/0&&!e&&!i}get delay(){return this._delay}set delay(t){this._delayTime=this._delay=t}get playbackRange(){return this._playbackRange}set playbackRange(t){t.max,t.min,this._playbackRange.min=Math.max(t.min,0),this._playbackRange.max=Math.min(t.max,this.duration),this._playbackDuration=this._playbackRange.max-this._playbackRange.min,this.setTime(0)}get speed(){return this._speed}set speed(t){var e;this._speed=t,null==(e=this._clipEmbeddedPlayerEval)||e.notifyHostSpeedChanged(t)}get current(){return this.getWrappedInfo(this.time).time}get ratio(){return 0===this.duration?0:this.current/this.duration}get weight(){return this._weight}set weight(t){this._weight=t,this._poseOutput&&(this._poseOutput.weight=t)}constructor(t,e=""){super(),this.duration=1,this.time=0,this.frameRate=0,this._targetNode=null,this._curveLoaded=!1,this._clip=void 0,this._speed=1,this._useSimpleProcess=!1,this._target=null,this._wrapMode=1,this._repeatCount=1,this._delay=0,this._delayTime=0,this._currentFramePlayed=!1,this._name=void 0,this._lastIterations=NaN,this._lastWrapInfo=null,this._wrappedInfo=new oG,this._allowLastFrame=!1,this._blendStateWriterHost={weight:0},this._playbackDuration=0,this._invDuration=1,this._poseOutput=null,this._weight=1,this._clipEval=void 0,this._clipEventEval=void 0,this._clipEmbeddedPlayerEval=void 0,this._doNotCreateEval=!1,this._clip=t,this._name=e||t&&t.name,this._playbackRange={min:0,max:t.duration},this._playbackDuration=t.duration,t.duration||R(`Clip ${t.name} has zero duration.`)}get curveLoaded(){return this._curveLoaded}initialize(t,e,i){if(this._curveLoaded)return;this._curveLoaded=!0,this._poseOutput&&(this._poseOutput.destroy(),this._poseOutput=null),this._clipEval&&(this._clipEval=void 0),this._clipEventEval&&(this._clipEventEval=void 0),this._clipEmbeddedPlayerEval&&(this._clipEmbeddedPlayerEval.destroy(),this._clipEmbeddedPlayerEval=void 0),this._targetNode=t;const s=this._clip;if(this.duration=s.duration,this._invDuration=1/this.duration,this._speed=s.speed,this.wrapMode=s.wrapMode,this.frameRate=s.sample,this._playbackRange.min=0,this._playbackRange.max=s.duration,this._playbackDuration=s.duration,2&~this.wrapMode?this.repeatCount=1:this.repeatCount=1/0,!this._doNotCreateEval){var r,n,o;const a=null!==(r=null!=e?e:null==(n=hG())?void 0:n.blendState)&&void 0!==r?r:null;a&&(this._poseOutput=new aG(a)),this._clipEval=s.createEvaluator({target:t,pose:null!==(o=this._poseOutput)&&void 0!==o?o:void 0,mask:i})}s.containsAnyEvent()&&(this._clipEventEval=s.createEventEvaluator(this._targetNode)),s.containsAnyEmbeddedPlayer()&&(this._clipEmbeddedPlayerEval=s.createEmbeddedPlayerEvaluator(this._targetNode),this._clipEmbeddedPlayerEval.notifyHostSpeedChanged(this._speed))}destroy(){this.isMotionless||hG().removeAnimation(this),this._poseOutput&&(this._poseOutput.destroy(),this._poseOutput=null),this._clipEval=void 0}emit(...t){hG().pushDelayEvent(this._emit,this,t)}on(t,e,i){return this._target&&this._target.isValid?this._target.on(t,e,i):null}once(t,e,i){return this._target&&this._target.isValid?this._target.once(t,e,i):null}off(t,e,i){this._target&&this._target.isValid&&this._target.off(t,e,i)}allowLastFrameEvent(t){this._allowLastFrame=t}_setEventTarget(t){this._target=t}setTime(t){this._currentFramePlayed=!1,this.time=t||0;{var e;const i=this.getWrappedInfo(t,this._wrappedInfo);null==(e=this._clipEventEval)||e.ignore(i.ratio,i.direction)}}update(t){this._delayTime>0&&(this._delayTime-=t,this._delayTime>0)||(this._currentFramePlayed?this.time+=t*this._speed:this._currentFramePlayed=!0,this._process())}sample(){const t=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(t.time),this._sampleEvents(t),this._sampleEmbeddedPlayers(t),t}onPlay(){var t;this.setTime(this._getPlaybackStart()),this._delayTime=this._delay,this._onReplayOrResume(),this.emit("play",this),null==(t=this._clipEmbeddedPlayerEval)||t.notifyHostPlay(this.current)}onStop(){var t;this.isPaused||this._onPauseOrStop(),this.emit("stop",this),null==(t=this._clipEmbeddedPlayerEval)||t.notifyHostStop()}onResume(){var t;this._onReplayOrResume(),this.emit("resume",this),null==(t=this._clipEmbeddedPlayerEval)||t.notifyHostPlay(this.current)}onPause(){var t;this._onPauseOrStop(),this.emit("pause",this),null==(t=this._clipEmbeddedPlayerEval)||t.notifyHostPause(this.current)}_sampleCurves(t){const{_poseOutput:e,_clipEval:i}=this;e&&(e.weight=this.weight),i&&i.evaluate(t)}_process(){this._useSimpleProcess?this.simpleProcess():this.process()}process(){const t=this.sample();if(this._allowLastFrame){let e;e=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new oG(t),this.repeatCount>1&&(0|t.iterations)>(0|e.iterations)&&this.emit("lastframe",this),e.set(t)}t.stopped&&(this.stop(),this.emit("finished",this))}simpleProcess(){const t=this._playbackRange.min,e=this._playbackDuration;let i=0,s=0;if(0!==e&&(i=this.time%e,i<0&&(i+=e),s=(t+i)*this._invDuration),this._sampleCurves(t+i),this._clipEventEval||this._clipEmbeddedPlayerEval){const t=this.getWrappedInfo(this.time,this._wrappedInfo);this._sampleEvents(t),this._sampleEmbeddedPlayers(t)}this._allowLastFrame&&(Number.isNaN(this._lastIterations)&&(this._lastIterations=s),(this.time>0&&this._lastIterations>s||this.time<0&&this._lastIterations<s)&&this.emit("lastframe",this),this._lastIterations=s)}_needReverse(t){const e=this.wrapMode;let i=!1;return 22&~e||(t-(0|t)==0&&t>0&&(t-=1),1&t&&(i=!i)),36&~e||(i=!i),i}getWrappedInfo(t,e){e=e||new oG;const{_playbackRange:{min:i},_playbackDuration:s}=this,r=this.repeatCount;if(0===s)return e.time=0,e.ratio=0,e.direction=1,e.stopped=!!Number.isFinite(r),e.iterations=0,e;let n=!1,o=(t-=i)>0?t/s:-t/s;if(o>=r){o=r,n=!0;let e=r-(0|r);0===e&&(e=1),t=e*s*(t>0?1:-1)}if(t>s){const e=t%s;t=0===e?s:e}else t<0&&0!=(t%=s)&&(t+=s);let a=!1;const h=4&this._wrapMode;h&&(a=this._needReverse(o));let l=a?-1:1;return this.speed<0&&(l*=-1),h&&a&&(t=s-t),e.time=i+t,e.ratio=e.time/this.duration,e.direction=l,e.stopped=n,e.iterations=o,e}_getPlaybackStart(){return this._playbackRange.min}_sampleEvents(t){var e;null==(e=this._clipEventEval)||e.sample(t.ratio,t.direction,t.iterations)}_sampleEmbeddedPlayers(t){var e;null==(e=this._clipEmbeddedPlayerEval)||e.evaluate(t.time,Math.trunc(t.iterations))}_emit(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e)}_onReplayOrResume(){hG().addAnimation(this)}_onPauseOrStop(){hG().removeAnimation(this)}};var uG,dG,_G,pG,mG,gG,fG,yG,bG,vG,SG;t("AnimationState",cG),a.AnimationState=cG,ah(`${$H}EmbeddedAnimationClipPlayable`)((uG=class extends iG{constructor(...t){super(...t),this.path=dG&&dG(),this.clip=_G&&_G()}instantiate(t){const{clip:e,path:i}=this;if(!e)return null;const s=t.getChildByPath(i);if(!s)return G(3938,i,t.getPathInHierarchy(),e.name),null;const r=new cG(e);return r.initialize(s),new TG(r)}},dG=Za(uG.prototype,"path",[vh],(function(){return""})),_G=Za(uG.prototype,"clip",[vh],(function(){return null})),uG));class TG extends sG{constructor(t){super(!0),this._animationState=void 0,this._animationState=t}destroy(){this._animationState.destroy()}play(){this._animationState.play()}pause(){this._animationState.pause()}stop(){this._animationState.stop()}setSpeed(t){this._animationState.speed=t}setTime(t){this._animationState.time=t}}ah(`${$H}EmbeddedParticleSystemPlayable`)((pG=class extends iG{constructor(...t){super(...t),this.path=mG&&mG()}instantiate(t){const e=t.getChildByPath(this.path);if(!e)return M(`Hierarchy path ${this.path} does not exists.`),null;const i=Kt("cc.ParticleSystem");if(!i)return M("Particle system is required for embedded particle system player."),null;const s=e.getComponent(i);return s?new wG(s):(M(`${this.path} does not includes a particle system component.`),null)}},mG=Za(pG.prototype,"path",[vh],(function(){return""})),pG));class wG extends sG{constructor(t){super(!1),this._particleSystem=void 0,this._particleSystem=t}destroy(){}play(){this._particleSystem.play()}pause(){this._particleSystem.stopEmitting()}stop(){this._particleSystem.stopEmitting()}setSpeed(t){this._particleSystem.simulationSpeed=t}}function xG(t){return"string"==typeof t||"number"==typeof t}let CG=ah("cc.animation.HierarchyPath")((fG=class{constructor(t){this.path=yG&&yG(),this.path=t||""}get(t){if(!(t instanceof tb))return j(3925),null;return t.getChildByPath(this.path)||(j(3926,t.name,this.path),null)}},yG=Za(fG.prototype,"path",[vh],(function(){return""})),gG=fG))||gG,AG=ah("cc.animation.ComponentPath")((vG=class{constructor(t){this.component=SG&&SG(),this.component=t||""}get(t){if(!(t instanceof tb))return j(3927),null;return t.getComponent(this.component)||(j(3928,t.name,this.component),null)}},SG=Za(vG.prototype,"component",[vh],(function(){return""})),bG=vG))||bG;var DG,EG,IG,MG,PG,OG,RG,BG,FG,NG,LG,kG,zG,UG,VG,jG,HG;const GG=Symbol("NormalizedFollow"),WG=Symbol("ConvertAsTrsPath"),XG=Symbol("TrackBinding");let YG=ah(`${$H}TrackPath`)((EG=class t{constructor(){this._paths=IG&&IG()}get length(){return this._paths.length}toProperty(t){return this._paths.push(t),this}toElement(t){return this._paths.push(t),this}toHierarchy(t){return this._paths.push(new CG(t)),this}toComponent(t){const e=new AG("string"==typeof t?t:xt(t));return this._paths.push(e),this}toCustomized(t){return this._paths.push(t),this}append(...t){const e=this._paths.concat(...t.map((t=>t._paths)));return this._paths=e,this}isPropertyAt(t){return"string"==typeof this._paths[t]}parsePropertyAt(t){return this._paths[t]}isElementAt(t){return"number"==typeof this._paths[t]}parseElementAt(t){return this._paths[t]}isHierarchyAt(t){return this._paths[t]instanceof CG}parseHierarchyAt(t){return this.isHierarchyAt(t),this._paths[t].path}isComponentAt(t){return this._paths[t]instanceof AG}parseComponentAt(t){return this.isComponentAt(t),this._paths[t].component}slice(e,i){const s=new t;return s._paths=this._paths.slice(e,i),s}trace(t,e,i){var s,r;return null!==(s=e)&&void 0!==s||(e=0),null!==(r=i)&&void 0!==r||(i=this._paths.length),this[GG](t,e,i)}[WG](){const{_paths:t}=this,e=t.length;let i,s=0,r="";for(;s<e;++s){const e=t[s];if(!(e instanceof CG))break;e.path&&(r?r+=`/${e.path}`:r=e.path)}if(s===e)return null;if(s!==e-1)return null;switch(t[s]){case"position":case"scale":case"rotation":case"eulerAngles":i=t[s];break;default:return null}return{node:r,property:i}}[GG](t,e,i){const{_paths:s}=this;let r=t;for(let t=e;t<i;++t){const e=s[t];if(xG(e)){if(!(e in r))return j(3929,e),null;r=r[e]}else r=e.get(r);if(null===r)break}return r}},IG=Za(EG.prototype,"_paths",[vh],(function(){return[]})),DG=EG))||DG,qG=ah(`${$H}TrackBinding`)(MG=xh((BG=class t{constructor(){this.path=OG&&OG(),this.proxy=RG&&RG()}parseTrsPath(){return this.proxy?null:this.path[WG]()}createRuntimeBinding(e,i,s){const{path:r,proxy:n}=this,o=r.length,a=o-1;if(0===o||!r.isPropertyAt(a)&&!r.isElementAt(a)||n){if(n){const t=r[GG](e,0,o);if(null===t)return null;const i=n.forTarget(t);if(!i)return null;const s={setValue:t=>{i.set(t)}},a=i.get;return a&&(s.getValue=()=>a.call(i)),s}return G(3921),null}{const n=r.isPropertyAt(a)?r.parsePropertyAt(a):r.parseElementAt(a),h=r[GG](e,0,o-1);if(null===h)return null;if(i&&h instanceof tb&&$G(n))return i.createPoseWriter(h,n,s);let l,c;{let e=t._animationFunctions.get(h.constructor);e||(e=new Map,t._animationFunctions.set(h.constructor,e));let i=e.get(n);i||(i={setValue:Function("value",`this.target.${n} = value;`),getValue:Function(`return this.target.${n};`)},e.set(n,i)),l=i.setValue,c=i.getValue}return{target:h,setValue:l,getValue:c}}}isMaskedOff(t){const e=this.parseTrsPath();if(!e)return!1;const i=t.joints[Symbol.iterator]();for(let t=i.next();!t.done;t=i.next()){const{value:i}=t;if(i.path===e.node)return!i.enabled}return!1}},BG._animationFunctions=new WeakMap,OG=Za((PG=BG).prototype,"path",[vh],(function(){return new YG})),RG=Za(PG.prototype,"proxy",[vh],null),MG=PG))||MG)||MG;function $G(t){return"position"===t||"rotation"===t||"scale"===t||"eulerAngles"===t}let KG=ah(`${$H}Track`)((NG=class{constructor(){this._binding=LG&&LG()}get path(){return this._binding.path}set path(t){this._binding.path=t}get proxy(){return this._binding.proxy}set proxy(t){this._binding.proxy=t}get[XG](){return this._binding}channels(){return[]}range(){const t={min:1/0,max:-1/0};for(const e of this.channels())t.min=Math.min(t.min,e.curve.rangeMin),t.max=Math.max(t.max,e.curve.rangeMax);return t}},LG=Za(NG.prototype,"_binding",[vh],(function(){return new qG})),FG=NG))||FG,ZG=ah(`${$H}Channel`)((zG=class{constructor(t){this.name="",this._curve=UG&&UG(),this._curve=t}get curve(){return this._curve}},UG=Za(zG.prototype,"_curve",[vh],null),kG=zG))||kG,QG=ah(`${$H}SingleChannelTrack`)((jG=class extends KG{constructor(){super(),this._channel=HG&&HG(),this._channel=new ZG(this.createCurve())}get channel(){return this._channel}channels(){return[this._channel]}createCurve(){throw new Error("Not impl")}[KH](){const{curve:t}=this._channel;return new JG(t)}},HG=Za(jG.prototype,"_channel",[vh],null),VG=jG))||VG;class JG{constructor(t){this._curve=t}get requiresDefault(){return!1}evaluate(t){return this._curve.evaluate(t)}}var tW,eW;const{ccclass:iW,serializable:sW}=il;iW(`${$H}RealArrayTrack`)((tW=class extends KG{constructor(...t){super(...t),this._channels=eW&&eW()}get elementCount(){return this._channels.length}set elementCount(t){const{_channels:e}=this,i=e.length;t<i?this._channels.splice(t):t>i&&this._channels.push(...Array.from({length:t-i},(()=>new ZG(new hc))))}channels(){return this._channels}[KH](){return new rW(this._channels.map((({curve:t})=>t)))}},eW=Za(tW.prototype,"_channels",[sW],(function(){return[]})),tW));class rW{constructor(t){this._curves=t,this._result=new Array(t.length).fill(0)}get requiresDefault(){return!1}evaluate(t){const{_result:e}=this,i=e.length;for(let s=0;s<i;++s)e[s]=this._curves[s].evaluate(t);return this._result}}var nW,oW,aW,hW,lW;let cW=ah("cc.animation.UniformProxyFactory")((oW=class{constructor(t,e){this.passIndex=aW&&aW(),this.uniformName=hW&&hW(),i(this,"channelIndex",lW,this),this.passIndex=e||0,this.uniformName=t||""}forTarget(t){if(!(t instanceof fv))return void j(3940,t);const{passIndex:e,uniformName:i,channelIndex:s}=this;if(e<0||e>=t.passes.length)return void j(3941,t.name,e);const r=t.passes[e],n=r.getHandle(i);if(n){if(XP(n)<26){const o=void 0===s?n:r.getHandle(i,s,13);return o?uW(r,i)?{set:t=>{r.setUniformArray(o,t)}}:{set:t=>{r.setUniform(o,t)}}:void j(3943,t.name,e,i,s)}{const t=YP(n),e=r.properties[i],s=e&&e.value?`${e.value}${JP(e.type)}`:QP(e.type);let o=iC.get(s);return o||(M(`Illegal texture default value: ${s}.`),o=iC.get("default-texture")),{set:e=>{e||(e=o);const i=e.getGFXTexture();i&&i.width&&i.height&&(r.bindTexture(t,i),e instanceof of&&r.bindSampler(t,yp.gfxDevice.getSampler(e.getSamplerInfo())))}}}}j(3942,t.name,e,i)}},aW=Za(oW.prototype,"passIndex",[vh],(function(){return 0})),hW=Za(oW.prototype,"uniformName",[vh],(function(){return""})),lW=s(oW.prototype,"channelIndex",[Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),nW=oW))||nW;function uW(t,e){for(const i of t.shaderInfo.blocks)for(const t of i.members)if(t.name===e)return t.count>1;return!1}var dW,_W,pW,mW,gW,fW,yW,bW;let vW=ah("cc.animation.MorphWeightValueProxy")((_W=class{constructor(){this.subMeshIndex=pW&&pW(),this.shapeIndex=mW&&mW()}forTarget(t){return{set:e=>{t.setWeight(e,this.subMeshIndex,this.shapeIndex)}}}},pW=Za(_W.prototype,"subMeshIndex",[vh],(function(){return 0})),mW=Za(_W.prototype,"shapeIndex",[vh],(function(){return 0})),dW=_W))||dW,SW=ah("cc.animation.MorphWeightsValueProxy")((fW=class{constructor(){this.subMeshIndex=yW&&yW()}forTarget(t){return{set:e=>{t.setWeights(e,this.subMeshIndex)}}}},yW=Za(fW.prototype,"subMeshIndex",[vh],(function(){return 0})),gW=fW))||gW,TW=ah("cc.animation.MorphWeightsAllValueProxy")(bW=class{forTarget(t){return{set:e=>{var i,s;const r=null!==(i=null==(s=t.mesh)?void 0:s.struct.primitives.length)&&void 0!==i?i:0;for(let i=0;i<r;++i)t.setWeights(e,i)}}}})||bW;var wW,xW,CW,AW,DW;function EW(t,e,i,s){var r,n,o,a,h;let l=new e,c=new e,u=new e,d=ah(t)((n=class{constructor(t,i,s){this.dataPoint=o&&o(),this.inTangent=a&&a(),this.outTangent=h&&h(),this.dataPoint=t||new e,this.inTangent=i||new e,this.outTangent=s||new e}lerp(t,e,r){const n=this.dataPoint,o=t.dataPoint;c=i(c,this.inTangent,r),u=i(u,t.outTangent,r);const a=e*e*e,h=e*e,d=a-2*h+e,_=-2*a+3*h,p=a-h;return l=i(l,n,2*a-3*h+1),l=s(l,l,c,d),l=s(l,l,o,_),l=s(l,l,u,p),l}getNoLerp(){return this.dataPoint}},o=Za(n.prototype,"dataPoint",[vh],(function(){return new e})),a=Za(n.prototype,"inTangent",[vh],(function(){return new e})),h=Za(n.prototype,"outTangent",[vh],(function(){return new e})),r=n))||r;if(e===sr){const t=d.prototype.lerp;d.prototype.lerp=function(e,i,s){const r=t.call(this,e,i,s);return sr.normalize(r,r),r}}return d}const IW=EW("cc.CubicSplineVec2Value",kr,kr.multiplyScalar,kr.scaleAndAdd),MW=EW("cc.CubicSplineVec3Value",Ms,Ms.multiplyScalar,Ms.scaleAndAdd),PW=EW("cc.CubicSplineVec4Value",ms,ms.multiplyScalar,ms.scaleAndAdd),OW=EW("cc.CubicSplineQuatValue",sr,sr.multiplyScalar,sr.scaleAndAdd);let RW=ah("cc.CubicSplineNumberValue")((xW=class{constructor(t,e,i){this.dataPoint=CW&&CW(),this.inTangent=AW&&AW(),this.outTangent=DW&&DW(),this.dataPoint=t,this.inTangent=e,this.outTangent=i}lerp(t,e,i){const s=this.dataPoint,r=t.dataPoint,n=e*e*e,o=e*e;return s*(2*n-3*o+1)+this.outTangent*i*(n-2*o+e)+r*(-2*n+3*o)+t.inTangent*i*(n-o)}getNoLerp(){return this.dataPoint}},CW=Za(xW.prototype,"dataPoint",[vh],(function(){return 0})),AW=Za(xW.prototype,"inTangent",[vh],(function(){return 0})),DW=Za(xW.prototype,"outTangent",[vh],(function(){return 0})),wW=xW))||wW;var BW;let FW=ah(`${$H}RealTrack`)(BW=class extends QG{createCurve(){return new hc}})||BW;function NW(t){return 0===t.keyFramesCount?void 0:t}var LW,kW,zW,UW;const VW=["X","Y","Z","W"];let jW=ah(`${$H}VectorTrack`)((kW=class extends KG{constructor(){super(),this._channels=zW&&zW(),this._nComponents=UW&&UW(),this._channels=new Array(4);for(let t=0;t<this._channels.length;++t){const e=new ZG(new hc);e.name=VW[t],this._channels[t]=e}}get componentsCount(){return this._nComponents}set componentsCount(t){this._nComponents=t}channels(){return this._channels}[KH](){switch(this._nComponents){default:case 2:return new HW(NW(this._channels[0].curve),NW(this._channels[1].curve));case 3:return new GW(NW(this._channels[0].curve),NW(this._channels[1].curve),NW(this._channels[2].curve));case 4:return new WW(NW(this._channels[0].curve),NW(this._channels[1].curve),NW(this._channels[2].curve),NW(this._channels[3].curve))}}},zW=Za(kW.prototype,"_channels",[vh],null),UW=Za(kW.prototype,"_nComponents",[vh],(function(){return 4})),LW=kW))||LW;class HW{constructor(t,e){this._result=new kr,this._x=t,this._y=e}get requiresDefault(){return!this._x||!this._y}evaluate(t,e){return e&&kr.copy(this._result,e),this._x&&(this._result.x=this._x.evaluate(t)),this._y&&(this._result.y=this._y.evaluate(t)),this._result}}class GW{constructor(t,e,i){this._result=new Ms,this._x=t,this._y=e,this._z=i}get requiresDefault(){return!this._x||!this._y||!this._z}evaluate(t,e){const{_x:i,_y:s,_z:r,_result:n}=this;return e&&Ms.copy(n,e),i&&(n.x=i.evaluate(t)),s&&(n.y=s.evaluate(t)),r&&(n.z=r.evaluate(t)),n}}class WW{constructor(t,e,i,s){this._result=new ms,this._x=t,this._y=e,this._z=i,this._w=s}get requiresDefault(){return!(this._x&&this._y&&this._z&&this._w)}evaluate(t,e){return e&&ms.copy(this._result,e),this._x&&(this._result.x=this._x.evaluate(t)),this._y&&(this._result.y=this._y.evaluate(t)),this._z&&(this._result.z=this._z.evaluate(t)),this._w&&(this._result.w=this._w.evaluate(t)),this._result}}var XW;let YW=ah(`${$H}QuatTrack`)(XW=class extends QG{createCurve(){return new su}[KH](){return new qW(this.channels()[0].curve)}})||XW;class qW{constructor(t){this._result=new sr,this._curve=t}get requiresDefault(){return!1}evaluate(t){return this._curve.evaluate(t,this._result),this._result}}var $W,KW,ZW;const QW=["Red","Green","Blue","Alpha"];let JW=ah(`${$H}ColorTrack`)((KW=class extends KG{constructor(){super(),this._channels=ZW&&ZW(),this._channels=new Array(4);for(let t=0;t<this._channels.length;++t){const e=new ZG(new hc);e.name=QW[t],this._channels[t]=e}}channels(){return this._channels}[KH](){return new tX(NW(this._channels[0].curve),NW(this._channels[1].curve),NW(this._channels[2].curve),NW(this._channels[3].curve))}},ZW=Za(KW.prototype,"_channels",[vh],null),$W=KW))||$W;class tX{constructor(t,e,i,s){this._result=new Ls,this._x=t,this._y=e,this._z=i,this._w=s}get requiresDefault(){return!(this._x&&this._y&&this._z&&this._w)}evaluate(t,e){return e&&Ls.copy(this._result,e),this._x&&(this._result.r=this._x.evaluate(t)),this._y&&(this._result.g=this._y.evaluate(t)),this._z&&(this._result.b=this._z.evaluate(t)),this._w&&(this._result.a=this._w.evaluate(t)),this._result}}var eX,iX,sX;const rX=["Width","Height"];let nX=ah(`${$H}SizeTrack`)((iX=class extends KG{constructor(){super(),this._channels=sX&&sX(),this._channels=new Array(2);for(let t=0;t<this._channels.length;++t){const e=new ZG(new hc);e.name=rX[t],this._channels[t]=e}}channels(){return this._channels}[KH](){return new oX(NW(this._channels[0].curve),NW(this._channels[1].curve))}},sX=Za(iX.prototype,"_channels",[vh],null),eX=iX))||eX;class oX{constructor(t,e){this._result=new Vr,this._width=t,this._height=e}get requiresDefault(){return!this._width||!this._height}evaluate(t,e){return e&&(this._result.x=e.x,this._result.y=e.y),this._width&&(this._result.width=this._width.evaluate(t)),this._height&&(this._result.height=this._height.evaluate(t)),this._result}}var aX;let hX=ah(`${$H}ObjectTrack`)(aX=class extends QG{createCurve(){return new _u}})||aX;const lX=Symbol("[[Owner]]");function cX(t){t[lX]}const uX=Symbol("CreateInstance");class dX{constructor(t){this._refs=[],this.type=t}bind(t,e,...i){return this._refs.push({fn:t,thisArg:e,args:i}),this.getValue()}get value(){return this.getValue()}set value(t){this.setValue(t);for(const{fn:e,thisArg:i,args:s}of this._refs)e.call(i,t,...s)}}var _X,pX,mX,gX;let fX=ah("cc.animation.PlainVariable")((pX=class{constructor(t){if(this._type=mX&&mX(),this._value=gX&&gX(),void 0!==t)switch(this._type=t,t){default:break;case 0:case 3:this._value=0;break;case 1:this._value=!1}}get type(){return this._type}get value(){return this._value}set value(t){this._value=t}[uX](){return new yX(this._type,this._value)}},mX=Za(pX.prototype,"_type",[vh],(function(){return 0})),gX=Za(pX.prototype,"_value",[vh],(function(){return 0})),_X=pX))||_X;class yX extends dX{constructor(t,e){super(t),this._value=void 0,this._value=e}getValue(){return this._value}setValue(t){this._value=t}}var bX,vX,SX;let TX=ah("cc.animation.TriggerVariable")((vX=class{constructor(){this._flags=SX&&SX()}get type(){return 2}get value(){return!!(1&this._flags)}set value(t){t?this._flags|=1:this._flags&=-2}get resetMode(){return(6&this._flags)>>1}set resetMode(t){this._flags&=-7,this._flags|=t<<1}[uX](){return new wX(this.value,this.resetMode)}},SX=Za(vX.prototype,"_flags",[vh],(function(){return 0})),bX=vX))||bX;class wX extends dX{constructor(t,e){super(2),this.resetMode=0,this._value=void 0,this.resetMode=e,this._value=t}getValue(){return this._value}setValue(t){this._value=t}}var xX,CX,AX;let DX=ah("cc.animation.Vec3Variable")((CX=class{constructor(){this._value=AX&&AX()}get type(){return 4}get value(){return this._value}set value(t){Ms.copy(this._value,t)}[uX](){return new EX(this.value)}},AX=Za(CX.prototype,"_value",[vh],(function(){return new Ms})),xX=CX))||xX;class EX extends dX{constructor(t){super(4),this._value=new Ms,Ms.copy(this._value,t)}getValue(){return this._value}setValue(t){Ms.copy(this._value,t)}}var IX,MX,PX;let OX=ah("cc.animation.QuatVariable")((MX=class{constructor(){this._value=PX&&PX()}get type(){return 5}get value(){return this._value}set value(t){sr.copy(this._value,t)}[uX](){return new RX(this._value)}},PX=Za(MX.prototype,"_value",[vh],(function(){return new sr})),IX=MX))||IX;class RX extends dX{constructor(t){super(5),this._value=new sr,sr.copy(this._value,t)}getValue(){return this._value}setValue(t){sr.copy(this._value,t)}}function BX(t,e){let i;switch(t){case 0:case 3:case 1:i=new fX(t);break;case 2:i=new TX;break;case 4:i=new DX;break;case 5:i=new OX;break;default:throw new Error(`Unknown variable type ${t}`)}return void 0!==e&&(i.value=e),i}class FX extends Error{constructor(t){super(`${t} transition is invalid`),this.name="TransitionRejectError"}}class NX extends Error{constructor(t){super(`Graph variable ${t} is not defined`)}}class LX extends Error{constructor(t,e,i){super(`Expect graph variable ${t} to have type '${e}' instead of received '${null!=i?i:typeof i}'`)}}const kX=1,zX=-4192741,UX=[];function VX(t){return"function"==typeof t._instantiate}function jX(t){const e=t[wo];return"object"==typeof e&&!!e.mountedRoot}function HX(t){let e;if(Io(t)){if(VX(t))return a.game._isCloning=!0,e=t._instantiate(null,!0),a.game._isCloning=!1,pm(e),e;if(t instanceof a.Asset)throw new TypeError(q(6903))}return a.game._isCloning=!0,e=GX(t),a.game._isCloning=!1,pm(e),e}function GX(t,e){let i;i=t._iN$t?t._iN$t:t.constructor?new(0,t.constructor):Object.create(null),XX(t,i,e);for(let t=0,e=UX.length;t<e;++t)UX[t]._iN$t=null;return UX.length=0,i}function WX(t,e,i,s){const r=t.__values__;for(let t=0;t<r.length;t++){const n=r[t],o=e[n];if("object"==typeof o&&o){const t=i[n];t instanceof ye&&t.constructor===o.constructor?t.set(o):i[n]=o._iN$t||YX(o,s)}else i[n]=o}}function XX(t,e,i){bt(t,"_iN$t",e,!0),UX.push(t);const s=t.constructor;if(bi(s))WX(s,t,e,i);else for(const s in t){if(!t.hasOwnProperty(s)||95===s.charCodeAt(0)&&95===s.charCodeAt(1)&&"__type__"!==s&&"__prefab"!==s)continue;const r=t[s];if("object"==typeof r&&r){if(r===e)continue;e[s]=r._iN$t||YX(r,i)}else e[s]=r}Io(t)&&(e._objFlags&=zX)}function YX(t,e){if(t instanceof ye)return t.clone();if(t instanceof a.Asset)return t;let i;if(ArrayBuffer.isView(t)){const e=t.length;i=new t.constructor(e),t._iN$t=i,UX.push(t);for(let s=0;s<e;++s)i[s]=t[s];return i}if(Array.isArray(t)){const s=t.length;i=new Array(s),t._iN$t=i,UX.push(t);for(let r=0;r<s;++r){const s=t[r];i[r]="object"==typeof s&&s?s._iN$t||YX(s,e):s}return i}if(t._objFlags&kX)return null;const s=t.constructor;if(bi(s)){if(e)if(e instanceof Km){if(t instanceof tb||t instanceof Km)return t}else if(e instanceof tb)if(t instanceof tb){if(!t.isChildOf(e)&&!jX(t))return t}else if(t instanceof Km&&t.node&&!t.node.isChildOf(e))return t;i=new s}else if(s===Object)i={};else{if(s)return t;i=Object.create(null)}return XX(t,i,e),i}function qX(t){const e=t[wo];if("object"==typeof e&&e){const i=e;return null==i.clone?void 0:i.clone(t)}}var $X,KX,ZX,QX,JX,tY;HX._clone=GX,a.instantiate=HX;const eY=Symbol("[[Outgoing transitions]]"),iY=Symbol("[[Incoming transitions]]"),{ccclass:sY,serializable:rY}=il;let nY=sY("cc.animation.State")((KX=class extends qh{constructor(){super(),this.name=ZX&&ZX(),this[eY]=[],this[iY]=[]}copyTo(t){t.name=this.name,t[wo]=qX(this)}},ZX=Za(KX.prototype,"name",[rY],(function(){return""})),$X=KX))||$X,oY=sY(`${$H}InteractiveState`)((JX=class extends nY{constructor(...t){super(...t),this._components=tY&&tY()}get components(){return this._components}addComponent(t){const e=new t;return this._components.push(e),e}removeComponent(t){se(this._components,t)}instantiateComponents(){return this._components.map((t=>HX(t)))}copyTo(t){super.copyTo(t),t._components=this.instantiateComponents()}},tY=Za(JX.prototype,"_components",[rY],(function(){return[]})),QX=JX))||QX;function aY(t,e,i){const s=t.components,r=s.length;for(let t=0;t<r;++t){const r=s[t],n=r[e];"function"==typeof n&&n.apply(r,i)}}var hY,lY,cY;let uY=ah(`${$H}AnimationGraphEventBinding`)((lY=class{constructor(){this.methodName=cY&&cY()}get isBound(){return!!this.methodName}emit(t){this.methodName&&aY(t,this.methodName,[])}copyTo(t){return t.methodName=this.methodName,this}},cY=Za(lY.prototype,"methodName",[vh],(function(){return""})),hY=lY))||hY;var dY,_Y,pY,mY,gY,fY,yY,bY;let vY=ah("cc.animation.Motion")((_Y=class extends oY{constructor(...t){super(...t),this.motion=pY&&pY(),this.speed=mY&&mY(),this.speedMultiplier=gY&&gY(),this.speedMultiplierEnabled=fY&&fY(),this.transitionInEventBinding=yY&&yY(),this.transitionOutEventBinding=bY&&bY()}__callOnAfterDeserializeRecursive(){var t;null==(t=this.motion)||t.__callOnAfterDeserializeRecursive()}copyTo(t){var e,i;return super.copyTo(t),t.motion=null!==(e=null==(i=this.motion)?void 0:i.clone())&&void 0!==e?e:null,t.speed=this.speed,t.speedMultiplier=this.speedMultiplier,t.speedMultiplierEnabled=this.speedMultiplierEnabled,this.transitionInEventBinding.copyTo(t.transitionInEventBinding),this.transitionOutEventBinding.copyTo(t.transitionOutEventBinding),this}},pY=Za(_Y.prototype,"motion",[vh],(function(){return null})),mY=Za(_Y.prototype,"speed",[vh],(function(){return 1})),gY=Za(_Y.prototype,"speedMultiplier",[vh],(function(){return""})),fY=Za(_Y.prototype,"speedMultiplierEnabled",[vh],(function(){return!1})),yY=Za(_Y.prototype,"transitionInEventBinding",[vh],(function(){return new uY})),bY=Za(_Y.prototype,"transitionOutEventBinding",[vh],(function(){return new uY})),dY=_Y))||dY;const SY=Symbol("[[OnAfterDeserialized]]");var TY;let wY=ah(`${$H}AnimationGraphLike`)(TY=class extends fm{})||TY;function xY(t,e,i){const{propertyIsEnumerable:s}=Object.prototype;if(!s.call(t,e))return t;if(i in t)return t;const r={};return"symbol"==typeof e?(Object.entries(t).forEach((([t,e])=>{r[t]=e})),Object.getOwnPropertySymbols(t).forEach((n=>{s.call(t,n)&&(r[n===e?i:n]=t[n])}))):(Object.entries(t).forEach((([t,s])=>{r[t===e?i:t]=s})),Object.getOwnPropertySymbols(t).forEach((e=>{s.call(t,e)&&(r[e]=t[e])}))),r}const CY=(()=>{let t=!1;try{class e{static[Symbol.hasInstance](t){return Array.isArray(t)}}t=[]instanceof e}catch{t=!1}return t?t=>{function e(){throw new Error("This function can not be called as a constructor.")}return Object.defineProperty(e,Symbol.hasInstance,{value:e=>e instanceof t}),e}:t=>t})();var AY,DY,EY,IY,MY,PY,OY,RY;let BY=ah(`${$H}PoseGraphNodeShell`)((DY=class extends qh{constructor(...t){super(...t),this._bindings=EY&&EY()}getBindings(){return this._bindings}addBinding(t,e,i){this._emplaceBinding(new NY(t,e,i))}deleteBinding(t){const e=this._findBindingIndex(t);e>=0&&this._bindings.splice(e,1)}moveArrayElementBindingForward(t,e,i){const{_bindings:s}=this,r=[];for(let i=0;i<s.length;++i){const n=s[i],[o,a=-1]=n.inputPath;o===t&&a>=e&&(r.push(n),s.splice(i,1))}for(const t of r){const[e,s=-1]=t.inputPath;this.addBinding([e,s+(i?-1:1)],t.producer,t.outputIndex)}}deleteBindingTo(t){const{_bindings:e}=this;for(let i=0;i<e.length;++i)e[i].producer===t&&e.splice(i,1)}findBinding(t){const e=this._findBindingIndex(t);return e>=0?this._bindings[e]:void 0}_findBindingIndex(t){return this._bindings.findIndex((e=>FY(e.inputPath,t)))}_emplaceBinding(t){const e=this._bindings.findIndex((e=>FY(e.inputPath,t.inputPath)));e>=0?this._bindings[e]=t:this._bindings.push(t)}},EY=Za(DY.prototype,"_bindings",[vh],(function(){return[]})),AY=DY))||AY;function FY(t,e){const[i,s]=t,[r,n]=e;return i===r&&s===n}let NY=ah(`${$H}PoseGraphNodeInputBinding`)((MY=class{constructor(t,e,i){this._inputPath=PY&&PY(),this._producer=OY&&OY(),this._outputIndex=RY&&RY(),this._inputPath=t,this._producer=e,void 0!==i&&(this._outputIndex=i)}get inputPath(){return this._inputPath}get producer(){return this._producer}get outputIndex(){return this._outputIndex}},PY=Za(MY.prototype,"_inputPath",[vh],null),OY=Za(MY.prototype,"_producer",[vh],null),RY=Za(MY.prototype,"_outputIndex",[vh],(function(){return 0})),IY=MY))||IY;class LY extends Error{constructor(t){super(`Can not add the specified ${t.toString()} since it has already been added into another graph.`)}}class kY extends Error{constructor(t){super(`Can not perform specified operation on ${t.toString()} since it has not been added in to graph.`)}}class zY extends qh{}const UY=new WeakMap;function VY(t){const e=UY.get(t);if(e)return e;{const e={};return UY.set(t,e),e}}function jY(t){return e=>{if(!kt(e,zY)&&(P("This kind of decorator should only be applied to pose graph node classes."),1))return;const i=VY(e);t(i)}}const HY=t=>jY((e=>{var i;Object.assign(null!==(i=e.appearance)&&void 0!==i?i:e.appearance={},t)}));function GY(t,e,i,s){const r=t.getShell(e);if(!r)throw new kY(e);const[n,o=-1]=i,a=e[n];Array.isArray(a)&&(a.splice(o,0,s),r.moveArrayElementBindingForward(n,o+1,!1))}function WY(t,e,i){const s=t.getShell(e);if(!s)throw new kY(e);const[r,n=-1]=i,o=e[r];Array.isArray(o)&&(n<0||n>=o.length||(s.deleteBinding(i),o.splice(n,1),s.moveArrayElementBindingForward(r,n+1,!0)))}function XY(t){switch(t){default:case 0:case 1:return 0;case 2:return!1;case 5:return null;case 3:return new Ms;case 4:return new sr}}const YY=new class{constructor(){this._classInputMap=new WeakMap}setPropertyNodeInputRecord(t,e,i){let s=this._classInputMap.get(t);s||(s={properties:{}},this._classInputMap.set(t,s));const{arraySyncGroup:r,...n}=i,o=n,a=i.arraySyncGroup;if(a){var h,l;s.arraySyncGroups||(s.arraySyncGroups={});const t=null!==(l=(h=s.arraySyncGroups)[a])&&void 0!==l?l:h[a]={members:[]};t.members.includes(e)||t.members.push(e),o.arraySyncGroup=t}s.properties[e]=Object.freeze(o)}getInputKeys(t){const e=[],i=s=>{if(!s)return;i(Lt(s));const r=this._classInputMap.get(s);if(r)for(const[i]of Object.entries(r.properties)){if(e.findIndex((([t])=>i===t))>=0)continue;const s=t[i];if(Array.isArray(s))for(let t=0;t<s.length;++t)e.push([i,t]);else e.push([i])}};return i(t.constructor),e}isPoseInput(t,e){const[i]=e,s=this._getPropertyNodeInputRecord(t.constructor,i);return!!s&&5===s.type}getInputMetadata(t,e){const[i,s=-1]=e,r=this._getPropertyNodeInputRecord(t.constructor,i);if(!r)return;const n=t[i];if(Array.isArray(n)){if(s<0||s>=n.length)return;{var o,a;const e=null!==(o=null==(a=r.getArrayElementDisplayName)?void 0:a.call(t,s))&&void 0!==o?o:r.displayName;return{type:r.type,displayName:e,deletable:!(r.arraySyncGroup&&r.arraySyncGroupFollower),insertPoint:!0}}}return{type:r.type,displayName:r.displayName}}hasInput(t,e){const[i,s=-1]=e;if(!this._getPropertyNodeInputRecord(t.constructor,i))return!1;const r=t[i];return!Array.isArray(r)||!(s<0||s>=r.length)}getInputInsertInfos(t){const e={};for(let i=t.constructor;i;i=Lt(i)){const s=this._classInputMap.get(i);if(s)for(const i in s.properties){const r=s.properties[i],n=t[i];if(Array.isArray(n)){if(r.arraySyncGroup&&r.arraySyncGroupFollower)continue;e[i]={displayName:i}}}}return e}deleteInput(t,e,i){const[s,r=-1]=i,n=this._getPropertyNodeInputRecord(e.constructor,s);if(!n)return;const o=e[s];if(Array.isArray(o)&&!(r<0||r>=o.length)){{const{arraySyncGroup:i}=n;if(i)return void this._deleteInputInArraySyncGroup(t,e,i,o.length,r)}WY(t,e,i)}}insertInput(t,e,i){const s=i,r=this._getPropertyNodeInputRecord(e.constructor,s);if(!r)return;const n=e[s];if(!Array.isArray(n))return;const o=n.length;{const{arraySyncGroup:i}=r;if(i)return void this._insertInputInArraySyncGroup(t,e,i,n.length,o)}GY(t,e,[s,o],XY(r.type))}_getPropertyNodeInputRecord(t,e){if(!t)return;const i=this._classInputMap.get(t);if(i){const t=i.properties[e];if(t)return t}return this._getPropertyNodeInputRecord(Lt(t),e)}_insertInputInArraySyncGroup(t,e,i,s,r){for(let n=0;n<i.members.length;++n){const o=i.members[n],a=this._getPropertyNodeInputRecord(e.constructor,o),h=e[o];Array.isArray(h)&&h.length===s&&GY(t,e,[o,r],XY(a.type))}}_deleteInputInArraySyncGroup(t,e,i,s,r){for(let n=0;n<i.members.length;++n){const o=i.members[n];this._getPropertyNodeInputRecord(e.constructor,o);const a=e[o];Array.isArray(a)&&a.length===s&&WY(t,e,[o,r])}}};var qY;fe({NO:0,LOCAL:1,COMPONENT:2});let $Y=ah(`${$H}PoseNode`)(qY=class extends zY{constructor(...t){super(...t),this._dependencyEvaluation=void 0}update(t){var e;null==(e=this._dependencyEvaluation)||e.evaluate(),this.doUpdate(t)}evaluate(t,e){const i=this.doEvaluate(t),s=i._poseTransformSpace;switch(e){default:case 0:break;case 1:1===s&&t._poseTransformsSpaceComponentToLocal(i),i._poseTransformSpace;break;case 2:0===s&&t._poseTransformsSpaceLocalToComponent(i),i._poseTransformSpace}return i}static evaluateDefaultPose(t,e){switch(e){default:case 0:case 1:return t.pushDefaultedPose();case 2:return t.pushDefaultedPoseInComponentSpace()}}_setDependencyEvaluation(t){this._dependencyEvaluation=t}_forceEvaluateEvaluation(){var t;null==(t=this._dependencyEvaluation)||t.evaluate()}})||qY;class KY extends zY{constructor(t){super(),this._outputTypes=[],this._outputTypes=t}get outputCount(){return this._outputTypes.length}getOutputType(t){return this._outputTypes[t]}link(t){}}function ZY(t){return(e,i)=>{const s=e.constructor;5!==t.type||kt(s,$Y)?kt(s,$Y)||kt(s,KY)?QY(t)(e,i):P("@input can be only applied to fields of subclasses of PoseNode or PureValueNode."):P("@input specifying pose input can be only applied to fields of subclasses of PoseNode.")}}function QY(t){return(e,i)=>{if("string"!=typeof i)return void P("@input can be only applied to string-named fields.");const s=e.constructor;YY.setPropertyNodeInputRecord(s,i,t),gh(e,i).__internalFlags|=3}}var JY,tq,eq,iq,sq,rq;let nq=(JY=ah(`${$H}PoseGraphOutputNode`),tq=HY({themeColor:"#CD3A58",inline:!0}),eq=QY({type:5}),JY(iq=tq((rq=s((sq=class extends zY{constructor(...t){super(...t),i(this,"pose",rq,this)}}).prototype,"pose",[vh,eq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iq=sq))||iq)||iq);var oq,aq,hq,lq,cq,uq;let dq=ah(`${$H}PoseGraph`)((aq=class extends qh{constructor(){super(),this._outputNode=hq&&hq(),this._nodes=lq&&lq(),this._shells=cq&&cq(),this._shellMap=uq&&uq(),this.addNode(this._outputNode)}get outputNode(){return this._outputNode}__callOnAfterDeserializeRecursive(){this._nodes.length,this._shells.length;for(let t=0;t<this._nodes.length;++t){const e=this._nodes[t],i=this._shells[t];this._shellMap.set(e,i),null==e.__callOnAfterDeserializeRecursive||e.__callOnAfterDeserializeRecursive()}}nodes(){return this._nodes.values()}addNode(t){if(this._shellMap.has(t))throw new LY(t);const e=new BY;return this._shells.push(e),this._nodes.push(t),this._shellMap.set(t,e),t}removeNode(t){if(t===this._outputNode)return void P("Can not remove the output node.");const e=this._nodes.indexOf(t);if(!(e<0)){this._shellMap.has(t);for(const e of this._shells)e.deleteBindingTo(t);ee(this._shells,e),ee(this._nodes,e),this._shellMap.delete(t)}}getShell(t){return this._shellMap.get(t)}},hq=Za(aq.prototype,"_outputNode",[vh],(function(){return new nq})),lq=Za(aq.prototype,"_nodes",[vh],(function(){return[]})),cq=Za(aq.prototype,"_shells",[vh],(function(){return[]})),uq=Za(aq.prototype,"_shellMap",[vh],(function(){return new Map})),oq=aq))||oq;var _q,pq,mq,gq,fq,yq,bq,vq,Sq,Tq,wq,xq,Cq,Aq,Dq,Eq,Iq,Mq,Pq,Oq,Rq,Bq,Fq,Nq,Lq,kq,zq,Uq,Vq,jq,Hq,Gq,Wq,Xq,Yq,qq,$q,Kq,Zq,Qq,Jq,t$,e$,i$,s$,r$,n$,o$,a$,h$,l$,c$,u$,d$;let _$=ah(`${$H}Transition`)((pq=class extends qh{constructor(t,e,i){super(),this.from=mq&&mq(),this.to=gq&&gq(),this.conditions=fq&&fq(),this[lX]=void 0,this.from=t,this.to=e,i&&(this.conditions=i)}copyTo(t){t.conditions=this.conditions.map((t=>t.clone()))}},mq=Za(pq.prototype,"from",[vh],null),gq=Za(pq.prototype,"to",[vh],null),fq=Za(pq.prototype,"conditions",[vh],(function(){return[]})),_q=pq))||_q,p$=ah(`${$H}DurationalTransition`)((bq=class extends _${constructor(...t){super(...t),this.destinationStart=vq&&vq(),this.relativeDestinationStart=Sq&&Sq(),this.startEventBinding=Tq&&Tq(),this.endEventBinding=wq&&wq(),this[lX]=void 0}copyTo(t){super.copyTo(t),t.destinationStart=this.destinationStart,t.relativeDestinationStart=this.relativeDestinationStart,this.startEventBinding.copyTo(t.startEventBinding),this.endEventBinding.copyTo(t.endEventBinding)}},vq=Za(bq.prototype,"destinationStart",[vh],(function(){return 0})),Sq=Za(bq.prototype,"relativeDestinationStart",[vh],(function(){return!1})),Tq=Za(bq.prototype,"startEventBinding",[vh],(function(){return new uY})),wq=Za(bq.prototype,"endEventBinding",[vh],(function(){return new uY})),yq=bq))||yq,m$=ah(`${$H}AnimationTransition`)((Cq=class extends p${constructor(...t){super(...t),this.duration=Aq&&Aq(),this.relativeDuration=Dq&&Dq(),this.exitConditionEnabled=Eq&&Eq(),this._exitCondition=Iq&&Iq()}get exitCondition(){return this._exitCondition}set exitCondition(t){this._exitCondition=t}copyTo(t){super.copyTo(t),t.duration=this.duration,t.relativeDuration=this.relativeDuration,t.exitConditionEnabled=this.exitConditionEnabled,t.exitCondition=this.exitCondition}},Aq=Za(Cq.prototype,"duration",[vh],(function(){return.3})),Dq=Za(Cq.prototype,"relativeDuration",[vh],(function(){return!1})),Eq=Za(Cq.prototype,"exitConditionEnabled",[vh],(function(){return!0})),Iq=Za(Cq.prototype,"_exitCondition",[vh],(function(){return 1})),xq=Cq))||xq;function g$(t){return t instanceof m$}let f$=ah(`${$H}EmptyState`)(Mq=class extends nY{})||Mq,y$=ah(`${$H}EmptyStateTransition`)((Oq=class extends p${constructor(...t){super(...t),this.duration=Rq&&Rq()}copyTo(t){super.copyTo(t),t.duration=this.duration}},Rq=Za(Oq.prototype,"duration",[vh],(function(){return.3})),Pq=Oq))||Pq,b$=ah(`${$H}ProceduralPoseState`)((Fq=class extends nY{constructor(...t){super(...t),this.graph=Nq&&Nq(),this.transitionInEventBinding=Lq&&Lq(),this.transitionOutEventBinding=kq&&kq()}__callOnAfterDeserializeRecursive(){this.graph.__callOnAfterDeserializeRecursive()}copyTo(t){return super.copyTo(t),this.transitionInEventBinding.copyTo(t.transitionInEventBinding),this.transitionOutEventBinding.copyTo(t.transitionOutEventBinding),this}},Nq=Za(Fq.prototype,"graph",[vh],(function(){return new dq})),Lq=Za(Fq.prototype,"transitionInEventBinding",[vh],(function(){return new uY})),kq=Za(Fq.prototype,"transitionOutEventBinding",[vh],(function(){return new uY})),Bq=Fq))||Bq;const v$=CY(b$);let S$=ah(`${$H}ProceduralPoseTransition`)((Uq=class extends p${constructor(...t){super(...t),this.duration=Vq&&Vq()}copyTo(t){super.copyTo(t),t.duration=this.duration}},Vq=Za(Uq.prototype,"duration",[vh],(function(){return.3})),zq=Uq))||zq;const T$=CY(S$);let w$=ah("cc.animation.StateMachine")((Hq=class t extends qh{__callOnAfterDeserializeRecursive(){this[SY]();const t=this._states.length;for(let e=0;e<t;++e){const t=this._states[e];t instanceof x$?t.stateMachine.__callOnAfterDeserializeRecursive():(t instanceof b$||t instanceof vY)&&t.__callOnAfterDeserializeRecursive()}}constructor(t){super(),this._states=Gq&&Gq(),this._transitions=Wq&&Wq(),this._entryState=Xq&&Xq(),this._exitState=Yq&&Yq(),this._anyState=qq&&qq(),this._allowEmptyStates=!0,this._allowEmptyStates=null!=t&&t,this._entryState=this._addState(new nY),this._entryState.name="Entry",this._exitState=this._addState(new nY),this._exitState.name="Exit",this._anyState=this._addState(new nY),this._anyState.name="Any"}[SY](){this._states.forEach((()=>{})),this._transitions.forEach((t=>{t.from[eY].push(t),t.to[iY].push(t)}))}get allowEmptyStates(){return this._allowEmptyStates}get entryState(){return this._entryState}get exitState(){return this._exitState}get anyState(){return this._anyState}states(){return this._states}transitions(){return this._transitions}getTransitionsBetween(t,e){return cX(t),cX(e),t[eY].filter((t=>t.to===e))}getOutgoings(t){return cX(t),t[eY]}getIncomings(t){return cX(t),t[iY]}addMotion(){return this._addState(new vY)}addSubStateMachine(){return this._addState(new x$(this._allowEmptyStates))}addEmpty(){if(!this._allowEmptyStates)throw new Error("Empty states are now allowed in this state machine.");return this._addState(new f$)}addProceduralPoseState(){return this._addState(new b$)}remove(t){cX(t),t!==this.entryState&&t!==this.exitState&&t!==this.anyState&&(this.eraseTransitionsIncludes(t),se(this._states,t))}connect(t,e,i){if(cX(t),cX(e),e===this.entryState)throw new FX("to-entry");if(e===this.anyState)throw new FX("to-any");if(t===this.exitState)throw new FX("from-exit");const s=t instanceof vY||t===this._anyState?new m$(t,e,i):t instanceof f$?new y$(t,e,i):t instanceof b$?new S$(t,e,i):new _$(t,e,i);return this._transitions.push(s),t[eY].push(s),e[iY].push(s),s}disconnect(t,e){cX(t),cX(e);const i=t[eY],s=e[iY],r=this._transitions,n=i.filter((t=>t.to===e)),o=n.length;for(let t=0;t<o;++t){const e=n[t];se(i,e),se(r,e),ne(s,(t=>t===e))}}removeTransition(t){se(this._transitions,t),ne(t.from[eY],(e=>e===t)),ne(t.to[iY],(e=>e===t))}eraseOutgoings(t){cX(t);const e=t[eY];for(let t=0;t<e.length;++t){const i=e[t],s=i.to;se(this._transitions,i),ne(s[iY],(t=>t===i))}e.length=0}eraseIncomings(t){cX(t);const e=t[iY];for(let t=0;t<e.length;++t){const i=e[t],s=i.from;se(this._transitions,i),ne(s[eY],(t=>t===i))}e.length=0}eraseTransitionsIncludes(t){this.eraseIncomings(t),this.eraseOutgoings(t)}adjustTransitionPriority(t,e){const{from:i}=t;if(0===e)return;const s=i[eY],r=s.indexOf(t),n=Ri(r+e,0,s.length-1);{const{_transitions:e}=this;let i=e.indexOf(t);if(n>r)for(let t=r+1;t<=n;++t){const r=s[t],n=e.indexOf(r);e[i]=r,i=n}else if(r>n)for(let t=r-1;t>=n;--t){const r=s[t],n=e.indexOf(r);e[i]=r,i=n}e[i]=t}Wu(s,r,n)}copyTo(t){const e=t._states.filter((e=>{switch(e){case t._entryState:case t._exitState:case t._anyState:return!0;default:return!1}}));for(const i of e)t.remove(i);const i=new Map;for(const e of this._states)switch(e){case this._entryState:i.set(e,t._entryState);break;case this._exitState:i.set(e,t._exitState);break;case this._anyState:i.set(e,t._anyState);break;default:if(e instanceof vY||e instanceof x$||e instanceof f$||e instanceof b$){if(e instanceof f$&&!t._allowEmptyStates)continue;const s=HX(e);t._addState(s),i.set(e,s)}}for(const e of this._transitions){if(!t._allowEmptyStates&&(e.from instanceof f$||e.to instanceof f$))continue;const s=i.get(e.from),r=i.get(e.to),n=t.connect(s,r);n.conditions=e.conditions.map((t=>t.clone())),e.copyTo(n)}}clone(){const e=new t(this._allowEmptyStates);return this.copyTo(e),e}_addState(t){return this._states.push(t),t}},Gq=Za(Hq.prototype,"_states",[vh],(function(){return[]})),Wq=Za(Hq.prototype,"_transitions",[vh],(function(){return[]})),Xq=Za(Hq.prototype,"_entryState",[vh],null),Yq=Za(Hq.prototype,"_exitState",[vh],null),qq=Za(Hq.prototype,"_anyState",[vh],null),jq=Hq))||jq,x$=ah("cc.animation.SubStateMachine")((Kq=class extends oY{constructor(t){super(),this._stateMachine=Zq&&Zq(),this._stateMachine=new w$(t)}get stateMachine(){return this._stateMachine}copyTo(t){super.copyTo(t),this._stateMachine.copyTo(t._stateMachine)}},Zq=Za(Kq.prototype,"_stateMachine",[vh],null),$q=Kq))||$q,C$=ah(`${$H}PoseGraphStash`)((Jq=class extends qh{constructor(...t){super(...t),this.graph=t$&&t$()}},t$=Za(Jq.prototype,"graph",[vh],(function(){return new dq})),Qq=Jq))||Qq,A$=ah("cc.animation.Layer")((i$=class{__callOnAfterDeserializeRecursive(){this.stateMachine._allowEmptyStates=!0,this.stateMachine.__callOnAfterDeserializeRecursive();for(const t in this._stashes)this._stashes[t].graph.__callOnAfterDeserializeRecursive()}stashes(){return Object.entries(this._stashes)}getStash(t){return this._stashes[t]}addStash(t){return this._stashes[t]=new C$}removeStash(t){delete this._stashes[t]}renameStash(t,e){this._stashes=xY(this._stashes,t,e)}constructor(){this[lX]=void 0,this._stateMachine=s$&&s$(),this.name=r$&&r$(),this.weight=n$&&n$(),this.mask=o$&&o$(),this.additive=a$&&a$(),this._stashes=h$&&h$(),this._stateMachine=new w$(!0)}get stateMachine(){return this._stateMachine}},s$=Za(i$.prototype,"_stateMachine",[vh],null),r$=Za(i$.prototype,"name",[vh],(function(){return""})),n$=Za(i$.prototype,"weight",[vh],(function(){return 1})),o$=Za(i$.prototype,"mask",[vh],(function(){return null})),a$=Za(i$.prototype,"additive",[vh],(function(){return!1})),h$=Za(i$.prototype,"_stashes",[vh],(function(){return{}})),e$=i$))||e$,D$=ah("cc.animation.AnimationGraph")((c$=class extends wY{constructor(){super(),this._layers=u$&&u$(),this._variables=d$&&d$()}onLoaded(){const{_layers:t}=this,e=t.length;for(let i=0;i<e;++i)t[i].__callOnAfterDeserializeRecursive()}get layers(){return this._layers}get variables(){return Object.entries(this._variables)}addLayer(){const t=new A$;return this._layers.push(t),t}removeLayer(t){ee(this._layers,t)}moveLayer(t,e){Wu(this._layers,t,e)}addVariable(t,e,i){const s=BX(e,i);return this._variables[t]=s,s}removeVariable(t){delete this._variables[t]}getVariable(t){return this._variables[t]}renameVariable(t,e){this._variables=xY(this._variables,t,e)}},u$=Za(c$.prototype,"_layers",[vh],(function(){return[]})),d$=Za(c$.prototype,"_variables",[vh],(function(){return{}})),l$=c$))||l$;const E$=Symbol("[[createEval]]");var I$;let M$=ah(`${$H}MotionBase`)(I$=class extends qh{__callOnAfterDeserializeRecursive(){}})||I$;const P$=Symbol("BakeNodeCurves");class O${static getOrExtract(t){let e=O$.pool.get(t);if(!e||e.samples!==t.sample){e&&a.director.root.dataPoolManager.releaseAnimationClip(t);const i=Math.ceil(t.sample*t.duration)+1,s=t.sample;e=t[P$](0,s,i),O$.pool.set(t,e)}return e}static destroy(t){O$.pool.delete(t)}}t("SkelAnimDataHub",O$),O$.pool=new Map;class R${constructor(t){let e,i;this.ratios=void 0,this._findRatio=void 0,this.ratios=t;let s=!0;for(let r=1,n=t.length;r<n;r++)if(e=t[r]-t[r-1],1===r)i=e;else if(Math.abs(e-i)>1e-6){s=!1;break}this._findRatio=s?L$:Ga}sample(t){return this._findRatio(this.ratios,t)}}t("RatioSampler",R$),a.RatioSampler=R$;class B${static Bezier(t){return t}constructor(t,e){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=e,this._values=t.values;const i=t=>"string"==typeof t?t:Array.isArray(t)?t[0]===t[1]&&t[2]===t[3]?B$.Linear:B$.Bezier(t):B$.Linear;if(void 0!==t.easingMethod)this.type=i(t.easingMethod);else if(Array.isArray(t.easingMethods))this.types=t.easingMethods.map(i);else if(void 0!==t.easingMethods){this.types=new Array(this._values.length).fill(null);for(const e of Object.keys(t.easingMethods))this.types[e]=i(t.easingMethods[e])}else this.type=null;const s=t.values[0];(void 0===t.interpolate||t.interpolate)&&(this._lerp=k$(s)),void 0!==t._arrayLength&&(this._array=new Array(t._arrayLength))}hasLerp(){return!!this._lerp}valueAt(t){if(void 0===this._array){const e=this._values[t];return e&&e.getNoLerp?e.getNoLerp():e}for(let e=0;e<this._array.length;++e)this._array[e]=this._values[this._array.length*t+e];return this._array}valueBetween(t,e,i,s,r){if(this._lerp){const n=this.types?this.types[e]:this.type,o=r-i;let a=(t-i)/o;if(n&&(a=N$(a,n)),void 0===this._array){const t=this._values[e],i=this._values[s];return this._lerp(t,i,a,o*this._duration)}for(let t=0;t<this._array.length;++t){const i=this._values[this._array.length*e+t],r=this._values[this._array.length*s+t];this._array[t]=this._lerp(i,r,a,o*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(e);for(let t=0;t<this._array.length;++t)this._array[t]=this._values[this._array.length*e+t];return this._array}empty(){return 0===this._values.length}constant(){return 1===this._values.length}}function F$(t,e,i){let s=e.sample(i);if(s<0)if(s=~s,s<=0)s=0;else{if(!(s>=e.ratios.length))return t.valueBetween(i,s-1,e.ratios[s-1],s,e.ratios[s]);s=e.ratios.length-1}return t.valueAt(s)}function N$(t,e){if("string"==typeof e){const i=tc[e];i?t=i(t):G(3906,e)}else Array.isArray(e)&&(t=Wc(e,t));return t}function L$(t,e){const i=t.length-1;if(0===i)return 0;const s=t[0];if(e<s)return 0;const r=t[i];if(e>r)return i;const n=(e=(e-s)/(r-s))/(1/i),o=0|n,a=1e-6;return n-o<a?o:o+1-n<a?o+1:~(o+1)}t("AnimCurve",B$),B$.Linear=null,a.AnimCurve=B$,t("EventInfo",class{constructor(){this.events=[]}add(t,e){this.events.push({func:t||"",params:e||[]})}}),a.sampleAnimationCurve=F$;const k$=(()=>{function t(t){const e=new t;return(i,s,r)=>(t.lerp(e,i,s,r),e)}function e(t,e,i,s){return t.lerp(e,i,s)}function i(){const t=new sr;return(e,i,s)=>sr.slerp(t,e,i,s)}return s=>{if(null!==s){if("number"==typeof s)return Fi;if("object"==typeof s&&s.constructor){if(s instanceof sr)return i();if(s instanceof ye)return t(s.constructor);if(s.constructor===Number)return Fi;if("function"==typeof s.lerp)return e}}}})();var z$,U$,V$,j$,H$,G$;let W$=ah(`${$H}UntypedTrackChannel`)((U$=class extends ZG{constructor(){super(new hc),this.property=V$&&V$()}},V$=Za(U$.prototype,"property",[vh],(function(){return""})),z$=U$))||z$,X$=ah(`${$H}UntypedTrack`)((H$=class extends KG{constructor(...t){super(...t),this._channels=G$&&G$()}channels(){return this._channels}[KH](){throw new Error("UntypedTrack should be handled specially. Please file an issue.")}createLegacyEval(t){const e=t=>{var e;return null==(e=this._channels.find((e=>e.property===t)))?void 0:e.curve};switch(!0){default:throw new Error(q(3931));case t instanceof kr:return new HW(e("x"),e("y"));case t instanceof Ms:return new GW(e("x"),e("y"),e("z"));case t instanceof ms:return new WW(e("x"),e("y"),e("z"),e("w"));case t instanceof Ls:return new tX(e("r"),e("g"),e("b"),e("a"));case t instanceof Vr:return new oX(e("width"),e("height"))}}addChannel(t){const e=new W$;return e.property=t,this._channels.push(e),e}upgrade(t){const e=(t,e)=>{const i=this.channels().find((e=>e.property===t));i&&(e.name=i.name,e.curve.assignSorted(Array.from(i.curve.times()),Array.from(i.curve.values())))},i=t(this.path,this.proxy);switch(i){default:case"size":break;case"vec2":case"vec3":case"vec4":{const t=new jW;t.path=this.path,t.proxy=this.proxy,t.componentsCount="vec2"===i?2:"vec3"===i?3:4;const[s,r,n,o]=t.channels();switch(i){case"vec4":e("w",o);case"vec3":e("z",n);default:e("x",s),e("y",r)}return t}case"color":{const t=new JW,[i,s,r,n]=t.channels();return e("r",i),e("g",s),e("b",r),e("a",n),e("x",i),e("y",s),e("z",r),e("w",n),t}}return null}},G$=Za(H$.prototype,"_channels",[vh],(function(){return[]})),j$=H$))||j$;class Y${constructor(t){this._keys=[],this._curves=[],this._commonTargets=[],this._ratioSamplers=[],this._runtimeCurves=void 0,this._data=null,this._duration=void 0,this._duration=t}get keys(){return this._keys}set keys(t){this._keys=t}get curves(){return this._curves}set curves(t){this._curves=t,delete this._runtimeCurves}get commonTargets(){return this._commonTargets}set commonTargets(t){this._commonTargets=t}get data(){return this._data}getPropertyCurves(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves}toTracks(){const t=[],{keys:e,curves:i,commonTargets:s}=this,r=(t,e,i)=>{const s=new YG;for(const t of e)"string"==typeof t?s.toProperty(t):"number"==typeof t?s.toElement(t):t instanceof CG?s.toHierarchy(t.path):t instanceof AG?s.toComponent(t.component):s.toCustomized(t);t.path=s,t.proxy=i},n=s.map((e=>{const i=new X$;return r(i,e.modifiers,e.valueAdapter),t.push(i),i}));for(const s of i){var o;const i=s.data,a=i.values;if(0===a.length)continue;const h=i.keys<0?[0]:e[i.keys],l=a[0],c=null===(o=i.interpolate)||void 0===o||o;i._arrayLength;const u=new $$(i,h.length),d=t=>{r(t,s.modifiers,s.valueAdapter)};let _;if("number"==typeof s.commonTarget){if(!a.every((t=>"number"==typeof t))){j(3932);continue}if(s.valueAdapter||1!==s.modifiers.length||"string"!=typeof s.modifiers[0]){j(3933);continue}const t=s.modifiers[0],e=n[s.commonTarget],{curve:i}=e.addChannel(t);_=i}const p=()=>{if("number"==typeof l){if(!a.every((t=>"number"==typeof t)))return void j(3934);let e;if(_)e=_;else{const i=new FW;d(i),t.push(i),e=i.channel.curve}const i=c?0:1;return e.assignSorted(h,a.map((t=>({value:t,interpolationMode:i})))),void u.convert(e)}if("object"==typeof l)switch(!0){default:break;case q$(a,kr):case q$(a,Ms):case q$(a,ms):{const e=l instanceof kr?2:l instanceof Ms?3:4,i=new jW;d(i),i.componentsCount=e;const[{curve:s},{curve:r},{curve:n},{curve:o}]=i.channels(),_=c?0:1,p=t=>({value:t,interpolationMode:_});switch(e){case 4:o.assignSorted(h,a.map((t=>p(t.w)))),u.convert(o);case 3:n.assignSorted(h,a.map((t=>p(t.z)))),u.convert(n);default:s.assignSorted(h,a.map((t=>p(t.x)))),u.convert(s),r.assignSorted(h,a.map((t=>p(t.y)))),u.convert(r)}return void t.push(i)}case q$(a,sr):{const e=new YW;d(e);const i=c?0:1;return e.channel.curve.assignSorted(h,a.map((t=>({value:sr.clone(t),interpolationMode:i})))),u.convertQuatCurve(e.channel.curve),void t.push(e)}case q$(a,Ls):{const e=new JW;d(e);const[{curve:i},{curve:s},{curve:r},{curve:n}]=e.channels(),o=c?0:1,l=t=>({value:t,interpolationMode:o});return i.assignSorted(h,a.map((t=>l(t.r)))),u.convert(i),s.assignSorted(h,a.map((t=>l(t.g)))),u.convert(s),r.assignSorted(h,a.map((t=>l(t.b)))),u.convert(r),n.assignSorted(h,a.map((t=>l(t.a)))),u.convert(n),void t.push(e)}case q$(a,Vr):{const e=new nX;d(e);const[{curve:i},{curve:s}]=e.channels(),r=c?0:1,n=t=>({value:t,interpolationMode:r});return i.assignSorted(h,a.map((t=>n(t.width)))),u.convert(i),s.assignSorted(h,a.map((t=>n(t.height)))),u.convert(s),void t.push(e)}case q$(a,RW):{u.nil;const e=new FW;d(e);const i=c?2:1;return e.channel.curve.assignSorted(h,a.map((t=>({value:t.dataPoint,leftTangent:t.inTangent,rightTangent:t.outTangent,interpolationMode:i})))),void t.push(e)}case q$(a,IW):case q$(a,MW):case q$(a,PW):{u.nil;const e=l instanceof IW?2:l instanceof MW?3:4,i=new jW;d(i),i.componentsCount=e;const[s,r,n,o]=i.channels(),_=c?0:1,p=(t,e,i)=>({value:t,leftTangent:e,rightTangent:i,interpolationMode:_});switch(e){case 4:o.curve.assignSorted(h,a.map((t=>p(t.dataPoint.w,t.inTangent.w,t.outTangent.w))));case 3:n.curve.assignSorted(h,a.map((t=>p(t.dataPoint.z,t.inTangent.z,t.outTangent.z))));default:s.curve.assignSorted(h,a.map((t=>p(t.dataPoint.y,t.inTangent.y,t.outTangent.y)))),r.curve.assignSorted(h,a.map((t=>p(t.dataPoint.x,t.inTangent.x,t.outTangent.x))))}return void t.push(i)}case a.every((t=>t instanceof OW)):j(3935)}const e=new hX;d(e),e.channel.curve.assignSorted(h,a),t.push(e)};p()}return t}_createPropertyCurves(){this._ratioSamplers=this._keys.map((t=>new R$(t.map((t=>t/this._duration))))),this._runtimeCurves=this._curves.map((t=>({curve:new B$(t.data,this._duration),modifiers:t.modifiers,valueAdapter:t.valueAdapter,sampler:this._ratioSamplers[t.data.keys],commonTarget:t.commonTarget})))}}function q$(t,e){return t.every((t=>t instanceof e))}class $${constructor(t,e){this._easingMethods=void 0;const{easingMethods:i}=t;Array.isArray(i)?0===i.length&&0!==e?this._easingMethods=new Array(e).fill(null):this._easingMethods=i:this._easingMethods=void 0===i?new Array(e).fill(t.easingMethod):Array.from({length:e},((t,e)=>{var s;return null!==(s=i[e])&&void 0!==s?s:null}))}get nil(){return!this._easingMethods||this._easingMethods.every((t=>null==t))}convert(t){const{_easingMethods:e}=this;if(!e)return;const i=t.keyFramesCount;if(t.keyFramesCount<2)return;Array.isArray(e)&&e.length;const s=i-1;for(let i=0;i<s;++i){const s=e[i];s&&(Array.isArray(s)?J$(s,t.getKeyframeTime(i),t.getKeyframeValue(i),t.getKeyframeTime(i+1),t.getKeyframeValue(i+1)):K$(s,t,i))}}convertQuatCurve(t){const{_easingMethods:e}=this;if(!e)return;const i=t.keyFramesCount;if(t.keyFramesCount<2)return;Array.isArray(e)&&e.length;const s=i-1;for(let i=0;i<s;++i){const s=e[i];s&&(Array.isArray(s)?t.getKeyframeValue(i).easingMethod=s.slice():Z$(s,t,i))}}}function K$(t,e,i){e.keyFramesCount;const s=e.getKeyframeValue(i),r=Q$[t];1===r?s.interpolationMode=1:(s.interpolationMode=0,s.easingMethod=r)}function Z$(t,e,i){e.keyFramesCount;const s=e.getKeyframeValue(i),r=Q$[t];s.easingMethod=r}const Q$={constant:1,linear:0,quadIn:2,quadOut:3,quadInOut:4,quadOutIn:5,cubicIn:6,cubicOut:7,cubicInOut:8,cubicOutIn:9,quartIn:10,quartOut:11,quartInOut:12,quartOutIn:13,quintIn:14,quintOut:15,quintInOut:16,quintOutIn:17,sineIn:18,sineOut:19,sineInOut:20,sineOutIn:21,expoIn:22,expoOut:23,expoInOut:24,expoOutIn:25,circIn:26,circOut:27,circInOut:28,circOutIn:29,elasticIn:30,elasticOut:31,elasticInOut:32,elasticOutIn:33,backIn:34,backOut:35,backInOut:36,backOutIn:37,bounceIn:38,bounceOut:39,bounceInOut:40,bounceOutIn:41,smooth:42,fade:43};function J$(t,e,i,s,r){const[n,o,a,h]=t,{value:l}=i,{value:c}=r,u=3*(s-e),d=3*(c-l),_=n*u,p=o*d,m=(1-a)*u,g=(1-h)*d,f=1/3,y=p/_,b=Math.sqrt(_*_+p*p)*f,v=g/m,S=Math.sqrt(m*m+g*g)*f;var T;i.interpolationMode=2,i.tangentWeightMode=0===(T=i.tangentWeightMode)?2:1===T?3:T,i.rightTangent=y,i.rightTangentWeight=b,r.tangentWeightMode=tK(r.tangentWeightMode),r.leftTangent=v,r.leftTangentWeight=S}function tK(t){return 0===t?1:2===t?3:t}var eK,iK,sK,rK,nK,oK,aK,hK,lK,cK,uK,dK,_K,pK,mK,gK,fK,yK,bK,vK,SK,TK,wK,xK;const{ccclass:CK,serializable:AK}=il;function DK(){throw new Error("split() only valid in Editor.")}CK(`${$H}ExoticAnimation`)((eK=class{constructor(){this._nodeAnimations=iK&&iK()}createEvaluator(t){return new FK(this._nodeAnimations,t)}createEvaluatorForAnimationGraph(t){return new kK(this._nodeAnimations,t)}addNodeAnimation(t){const e=new EK(t);return this._nodeAnimations.push(e),e}collectAnimatedJoints(){return Array.from(new Set(this._nodeAnimations.map((({path:t})=>t))))}split(t,e){return DK()}toHashString(){return this._nodeAnimations.map((t=>t.toHashString())).join("\n")}},iK=Za(eK.prototype,"_nodeAnimations",[AK],(function(){return[]})),eK));let EK=CK(`${$H}ExoticNodeAnimation`)((rK=class{constructor(t){this._path=nK&&nK(),this._position=oK&&oK(),this._rotation=aK&&aK(),this._scale=hK&&hK(),this._path=t}createPosition(t,e){this._position=new BK(t,new OK(e))}createRotation(t,e){this._rotation=new BK(t,new RK(e))}createScale(t,e){this._scale=new BK(t,new OK(e))}createEvaluator(t){return new NK(this._path,this._position,this._rotation,this._scale,t)}createEvaluatorForAnimationGraph(t){const e=t.bindTransform(this._path);return e?new zK(e,this._position,this._rotation,this._scale):null}split(t,e,i){return DK()}get path(){return this._path}toHashString(){var t,e,i,s,r,n;return`${this._path}\n${null!==(t=null==(e=this._position)?void 0:e.toHashString())&&void 0!==t?t:""}${null!==(i=null==(s=this._scale)?void 0:s.toHashString())&&void 0!==i?i:""}${null!==(r=null==(n=this._rotation)?void 0:n.toHashString())&&void 0!==r?r:""}`}},nK=Za(rK.prototype,"_path",[AK],(function(){return""})),oK=Za(rK.prototype,"_position",[AK],(function(){return null})),aK=Za(rK.prototype,"_rotation",[AK],(function(){return null})),hK=Za(rK.prototype,"_scale",[AK],(function(){return null})),sK=rK))||sK;function IK(t){return t.toPrecision(2)}function MK(t){return t.map((t=>Number.parseFloat(IK(t)))).join(" ")}let PK=CK(`${$H}ExoticVectorLikeTrackValues`)((cK=class{constructor(t){this._values=uK&&uK(),this._isQuantized=dK&&dK(),this._values=t}get precision(){return this._isQuantized?this._values.originalPrecision:jK(this._values)}quantize(t){this._isQuantized,this._values=GK(this._values,t),this._isQuantized=!0}toHashString(){const{_isQuantized:t,_values:e}=this;return`${t} ${t?e.toHashString():MK(e)}`}},uK=Za(cK.prototype,"_values",[AK],null),dK=Za(cK.prototype,"_isQuantized",[AK],(function(){return!1})),lK=cK))||lK,OK=CK(`${$H}ExoticVec3TrackValues`)(_K=class t extends PK{static imitate(e,i){const s=new t(e);return i._isQuantized&&s.quantize(i._values.quantizationType),s}get(t,e){const{_values:i,_isQuantized:s}=this;s?YK(i,t,e):Ms.fromArray(e,i,3*t)}lerp(t,e,i,s,r,n){const{_values:o,_isQuantized:a}=this;a?(YK(o,t,s),YK(o,e,r)):(Ms.fromArray(s,o,3*t),Ms.fromArray(r,o,3*e)),Ms.lerp(n,s,r,i)}})||_K,RK=CK(`${$H}ExoticQuatTrackValues`)(pK=class t extends PK{static imitate(e,i){const s=new t(e);return i._isQuantized&&s.quantize(i._values.quantizationType),s}get(t,e){const{_values:i,_isQuantized:s}=this;s?qK(i,t,e):sr.fromArray(e,i,4*t)}lerp(t,e,i,s,r,n){const{_values:o,_isQuantized:a}=this;a?(qK(o,t,s),qK(o,e,r)):(sr.fromArray(s,o,4*t),sr.fromArray(r,o,4*e)),sr.slerp(n,s,r,i)}})||pK,BK=CK(`${$H}ExoticTrack`)((gK=class{constructor(t,e){this.times=fK&&fK(),this.values=yK&&yK(),this.times=t,this.values=e}toHashString(){const{times:t,values:e}=this;return`times: ${MK(t)}; values: ${e.toHashString()}`}},fK=Za(gK.prototype,"times",[AK],null),yK=Za(gK.prototype,"values",[AK],null),mK=gK))||mK;class FK{constructor(t,e){this._nodeEvaluations=void 0,this._nodeEvaluations=t.map((t=>t.createEvaluator(e)))}evaluate(t){this._nodeEvaluations.forEach((e=>{e.evaluate(t)}))}}class NK{constructor(t,e,i,s,r){this._position=null,this._rotation=null,this._scale=null,e&&(this._position=XK(e.times,e.values,Ms,t,"position",r)),i&&(this._rotation=XK(i.times,i.values,sr,t,"rotation",r)),s&&(this._scale=XK(s.times,s.values,Ms,t,"scale",r))}evaluate(t){if(this._position){const e=this._position.evaluator.evaluate(t);this._position.runtimeBinding.setValue(e)}if(this._rotation){const e=this._rotation.evaluator.evaluate(t);this._rotation.runtimeBinding.setValue(e)}if(this._scale){const e=this._scale.evaluator.evaluate(t);this._scale.runtimeBinding.setValue(e)}}}class LK{constructor(t,e,i){this._times=void 0,this._inputSampleResultCache={just:!1,index:-1,nextIndex:-1,ratio:0},this._values=void 0,this._prevValue=void 0,this._nextValue=void 0,this._resultValue=void 0,this._times=t,this._values=e,this._prevValue=new i,this._nextValue=new i,this._resultValue=new i}evaluate(t){const{_times:e,_values:i,_resultValue:s}=this;if(0===e.length)return s;const r=UK(e,t,this._inputSampleResultCache);return r.just?i.get(r.index,s):i.lerp(r.index,r.nextIndex,r.ratio,this._prevValue,this._nextValue,s),s}}class kK{constructor(t,e){this._nodeEvaluations=void 0,this._nodeEvaluations=t.map((t=>t.createEvaluatorForAnimationGraph(e))).filter((t=>!!t))}destroy(){const{_nodeEvaluations:t}=this,e=t.length;for(let i=0;i<e;++i)t[i].destroy()}evaluate(t,e){const{_nodeEvaluations:i}=this,s=i.length;for(let r=0;r<s;++r)i[r].evaluate(t,e)}}class zK{constructor(t,e,i,s){this._position=null,this._rotation=null,this._scale=null,this._transformHandle=void 0,this._transformHandle=t,e&&(this._position=new LK(e.times,e.values,Ms)),i&&(this._rotation=new LK(i.times,i.values,sr)),s&&(this._scale=new LK(s.times,s.values,Ms))}destroy(){this._transformHandle.destroy()}evaluate(t,e){const{_transformHandle:{index:i},_position:s,_rotation:r,_scale:n}=this,{transforms:o}=e;if(s){const e=s.evaluate(t);o.setPosition(i,e)}if(r){const e=r.evaluate(t);o.setRotation(i,e)}if(n){const e=n.evaluate(t);o.setScale(i,e)}}}function UK(t,e,i){const s=t.length,r=t[0],n=t[s-1];if(e<r)i.just=!0,i.index=0;else if(e>n)i.just=!0,i.index=s-1;else{const s=Ga(t,e);if(s>=0)i.just=!0,i.index=s;else{const r=~s,n=r-1,o=t[n],a=t[r],h=(e-t[n])/(a-o);i.just=!1,i.index=n,i.nextIndex=r,i.ratio=h}}return i}const VK={uint8:Uint8Array,uint16:Uint16Array};function jK(t){switch(t.BYTES_PER_ELEMENT){default:case 4:return 0;case 8:return 1}}let HK=CK(`${$H}QuantizedFloatArray`)((vK=class{get quantizationType(){switch(this.values.BYTES_PER_ELEMENT){default:case 1:return"uint8";case 2:return"uint16"}}constructor(t,e,i,s=0){this.originalPrecision=SK&&SK(),this.min=TK&&TK(),this.extent=wK&&wK(),this.values=xK&&xK(),this.originalPrecision=t,this.values=e,this.extent=i,this.min=s}toHashString(){const{originalPrecision:t,min:e,extent:i,values:s}=this;return`${t} ${IK(e)} ${IK(i)} ${s.join(" ")}`}},SK=Za(vK.prototype,"originalPrecision",[AK],null),TK=Za(vK.prototype,"min",[AK],null),wK=Za(vK.prototype,"extent",[AK],null),xK=Za(vK.prototype,"values",[AK],null),bK=vK))||bK;function GK(t,e){const i=VK[e],s=1<<i.BYTES_PER_ELEMENT;let r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;t.forEach((t=>{r=Math.min(t,r),n=Math.max(t,n)}));const o=n-r,a=i.from(t,(t=>(t-r)/o*s));return new HK(jK(t),a,o,r)}function WK(t,e){return t.values[e]/(1<<t.values.BYTES_PER_ELEMENT)*t.extent+t.min}function XK(t,e,i,s,r,n){const o=new qG;o.path=(new YG).toHierarchy(s).toProperty(r);const a=n(o);return a?{runtimeBinding:a,evaluator:new LK(t,e,i)}:null}function YK(t,e,i){Ms.set(i,WK(t,3*e+0),WK(t,3*e+1),WK(t,3*e+2))}function qK(t,e,i){sr.set(i,WK(t,4*e+0),WK(t,4*e+1),WK(t,4*e+2),WK(t,4*e+3))}var $K,KK,ZK,QK;let JK=ah(`${$H}AuxiliaryCurveEntry`)((KK=class{constructor(){this.name=ZK&&ZK(),this.curve=QK&&QK()}},ZK=Za(KK.prototype,"name",[vh],(function(){return""})),QK=Za(KK.prototype,"curve",[vh],(function(){return new hc})),$K=KK))||$K;var tZ,eZ,iZ,sZ,rZ,nZ,oZ,aZ,hZ,lZ,cZ,uZ,dZ,_Z,pZ,mZ,gZ,fZ,yZ;const bZ=Symbol("SearchForRootBonePath"),vZ=Symbol("ExoticAnimation"),SZ=Symbol("[[EmbeddedPlayerCount]]"),TZ=Symbol("[[GetEmbeddedPlayers]]"),wZ=Symbol("[[AddEmbeddedPlayer]]"),xZ=Symbol("[[RemoveEmbeddedPlayer]]"),CZ=Symbol("[[ClearEmbeddedPlayers]]"),AZ=Symbol("[[Additive Settings]]");let DZ=t("AnimationClip",ah("cc.AnimationClip")((pZ=class t extends fm{static createWithSpriteFrames(e,i){const s=new t;s.sample=i||s.sample,s.duration=e.length/s.sample;const r=1/s.sample,n=new hX;return n.path=(new YG).toComponent("cc.Sprite").toProperty("spriteFrame"),n.channels()[0].curve.assignSorted(e.map(((t,e)=>[r*e,t]))),s.addTrack(n),s}constructor(t){super(t),this.sample=iZ&&iZ(),this.speed=sZ&&sZ(),this.wrapMode=rZ&&rZ(),this.enableTrsBlending=nZ&&nZ(),this._duration=oZ&&oZ(),this._hash=aZ&&aZ(),this.frameRate=0,this._tracks=hZ&&hZ(),this._exoticAnimation=lZ&&lZ(),this._legacyData=void 0,this._legacyDataDirty=!1,this._events=cZ&&cZ(),this._embeddedPlayers=uZ&&uZ(),this._additiveSettings=dZ&&dZ(),this._auxiliaryCurveEntries=_Z&&_Z(),this._runtimeEvents={ratios:[],eventGroups:[]}}get duration(){return this._duration}set duration(t){this._duration=t}get tracksCount(){return this._tracks.length}get tracks(){return this._tracks}get hash(){var t,e;if(this._hash)return this._hash;const i=`Exotic:${null!==(t=null==(e=this._exoticAnimation)?void 0:e.toHashString())&&void 0!==t?t:""}`;return this._hash=Gu(i,666)}get events(){return this._events}set events(t){this._events=t;const e=[],i=[],s=this.events.sort(((t,e)=>t.frame-e.frame)),r=s.length;for(let t=0;t<r;++t){const r=s[t],n=r.frame/this._duration;let o=e.findIndex((t=>t===n));o<0&&(o=e.length,e.push(n),i.push({events:[]})),i[o].events.push({functionName:r.func,parameters:r.params})}this._runtimeEvents={ratios:e,eventGroups:i}}get[vZ](){return this._exoticAnimation}set[vZ](t){this._exoticAnimation=t}get isAdditive_experimental(){return this._additiveSettings.enabled}get[AZ](){return this._additiveSettings}onLoaded(){this.frameRate=this.sample,this.events=this._events}range(){const t={min:1/0,max:-1/0},{_tracks:e}=this,i=e.length;for(let s=0;s<i;++s){const i=e[s].range();t.min=Math.min(t.min,i.min),t.max=Math.max(t.max,i.max)}return t}getTrack(t){return this._tracks[t]}addTrack(t){const e=this._tracks.length;return this._tracks.push(t),e}removeTrack(t){this._tracks.splice(t,1)}clearTracks(){this._tracks.length=0}containsAnyEvent(){return 0!==this._events.length}createEventEvaluator(t){return new kZ(t,this._runtimeEvents.ratios,this._runtimeEvents.eventGroups,this.wrapMode)}containsAnyEmbeddedPlayer(){return 0!==this._embeddedPlayers.length}createEmbeddedPlayerEvaluator(t){return new MZ(this._embeddedPlayers,t)}createEvaluator(t){const{target:e}=t;return this._createEvalWithBinder(e,(i=>{if(t.mask&&i.isMaskedOff(t.mask))return;const s=i.createRuntimeBinding(e,this.enableTrsBlending?t.pose:void 0,!1);return null!=s?s:void 0}),t.rootMotion)}destroy(){var t;const e=null==(t=a.director.root)?void 0:t.dataPoolManager;return e&&e.releaseAnimationClip(this),O$.destroy(this),super.destroy()}[P$](t,e,i){const s=1/e,r=this._collectAnimatedJoints(),n=r.length,o={};for(let t=0;t<n;++t)o[r[t]]={transforms:Array.from({length:i},(()=>new vr))};const a=r.reduce(((t,e)=>(t[e]=new RZ,t)),{});for(const t in a){const e=a[t],i=t.lastIndexOf("/");if(i>=0){const s=t.substring(0,i),r=a[s];r&&(e.parent=r)}}const h=this._createEvalWithBinder(void 0,(t=>{const e=t.parseTrsPath();if(!e)return;const i=a[e.node];return i?LZ(i,e.property):void 0}),void 0);for(let e=0;e<i;++e){const i=t+s*e;h.evaluate(i);for(let t=0;t<n;++t){const i=r[t];vr.copy(o[i].transforms[e],a[i].globalTransform)}for(let t=0;t<n;++t){const e=r[t];a[e].invalidate()}}return{samples:e,frames:i,joints:o}}upgradeUntypedTracks(t){const e=[],i=[],{_tracks:s}=this,r=s.length;for(let n=0;n<r;++n){const r=s[n];if(!(r instanceof X$))continue;const o=r.upgrade(t);o&&(e.push(o),i.push(r))}const n=i.length;for(let t=0;t<n;++t)se(s,i[t]);s.push(...e)}[bZ](){return this._searchForRootBonePath()}get keys(){return this._getLegacyData().keys}set keys(t){this._legacyDataDirty=!0,this._getLegacyData().keys=t}get curves(){return this._legacyDataDirty=!0,this._getLegacyData().curves}set curves(t){this._getLegacyData().curves=t}get commonTargets(){return this._getLegacyData().commonTargets}set commonTargets(t){this._legacyDataDirty=!0,this._getLegacyData().commonTargets=t}get data(){return this._getLegacyData().data}getPropertyCurves(){return this._getLegacyData().getPropertyCurves()}get eventGroups(){return this._runtimeEvents.eventGroups}updateEventDatas(){this.events=this._events}hasEvents(){return 0!==this.events.length}syncLegacyData(){this._legacyData&&(this._fromLegacy(this._legacyData),this._legacyData=void 0)}get[SZ](){return this._embeddedPlayers.length}[TZ](){return this._embeddedPlayers}[wZ](t){this._embeddedPlayers.push(t)}[xZ](t){const e=this._embeddedPlayers.indexOf(t);e>=0&&this._embeddedPlayers.splice(e,1)}[CZ](){this._embeddedPlayers.length=0}get auxiliaryCurveCount_experimental(){return this._auxiliaryCurveEntries.length}getAuxiliaryCurveNames_experimental(){return this._auxiliaryCurveEntries.map((t=>t.name))}hasAuxiliaryCurve_experimental(t){return!!this._findAuxiliaryCurveEntry(t)}addAuxiliaryCurve_experimental(t){let e=this._findAuxiliaryCurveEntry(t);return e||(e=new JK,e.name=t,this._auxiliaryCurveEntries.push(e)),e.curve}getAuxiliaryCurve_experimental(t){return this._findAuxiliaryCurveEntry(t).curve}renameAuxiliaryCurve_experimental(t,e){const i=this._findAuxiliaryCurveEntry(t);i&&(i.name=e)}removeAuxiliaryCurve_experimental(t){ne(this._auxiliaryCurveEntries,(e=>e.name===t))}_trySyncLegacyData(){this._legacyDataDirty&&(this._legacyDataDirty=!1,this.syncLegacyData())}_createEvalWithBinder(t,e,i){this._legacyDataDirty&&(this._legacyDataDirty=!1,this.syncLegacyData());const s=[];let r;i&&(r=this._createRootMotionEvaluation(t,i,s));const n=[];let o;const{_tracks:a}=this,h=a.length;for(let t=0;t<h;++t){const i=a[t];if(s.includes(i))continue;if(Array.from(i.channels()).every((({curve:t})=>0===t.keyFramesCount)))continue;const r=e(i[XG]);if(!r)continue;let o;if(i instanceof X$){if(!r.getValue){G(3930);continue}const t=r.getValue();o=i.createLegacyEval(t)}else o=i[KH]();n.push(new IZ(r,o))}return this._exoticAnimation&&(o=this._exoticAnimation.createEvaluator(e)),new PZ(n,o,r)}_createRootMotionEvaluation(t,e,i){if(!(t instanceof tb))return void G(3920);const s=this._searchForRootBonePath();if(!s)return void j(3923);const r=t.getChildByPath(s);if(!r)return void j(3924);const n=new OZ,o=[],{_tracks:a}=this,h=a.length;for(let t=0;t<h;++t){const e=a[t],{[XG]:r}=e,h=r.parseTrsPath();if(!h)continue;if(h.node!==s)continue;i.push(e);const l=LZ(n,h.property);if(!l)continue;const c=e[KH]();o.push(new IZ(l,c))}return new FZ(r,this._duration,n,o)}_searchForRootBonePath(){const t=this._tracks.map((t=>{const e=t[XG].parseTrsPath();if(e){const t=e.node;return{path:t,rank:t.split("/").length}}return{path:"",rank:0}}));t.sort(((t,e)=>t.rank-e.rank));const e=t.findIndex((t=>0!==t.rank));if(e<0)return"";const i=t.length,s=t[e];let r=!0;for(let n=e+1;n<i;++n){const e=t[n];if(e.rank!==s.rank)break;if(e.path!==s.path){r=!1;break}}return r?s.path:""}_getLegacyData(){return this._legacyData||(this._legacyData=this._toLegacy()),this._legacyData}_toLegacy(){const t=new Y$(this._duration);return t.keys=[],t.curves=[],t.commonTargets=[],t}_fromLegacy(t){const e=t.toTracks(),i=e.length;for(let t=0;t<i;++t)this.addTrack(e[t])}_collectAnimatedJoints(){const t=new Set,{_tracks:e}=this,i=e.length;for(let s=0;s<i;++s){const i=e[s][XG].parseTrsPath();i&&t.add(i.node)}if(this._exoticAnimation){const e=this._exoticAnimation.collectAnimatedJoints(),i=e.length;for(let s=0;s<i;++s)t.add(e[s])}return Array.from(t)}_findAuxiliaryCurveEntry(t){return this._auxiliaryCurveEntries.find((e=>e.name===t))}},pZ.WrapMode=nG,iZ=Za((eZ=pZ).prototype,"sample",[vh],(function(){return 60})),sZ=Za(eZ.prototype,"speed",[vh],(function(){return 1})),rZ=Za(eZ.prototype,"wrapMode",[vh],(function(){return nG.Normal})),nZ=Za(eZ.prototype,"enableTrsBlending",[vh],(function(){return!1})),oZ=Za(eZ.prototype,"_duration",[vh],(function(){return 0})),aZ=Za(eZ.prototype,"_hash",[vh],(function(){return 0})),hZ=Za(eZ.prototype,"_tracks",[vh],(function(){return[]})),lZ=Za(eZ.prototype,"_exoticAnimation",[vh],(function(){return null})),cZ=Za(eZ.prototype,"_events",[vh],(function(){return[]})),uZ=Za(eZ.prototype,"_embeddedPlayers",[vh],(function(){return[]})),dZ=Za(eZ.prototype,"_additiveSettings",[vh],(function(){return new EZ})),_Z=Za(eZ.prototype,"_auxiliaryCurveEntries",[vh],(function(){return[]})),tZ=eZ))||tZ),EZ=ah("cc.AnimationClipAdditiveSettings")((gZ=class{constructor(){this.enabled=fZ&&fZ(),this.refClip=yZ&&yZ()}},fZ=Za(gZ.prototype,"enabled",[vh],(function(){return!1})),yZ=Za(gZ.prototype,"refClip",[vh],(function(){return null})),mZ=gZ))||mZ;a.AnimationClip=DZ;class IZ{constructor(t,e){this._binding=void 0,this._trackEval=void 0,this._shouldEvaluateDefault=!0,this._binding=t,this._trackEval=e,this._shouldEvaluateDefault=!!t.getValue&&e.requiresDefault}evaluate(t){const{_binding:e,_trackEval:i}=this,s=this._shouldEvaluateDefault?e.getValue():void 0,r=i.evaluate(t,s);e.setValue(r)}}class MZ{constructor(t,e){this._embeddedPlayers=t,this._embeddedPlayerEvaluationInfos=t.map((t=>{const{playable:i}=t;if(!i)return null;const s=i.instantiate(e);return s?{instantiatedPlayer:s,entered:!1,hostPauseTime:0,lastIterations:0}:null}))}destroy(){const{_embeddedPlayerEvaluationInfos:t}=this,e=t.length;for(let s=0;s<e;++s){var i;null==(i=t[s])||i.instantiatedPlayer.destroy()}this._embeddedPlayerEvaluationInfos.length=0}evaluate(t,e){const{_embeddedPlayers:i,_embeddedPlayerEvaluationInfos:s}=this,r=i.length;for(let n=0;n<r;++n){const r=s[n];if(!r)continue;const{entered:o,instantiatedPlayer:a,lastIterations:h}=r,{begin:l,end:c}=i[n];if(t>=l&&t<=c?o?e!==h&&(a.stop(),a.play(),r.entered=!0):(a.play(),r.entered=!0):o&&(a.stop(),r.entered=!1),r.lastIterations=e,r.entered){const e=t-l;r.instantiatedPlayer.setTime(e)}}}notifyHostSpeedChanged(t){const{_embeddedPlayers:e,_embeddedPlayerEvaluationInfos:i}=this,s=e.length;for(let r=0;r<s;++r){const s=i[r];if(!s)continue;const{instantiatedPlayer:n}=s,{reconciledSpeed:o}=e[r];o&&n.setSpeed(t)}}notifyHostPlay(t){const{_embeddedPlayers:e,_embeddedPlayerEvaluationInfos:i}=this,s=e.length;for(let r=0;r<s;++r){const s=i[r];if(!s)continue;const{begin:n,end:o}=e[r],{instantiatedPlayer:a,entered:h}=s;if(h){const{hostPauseTime:e}=s;if(a.randomAccess||Oi(e,t,1e-5)){const e=Ri(t,n,o);a.play(),a.setTime(e-n)}else a.stop()}}}notifyHostPause(t){const{_embeddedPlayers:e,_embeddedPlayerEvaluationInfos:i}=this,s=e.length;for(let e=0;e<s;++e){const s=i[e];if(!s)continue;const{instantiatedPlayer:r,entered:n}=s;n&&(r.pause(),s.hostPauseTime=t)}}notifyHostStop(){const{_embeddedPlayers:t,_embeddedPlayerEvaluationInfos:e}=this,i=t.length;for(let t=0;t<i;++t){const i=e[t];if(!i)continue;const{instantiatedPlayer:s,entered:r}=i;r&&(i.entered=!1,s.stop())}}}class PZ{constructor(t,e,i){this._exoticAnimationEvaluator=void 0,this._trackEvalStatues=[],this._rootMotionEvaluation=void 0,this._trackEvalStatues=t,this._exoticAnimationEvaluator=e,this._rootMotionEvaluation=i}evaluate(t){const{_trackEvalStatues:e,_exoticAnimationEvaluator:i}=this,s=e.length;for(let i=0;i<s;++i)e[i].evaluate(t);i&&i.evaluate(t)}evaluateRootMotion(t,e){const{_rootMotionEvaluation:i}=this;i&&i.evaluate(t,e)}}class OZ{constructor(){this.position=new Ms,this.scale=new Ms(1,1,1),this.rotation=new sr,this.eulerAngles=new Ms}getTransform(t){vr.fromRTS(t,this.rotation,this.position,this.scale)}}class RZ extends OZ{constructor(...t){super(...t),this.parent=null,this._dirty=!0,this._transform=new vr}get globalTransform(){const t=this._transform;return this._dirty&&(this._dirty=!1,vr.fromRTS(t,this.rotation,this.position,this.scale),this.parent&&vr.multiply(t,this.parent.globalTransform,t)),this._transform}invalidate(){this._dirty=!0}}const BZ=new vr;class FZ{constructor(t,e,i,s){this._initialTransformCache=new vr,this._clipEndTransformCache=new vr,this._startTransformCache=new vr,this._endTransformCache=new vr,this._motionTransformCache=new vr,this._translationMotionCache=new Ms,this._rotationMotionCache=new sr,this._scaleMotionCache=new Ms,this._rootBone=t,this._duration=e,this._boneTransform=i,this._trackEvalStatuses=s}evaluate(t,e){const i=this._calcMotionTransform(t,e,this._motionTransformCache),{_translationMotionCache:s,_rotationMotionCache:r,_scaleMotionCache:n,_rootBone:o}=this;vr.toSRT(i,r,s,n),Ms.add(s,s,o.position),o.setPosition(s),sr.multiply(r,r,o.rotation),o.setRotation(r),Ms.multiply(n,n,o.scale),o.setScale(n)}_calcMotionTransform(t,e,i){const{_duration:s}=this,r=s-t,n=this._evaluateAt(t,this._startTransformCache);if(e<r){const s=this._evaluateAt(t+e,this._endTransformCache);NZ(i,n,s)}else{vr.identity(i);const t=(t,e)=>{NZ(BZ,t,e),vr.multiply(i,i,BZ)},o=e-r,a=Math.floor(o/s),h=o-a*s,l=this._evaluateAt(0,this._initialTransformCache),c=this._evaluateAt(s,this._clipEndTransformCache),u=this._evaluateAt(h,this._endTransformCache);t(n,c),NZ(BZ,l,c);for(let t=0;t<a;++t)vr.multiply(i,i,BZ);t(l,u)}return i}_evaluateAt(t,e){const{_trackEvalStatuses:i}=this,s=i.length;for(let e=0;e<s;++e)i[e].evaluate(t);return this._boneTransform.getTransform(e),e}}function NZ(t,e,i){vr.invert(t,e),vr.multiply(t,i,t)}function LZ(t,e){switch(e){default:return;case"position":return{setValue(e){Ms.copy(t.position,e)}};case"rotation":return{setValue(e){sr.copy(t.rotation,e)}};case"scale":return{setValue(e){Ms.copy(t.scale,e)}};case"eulerAngles":return{setValue(e){Ms.copy(t.eulerAngles,e)}}}}class kZ{constructor(t,e,i,s){this._lastFrameIndex=-1,this._lastIterations=0,this._lastDirection=0,this._ignoreIndex=-1,this._sampled=!1,this._targetNode=t,this._ratios=e,this._eventGroups=i,this._wrapMode=s}setWrapMode(t){this._wrapMode=t}ignore(t,e){this._ignoreIndex=-1,this._sampled=!1;let i=UZ(t,this._ratios);i<0&&(i=~i-1,e<0&&(i+=1),this._ignoreIndex=i)}reset(){this._lastFrameIndex=-1,this._lastIterations=0,this._lastDirection=0,this._ignoreIndex=-1,this._sampled=!1}sample(t,e,i){if(0===this._eventGroups.length)return;const s=this._eventGroups.length;let r=UZ(t,this._ratios);if(r<0&&(r=~r-1,e<0&&(r+=1)),this._ignoreIndex!==r&&(this._ignoreIndex=-1),!this._sampled)return this._sampled=!0,this._doFire(r,!1),this._lastFrameIndex=r,this._lastIterations=i,void(this._lastDirection=e);const n=this._wrapMode,o=zZ(i);let a=zZ(this._lastIterations),h=this._lastFrameIndex;const l=this._lastDirection,c=-1!==a&&o!==a;if(h===r&&c&&1===s)this._doFire(0,!1);else if(h!==r||c){e=l;do{if(h!==r){if(-1===e&&0===h&&r>0?(22&~n?h=s:e*=-1,a++):1===e&&h===s-1&&r<s-1&&(22&~n?h=-1:e*=-1,a++),h===r)break;if(a>o)break}h+=e,this._doFire(h,!0)}while(h!==r&&h>-1&&h<s)}this._lastFrameIndex=r,this._lastIterations=i,this._lastDirection=e}_doFire(t,e){e?hG().pushDelayEvent(this._checkAndFire,this,[t]):this._checkAndFire(t)}_checkAndFire(t){if(!this._targetNode||!this._targetNode.isValid)return;const{_eventGroups:e}=this;if(t<0||t>=e.length||this._ignoreIndex===t)return;const i=e[t],s=i.events.length;for(let t=0;t<s;++t){const e=i.events[t];aY(this._targetNode,e.functionName,e.parameters)}}}function zZ(t){return t-(0|t)==0&&(t-=1),0|t}function UZ(t,e){return Ga(e,t)}function VZ(t,e,i,s,r,n){if(0===e)return n.time=0,n.ratio=0,n.direction=1,n.stopped=!!Number.isFinite(s),n.iterations=0,n;let o=!1,a=t>0?t/e:-t/e;if(a>=s){a=s,o=!0;let i=s-(0|s);0===i&&(i=1),t=i*e*(t>0?1:-1)}if(t>e){const i=t%e;t=0===i?e:i}else t<0&&0!=(t%=e)&&(t+=e);let h=!1;const l=4&i;l&&(h=jZ(i,a));let c=h?-1:1;return l&&h&&(t=e-t),n.time=t,n.ratio=n.time/e,n.direction=c,n.stopped=o,n.iterations=a,n}function jZ(t,e){let i=!1;return 22&~t||(e-(0|e)==0&&e>0&&(e-=1),1&e&&(i=!i)),36&~t||(i=!i),i}var HZ;const GZ=new Ms,WZ=new Ms,XZ=new sr;new sr;let YZ=class t{constructor(){this._position=new Ms,this._rotation=new sr,this._scale=Ms.clone(Ms.ONE)}get position(){return this._position}set position(t){Ms.copy(this._position,t)}get rotation(){return this._rotation}set rotation(t){sr.copy(this._rotation,t)}get scale(){return this._scale}set scale(t){Ms.copy(this._scale,t)}static clone(e){const i=new t;return t.copy(i,e),i}static setIdentity(t){return Ms.copy(t._position,Ms.ZERO),sr.copy(t._rotation,sr.IDENTITY),Ms.copy(t._scale,Ms.ONE),t}static copy(t,e){return Ms.copy(t._position,e._position),sr.copy(t._rotation,e._rotation),Ms.copy(t._scale,e._scale),t}static equals(t,e,i){return Ms.equals(t._position,e._position,i)&&sr.equals(t._rotation,e._rotation,i)&&Ms.equals(t._scale,e._scale,i)}static strictEquals(t,e){return Ms.strictEquals(t._position,e._position)&&sr.strictEquals(t._rotation,e._rotation)&&Ms.strictEquals(t._scale,e._scale)}static lerp(e,i,s,r){return 0===r?t.copy(e,i):1===r?t.copy(e,s):(Ms.lerp(e._position,i._position,s._position,r),sr.slerp(e._rotation,i._rotation,s._rotation,r),Ms.lerp(e._scale,i._scale,s._scale,r),e)}static multiply(t,e,i){const s=sr.multiply(XZ,e._rotation,i._rotation),r=Ms.multiply(GZ,i._scale,e._scale),n=Ms.multiply(WZ,i._position,e._scale);return Ms.transformQuat(n,n,e._rotation),Ms.add(n,n,e._position),Ms.copy(t._position,n),sr.copy(t._rotation,s),Ms.copy(t._scale,r),t}static invert(t,e){const{_rotation:i,_scale:s,_position:r}=t;return sr.invert(i,e._rotation),qZ(s,e._scale,Mi),Ms.negate(r,e._position),Ms.multiply(r,r,s),Ms.transformQuat(r,r,i),t}static fromMatrix(t,e){return vr.toSRT(e,t._rotation,t._position,t._scale),t}static toMatrix(t,e){return vr.fromSRT(t,e._rotation,e._position,e._scale)}};function qZ(t,e,i){const{x:s,y:r,z:n}=e;return Ms.set(t,Math.abs(s)<=i?0:1/s,Math.abs(r)<=i?0:1/r,Math.abs(n)<=i?0:1/n)}function $Z(t,e,i){return Ms.subtract(t.position,e.position,i.position),ZZ(t.rotation,i.rotation,e.rotation),Ms.subtract(t.scale,e.scale,i.scale),t}HZ=YZ,YZ.IDENTITY=Object.freeze(new HZ),YZ.ZERO=Object.freeze((()=>{const t=new HZ;return Ms.copy(t._position,Ms.ZERO),sr.set(t._rotation,0,0,0,0),Ms.copy(t._scale,Ms.ZERO),t})()),YZ.calculateRelative=(()=>{const t=new sr,e=new Ms;return(i,s,r)=>{const n=sr.invert(t,r._rotation),o=qZ(e,r._scale,Mi),a=Ms.subtract(WZ,s._position,r._position);return Ms.transformQuat(a,a,n),Ms.multiply(a,a,o),Ms.copy(i._position,a),sr.multiply(i._rotation,n,s._rotation),Ms.multiply(i._scale,s._scale,o),i}})();const KZ=(()=>{const t=new sr;return(e,i,s,r)=>{Ms.scaleAndAdd(e.position,i.position,s.position,r);const n=sr.slerp(t,sr.IDENTITY,s.rotation,r);return sr.multiply(e.rotation,n,i.rotation),Ms.scaleAndAdd(e.scale,i.scale,s.scale,r),e}})(),ZZ=(()=>{const t=new sr;return(e,i,s)=>{const r=sr.invert(t,i);return sr.multiply(e,s,r)}})(),QZ=Object.freeze((()=>{const t=new YZ;return t.position=Ms.ZERO,t.rotation=sr.IDENTITY,t.scale=Ms.ZERO,t})());class JZ{constructor(t,e){this.transforms=void 0,this.auxiliaryCurves=void 0,this._poseTransformSpace=0,this.transforms=t,this.auxiliaryCurves=e}static _create(t,e){return new JZ(t,e)}}class tQ{constructor(t){this._involvedTransforms=new Uint16Array(t)}get involvedTransforms(){return this._involvedTransforms}}function eQ(t,e,i,s){iQ(t.transforms,e.transforms,i,s),nQ(t.auxiliaryCurves,e.auxiliaryCurves,i)}function iQ(t,e,i,s){const r=t.length;if(t.length,0!==i)if(1!==i)if(s)for(let r=0;r<s.involvedTransforms.length;++r){const n=s.involvedTransforms[r];rQ(t,e,i,n)}else for(let s=0;s<r;++s)rQ(t,e,i,s);else s?sQ(t,e,s):t.set(e)}function sQ(t,e,i){t.length,t.length;for(let s=0;s<i.involvedTransforms.length;++s){const r=i.involvedTransforms[s];t.copyRange(r,e,r,1)}}const rQ=(()=>{const t=new YZ,e=new YZ;return(i,s,r,n)=>{const o=i.getTransform(n,e),a=s.getTransform(n,t);YZ.lerp(o,o,a,r),i.setTransform(n,o)}})();function nQ(t,e,i){const s=e.length;t.length;for(let r=0;r<s;++r)t[r]=Fi(t[r],e[r],i)}const oQ=(()=>{const t=new YZ,e=new YZ;return(i,s,r)=>{const n=s.getTransform(r,t),o=i.getTransform(r,e);$Z(o,o,n),i.setTransform(r,o)}})();function aQ(t,e){const i=t.length;e.length;for(let s=0;s<i;++s)oQ(t,e,s)}function hQ(t,e){t.length,e.length;for(let i=0;i<t.length;++i)t[i]-=e[i]}function lQ(t,e,i,s){uQ(t.transforms,e.transforms,i,s),dQ(t.auxiliaryCurves,e.auxiliaryCurves,i)}const cQ=(()=>{const t=new YZ,e=new YZ;return(i,s,r,n)=>{const o=s.getTransform(n,t),a=i.getTransform(n,e);KZ(a,a,o,r),i.setTransform(n,a)}})();function uQ(t,e,i,s){const r=t.length;if(e.length,s)for(let r=0;r<s.involvedTransforms.length;++r){const n=s.involvedTransforms[r];cQ(t,e,i,n)}else for(let s=0;s<r;++s)cQ(t,e,i,s)}function dQ(t,e,i){t.length,e.length;for(let s=0;s<t.length;++s)t[s]+=e[s]*i}const _Q=new Ms,pQ=new sr;class mQ{constructor(t){this._transformHandle=t}destroy(){this._transformHandle.destroy()}}class gQ extends mQ{setValue(t,e){e.transforms.setPosition(this._transformHandle.index,t)}getValue(t){return t.transforms.getPosition(this._transformHandle.index,_Q)}}class fQ extends mQ{setValue(t,e){e.transforms.setRotation(this._transformHandle.index,t)}getValue(t){return t.transforms.getRotation(this._transformHandle.index,pQ)}}class yQ extends mQ{setValue(t,e){const i=sr.fromEuler(yQ._EULER_TO_QUAT_CACHE,t.x,t.y,t.z);e.transforms.setRotation(this._transformHandle.index,i)}getValue(t){const e=t.transforms.getRotation(this._transformHandle.index,pQ);return sr.toEuler(_Q,e)}}yQ._EULER_TO_QUAT_CACHE=new sr;class bQ extends mQ{setValue(t,e){e.transforms.setScale(this._transformHandle.index,t)}getValue(t){return t.transforms.getScale(this._transformHandle.index,_Q)}}class vQ{constructor(t){this._handle=t}destroy(){this._handle.destroy()}setValue(t,e){e.auxiliaryCurves[this._handle.index]=t}getValue(t){return t.auxiliaryCurves[this._handle.index]}}function SQ(t,e){switch(e){case"position":return new gQ(t);case"rotation":return new fQ(t);case"eulerAngles":return new yQ(t);case"scale":return new bQ(t)}}class TQ{constructor(t){this.binding=t}destroy(){}setValue(t,e){this.binding.setValue(t)}getValue(t){var e,i,s;return null!==(e=null==(i=(s=this.binding).getValue)?void 0:i.call(s))&&void 0!==e?e:void 0}}class wQ{constructor(t,e){this._binding=void 0,this._trackSampler=void 0,this._binding=t,this._trackSampler=e}destroy(){this._binding.destroy()}evaluate(t,e){const{_trackSampler:i,_binding:s}=this,r=i.requiresDefault?s.getValue(e):void 0,n=i.evaluate(t,r);s.setValue(n,e)}}function xQ(t,e,i){const s=CQ(e[XG],i);return null!=s?s:void 0}function CQ(t,e){const{origin:i}=e,{path:s,proxy:r}=t,n=s.length,o=n-1;if(0!==n&&(s.isPropertyAt(o)||s.isElementAt(o))&&!r){const t=s.isPropertyAt(o)?s.parsePropertyAt(o):s.parseElementAt(o),r=s[GG](i,0,n-1);if(null===r)return null;if(r instanceof tb&&$G(t)){const s=(()=>{const t=[];let e=r;for(;e&&e!==i;e=e.parent)t.unshift(e.name);return e===i?t.join("/"):void 0})();if("string"==typeof s){const i=e.bindTransform(s);if(!i)return;return SQ(i,t)}}}{const i=t.createRuntimeBinding(e.origin,void 0,!1);return i?new TQ(i):null}}class AQ{constructor(t,e){this._binding=t,this._curve=e}evaluate(t,e){const{_curve:i,_binding:s}=this,r=e,n=i.evaluate(t);s.setValue(n,r)}}function DQ(t,e){return t.isAdditive_experimental?new IQ(t,e):new EQ(t,e)}class EQ{constructor(t,e){this._trackEvaluations=[],this._exoticAnimationEvaluation=void 0,this._auxiliaryCurveEvaluations=[],t._trySyncLegacyData();const i=[];let s;const r=[],{tracks:n}=t,o=t[vZ];for(const t of n){if(t instanceof X$)continue;if(Array.from(t.channels()).every((({curve:t})=>0===t.keyFramesCount)))continue;const s=xQ(0,t,e);if(!s)continue;const r=t[KH](),n=new wQ(s,r);i.push(n)}o&&(s=o.createEvaluatorForAnimationGraph(e));const a=t.getAuxiliaryCurveNames_experimental(),h=a.length;for(let i=0;i<h;++i){const s=a[i],n=t.getAuxiliaryCurve_experimental(s),o=e.bindAuxiliaryCurve(s),h=new vQ(o);r.push(new AQ(h,n))}this._trackEvaluations=i,this._exoticAnimationEvaluation=s,this._auxiliaryCurveEvaluations=r}destroy(){var t;null==(t=this._exoticAnimationEvaluation)||t.destroy();const{_trackEvaluations:e}=this,i=e.length;for(let t=0;t<i;++t)e[t].destroy()}evaluate(t,e){const{_trackEvaluations:i,_exoticAnimationEvaluation:s,_auxiliaryCurveEvaluations:r}=this,n=e.pushDefaultedPose(),o=i.length;for(let e=0;e<o;++e)i[e].evaluate(t,n);s&&s.evaluate(t,n);const a=r.length;for(let e=0;e<a;++e)r[e].evaluate(t,n);return n}}class IQ{constructor(t,e){this._clipEval=void 0,this._refClipEval=void 0,this._clipEval=new EQ(t,e);const i=t[AZ].refClip;i&&i!==t&&(this._refClipEval=new EQ(i,e))}destroy(){var t;this._clipEval.destroy(),null==(t=this._refClipEval)||t.destroy()}evaluate(t,e){const i=this._clipEval.evaluate(t,e);let s;if(this._refClipEval){const t=0;s=this._refClipEval.evaluate(t,e)}else s=this._clipEval.evaluate(0,e);var r,n;return n=s,aQ((r=i).transforms,n.transforms),hQ(r.auxiliaryCurves,n.auxiliaryCurves),e.popPose(),i}}var MQ,PQ,OQ,RQ,BQ;const{ccclass:FQ,type:NQ}=il;let LQ=(MQ=FQ("cc.animation.ClipMotion"),PQ=NQ(DZ),MQ((RQ=class t extends M${constructor(...t){super(...t),this.clip=BQ&&BQ()}[E$](t,e){return this.clip?new zQ(t,this.clip,e):null}clone(){const e=new t;return e.clip=this.clip,e[wo]=qX(this),e}},BQ=Za(RQ.prototype,"clip",[PQ,vh],(function(){return null})),OQ=RQ))||OQ);const kQ=Symbol("EvaluatePort");class zQ{constructor(t,e,i){var s,r;this._clipEmbeddedPlayerEval=null,this._frameEventEval=null,this._wrapInfo=new oG,this._duration=0,this._ignoreEmbeddedPlayers=void 0,this._originalClip=e,this._ignoreEmbeddedPlayers=i;const n=null!==(s=null==(r=t.clipOverrides)?void 0:r.get(e))&&void 0!==s?s:e;this._setClip(n,t)}get duration(){return this._duration}createPort(){return new UQ(this)}getClipStatuses(t){let e=!1;return{next:()=>e?{done:!0,value:void 0}:(e=!0,{done:!1,value:{__DEBUG_ID__:this.__DEBUG__ID__,clip:this._clip,weight:t}})}}[kQ](t,e){var i,s;const{_duration:r,_clip:{duration:n},_clipEval:o}=this,a=r*t,{wrapMode:h}=this._clip,l=VZ(a,r,h,2&~h?1:1/0,0,this._wrapInfo),c=l.ratio*n,u=o.evaluate(c,e);return null==(i=this._frameEventEval)||i.sample(l.ratio,l.direction,l.iterations),null==(s=this._clipEmbeddedPlayerEval)||s.evaluate(c,Math.trunc(l.iterations)),u}overrideClips(t){var e;const{_originalClip:i}=this,s=null==(e=t.clipOverrides)?void 0:e.get(i);s&&this._setClip(s,t)}reenter(){var t;null==(t=this._frameEventEval)||t.reset()}_setClip(t,e){var i;null==(i=this._clipEval)||i.destroy(),this._frameEventEval=null,this._clipEmbeddedPlayerEval&&(this._clipEmbeddedPlayerEval.destroy(),this._clipEmbeddedPlayerEval=null),this._clip=t,this._duration=0===t.speed?0:t.duration/t.speed,this._clipEval=DQ(t,e),this._frameEventEval=t.createEventEvaluator(e.origin),!this._ignoreEmbeddedPlayers&&t.containsAnyEmbeddedPlayer()&&(this._clipEmbeddedPlayerEval=t.createEmbeddedPlayerEvaluator(e.origin))}}class UQ{constructor(t){this._eval=void 0,this._eval=t}evaluate(t,e){return this._eval[kQ](t,e)}reenter(){this._eval.reenter()}}var VQ,jQ,HQ,GQ,WQ,XQ;const{ccclass:YQ,serializable:qQ}=il;let $Q=YQ(`${$H}AnimationBlendItem`)((jQ=class t{constructor(){this.motion=HQ&&HQ()}clone(){const e=new t;return this._copyTo(e),e}_copyTo(t){var e,i;return t.motion=null!==(e=null==(i=this.motion)?void 0:i.clone())&&void 0!==e?e:null,t}},HQ=Za(jQ.prototype,"motion",[qQ],(function(){return null})),VQ=jQ))||VQ,KQ=YQ(`${$H}AnimationBlend`)((WQ=class extends M${constructor(...t){super(...t),this.name=XQ&&XQ()}copyTo(t){t.name=this.name,t[wo]=qX(this)}},XQ=Za(WQ.prototype,"name",[qQ],(function(){return""})),GQ=WQ))||GQ;class ZQ{constructor(t,e,i,s,r){this._childEvaluators=s.map((i=>{var s,r;return null!==(s=null==(r=i.motion)?void 0:r[E$](t,e))&&void 0!==s?s:null})),this._weights=new Array(this._childEvaluators.length).fill(0),this._inputs=[...r]}createPort(){return new QQ(this,this._childEvaluators.map((t=>{var e;return null!==(e=null==t?void 0:t.createPort())&&void 0!==e?e:null})))}get childCount(){return this._weights.length}getChildWeight(t){return this._weights[t]}getChildMotionEval(t){return this._childEvaluators[t]}get duration(){let t=0;for(let s=0;s<this._childEvaluators.length;++s){var e,i;t+=(null!==(e=null==(i=this._childEvaluators[s])?void 0:i.duration)&&void 0!==e?e:0)*this._weights[s]}return t}getClipStatuses(t){const{_childEvaluators:e,_weights:i}=this,s=e.length;let r,n=0;return{next(){for(;;){if(r){const t=r.next();if(!t.done)return t}if(n>=s)return{done:!0,value:void 0};{const s=e[n];r=null==s?void 0:s.getClipStatuses(t*i[n]),++n}}}}}__evaluatePort(t,e,i){const s=this._childEvaluators.length;let r=0,n=null;for(let a=0;a<s;++a){var o;const s=this._weights[a];if(!s)continue;const h=null==(o=t.childPorts[a])?void 0:o.evaluate(e,i);h&&(r+=s,n?(r&&eQ(n,h,s/r),i.popPose()):n=h)}return n||i.pushDefaultedPose()}overrideClips(t){for(let i=0;i<this._childEvaluators.length;++i){var e;null==(e=this._childEvaluators[i])||e.overrideClips(t)}}setInput(t,e){this._inputs[e]=t,this.doEval()}doEval(){this.eval(this._weights,this._inputs)}}class QQ{constructor(t,e){this.childPorts=[],this._host=void 0,this._host=t,this.childPorts=e}evaluate(t,e){return this._host.__evaluatePort(this,t,e)}reenter(){const{childPorts:t}=this,e=t.length;for(let s=0;s<e;++s){var i;null==(i=t[s])||i.reenter()}}}var JQ,tJ,eJ,iJ,sJ,rJ,nJ,oJ;const{ccclass:aJ,serializable:hJ}=il;let lJ=aJ(`${$H}BindableNumber`)((tJ=class t{constructor(t=0){this.variable=eJ&&eJ(),this.value=iJ&&iJ(),this.value=t}clone(){const e=new t;return e.value=this.value,e.variable=this.variable,e}},eJ=Za(tJ.prototype,"variable",[hJ],(function(){return""})),iJ=Za(tJ.prototype,"value",[hJ],(function(){return 0})),JQ=tJ))||JQ,cJ=aJ(`${$H}BindableBoolean`)((rJ=class t{constructor(t=!1){this.variable=nJ&&nJ(),this.value=oJ&&oJ(),this.value=t}clone(){const e=new t;return e.value=this.value,e.variable=this.variable,e}},nJ=Za(rJ.prototype,"variable",[hJ],(function(){return""})),oJ=Za(rJ.prototype,"value",[hJ],(function(){return!1})),sJ=rJ))||sJ;function uJ(t,e,i,s,r,...n){const{variable:o,value:a}=e;if(!o)return a;const h=t.getVar(o);if(!dJ(h,o))return a;if(h.type!==i)throw new LX(o,"number");return h.bind(s,r,...n)}function dJ(t,e){if(t)return!0;throw new NX(e)}function _J(t,e,i){if(t!==e)throw new LX(i,"number")}function pJ(t,e){if(2!==t)throw new LX(e,"trigger")}function mJ(t,e,i){if(t.fill(0),0===e.length);else if(i<=e[0])t[0]=1;else if(i>=e[e.length-1])t[t.length-1]=1;else{let s=0;for(let t=1;t<e.length;++t)if(e[t]>i){s=t;break}const r=e[s-1],n=e[s],o=n-r;t[s-1]=(n-i)/o,t[s]=(i-r)/o}}var gJ,fJ,yJ,bJ,vJ,SJ,TJ,wJ;const{ccclass:xJ,serializable:CJ}=il;let AJ=xJ(`${$H}AnimationBlend1DItem`)((fJ=class t extends $Q{constructor(...t){super(...t),this.threshold=yJ&&yJ()}clone(){const e=new t;return this._copyTo(e),e}_copyTo(t){return super._copyTo(t),t.threshold=this.threshold,t}},yJ=Za(fJ.prototype,"threshold",[CJ],(function(){return 0})),gJ=fJ))||gJ,DJ=xJ("cc.animation.AnimationBlend1D")((wJ=class t extends KQ{constructor(...t){super(...t),this._items=SJ&&SJ(),this.param=TJ&&TJ()}get items(){return this._items}set items(t){this._items=Array.from(t).sort((({threshold:t},{threshold:e})=>t-e))}clone(){const e=new t;return this.copyTo(e),e._items=this._items.map((t=>t.clone())),e.param=this.param.clone(),e}[E$](t,e){const i=new EJ(t,e,this,this._items,this._items.map((({threshold:t})=>t)),0),s=uJ(t,this.param,0,i.setInput,i,0);return i.setInput(s,0),i}},wJ.Item=AJ,SJ=Za((vJ=wJ).prototype,"_items",[CJ],(function(){return[]})),TJ=Za(vJ.prototype,"param",[CJ],(function(){return new lJ})),bJ=vJ))||bJ;class EJ extends ZQ{constructor(t,e,i,s,r,n){super(t,e,i,s,[n]),this._thresholds=r,this.doEval()}eval(t,[e]){mJ(t,this._thresholds,e)}}const IJ=(()=>{const t=new kr,e={wA:0,wB:0};return function(i,s,r){if(i.length,s.length,0===s.length)return;if(1===s.length)return void(i[0]=1);if(kr.strictEquals(r,kr.ZERO)){const t=s.findIndex((t=>kr.strictEquals(t,kr.ZERO)));return void(t>=0?i[t]=1:i.fill(1/s.length))}let n=-1,o=-1,a=-1,h=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const{x:c,y:u}=r;for(let e=0;e<s.length;++e){const i=s[e];if(kr.equals(i,kr.ZERO)){a=e;continue}const d=kr.normalize(t,i),_=kr.dot(d,r);d.x*u-d.y*c>0?_>=l&&(l=_,n=e):_>=h&&(h=_,o=e)}let d=0;if(n<0||o<0)d=1;else{const{wA:t,wB:a}=OJ(s[n],s[o],r,e);let h=0,l=0;const c=t+a;c>1?(h=t/c,l=a/c):c<0?(h=0,l=0,d=1):(h=t,l=a,d=1-c),i[n]=h,i[o]=l}if(d>0)if(a>=0)i[a]=d;else{const t=d/i.length;for(let e=0;e<i.length;++e)i[e]+=t}}})();function MJ(t,e,i){PJ(t,e,i,RJ)}function PJ(t,e,i,s){t.fill(0);const r=new kr(0,0),n=new kr(0,0);let o=0;const a=e.length;for(let h=0;h<a;++h){let l=Number.MAX_VALUE,c=!1;for(let t=0;t<a;++t){if(h===t)continue;s(e[h],e[t],i,r,n);const o=1-kr.dot(r,n)/kr.lengthSqr(n);if(o<0){c=!0;break}l=Math.min(l,o)}c||(t[h]=l,o+=l)}o>0&&t.forEach(((e,i)=>t[i]=e/o))}function OJ(t,e,i,s){const r=kr.cross(t,e);return r?(s.wA=kr.cross(i,e)/r,s.wB=kr.cross(i,t)/-r):(s.wA=0,s.wB=0),s}const RJ=(t,e,i,s,r)=>{kr.subtract(s,i,t),kr.subtract(r,e,t)};class BJ{constructor(t){const{_ANGLE_MULTIPLIER:e}=BJ,i=t.length,s=this._exampleMagnitudes=new Array(i).fill(0),r=this._exampleDirections=t.map(((t,e)=>{const i=kr.copy(new kr,t),r=kr.len(i);return s[e]=r,Oi(r,0,1e-5)||kr.multiplyScalar(i,i,1/r),i})),n=this._precomputedVIJs=new Float32Array(3*i*i);for(let t=0;t<i;++t){const o=s[t],a=r[t];for(let h=0;h<i;++h){if(t===h)continue;const l=s[h],c=r[h],u=(o+l)/2,d=3*(i*t+h);n[d+0]=(l-o)/u,n[d+1]=FJ(a,c)*e,n[d+2]=u}}this._cacheVIXAngles=new Float32Array(i)}interpolate(t,e){const{_exampleDirections:i,_exampleMagnitudes:s,_precomputedVIJs:r,_cacheVIXAngles:n}=this,{_CACHE_INPUT_DIRECTION:o,_CACHE_VIJ:a,_CACHE_VIX:h,_ANGLE_MULTIPLIER:l}=BJ,c=i.length;if(t.length,0===c)return;if(1===c)return void(t[0]=1);const u=e,d=kr.len(u),_=n;if(kr.equals(u,kr.ZERO))for(let t=0;t<c;++t)_[t]=0;else{const t=kr.multiplyScalar(o,u,1/d);for(let e=0;e<c;++e){const s=i[e];kr.equals(s,kr.ZERO)?_[e]=0:_[e]=FJ(s,t)*l}}let p=0;for(let e=0;e<c;++e){const n=s[e],o=i[e];let l=Number.POSITIVE_INFINITY;for(let t=0;t<c;++t){if(e===t)continue;const s=i[t],p=3*(c*e+t),{[p+0]:m,[p+1]:g,[p+2]:f}=r;let y=g,b=_[e];kr.equals(o,kr.ZERO)?y=_[t]:kr.equals(s,kr.ZERO)?y=_[e]:kr.equals(u,kr.ZERO)&&(b=y);const v=kr.set(a,m,y),S=kr.set(h,(d-n)/f,b),T=1-kr.dot(S,v)/kr.lengthSqr(v);if(T<=0){l=0;break}l=Math.min(l,T)}t[e]=l,p+=l}if(p>0)for(let e=0;e<c;++e)t[e]/=p;else{const e=1/c;for(let i=0;i<c;++i)t[i]=e}}}function FJ(t,e){const i=kr.angle(t,e);return t.x*e.y-t.y*e.x<0?-i:i}var NJ,LJ,kJ,zJ,UJ,VJ,jJ,HJ,GJ,WJ;BJ._CACHE_INPUT_DIRECTION=new kr,BJ._CACHE_VIJ=new kr,BJ._CACHE_VIX=new kr,BJ._ANGLE_MULTIPLIER=1;const{ccclass:XJ,serializable:YJ}=il,qJ={SIMPLE_DIRECTIONAL:0,FREEFORM_CARTESIAN:1,FREEFORM_DIRECTIONAL:2};fe(qJ);let $J=XJ(`${$H}AnimationBlend2DItem`)((LJ=class t extends $Q{constructor(...t){super(...t),this.threshold=kJ&&kJ()}clone(){const e=new t;return this._copyTo(e),e}_copyTo(t){return super._copyTo(t),kr.copy(t.threshold,this.threshold),t}},kJ=Za(LJ.prototype,"threshold",[YJ],(function(){return new kr})),NJ=LJ))||NJ,KJ=XJ("cc.animation.AnimationBlend2D")((WJ=class t extends KQ{constructor(...t){super(...t),this._items=VJ&&VJ(),this.paramX=jJ&&jJ(),this.paramY=HJ&&HJ(),this._algorithm=GJ&&GJ(),this._polarSpaceGBI=void 0}get algorithm(){return this._algorithm}set algorithm(t){t!==this._algorithm&&(this._algorithm=t,this._tryReconstructPolarSpaceInterpolator())}get items(){return this._items}set items(t){this._items=Array.from(t),this._tryReconstructPolarSpaceInterpolator()}__callOnAfterDeserializeRecursive(){this._tryReconstructPolarSpaceInterpolator()}clone(){const e=new t;return this.copyTo(e),e._items=this._items.map((t=>{var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),e.paramX=this.paramX.clone(),e.paramY=this.paramY.clone(),e.algorithm=this._algorithm,e}[E$](t,e){const{algorithm:i}=this;let s;2===i?(this._polarSpaceGBI,s=new QJ(t,e,this,this._items,this._polarSpaceGBI,[0,0])):s=new ZJ(t,e,this,this._items,this._items.map((({threshold:t})=>t)),i,[0,0]);const r=uJ(t,this.paramX,0,s.setInput,s,0),n=uJ(t,this.paramY,0,s.setInput,s,1);return s.setInput(r,0),s.setInput(n,1),s}_tryReconstructPolarSpaceInterpolator(){2===this._algorithm?this._polarSpaceGBI=new BJ(this._items.map((t=>t.threshold))):this._polarSpaceGBI=void 0}},WJ.Algorithm=qJ,WJ.Item=$J,VJ=Za((UJ=WJ).prototype,"_items",[YJ],(function(){return[]})),jJ=Za(UJ.prototype,"paramX",[YJ],(function(){return new lJ})),HJ=Za(UJ.prototype,"paramY",[YJ],(function(){return new lJ})),GJ=Za(UJ.prototype,"_algorithm",[YJ],(function(){return 0})),zJ=UJ))||zJ;class ZJ extends ZQ{constructor(t,e,i,s,r,n,o){super(t,e,i,s,o),this._thresholds=void 0,this._algorithm=void 0,this._value=new kr,this._thresholds=r,this._algorithm=n,this.doEval()}eval(t,[e,i]){switch(kr.set(this._value,e,i),t.fill(0),this._algorithm){case 0:IJ(t,this._thresholds,this._value);break;case 1:MJ(t,this._thresholds,this._value)}}}class QJ extends ZQ{constructor(t,e,i,s,r,n){super(t,e,i,s,n),this._interpolator=void 0,this._value=new kr,this._interpolator=r,this.doEval()}eval(t,[e,i]){kr.set(this._value,e,i),t.fill(0),this._interpolator.interpolate(t,this._value)}}var JJ,t0,e0,i0,s0,r0;const{ccclass:n0,serializable:o0}=il;let a0=n0(`${$H}AnimationBlendDirectItem`)((t0=class t extends $Q{constructor(...t){super(...t),this.weight=e0&&e0()}clone(){const e=new t;return this._copyTo(e),e}_copyTo(t){return super._copyTo(t),t.weight=this.weight,t}},e0=Za(t0.prototype,"weight",[o0],(function(){return new lJ(0)})),JJ=t0))||JJ;n0("cc.animation.AnimationBlendDirect")((r0=class t extends KQ{constructor(...t){super(...t),this._items=s0&&s0()}get items(){return this._items}set items(t){this._items=Array.from(t)}clone(){const e=new t;return this.copyTo(e),e._items=this._items.map((t=>{var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),e}[E$](t,e){const i=new h0(t,e,this,this._items,new Array(this._items.length).fill(0));for(let e=0;e<this._items.length;++e){const s=uJ(t,this._items[e].weight,0,i.setInput,i,e);i.setInput(s,e)}return i}},r0.Item=a0,s0=Za((i0=r0).prototype,"_items",[o0],(function(){return[]})),i0));class h0 extends ZQ{constructor(...t){super(...t),this.doEval()}eval(t,e){const i=t.length;for(let s=0;s<i;++s)t[s]=e[s]}}var l0,c0,u0,d0,_0,p0,m0,g0;let f0,y0=ah("cc.JointMask")((c0=class{constructor(){this.path=u0&&u0(),this.enabled=d0&&d0()}},u0=Za(c0.prototype,"path",[vh],(function(){return""})),d0=Za(c0.prototype,"enabled",[vh],(function(){return!0})),l0=c0))||l0;var b0,v0,S0,T0,w0,x0,C0,A0,D0,E0,I0,M0,P0;_0=ah(`${$H}AnimationMask`),p0=Xh(y0),_0((m0=class extends fm{constructor(...t){super(...t),this._jointMasks=g0&&g0()}get joints(){return this._jointMasks}set joints(t){this.clear();for(const e of t)this.addJoint(e.path,e.enabled)}addJoint(t,e){this.removeJoint(t);const i=new y0;i.path=t,i.enabled=e,this._jointMasks.push(i)}removeJoint(t){ne(this._jointMasks,(({path:e})=>e===t))}clear(){this._jointMasks.length=0}filterDisabledNodes(t){const{_jointMasks:e}=this,i=e.length,s=new Set;for(let r=0;r<i;++r){const{path:i,enabled:n}=e[r];if(n)continue;const o=t.getChildByPath(i);o&&s.add(o)}return s}isExcluded(t){var e,i;return!(null===(e=null==(i=this._jointMasks.find((({path:e})=>e===t)))?void 0:i.enabled)||void 0===e||e)}},g0=Za(m0.prototype,"_jointMasks",[vh],(function(){return[]})),s(m0.prototype,"joints",[p0],Object.getOwnPropertyDescriptor(m0.prototype,"joints"),m0.prototype),m0));let O0=ah(`${$H}ClipOverrideEntry`)((v0=class{constructor(){this.original=S0&&S0(),this.substitution=T0&&T0()}},S0=Za(v0.prototype,"original",[vh],(function(){return null})),T0=Za(v0.prototype,"substitution",[vh],(function(){return null})),b0=v0))||b0,R0=(w0=ah(`${$H}AnimationGraphVariant`),x0=Xh(D$),w0((A0=class extends wY{constructor(...t){super(...t),this._graph=D0&&D0(),this._clipOverrides=E0&&E0()}get original(){return this._graph}set original(t){this._graph=t}get clipOverrides(){return this._clipOverrides}},s(A0.prototype,"original",[x0],Object.getOwnPropertyDescriptor(A0.prototype,"original"),A0.prototype),D0=Za(A0.prototype,"_graph",[vh],(function(){return null})),E0=Za(A0.prototype,"_clipOverrides",[vh],(function(){return new B0})),C0=A0))||C0),B0=ah(`${$H}ClipOverrideMap`)((f0=Symbol.iterator,M0=class{constructor(){this._entries=P0&&P0()}get size(){return this._entries.length}[f0](){return this._entries[Symbol.iterator]()}has(t){return!!this._entries.find((({original:e})=>e===t))}get(t){const e=this._entries.find((({original:e})=>e===t));return null==e?void 0:e.substitution}set(t,e){const i=this._entries.find((({original:e})=>e===t));if(i)i.substitution=e;else{const i=new O0;i.original=t,i.substitution=e,this._entries.push(i)}}delete(t){ne(this._entries,(({original:e})=>e===t))}clear(){this._entries.length=0}},P0=Za(M0.prototype,"_entries",[vh],(function(){return[]})),I0=M0))||I0;const F0=10,N0=Ms.fromArray,L0=Ms.toArray,k0=sr.fromArray,z0=sr.toArray;class U0{static get BYTES_PER_ELEMENT(){return 80}constructor(t,e,i){this._data=void 0,this._data=void 0===t?new Float64Array:"number"==typeof t?new Float64Array(F0*t):new Float64Array(t,e,"number"==typeof i?F0*i:void 0)}get buffer(){return this._data.buffer}get byteLength(){return this._data.byteLength}get byteOffset(){return this._data.byteOffset}get length(){return this._data.length/F0}getTransform(t,e){const{_data:i}=this,{position:s,rotation:r,scale:n}=e,o=F0*t;return N0(s,i,o),k0(r,i,o+3),N0(n,i,o+7),e}getPosition(t,e){const{_data:i}=this;return N0(e,i,F0*t),e}getRotation(t,e){const{_data:i}=this;return k0(e,i,F0*t+3),e}getScale(t,e){const{_data:i}=this;return N0(e,i,F0*t+7),e}setTransform(t,e){const{_data:i}=this,{position:s,rotation:r,scale:n}=e,o=F0*t;L0(i,s,o),z0(i,r,o+3),L0(i,n,o+7)}setPosition(t,e){const{_data:i}=this;L0(i,e,F0*t)}setRotation(t,e){const{_data:i}=this;z0(i,e,F0*t+3)}setScale(t,e){const{_data:i}=this;L0(i,e,F0*t+7)}copyWithin(t,e,i){this._data.copyWithin(t*F0,e*F0,"number"==typeof i?i*F0:void 0)}fill(t,e,i){var s,r;const{length:n}=this;if(null!==(s=e)&&void 0!==s||(e=0),null!==(r=i)&&void 0!==r||(i=n),!(e>=n)){this.setTransform(e,t);for(let t=e+1;t<i;++t)this.copyWithin(t,e,e+1)}}fillZero(t,e){this._data.fill(0,"number"==typeof t?t*F0:void 0,"number"==typeof e?e*F0:void 0)}set(t,e){this._data.set(t._data,"number"==typeof e?e*F0:void 0)}slice(t,e){const i=this._data.slice("number"==typeof t?t*F0:void 0,"number"==typeof e?e*F0:void 0);return new U0(i.buffer,i.byteOffset,i.length/F0)}copyRange(t,e,i,s){const r=F0*s,n=this._data,o=F0*t,a=e._data,h=F0*i;for(let t=0;t<r;++t)n[o+t]=a[h+t]}}const V0=Symbol(""),j0=Symbol("");class H0{constructor(t){this.buffer=void 0,this.useCount=0,this.buffer=new ArrayBuffer(t)}}class G0{constructor(t,e){this._locking=!1,this._pages=[],this._allocatorCount=0,this._manager=t,this._pageSize=e}get pageSize(){return this._pageSize}get debugLocking(){return this._locking}get allocatorCount(){return this._allocatorCount}debugLock(){this._locking,this._locking=!0}debugUnlock(){this._locking,this._locking=!1}getPageMemory(t){return t>=0&&this._pages.length,this._pages[t].buffer}pushPage(t){const e=t[V0];this._pages.length,e===this._pages.length&&this._pushNewPage(),this._pages.length;const i=this._pages[e];return++i.useCount,++t[V0],i}popPage(t){const e=t[V0]-1,i=this._pages[e];i.useCount,--i.useCount,--t[V0],0===i.useCount&&(this._pages.length,this._pages.pop())}createAllocator(t){const e=new X0(this,t);return++this._allocatorCount,e}destroyAllocator(t){const e=t[V0];for(let t=0;t<e;++t){const e=this._pages[t];e.useCount,--e.useCount}this._allocatorCount,--this._allocatorCount,0===this._allocatorCount&&this._manager[j0](this)}_pushNewPage(){const t=new H0(this._pageSize);this._pages.push(t)}}class W0{constructor(t,e){this.buffer=t,this.byteOffset=e}}class X0{constructor(t,e){this[V0]=0,this._slicesPerPage=0,this._slices=[],this._resource=t,this._sliceSize=e;const i=Math.floor(this._resource.pageSize/e);this._slicesPerPage=i}get isEmpty(){return 0===this._slices.length}destroy(){this._slices.length,this._resource.debugLocking,this._resource.destroyAllocator(this)}debugLock(){this._resource.debugLock()}debugUnlock(){this._resource.debugUnlock()}push(){const{_sliceSize:t,_slices:e,_slicesPerPage:i}=this,s=e.length;let r=0,n=0;0===t?(0===this[V0]&&this._resource.pushPage(this),this[V0]):(s===i*this[V0]&&(this._resource.pushPage(this),this[V0]),r=s%i,n=(s-r)/i,this[V0]);const o=this._resource.getPageMemory(n),a=new W0(o,t*r);return this._slices.push(a),a}pop(){const{_slices:t,_slicesPerPage:e}=this,i=t.length-1;0===this._sliceSize?(this[V0],0===i&&this._resource.popPage(this)):0==i%e&&this._resource.popPage(this),this._slices.pop()}}class Y0{constructor(t,e){this._poses=[],this._allocatedCount=0,this._memoryAllocator=void 0,this._transformCount=t,this._auxiliaryCurveCount=e;const i=q0(t,e,1);this._memoryAllocator=K0.createAllocator(i)}destroy(){this._allocatedCount;for(let t=0;t<this._poses.length;++t)this._memoryAllocator.pop();return this._poses.length=0,this._memoryAllocator.destroy()}get allocatedCount(){return this._allocatedCount}push(){0===this._allocatedCount&&this._memoryAllocator.debugLock(),this._allocatedCount===this._poses.length&&(this._allocateNewPose(),this._allocatedCount,this._poses.length);const t=this._poses[this._allocatedCount];return++this._allocatedCount,t}pop(){this._allocatedCount,--this._allocatedCount,0===this._allocatedCount&&this._memoryAllocator.debugUnlock()}get top(){return this._allocatedCount,this._poses[this._allocatedCount-1]}_allocateNewPose(){const t=this._memoryAllocator.push(),e=U0.BYTES_PER_ELEMENT*this._transformCount,i=t.byteOffset,s=new U0(t.buffer,i,this._transformCount),r=new Float64Array(t.buffer,i+e,this._auxiliaryCurveCount),n=JZ._create(s,r);this._poses.push(n)}}function q0(t,e,i){return(U0.BYTES_PER_ELEMENT*t+8*e)*i}const $0=q0(128,10,4),K0=new class{constructor(t){this._stacks=new Map,this._thresholds=t,t.every(((t,e,i)=>0===e||t>i[e-1]))}get isEmpty(){return 0===this._stacks.size}createAllocator(t){const e=t,i=this._selectStackPageSize(e);let s=this._stacks.get(i);return s||(s=new G0(this,i),this._stacks.set(i,s)),s.createAllocator(e)}[j0](t){for(const[e,i]of this._stacks)if(i===t){this._stacks.delete(e);break}}_selectStackPageSize(t){let e=Ga(this._thresholds,t),i=t;return e>=0?i=this._thresholds[e]:(e=~e,e===this._thresholds.length||(e>=0&&this._thresholds.length,i=this._thresholds[e])),i}}([$0]);function Z0(t,e){const i=t.length;let s=0;for(;s<i&&e(t[s],s,t);++s);if(s===i)return i;let r=s;for(let n=s+1;n<i;++n){const i=t[n];if(e(i,n,t)){const e=i;t[n]=t[r],t[r]=e,++r}}return r}const Q0=Symbol("PoseHeapAllocator");class J0{constructor(t,e){this._transformCount=0,this._metaValueCount=0,this._pages=[],this._allocatedCount=0,this._foremostPossibleFreePage=0,this._transformCount=t,this._metaValueCount=e}get allocatedCount(){return this._allocatedCount}allocatePose(){++this._allocatedCount;const{_pages:t}=this,e=t.length;for(let i=this._foremostPossibleFreePage;i<e;++i){const e=t[i],s=e.tryAllocate();if(s)return s[Q0].pageIndex=i,0===e.freeCount&&++this._foremostPossibleFreePage,s}const i=this._allocatePoseInNewPage();return this._foremostPossibleFreePage=i[Q0].pageIndex,i}destroyPose(t){const{_pages:e}=this;e.length;const i=t[Q0].pageIndex,s=e[i];s.deallocate(t),--this._allocatedCount,i<this._foremostPossibleFreePage&&(s.freeCount,this._foremostPossibleFreePage=i)}_allocatePoseInNewPage(){const t=new s1(this._transformCount,this._metaValueCount,4),e=this._pages.length;this._pages.push(t);const i=t.tryAllocate();return i[Q0].pageIndex=e,i}}class t1{constructor(){this._id=-1}get pageIndex(){return this._id>>i1}set pageIndex(t){this._id&=e1,this._id|=t<<i1}get poseIndex(){return this._id&e1}set poseIndex(t){this._id&=-8,this._id|=t}}const e1=7,i1=3;class s1{constructor(t,e,i){this._buffer=void 0,this._idleFlags=15,this._poses=void 0,this._freeCount=0,this._transformCount=t,this._metaValueCount=e,this._capacity=i;const s=(U0.BYTES_PER_ELEMENT*t+8*e)*i;this._buffer=new ArrayBuffer(s),this._poses=new Array(i).fill(null),this._freeCount=i}get capacity(){return this._capacity}get freeCount(){return this._freeCount}tryAllocate(){var t;const{_poses:e,_idleFlags:i,_capacity:s}=this,r=r1(i);if(r>=s)return null;r>=0&&e.length;const n=null!==(t=e[r])&&void 0!==t?t:e[r]=this._createPose(r);return n[Q0].poseIndex=r,this._idleFlags&=~(1<<r),this._freeCount,--this._freeCount,n}deallocate(t){const{_poses:e}=this,i=t[Q0].poseIndex;i>=0&&e.length,e[i],this._idleFlags|=1<<i,this._freeCount,this._capacity,++this._freeCount}_createPose(t){const e=U0.BYTES_PER_ELEMENT*this._transformCount,i=(e+8*this._metaValueCount)*t,s=new U0(this._buffer,i,this._transformCount),r=new Float64Array(this._buffer,i+e,this._metaValueCount),n=JZ._create(s,r);return n[Q0]=new t1,n}}function r1(t){return 0===t?1/0:Math.log2(t&-t)}var n1,o1,a1,h1,l1,c1,u1,d1;function _1(t,e){if(t.name===e)return t;const i=t.children.length;for(let s=0;s<i;++s){const i=_1(t.children[s],e);if(i)return i}return null}class p1{constructor(t,e,i,s){this._origin=void 0,this._layoutMaintainer=void 0,this._varRegistry=void 0,this._additiveFlagStack=[],this._triggerResetter=t=>this._resetTrigger(t),this._isLayerWideContextPropertiesSet=!1,this._stashView=void 0,this._motionSyncManager=void 0,this._clipOverrides=void 0,this._controller=s,this._origin=t,this._layoutMaintainer=e,this._varRegistry=i,this._additiveFlagStack=[!1]}get origin(){return this._origin}get controller(){return this._controller}get triggerResetter(){return this._triggerResetter}get clipOverrides(){return this._clipOverrides}get additive(){const{_additiveFlagStack:t}=this;return t[t.length-1]}bindTransform(t){const e=this._origin.getChildByPath(t);return e?this._layoutMaintainer.getOrCreateTransformBinding(e):null}bindTransformByName(t){const e=_1(this._origin,t);return e?this._layoutMaintainer.getOrCreateTransformBinding(e):null}getBoneChildren(t){const e=_1(this._origin,t);return e?e.children.map((t=>t.name)):[]}getParentBoneNameByName(t){var e;const i=_1(this._origin,t);return i?i===this._origin?"":null==(e=i.parent)?void 0:e.name:null}bindAuxiliaryCurve(t){return this._layoutMaintainer.getOrCreateAuxiliaryCurveBinding(t)}getEvaluationTimeAuxiliaryCurveView(){return this._layoutMaintainer.auxiliaryCurveRegistry}getVar(t){return this._varRegistry[t]}_pushAdditiveFlag(t){this._additiveFlagStack.push(t)}_popAdditiveFlag(){this._additiveFlagStack.length,this._additiveFlagStack.pop()}_integrityCheck(){return 1===this._additiveFlagStack.length}get stashView(){return this._stashView,this._stashView}get motionSyncManager(){return this._motionSyncManager,this._motionSyncManager}_setLayerWideContextProperties(t,e){this._isLayerWideContextPropertiesSet,this._isLayerWideContextPropertiesSet=!0,this._stashView=t,this._motionSyncManager=e}_unsetLayerWideContextProperties(){this._isLayerWideContextPropertiesSet,this._isLayerWideContextPropertiesSet=!1,this._stashView=void 0,this._motionSyncManager=void 0}_setClipOverrides(t){this._clipOverrides=t}_resetTrigger(t){const e=this._varRegistry[t];e&&(e.value=!1)}}const m1=new YZ;class g1{constructor(){this._namedCurves=new Map}names(){return this._namedCurves.keys()}has(t){return this._namedCurves.has(t)}get(t){var e;return null!==(e=this._namedCurves.get(t))&&void 0!==e?e:0}set(t,e){this._namedCurves.set(t,e)}}let f1=(n1=()=>{},o1=()=>{},a1=()=>{},h1=()=>{},l1=()=>{},c1=()=>{},u1=()=>{},d1=class{constructor(t,e){this._origin=void 0,this._auxiliaryCurveRegistry=void 0,this._auxiliaryCurveRecords=[],this._transformRecords=[],this._parentTable=[],this._bindStarted=!1,this._transformCountBeforeBind=-1,this._auxiliaryCurveCountBeforeBind=-1,this._origin=t,this._auxiliaryCurveRegistry=e}get transformCount(){return this._transformRecords.length}get auxiliaryCurveCount(){return this._auxiliaryCurveRecords.length}get auxiliaryCurveRegistry(){return this._auxiliaryCurveRegistry}getOrCreateTransformBinding(t){const{_origin:e}=this;let i=!1;for(let s=t;s;s=s.parent)if(s===e){i=!0;break}if(!i)return null;const s=this._getOrCreateTransformBinding(t);if(t!==e)for(let i=t.parent;i!==e;i=i.parent)this._getOrCreateTransformBinding(i);return s}_getOrCreateTransformBinding(t){const{_transformRecords:e}=this,i=e.findIndex((e=>e.node===t));if(i>=0){const t=e[i];return++t.refCount,t.handle}let s=0;for(let i=t.parent;i;i=i.parent){const t=e.findIndex((t=>t.node===i));if(t>=0){s=t+1;break}}for(let t=s;t<e.length;++t)++e[t].handle.index;const r=new y1(new A1(this,s),t);return e.splice(s,0,r),r.handle}getOrCreateAuxiliaryCurveBinding(t){const{_auxiliaryCurveRecords:e}=this,i=e.findIndex((e=>e.name===t));if(i>=0){const t=e[i];return++t.refCount,t.handle}{const i=e.length,s=new b1(new D1(this,i),t);return e.push(s),s.handle}}createEvaluationContext(){return this._bindStarted,new C1(this.transformCount,this.auxiliaryCurveCount,this._parentTable.slice(),this._origin)}resetPoseStashAllocator(t){this._bindStarted,t._reset(this.transformCount,this.auxiliaryCurveCount)}createTransformFilter(t){const{_origin:e}=this,i=[];for(const{node:r,handle:n}of this._transformRecords){const o=s(e,r);if(void 0===o)P(`${r.getPathInHierarchy()} is not a child of ${e.getPathInHierarchy()}`);else if(t.isExcluded(o))continue;i.push(n.index)}return i.sort(),new tQ(i);function s(t,e){const i=[];for(let s=e;s;s=s.parent){if(s===t)return i.join("/");i.unshift(s.name)}}}fetchDefaultTransforms(t){const e=this._transformRecords.length;t.length;for(let i=0;i<e;++i){const{defaultTransform:e}=this._transformRecords[i];t.setTransform(i,e)}}apply(t){const{transforms:e,auxiliaryCurves:i}=t,s=this._transformRecords.length;e.length;for(let t=0;t<s;++t){const i=e.getTransform(t,m1),{node:s}=this._transformRecords[t];s.setRTS(i.rotation,i.position,i.scale)}const r=this._auxiliaryCurveRecords.length;for(let t=0;t<r;++t){const{name:e}=this._auxiliaryCurveRecords[t],s=i[t];this._auxiliaryCurveRegistry.set(e,s)}}_destroyTransformHandle(t){t>=0&&this._transformRecords.length;const e=this._transformRecords[t];e.refCount,--e.refCount}_destroyAuxiliaryCurveHandle(t){t>=0&&this._auxiliaryCurveRecords.length;const e=this._auxiliaryCurveRecords[t];e.refCount,--e.refCount}startBind(){this._bindStarted=!0,this._transformCountBeforeBind=this._transformRecords.length,this._auxiliaryCurveCountBeforeBind=this._auxiliaryCurveRecords.length}endBind(){const{_transformRecords:t,_auxiliaryCurveRecords:e}=this;let i=0;if(v1(t),t.length!==this._transformCountBeforeBind){i|=1;const e=t.length;for(let i=0;i<e;++i)t[i].order=i}else{const e=t.length;let s=!1;for(let i=0;i<e;++i){const e=t[i];e.order!==i&&(s=!0,e.order=i)}s&&(i|=2)}v1(e),e.length!==this._auxiliaryCurveCountBeforeBind&&(i|=4);const{_parentTable:s,_origin:r}=this;s.length=t.length;for(let e=0;e<t.length;++e){const{node:i}=t[e];if(i===r){s[e]=-1;continue}const n=i.parent;if(n===r){const i=t.findIndex((t=>t.node===n));s[e]=i>=0?i:-1}else{const i=t.findIndex((t=>t.node===n));s[e]=i}}return this._bindStarted=!1,i}},s(d1.prototype,"getOrCreateTransformBinding",[n1],Object.getOwnPropertyDescriptor(d1.prototype,"getOrCreateTransformBinding"),d1.prototype),s(d1.prototype,"_getOrCreateTransformBinding",[o1],Object.getOwnPropertyDescriptor(d1.prototype,"_getOrCreateTransformBinding"),d1.prototype),s(d1.prototype,"getOrCreateAuxiliaryCurveBinding",[a1],Object.getOwnPropertyDescriptor(d1.prototype,"getOrCreateAuxiliaryCurveBinding"),d1.prototype),s(d1.prototype,"_destroyTransformHandle",[h1],Object.getOwnPropertyDescriptor(d1.prototype,"_destroyTransformHandle"),d1.prototype),s(d1.prototype,"_destroyAuxiliaryCurveHandle",[l1],Object.getOwnPropertyDescriptor(d1.prototype,"_destroyAuxiliaryCurveHandle"),d1.prototype),s(d1.prototype,"startBind",[c1],Object.getOwnPropertyDescriptor(d1.prototype,"startBind"),d1.prototype),s(d1.prototype,"endBind",[u1],Object.getOwnPropertyDescriptor(d1.prototype,"endBind"),d1.prototype),d1);class y1{constructor(t,e){this.order=-1,this.refCount=1,this.handle=void 0,this.node=void 0,this.defaultTransform=void 0,this.handle=t,this.node=e;const i=new YZ;i.position=e.position,i.rotation=e.rotation,i.scale=e.scale,this.defaultTransform=i}}class b1{constructor(t,e){this.refCount=1,this.handle=void 0,this.name=void 0,this.handle=t,this.name=e}}function v1(t){const e=Z0(t,(t=>(t.refCount,t.refCount>0)));if(t.length,e!==t.length){for(let i=0;i<e;++i)t[i].handle.index=i;t.splice(e,t.length-e)}}const S1=Symbol("[[DefaultTransforms]]");class T1{constructor(t){this._layoutMaintainer=t}get transformCount(){return this._layoutMaintainer.transformCount}createTransformFilter(t){return this._layoutMaintainer.createTransformFilter(t)}}const w1=new YZ,x1=new YZ;class C1{constructor(t,e,i,s){this[S1]=void 0,this._poseAllocator=void 0,this._parentTable=void 0,this._componentNode=void 0,this._cacheComponentToWorldTransform=new YZ,this._poseAllocator=new Y0(t,e),this._parentTable=i,this._componentNode=s,this[S1]=new U0(t)}destroy(){this._poseAllocator.destroy()}get allocatedPoseCount(){return this._poseAllocator.allocatedCount}get parentTable(){return this._parentTable}pushDefaultedPose(){const t=this._poseAllocator.push();return t.transforms.set(this[S1]),t._poseTransformSpace=0,t.auxiliaryCurves.fill(0),t}pushDefaultedPoseInComponentSpace(){const t=this.pushDefaultedPose();return this._poseTransformsSpaceLocalToComponent(t),t}pushZeroDeltaPose(){const t=this._poseAllocator.push();return t.transforms.fill(QZ),t._poseTransformSpace=0,t.auxiliaryCurves.fill(0),t}pushDuplicatedPose(t){const e=this._poseAllocator.push();return e.transforms.set(t.transforms),e._poseTransformSpace=t._poseTransformSpace,e.auxiliaryCurves.set(t.auxiliaryCurves),e}popPose(){this._poseAllocator.pop()}get _stackSize_debugging(){return this._poseAllocator.allocatedCount}_isStackTopPose_debugging(t){return t===this._poseAllocator.top}_poseTransformsSpaceLocalToComponent(t){const{transforms:e}=t,{length:i}=e;for(let t=0;t<i;++t){const i=this._parentTable[t];if(i<0)continue;const s=e.getTransform(t,w1),r=e.getTransform(i,x1);YZ.multiply(s,r,s),e.setTransform(t,s)}t._poseTransformSpace=1}_poseTransformsSpaceComponentToLocal(t){const{transforms:e}=t,{length:i}=e;for(let t=i-1;t>=0;--t){const i=this._parentTable[t];if(i<0)continue;const s=e.getTransform(t,w1),r=e.getTransform(i,x1);YZ.calculateRelative(s,s,r),e.setTransform(t,s)}t._poseTransformSpace=0}_convertPoseSpaceTransformToTargetSpace(t,e,i,s){const r=i._poseTransformSpace;switch(e){default:break;case 0:1===r?YZ.multiply(t,this._getComponentToWorldTransform(),t):YZ.multiply(t,this._getLocalToWorldTransform(x1,i,s),t);break;case 1:1===r||YZ.multiply(t,this._getLocalToComponentTransform(x1,i,s),t);break;case 2:if(1===r){const e=this._parentTable[s];if(e>=0){const s=i.transforms.getTransform(e,x1),r=YZ.invert(s,s);YZ.multiply(t,r,t)}}break;case 3:{const e=i.transforms.getTransform(s,x1),r=YZ.invert(e,e);YZ.multiply(t,r,t);break}}return t}_convertTransformToPoseTransformSpace(t,e,i,s){const r=i._poseTransformSpace;switch(e){default:break;case 0:if(1===r){const e=YZ.invert(x1,this._getComponentToWorldTransform());YZ.multiply(t,e,t)}else{const e=this._getLocalToWorldTransform(x1,i,s),r=YZ.invert(e,e);YZ.multiply(t,r,t)}break;case 1:if(1===r);else{const e=this._getLocalToComponentTransform(x1,i,s),r=YZ.invert(e,e);YZ.multiply(t,r,t)}break;case 2:if(1===r){const e=this._parentTable[s];if(e>=0){const s=i.transforms.getTransform(e,x1);YZ.multiply(t,s,t)}}break;case 3:{const e=i.transforms.getTransform(s,x1);YZ.multiply(t,e,t);break}}return t}_getComponentToWorldTransform(){const t=this._cacheComponentToWorldTransform,e=this._componentNode;return t.position=e.worldPosition,t.rotation=e.worldRotation,t.scale=e.worldScale,t}_getLocalToComponentTransform(t,e,i){const{_parentTable:s}=this;YZ.setIdentity(t);for(let r=s[i];r>=0;r=s[r]){const i=e.transforms.getTransform(r,w1);YZ.multiply(t,i,t)}return t}_getLocalToWorldTransform(t,e,i){return this._getLocalToComponentTransform(t,e,i),YZ.multiply(t,this._getComponentToWorldTransform(),t),t}}class A1{constructor(t,e){this.index=-1,this._host=void 0,this._host=t,this.index=e}destroy(){this._host._destroyTransformHandle(this.index)}}class D1{constructor(t,e){this.index=-1,this._host=void 0,this._host=t,this.index=e}destroy(){this._host._destroyAuxiliaryCurveHandle(this.index)}}class E1{constructor(){this._context={deltaTime:0,indicativeWeight:0}}generate(t,e){return this._context.deltaTime=t,this._context.indicativeWeight=e,this._context}forkSubWeight(t,e){this._context.deltaTime=t.deltaTime,this._context.indicativeWeight=t.indicativeWeight*e}}class I1{constructor(){this._allocator=null}get allocatedPoseCount(){return this._allocator,this._allocator.allocatedCount}_reset(t,e){this._allocator=new J0(t,e)}allocatePose(){return this._allocator,this._allocator.allocatePose()}destroyPose(t){return this._allocator,this._allocator.destroyPose(t)}}var M1,P1,O1,R1;const{ccclass:B1,serializable:F1}=il;B1(`${$H}UnaryCondition`)((R1=class t{constructor(){this.operator=P1&&P1(),this.operand=O1&&O1()}clone(){const e=new t;return e.operator=this.operator,e.operand=this.operand.clone(),e}[E$](t){const{operator:e,operand:i}=this,s=new N1(e,!1),r=uJ(t,i,1,s.setOperand,s);return s.reset(r),s}},R1.Operator={TRUTHY:0,FALSY:1},P1=Za((M1=R1).prototype,"operator",[F1],(function(){return 0})),O1=Za(M1.prototype,"operand",[F1],(function(){return new cJ})),M1));class N1{constructor(t,e){this._operator=t,this._operand=e,this._eval()}reset(t){this.setOperand(t)}setOperand(t){this._operand=t,this._eval()}eval(){return this._result}_eval(){const{_operand:t}=this;switch(this._operator){default:case 0:this._result=!!t;break;case 1:this._result=!t}}}class L1{}var k1,z1,U1,V1;const{ccclass:j1,serializable:H1}=il;let G1=j1(`${$H}TCVariableBinding`)((z1=class extends L1{constructor(...t){super(...t),this.type=U1&&U1(),this.variableName=V1&&V1()}getValueType(){return this.type}bind(t){const e=t.getVar(this.variableName);if(e)return new W1(e)}},U1=Za(z1.prototype,"type",[H1,Th],(function(){return 0})),V1=Za(z1.prototype,"variableName",[H1],(function(){return""})),k1=void(k1=z1)||k1))||k1;class W1{constructor(t){this._varInstance=t}evaluate(){return this._varInstance.value}}var X1,Y1,q1;const{ccclass:$1,serializable:K1}=il;$1(`${$H}TCAuxiliaryCurveBinding`)((Y1=class extends L1{constructor(...t){super(...t),this.curveName=q1&&q1()}getValueType(){return 0}bind(t){const e=t.getEvaluationTimeAuxiliaryCurveView();return new Z1(e,this.curveName)}},q1=Za(Y1.prototype,"curveName",[K1],(function(){return""})),X1=void(X1=Y1)||X1));class Z1{constructor(t,e){this._view=t,this._curveName=e}evaluate(){return this._view.get(this._curveName)}}var Q1;const{ccclass:J1}=il;J1(`${$H}TCStateWeightBinding`)(Q1=void(Q1=void(Q1=class extends L1{getValueType(){return 0}bind(t){return new t2}})||Q1)||Q1);class t2{evaluate(t){return t.sourceStateWeight}}var e2;const{ccclass:i2}=il;i2(`${$H}TCStateMotionTimeBinding`)(e2=void(e2=void(e2=class extends L1{getValueType(){return 0}bind(t){return new s2}})||e2)||e2);class s2{evaluate(t){return t.sourceStateMotionTimeNormalized}}var r2,n2,o2,a2,h2,l2;const{ccclass:c2,serializable:u2}=il;c2(`${$H}BinaryCondition`)(((l2=class t{constructor(){this.operator=n2&&n2(),this.lhs=o2&&o2(),this.lhsBinding=a2&&a2(),this.rhs=h2&&h2()}clone(){const e=new t;return e.operator=this.operator,e.lhs=this.lhs,e.lhsBinding=HX(this.lhsBinding),e.rhs=this.rhs,e}[E$](t){var e;const i=null==(e=this.lhsBinding)?void 0:e.bind(t);return new d2(this.operator,this.lhs,this.rhs,i)}}).Operator={EQUAL_TO:0,NOT_EQUAL_TO:1,LESS_THAN:2,LESS_THAN_OR_EQUAL_TO:3,GREATER_THAN:4,GREATER_THAN_OR_EQUAL_TO:5},n2=Za((r2=l2).prototype,"operator",[u2],(function(){return 0})),o2=Za(r2.prototype,"lhs",[u2],(function(){return 0})),a2=Za(r2.prototype,"lhsBinding",[u2],(function(){return new G1})),h2=Za(r2.prototype,"rhs",[u2],(function(){return 0})),r2));class d2{constructor(t,e,i,s){this._operator=t,this._lhsBindingEvaluation=s,this._lhsValue=e,this._rhsValue=i}eval(t){var e,i;const s=null!==(e=null==(i=this._lhsBindingEvaluation)?void 0:i.evaluate(t))&&void 0!==e?e:this._lhsValue,r=this._rhsValue;switch(this._operator){default:case 0:return s===r;case 1:return s!==r;case 2:return s<r;case 3:return s<=r;case 4:return s>r;case 5:return s>=r}}}var _2,p2,m2;const{ccclass:g2,serializable:f2}=il;let y2=g2(`${$H}TriggerCondition`)((p2=class t{constructor(){this.trigger=m2&&m2()}clone(){const e=new t;return e.trigger=this.trigger,e}[E$](t){const e=new b2(!1),i=t.getVar(this.trigger);return dJ(i,this.trigger)&&(pJ(i.type,this.trigger),e.setTrigger(i.bind(e.setTrigger,e))),e}},m2=Za(p2.prototype,"trigger",[f2],(function(){return""})),_2=p2))||_2;class b2{constructor(t){this._triggered=!1,this._triggered=t}setTrigger(t){this._triggered=t}eval(){return this._triggered}}var v2;let S2=ah(`${$H}StateMachineComponent`)(v2=class{onMotionStateEnter(t,e){}onMotionStateExit(t,e){}onMotionStateUpdate(t,e){}onStateMachineEnter(t){}onStateMachineExit(t){}})||v2;var T2,w2,x2;let C2=ah(`${$H}MotionSyncInfo`)((w2=class{constructor(){this.group=x2&&x2()}},x2=Za(w2.prototype,"group",[vh],(function(){return""})),T2=w2))||T2;var A2,D2,E2,I2,M2,P2,O2,R2,B2,F2,N2,L2;const k2=1e-5;let z2=(A2=ah(`${$H}PoseNodePlayMotion`),D2=jY((t=>{t.category="i18n:ENGINE.animation_graph.pose_graph_node_sub_categories.pose_nodes/"})),E2=(t=>jY((e=>{e.factory=t})))((U2=t=>{const e=new z2;return e.motion=t,e},{listEntries:()=>[{arg:{type:"clip-motion"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_clip_motion"},{arg:{type:"animation-blend-1d"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_animation_blend_1d"},{arg:{type:"animation-blend-2d"},menu:"i18n:ENGINE.animation_graph.pose_graph_node_sub_menus.play_or_sample_animation_blend_2d"}],create:t=>{let e=null;switch(t.type){case"clip-motion":e=new LQ;break;case"animation-blend-1d":e=new DJ;break;case"animation-blend-2d":e=new KJ}return U2(e)}})),I2=HY({themeColor:"#227F9B"}),M2=ZY({type:0}),P2=ZY({type:0}),A2(O2=D2(O2=E2(O2=I2((R2=class extends $Y{constructor(...t){super(...t),this.motion=B2&&B2(),this.syncInfo=F2&&F2(),i(this,"startTime",N2,this),i(this,"speedMultiplier",L2,this),this._workspace=null,this._runtimeSyncRecord=void 0}get lastIndicativeWeight(){var t,e;return null!==(t=null==(e=this._workspace)?void 0:e.lastIndicativeWeight)&&void 0!==t?t:0}get elapsedMotionTime(){var t,e;return null!==(t=null==(e=this._workspace)?void 0:e.normalizedTime)&&void 0!==t?t:0}bind(t){const{motion:e}=this;if(!e)return;const i=e[E$](t,!1);i&&(this._workspace=new V2(i,i.createPort()),this.syncInfo.group&&(this._runtimeSyncRecord=t.motionSyncManager.register(this.syncInfo)))}settle(t){}reenter(){if(this._workspace){const{_runtimeSyncRecord:t,_workspace:{motionEval:{duration:e}}}=this;this._forceEvaluateEvaluation();const i=e<k2?0:Bi(this.startTime/e);t?t.notifyRenter(i):this._workspace.normalizedTime=i,this._workspace.lastIndicativeWeight=0}}doUpdate(t){if(this._workspace){const{deltaTime:e}=t,{_runtimeSyncRecord:i}=this,s=this._workspace.motionEval.duration;let r=0;s>k2&&(r=e*this.speedMultiplier/s),i?i.notifyUpdate(r,t.indicativeWeight):this._workspace.normalizedTime+=r,this._workspace.lastIndicativeWeight=t.indicativeWeight}}doEvaluate(t){if(this._workspace){const e=this._runtimeSyncRecord?this._runtimeSyncRecord.getSyncedEnterTime():this._workspace.normalizedTime;return this._workspace.motionEvalPort.evaluate(e,t)}return t.pushDefaultedPose()}},B2=Za(R2.prototype,"motion",[vh],(function(){return new LQ})),F2=Za(R2.prototype,"syncInfo",[vh],(function(){return new C2})),N2=s(R2.prototype,"startTime",[vh,M2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),L2=s(R2.prototype,"speedMultiplier",[vh,P2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),O2=R2))||O2)||O2)||O2)||O2);var U2;class V2{constructor(t,e){this.normalizedTime=0,this.lastIndicativeWeight=0,this.motionEval=t,this.motionEvalPort=e}}function j2(t){return t instanceof $Y||t instanceof KY}class H2{constructor(t,e){this._rootPoseNode=t,this._countingPlayMotionNodes=e}bind(t){var e;null==(e=this._rootPoseNode)||e.bind(t)}settle(t){var e;null==(e=this._rootPoseNode)||e.settle(t)}reenter(){var t;null==(t=this._rootPoseNode)||t.reenter()}update(t){var e;null==(e=this._rootPoseNode)||e.update(t)}evaluate(t){var e,i;return null!==(e=null==(i=this._rootPoseNode)?void 0:i.evaluate(t,1))&&void 0!==e?e:null}countMotionTime(){const{_countingPlayMotionNodes:t}=this;if(!t)return 0;let e=0,i=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;++s){const{elapsedMotionTime:r,lastIndicativeWeight:n}=t[s];n>i&&(i=n,e=r)}return e}}function G2(t,e,i=!1){const{outputNode:s}=t,r=t.getShell(s).getBindings();if(r.length,0===r.length)return new H2(void 0,i?[]:void 0);const n=r[0];n.outputIndex,n.producer;const o=new Map,a=W2(t,n.producer,o,e);return new H2(a,i?Array.from(o.values()).filter((t=>t instanceof z2)):void 0)}function W2(t,e,i,s){const r=t.getShell(e),n=i.get(e);if(n)return n;const o=HX(e);"__callOnAfterDeserializeRecursive"in o&&o.__callOnAfterDeserializeRecursive(),o instanceof KY&&o.link(s);const a=o,h=[];for(const{producer:e,outputIndex:n,inputPath:o}of r.getBindings()){if(!j2(e)){M("There's a input bound to a node with unrecognized type.");continue}const r=W2(t,e,i,s);if(r instanceof $Y)q2(a,o,r,n);else{const t=Z2(a,o,r,n);t&&h.push(t)}}const l=new X2(h);let c;return a instanceof $Y?(a._setDependencyEvaluation(l),c=a):c=new Y2(a,l),i.set(e,c),c}class X2{constructor(t){this._bindingEvaluations=void 0,this._bindingEvaluations=t}evaluate(){const{_bindingEvaluations:t}=this;for(const e of t)e.evaluate()}}class Y2{constructor(t,e){this._outputs=void 0,this._node=t,this._dependency=e,this._outputs=new Array(t.outputCount)}get node(){return this._node}get outputCount(){return this._outputs.length}getDefaultOutput(){return this.getOutput(0)}getOutput(t){return this._outputs[t]}evaluate(){const{_node:t,_dependency:e}=this;e.evaluate(),t.selfEvaluate(this._outputs)}}function q2(t,e,i,s){const[r,n=-1]=e;if(!(r in t))return void M(`Invalid binding: consumer node has no property ${r}`);if(0!==s)return void M(`Node ${i.toString()} does not have specified output ${s}.`);const o=t[r];if(n<0)return null!==o?void M(`Invalid binding: consumer node's input ${r} should be leaved as evaluation before evaluation.`):void(t[r]=i);Array.isArray(o)?n>=o.length?M(`Invalid binding: consumer node's input ${r} have length ${o.length} but the binding specified ${n}`):null===o[n]?o[n]=i:M(`Invalid binding: consumer node's input ${r}[${n}] should be leaved as null before evaluation`):M(`Invalid binding: consumer node's input ${r} should be an array.`)}class $2{constructor(t,e,i,s){this._consumerNode=t,this._consumerPropertyKey=e,this._producerRecord=i,this._producerOutputIndex=s}evaluate(){this._producerRecord.evaluate(),this._consumerNode[this._consumerPropertyKey]=this._producerRecord.getOutput(this._producerOutputIndex)}}class K2{constructor(t,e,i,s,r){this._consumerNode=t,this._consumerPropertyKey=e,this._consumerElementIndex=i,this._producerRecord=s,this._producerOutputIndex=r}evaluate(){this._producerRecord.evaluate(),this._consumerNode[this._consumerPropertyKey][this._consumerElementIndex]=this._producerRecord.getOutput(this._producerOutputIndex)}}function Z2(t,e,i,s){const[r,n=-1]=e;if(!(r in t))return void M(`Invalid binding: consumer node has no property ${r}`);const o=t[r];if(n<0)return new $2(t,r,i,s);if(Array.isArray(o)){if(!(n>=o.length))return new K2(t,r,n,i,s);M(`Invalid binding: consumer node's input ${r} have length ${o.length} but the binding specified ${n}`)}else M(`Invalid binding: consumer node's input ${r} should be an array.`)}class Q2{constructor(t,e,i){this.passthroughWeight=1,this._motionStates=[],this._proceduralPoseStates=[],this._topLevelEntry=void 0,this._topLevelExit=void 0,this._currentNode=void 0,this._pendingTransitionPath=[],this._activatedTransitions=[],this._activatedTransitionPool=_3.createPool(4),this._updateContextGenerator=new E1,this._conditionEvaluationContext=new d3,this._additive=!1,this._additive=i.additive,this.name=e,this._controller=i.controller;const{entry:s,exit:r}=this._addStateMachine(t,null,i,e);this._topLevelEntry=s,this._topLevelExit=r,this._currentNode=s,s.increaseActiveReference(),this._resetTrigger=i.triggerResetter}get exited(){return this._currentNode===this._topLevelExit}settle(t){const{_proceduralPoseStates:e}=this,i=e.length;for(let s=0;s<i;++s)e[s].settle(t)}reenter(){for(const t of this._activatedTransitions)t.destination.decreaseActiveReference(),this._activatedTransitionPool.free(t);this._activatedTransitions.length=0,this._topLevelEntry.increaseActiveReference(),this._currentNode.decreaseActiveReference(),this._currentNode=this._topLevelEntry}update(t){this.exited,this._loopMatchTransitions(),this._resetStateTickFlagsAndWeights(),this._updateActivatedTransitions(t.deltaTime),this._commitStateUpdates(t)}evaluate(t){return this._sample(t)||this._pushNullishPose(t)}getCurrentStateStatus(){const{_currentNode:t}=this;return 3===t.kind||5===t.kind?t.getStatus():null}getCurrentClipStatuses(){const{_currentNode:t}=this;return 3===t.kind?t.getClipStatuses(t.absoluteWeight):e3}getCurrentTransition(t){const{_activatedTransitions:e}=this;if(0===e.length)return!1;const i=e[e.length-1],s=1===e.length?this._currentNode:e[e.length-2].destination,r=i.getAbsoluteDuration(s);return t.duration=r,t.time=i.normalizedElapsedTime*r,!0}getNextStateStatus(){const{_activatedTransitions:t}=this;if(0===t.length)return null;const e=t[t.length-1].destination;switch(e.kind){default:break;case 5:case 3:return e.getStatus()}return null}getNextClipStatuses(){var t;const{_activatedTransitions:e}=this;if(0===e.length)return e3;const i=e[e.length-1],s=i.destination;return 3===s.kind&&null!==(t=s.getClipStatuses(i.destination.absoluteWeight))&&void 0!==t?t:e3}overrideClips(t){const{_motionStates:e}=this,i=e.length;for(let s=0;s<i;++s)e[s].overrideClips(t)}_addStateMachine(t,e,i,s){const r=Array.from(t.states());let n,o,a;const h=r.map((e=>{if(e instanceof vY){const t=new n3(e,i);return this._motionStates.push(t),t}if(e===t.entryState)return n=new l3(e,0,e.name);if(e===t.exitState)return a=new l3(e,1,e.name);if(e===t.anyState)return o=new l3(e,2,e.name);if(e instanceof f$)return new c3(e);if(e instanceof v$){const t=new u3(e,i);return this._proceduralPoseStates.push(t),t}return null})),l={components:null,parent:e,entry:n,exit:a,any:o};for(let t=0;t<r.length;++t){const e=h[t];e&&(e.stateMachine=l)}const c=r.map((t=>{if(t instanceof x$){const e=this._addStateMachine(t.stateMachine,l,i,`${s}/${t.name}`);return e.components=new r3(t),e}return null}));for(let e=0;e<r.length;++e){const s=r[e],n=t.getOutgoings(s);let o;o=s instanceof x$?c[e].exit:h[e];for(const t of n){const e=t.to,s=r.findIndex((e=>e===t.to));let n;if(e instanceof x$)n=c[s].entry;else{const t=h[s];n=t instanceof n3?t.entry:t}const a={conditions:t.conditions.map((t=>t[E$](i))),to:n,triggers:void 0,duration:0,normalizedDuration:!1,destinationStart:0,relativeDestinationStart:!1,exitCondition:0,exitConditionEnabled:!1,activated:!1,startEventBinding:void 0,endEventBinding:void 0};(g$(t)||t instanceof y$||t instanceof T$)&&(a.duration=t.duration,a.destinationStart=t.destinationStart,a.relativeDestinationStart=t.relativeDestinationStart,t.startEventBinding.isBound&&(a.startEventBinding=t.startEventBinding),t.endEventBinding.isBound&&(a.endEventBinding=t.endEventBinding),g$(t)&&(a.normalizedDuration=t.relativeDuration,a.exitConditionEnabled=t.exitConditionEnabled,a.exitCondition=t.exitCondition)),a.conditions.forEach(((e,i)=>{const s=t.conditions[i];var r;s instanceof y2&&s.trigger&&(null!==(r=a.triggers)&&void 0!==r?r:a.triggers=[]).push(s.trigger)})),o.addTransition(a)}}return l}_loopMatchTransitions(){const{_pendingTransitionPath:t,_activatedTransitions:e}=this;t.length;let i=0===e.length?this._currentNode:e[e.length-1].destination;for(let e=0;;++e){if(e>=16){j(14e3,16,"");break}const s=this._matchNextTransition(i);if(!s)break;const r=s.to,n=i;if(i=r,J2(r)){if(r===n)break;this._activateTransition(t,s),t.length=0}else t.push(s)}t.length=0}_resetStateTickFlagsAndWeights(){const{_currentNode:t,_activatedTransitions:e}=this;t.resetTickFlagsAndWeight();for(let t=0;t<e.length;++t){const{destination:i}=e[t];i.resetTickFlagsAndWeight()}}_commitStateUpdates(t){const{_currentNode:e,_activatedTransitions:i,_updateContextGenerator:s}=this;this._commitStateUpdate(e,t);for(let e=0;e<i.length;++e){const s=i[e],{destination:r}=s;this._commitStateUpdate(r,t)}}_commitStateUpdate(t,e){const{_updateContextGenerator:i}=this;if(!t.testTickFlag(1))if(t.setTickFlag(1),3===t.kind)t.update(e.deltaTime,this._controller);else if(5===t.kind){const s=i.generate(e.deltaTime,e.indicativeWeight*t.absoluteWeight);t.update(s)}}_sample(t){const{_currentNode:e,_activatedTransitions:i}=this;let s=1,r=null,n=0;var o;if(3===e.kind)r=null!==(o=e.evaluate(t))&&void 0!==o?o:this._pushNullishPose(t);else if(5===e.kind){var a;r=null!==(a=e.evaluate(t))&&void 0!==a?a:this._pushNullishPose(t)}else s-=e.absoluteWeight,r=null;r&&(n=e.absoluteWeight),e.setTickFlag(2);for(let e=0;e<i.length;++e){const o=i[e],{destination:a}=o;if(a.testTickFlag(2))continue;a.setTickFlag(2);const l=a.absoluteWeight;let c;var h;4===a.kind?(s-=l,c=null):c=null!==(h=a.evaluate(t))&&void 0!==h?h:this._pushNullishPose(t),c&&(r?(n+=l,n?(eQ(r,c,l/n),t.popPose()):r=c):r=c)}return this.passthroughWeight=s,r}_pushNullishPose(t){return this._additive?t.pushZeroDeltaPose():t.pushDefaultedPose()}_matchNextTransition(t){const e=this._matchTransition(t,t);if(e)return e;if(3===t.kind||5===t.kind){const e=this._matchAnyScoped(t);if(e)return e}return null}_matchAnyScoped(t){for(let e=t.stateMachine;null!==e;e=e.parent){const i=this._matchTransition(e.any,t);if(i)return i}return null}_matchTransition(t,e){t===e||t.kind;const{_conditionEvaluationContext:i}=this;i.set(e);const{outgoingTransitions:s}=t,r=s.length;for(let i=0;i<r;++i){const r=s[i];if(r.activated)continue;const{conditions:n}=r,o=n.length;if(0===o){if(0===t.kind||1===t.kind)return r;if(!r.exitConditionEnabled)continue}if(3===e.kind&&r.exitConditionEnabled){const t=e.duration*r.exitCondition;if(e.time<t)break}let a=!0;for(let t=0;t<o;++t)if(!n[t].eval(this._conditionEvaluationContext)){a=!1;break}if(a)return r}return null}_activateTransition(t,e){const i=e.to;J2(i);const s=this._activatedTransitionPool.alloc();s.reset(t,e),this._activatedTransitions.push(s);const r=s.path.length;for(let t=0;t<r;++t){const e=s.path[t];this._resetTriggersOnTransition(e)}for(let t=0;t<s.path.length;++t){const e=s.path[t];this._callEnterMethods(e.to)}this._activatedTransitions.length;const n=1===this._activatedTransitions.length?this._currentNode:this._activatedTransitions[this._activatedTransitions.length-2].destination;n instanceof s3&&n.transitionOutEventBinding&&this._emit(n.transitionOutEventBinding),e.startEventBinding&&this._emit(e.startEventBinding),i instanceof s3&&i.transitionInEventBinding&&this._emit(i.transitionInEventBinding)}_updateActivatedTransitions(t){const{_activatedTransitions:e}=this;let i=e.length-1,s=1,r=i;for(;i>=0;--i){const n=e[i],o=0===i?this._currentNode:e[i-1].destination;if(n.update(t,o),n.done){this._dropActivatedTransitions(r);break}const a=n.normalizedElapsedTime*s;n.destination.increaseAbsoluteWeight(a),s*=1-n.normalizedElapsedTime,r=i-1}this._currentNode.increaseAbsoluteWeight(s)}_dropActivatedTransitions(t){const{_activatedTransitions:e,_activatedTransitionPool:i}=this;t>=0&&e.length;const s=t+1,r=e[t],n=r.destination;{r.path.length;const t=r.path[r.path.length-1];t.endEventBinding&&this._emit(t.endEventBinding)}this._callExitMethods(this._currentNode);for(let s=0;s<=t;++s){const r=e[s];s!==t&&r.destination.decreaseActiveReference();const n=s===t?r.path.length-1:r.path.length;for(let t=0;t<n;++t){const e=r.path[t];this._callExitMethods(e.to)}i.free(r)}if(t===e.length-1)e.length=0;else{for(let i=t+1;i<e.length;++i)e[i-s]=e[i];e.length-=s}this._currentNode.decreaseActiveReference(),this._currentNode=n}_resetTriggersOnTransition(t){const{triggers:e}=t;if(e){const t=e.length;for(let i=0;i<t;++i){const t=e[i];this._resetTrigger(t)}}}_resetTrigger(t){const{_triggerReset:e}=this;e(t)}_callEnterMethods(t){var e;const{_controller:i}=this;switch(t.kind){default:break;case 3:t.components.callMotionStateEnterMethods(i,t.getStatus());break;case 0:null==(e=t.stateMachine.components)||e.callStateMachineEnterMethods(i)}}_callExitMethods(t){var e;const{_controller:i}=this;switch(t.kind){default:break;case 3:t.components.callMotionStateExitMethods(i,t.getStatus());break;case 1:null==(e=t.stateMachine.components)||e.callStateMachineExitMethods(i)}}_emit(t){t.emit(this._controller.node)}}function J2(t){return 3===t.kind||4===t.kind||5===t.kind}const t3={next:()=>({done:!0,value:void 0})},e3={[Symbol.iterator]:()=>t3};class i3{constructor(t){this.name=void 0,this.outgoingTransitions=[],this._activeReferenceCount=0,this._tickFlags=0,this._absoluteWeight=0,this.name=t.name}get absoluteWeight(){return this._absoluteWeight}get activeReferenceCount(){return this._activeReferenceCount}setPrefix_debug(t){this.__DEBUG_ID__=`${t}${this.name}`}addTransition(t){this.outgoingTransitions.push(t)}increaseActiveReference(){0===this._activeReferenceCount&&(this._absoluteWeight=0,this._tickFlags=0),++this._activeReferenceCount}decreaseActiveReference(){--this._activeReferenceCount}resetTickFlagsAndWeight(){this._checkActivated(),this._absoluteWeight=0,this._tickFlags=0}increaseAbsoluteWeight(t){this._absoluteWeight+=t}testTickFlag(t){return!!(this._tickFlags&t)}setTickFlag(t){this.testTickFlag(t),this._tickFlags|=t}_checkActivated(){this._activeReferenceCount}}class s3 extends i3{constructor(t){super(t),this.transitionInEventBinding=void 0,this.transitionOutEventBinding=void 0,t.transitionInEventBinding.isBound&&(this.transitionInEventBinding=t.transitionInEventBinding),t.transitionOutEventBinding.isBound&&(this.transitionOutEventBinding=t.transitionOutEventBinding)}}class r3{constructor(t){this._components=t.instantiateComponents()}callMotionStateEnterMethods(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateEnter",t,e)}callMotionStateUpdateMethods(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateUpdate",t,e)}callMotionStateExitMethods(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateExit",t,e)}callStateMachineEnterMethods(t){this._callStateMachineCallbackIfNonDefault("onStateMachineEnter",t)}callStateMachineExitMethods(t){this._callStateMachineCallbackIfNonDefault("onStateMachineExit",t)}_callMotionStateCallbackIfNonDefault(t,e,i){const{_components:s}=this,r=s.length;for(let n=0;n<r;++n){const r=s[n];r[t]!==S2.prototype[t]&&r[t](e,i)}}_callStateMachineCallbackIfNonDefault(t,e){const{_components:i}=this,s=i.length;for(let r=0;r<s;++r){const s=i[r];s[t]!==S2.prototype[t]&&s[t](e)}}}class n3{constructor(t,e){var i,s;this._source=null,this._baseSpeed=1,this._speed=1,this._publicState=void 0,this._privateState=void 0;const r=t.name;if(this._baseSpeed=t.speed,this._setSpeedMultiplier(1),t.speedMultiplierEnabled&&t.speedMultiplier){const i=t.speedMultiplier,s=e.getVar(i);if(dJ(s,i)){_J(s.type,0,i),s.bind(this._setSpeedMultiplier,this);const t=s.value;this._setSpeedMultiplier(t)}}const n=null!==(i=null==(s=t.motion)?void 0:s[E$](e,!1))&&void 0!==i?i:null;n&&Object.defineProperty(n,"__DEBUG_ID__",{value:r}),this._source=n,this._publicState=new o3(this,t,null==n?void 0:n.createPort()),this._privateState=new o3(this,t,null==n?void 0:n.createPort()),this.components=new r3(t)}get duration(){var t,e;return null!==(t=null==(e=this._source)?void 0:e.duration)&&void 0!==t?t:0}get speed(){return this._speed}get entry(){return this._publicState}get stateMachine(){return this._stateMachine}set stateMachine(t){this._stateMachine=t,this._publicState.stateMachine=t,this._privateState.stateMachine=t}setPrefix_debug(t){this._publicState.setPrefix_debug(t),this._privateState.setPrefix_debug(t)}addTransition(t){t.to===this._publicState?this._publicState.addTransition({...t,to:this._privateState}):this._publicState.addTransition(t),this._privateState.addTransition(t)}getClipStatuses(t){const{_source:e}=this;return e?{[Symbol.iterator]:()=>e.getClipStatuses(t)}:e3}overrideClips(t){var e;null==(e=this._source)||e.overrideClips(t)}_setSpeedMultiplier(t){this._speed=this._baseSpeed*t}}class o3 extends s3{constructor(t,e,i){super(e),this.kind=3,this._container=void 0,this._progress=0,this._port=void 0,this._statusCache={progress:0},this._container=t,this._port=i}get duration(){return this._container.duration}get components(){return this._container.components}get normalizedTime(){return this._progress}get time(){return this._progress*this._container.duration}reenter(t){var e;this._progress=t,null==(e=this._port)||e.reenter()}getStatus(){const{_statusCache:t}=this;return t.progress=h3(this._progress),t}getClipStatuses(t){return this._container.getClipStatuses(t)}update(t,e){this._progress=a3(this._progress,this.duration,t*this._container.speed),this._container.components.callMotionStateUpdateMethods(e,this.getStatus())}evaluate(t){var e,i;return null!==(e=null==(i=this._port)?void 0:i.evaluate(this._progress,t))&&void 0!==e?e:null}}function a3(t,e,i){return 0===e?0:t+i/e}function h3(t){const e=t-Math.trunc(t);return e>=0?e:1+e}class l3 extends i3{constructor(t,e,i){super(t),this.kind=void 0,this.kind=e}}class c3 extends i3{constructor(t){super(t),this.kind=4}}class u3 extends s3{constructor(t,e){super(t),this.kind=5,this.elapsedTime=0,this.statusCache={progress:0},this._instantiatedPoseGraph=void 0,this._statusCache={progress:0},this._elapsedTime=0;const i=G2(t.graph,e,!0);i.bind(e),this._instantiatedPoseGraph=i,this._statusCache.progress=0}settle(t){this._instantiatedPoseGraph.settle(t)}reenter(){this._statusCache.progress=0,this._instantiatedPoseGraph.reenter()}update(t){this._elapsedTime+=t.deltaTime,this._instantiatedPoseGraph.update(t)}evaluate(t){var e;return null!==(e=this._instantiatedPoseGraph.evaluate(t))&&void 0!==e?e:null}getStatus(){return this._statusCache.progress=h3(this._elapsedTime),this._statusCache}countMotionTime(){return this._instantiatedPoseGraph.countMotionTime()}}class d3{constructor(){this.sourceStateWeight=0,this._sourceState=void 0}set(t){this._sourceState=t,J2(t)?(t.activeReferenceCount,this.sourceStateWeight=t.absoluteWeight):this.sourceStateWeight=0}unset(){this._sourceState=void 0,this.sourceStateWeight=0}get sourceStateMotionTimeNormalized(){const{_sourceState:t}=this;switch(t&&(3===t.kind||5===t.kind)&&t.activeReferenceCount,t.kind){case 3:return t.normalizedTime;case 5:return t.countMotionTime();default:return 0}}}class _3{constructor(){this.normalizedElapsedTime=0,this.path=[],this._durationMultiplier=1}get done(){return Oi(this.normalizedElapsedTime,1,1e-6)}getAbsoluteDuration(t){return this._getAbsoluteDurationUnscaled(t)*this._durationMultiplier}update(t,e){if(!J2(e))return void(this.normalizedElapsedTime=1);const i=this.getAbsoluteDuration(e);let s=0;if(i<=0)s=0,this.normalizedElapsedTime=1;else{const e=this.normalizedElapsedTime*i,r=i-e;s=Math.min(r,t);const n=Bi((e+s)/i);this.normalizedElapsedTime=n}}static createPool(t){return new vo((()=>new _3),t,void 0)}reset(t,e){const i=e.to;J2(i),this.normalizedElapsedTime=0,this.destination=i,this.path=[...t,e];const s=i.activeReferenceCount;if(i.increaseActiveReference(),0===s)if(3===i.kind){const{destinationStart:t,relativeDestinationStart:e}=this.path[0],s=e?t:0===i.duration?0:t/i.duration;i.reenter(s)}else 5===i.kind&&i.reenter();i.activeReferenceCount,this._durationMultiplier=1-i.absoluteWeight}_getAbsoluteDurationUnscaled(t){this.path.length;const{duration:e,normalizedDuration:i}=this.path[0];return i?(3===t.kind?t.duration:1)*e:e}}class p3{constructor(){this._groups=[]}register(t){const{group:e}=t;let i=this._groups.find((t=>t.name===e));return i||(i=new m3(e),this._groups.push(i)),i.addMember()}sync(){for(const t of this._groups)t.sync()}}class m3{constructor(t){this._lastLeader=void 0,this._records=[],this.name=t}addMember(){const t=new g3;return this._records.push(t),t}sync(){const{_records:t}=this,e=t.length,{_lastLeader:i}=this;if(this._lastLeader=void 0,t.every((t=>!t.active)))return;t.sort(((t,e)=>{const i=t.active?t.weight:-1;return(e.active?e.weight:-1)-i}));let s=0;const r=t[0].weight;if(t[s]!==i)for(let n=0;n<e;++n){const e=t[n];if(!e.active||!Oi(e.weight,r,1e-6))break;if(e===i){s=n;break}}t[s].active,this._lastLeader=t[s];const n=t[s].normalizedTime;for(let i=0;i<e;++i){const e=t[i];if(!e.active)break;e.normalizedTime=n,e.reset()}}}class g3{constructor(){this.normalizedTime=0,this.weight=0,this.active=!1}notifyRenter(t){this.reset(),this.normalizedTime=t}notifyUpdate(t,e){this.normalizedTime+=t,this.active?this.weight+=e:(this.active=!0,this.weight=e)}reset(){this.active=!1,this.weight=0}getSyncedEnterTime(){return this.normalizedTime}}class f3{constructor(t){this._state=0,this._instantiatedPoseGraph=void 0,this._maxRequestedUpdateTime=0,this._evaluationCache=null,this._updateContextGenerator=new E1,this._allocator=t}set(t,e){this._state;const i=G2(t.graph,e);i.bind(e),this._instantiatedPoseGraph=i,this._state=1}settle(t){1===this._state||this._state,this._instantiatedPoseGraph,this._instantiatedPoseGraph.settle(t),this._state=2}reset(){switch(this._state){case 2:case 4:break;case 3:this._state=4;break;case 6:case 8:this._evaluationCache&&(this._allocator.destroyPose(this._evaluationCache),this._evaluationCache=null),this._maxRequestedUpdateTime=0,this._state=3}}reenter(){switch(this._state){default:this._state;break;case 3:case 6:break;case 2:case 4:this._state=3,this._instantiatedPoseGraph,this._instantiatedPoseGraph.reenter()}}requestUpdate(t){const{deltaTime:e}=t;if(4===this._state||3===this._state||5===this._state||this._state,this._instantiatedPoseGraph,5===this._state)return;const i=Math.max(0,e-this._maxRequestedUpdateTime);if(6===this._state&&Oi(i,0,1e-8))return;this._state=5,this._maxRequestedUpdateTime=Math.max(e,this._maxRequestedUpdateTime);const s=this._updateContextGenerator.generate(i,t.indicativeWeight);this._instantiatedPoseGraph.update(s),this._state=6}evaluate(t){switch(this._state){default:this._state;break;case 7:this._state=8;break;case 8:break;case 6:{var e;this._evaluationCache,this._state=7;const i=null==(e=this._instantiatedPoseGraph)?void 0:e.evaluate(t);if(this._state=8,i){const e=this._allocator.allocatePose();e.transforms.set(i.transforms),e.auxiliaryCurves.set(i.auxiliaryCurves),this._evaluationCache=e,t.popPose()}this._state=8;break}}return this._state,this._instantiatedPoseGraph,this._evaluationCache?t.pushDuplicatedPose(this._evaluationCache):null}}class y3{constructor(t){this._allocator=void 0,this._stashEvaluations={},this._allocator=t}bindStash(t){return this._stashEvaluations[t]}getStash(t){return this._stashEvaluations[t]}addStash(t){this._stashEvaluations[t]=new f3(this._allocator)}setStash(t,e,i){this._stashEvaluations,this._stashEvaluations[t].set(e,i)}reset(){for(const t in this._stashEvaluations)this._stashEvaluations[t].reset()}settle(t){for(const e in this._stashEvaluations)this._stashEvaluations[e].settle(t)}}class b3 extends $Y{constructor(t,e,i){super(),this._layerRecords=void 0;const s=t.layers.map((t=>new v3(t,e,i)));this._layerRecords=s}get layerCount(){return this._layerRecords.length}reenter(){}bind(t){}settle(t){const{_layerRecords:e}=this,i=e.length;for(let s=0;s<i;++s)e[s].settle(t)}getLayerWeight(t){return t>=0&&this._layerRecords.length,this._layerRecords[t].weight}setLayerWeight(t,e){t>=0&&this._layerRecords.length,this._layerRecords[t].weight=e}getLayerTopLevelStateMachineEvaluation(t){return this._layerRecords[t].stateMachineEvaluation}overrideClips(t){const{_layerRecords:e}=this,i=e.length;for(let s=0;s<i;++s){const i=e[s];t._pushAdditiveFlag(i.additive),i.stateMachineEvaluation.overrideClips(t),t._popAdditiveFlag()}}doUpdate(t){const{_layerRecords:e}=this,i=e.length;for(let s=0;s<i;++s)e[s].update(t)}doEvaluate(t){const e=t.pushDefaultedPose(),{_layerRecords:i}=this,s=i.length;for(let r=0;r<s;++r){const s=i[r],n=s.stateMachineEvaluation.evaluate(t),o=s.weight*s.stateMachineEvaluation.passthroughWeight,{transformFilter:a}=s;s.additive?lQ(e,n,o,a):eQ(e,n,o,a),t.popPose(),s.postEvaluate()}return e}}class v3{constructor(t,e,i){var s;this.additive=!1,this.weight=0,this._topLevelStateMachineEval=void 0,this._stashManager=void 0,this._motionSyncManager=void 0,this._mask=void 0,this.transformFilter=void 0;const r=new y3(i);for(const[e,i]of t.stashes())r.addStash(e);this._stashManager=r;const n=new p3;this._motionSyncManager=n,e._setLayerWideContextProperties(r,n);for(const[i,s]of t.stashes())r.setStash(i,s,e);this.weight=t.weight;const o=this.additive=t.additive;this._mask=null!==(s=t.mask)&&void 0!==s?s:void 0,e._pushAdditiveFlag(o),this._topLevelStateMachineEval=new Q2(t.stateMachine,t.name,e),e._popAdditiveFlag(),e._unsetLayerWideContextProperties()}get stateMachineEvaluation(){return this._topLevelStateMachineEval}settle(t){this._mask&&(this.transformFilter=t.createTransformFilter(this._mask)),this._stashManager.settle(t),this._topLevelStateMachineEval.settle(t)}update(t){this.stateMachineEvaluation.update(t),this._motionSyncManager.sync()}postEvaluate(){this._stashManager.reset()}}class S3{constructor(t,e,i,s){this._currentTransitionCache={duration:0,time:0},this._rootPoseNode=void 0,this._varInstances={},this._hasAutoTrigger=!1,this._auxiliaryCurveRegistry=new g1,this._poseLayoutMaintainer=void 0,this._bindingContext=void 0,this._settleContext=void 0,this._rootUpdateContextGenerator=new E1;for(const[e,i]of t.variables){const t=i[uX]();this._varInstances[e]=t,t instanceof wX&&1===t.resetMode&&(this._hasAutoTrigger=!0)}const r=new f1(e,this._auxiliaryCurveRegistry);this._poseLayoutMaintainer=r;const n=new p1(e,r,this._varInstances,i);n._setClipOverrides(null!=s?s:void 0),this._bindingContext=n;const o=new T1(r);this._settleContext=o,r.startBind();const a=new I1;this._poseStashAllocator=a,this._rootPoseNode=new b3(t,n,a),this._root=e,this._initializeContexts()}destroy(){this._evaluationContext.destroy()}_destroyAfterException_debugging(){const t=this._evaluationContext._stackSize_debugging;if(0!==t)for(let e=0;e<t;++e)this._evaluationContext.popPose();this._evaluationContext.destroy()}get layerCount(){return this._rootPoseNode.layerCount}update(t){const{_evaluationContext:e,_poseLayoutMaintainer:i,_rootUpdateContextGenerator:s,_rootPoseNode:r}=this,n=s.generate(t,1);r.update(n);const o=r.evaluate(e,1);if(this._hasAutoTrigger){const{_varInstances:t}=this;for(const e in t){const i=t[e];i instanceof wX&&1===i.resetMode&&(i.value=!1)}}i.apply(o),e.popPose()}getVariables(){return Object.entries(this._varInstances)}getCurrentStateStatus(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getCurrentStateStatus()}getCurrentClipStatuses(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getCurrentClipStatuses()}getCurrentTransition(t){const{_currentTransitionCache:e}=this;return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getCurrentTransition(e)?e:null}getNextStateStatus(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getNextStateStatus()}getNextClipStatuses(t){return this._rootPoseNode.getLayerTopLevelStateMachineEvaluation(t).getNextClipStatuses()}getValue(t){const e=this._varInstances[t];return e?e.value:void 0}setValue(t,e){const i=this._varInstances[t];i&&(i.value=e)}getLayerWeight(t){return this._rootPoseNode.getLayerWeight(t)}setLayerWeight(t,e){this._rootPoseNode.setLayerWeight(t,e)}overrideClips(t){const{_poseLayoutMaintainer:e}=this;e.startBind(),this._bindingContext._setClipOverrides(t),this._rootPoseNode.overrideClips(this._bindingContext),this._updateAfterPossiblePoseLayoutChange()}getAuxiliaryCurveValue(t){return this._auxiliaryCurveRegistry.get(t)}_initializeContexts(){const{_poseLayoutMaintainer:t}=this;t.endBind(),this._createOrUpdateTransformFilters();const e=t.createEvaluationContext();this._evaluationContext=e,t.fetchDefaultTransforms(e[S1]),t.resetPoseStashAllocator(this._poseStashAllocator)}_updateAfterPossiblePoseLayoutChange(){const{_poseLayoutMaintainer:t}=this,e=t.endBind();if(0===e)return;(1&e||2&e)&&this._createOrUpdateTransformFilters();let i=!1;if(1&e||4&e){const e=t.createEvaluationContext();this._evaluationContext.destroy(),this._evaluationContext=e,i=!0,t.resetPoseStashAllocator(this._poseStashAllocator)}(i||1&e||2&e)&&t.fetchDefaultTransforms(this._evaluationContext[S1])}_createOrUpdateTransformFilters(){this._rootPoseNode.settle(this._settleContext)}}var T3,w3,x3,C3,A3,D3;const{ccclass:E3,menu:I3,help:M3,type:P3,serializable:O3,editable:R3,formerlySerializedAs:B3}=il;let F3=(T3=E3("cc.animation.AnimationController"),w3=P3(wY),x3=B3("graph"),T3((A3=class extends Km{constructor(...t){super(...t),this._graph=D3&&D3(),this._graphEval=null}get graph(){return this._graph}set graph(t){this._graph=t}get layerCount(){var t,e;return null!==(t=null==(e=this._graphEval)?void 0:e.layerCount)&&void 0!==t?t:0}__preload(){const{graph:t}=this;if(t){let e,i=null;if(t instanceof R0){if(!t.original)return;e=t.original,i=t.clipOverrides}else e=t;const s=new S3(e,this.node,this,i);this._graphEval=s}}onDestroy(){var t;null==(t=this._graphEval)||t.destroy()}update(t){var e;null==(e=this._graphEval)||e.update(t)}getVariables(){const{_graphEval:t}=this;return t.getVariables()}setValue(t,e){return this.setValue_experimental(t,e)}setValue_experimental(t,e){const{_graphEval:i}=this;i.setValue(t,e)}getValue(t){const e=this.getValue_experimental(t);return"object"==typeof e?void 0:e}getValue_experimental(t){const{_graphEval:e}=this;return e.getValue(t)}getCurrentStateStatus(t){const{_graphEval:e}=this;return e.getCurrentStateStatus(t)}getCurrentClipStatuses(t){const{_graphEval:e}=this;return e.getCurrentClipStatuses(t)}getCurrentTransition(t){const{_graphEval:e}=this;return e.getCurrentTransition(t)}getNextStateStatus(t){const{_graphEval:e}=this;return e.getNextStateStatus(t)}getNextClipStatuses(t){const{_graphEval:e}=this;return e.getNextClipStatuses(t)}getLayerWeight(t){const{_graphEval:e}=this;return e.getLayerWeight(t)}setLayerWeight(t,e){const{_graphEval:i}=this;return i.setLayerWeight(t,e)}overrideClips_experimental(t){const{_graphEval:e}=this;e.overrideClips(t)}getAuxiliaryCurveValue_experimental(t){const{_graphEval:e}=this;return e?e.getAuxiliaryCurveValue(t):0}},s(A3.prototype,"graph",[w3],Object.getOwnPropertyDescriptor(A3.prototype,"graph"),A3.prototype),D3=Za(A3.prototype,"_graph",[O3,x3],(function(){return null})),C3=A3))||C3);var N3=Object.freeze({__proto__:null,AnimationController:F3,ColorTrack:JW,ComponentPath:AG,CubicSplineNumberValue:RW,CubicSplineQuatValue:OW,CubicSplineVec2Value:IW,CubicSplineVec3Value:MW,CubicSplineVec4Value:PW,HierarchyPath:CG,MorphWeightValueProxy:vW,MorphWeightsAllValueProxy:TW,MorphWeightsValueProxy:SW,ObjectTrack:hX,QuatTrack:YW,RealTrack:FW,SizeTrack:nX,StateMachineComponent:S2,Track:KG,TrackPath:YG,UniformProxyFactory:cW,VariableType:{FLOAT:0,BOOLEAN:1,TRIGGER:2,INTEGER:3,VEC3_experimental:4,QUAT_experimental:5},VectorTrack:jW,isCustomPath:function(t,e){return t instanceof e},isPropertyPath:xG});t("animation",N3);class L3{constructor(){this._nodeBlendStates=new Map}createWriter(t,e,i,s){const r=this.ref(t,e);return new k3(t,e,r,i,s)}destroyWriter(t){const e=t;this.deRef(e.node,e.property)}ref(t,e){let i=this._nodeBlendStates.get(t);return i||(i=this.createNodeBlendState(),this._nodeBlendStates.set(t,i)),i.refProperty(t,e)}deRef(t,e){const i=this._nodeBlendStates.get(t);i&&(i.deRefProperty(e),i.empty&&this._nodeBlendStates.delete(t))}apply(){this._nodeBlendStates.forEach(((t,e)=>{t.apply(e)}))}}class k3{constructor(t,e,i,s,r){this._node=t,this._property=e,this._propertyBlendState=i,this._host=s,this._constants=r}get node(){return this._node}get property(){return this._property}getValue(){return this._node[this._property]}setValue(t){const{_propertyBlendState:e,_host:i}=this,s=i.weight;e.blend(t,s)}}class z3{constructor(){this.refCount=0,this.accumulatedWeight=0,this.result=new Ms}blend(t,e){this.accumulatedWeight=G3(this.result,this.result,this.accumulatedWeight,t,e)}reset(){this.accumulatedWeight=0,Ms.zero(this.result)}}class U3{constructor(){this.refCount=0,this.accumulatedWeight=0,this.result=new sr}blend(t,e){this.accumulatedWeight=W3(this.result,this.result,this.accumulatedWeight,t,e)}reset(){this.accumulatedWeight=0,sr.identity(this.result)}}class V3{constructor(){this._transformApplyFlags=0,this._properties={}}get empty(){const{_properties:t}=this;return!(t.position||t.rotation||t.eulerAngles||t.scale)}refProperty(t,e){var i,s;const{_properties:r}=this;let n;switch(e){default:case"position":case"scale":case"eulerAngles":n=null!==(i=r[e])&&void 0!==i?i:r[e]=this._createVec3BlendState(t[e]);break;case"rotation":n=null!==(s=r[e])&&void 0!==s?s:r[e]=this._createQuatBlendState(t.rotation)}return++n.refCount,n}deRefProperty(t){const{_properties:e}=this,i=e[t];i&&(--i.refCount,i.refCount>0||delete e[t])}apply(t){const{_transformApplyFlags:e,_properties:{position:i,scale:s,rotation:r,eulerAngles:n}}=this;if(!e)return;let o,a,h;i&&1&e&&(o=i.result),s&&4&e&&(a=s.result),n&&8&e&&(h=n.result),r&&2&e&&(h=r.result),(h||o||a)&&t.setRTS(h,o,a),this._transformApplyFlags=0}}class j3 extends V3{apply(t){const{_properties:{position:e,scale:i,rotation:s,eulerAngles:r}}=this;e&&e.accumulatedWeight&&(this._transformApplyFlags|=1,e.accumulatedWeight<1&&e.blend(t.position,1-e.accumulatedWeight)),i&&i.accumulatedWeight&&(this._transformApplyFlags|=4,i.accumulatedWeight<1&&i.blend(t.scale,1-i.accumulatedWeight)),r&&r.accumulatedWeight&&(this._transformApplyFlags|=8,r.accumulatedWeight<1&&r.blend(t.eulerAngles,1-r.accumulatedWeight)),s&&s.accumulatedWeight&&(this._transformApplyFlags|=2,s.accumulatedWeight<1&&s.blend(t.rotation,1-s.accumulatedWeight)),super.apply(t),null==e||e.reset(),null==i||i.reset(),null==s||s.reset(),null==r||r.reset()}_createVec3BlendState(t){return new z3}_createQuatBlendState(t){return new U3}}class H3 extends L3{createNodeBlendState(){return new j3}}function G3(t,e,i,s,r){const n=i+r;if(1!==r||i){if(n){const e=r/n;Ms.lerp(t,t,s,e)}}else Ms.copy(t,s);return n}function W3(t,e,i,s,r){const n=i+r;if(1!==r||i){if(n){const i=r/n;sr.slerp(t,e,s,i)}}else sr.copy(t,s);return n}const X3=[],Y3=new Map;function q3(t,e){let i=0,s=vr.IDENTITY;for(;t;){if(t.stamp===e||t.stamp+1===e&&!t.node.hasChangedFlags){s=t.world,t.stamp=e;break}t.stamp=e,X3[i++]=t,t=t.parent}for(;i>0;){t=X3[--i],X3[i]=null;const e=t.node;vr.fromRTS(t.local,e.rotation,e.position,e.scale),s=vr.multiply(t.world,s,t.local)}return s}function $3(t,e){let i,s=null,r=0;for(;t!==e;){const e=t.uuid;if(Y3.has(e)){s=Y3.get(e);break}s={node:t,local:new vr,world:new vr,stamp:-1,parent:null},Y3.set(e,s),X3[r++]=s,t=t.parent,s=null}for(;r>0;)i=X3[--r],X3[r]=null,i.parent=s,s=i;return s}function K3(t){let e=Y3.get(t.uuid)||null;for(;e;)Y3.delete(e.node.uuid),e=e.parent}var Z3,Q3;let J3=t("AnimationManager",ah((Q3=class extends Bu{constructor(...t){super(...t),this._anims=new te([]),this._crossFades=new te([]),this._delayEvents=[],this._blendStateBuffer=new H3,this._sockets=[]}get blendState(){return this._blendStateBuffer}get animationStates(){return this._anims.array}addCrossFade(t){-1===this._crossFades.array.indexOf(t)&&this._crossFades.push(t)}removeCrossFade(t){const e=this._crossFades.array.indexOf(t);e>=0?this._crossFades.fastRemoveAt(e):G(3907)}update(t){const{_delayEvents:e,_crossFades:i,_sockets:s}=this;{const e=i.array;for(i.i=0;i.i<e.length;++i.i)e[i.i].update(t)}const r=this._anims,n=r.array;for(r.i=0;r.i<n.length;++r.i){const e=n[r.i];e.isMotionless||e.update(t)}this._blendStateBuffer.apply();const o=nC.getTotalFrames();for(let t=0,e=s.length;t<e;t++){const{target:e,transform:i}=s[t];e.matrix=q3(i,o)}for(let t=0,i=e.length;t<i;t++){const i=e[t];i.fn.apply(i.thisArg,i.args)}e.length=0}destruct(){}addAnimation(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)}removeAnimation(t){const e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):G(3907)}pushDelayEvent(t,e,i){this._delayEvents.push({fn:t,thisArg:e,args:i})}addSockets(t,e){for(let i=0;i<e.length;++i){const s=e[i];if(this._sockets.find((t=>t.target===s.target)))continue;const r=t.getChildByPath(s.path),n=s.target&&r&&$3(r,t);n&&this._sockets.push({target:s.target,transform:n})}}removeSockets(t,e){for(let t=0;t<e.length;++t){const i=e[t];for(let t=0;t<this._sockets.length;++t){const e=this._sockets[t];if(e.target===i.target){K3(e.transform.node),this._sockets[t]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}}}},Q3.ID="animation",Z3=Q3))||Z3);nC.on("director_init",(()=>{const t=new J3;nC.registerSystem(J3.ID,t,200)})),a.AnimationManager=J3;class t5 extends rG{constructor(t){super(),this._managedStates=[],this._fadings=[],this._scheduled=!1,this._scheduler=null!=t?t:hG()}update(t){if(this.isMotionless)return;const e=this._managedStates,i=this._fadings;if(1===e.length&&1===i.length){const t=e[0].state;t&&(t.weight=1)}else this._calculateWeights(t);1===e.length&&1===i.length&&this._unscheduleThis()}crossFade(t,e){var i;0===this._managedStates.length&&(e=0),0===e&&this.clear();let s=this._managedStates.find((e=>e.state===t));s?null!=(i=s.state)&&i.isMotionless&&s.state.play():(s={state:t,reference:0},t&&t.play(),this._managedStates.push(s)),++s.reference,this._fadings.unshift({easeDuration:e,easeTime:0,target:s}),this.isMotionless||this._scheduleThis()}clear(){for(let t=0;t<this._managedStates.length;++t){const e=this._managedStates[t].state;e&&e.stop()}this._managedStates.length=0,this._fadings.length=0}onPlay(){super.onPlay(),this._scheduleThis()}onPause(){super.onPause();for(let t=0;t<this._managedStates.length;++t){const e=this._managedStates[t].state;e&&e.pause()}this._unscheduleThis()}onResume(){super.onResume();for(let t=0;t<this._managedStates.length;++t){const e=this._managedStates[t].state;e&&e.resume()}this._scheduleThis()}onStop(){super.onStop(),this.clear()}_calculateWeights(t){const e=this._managedStates,i=this._fadings;for(let t=0;t<e.length;++t){const i=e[t].state;i&&(i.weight=0)}let s=1,r=i.length;for(let e=0;e<i.length;++e){const n=i[e];n.easeTime+=t;const o=0===n.easeDuration?1:Bi(n.easeTime/n.easeDuration),a=o*s;if(s*=1-o,n.target.state&&(n.target.state.weight+=a),n.easeTime>=n.easeDuration){r=e+1,n.easeTime=n.easeDuration;break}}if(r!==i.length){for(let t=r;t<i.length;++t){const e=i[t];--e.target.reference,e.target.reference<=0&&(e.target.state&&e.target.state.stop(),se(this._managedStates,e.target))}i.splice(r)}}_scheduleThis(){this._scheduled||(this._scheduler.addCrossFade(this),this._scheduled=!0)}_unscheduleThis(){this._scheduled&&(this._scheduler.removeCrossFade(this),this._scheduled=!1)}}var e5,i5,s5,r5,n5,o5,a5,h5,l5,c5,u5;let d5,_5,p5,m5=(e5=ah("cc.Animation"),i5=lh(99),s5=Xh([DZ]),r5=Xh(DZ),n5=Xh([DZ]),e5(o5=i5((u5=class extends(ko(Km)){constructor(...t){super(...t),this.playOnLoad=h5&&h5(),this._crossFade=new t5,this._nameToState=wt(!0),this._clips=l5&&l5(),this._defaultClip=c5&&c5(),this._hasBeenPlayed=!1}get clips(){return this._clips}set clips(t){this._crossFade&&this._crossFade.clear(),this._clips.forEach((t=>{t&&this._removeStateOfAutomaticClip(t)})),t.forEach((t=>{t&&this.createState(t)}));const e=t.find((t=>g5(t,this._defaultClip)));this._defaultClip=e||null,this._clips=t}get defaultClip(){return this._defaultClip}set defaultClip(t){this._defaultClip=t,t&&(this._clips.findIndex((e=>g5(e,t)))>=0||(this._clips.push(t),this.createState(t)))}onLoad(){this.clips=this._clips;for(const t in this._nameToState)this._nameToState[t].initialize(this.node)}start(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)}onEnable(){this._crossFade.resume()}onDisable(){this._crossFade.pause()}onDestroy(){this._crossFade.stop();for(const t in this._nameToState)this._nameToState[t].destroy();this._nameToState=wt(!0)}play(t){if(this._hasBeenPlayed=!0,!t){if(!this._defaultClip)return;t=this._defaultClip.name}this.crossFade(t,0)}crossFade(t,e=.3){this._hasBeenPlayed=!0;const i=this._nameToState[t];i&&this.doPlayOrCrossFade(i,e)}pause(){this._crossFade.pause()}resume(){this._crossFade.resume()}stop(){this._crossFade.stop()}getState(t){const e=this._nameToState[t];return e&&!e.curveLoaded&&e.initialize(this.node),e||null}createState(t,e){return e=e||t.name,this.removeState(e),this._doCreateState(t,e)}removeState(t){const e=this._nameToState[t];e&&(e.allowLastFrameEvent(!1),e.stop(),delete this._nameToState[t])}addClip(t,e){return oe(this._clips,t)||this._clips.push(t),this.createState(t,e)}removeClip(t,e){let i;for(const e in this._nameToState){const s=this._nameToState[e];if(s.clip===t){i=s;break}}if(t===this._defaultClip){if(!e)return void j(3902);this._defaultClip=null}if(i&&i.isPlaying){if(!e)return void j(3903);i.stop()}this._clips=this._clips.filter((e=>e!==t)),i&&delete this._nameToState[i.name]}on(t,e,i,s){const r=super.on(t,e,i,s);return"lastframe"===t&&this._syncAllowLastFrameEvent(),r}once(t,e,i){const s=super.once(t,e,i);return"lastframe"===t&&this._syncAllowLastFrameEvent(),s}off(t,e,i){super.off(t,e,i),"lastframe"===t&&this._syncDisallowLastFrameEvent()}_createState(t,e){return new cG(t,e)}_doCreateState(t,e){const i=this._createState(t,e);return i._setEventTarget(this),i.allowLastFrameEvent(this.hasEventListener("lastframe")),this.node&&i.initialize(this.node),this._nameToState[i.name]=i,i}doPlayOrCrossFade(t,e){this._crossFade.play(),this._crossFade.crossFade(t,e)}_removeStateOfAutomaticClip(t){for(const e in this._nameToState){const i=this._nameToState[e];g5(t,i.clip)&&(i.stop(),delete this._nameToState[e])}}_syncAllowLastFrameEvent(){if(this.hasEventListener("lastframe"))for(const t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!0)}_syncDisallowLastFrameEvent(){if(!this.hasEventListener("lastframe"))for(const t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!1)}},u5.EventType=lG,s((a5=u5).prototype,"clips",[s5],Object.getOwnPropertyDescriptor(a5.prototype,"clips"),a5.prototype),s(a5.prototype,"defaultClip",[r5],Object.getOwnPropertyDescriptor(a5.prototype,"defaultClip"),a5.prototype),h5=Za(a5.prototype,"playOnLoad",[vh],(function(){return!1})),l5=Za(a5.prototype,"_clips",[n5],(function(){return[]})),c5=Za(a5.prototype,"_defaultClip",[vh],(function(){return null})),o5=a5))||o5)||o5);function g5(t,e){return t===e||!!t&&!!e&&t._uuid===e._uuid&&t._uuid}t({Animation:m5,AnimationComponent:m5}),a.Animation=m5,a.AnimationComponent=m5,Xt(m5,"cc.AnimationComponent"),function(t){t.PLAYED="play",t.PAUSED="pause",t.STOPPED="stop",t.SEEKED="seeked",t.ENDED="ended",t.INTERRUPTION_BEGIN="interruptionBegin",t.INTERRUPTION_END="interruptionEnd",t.USER_GESTURE="on_gesture"}(d5||(d5={})),function(t){t[t.DOM_AUDIO=0]="DOM_AUDIO",t[t.WEB_AUDIO=1]="WEB_AUDIO",t[t.MINIGAME_AUDIO=2]="MINIGAME_AUDIO",t[t.NATIVE_AUDIO=3]="NATIVE_AUDIO",t[t.UNKNOWN_AUDIO=4]="UNKNOWN_AUDIO"}(_5||(_5={})),function(t){t[t.INIT=0]="INIT",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.STOPPED=3]="STOPPED",t[t.INTERRUPTED=4]="INTERRUPTED"}(p5||(p5={}));class f5{constructor(...t){if(this._bufferView=void 0,this._normalizeFactor=1,2===t.length)this._bufferView=t[0],this._normalizeFactor=t[1];else{const e=t[0],i=t[1],s=t[2];this._bufferView=new i(e),this._normalizeFactor=s}}get length(){return this._bufferView.length}getData(t){return this._bufferView[t]*this._normalizeFactor}}function y5(t){const e=t._operationQueue.length,i=t._operationQueue.slice(),s=[];let r=!1;for(let t=e-1;t>=0;t--){const e=i[t];if("stop"===e.op){s.push(e);break}if("seek"===e.op)r||(s.push(e),r=!0);else{if(r){s.push(e);break}0===s.length&&s.push(e)}}t._operationQueue=s.reverse()}t("AudioPCMDataView",f5);let b5=0;function v5(t,e){e.invoking||(e.invoking=!0,e.func.call(t,...e.args).then((()=>{e.invoking=!1,t._operationQueue.shift(),t._eventTarget.emit(e.id.toString()),t._eventTarget.off(e.id.toString()),y5(t);const i=t._operationQueue[0];i&&v5(t,i)})).catch((()=>{})))}function S5(t,e,i){const s=i.value;i.value=function(...t){return new Promise((i=>{const r=b5++,n=this;n._operationQueue.push({op:e,id:r,func:s,args:t,invoking:!1}),n._eventTarget.once(r.toString(),i),v5(n,n._operationQueue[0])}))}}var T5,w5;const x5={},C5=jsb.AudioEngine,A5=-1;var D5;!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SIGNED_8=1]="SIGNED_8",t[t.UNSIGNED_8=2]="UNSIGNED_8",t[t.SIGNED_16=3]="SIGNED_16",t[t.UNSIGNED_16=4]="UNSIGNED_16",t[t.SIGNED_32=5]="SIGNED_32",t[t.UNSIGNED_32=6]="UNSIGNED_32",t[t.FLOAT_32=7]="FLOAT_32",t[t.FLOAT_64=8]="FLOAT_64"}(D5||(D5={}));const E5={[D5.UNKNOWN]:void 0,[D5.SIGNED_8]:{ctor:Int8Array,maxValue:127},[D5.UNSIGNED_8]:{ctor:Uint8Array,maxValue:255},[D5.SIGNED_16]:{ctor:Int16Array,maxValue:32767},[D5.UNSIGNED_16]:{ctor:Uint16Array,maxValue:65535},[D5.SIGNED_32]:{ctor:Int32Array,maxValue:2147483647},[D5.UNSIGNED_32]:{ctor:Uint32Array,maxValue:4294967295},[D5.FLOAT_32]:{ctor:Float32Array,maxValue:1},[D5.FLOAT_64]:{ctor:Float64Array,maxValue:1}};class I5{get onPlay(){return this._onPlayCb}set onPlay(t){this._onPlayCb=t}get onEnd(){return this._onEndCb}set onEnd(t){this._onEndCb=t}constructor(t,e){this._id=A5,this._url=void 0,this._volume=void 0,this._onPlayCb=void 0,this._onEndCb=void 0,this._url=t,this._volume=e}play(){var t;this._id=jsb.AudioEngine.play2d(this._url,!1,this._volume),jsb.AudioEngine.setFinishCallback(this._id,(()=>{var t;null==(t=this.onEnd)||t.call(this)})),null==(t=this.onPlay)||t.call(this)}stop(){this._id!==A5&&jsb.AudioEngine.stop(this._id)}}let M5=(w5=class t{constructor(t){this._url=void 0,this._id=A5,this._state=p5.INIT,this._pcmHeader=void 0,this._eventTarget=new zo,this._operationQueue=[],this._cachedState={duration:1,loop:!1,currentTime:0,volume:1},this._url=t,this._pcmHeader=null,JA.on(QA.EVENT_PAUSE,this._onInterruptedBegin,this),JA.on(QA.EVENT_RESUME,this._onInterruptedEnd,this)}destroy(){JA.off(QA.EVENT_PAUSE,this._onInterruptedBegin,this),JA.off(QA.EVENT_RESUME,this._onInterruptedEnd,this),--x5[this._url]<=0&&C5.uncache(this._url)}_onInterruptedBegin(){this._state===p5.PLAYING&&this.pause().then((()=>{this._state=p5.INTERRUPTED,this._eventTarget.emit(d5.INTERRUPTION_BEGIN)})).catch((()=>{}))}_onInterruptedEnd(){this._state===p5.INTERRUPTED&&this.play().then((()=>{this._eventTarget.emit(d5.INTERRUPTION_END)})).catch((()=>{}))}static load(e,i){return new Promise(((s,r)=>{t.loadNative(e,i).then((e=>{s(new t(e))})).catch((t=>r(t)))}))}static loadNative(t,e){return new Promise(((e,i)=>{$o.platform===Wo.WIN32?(C5.preload(t,(()=>{console.debug("somehow preload success on windows")})),e(t)):C5.preload(t,(s=>{s?e(t):i(new Error("load audio failed"))}))}))}static loadOneShotAudio(e,i,s){return new Promise(((r,n)=>{t.loadNative(e,s).then((t=>{r(new I5(t,i))})).catch(n)}))}get _isValid(){return this._id!==A5}get src(){return this._url}get type(){return _5.NATIVE_AUDIO}get state(){return this._state}get loop(){return this._isValid?C5.isLoop(this._id):this._cachedState.loop}set loop(t){this._isValid&&C5.setLoop(this._id,t),this._cachedState.loop=t}get volume(){return this._isValid?C5.getVolume(this._id):this._cachedState.volume}set volume(t){t=Bi(t),this._isValid&&C5.setVolume(this._id,t),this._cachedState.volume=t}get duration(){return this._isValid?C5.getDuration(this._id):this._cachedState.duration}get currentTime(){return this._isValid?C5.getCurrentTime(this._id):this._cachedState.currentTime}get sampleRate(){return null===this._pcmHeader&&(this._pcmHeader=jsb.AudioEngine.getPCMHeader(this._url)),this._pcmHeader.sampleRate}getPCMData(t){const e=C5.getOriginalPCMBuffer(this._url,t);null===this._pcmHeader&&(this._pcmHeader=jsb.AudioEngine.getPCMHeader(this._url));const i=E5[this._pcmHeader.audioFormat];if(e&&i)return new f5(e,i.ctor,1/i.maxValue)}seek(t){return new Promise((e=>(this._isValid&&C5.setCurrentTime(this._id,t),this._cachedState.currentTime=t,e())))}play(){return new Promise((t=>{this._isValid?this._state===p5.PAUSED||this._state===p5.INTERRUPTED?C5.resume(this._id):this._state===p5.PLAYING&&(C5.pause(this._id),C5.setCurrentTime(this._id,0),C5.resume(this._id)):(this._id=C5.play2d(this._url,this._cachedState.loop,this._cachedState.volume),this._isValid&&(0!==this._cachedState.currentTime&&(C5.setCurrentTime(this._id,this._cachedState.currentTime),this._cachedState.currentTime=0),C5.setFinishCallback(this._id,(()=>{this._cachedState.currentTime=0,this._id=A5,this._state=p5.INIT,this._eventTarget.emit(d5.ENDED)})))),this._state=p5.PLAYING,t()}))}pause(){return new Promise((t=>{this._isValid&&C5.pause(this._id),this._state=p5.PAUSED,t()}))}stop(){return new Promise((t=>{this._isValid&&C5.stop(this._id),this._state=p5.STOPPED,this._id=A5,this._cachedState.currentTime=0,t()}))}onInterruptionBegin(t){this._eventTarget.on(d5.INTERRUPTION_BEGIN,t)}offInterruptionBegin(t){this._eventTarget.off(d5.INTERRUPTION_BEGIN,t)}onInterruptionEnd(t){this._eventTarget.on(d5.INTERRUPTION_END,t)}offInterruptionEnd(t){this._eventTarget.off(d5.INTERRUPTION_END,t)}onEnded(t){this._eventTarget.on(d5.ENDED,t)}offEnded(t){this._eventTarget.off(d5.ENDED,t)}},w5.maxAudioChannel=C5.getMaxAudioInstance(),s((T5=w5).prototype,"seek",[S5],Object.getOwnPropertyDescriptor(T5.prototype,"seek"),T5.prototype),s(T5.prototype,"play",[S5],Object.getOwnPropertyDescriptor(T5.prototype,"play"),T5.prototype),s(T5.prototype,"pause",[S5],Object.getOwnPropertyDescriptor(T5.prototype,"pause"),T5.prototype),s(T5.prototype,"stop",[S5],Object.getOwnPropertyDescriptor(T5.prototype,"stop"),T5.prototype),T5);var P5,O5,R5,B5;h.AudioPlayer=M5;let F5=t("AudioClip",ah("cc.AudioClip")(((B5=class extends fm{set duration(t){this._duration=t}constructor(t){super(t),this._duration=R5&&R5(),this._loadMode=_5.UNKNOWN_AUDIO,this._meta=null,this._player=null}destroy(){var t;const e=super.destroy();return null==(t=this._player)||t.destroy(),this._player=null,this._meta&&(this._meta.player=null),e}set _nativeAsset(t){this._meta=t,t?(this._loadMode=t.type,this._player=t.player):(this._meta=null,this._loadMode=_5.UNKNOWN_AUDIO,this._duration=0)}get _nativeAsset(){return this._meta}get _nativeDep(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:this._native,__isNative__:!0}}get loadMode(){return this._loadMode}validate(){return!!this._meta}getDuration(){return this._duration?this._duration:this._meta?this._meta.duration:0}get state(){return this._player?this._player.state:p5.INIT}getCurrentTime(){return this._player?this._player.currentTime:0}getVolume(){return this._player?this._player.volume:0}getLoop(){return!!this._player&&this._player.loop}setCurrentTime(t){var e;null==(e=this._player)||e.seek(t).catch((()=>{}))}setVolume(t){this._player&&(this._player.volume=t)}setLoop(t){this._player&&(this._player.loop=t)}play(){var t;null==(t=this._player)||t.play().catch((()=>{}))}pause(){var t;null==(t=this._player)||t.pause().catch((()=>{}))}stop(){var t;null==(t=this._player)||t.stop().catch((()=>{}))}playOneShot(t=1){this._nativeAsset&&M5.loadOneShotAudio(this._nativeAsset.url,t).then((t=>{t.play()})).catch((()=>{}))}}).AudioType=_5,R5=Za((O5=B5).prototype,"_duration",[vh],(function(){return 0})),s(O5.prototype,"_nativeDep",[Yh],Object.getOwnPropertyDescriptor(O5.prototype,"_nativeDep"),O5.prototype),P5=O5))||P5);function N5(t,e,i){M5.load(t,{audioLoadMode:e.audioLoadMode}).then((e=>{const s={player:e,url:t,duration:e.duration,type:e.type};i(null,s)})).catch((t=>{i(t)}))}function L5(t,e,i,s){const r=new F5;r._nativeUrl=t,r._nativeAsset=e,r.duration=e.duration,s(null,r)}a.AudioClip=F5,rx.register({".mp3":N5,".ogg":N5,".wav":N5,".m4a":N5}),fx.register({".mp3":L5,".ogg":L5,".wav":L5,".m4a":L5});const k5=new class{constructor(){this._oneShotAudioInfoList=[],this._audioPlayerInfoList=[]}_findIndex(t,e){return t.findIndex((t=>t.audio===e))}_tryAddPlaying(t,e){const i=this._findIndex(t,e);if(i>-1)return t[i].playTime=performance.now(),!1;const s={audio:e,playTime:performance.now()};return t.push(s),!0}addPlaying(t){t instanceof M5?this._tryAddPlaying(this._audioPlayerInfoList,t):this._tryAddPlaying(this._oneShotAudioInfoList,t)}_tryRemovePlaying(t,e){const i=this._findIndex(t,e);return-1!==i&&(ie(t,i),!0)}removePlaying(t){t instanceof M5?this._tryRemovePlaying(this._audioPlayerInfoList,t):this._tryRemovePlaying(this._oneShotAudioInfoList,t)}discardOnePlayingIfNeeded(){if(this._audioPlayerInfoList.length+this._oneShotAudioInfoList.length<M5.maxAudioChannel)return;let t;this._oneShotAudioInfoList.length>0?this._oneShotAudioInfoList.forEach((e=>{(!t||e.playTime<t.playTime)&&(t=e)})):this._audioPlayerInfoList.forEach((e=>{(!t||e.playTime<t.playTime)&&(t=e)})),t&&(t.audio.stop(),this.removePlaying(t.audio))}pause(){this._oneShotAudioInfoList.forEach((t=>{t.audio.stop()})),this._audioPlayerInfoList.forEach((t=>{t.audio.pause().catch((()=>{}))}))}resume(){this._audioPlayerInfoList.forEach((t=>{t.audio.play().catch((()=>{}))}))}};var z5,U5,V5,j5,H5,G5,W5,X5,Y5,q5;const $5="audiosource-loaded";let K5=(z5=ah("cc.AudioSource"),U5=Xh(F5),V5=Xh(F5),z5((q5=class t extends Km{static get maxAudioChannel(){return M5.maxAudioChannel}constructor(){super(),this._clip=G5&&G5(),this._player=null,this._hasRegisterListener=!1,this._loop=W5&&W5(),this._playOnAwake=X5&&X5(),this._volume=Y5&&Y5(),this._cachedCurrentTime=-1,this._operationsBeforeLoading=[],this._isLoaded=!1,this._lastSetClip=null}_resetPlayer(){this._player&&(k5.removePlaying(this._player),this._unregisterListener(),this._player.destroy(),this._player=null)}set clip(t){t!==this._clip&&(this._clip=t,this._syncPlayer())}get clip(){return this._clip}_syncPlayer(){const t=this._clip;if(this._lastSetClip!==t)return t?void(t._nativeAsset?(this._isLoaded=!1,this._lastSetClip=t,this._operationsBeforeLoading.length=0,M5.load(t._nativeAsset.url,{audioLoadMode:t.loadMode}).then((e=>{var i;this._lastSetClip===t?(this._isLoaded=!0,this._resetPlayer(),this._player=e,this._syncStates(),null==(i=this.node)||i.emit($5)):e.destroy()})).catch((()=>{}))):console.error("Invalid audio clip")):(this._lastSetClip=null,void this._resetPlayer())}_registerListener(){if(!this._hasRegisterListener&&this._player){const t=this._player;t.onEnded((()=>{var e;k5.removePlaying(t),null==(e=this.node)||e.emit("ended",this)})),t.onInterruptionBegin((()=>{k5.removePlaying(t)})),t.onInterruptionEnd((()=>{this._player===t&&k5.addPlaying(t)})),this._hasRegisterListener=!0}}_unregisterListener(){this._player&&this._hasRegisterListener&&(this._player.offEnded(),this._player.offInterruptionBegin(),this._player.offInterruptionEnd(),this._hasRegisterListener=!1)}set loop(t){this._loop=t,this._player&&(this._player.loop=t)}get loop(){return this._loop}set playOnAwake(t){this._playOnAwake=t}get playOnAwake(){return this._playOnAwake}set volume(t){Number.isNaN(t)?M("illegal audio volume!"):(t=Ri(t,0,1),this._player?(this._player.volume=t,this._volume=this._player.volume):this._volume=t)}get volume(){return this._volume}onLoad(){this._syncPlayer()}onEnable(){this._playOnAwake&&!this.playing&&this.play()}onDisable(){const t=this._getRootNode();null!=t&&t._persistNode||this.pause()}onDestroy(){this.stop(),this.clip=null}getPCMData(t){return new Promise((e=>{if(0!==t&&1!==t)return M("Only support channel index 0 or 1 to get buffer"),void e(void 0);var i;this._player?e(this._player.getPCMData(t)):null==(i=this.node)||i.once($5,(()=>{var i;e(null==(i=this._player)?void 0:i.getPCMData(t))}))}))}getSampleRate(){return new Promise((t=>{var e;this._player?t(this._player.sampleRate):null==(e=this.node)||e.once($5,(()=>{t(this._player.sampleRate)}))}))}_getRootNode(){var t,e;let i=this.node,s=null==(t=i)||null==(e=t.parent)?void 0:e.parent;for(;s;){var r,n,o;i=null==(r=i)?void 0:r.parent,s=null==(n=i)||null==(o=n.parent)?void 0:o.parent}return i}play(){if(!this._isLoaded&&this.clip)return void this._operationsBeforeLoading.push({op:"play",params:null});var t;this._registerListener(),k5.discardOnePlayingIfNeeded(),this.state===p5.PLAYING&&(null==(t=this._player)||t.stop().catch((()=>{})));const e=this._player;e&&(e.play().then((()=>{var t;null==(t=this.node)||t.emit("started",this)})).catch((()=>{k5.removePlaying(e)})),k5.addPlaying(e))}pause(){var t;this._isLoaded||!this.clip?null==(t=this._player)||t.pause().catch((()=>{})):this._operationsBeforeLoading.push({op:"pause",params:null})}stop(){this._isLoaded||!this.clip?this._player&&(this._player.stop().catch((()=>{})),k5.removePlaying(this._player)):this._operationsBeforeLoading.push({op:"stop",params:null})}playOneShot(t,e=1){if(!t._nativeAsset)return void console.error("Invalid audio clip");let i;M5.loadOneShotAudio(t._nativeAsset.url,this._volume*e,{audioLoadMode:t.loadMode}).then((t=>{i=t,k5.discardOnePlayingIfNeeded(),t.onEnd=()=>{k5.removePlaying(t)},t.play(),k5.addPlaying(t)})).catch((()=>{i&&k5.removePlaying(i)}))}_syncStates(){this._player&&(this._player.loop=this._loop,this._player.volume=this._volume,this._operationsBeforeLoading.forEach((t=>{var e;"seek"===t.op?(this._cachedCurrentTime=t.params&&t.params[0],this._player&&this._player.seek(this._cachedCurrentTime).catch((()=>{}))):null==(e=this[t.op])||e.call(this)})),this._operationsBeforeLoading.length=0)}set currentTime(t){var e;Number.isNaN(t)?M("illegal audio time!"):(t=Ri(t,0,this.duration),this._isLoaded||!this.clip?(this._cachedCurrentTime=t,null==(e=this._player)||e.seek(this._cachedCurrentTime).catch((()=>{}))):this._operationsBeforeLoading.push({op:"seek",params:[t]}))}get currentTime(){return this._player?this._player.currentTime:this._cachedCurrentTime<0?0:this._cachedCurrentTime}get duration(){var t,e;return null!==(t=null==(e=this._clip)?void 0:e.getDuration())&&void 0!==t?t:this._player?this._player.duration:0}get state(){return this._player?this._player.state:p5.INIT}get playing(){return this.state===t.AudioState.PLAYING}},q5.AudioState=p5,q5.EventType={STARTED:"started",ENDED:"ended"},G5=Za((H5=q5).prototype,"_clip",[U5],(function(){return null})),W5=Za(H5.prototype,"_loop",[vh],(function(){return!1})),X5=Za(H5.prototype,"_playOnAwake",[vh],(function(){return!0})),Y5=Za(H5.prototype,"_volume",[vh],(function(){return 1})),s(H5.prototype,"clip",[V5],Object.getOwnPropertyDescriptor(H5.prototype,"clip"),H5.prototype),j5=H5))||j5);t({AudioSource:K5,AudioSourceComponent:K5}),Q(F5,"AudioClip",[{name:"PlayingState",newName:"AudioState",target:K5,targetName:"AudioSource"}]),tt(F5.prototype,"AudioClip.prototype",["state","play","pause","stop","playOneShot","setCurrentTime","setVolume","setLoop","getCurrentTime","getVolume","getLoop"].map((t=>({name:t,suggest:`please use AudioSource.prototype.${t} instead`})))),a.AudioSourceComponent=K5,Xt(K5,"cc.AudioSourceComponent"),h.log=I,h.warn=M,h.error=P,h.assert=O,h._throw=F,h.logID=k,h.warnID=j,h.errorID=G,h.assertID=X,h.debug=Z,h.path={join:Jo,extname:ta,mainFileName:ea,basename:ia,dirname:sa,changeExtname:ra,changeBasename:na,_normalize:oa,stripSep:aa,get sep(){return ha()}};class Z5{constructor(t){this._pool=[],this.poolHandlerComp=t}size(){return this._pool.length}clear(){const t=this._pool.length;for(let e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0}put(t){if(t&&-1===this._pool.indexOf(t)){t.removeFromParent();const e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;e&&e.unuse&&e.unuse(),this._pool.push(t)}}get(...t){const e=this._pool.length-1;if(e<0)return null;{const t=this._pool[e];this._pool.length=e;const i=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;return i&&i.reuse&&i.reuse(arguments),t}}}var Q5,J5;t("NodePool",Z5),h.NodePool=Z5;const t4=null!==(Q5=globalThis.jsb)&&void 0!==Q5?Q5:{};{Object.defineProperty(t4,"reflection",{get:()=>(void 0!==t4.__bridge||(!globalThis.JavascriptJavaBridge||ga.os!==ga.OS.ANDROID&&ga.os!==ga.OS.OHOS?!globalThis.JavaScriptObjCBridge||ga.os!==ga.OS.IOS&&ga.os!==ga.OS.OSX?globalThis.JavaScriptArkTsBridge&&ga.os===ga.OS.OPENHARMONY?t4.__bridge=new globalThis.JavaScriptArkTsBridge:t4.__bridge=null:t4.__bridge=new globalThis.JavaScriptObjCBridge:t4.__bridge=new globalThis.JavascriptJavaBridge),t4.__bridge),enumerable:!0,configurable:!0,set(t){t4.__bridge=t}}),Object.defineProperty(t4,"bridge",{get:()=>(void 0!==t4.__ccbridge||(globalThis.ScriptNativeBridge&&ga.os===ga.OS.ANDROID||ga.os===ga.OS.IOS||ga.os===ga.OS.OSX||ga.os===ga.OS.OHOS?t4.__ccbridge=new ScriptNativeBridge:t4.__ccbridge=null),t4.__ccbridge),enumerable:!0,configurable:!0,set(t){t4.__ccbridge=t}});const t={eventMap:new Map,addNativeEventListener(t,e){this.eventMap.get(t)||this.eventMap.set(t,[]);const i=this.eventMap.get(t);i.includes(e)||i.push(e)},dispatchEventToNative(t,e){t4.bridge.sendToNative(t,e)},removeAllListenersForEvent(t){return this.eventMap.delete(t)},removeNativeEventListener(t,e){const i=this.eventMap.get(t);if(!i)return!1;for(let t=0,s=i.length;t<s;t++)if(i[t]===e)return i.splice(t,1),!0;return!0},removeAllListeners(){this.eventMap.clear()},triggerEvent(t,e){const i=this.eventMap.get(t);i?i.map((t=>t.call(null,e))):console.error(`${t} does not exist`)}};Object.defineProperty(t4,"jsbBridgeWrapper",{get:()=>(void 0!==t4.__JsbBridgeWrapper||(globalThis.ScriptNativeBridge&&ga.os===ga.OS.ANDROID||ga.os===ga.OS.IOS||ga.os===ga.OS.OSX||ga.os===ga.OS.OHOS?(t4.__JsbBridgeWrapper=t,t4.bridge.onNative=(t,e)=>{t4.__JsbBridgeWrapper.triggerEvent(t,e)}):t4.__JsbBridgeWrapper=null),t4.__JsbBridgeWrapper),enumerable:!0,configurable:!0,set(t){t4.__JsbBridgeWrapper=t}});const e=t4.saveImageData;t4.saveImageData=(t,i,s,r)=>new Promise(((n,o)=>{e(t,i,s,r,(t=>{t?n():o()}))}))}const e4=t("native",{DownloaderHints:t4.DownloaderHints,Downloader:t4.Downloader,zipUtils:t4.zipUtils,fileUtils:t4.fileUtils,DebugRenderer:t4.DebugRenderer,copyTextToClipboard:null==(J5=t4.copyTextToClipboard)?void 0:J5.bind(t4),garbageCollect:t4.garbageCollect,reflection:t4.reflection,bridge:t4.bridge,jsbBridgeWrapper:t4.jsbBridgeWrapper,AssetsManager:t4.AssetsManager,EventAssetsManager:t4.EventAssetsManager,Manifest:t4.Manifest,saveImageData:t4.saveImageData,process:t4.process,adpf:t4.adpf});h.renderer=wO;var i4=Object.setPrototypeOf;let s4={};!function(t){var e=function(){function e(i){this._clock=new t.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=i,console.info("DragonBones: "+e.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}return e.prototype.advanceTime=function(e){if(this._objects.length>0){for(var i=0,s=this._objects;i<s.length;i++)s[i].returnToPool();this._objects.length=0}if(this._clock.advanceTime(e),this._events.length>0){for(var r=0;r<this._events.length;++r){var n=this._events[r],o=n.armature;null!==o._armatureData&&(o.eventDispatcher.dispatchDBEvent(n.type,n),n.type===t.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(n.type,n)),this.bufferObject(n)}this._events.length=0}},e.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},e.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),e.VERSION="5.6.300",e.yDown=!1,e.debug=!1,e.debugDraw=!1,e.webAssembly=!1,e}();t.DragonBones=e}(s4),console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),Date.now||(Date.now=function(){return(new Date).getTime()}),i4=function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},function(t){var e=function(){function t(){this.hashCode=t._hashCode++,this._isInPool=!1}return t._returnObject=function(e){var i=String(e.constructor),s=i in t._maxCountMap?t._maxCountMap[i]:t._defaultMaxCount,r=t._poolsMap[i]=t._poolsMap[i]||[];r.length<s&&(e._isInPool?console.warn("The object is already in the pool."):(e._isInPool=!0,r.push(e)))},t.toString=function(){throw new Error},t.setMaxCount=function(e,i){if((i<0||i!=i)&&(i=0),null!==e)null!==(r=(s=String(e))in t._poolsMap?t._poolsMap[s]:null)&&r.length>i&&(r.length=i),t._maxCountMap[s]=i;else for(var s in t._defaultMaxCount=i,t._poolsMap){var r;(r=t._poolsMap[s]).length>i&&(r.length=i),s in t._maxCountMap&&(t._maxCountMap[s]=i)}},t.clearPool=function(e){if(void 0===e&&(e=null),null!==e){var i=String(e);null!==(r=i in t._poolsMap?t._poolsMap[i]:null)&&r.length>0&&(r.length=0)}else for(var s in t._poolsMap){var r;(r=t._poolsMap[s]).length=0}},t.borrowObject=function(e){var i=String(e),s=i in t._poolsMap?t._poolsMap[i]:null;if(null!==s&&s.length>0){var r=s.pop();return r._isInPool=!1,r}var n=new e;return n._onClear(),n},t.prototype.returnToPool=function(){this._onClear(),t._returnObject(this)},t._hashCode=0,t._defaultMaxCount=3e3,t._maxCountMap={},t._poolsMap={},t}();t.BaseObject=e}(s4),function(t){var e=function(){function t(t,e,i,s,r,n){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===r&&(r=0),void 0===n&&(n=0),this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=n}return t.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},t.prototype.concat=function(t){var e=this.a*t.a,i=0,s=0,r=this.d*t.d,n=this.tx*t.a+t.tx,o=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,i+=this.b*t.d,s+=this.c*t.a,r+=this.c*t.b),0===t.b&&0===t.c||(i+=this.a*t.b,s+=this.d*t.c,n+=this.ty*t.c,o+=this.tx*t.b),this.a=e,this.b=i,this.c=s,this.d=r,this.tx=n,this.ty=o,this},t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,s=this.d,r=this.tx,n=this.ty;if(0===e&&0===i)return this.b=this.c=0,0===t||0===s?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,s=this.d=1/s,this.tx=-t*r,this.ty=-s*n),this;var o=t*s-e*i;if(0===o)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;o=1/o;var a=this.a=s*o;return e=this.b=-e*o,i=this.c=-i*o,s=this.d=t*o,this.tx=-(a*r+i*n),this.ty=-(e*r+s*n),this},t.prototype.transformPoint=function(t,e,i,s){void 0===s&&(s=!1),i.x=this.a*t+this.c*e,i.y=this.b*t+this.d*e,s||(i.x+=this.tx,i.y+=this.ty)},t.prototype.transformRectangle=function(t,e){void 0===e&&(e=!1);var i=this.a,s=this.b,r=this.c,n=this.d,o=e?0:this.tx,a=e?0:this.ty,h=t.x,l=t.y,c=h+t.width,u=l+t.height,d=i*h+r*l+o,_=s*h+n*l+a,p=i*c+r*l+o,m=s*c+n*l+a,g=i*c+r*u+o,f=s*c+n*u+a,y=i*h+r*u+o,b=s*h+n*u+a,v=0;d>p&&(v=d,d=p,p=v),g>y&&(v=g,g=y,y=v),t.x=Math.floor(d<g?d:g),t.width=Math.ceil((p>y?p:y)-t.x),_>m&&(v=_,_=m,m=v),f>b&&(v=f,f=b,b=v),t.y=Math.floor(_<f?_:f),t.height=Math.ceil((m>b?m:b)-t.y)},t}();t.Matrix=e}(s4),function(t){var e=function(){function t(t,e,i,s,r,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===r&&(r=1),void 0===n&&(n=1),this.x=t,this.y=e,this.skew=i,this.rotation=s,this.scaleX=r,this.scaleY=n}return t.normalizeRadian=function(t){return(t=(t+Math.PI)%(2*Math.PI))+(t>0?-Math.PI:Math.PI)},t.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},t.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},t.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},t.prototype.fromMatrix=function(e){var i=this.scaleX,s=this.scaleY,r=t.PI_Q;this.x=e.tx,this.y=e.ty,this.rotation=Math.atan(e.b/e.a);var n=Math.atan(-e.c/e.d);return this.scaleX=this.rotation>-r&&this.rotation<r?e.a/Math.cos(this.rotation):e.b/Math.sin(this.rotation),this.scaleY=n>-r&&n<r?e.d/Math.cos(n):-e.c/Math.sin(n),i>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),s>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,n-=Math.PI),this.skew=n-this.rotation,this},t.prototype.toMatrix=function(t){return 0===this.rotation?(t.a=1,t.b=0):(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation)),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY),t.tx=this.x,t.ty=this.y,this},t.PI=Math.PI,t.PI_D=2*Math.PI,t.PI_H=Math.PI/2,t.PI_Q=Math.PI/4,t.RAD_DEG=180/Math.PI,t.DEG_RAD=Math.PI/180,t}();t.Transform=e}(s4),function(t){var e=function(){function t(t,e,i,s,r,n,o,a){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===s&&(s=1),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===a&&(a=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=s,this.alphaOffset=r,this.redOffset=n,this.greenOffset=o,this.blueOffset=a}return t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t}();t.ColorTransform=e}(s4),function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.clear=function(){this.x=this.y=0},t}();t.Point=e}(s4),function(t){var e=function(){function t(t,e,i,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),this.x=t,this.y=e,this.width=i,this.height=s}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t}();t.Rectangle=e}(s4),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ints=[],e.floats=[],e.strings=[],e}return i4(e,t),e.toString=function(){return"[class dragonBones.UserData]"},e.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},e.prototype.addInt=function(t){this.ints.push(t)},e.prototype.addFloat=function(t){this.floats.push(t)},e.prototype.addString=function(t){this.strings.push(t)},e.prototype.getInt=function(t){return void 0===t&&(t=0),t>=0&&t<this.ints.length?this.ints[t]:0},e.prototype.getFloat=function(t){return void 0===t&&(t=0),t>=0&&t<this.floats.length?this.floats[t]:0},e.prototype.getString=function(t){return void 0===t&&(t=0),t>=0&&t<this.strings.length?this.strings[t]:""},e}(t.BaseObject);t.UserData=e;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return i4(e,t),e.toString=function(){return"[class dragonBones.ActionData]"},e.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},e}(t.BaseObject);t.ActionData=i}(s4),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frameIndices=[],e.cachedFrames=[],e.armatureNames=[],e.armatures={},e.userData=null,e}return i4(e,t),e.toString=function(){return"[class dragonBones.DragonBonesData]"},e.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.userData=null},e.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):(t.parent=this,this.armatures[t.name]=t,this.armatureNames.push(t.name))},e.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},e.prototype.dispose=function(){console.warn(""),this.returnToPool()},e}(t.BaseObject);t.DragonBonesData=e}(s4),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.aabb=new t.Rectangle,i.animationNames=[],i.sortedBones=[],i.sortedSlots=[],i.defaultActions=[],i.actions=[],i.bones={},i.slots={},i.constraints={},i.skins={},i.animations={},i.canvas=null,i.userData=null,i}return i4(i,e),i.toString=function(){return"[class dragonBones.ArmatureData]"},i.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++)e[t].returnToPool();for(var i=0,s=this.actions;i<s.length;i++)s[i].returnToPool();for(var r in this.bones)this.bones[r].returnToPool(),delete this.bones[r];for(var r in this.slots)this.slots[r].returnToPool(),delete this.slots[r];for(var r in this.constraints)this.constraints[r].returnToPool(),delete this.constraints[r];for(var r in this.skins)this.skins[r].returnToPool(),delete this.skins[r];for(var r in this.animations)this.animations[r].returnToPool(),delete this.animations[r];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},i.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),i=0,s=0;for(this.sortedBones.length=0;s<t;){var r=e[i++];if(i>=t&&(i=0),!(this.sortedBones.indexOf(r)>=0)){var n=!1;for(var o in this.constraints){var a=this.constraints[o];if(a.root===r&&this.sortedBones.indexOf(a.target)<0){n=!0;break}}n||null!==r.parent&&this.sortedBones.indexOf(r.parent)<0||(this.sortedBones.push(r),s++)}}}},i.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},i.prototype.setCacheFrame=function(t,e){var i=this.parent.cachedFrames,s=i.length;return i.length+=10,i[s]=t.a,i[s+1]=t.b,i[s+2]=t.c,i[s+3]=t.d,i[s+4]=t.tx,i[s+5]=t.ty,i[s+6]=e.rotation,i[s+7]=e.skew,i[s+8]=e.scaleX,i[s+9]=e.scaleY,s},i.prototype.getCacheFrame=function(t,e,i){var s=this.parent.cachedFrames;t.a=s[i],t.b=s[i+1],t.c=s[i+2],t.d=s[i+3],t.tx=s[i+4],t.ty=s[i+5],e.rotation=s[i+6],e.skew=s[i+7],e.scaleX=s[i+8],e.scaleY=s[i+9],e.x=t.tx,e.y=t.ty},i.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},i.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},i.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},i.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):(t.parent=this,this.skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},i.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):(t.parent=this,this.animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},i.prototype.addAction=function(t,e){e?this.defaultActions.push(t):this.actions.push(t)},i.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},i.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},i.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},i.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},i.prototype.getMesh=function(t,e,i){var s=this.getSkin(t);return null===s?null:s.getDisplay(e,i)},i.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},i}(t.BaseObject);t.ArmatureData=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i.userData=null,i}return i4(i,e),i.toString=function(){return"[class dragonBones.BoneData]"},i.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.name="",this.transform.identity(),this.userData=null,this.parent=null},i}(t.BaseObject);t.BoneData=i;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return i4(e,t),e.toString=function(){return"[class dragonBones.SurfaceData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.vertices.length=0},e}(i);t.SurfaceData=s;var r=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=null,t.userData=null,t}return i4(i,e),i.createColor=function(){return new t.ColorTransform},i.toString=function(){return"[class dragonBones.SlotData]"},i.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.name="",this.color=null,this.userData=null,this.parent=null},i.DEFAULT_COLOR=new t.ColorTransform,i}(t.BaseObject);t.SlotData=r}(s4),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.prototype._onClear=function(){this.order=0,this.name="",this.type=0,this.target=null,this.root=null,this.bone=null},e}(t.BaseObject);t.ConstraintData=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.toString=function(){return"[class dragonBones.IKConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},e}(e);t.IKConstraintData=i;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return i4(e,t),e.toString=function(){return"[class dragonBones.PathConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.pathSlot=null,this.pathDisplayData=null,this.bones.length=0,this.positionMode=0,this.spacingMode=1,this.rotateMode=1,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=0,this.translateMix=0},e.prototype.AddBone=function(t){this.bones.push(t)},e}(e);t.PathConstraintData=s}(s4),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.toString=function(){return"[class dragonBones.CanvasData]"},e.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},e}(t.BaseObject);t.CanvasData=e}(s4),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.displays={},e}return i4(e,t),e.toString=function(){return"[class dragonBones.SkinData]"},e.prototype._onClear=function(){for(var t in this.displays){for(var e=0,i=this.displays[t];e<i.length;e++){var s=i[e];null!==s&&s.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},e.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this),this.displays[t].push(e)},e.prototype.getDisplay=function(t,e){var i=this.getDisplays(t);if(null!==i)for(var s=0,r=i;s<r.length;s++){var n=r[s];if(null!==n&&n.name===e)return n}return null},e.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},e}(t.BaseObject);t.SkinData=e}(s4),function(t){var e=function(){function t(){this.weight=null}return t.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool(),this.isShared=!1,this.inheritDeform=!1,this.offset=0,this.data=null,this.weight=null},t.prototype.shareFrom=function(t){this.isShared=!0,this.offset=t.offset,this.weight=t.weight},t}();t.VerticesData=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i}return i4(i,e),i.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},i}(t.BaseObject);t.DisplayData=i;var s=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.pivot=new t.Point,i}return i4(i,e),i.toString=function(){return"[class dragonBones.ImageDisplayData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},i}(i);t.ImageDisplayData=s;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actions=[],e}return i4(e,t),e.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this);for(var e=0,i=this.actions;e<i.length;e++)i[e].returnToPool();this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},e.prototype.addAction=function(t){this.actions.push(t)},e}(i);t.ArmatureDisplayData=r;var n=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.vertices=new e,i}return i4(i,t),i.toString=function(){return"[class dragonBones.MeshDisplayData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.vertices.clear(),this.texture=null},i}(i);t.MeshDisplayData=n;var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boundingBox=null,e}return i4(e,t),e.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},e}(i);t.BoundingBoxDisplayData=o;var a=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.vertices=new e,i.curveLengths=[],i}return i4(i,t),i.toString=function(){return"[class dragonBones.PathDisplayData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=4,this.closed=!1,this.constantSpeed=!1,this.vertices.clear(),this.curveLengths.length=0},i}(i);t.PathDisplayData=a;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return i4(e,t),e.toString=function(){return"[class dragonBones.WeightData]"},e.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},e.prototype.addBone=function(t){this.bones.push(t)},e}(t.BaseObject);t.WeightData=h}(s4),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},e}(t.BaseObject);t.BoundingBoxData=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},e._computeOutCode=function(t,e,i,s,r,n){var o=0;return t<i?o|=1:t>r&&(o|=2),e<s?o|=4:e>n&&(o|=8),o},e.rectangleIntersectsSegment=function(t,i,s,r,n,o,a,h,l,c,u){void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null);var d=t>n&&t<a&&i>o&&i<h,_=s>n&&s<a&&r>o&&r<h;if(d&&_)return-1;for(var p=0,m=e._computeOutCode(t,i,n,o,a,h),g=e._computeOutCode(s,r,n,o,a,h);;){if(!(m|g)){p=2;break}if(m&g)break;var f=0,y=0,b=0,v=0!==m?m:g;4&v?(f=t+(s-t)*(o-i)/(r-i),y=o,null!==u&&(b=.5*-Math.PI)):8&v?(f=t+(s-t)*(h-i)/(r-i),y=h,null!==u&&(b=.5*Math.PI)):2&v?(y=i+(r-i)*(a-t)/(s-t),f=a,null!==u&&(b=0)):1&v&&(y=i+(r-i)*(n-t)/(s-t),f=n,null!==u&&(b=Math.PI)),v===m?(t=f,i=y,m=e._computeOutCode(t,i,n,o,a,h),null!==u&&(u.x=b)):(s=f,r=y,g=e._computeOutCode(s,r,n,o,a,h),null!==u&&(u.y=b))}return p&&(d?(p=2,null!==l&&(l.x=s,l.y=r),null!==c&&(c.x=s,c.y=s),null!==u&&(u.x=u.y+Math.PI)):_?(p=1,null!==l&&(l.x=t,l.y=i),null!==c&&(c.x=t,c.y=i),null!==u&&(u.y=u.x+Math.PI)):(p=3,null!==l&&(l.x=t,l.y=i),null!==c&&(c.x=s,c.y=r))),p},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},e.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var s=.5*this.height;if(e>=-s&&e<=s)return!0}return!1},e.prototype.intersectsSegment=function(t,i,s,r,n,o,a){void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null);var h=.5*this.width,l=.5*this.height;return e.rectangleIntersectsSegment(t,i,s,r,-h,-l,h,l,n,o,a)},e}(e);t.RectangleBoundingBoxData=i;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.toString=function(){return"[class dragonBones.EllipseData]"},e.ellipseIntersectsSegment=function(t,e,i,s,r,n,o,a,h,l,c){void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=null);var u=o/a,d=u*u,_=i-t,p=(s*=u)-(e*=u),m=Math.sqrt(_*_+p*p),g=_/m,f=p/m,y=(r-t)*g+(n-e)*f,b=o*o,v=b-(t*t+e*e)+y*y,S=0;if(v>=0){var T=Math.sqrt(v),w=y-T,x=y+T,C=w<0?-1:w<=m?0:1,A=x<0?-1:x<=m?0:1,D=C*A;if(D<0)return-1;0===D&&(-1===C?(S=2,i=t+x*g,s=(e+x*f)/u,null!==h&&(h.x=i,h.y=s),null!==l&&(l.x=i,l.y=s),null!==c&&(c.x=Math.atan2(s/b*d,i/b),c.y=c.x+Math.PI)):1===A?(S=1,t+=w*g,e=(e+w*f)/u,null!==h&&(h.x=t,h.y=e),null!==l&&(l.x=t,l.y=e),null!==c&&(c.x=Math.atan2(e/b*d,t/b),c.y=c.x+Math.PI)):(S=3,null!==h&&(h.x=t+w*g,h.y=(e+w*f)/u,null!==c&&(c.x=Math.atan2(h.y/b*d,h.x/b))),null!==l&&(l.x=t+x*g,l.y=(e+x*f)/u,null!==c&&(c.y=Math.atan2(l.y/b*d,l.x/b)))))}return S},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},e.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var s=.5*this.height;if(e>=-s&&e<=s)return e*=i/s,Math.sqrt(t*t+e*e)<=i}return!1},e.prototype.intersectsSegment=function(t,i,s,r,n,o,a){return void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),e.ellipseIntersectsSegment(t,i,s,r,0,0,.5*this.width,.5*this.height,n,o,a)},e}(e);t.EllipseBoundingBoxData=s;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return i4(e,t),e.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},e.polygonIntersectsSegment=function(t,e,i,s,r,n,o,a){void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),t===i&&(t=i+1e-6),e===s&&(e=s+1e-6);for(var h=r.length,l=t-i,c=e-s,u=t*s-e*i,d=0,_=r[h-2],p=r[h-1],m=0,g=0,f=0,y=0,b=0,v=0,S=0;S<h;S+=2){var T=r[S],w=r[S+1];_===T&&(_=T+1e-4),p===w&&(p=w+1e-4);var x=_-T,C=p-w,A=_*w-p*T,D=l*C-c*x,E=(u*x-l*A)/D;if((E>=_&&E<=T||E>=T&&E<=_)&&(0===l||E>=t&&E<=i||E>=i&&E<=t)){var I=(u*C-c*A)/D;if((I>=p&&I<=w||I>=w&&I<=p)&&(0===c||I>=e&&I<=s||I>=s&&I<=e)){if(null===o){f=E,y=I,b=E,v=I,d++,null!==a&&(a.x=Math.atan2(w-p,T-_)-.5*Math.PI,a.y=a.x);break}var M=E-t;M<0&&(M=-M),0===d?(m=M,g=M,f=E,y=I,b=E,v=I,null!==a&&(a.x=Math.atan2(w-p,T-_)-.5*Math.PI,a.y=a.x)):(M<m&&(m=M,f=E,y=I,null!==a&&(a.x=Math.atan2(w-p,T-_)-.5*Math.PI)),M>g&&(g=M,b=E,v=I,null!==a&&(a.y=Math.atan2(w-p,T-_)-.5*Math.PI))),d++}}_=T,p=w}return 1===d?(null!==n&&(n.x=f,n.y=y),null!==o&&(o.x=f,o.y=y),null!==a&&(a.y=a.x+Math.PI)):d>1&&(d++,null!==n&&(n.x=f,n.y=y),null!==o&&(o.x=b,o.y=v)),d},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},e.prototype.containsPoint=function(t,e){var i=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var s=0,r=this.vertices.length,n=r-2;s<r;s+=2){var o=this.vertices[n+1],a=this.vertices[s+1];if(a<e&&o>=e||o<e&&a>=e){var h=this.vertices[n],l=this.vertices[s];(e-a)*(h-l)/(o-a)+l<t&&(i=!i)}n=s}return i},e.prototype.intersectsSegment=function(t,s,r,n,o,a,h){void 0===o&&(o=null),void 0===a&&(a=null),void 0===h&&(h=null);var l=0;return 0!==i.rectangleIntersectsSegment(t,s,r,n,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(l=e.polygonIntersectsSegment(t,s,r,n,this.vertices,o,a,h)),l},e}(e);t.PolygonBoundingBoxData=r}(s4),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cachedFrames=[],e.boneTimelines={},e.surfaceTimelines={},e.slotTimelines={},e.constraintTimelines={},e.animationTimelines={},e.boneCachedFrameIndices={},e.slotCachedFrameIndices={},e.actionTimeline=null,e.zOrderTimeline=null,e}return i4(e,t),e.toString=function(){return"[class dragonBones.AnimationData]"},e.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,i=this.boneTimelines[t];e<i.length;e++)i[e].returnToPool();delete this.boneTimelines[t]}for(var t in this.surfaceTimelines){for(var s=0,r=this.surfaceTimelines[t];s<r.length;s++)r[s].returnToPool();delete this.surfaceTimelines[t]}for(var t in this.slotTimelines){for(var n=0,o=this.slotTimelines[t];n<o.length;n++)o[n].returnToPool();delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var a=0,h=this.constraintTimelines[t];a<h.length;a++)h[a].returnToPool();delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var l=0,c=this.animationTimelines[t];l<c.length;l++)c[l].returnToPool();delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},e.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var i=0,s=this.cacheFrames.length;i<s;++i)this.cachedFrames[i]=!1;for(var r=0,n=this.parent.sortedBones;r<n.length;r++){var o=n[r];for(i=0,s=(l=new Array(e)).length;i<s;++i)l[i]=-1;this.boneCachedFrameIndices[o.name]=l}for(var a=0,h=this.parent.sortedSlots;a<h.length;a++){var l,c=h[a];for(i=0,s=(l=new Array(e)).length;i<s;++i)l[i]=-1;this.slotCachedFrameIndices[c.name]=l}}},e.prototype.addBoneTimeline=function(t,e){var i=t.name in this.boneTimelines?this.boneTimelines[t.name]:this.boneTimelines[t.name]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addSurfaceTimeline=function(t,e){var i=t.name in this.surfaceTimelines?this.surfaceTimelines[t.name]:this.surfaceTimelines[t.name]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addSlotTimeline=function(t,e){var i=t.name in this.slotTimelines?this.slotTimelines[t.name]:this.slotTimelines[t.name]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addConstraintTimeline=function(t,e){var i=t.name in this.constraintTimelines?this.constraintTimelines[t.name]:this.constraintTimelines[t.name]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addAnimationTimeline=function(t,e){var i=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},e.prototype.getSurfaceTimelines=function(t){return t in this.surfaceTimelines?this.surfaceTimelines[t]:null},e.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},e.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},e.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null},e.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},e.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},e}(t.BaseObject);t.AnimationData=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.toString=function(){return"[class dragonBones.TimelineData]"},e.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},e}(t.BaseObject);t.TimelineData=i}(s4),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boneMask=[],e}return i4(e,t),e.toString=function(){return"[class dragonBones.AnimationConfig]"},e.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additiveBlending=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},e.prototype.clear=function(){this._onClear()},e.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additiveBlending=t.additiveBlending,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,i=this.boneMask.length;e<i;++e)this.boneMask[e]=t.boneMask[e]},e.prototype.containsBoneMask=function(t){return 0===this.boneMask.length||this.boneMask.indexOf(t)>=0},e.prototype.addBoneMask=function(t,e,i){void 0===i&&(i=!0);var s=t.getBone(e);if(null!==s&&(this.boneMask.indexOf(e)<0&&this.boneMask.push(e),i))for(var r=0,n=t.getBones();r<n.length;r++){var o=n[r];this.boneMask.indexOf(o.name)<0&&s.contains(o)&&this.boneMask.push(o.name)}},e.prototype.removeBoneMask=function(t,e,i){void 0===i&&(i=!0);var s=this.boneMask.indexOf(e);if(s>=0&&this.boneMask.splice(s,1),i){var r=t.getBone(e);if(null!==r)if(this.boneMask.length>0)for(var n=0,o=t.getBones();n<o.length;n++){var a=o[n],h=this.boneMask.indexOf(a.name);h>=0&&r.contains(a)&&this.boneMask.splice(h,1)}else for(var l=0,c=t.getBones();l<c.length;l++)(a=c[l])!==r&&(r.contains(a)||this.boneMask.push(a.name))}},e}(t.BaseObject);t.AnimationConfig=e}(s4),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.textures={},e}return i4(e,t),e.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},e.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var i=this.createTexture();i.copyFrom(t.textures[e]),this.textures[e]=i}},e.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this,this.textures[t.name]=t)},e.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},e}(t.BaseObject);t.TextureAtlasData=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.region=new t.Rectangle,i.frame=null,i}return i4(i,e),i.createRectangle=function(){return new t.Rectangle},i.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},i.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=i.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)},i}(t.BaseObject);t.TextureData=i}(s4),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e.bones=[],e}return i4(e,t),e.toString=function(){return"[class dragonBones.DeformVertices]"},e.prototype._onClear=function(){this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},e.prototype.init=function(t,e){if(this.verticesData=t,null!==this.verticesData){var i;i=null!==this.verticesData.weight?2*this.verticesData.weight.count:2*this.verticesData.data.intArray[this.verticesData.offset+0],this.verticesDirty=!0,this.vertices.length=i,this.bones.length=0;for(var s=0,r=this.vertices.length;s<r;++s)this.vertices[s]=0;if(null!==this.verticesData.weight)for(s=0,r=this.verticesData.weight.bones.length;s<r;++s){var n=e.getBone(this.verticesData.weight.bones[s].name);this.bones.push(n)}}else this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},e.prototype.isBonesUpdate=function(){for(var t=0,e=this.bones;t<e.length;t++){var i=e[t];if(null!==i&&i._childrenTransformDirty)return!0}return!1},e}(t.BaseObject);t.DeformVertices=e}(s4),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._slots=[],t._constraints=[],t._actions=[],t._animation=null,t._proxy=null,t._replaceTextureAtlasData=null,t._clock=null,t}return i4(i,e),i.toString=function(){return"[class dragonBones.Armature]"},i._onSortSlots=function(t,e){return t._zOrder>e._zOrder?1:-1},i.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++)e[t].returnToPool();for(var i=0,s=this._slots;i<s.length;i++)s[i].returnToPool();for(var r=0,n=this._constraints;r<n.length;r++)n[r].returnToPool();for(var o=0,a=this._actions;o<a.length;o++)a[o].returnToPool();null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._slotsDirty=!0,this._zOrderDirty=!1,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},i.prototype._sortZOrder=function(t,e){var i=this._armatureData.sortedSlots,s=null===t;if(this._zOrderDirty||!s){for(var r=0,n=i.length;r<n;++r){var o=s?r:t[e+r];if(!(o<0||o>=n)){var a=i[o],h=this.getSlot(a.name);null!==h&&h._setZorder(r)}}this._slotsDirty=!0,this._zOrderDirty=!s}},i.prototype._addBone=function(t){this._bones.indexOf(t)<0&&this._bones.push(t)},i.prototype._addSlot=function(t){this._slots.indexOf(t)<0&&this._slots.push(t)},i.prototype._addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},i.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},i.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},i.prototype.init=function(e,i,s,r){null===this._armatureData&&(this._armatureData=e,this._animation=t.BaseObject.borrowObject(t.Animation),this._proxy=i,this._display=s,this._dragonBones=r,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},i.prototype.advanceTime=function(t){if(!this._lockUpdate)if(null!==this._armatureData)if(null!==this._armatureData.parent){var e=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._slotsDirty&&(this._slotsDirty=!1,this._slots.sort(i._onSortSlots)),this._cacheFrameIndex<0||this._cacheFrameIndex!==e){var s=0,r=0;for(s=0,r=this._bones.length;s<r;++s)this._bones[s].update(this._cacheFrameIndex);for(s=0,r=this._slots.length;s<r;++s)this._slots[s].update(this._cacheFrameIndex)}if(this._actions.length>0){this._lockUpdate=!0;for(var n=0,o=this._actions;n<o.length;n++){var a=o[n],h=a.actionData;if(null!==h&&0===h.type)if(null!==a.slot)null!==(u=a.slot.childArmature)&&u.animation.fadeIn(h.name);else if(null!==a.bone)for(var l=0,c=this.getSlots();l<c.length;l++){var u,d=c[l];d.parent===a.bone&&null!==(u=d.childArmature)&&u.animation.fadeIn(h.name)}else this._animation.fadeIn(h.name);a.returnToPool()}this._actions.length=0,this._lockUpdate=!1}this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},i.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t&&t.length>0){if(null!==(o=this.getBone(t))&&(o.invalidUpdate(),e))for(var i=0,s=this._slots;i<s.length;i++)(l=s[i]).parent===o&&l.invalidUpdate()}else{for(var r=0,n=this._bones;r<n.length;r++){var o;(o=n[r]).invalidUpdate()}if(e)for(var a=0,h=this._slots;a<h.length;a++){var l;(l=h[a]).invalidUpdate()}}},i.prototype.containsPoint=function(t,e){for(var i=0,s=this._slots;i<s.length;i++){var r=s[i];if(r.containsPoint(t,e))return r}return null},i.prototype.intersectsSegment=function(t,e,i,s,r,n,o){void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null);for(var a=t===i,h=0,l=0,c=0,u=0,d=0,_=0,p=0,m=0,g=null,f=null,y=0,b=this._slots;y<b.length;y++){var v=b[y];if(v.intersectsSegment(t,e,i,s,r,n,o)>0){if(null===r&&null===n){g=v;break}var S;null!==r&&((S=a?r.y-e:r.x-t)<0&&(S=-S),(null===g||S<h)&&(h=S,c=r.x,u=r.y,g=v,o&&(p=o.x))),null!==n&&((S=n.x-t)<0&&(S=-S),(null===f||S>l)&&(l=S,d=n.x,_=n.y,f=v,null!==o&&(m=o.y)))}}return null!==g&&null!==r&&(r.x=c,r.y=u,null!==o&&(o.x=p)),null!==f&&null!==n&&(n.x=d,n.y=_,null!==o&&(o.y=m)),g},i.prototype.getBone=function(t){for(var e=0,i=this._bones;e<i.length;e++){var s=i[e];if(s.name===t)return s}return null},i.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return null!==e?e.parent:null},i.prototype.getSlot=function(t){for(var e=0,i=this._slots;e<i.length;e++){var s=i[e];if(s.name===t)return s}return null},i.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,i=this._slots;e<i.length;e++){var s=i[e];if(s.display===t)return s}return null},i.prototype.getBones=function(){return this._bones},i.prototype.getSlots=function(){return this._slots},Object.defineProperty(i.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,i=this._slots;e<i.length;e++){var s=i[e].childArmature;null!==s&&(s.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,i=this._slots;e<i.length;e++){var s=i[e];s.invalidUpdate(),s.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,i=this._slots;e<i.length;e++){var s=i[e].childArmature;null!==s&&(s.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i.prototype.replaceTexture=function(t){this.replacedTexture=t},i.prototype.hasEventListener=function(t){return this._proxy.hasDBEventListener(t)},i.prototype.addEventListener=function(t,e,i){this._proxy.addDBEventListener(t,e,i)},i.prototype.removeEventListener=function(t,e,i){this._proxy.removeDBEventListener(t,e,i)},i.prototype.enableAnimationCache=function(t){console.warn("Deprecated."),this.cacheFrameRate=t},i.prototype.getDisplay=function(){return this._display},i}(t.BaseObject);t.Armature=e}(s4),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.globalTransformMatrix=new t.Matrix,i.global=new t.Transform,i.offset=new t.Transform,i}return i4(i,e),i.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._armature=null},i.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),i._helpMatrix=new t.Matrix,i._helpTransform=new t.Transform,i._helpPoint=new t.Point,i}(t.BaseObject);t.TransformObject=e}(s4),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.animationPose=new t.Transform,i._blendState=new t.BlendState,i}return i4(i,e),i.toString=function(){return"[class dragonBones.Bone]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._blendState.clear(),this._boneData=null,this._parent=null,this._cachedFrameIndices=null},i.prototype._updateGlobalTransformMatrix=function(e){var i=this._boneData,s=this.global,r=this.globalTransformMatrix,n=this.origin,o=this.offset,a=this.animationPose,h=this._parent,l=this._armature.flipX,c=this._armature.flipY===t.DragonBones.yDown,u=null!==h,d=0;if(1===this.offsetMode?null!==n?(s.x=n.x+o.x+a.x,s.scaleX=n.scaleX*o.scaleX*a.scaleX,s.scaleY=n.scaleY*o.scaleY*a.scaleY,t.DragonBones.yDown?(s.y=n.y+o.y+a.y,s.skew=n.skew+o.skew+a.skew,s.rotation=n.rotation+o.rotation+a.rotation):(s.y=n.y-o.y+a.y,s.skew=n.skew-o.skew+a.skew,s.rotation=n.rotation-o.rotation+a.rotation)):(s.copyFrom(o),t.DragonBones.yDown||(s.y=-s.y,s.skew=-s.skew,s.rotation=-s.rotation),s.add(a)):0===this.offsetMode?null!==n?s.copyFrom(n).add(a):s.copyFrom(a):(u=!1,s.copyFrom(o),t.DragonBones.yDown||(s.y=-s.y,s.skew=-s.skew,s.rotation=-s.rotation)),u){var _=0===h._boneData.type?h.globalTransformMatrix:h._getGlobalTransformMatrix(s.x,s.y);if(i.inheritScale)i.inheritRotation||(h.updateGlobalTransform(),d=l&&c?s.rotation-(h.global.rotation+Math.PI):l?s.rotation+h.global.rotation+Math.PI:c?s.rotation+h.global.rotation:s.rotation-h.global.rotation,s.rotation=d),s.toMatrix(r),r.concat(_),i.inheritTranslation?(s.x=r.tx,s.y=r.ty):(r.tx=s.x,r.ty=s.y),e?s.fromMatrix(r):this._globalDirty=!0;else{if(i.inheritTranslation){var p=s.x,m=s.y;s.x=_.a*p+_.c*m+_.tx,s.y=_.b*p+_.d*m+_.ty}else l&&(s.x=-s.x),c&&(s.y=-s.y);i.inheritRotation?(h.updateGlobalTransform(),d=h.global.scaleX<0?s.rotation+h.global.rotation+Math.PI:s.rotation+h.global.rotation,_.a*_.d-_.b*_.c<0&&(d-=2*s.rotation,(l!==c||i.inheritReflection)&&(s.skew+=Math.PI),t.DragonBones.yDown||(s.skew=-s.skew)),s.rotation=d):(l||c)&&(l&&c?d=s.rotation+Math.PI:(d=l?Math.PI-s.rotation:-s.rotation,s.skew+=Math.PI),s.rotation=d),s.toMatrix(r)}}else(l||c)&&(l&&(s.x=-s.x),c&&(s.y=-s.y),l&&c?d=s.rotation+Math.PI:(d=l?Math.PI-s.rotation:-s.rotation,s.skew+=Math.PI),s.rotation=d),s.toMatrix(r)},i.prototype.init=function(t,e){null===this._boneData&&(this._boneData=t,this._armature=e,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},i.prototype.update=function(t){if(this._blendState.dirty=!1,t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,s=this._armature._constraints;i<s.length;i++)(o=s[i])._root===this&&o.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var r=0,n=this._armature._constraints;r<n.length;r++){var o;(o=n[r])._root===this&&o.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var a=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(a),a&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},i.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},i.prototype.invalidUpdate=function(){this._transformDirty=!0},i.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(i.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,i=this._armature.getSlots();e<i.length;e++){var s=i[e];s.parent===this&&s._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i.prototype.getBones=function(){console.warn("Deprecated.");for(var t=new Array,e=0,i=this._armature.getBones();e<i.length;e++){var s=i[e];s.parent===this&&t.push(s)}return t},i.prototype.getSlots=function(){console.warn("Deprecated.");for(var t=new Array,e=0,i=this._armature.getSlots();e<i.length;e++){var s=i[e];s.parent===this&&t.push(s)}return t},Object.defineProperty(i.prototype,"slot",{get:function(){console.warn("Deprecated.");for(var t=0,e=this._armature.getSlots();t<e.length;t++){var i=e[t];if(i.parent===this)return i}return null},enumerable:!0,configurable:!0}),i}(t.TransformObject);t.Bone=e}(s4),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._vertices=[],e._deformVertices=[],e._hullCache=[],e._matrixCahce=[],e}return i4(e,t),e.toString=function(){return"[class dragonBones.Surface]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0},e.prototype._getAffineTransform=function(t,e,i,s,r,n,o,a,h,l,c,u,d){var _=o-r,p=a-n,m=h-r,g=l-n;c.rotation=Math.atan2(p,_),c.skew=Math.atan2(g,m)-.5*Math.PI-c.rotation,d&&(c.rotation+=Math.PI),c.scaleX=Math.sqrt(_*_+p*p)/i,c.scaleY=Math.sqrt(m*m+g*g)/s,c.toMatrix(u),c.x=u.tx=r-(u.a*t+u.c*e),c.y=u.ty=n-(u.b*t+u.d*e)},e.prototype._updateVertices=function(){var t=this._boneData.vertices,e=this._vertices,i=this._deformVertices;if(null!==this._parent)if(1===this._parent._boneData.type)for(var s=0,r=t.length;s<r;s+=2){var n=t[s]+i[s],o=t[s+1]+i[s],a=this._parent._getGlobalTransformMatrix(n,o);e[s]=a.a*n+a.c*o+a.tx,e[s+1]=a.b*n+a.d*o+a.ty}else{var h=this._parent.globalTransformMatrix;for(s=0,r=t.length;s<r;s+=2)n=t[s]+i[s],o=t[s+1]+i[s+1],e[s]=h.a*n+h.c*o+h.tx,e[s+1]=h.b*n+h.d*o+h.ty}else for(s=0,r=t.length;s<r;s+=2)e[s]=t[s]+i[s],e[s+1]=t[s+1]+i[s+1]},e.prototype._updateGlobalTransformMatrix=function(){var t=2*this._boneData.segmentX,e=this._vertices.length-2,i=this._vertices[0],s=this._vertices[1],r=this._vertices[t],n=this._vertices[t+1],o=this._vertices[e],a=this._vertices[e+1],h=this._vertices[e-t],l=this._vertices[e-t+1],c=i+.5*(o-i),u=s+.5*(a-s),d=c+.5*(r+.5*(h-r)-c),_=u+.5*(n+.5*(l-n)-u),p=r+.5*(o-r),m=n+.5*(a-n),g=h+.5*(o-h),f=l+.5*(a-l);this._globalDirty=!1,this._getAffineTransform(0,0,200,200,d,_,p,m,g,f,this.global,this.globalTransformMatrix,!1)},e.prototype._getGlobalTransformMatrix=function(t,i){var s=1e3;if(t<-1e3||s<t||i<-1e3||s<i)return this.globalTransformMatrix;var r=!1,n=200,o=this._boneData,a=o.segmentX,h=o.segmentY,l=2*o.segmentX,c=this._dX,u=this._dY,d=Math.floor((t+n)/c),_=Math.floor((i+n)/u),p=0,m=d*c-n,g=_*u-n,f=this._matrixCahce,y=e._helpMatrix;if(t<-200){if(i<-200||i>=n)return this.globalTransformMatrix;if(p=7*(2*(a*(h+1)+2*a+h+_)+((r=i>this._kX*(t+n)+g)?1:0)),this._matrixCahce[p]>0)y.copyFromArray(f,p+1);else{var b=_*(l+2),v=this._hullCache[4],S=this._hullCache[5],T=this._hullCache[2]-(h-_)*v,w=this._hullCache[3]-(h-_)*S,x=this._vertices;r?this._getAffineTransform(-200,g+u,800,u,x[b+l+2],x[b+l+3],T+v,w+S,x[b],x[b+1],e._helpTransform,y,!0):this._getAffineTransform(-1e3,g,800,u,T,w,x[b],x[b+1],T+v,w+S,e._helpTransform,y,!1),f[p]=1,f[p+1]=y.a,f[p+2]=y.b,f[p+3]=y.c,f[p+4]=y.d,f[p+5]=y.tx,f[p+6]=y.ty}}else if(t>=n){if(i<-200||i>=n)return this.globalTransformMatrix;p=7*(2*(a*(h+1)+a+_)+((r=i>this._kX*(t-s)+g)?1:0)),this._matrixCahce[p]>0?y.copyFromArray(f,p+1):(b=(_+1)*(l+2)-2,v=this._hullCache[4],S=this._hullCache[5],T=this._hullCache[0]+_*v,w=this._hullCache[1]+_*S,x=this._vertices,r?this._getAffineTransform(s,g+u,800,u,T+v,w+S,x[b+l+2],x[b+l+3],T,w,e._helpTransform,y,!0):this._getAffineTransform(n,g,800,u,x[b],x[b+1],T,w,x[b+l+2],x[b+l+3],e._helpTransform,y,!1),f[p]=1,f[p+1]=y.a,f[p+2]=y.b,f[p+3]=y.c,f[p+4]=y.d,f[p+5]=y.tx,f[p+6]=y.ty)}else if(i<-200){if(t<-200||t>=n)return this.globalTransformMatrix;p=7*(a*(h+1)+2*d+((r=i>this._kY*(t-m-c)-s)?1:0)),this._matrixCahce[p]>0?y.copyFromArray(f,p+1):(b=2*d,v=this._hullCache[10],S=this._hullCache[11],T=this._hullCache[8]+d*v,w=this._hullCache[9]+d*S,x=this._vertices,r?this._getAffineTransform(m+c,-200,c,800,x[b+2],x[b+3],x[b],x[b+1],T+v,w+S,e._helpTransform,y,!0):this._getAffineTransform(m,-1e3,c,800,T,w,T+v,w+S,x[b],x[b+1],e._helpTransform,y,!1),f[p]=1,f[p+1]=y.a,f[p+2]=y.b,f[p+3]=y.c,f[p+4]=y.d,f[p+5]=y.tx,f[p+6]=y.ty)}else if(i>=n){if(t<-200||t>=n)return this.globalTransformMatrix;p=7*(2*(a*(h+1)+a+h+_)+((r=i>this._kY*(t-m-c)+n)?1:0)),this._matrixCahce[p]>0?y.copyFromArray(f,p+1):(b=h*(l+2)+2*d,v=this._hullCache[10],S=this._hullCache[11],T=this._hullCache[6]-(a-d)*v,w=this._hullCache[7]-(a-d)*S,x=this._vertices,r?this._getAffineTransform(m+c,s,c,800,T+v,w+S,T,w,x[b+2],x[b+3],e._helpTransform,y,!0):this._getAffineTransform(m,n,c,800,x[b],x[b+1],x[b+2],x[b+3],T,w,e._helpTransform,y,!1),f[p]=1,f[p+1]=y.a,f[p+2]=y.b,f[p+3]=y.c,f[p+4]=y.d,f[p+5]=y.tx,f[p+6]=y.ty)}else p=7*(2*(a*_+d)+((r=i>this._k*(t-m-c)+g)?1:0)),this._matrixCahce[p]>0?y.copyFromArray(f,p+1):(b=2*d+_*(l+2),x=this._vertices,r?this._getAffineTransform(m+c,g+u,c,u,x[b+l+4],x[b+l+5],x[b+l+2],x[b+l+3],x[b+2],x[b+3],e._helpTransform,y,!0):this._getAffineTransform(m,g,c,u,x[b],x[b+1],x[b+2],x[b+3],x[b+l+2],x[b+l+3],e._helpTransform,y,!1),f[p]=1,f[p+1]=y.a,f[p+2]=y.b,f[p+3]=y.c,f[p+4]=y.d,f[p+5]=y.tx,f[p+6]=y.ty);return y},e.prototype.init=function(e,i){if(null===this._boneData){t.prototype.init.call(this,e,i);var s=e.segmentX,r=e.segmentY,n=e.vertices.length;this._dX=400/s,this._dY=400/r,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=n,this._deformVertices.length=n,this._matrixCahce.length=14*(s*r+2*s+2*r),this._hullCache.length=10;for(var o=0;o<n;++o)this._deformVertices[o]=0}},e.prototype.update=function(t){if(this._blendState.dirty=!1,t>=0&&null!==this._cachedFrameIndices){var i=this._cachedFrameIndices[t];if(i>=0&&this._cachedFrameIndex===i)this._transformDirty=!1;else if(i>=0)this._transformDirty=!0,this._cachedFrameIndex=i;else{if(this._hasConstraint)for(var s=0,r=this._armature._constraints;s<r.length;s++)(a=r[s])._root===this&&a.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var n=0,o=this._armature._constraints;n<o.length;n++){var a;(a=o[n])._root===this&&a.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var h=0,l=this._matrixCahce.length;h<l;h+=7)this._matrixCahce[h]=-1;if(this._updateVertices(),this._cachedFrameIndex<0){var c=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(c),c&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var u=2*this.global.x,d=2*this.global.y,_=e._helpPoint;this.globalTransformMatrix.transformPoint(1e3,-200,_),this._hullCache[0]=_.x,this._hullCache[1]=_.y,this._hullCache[2]=u-_.x,this._hullCache[3]=d-_.y,this.globalTransformMatrix.transformPoint(0,this._dY,_,!0),this._hullCache[4]=_.x,this._hullCache[5]=_.y,this.globalTransformMatrix.transformPoint(200,1e3,_),this._hullCache[6]=_.x,this._hullCache[7]=_.y,this._hullCache[8]=u-_.x,this._hullCache[9]=d-_.y,this.globalTransformMatrix.transformPoint(this._dX,0,_,!0),this._hullCache[10]=_.x,this._hullCache[11]=_.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},e}(t.Bone);t.Surface=e}(s4),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i._localMatrix=new t.Matrix,i._colorTransform=new t.ColorTransform,i._displayDatas=[],i._displayList=[],i._deformVertices=null,i._rawDisplay=null,i._meshDisplay=null,i}return i4(i,e),i.prototype._onClear=function(){e.prototype._onClear.call(this);for(var i=[],s=0,r=this._displayList;s<r.length;s++)null!==(a=r[s])&&a!==this._rawDisplay&&a!==this._meshDisplay&&i.indexOf(a)<0&&i.push(a);for(var n=0,o=i;n<o.length;n++){var a;(a=o[n])instanceof t.Armature?a.dispose():this._disposeDisplay(a,!0)}null!==this._deformVertices&&this._deformVertices.returnToPool(),null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDirty=!1,this._zOrderDirty=!1,this._blendModeDirty=!1,this._colorDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._displayList.length=0,this._displayDatas.length=0,this._slotData=null,this._rawDisplayDatas=null,this._displayData=null,this._boundingBoxData=null,this._textureData=null,this._deformVertices=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._parent=null,this._cachedFrameIndices=null},i.prototype._getDefaultRawDisplayData=function(t){var e=this._armature._armatureData.defaultSkin;if(null!==e){var i=e.getDisplays(this._slotData.name);if(null!==i)return t<i.length?i[t]:null}return null},i.prototype._updateDisplayData=function(){var e=this._displayData,s=null!==this._deformVertices?this._deformVertices.verticesData:null,r=this._textureData,n=null,o=null;if(this._displayData=null,this._boundingBoxData=null,this._textureData=null,this._displayIndex>=0&&(null!==this._rawDisplayDatas&&(n=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null),null===n&&(n=this._getDefaultRawDisplayData(this._displayIndex)),this._displayIndex<this._displayDatas.length&&(this._displayData=this._displayDatas[this._displayIndex])),null!==this._displayData&&(2===this._displayData.type||4===this._displayData.type?o=this._displayData.vertices:null!==n&&(2===n.type||4===n.type)&&(o=n.vertices),3===this._displayData.type?this._boundingBoxData=this._displayData.boundingBox:null!==n&&3===n.type&&(this._boundingBoxData=n.boundingBox),(0===this._displayData.type||2===this._displayData.type)&&(this._textureData=this._displayData.texture)),this._displayData!==e||o!==s||this._textureData!==r){if(null===o&&null!==this._textureData){var a=this._displayData,h=this._textureData.parent.scale*this._armature._armatureData.scale,l=this._textureData.frame;this._pivotX=a.pivot.x,this._pivotY=a.pivot.y;var c=null!==l?l:this._textureData.region,u=c.width,d=c.height;this._textureData.rotated&&null===l&&(u=c.height,d=c.width),this._pivotX*=u*h,this._pivotY*=d*h,null!==l&&(this._pivotX+=l.x*h,this._pivotY+=l.y*h),null!==this._displayData&&null!==n&&this._displayData!==n&&(n.transform.toMatrix(i._helpMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(0,0,i._helpPoint),this._pivotX-=i._helpPoint.x,this._pivotY-=i._helpPoint.y,this._displayData.transform.toMatrix(i._helpMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(0,0,i._helpPoint),this._pivotX+=i._helpPoint.x,this._pivotY+=i._helpPoint.y),t.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*h-this._pivotY)}else this._pivotX=0,this._pivotY=0;null!==n?this.origin=n.transform:null!==this._displayData?this.origin=this._displayData.transform:this.origin=null,o!==s?(null===this._deformVertices&&(this._deformVertices=t.BaseObject.borrowObject(t.DeformVertices)),this._deformVertices.init(o,this._armature)):null!==this._deformVertices&&this._textureData!==r&&(this._deformVertices.verticesDirty=!0),this._displayDirty=!0,this._transformDirty=!0}},i.prototype._updateDisplay=function(){var e=null!==this._display?this._display:this._rawDisplay,i=this._childArmature;this._displayIndex>=0&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],null!==this._display&&this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null);var s=null!==this._display?this._display:this._rawDisplay;if(s!==e&&(this._onUpdateDisplay(),this._replaceDisplay(e),this._transformDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0),s!==this._rawDisplay&&s!==this._meshDisplay||this._updateFrame(),this._childArmature!==i&&(null!==i&&(i._parent=null,i.clock=null,i.inheritAnimation&&i.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var r=this._armature.cacheFrameRate;0!==r&&(this._childArmature.cacheFrameRate=r)}var n=null;if(null!==this._displayData&&1===this._displayData.type)n=this._displayData.actions;else if(this._displayIndex>=0&&null!==this._rawDisplayDatas){var o=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null;null===o&&(o=this._getDefaultRawDisplayData(this._displayIndex)),null!==o&&1===o.type&&(n=o.actions)}if(null!==n&&n.length>0)for(var a=0,h=n;a<h.length;a++){var l=h[a],c=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(l,c,this._armature),c.slot=this,this._armature._bufferAction(c,!1)}else this._childArmature.animation.play()}},i.prototype._updateGlobalTransformMatrix=function(t){var e=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(e),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},i.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return!1;this._animationDisplayIndex=t}return this._displayIndex!==t&&(this._displayIndex=t,this._displayDirty=!0,this._updateDisplayData(),this._displayDirty)},i.prototype._setZorder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},i.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0,this._colorDirty},i.prototype._setDisplayList=function(e){if(null!==e&&e.length>0){this._displayList.length!==e.length&&(this._displayList.length=e.length);for(var i=0,s=e.length;i<s;++i){var r=e[i];null!==r&&r!==this._rawDisplay&&r!==this._meshDisplay&&!(r instanceof t.Armature)&&this._displayList.indexOf(r)<0&&this._initDisplay(r,!0),this._displayList[i]=r}}else this._displayList.length>0&&(this._displayList.length=0);return this._displayIndex>=0&&this._displayIndex<this._displayList.length?this._displayDirty=this._display!==this._displayList[this._displayIndex]:this._displayDirty=null!==this._display,this._updateDisplayData(),this._displayDirty},i.prototype.init=function(t,e,i,s){if(null===this._slotData){this._slotData=t,this._isFromCache=!1,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=i,this._meshDisplay=s,this._armature=e;var r=this._armature.getBone(this._slotData.parent.name);null!==r&&(this._parent=r),this._armature._addSlot(this),this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1),this._onUpdateDisplay(),this._addDisplay()}},i.prototype.update=function(t){if(this._isFromCache=!1,this._displayDirty&&(this._displayDirty=!1,this._updateDisplay(),this._transformDirty&&(null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix))),this._zOrderDirty&&(this._zOrderDirty=!1,this._updateZOrder()),t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];e>=0&&this._cachedFrameIndex===e?this._transformDirty=!1:e>=0?(this._transformDirty=!0,this._cachedFrameIndex=e):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(null!==this._display){if(this._visibleDirty&&(this._visibleDirty=!1,this._updateVisible()),this._blendModeDirty&&(this._blendModeDirty=!1,this._updateBlendMode()),this._colorDirty&&(this._colorDirty=!1,this._updateColor()),null!==this._deformVertices&&null!==this._deformVertices.verticesData&&this._display===this._meshDisplay){var i=null!==this._deformVertices.verticesData.weight,s=0!==this._parent._boneData.type;if((this._deformVertices.verticesDirty||i&&this._deformVertices.isBonesUpdate()||s&&this._parent._childrenTransformDirty)&&(this._deformVertices.verticesDirty=!1,this._updateMesh()),i||s)return}if(this._transformDirty){if(this._transformDirty=!1,this._cachedFrameIndex<0){var r=t>=0;this._updateGlobalTransformMatrix(r),r&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._isFromCache=!0,this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform()}}},i.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._transformDirty=!1,this._updateGlobalTransformMatrix(!1))},i.prototype.replaceDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0&&(e=this._displayIndex<0?0:this._displayIndex),this._displayDatas.length<=e){this._displayDatas.length=e+1;for(var i=0,s=this._displayDatas.length;i<s;++i)this._displayDatas[i]||(this._displayDatas[i]=null)}this._displayDatas[e]=t},i.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),i._helpMatrix.copyFrom(this.globalTransformMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(t,e,i._helpPoint),this._boundingBoxData.containsPoint(i._helpPoint.x,i._helpPoint.y))},i.prototype.intersectsSegment=function(t,e,s,r,n,o,a){if(void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),i._helpMatrix.copyFrom(this.globalTransformMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(t,e,i._helpPoint),t=i._helpPoint.x,e=i._helpPoint.y,i._helpMatrix.transformPoint(s,r,i._helpPoint),s=i._helpPoint.x,r=i._helpPoint.y;var h=this._boundingBoxData.intersectsSegment(t,e,s,r,n,o,a);return h>0&&(1===h||2===h?null!==n?(this.globalTransformMatrix.transformPoint(n.x,n.y,n),null!==o&&(o.x=n.x,o.y=n.y)):null!==o&&this.globalTransformMatrix.transformPoint(o.x,o.y,o):(null!==n&&this.globalTransformMatrix.transformPoint(n.x,n.y,n),null!==o&&this.globalTransformMatrix.transformPoint(o.x,o.y,o)),null!==a&&(this.globalTransformMatrix.transformPoint(Math.cos(a.x),Math.sin(a.x),i._helpPoint,!0),a.x=Math.atan2(i._helpPoint.y,i._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(a.y),Math.sin(a.y),i._helpPoint,!0),a.y=Math.atan2(i._helpPoint.y,i._helpPoint.x))),h},i.prototype.invalidUpdate=function(){this._displayDirty=!0,this._transformDirty=!0},Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t)&&this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(e){var i=this._displayList.concat(),s=new Array;this._setDisplayList(e)&&this.update(-1);for(var r=0,n=i;r<n.length;r++)null!==(h=n[r])&&h!==this._rawDisplay&&h!==this._meshDisplay&&this._displayList.indexOf(h)<0&&s.indexOf(h)<0&&s.push(h);for(var o=0,a=s;o<a.length;o++){var h;(h=a[o])instanceof t.Armature||this._disposeDisplay(h,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawDisplayDatas",{get:function(){return this._rawDisplayDatas},set:function(t){if(this._rawDisplayDatas!==t)if(this._displayDirty=!0,this._rawDisplayDatas=t,null!==this._rawDisplayDatas){this._displayDatas.length=this._rawDisplayDatas.length;for(var e=0,i=this._displayDatas.length;e<i;++e){var s=this._rawDisplayDatas[e];null===s&&(s=this._getDefaultRawDisplayData(e)),this._displayDatas[e]=s}}else this._displayDatas.length=0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayData",{get:function(){return this._displayData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this._display},set:function(t){if(this._display!==t){var e=this._displayList.length;if(this._displayIndex<0&&0===e&&(this._displayIndex=0),!(this._displayIndex<0)){var i=this.displayList;e<=this._displayIndex&&(i.length=this._displayIndex+1),i[this._displayIndex]=t,this.displayList=i}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i.prototype.getDisplay=function(){return this._display},i.prototype.setDisplay=function(t){this.display=t},i}(t.TransformObject);t.Slot=e}(s4),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return i4(i,e),i.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(i.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),i._helpMatrix=new t.Matrix,i._helpTransform=new t.Transform,i._helpPoint=new t.Point,i}(t.BaseObject);t.Constraint=e;var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return i4(i,e),i.toString=function(){return"[class dragonBones.IKConstraint]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},i.prototype._computeA=function(){var e=this._target.global,i=this._root.global,s=this._root.globalTransformMatrix,r=Math.atan2(e.y-i.y,e.x-i.x);i.scaleX<0&&(r+=Math.PI),i.rotation+=t.Transform.normalizeRadian(r-i.rotation)*this._weight,i.toMatrix(s)},i.prototype._computeB=function(){var e=this._bone._boneData.length,i=this._root,s=this._target.global,r=i.global,n=this._bone.global,o=this._bone.globalTransformMatrix,a=o.a*e,h=o.b*e,l=a*a+h*h,c=Math.sqrt(l),u=n.x-r.x,d=n.y-r.y,_=u*u+d*d,p=Math.sqrt(_),m=n.rotation,g=r.rotation,f=Math.atan2(d,u),y=(u=s.x-r.x)*u+(d=s.y-r.y)*d,b=Math.sqrt(y),v=0;if(c+p<=b||b+c<=p||b+p<=c)v=Math.atan2(s.y-r.y,s.x-r.x),c+p<=b||p<c&&(v+=Math.PI);else{var S=(_-l+y)/(2*y),T=Math.sqrt(_-S*S*y)/b,w=r.x+u*S,x=r.y+d*S,C=-d*T,A=u*T,D=!1,E=i.parent;if(null!==E){var I=E.globalTransformMatrix;D=I.a*I.d-I.b*I.c<0}D!==this._bendPositive?(n.x=w-C,n.y=x-A):(n.x=w+C,n.y=x+A),v=Math.atan2(n.y-r.y,n.x-r.x)}var M=t.Transform.normalizeRadian(v-f);r.rotation=g+M*this._weight,r.toMatrix(i.globalTransformMatrix);var P=f+M*this._weight;n.x=r.x+Math.cos(P)*p,n.y=r.y+Math.sin(P)*p;var O=Math.atan2(s.y-n.y,s.x-n.x);n.scaleX<0&&(O+=Math.PI),n.rotation=r.rotation+m-g+t.Transform.normalizeRadian(O-M-m)*this._weight,n.toMatrix(o)},i.prototype.init=function(t,e){if(null===this._constraintData){this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null;var i=this._constraintData;this._scaleEnabled=i.scaleEnabled,this._bendPositive=i.bendPositive,this._weight=i.weight,this._root._hasConstraint=!0}},i.prototype.update=function(){this._root.updateByConstraint(),null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},i.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},i}(e);t.IKConstraint=i;var s=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._spaces=[],t._positions=[],t._curves=[],t._boneLengths=[],t._pathGlobalVertices=[],t._segments=[10],t}return i4(i,e),i.toString=function(){return"[class dragonBones.PathConstraint]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.dirty=!1,this.pathOffset=0,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=1,this.translateMix=1,this._pathSlot=null,this._bones.length=0,this._spaces.length=0,this._positions.length=0,this._curves.length=0,this._boneLengths.length=0,this._pathGlobalVertices.length=0},i.prototype._updatePathVertices=function(t){var e=this._armature,i=e.armatureData.parent,s=e.armatureData.scale,r=i.intArray,n=i.floatArray,o=t.offset,a=r[o+0],h=r[o+2];this._pathGlobalVertices.length=2*a;var l=t.weight;if(null!==l)for(var c=this._pathSlot._deformVertices.bones,u=l.bones.length,d=l.offset,_=r[d+1],p=d+2+u,m=(x=0,0);x<a;x++){for(var g=0,f=0,y=0,b=r[p++];y<b;y++){var v=c[r[p++]];if(null!==v){v.updateByConstraint(),w=v.globalTransformMatrix;var S=n[_++];A=n[_++]*s,D=n[_++]*s,g+=(w.a*A+w.c*D+w.tx)*S,f+=(w.b*A+w.d*D+w.ty)*S}}this._pathGlobalVertices[m++]=g,this._pathGlobalVertices[m++]=f}else{var T=this._pathSlot.parent;T.updateByConstraint();for(var w=T.globalTransformMatrix,x=0,C=h;x<a;x+=2){var A=n[C++]*s,D=n[C++]*s,E=w.a*A+w.c*D+w.tx,I=w.b*A+w.d*D+w.ty;this._pathGlobalVertices[x]=E,this._pathGlobalVertices[x+1]=I}}},i.prototype._computeVertices=function(t,e,i,s){for(var r=i,n=t;r<e;r+=2)s[r]=this._pathGlobalVertices[n++],s[r+1]=this._pathGlobalVertices[n++]},i.prototype._computeBezierCurve=function(t,e,i,s,r){var n=this._armature.armatureData.parent.intArray[t.vertices.offset+0],o=this._positions,a=this._spaces,h=t.closed,l=Array(),c=2*n,u=c/6,d=-1,_=this.position;o.length=3*e+2;var p=0;if(t.constantSpeed){h?(c+=2,l.length=n,this._computeVertices(2,c-4,0,l),this._computeVertices(0,2,c-4,l),l[c-2]=l[0],l[c-1]=l[1]):(u--,c-=4,l.length=c,this._computeVertices(2,c,0,l));var m=new Array(u);p=0;for(var g,f,y,b,v,S,T,w,x=l[0],C=l[1],A=0,D=0,E=0,I=0,M=0,P=0,O=(j=0,2);j<u;j++,O+=6)A=l[O],D=l[O+1],E=l[O+2],I=l[O+3],v=2*(g=.1875*(x-2*A+E))+(y=.09375*(3*(A-E)-x+(M=l[O+4]))),S=2*(f=.1875*(C-2*D+I))+(b=.09375*(3*(D-I)-C+(P=l[O+5]))),T=.75*(A-x)+g+.16666667*y,w=.75*(D-C)+f+.16666667*b,p+=Math.sqrt(T*T+w*w),T+=v,w+=S,v+=y,S+=b,p+=Math.sqrt(T*T+w*w),T+=v,w+=S,p+=Math.sqrt(T*T+w*w),T+=v+y,w+=S+b,p+=Math.sqrt(T*T+w*w),m[j]=p,x=M,C=P;if(s&&(_*=p),r)for(j=0;j<e;j++)a[j]*=p;for(var R=this._segments,B=0,F=(j=0,H=0,G=0,0);j<e;j++,H+=3){var N=_+=a[j];if(h)(N%=p)<0&&(N+=p),G=0;else{if(N<0)continue;if(N>p)continue}for(;;G++){var L=m[G];if(!(N>L)){0===G?N/=L:N=(N-(U=m[G-1]))/(L-U);break}}if(G!==d){d=G;var k=6*G;for(x=l[k],C=l[k+1],A=l[k+2],D=l[k+3],E=l[k+4],I=l[k+5],v=2*(g=.03*(x-2*A+E))+(y=.006*(3*(A-E)-x+(M=l[k+6]))),S=2*(f=.03*(C-2*D+I))+(b=.006*(3*(D-I)-C+(P=l[k+7]))),T=.3*(A-x)+g+.16666667*y,w=.3*(D-C)+f+.16666667*b,B=Math.sqrt(T*T+w*w),R[0]=B,k=1;k<8;k++)T+=v,w+=S,v+=y,S+=b,B+=Math.sqrt(T*T+w*w),R[k]=B;T+=v,w+=S,B+=Math.sqrt(T*T+w*w),R[8]=B,T+=v+y,w+=S+b,B+=Math.sqrt(T*T+w*w),R[9]=B,F=0}for(N*=B;;F++){var z=R[F];if(!(N>z)){var U;0===F?N/=z:N=F+(N-(U=R[F-1]))/(z-U);break}}this.addCurvePosition(.1*N,x,C,A,D,E,I,M,P,o,H,i)}}else{var V=t.curveLengths;if(p=V[u-=h?1:2],s&&(_*=p),r)for(var j=0;j<e;j++)a[j]*=p;l.length=8;j=0;for(var H=0,G=0;j<e;j++,H+=3){if(_+=a[j],h)(_%=p)<0&&(_+=p),G=0;else{if(_<0)continue;if(_>p)continue}for(var W=0;;G++){var X=V[G];if(!(_>X)){if(0===G)W=_/X;else{var Y=V[G-1];W=(_-Y)/(X-Y)}break}}G!==d&&(d=G,h&&G===u?(this._computeVertices(c-4,4,0,l),this._computeVertices(0,4,4,l)):this._computeVertices(6*G+2,8,0,l)),this.addCurvePosition(W,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],o,H,i)}}},i.prototype.addCurvePosition=function(t,e,i,s,r,n,o,a,h,l,c,u){if(0===t)return l[c]=e,l[c+1]=i,void(l[c+2]=0);if(1===t)return l[c]=a,l[c+1]=h,void(l[c+2]=0);var d=1-t,_=d*d,p=t*t,m=_*d,g=_*t*3,f=d*p*3,y=t*p,b=m*e+g*s+f*n+y*a,v=m*i+g*r+f*o+y*h;l[c]=b,l[c+1]=v,l[c+2]=u?Math.atan2(v-(m*i+g*r+f*o),b-(m*e+g*s+f*n)):0},i.prototype.init=function(t,e){this._constraintData=t,this._armature=e;var i=t;this.pathOffset=i.pathDisplayData.vertices.offset,this.position=i.position,this.spacing=i.spacing,this.rotateOffset=i.rotateOffset,this.rotateMix=i.rotateMix,this.translateMix=i.translateMix,this._root=this._armature.getBone(i.root.name),this._target=this._armature.getBone(i.target.name),this._pathSlot=this._armature.getSlot(i.pathSlot.name);for(var s=0,r=i.bones.length;s<r;s++){var n=this._armature.getBone(i.bones[s].name);null!==n&&this._bones.push(n)}2===i.rotateMode&&(this._boneLengths.length=this._bones.length),this._root._hasConstraint=!0},i.prototype.update=function(){var e=this._pathSlot;if(null!==e._deformVertices&&null!==e._deformVertices.verticesData&&e._deformVertices.verticesData.offset===this.pathOffset){var i=this._constraintData,s=e._displayData,r=!1,n=e._deformVertices;if(this._root._childrenTransformDirty?(this._updatePathVertices(s.vertices),r=!0):null!==n&&(n.verticesDirty||n.isBonesUpdate())&&(this._updatePathVertices(s.vertices),n.verticesDirty=!1,r=!0),r||this.dirty){var o=i.positionMode,a=i.spacingMode,h=i.rotateMode,l=this._bones,c=0===a,u=2===h,d=0===h,_=l.length,p=d?_:_+1,m=this.spacing,g=this._spaces;if(g.length=p,u||c){g[0]=0;for(var f=0,y=p-1;f<y;f++){(P=l[f]).updateByConstraint();var b=P._boneData.length,v=b*(O=P.globalTransformMatrix).a,S=b*O.b,T=Math.sqrt(v*v+S*S);u&&(this._boneLengths[f]=T),g[f+1]=(b+m)*T/b}}else for(f=0;f<p;f++)g[f]=m;this._computeBezierCurve(s,p,d,1===o,2===a);var w,x=this._positions,C=this.rotateOffset,A=x[0],D=x[1];0===C?w=1===h:(w=!1,null!==(P=e.parent)&&(C*=(O=P.globalTransformMatrix).a*O.d-O.b*O.c>0?t.Transform.DEG_RAD:-t.Transform.DEG_RAD));for(var E=this.rotateMix,I=this.translateMix,M=(f=0,3);f<_;f++,M+=3){var P,O;(P=l[f]).updateByConstraint(),(O=P.globalTransformMatrix).tx+=(A-O.tx)*I,O.ty+=(D-O.ty)*I;var R=(v=x[M])-A,B=(S=x[M+1])-D;if(u){var F=this._boneLengths[f],N=(Math.sqrt(R*R+B*B)/F-1)*E+1;O.a*=N,O.b*=N}if(A=v,D=S,E>0){var L=O.a,k=O.b,z=O.c,U=O.d,V=void 0,j=void 0,H=void 0;if(V=d?x[M-1]:Math.atan2(B,R),V-=Math.atan2(k,L),w){j=Math.cos(V),H=Math.sin(V);var G=P._boneData.length;A+=(G*(j*L-H*k)-R)*E,D+=(G*(H*L+j*k)-B)*E}else V+=C;V>t.Transform.PI?V-=t.Transform.PI_D:V<-t.Transform.PI&&(V+=t.Transform.PI_D),V*=E,j=Math.cos(V),H=Math.sin(V),O.a=j*L-H*k,O.b=H*L+j*k,O.c=j*z-H*U,O.d=H*z+j*U}P.global.fromMatrix(O)}this.dirty=!1}}},i.prototype.invalidUpdate=function(){},i}(e);t.PathConstraint=s}(s4),function(t){var e=function(){function t(t){void 0===t&&(t=0),this.time=0,this.timeScale=1,this._systemTime=0,this._animatebles=[],this._clock=null,this.time=t,this._systemTime=.001*(new Date).getTime()}return t.prototype.advanceTime=function(t){t!=t&&(t=0);var e=.001*Date.now();if(t<0&&(t=e-this._systemTime),this._systemTime=e,1!==this.timeScale&&(t*=this.timeScale),0!==t){t<0?this.time-=t:this.time+=t;for(var i=0,s=0,r=this._animatebles.length;i<r;++i){var n=this._animatebles[i];null!==n?(s>0&&(this._animatebles[i-s]=n,this._animatebles[i]=null),n.advanceTime(t)):s++}if(s>0){for(r=this._animatebles.length;i<r;++i){var o=this._animatebles[i];null!==o?this._animatebles[i-s]=o:s++}this._animatebles.length-=s}}},t.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},t.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},t.prototype.remove=function(t){var e=this._animatebles.indexOf(t);e>=0&&(this._animatebles[e]=null,t.clock=null)},t.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var i=e[t];null!==i&&(i.clock=null)}},Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),t.clock=new t,t}();t.WorldClock=e}(s4),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._animationConfig=null,t}return i4(i,e),i.toString=function(){return"[class dragonBones.Animation]"},i.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++)e[t].returnToPool();for(var i in this._animations)delete this._animations[i];null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._lockUpdate=!1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},i.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,i=this._animationStates;e<i.length;e++)null===(l=i[e])._parent&&l.layer===t.layer&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 2:for(var s=0,r=this._animationStates;s<r.length;s++)null===(l=r[s])._parent&&l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 3:for(var n=0,o=this._animationStates;n<o.length;n++)null===(l=o[n])._parent&&l.layer===t.layer&&l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 4:for(var a=0,h=this._animationStates;a<h.length;a++){var l;null===(l=h[a])._parent&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}},i.prototype.init=function(e){null===this._armature&&(this._armature=e,this._animationConfig=t.BaseObject.borrowObject(t.AnimationConfig))},i.prototype.advanceTime=function(t){t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale);var e=this._animationStates.length;if(1===e)if((p=this._animationStates[0])._fadeState>0&&p._subFadeState>0)this._armature._dragonBones.bufferObject(p),this._animationStates.length=0,this._lastAnimationState=null;else{var i=p._animationData,s=i.cacheFrameRate;if(this._animationDirty&&s>0){this._animationDirty=!1;for(var r=0,n=this._armature.getBones();r<n.length;r++){var o=n[r];o._cachedFrameIndices=i.getBoneCachedFrameIndices(o.name)}for(var a=0,h=this._armature.getSlots();a<h.length;a++){var l=h[a],c=l.rawDisplayDatas;if(null!==c&&c.length>0){var u=c[0];if(null!==u&&u.parent===this._armature.armatureData.defaultSkin){l._cachedFrameIndices=i.getSlotCachedFrameIndices(l.name);continue}}l._cachedFrameIndices=null}}p.advanceTime(t,s)}else if(e>1){for(var d=0,_=0;d<e;++d){var p;(p=this._animationStates[d])._fadeState>0&&p._subFadeState>0?(_++,this._armature._dragonBones.bufferObject(p),this._animationDirty=!0,this._lastAnimationState===p&&(this._lastAnimationState=null)):(_>0&&(this._animationStates[d-_]=p),p.advanceTime(t,0)),d===e-1&&_>0&&(this._animationStates.length-=_,null===this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},i.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++)e[t].returnToPool();this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},i.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t)null!==(s=this.getState(t))&&s.stop();else for(var e=0,i=this._animationStates;e<i.length;e++){var s;(s=i[e]).stop()}},i.prototype.playConfig=function(e){var i=e.animation;if(!(i in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+i),null;var s=this._animations[i];if(5===e.fadeOutMode)for(var r=0,n=this._animationStates;r<n.length;r++){var o=n[r];if(o._animationData===s)return o}0===this._animationStates.length?e.fadeInTime=0:e.fadeInTime<0&&(e.fadeInTime=s.fadeInTime),e.fadeOutTime<0&&(e.fadeOutTime=e.fadeInTime),e.timeScale<=-100&&(e.timeScale=1/s.scale),s.frameCount>1?(e.position<0?(e.position%=s.duration,e.position=s.duration-e.position):e.position===s.duration?e.position-=1e-6:e.position>s.duration&&(e.position%=s.duration),e.duration>0&&e.position+e.duration>s.duration&&(e.duration=s.duration-e.position),e.playTimes<0&&(e.playTimes=s.playTimes)):(e.playTimes=1,e.position=0,e.duration>0&&(e.duration=0)),0===e.duration&&(e.duration=-1),this._fadeOut(e);var a=t.BaseObject.borrowObject(t.AnimationState);if(a.init(this._armature,s,e),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,this._animationStates.length>0){for(var h=!1,l=0,c=this._animationStates.length;l<c;++l){if(a.layer>this._animationStates[l].layer){h=!0,this._animationStates.splice(l,0,a);break}if(l!==c-1&&a.layer>this._animationStates[l+1].layer){h=!0,this._animationStates.splice(l+1,0,a);break}}h||this._animationStates.push(a)}else this._animationStates.push(a);for(var u=0,d=this._armature.getSlots();u<d.length;u++){var _=d[u].childArmature;null!==_&&_.inheritAnimation&&_.animation.hasAnimation(i)&&null===_.animation.getState(i)&&_.animation.fadeIn(i)}var p=!1;for(var m in s.animationTimelines){this._lockUpdate||(p=!0,this._lockUpdate=!0);var g=this.fadeIn(m,e.fadeInTime,1,a.layer,null,0);null!==g&&(g.resetToPose=!1,g._parent=a,g.stop())}return p&&(this._lockUpdate=!1),this._lockUpdate||(e.fadeInTime<=0&&this._armature.advanceTime(0),this._lastAnimationState=a),a},i.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&t.length>0)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var i=this._armature.armatureData.defaultAnimation;null!==i&&(this._animationConfig.animation=i.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},i.prototype.fadeIn=function(t,e,i,s,r,n){return void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===s&&(s=0),void 0===r&&(r=null),void 0===n&&(n=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=n,this._animationConfig.playTimes=i,this._animationConfig.layer=s,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==r?r:"",this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByTime=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByFrame=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var s=t in this._animations?this._animations[t]:null;return null!==s&&(this._animationConfig.position=s.duration*e/s.frameCount),this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByProgress=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var s=t in this._animations?this._animations[t]:null;return null!==s&&(this._animationConfig.position=s.duration*(e>0?e:0)),this.playConfig(this._animationConfig)},i.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByTime(t,e,1);return null!==i&&i.stop(),i},i.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByFrame(t,e,1);return null!==i&&i.stop(),i},i.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByProgress(t,e,1);return null!==i&&i.stop(),i},i.prototype.getState=function(t){for(var e=this._animationStates.length;e--;){var i=this._animationStates[e];if(i.name===t)return i}return null},i.prototype.hasAnimation=function(t){return t in this._animations},i.prototype.getStates=function(){return this._animationStates},Object.defineProperty(i.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(e[t].isPlaying)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(!e[t].isCompleted)return!1;return this._animationStates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNames.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNames.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),i.prototype.gotoAndPlay=function(t,e,i,s,r,n,o){void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===s&&(s=-1),void 0===r&&(r=0),void 0===n&&(n=null),void 0===o&&(o=3),console.warn("Deprecated."),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.fadeOutMode=o,this._animationConfig.playTimes=s,this._animationConfig.layer=r,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==n?n:"";var a=this._animations[t];return a&&i>0&&(this._animationConfig.timeScale=a.duration/i),this.playConfig(this._animationConfig)},i.prototype.gotoAndStop=function(t,e){return void 0===e&&(e=0),console.warn("Deprecated."),this.gotoAndStopByTime(t,e)},Object.defineProperty(i.prototype,"animationList",{get:function(){return console.warn("Deprecated."),this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationDataList",{get:function(){console.warn("Deprecated.");for(var t=[],e=0,i=this._animationNames.length;e<i;++e)t.push(this._animations[this._animationNames[e]]);return t},enumerable:!0,configurable:!0}),i}(t.BaseObject);t.Animation=e}(s4),function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._blendState=new s,t._boneMask=[],t._boneTimelines=[],t._surfaceTimelines=[],t._slotTimelines=[],t._constraintTimelines=[],t._animationTimelines=[],t._poseTimelines=[],t._bonePoses={},t._actionTimeline=null,t._zOrderTimeline=null,t._parent=null,t}return i4(r,e),r.toString=function(){return"[class dragonBones.AnimationState]"},r.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++)e[t].returnToPool();for(var i=0,s=this._surfaceTimelines;i<s.length;i++)s[i].returnToPool();for(var r=0,n=this._slotTimelines;r<n.length;r++)n[r].returnToPool();for(var o=0,a=this._constraintTimelines;o<a.length;o++)a[o].returnToPool();for(var h=0,l=this._animationTimelines;h<l.length;h++)l[h].returnToPool();for(var c in this._bonePoses)this._bonePoses[c].returnToPool(),delete this._bonePoses[c];null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additiveBlending=!1,this.displayControl=!1,this.resetToPose=!1,this.playTimes=1,this.layer=0,this.timeScale=1,this.weight=1,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._blendState.clear(),this._boneMask.length=0,this._boneTimelines.length=0,this._surfaceTimelines.length=0,this._slotTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._parent=null},r.prototype._updateTimelines=function(){for(var e=0,i=this._armature._constraints;e<i.length;e++){var s=i[e];if(null!==(h=this._animationData.getConstraintTimelines(s.name)))for(var r=0,n=h;r<n.length;r++)30===(d=n[r]).type&&((_=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).constraint=s,_.init(this._armature,this,d),this._constraintTimelines.push(_));else this.resetToPose&&((_=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).constraint=s,_.init(this._armature,this,null),this._constraintTimelines.push(_),this._poseTimelines.push(_))}for(var o=0,a=this._armature.animation.getStates();o<a.length;o++){var h,l=a[o];if(l._parent===this&&null!==(h=this._animationData.getAnimationTimelines(l.name)))for(var c=0,u=h;c<u.length;c++){var d,_;40===(d=u[c]).type&&((_=t.BaseObject.borrowObject(t.AnimationTimelineState)).animationState=l,_.init(this._armature,this,d),this._animationTimelines.push(_))}}},r.prototype._updateBoneAndSlotTimelines=function(){for(var e={},s=0,r=this._boneTimelines;s<r.length;s++)(h=(y=r[s]).bone.name)in e||(e[h]=[]),e[h].push(y);for(var n=0,o=this._armature.getBones();n<o.length;n++){var a=o[n],h=a.name;if(this.containsBoneMask(h))if(h in e)delete e[h];else if(0===a._boneData.type){var l=this._animationData.getBoneTimelines(h),c=h in this._bonePoses?this._bonePoses[h]:this._bonePoses[h]=t.BaseObject.borrowObject(i);if(null!==l)for(var u=0,d=l;u<d.length;u++)switch((P=d[u]).type){case 10:(y=t.BaseObject.borrowObject(t.BoneAllTimelineState)).bone=a,y.bonePose=c,y.init(this._armature,this,P),this._boneTimelines.push(y);break;case 11:(y=t.BaseObject.borrowObject(t.BoneTranslateTimelineState)).bone=a,y.bonePose=c,y.init(this._armature,this,P),this._boneTimelines.push(y);break;case 12:(y=t.BaseObject.borrowObject(t.BoneRotateTimelineState)).bone=a,y.bonePose=c,y.init(this._armature,this,P),this._boneTimelines.push(y);break;case 13:(y=t.BaseObject.borrowObject(t.BoneScaleTimelineState)).bone=a,y.bonePose=c,y.init(this._armature,this,P),this._boneTimelines.push(y)}else this.resetToPose&&((y=t.BaseObject.borrowObject(t.BoneAllTimelineState)).bone=a,y.bonePose=c,y.init(this._armature,this,null),this._boneTimelines.push(y),this._poseTimelines.push(y))}else if(1===a._boneData.type)if(null!==(l=this._animationData.getSurfaceTimelines(h)))for(var _=0,p=l;_<p.length;_++)50===(P=p[_]).type&&((y=t.BaseObject.borrowObject(t.SurfaceTimelineState)).surface=a,y.init(this._armature,this,P),this._surfaceTimelines.push(y));else this.resetToPose&&((y=t.BaseObject.borrowObject(t.SurfaceTimelineState)).surface=a,y.init(this._armature,this,null),this._surfaceTimelines.push(y),this._poseTimelines.push(y))}for(var m in e)for(var g=0,f=e[m];g<f.length;g++){var y=f[g];this._boneTimelines.splice(this._boneTimelines.indexOf(y),1),y.returnToPool()}for(var b={},v=[],S=0,T=this._slotTimelines;S<T.length;S++)(h=(y=T[S]).slot.name)in b||(b[h]=[]),b[h].push(y);for(var w=0,x=this._armature.getSlots();w<x.length;w++){var C=x[w],A=C.parent.name;if(this.containsBoneMask(A))if(h=C.name,l=this._animationData.getSlotTimelines(h),h in b)delete b[h];else{var D=!1,E=!1;if(v.length=0,null!==l)for(var I=0,M=l;I<M.length;I++){var P;switch((P=M[I]).type){case 20:(y=t.BaseObject.borrowObject(t.SlotDislayTimelineState)).slot=C,y.init(this._armature,this,P),this._slotTimelines.push(y),D=!0;break;case 21:(y=t.BaseObject.borrowObject(t.SlotColorTimelineState)).slot=C,y.init(this._armature,this,P),this._slotTimelines.push(y),E=!0;break;case 22:(y=t.BaseObject.borrowObject(t.DeformTimelineState)).slot=C,y.init(this._armature,this,P),this._slotTimelines.push(y),v.push(y.vertexOffset)}}if(this.resetToPose&&(D||((y=t.BaseObject.borrowObject(t.SlotDislayTimelineState)).slot=C,y.init(this._armature,this,null),this._slotTimelines.push(y),this._poseTimelines.push(y)),E||((y=t.BaseObject.borrowObject(t.SlotColorTimelineState)).slot=C,y.init(this._armature,this,null),this._slotTimelines.push(y),this._poseTimelines.push(y)),null!==C.rawDisplayDatas))for(var O=0,R=C.rawDisplayDatas;O<R.length;O++){var B=R[O];if(null!==B&&2===B.type){var F=B.vertices.offset;v.indexOf(F)<0&&((y=t.BaseObject.borrowObject(t.DeformTimelineState)).vertexOffset=F,y.slot=C,y.init(this._armature,this,null),this._slotTimelines.push(y),this._poseTimelines.push(y))}}}}for(var m in b)for(var N=0,L=b[m];N<L.length;N++)y=L[N],this._slotTimelines.splice(this._slotTimelines.indexOf(y),1),y.returnToPool()},r.prototype._advanceFadeTime=function(e){var i,s=this._fadeState>0;if(this._subFadeState<0){this._subFadeState=0;var r=s?t.EventObject.FADE_OUT:t.EventObject.FADE_IN;this._armature.eventDispatcher.hasDBEventListener(r)&&((i=t.BaseObject.borrowObject(t.EventObject)).type=r,i.armature=this._armature,i.animationState=this,this._armature._dragonBones.bufferEvent(i))}(e<0&&(e=-e),this._fadeTime+=e,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=s?0:1):this._fadeTime>0?this._fadeProgress=s?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=s?1:0,this._subFadeState>0)&&(s||(this._playheadState|=1,this._fadeState=0),r=s?t.EventObject.FADE_OUT_COMPLETE:t.EventObject.FADE_IN_COMPLETE,this._armature.eventDispatcher.hasDBEventListener(r)&&((i=t.BaseObject.borrowObject(t.EventObject)).type=r,i.armature=this._armature,i.animationState=this,this._armature._dragonBones.bufferEvent(i)))},r.prototype.init=function(e,i,s){if(null===this._armature){if(this._armature=e,this._animationData=i,this.resetToPose=s.resetToPose,this.additiveBlending=s.additiveBlending,this.displayControl=s.displayControl,this.actionEnabled=s.actionEnabled,this.layer=s.layer,this.playTimes=s.playTimes,this.timeScale=s.timeScale,this.fadeTotalTime=s.fadeInTime,this.autoFadeOutTime=s.autoFadeOutTime,this.weight=s.weight,this.name=s.name.length>0?s.name:s.animation,this.group=s.group,s.pauseFadeIn?this._playheadState=2:this._playheadState=3,s.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==s.position?this.timeScale>=0?this._time=s.position:this._time=s.position-this._duration:this._time=0):(this._position=s.position,this._duration=s.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),s.boneMask.length>0){this._boneMask.length=s.boneMask.length;for(var r=0,n=this._boneMask.length;r<n;++r)this._boneMask[r]=s.boneMask[r]}this._actionTimeline=t.BaseObject.borrowObject(t.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},r.prototype.advanceTime=function(e,i){if(this._blendState.dirty=!1,0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(e),3===this._playheadState&&(1!==this.timeScale&&(e*=this.timeScale),this._time+=e),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines()),0!==this.weight){var s=0===this._fadeState&&i>0,r=!0,n=!0,o=this._time;if(this._weightResult=this.weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult/this._parent._fadeProgress),this._actionTimeline.playState<=0&&this._actionTimeline.update(o),s){var a=2*i;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*a)/a}if(null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(o),s){var h=Math.floor(this._actionTimeline.currentTime*i);this._armature._cacheFrameIndex===h?(r=!1,n=!1):(this._armature._cacheFrameIndex=h,this._animationData.cachedFrames[h]?n=!1:this._animationData.cachedFrames[h]=!0)}if(r){if(n)for(var l=0,c=this._boneTimelines.length;l<c;++l)(m=this._boneTimelines[l]).playState<=0&&m.update(o),(l===c-1||m.bone!==this._boneTimelines[l+1].bone)&&0!==(u=m.bone._blendState.update(this._weightResult,this.layer))&&m.blend(u);for(l=0,c=this._surfaceTimelines.length;l<c;++l){var u=(m=this._surfaceTimelines[l]).surface._blendState.update(this._weightResult,this.layer);m.playState<=0&&m.update(o),0!==u&&m.blend(u)}if(this.displayControl)for(l=0,c=this._slotTimelines.length;l<c;++l){var d=(m=this._slotTimelines[l]).slot.displayController;null!==d&&d!==this.name&&d!==this.group||m.playState<=0&&m.update(o)}for(l=0,c=this._constraintTimelines.length;l<c;++l)(m=this._constraintTimelines[l]).playState<=0&&m.update(o);for(l=0,c=this._animationTimelines.length;l<c;++l)u=(m=this._animationTimelines[l]).animationState._blendState.update(this._weightResult,this.layer),m.playState<=0&&m.update(o),0!==u&&m.blend(u)}if(0===this._fadeState){if(this._subFadeState>0&&(this._subFadeState=0,this._poseTimelines.length>0)){for(var _=0,p=this._poseTimelines;_<p.length;_++){var m;(m=p[_])instanceof t.BoneTimelineState?this._boneTimelines.splice(this._boneTimelines.indexOf(m),1):m instanceof t.SurfaceTimelineState?this._surfaceTimelines.splice(this._surfaceTimelines.indexOf(m),1):m instanceof t.SlotTimelineState?this._slotTimelines.splice(this._slotTimelines.indexOf(m),1):m instanceof t.ConstraintTimelineState&&this._constraintTimelines.splice(this._constraintTimelines.indexOf(m),1),m.returnToPool()}this._poseTimelines.length=0}this._actionTimeline.playState>0&&this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime)}}},r.prototype.play=function(){this._playheadState=3},r.prototype.stop=function(){this._playheadState&=1},r.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),t<0&&(t=0),e&&(this._playheadState&=2),this._fadeState>0){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var i=0,s=this._boneTimelines;i<s.length;i++)(d=s[i]).fadeOut();for(var r=0,n=this._surfaceTimelines;r<n.length;r++)(d=n[r]).fadeOut();for(var o=0,a=this._slotTimelines;o<a.length;o++)(d=a[o]).fadeOut();for(var h=0,l=this._constraintTimelines;h<l.length;h++)(d=l[h]).fadeOut();for(var c=0,u=this._animationTimelines;c<u.length;c++){var d;(d=u[c]).animationState.fadeOut(t,e),d.fadeOut()}}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},r.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||this._boneMask.indexOf(t)>=0},r.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._armature.getBone(t);if(null!==i){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var s=0,r=this._armature.getBones();s<r.length;s++){var n=r[s];this._boneMask.indexOf(n.name)<0&&i.contains(n)&&this._boneMask.push(n.name)}this._timelineDirty=1}},r.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._boneMask.indexOf(t);if(i>=0&&this._boneMask.splice(i,1),e){var s=this._armature.getBone(t);if(null!==s){var r=this._armature.getBones();if(this._boneMask.length>0)for(var n=0,o=r;n<o.length;n++){var a=o[n],h=this._boneMask.indexOf(a.name);h>=0&&s.contains(a)&&this._boneMask.splice(h,1)}else for(var l=0,c=r;l<c.length;l++)(a=c[l])!==s&&(s.contains(a)||this._boneMask.push(a.name))}}this._timelineDirty=1},r.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},Object.defineProperty(r.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPlaying",{get:function(){return!!(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration)<0&&(t+=this._duration),this.playTimes>0&&e===this.playTimes-1&&t===this._duration&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var i=0,s=this._boneTimelines;i<s.length;i++)s[i].playState=-1;for(var r=0,n=this._slotTimelines;r<n.length;r++)n[r].playState=-1}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),r}(t.BaseObject);t.AnimationState=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.current=new t.Transform,i.delta=new t.Transform,i.result=new t.Transform,i}return i4(i,e),i.toString=function(){return"[class dragonBones.BonePose]"},i.prototype._onClear=function(){this.current.identity(),this.delta.identity(),this.result.identity()},i}(t.BaseObject);t.BonePose=i;var s=function(){function t(){}return t.prototype.update=function(t,e){if(this.dirty){if(!(this.leftWeight>0))return 0;if(this.layer!==e){if(this.layerWeight>=this.leftWeight)return this.leftWeight=0,0;this.layer=e,this.leftWeight-=this.layerWeight,this.layerWeight=0}return t*=this.leftWeight,this.layerWeight+=t,this.blendWeight=t,2}return this.dirty=!0,this.layer=e,this.layerWeight=t,this.leftWeight=1,this.blendWeight=t,1},t.prototype.clear=function(){this.dirty=!1,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0},t}();t.BlendState=s}(s4),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.prototype._onClear=function(){this.playState=-1,this.currentPlayTimes=-1,this.currentTime=-1,this._tweenState=0,this._frameRate=0,this._frameValueOffset=0,this._frameCount=0,this._frameOffset=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._dragonBonesData=null,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._frameIntArray=null,this._frameFloatArray=null,this._timelineArray=null,this._frameIndices=null},e.prototype._setCurrentTime=function(t){var e=this.playState,i=this.currentPlayTimes,s=this.currentTime;if(null!==this._actionTimeline&&this._frameCount<=1)this.playState=this._actionTimeline.playState>=0?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var r=this._animationState.playTimes,n=r*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),r>0&&(t>=n||t<=-n)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=r,this.currentTime=t<0?0:this._duration+1e-6):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return(this.currentPlayTimes!==i||this.currentTime!==s)&&((e<0&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==i)&&(this._frameIndex=-1),!0)},e.prototype.init=function(t,e,i){this._armature=t,this._animationState=e,this._timelineData=i,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState._animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,this._dragonBonesData=this._animationData.parent.parent,null!==this._timelineData&&(this._frameIntArray=this._dragonBonesData.frameIntArray,this._frameFloatArray=this._dragonBonesData.frameFloatArray,this._frameArray=this._dragonBonesData.frameArray,this._timelineArray=this._dragonBonesData.timelineArray,this._frameIndices=this._dragonBonesData.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1])},e.prototype.fadeOut=function(){},e.prototype.update=function(t){if(this._setCurrentTime(t)){if(this._frameCount>1){var e=Math.floor(this.currentTime*this._frameRate),i=this._frameIndices[this._timelineData.frameIndicesOffset+e];this._frameIndex!==i&&(this._frameIndex=i,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());0!==this._tweenState&&this._onUpdateFrame()}},e}(t.BaseObject);t.TimelineState=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e._getEasingValue=function(t,e,i){var s=e;switch(t){case 3:s=Math.pow(e,2);break;case 4:s=1-Math.pow(1-e,2);break;case 5:s=.5*(1-Math.cos(e*Math.PI))}return(s-e)*i+e},e._getEasingCurveValue=function(t,e,i,s){if(t<=0)return 0;if(t>=1)return 1;var r=i+1,n=Math.floor(t*r),o=0===n?0:e[s+n-1];return 1e-4*(o+((n===r-1?1e4:e[s+n])-o)*(t*r-n))},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenProgress=0,this._tweenEasing=0},e.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._tweenState=0===this._tweenType?1:2,2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]),this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],e=this._frameArray[t]*this._frameRateR-this._framePosition;this._frameDurationR=e>0?1/e:0}else this._tweenState=1},e.prototype._onUpdateFrame=function(){2===this._tweenState?(this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=e._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=e._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing))):this._tweenProgress=0},e}(e);t.TweenTimelineState=i;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.bone=null,this.bonePose=null},e.prototype.blend=function(t){var e=this.bone._blendState.blendWeight,i=this.bone.animationPose,s=this.bonePose.result;2===t?(i.x+=s.x*e,i.y+=s.y*e,i.rotation+=s.rotation*e,i.skew+=s.skew*e,i.scaleX+=(s.scaleX-1)*e,i.scaleY+=(s.scaleY-1)*e):1!==e?(i.x=s.x*e,i.y=s.y*e,i.rotation=s.rotation*e,i.skew=s.skew*e,i.scaleX=(s.scaleX-1)*e+1,i.scaleY=(s.scaleY-1)*e+1):(i.x=s.x,i.y=s.y,i.rotation=s.rotation,i.skew=s.skew,i.scaleX=s.scaleX,i.scaleY=s.scaleY),0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.bone._transformDirty=!0)},e}(i);t.BoneTimelineState=s;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.slot=null},e}(i);t.SlotTimelineState=r;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.constraint=null},e}(i);t.ConstraintTimelineState=n}(s4),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return i4(i,e),i.toString=function(){return"[class dragonBones.ActionTimelineState]"},i.prototype._onCrossFrame=function(e){var i=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var s=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+e],r=this._frameArray[s+1],n=this._animationData.parent.actions,o=0;o<r;++o){var a=n[this._frameArray[s+2+o]];if(0===a.type)(h=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[s]/this._frameRate,h.animationState=this._animationState,t.EventObject.actionDataToInstance(a,h,this._armature),this._armature._bufferAction(h,!0);else{var h,l=10===a.type?t.EventObject.FRAME_EVENT:t.EventObject.SOUND_EVENT;(11===a.type||i.hasDBEventListener(l))&&((h=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[s]/this._frameRate,h.animationState=this._animationState,t.EventObject.actionDataToInstance(a,h,this._armature),this._armature._dragonBones.bufferEvent(h))}}},i.prototype._onArriveAtFrame=function(){},i.prototype._onUpdateFrame=function(){},i.prototype.update=function(e){var i=this.playState,s=this.currentPlayTimes,r=this.currentTime;if(this._setCurrentTime(e)){var n=this._armature.eventDispatcher;if(i<0){if(this.playState===i)return;if(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),s=this.currentPlayTimes,n.hasDBEventListener(t.EventObject.START)){var o=t.BaseObject.borrowObject(t.EventObject);o.type=t.EventObject.START,o.armature=this._armature,o.animationState=this._animationState,this._armature._dragonBones.bufferEvent(o)}}var a=this._animationState.timeScale<0,h=null,l=null;if(this.currentPlayTimes!==s&&(n.hasDBEventListener(t.EventObject.LOOP_COMPLETE)&&((h=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.LOOP_COMPLETE,h.armature=this._armature,h.animationState=this._animationState),this.playState>0&&n.hasDBEventListener(t.EventObject.COMPLETE)&&((l=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.COMPLETE,l.armature=this._armature,l.animationState=this._animationState)),this._frameCount>1){var c=this._timelineData,u=Math.floor(this.currentTime*this._frameRate),d=this._frameIndices[c.frameIndicesOffset+u];if(this._frameIndex!==d){var _=this._frameIndex;if(this._frameIndex=d,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[c.offset+5+this._frameIndex],a){if(_<0){var p=Math.floor(r*this._frameRate);_=this._frameIndices[c.frameIndicesOffset+p],this.currentPlayTimes===s&&_===d&&(_=-1)}for(;_>=0;){var m=this._animationData.frameOffset+this._timelineArray[c.offset+5+_],g=this._frameArray[m]/this._frameRate;if(this._position<=g&&g<=this._position+this._duration&&this._onCrossFrame(_),null!==h&&0===_&&(this._armature._dragonBones.bufferEvent(h),h=null),_>0?_--:_=this._frameCount-1,_===d)break}}else for(_<0&&(p=Math.floor(r*this._frameRate),_=this._frameIndices[c.frameIndicesOffset+p],m=this._animationData.frameOffset+this._timelineArray[c.offset+5+_],g=this._frameArray[m]/this._frameRate,this.currentPlayTimes===s&&(r<=g?_>0?_--:_=this._frameCount-1:_===d&&(_=-1)));_>=0&&(_<this._frameCount-1?_++:_=0,m=this._animationData.frameOffset+this._timelineArray[c.offset+5+_],g=this._frameArray[m]/this._frameRate,this._position<=g&&g<=this._position+this._duration&&this._onCrossFrame(_),null!==h&&0===_&&(this._armature._dragonBones.bufferEvent(h),h=null),_!==d););}}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5],g=this._frameArray[this._frameOffset]/this._frameRate,this.currentPlayTimes===s?r<=g&&this._onCrossFrame(this._frameIndex):this._position<=g&&(a||null===h||(this._armature._dragonBones.bufferEvent(h),h=null),this._onCrossFrame(this._frameIndex)));null!==h&&this._armature._dragonBones.bufferEvent(h),null!==l&&this._armature._dragonBones.bufferEvent(l)}},i.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},i}(t.TimelineState);t.ActionTimelineState=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},e.prototype._onArriveAtFrame=function(){this.playState>=0&&(this._frameArray[this._frameOffset+1]>0?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},e.prototype._onUpdateFrame=function(){},e}(t.TimelineState);t.ZOrderTimelineState=i;var s=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return i4(i,e),i.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},i.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+6*this._frameIndex,i=this._armature._armatureData.scale,s=this._frameFloatArray,r=this.bonePose.current,n=this.bonePose.delta;r.x=s[t++]*i,r.y=s[t++]*i,r.rotation=s[t++],r.skew=s[t++],r.scaleX=s[t++],r.scaleY=s[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),n.x=s[t++]*i-r.x,n.y=s[t++]*i-r.y,n.rotation=s[t++]-r.rotation,n.skew=s[t++]-r.skew,n.scaleX=s[t++]-r.scaleX,n.scaleY=s[t++]-r.scaleY):(n.x=0,n.y=0,n.rotation=0,n.skew=0,n.scaleX=0,n.scaleY=0)}else r=this.bonePose.current,n=this.bonePose.delta,r.x=0,r.y=0,r.rotation=0,r.skew=0,r.scaleX=1,r.scaleY=1,n.x=0,n.y=0,n.rotation=0,n.skew=0,n.scaleX=0,n.scaleY=0},i.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,i=this.bonePose.delta,s=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),s.x=t.x+i.x*this._tweenProgress,s.y=t.y+i.y*this._tweenProgress,s.rotation=t.rotation+i.rotation*this._tweenProgress,s.skew=t.skew+i.skew*this._tweenProgress,s.scaleX=t.scaleX+i.scaleX*this._tweenProgress,s.scaleY=t.scaleY+i.scaleY*this._tweenProgress},i.prototype.fadeOut=function(){var e=this.bonePose.result;e.rotation=t.Transform.normalizeRadian(e.rotation),e.skew=t.Transform.normalizeRadian(e.skew)},i}(t.BoneTimelineState);t.BoneAllTimelineState=s;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,i=this._armature._armatureData.scale,s=this._frameFloatArray,r=this.bonePose.current,n=this.bonePose.delta;r.x=s[e++]*i,r.y=s[e++]*i,2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameFloatOffset+this._frameValueOffset),n.x=s[e++]*i-r.x,n.y=s[e++]*i-r.y):(n.x=0,n.y=0)}else r=this.bonePose.current,n=this.bonePose.delta,r.x=0,r.y=0,n.x=0,n.y=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.bonePose.current,i=this.bonePose.delta,s=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),s.x=e.x+i.x*this._tweenProgress,s.y=e.y+i.y*this._tweenProgress},e}(t.BoneTimelineState);t.BoneTranslateTimelineState=r;var n=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return i4(i,e),i.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},i.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var i=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,s=this._frameFloatArray,r=this.bonePose.current,n=this.bonePose.delta;r.rotation=s[i++],r.skew=s[i++],2===this._tweenState?(this._frameIndex===this._frameCount-1?(i=this._animationData.frameFloatOffset+this._frameValueOffset,n.rotation=t.Transform.normalizeRadian(s[i++]-r.rotation)):n.rotation=s[i++]-r.rotation,n.skew=s[i++]-r.skew):(n.rotation=0,n.skew=0)}else r=this.bonePose.current,n=this.bonePose.delta,r.rotation=0,r.skew=0,n.rotation=0,n.skew=0},i.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,i=this.bonePose.delta,s=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),s.rotation=t.rotation+i.rotation*this._tweenProgress,s.skew=t.skew+i.skew*this._tweenProgress},i.prototype.fadeOut=function(){var e=this.bonePose.result;e.rotation=t.Transform.normalizeRadian(e.rotation),e.skew=t.Transform.normalizeRadian(e.skew)},i}(t.BoneTimelineState);t.BoneRotateTimelineState=n;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,i=this._frameFloatArray,s=this.bonePose.current,r=this.bonePose.delta;s.scaleX=i[e++],s.scaleY=i[e++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameFloatOffset+this._frameValueOffset),r.scaleX=i[e++]-s.scaleX,r.scaleY=i[e++]-s.scaleY):(r.scaleX=0,r.scaleY=0)}else s=this.bonePose.current,r=this.bonePose.delta,s.scaleX=1,s.scaleY=1,r.scaleX=0,r.scaleY=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.bonePose.current,i=this.bonePose.delta,s=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),s.scaleX=e.scaleX+i.scaleX*this._tweenProgress,s.scaleY=e.scaleY+i.scaleY*this._tweenProgress},e}(t.BoneTimelineState);t.BoneScaleTimelineState=o;var a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[],e._delta=[],e._result=[],e}return i4(e,t),e.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.surface=null,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,i=this._armature._armatureData.scale,s=this._frameFloatArray;if(2===this._tweenState){var r=e+this._valueCount;this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset);for(var n=0;n<this._valueCount;++n)this._delta[n]=s[r+n]*i-(this._current[n]=s[e+n]*i)}else for(n=0;n<this._valueCount;++n)this._current[n]=s[e+n]*i}else for(n=0;n<this._valueCount;++n)this._current[n]=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this.surface._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var e=0;e<this._valueCount;++e)this._result[e]=this._current[e]+this._delta[e]*this._tweenProgress},e.prototype.init=function(e,i,s){if(t.prototype.init.call(this,e,i,s),null!==this._timelineData){var r=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._deformCount=this._frameIntArray[r+1],this._valueCount=this._frameIntArray[r+2],this._valueOffset=this._frameIntArray[r+3],this._frameFloatOffset=this._frameIntArray[r+4]+this._animationData.frameFloatOffset}else this._deformCount=this.surface._deformVertices.length,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0;this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var n=0;n<this._valueCount;++n)this._delta[n]=0},e.prototype.blend=function(t){for(var e=this.surface._blendState.blendWeight,i=this.surface._deformVertices,s=0;s<this._deformCount;++s){var r;r=s<this._valueOffset?this._frameFloatArray[this._frameFloatOffset+s]:s<this._valueOffset+this._valueCount?this._result[s-this._valueOffset]:this._frameFloatArray[this._frameFloatOffset+s-this._valueCount],2===t?i[s]+=r*e:i[s]=1!==e?r*e:r}0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.surface._transformDirty=!0)},e}(t.TweenTimelineState);t.SurfaceTimelineState=a;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.toString=function(){return"[class dragonBones.SlotDislayTimelineState]"},e.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=null!==this._timelineData?this._frameArray[this._frameOffset+1]:this.slot._slotData.displayIndex;this.slot.displayIndex!==t&&this.slot._setDisplayIndex(t,!0)}},e}(t.SlotTimelineState);t.SlotDislayTimelineState=h;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[0,0,0,0,0,0,0,0],e._delta=[0,0,0,0,0,0,0,0],e._result=[0,0,0,0,0,0,0,0],e}return i4(e,t),e.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dirty=!1},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._dragonBonesData.intArray,i=this._frameIntArray,s=this._animationData.frameIntOffset+this._frameValueOffset+1*this._frameIndex,r=i[s];r<0&&(r+=65536),this._current[0]=e[r++],this._current[1]=e[r++],this._current[2]=e[r++],this._current[3]=e[r++],this._current[4]=e[r++],this._current[5]=e[r++],this._current[6]=e[r++],this._current[7]=e[r++],2===this._tweenState&&((r=this._frameIndex===this._frameCount-1?i[this._animationData.frameIntOffset+this._frameValueOffset]:i[s+1])<0&&(r+=65536),this._delta[0]=e[r++]-this._current[0],this._delta[1]=e[r++]-this._current[1],this._delta[2]=e[r++]-this._current[2],this._delta[3]=e[r++]-this._current[3],this._delta[4]=e[r++]-this._current[4],this._delta[5]=e[r++]-this._current[5],this._delta[6]=e[r++]-this._current[6],this._delta[7]=e[r++]-this._current[7])}else{var n=this.slot._slotData.color;this._current[0]=100*n.alphaMultiplier,this._current[1]=100*n.redMultiplier,this._current[2]=100*n.greenMultiplier,this._current[3]=100*n.blueMultiplier,this._current[4]=n.alphaOffset,this._current[5]=n.redOffset,this._current[6]=n.greenOffset,this._current[7]=n.blueOffset}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0),this._result[0]=.01*(this._current[0]+this._delta[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._delta[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._delta[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._delta[3]*this._tweenProgress),this._result[4]=this._current[4]+this._delta[4]*this._tweenProgress,this._result[5]=this._current[5]+this._delta[5]*this._tweenProgress,this._result[6]=this._current[6]+this._delta[6]*this._tweenProgress,this._result[7]=this._current[7]+this._delta[7]*this._tweenProgress},e.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},e.prototype.update=function(e){if(t.prototype.update.call(this,e),0!==this._tweenState||this._dirty){var i=this.slot._colorTransform;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){if(i.alphaMultiplier!==this._result[0]||i.redMultiplier!==this._result[1]||i.greenMultiplier!==this._result[2]||i.blueMultiplier!==this._result[3]||i.alphaOffset!==this._result[4]||i.redOffset!==this._result[5]||i.greenOffset!==this._result[6]||i.blueOffset!==this._result[7]){var s=Math.pow(this._animationState._fadeProgress,4);i.alphaMultiplier+=(this._result[0]-i.alphaMultiplier)*s,i.redMultiplier+=(this._result[1]-i.redMultiplier)*s,i.greenMultiplier+=(this._result[2]-i.greenMultiplier)*s,i.blueMultiplier+=(this._result[3]-i.blueMultiplier)*s,i.alphaOffset+=(this._result[4]-i.alphaOffset)*s,i.redOffset+=(this._result[5]-i.redOffset)*s,i.greenOffset+=(this._result[6]-i.greenOffset)*s,i.blueOffset+=(this._result[7]-i.blueOffset)*s,this.slot._colorDirty=!0}}else this._dirty&&(this._dirty=!1,i.alphaMultiplier===this._result[0]&&i.redMultiplier===this._result[1]&&i.greenMultiplier===this._result[2]&&i.blueMultiplier===this._result[3]&&i.alphaOffset===this._result[4]&&i.redOffset===this._result[5]&&i.greenOffset===this._result[6]&&i.blueOffset===this._result[7]||(i.alphaMultiplier=this._result[0],i.redMultiplier=this._result[1],i.greenMultiplier=this._result[2],i.blueMultiplier=this._result[3],i.alphaOffset=this._result[4],i.redOffset=this._result[5],i.greenOffset=this._result[6],i.blueOffset=this._result[7],this.slot._colorDirty=!0))}},e}(t.SlotTimelineState);t.SlotColorTimelineState=l;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[],e._delta=[],e._result=[],e}return i4(e,t),e.toString=function(){return"[class dragonBones.DeformTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.vertexOffset=0,this._dirty=!1,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,i=this._armature._armatureData.scale,s=this._frameFloatArray;if(2===this._tweenState){var r=e+this._valueCount;this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset);for(var n=0;n<this._valueCount;++n)this._delta[n]=s[r+n]*i-(this._current[n]=s[e+n]*i)}else for(n=0;n<this._valueCount;++n)this._current[n]=s[e+n]*i}else for(n=0;n<this._valueCount;++n)this._current[n]=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var e=0;e<this._valueCount;++e)this._result[e]=this._current[e]+this._delta[e]*this._tweenProgress},e.prototype.init=function(e,i,s){if(t.prototype.init.call(this,e,i,s),null!==this._timelineData){var r=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this.vertexOffset=this._frameIntArray[r+0],this.vertexOffset<0&&(this.vertexOffset+=65536),this._deformCount=this._frameIntArray[r+1],this._valueCount=this._frameIntArray[r+2],this._valueOffset=this._frameIntArray[r+3],this._frameFloatOffset=this._frameIntArray[r+4]+this._animationData.frameFloatOffset}else{var n=this.slot._deformVertices;this._deformCount=null!==n?n.vertices.length:0,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0}this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var o=0;o<this._valueCount;++o)this._delta[o]=0},e.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},e.prototype.update=function(e){var i=this.slot._deformVertices;if(null!==i&&null!==i.verticesData&&i.verticesData.offset===this.vertexOffset&&(t.prototype.update.call(this,e),0!==this._tweenState||this._dirty)){var s=i.vertices;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(var r=Math.pow(this._animationState._fadeProgress,2),n=0;n<this._deformCount;++n)n<this._valueOffset?s[n]+=(this._frameFloatArray[this._frameFloatOffset+n]-s[n])*r:n<this._valueOffset+this._valueCount?s[n]+=(this._result[n-this._valueOffset]-s[n])*r:s[n]+=(this._frameFloatArray[this._frameFloatOffset+n-this._valueCount]-s[n])*r;i.verticesDirty=!0}else if(this._dirty){for(this._dirty=!1,n=0;n<this._deformCount;++n)n<this._valueOffset?s[n]=this._frameFloatArray[this._frameFloatOffset+n]:n<this._valueOffset+this._valueCount?s[n]=this._result[n-this._valueOffset]:s[n]=this._frameFloatArray[this._frameFloatOffset+n-this._valueCount];i.verticesDirty=!0}}},e}(t.SlotTimelineState);t.DeformTimelineState=c;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._current=0,this._delta=0},e.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this);var e=this.constraint;if(null!==this._timelineData){var i=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,s=this._frameIntArray,r=0!==s[i++];this._current=.01*s[i++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(i=this._animationData.frameIntOffset+this._frameValueOffset),this._delta=.01*s[i+1]-this._current):this._delta=0,e._bendPositive=r}else{var n=e._constraintData;this._current=n.weight,this._delta=0,e._bendPositive=n.bendPositive}e.invalidUpdate()},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0);var e=this.constraint;e._weight=this._current+this._delta*this._tweenProgress,e.invalidUpdate()},e}(t.ConstraintTimelineState);t.IKConstraintTimelineState=u;var d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._floats=[0,0,0,0,0,0],e}return i4(e,t),e.toString=function(){return"[class dragonBones.AnimationTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.animationState=null},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,i=1/this.animationState._animationData.parent.frameRate,s=this._frameIntArray;this._floats[0]=s[e++]*i,this._floats[3]=.01*s[e++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameIntOffset+this._frameValueOffset),this._floats[1]=s[e++]*i-this._floats[0],this._floats[4]=.01*s[e++]-this._floats[3]):(this._floats[1]=0,this._floats[4]=0)}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0),this._floats[0]>=0&&(this._floats[2]=this._floats[0]+this._floats[1]*this._tweenProgress),this._floats[5]=this._floats[3]+this._floats[4]*this._tweenProgress},e.prototype.blend=function(t){var e=this.animationState,i=e._blendState.blendWeight;2===t?(e.weight+=this._floats[5]*i,e.currentTime+=this._floats[2]*i):(e.weight=this._floats[5]*i,e.currentTime=this._floats[2]*i)},e}(t.TweenTimelineState);t.AnimationTimelineState=d}(s4),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i4(e,t),e.actionDataToInstance=function(t,i,s){0===t.type?i.type=e.FRAME_EVENT:i.type=10===t.type?e.FRAME_EVENT:e.SOUND_EVENT,i.name=t.name,i.armature=s,i.actionData=t,i.data=t.data,null!==t.bone&&(i.bone=s.getBone(t.bone.name)),null!==t.slot&&(i.slot=s.getSlot(t.slot.name))},e.toString=function(){return"[class dragonBones.EventObject]"},e.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.actionData=null,this.data=null},e.START="start",e.LOOP_COMPLETE="loopComplete",e.COMPLETE="complete",e.FADE_IN="fadeIn",e.FADE_IN_COMPLETE="fadeInComplete",e.FADE_OUT="fadeOut",e.FADE_OUT_COMPLETE="fadeOutComplete",e.FRAME_EVENT="frameEvent",e.SOUND_EVENT="soundEvent",e}(t.BaseObject);t.EventObject=e}(s4),function(t){var e=function(){function e(){}return e._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":default:return 0;case"movieclip":return 1}},e._getBoneType=function(t){switch(t.toLowerCase()){case"bone":default:return 0;case"surface":return 1}},e._getDisplayType=function(t){switch(t.toLowerCase()){case"image":default:return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4}},e._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":default:return 0;case"ellipse":return 1;case"polygon":return 2}},e._getActionType=function(t){switch(t.toLowerCase()){case"play":default:return 0;case"frame":return 10;case"sound":return 11}},e._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":default:return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13}},e._getPositionMode=function(t){switch(t.toLocaleLowerCase()){case"percent":default:return 1;case"fixed":return 0}},e._getSpacingMode=function(t){switch(t.toLocaleLowerCase()){case"length":default:return 0;case"percent":return 2;case"fixed":return 1}},e._getRotateMode=function(t){switch(t.toLocaleLowerCase()){case"tangent":default:return 0;case"chain":return 1;case"chainscale":return 2}},e.parseDragonBonesData=function(e){return console.warn("Deprecated."),e instanceof ArrayBuffer?t.BinaryDataParser.getInstance().parseDragonBonesData(e):t.ObjectDataParser.getInstance().parseDragonBonesData(e)},e.parseTextureAtlasData=function(i,s){void 0===s&&(s=1),console.warn("");for(var r={},n=i[e.SUB_TEXTURE],o=0,a=n.length;o<a;o++){var h=n[o],l=h[e.NAME],c=new t.Rectangle,u=null;c.x=h[e.X]/s,c.y=h[e.Y]/s,c.width=h[e.WIDTH]/s,c.height=h[e.HEIGHT]/s,e.FRAME_WIDTH in h&&((u=new t.Rectangle).x=h[e.FRAME_X]/s,u.y=h[e.FRAME_Y]/s,u.width=h[e.FRAME_WIDTH]/s,u.height=h[e.FRAME_HEIGHT]/s),r[l]={region:c,frame:u,rotated:!1}}return r},e.DATA_VERSION_2_3="2.3",e.DATA_VERSION_3_0="3.0",e.DATA_VERSION_4_0="4.0",e.DATA_VERSION_4_5="4.5",e.DATA_VERSION_5_0="5.0",e.DATA_VERSION_5_5="5.5",e.DATA_VERSION=e.DATA_VERSION_5_5,e.DATA_VERSIONS=[e.DATA_VERSION_4_0,e.DATA_VERSION_4_5,e.DATA_VERSION_5_0,e.DATA_VERSION_5_5],e.TEXTURE_ATLAS="textureAtlas",e.SUB_TEXTURE="SubTexture",e.FORMAT="format",e.IMAGE_PATH="imagePath",e.WIDTH="width",e.HEIGHT="height",e.ROTATED="rotated",e.FRAME_X="frameX",e.FRAME_Y="frameY",e.FRAME_WIDTH="frameWidth",e.FRAME_HEIGHT="frameHeight",e.DRADON_BONES="dragonBones",e.USER_DATA="userData",e.ARMATURE="armature",e.BONE="bone",e.SURFACE="surface",e.SLOT="slot",e.CONSTRAINT="constraint",e.IK="ik",e.PATH_CONSTRAINT="path",e.SKIN="skin",e.DISPLAY="display",e.ANIMATION="animation",e.Z_ORDER="zOrder",e.FFD="ffd",e.FRAME="frame",e.TRANSLATE_FRAME="translateFrame",e.ROTATE_FRAME="rotateFrame",e.SCALE_FRAME="scaleFrame",e.DISPLAY_FRAME="displayFrame",e.COLOR_FRAME="colorFrame",e.DEFAULT_ACTIONS="defaultActions",e.ACTIONS="actions",e.EVENTS="events",e.INTS="ints",e.FLOATS="floats",e.STRINGS="strings",e.CANVAS="canvas",e.TRANSFORM="transform",e.PIVOT="pivot",e.AABB="aabb",e.COLOR="color",e.VERSION="version",e.COMPATIBLE_VERSION="compatibleVersion",e.FRAME_RATE="frameRate",e.TYPE="type",e.SUB_TYPE="subType",e.NAME="name",e.PARENT="parent",e.TARGET="target",e.STAGE="stage",e.SHARE="share",e.PATH="path",e.LENGTH="length",e.DISPLAY_INDEX="displayIndex",e.BLEND_MODE="blendMode",e.INHERIT_TRANSLATION="inheritTranslation",e.INHERIT_ROTATION="inheritRotation",e.INHERIT_SCALE="inheritScale",e.INHERIT_REFLECTION="inheritReflection",e.INHERIT_ANIMATION="inheritAnimation",e.INHERIT_DEFORM="inheritDeform",e.SEGMENT_X="segmentX",e.SEGMENT_Y="segmentY",e.BEND_POSITIVE="bendPositive",e.CHAIN="chain",e.WEIGHT="weight",e.FADE_IN_TIME="fadeInTime",e.PLAY_TIMES="playTimes",e.SCALE="scale",e.OFFSET="offset",e.POSITION="position",e.DURATION="duration",e.TWEEN_EASING="tweenEasing",e.TWEEN_ROTATE="tweenRotate",e.TWEEN_SCALE="tweenScale",e.CLOCK_WISE="clockwise",e.CURVE="curve",e.SOUND="sound",e.EVENT="event",e.ACTION="action",e.X="x",e.Y="y",e.SKEW_X="skX",e.SKEW_Y="skY",e.SCALE_X="scX",e.SCALE_Y="scY",e.VALUE="value",e.ROTATE="rotate",e.SKEW="skew",e.ALPHA_OFFSET="aO",e.RED_OFFSET="rO",e.GREEN_OFFSET="gO",e.BLUE_OFFSET="bO",e.ALPHA_MULTIPLIER="aM",e.RED_MULTIPLIER="rM",e.GREEN_MULTIPLIER="gM",e.BLUE_MULTIPLIER="bM",e.UVS="uvs",e.VERTICES="vertices",e.TRIANGLES="triangles",e.WEIGHTS="weights",e.SLOT_POSE="slotPose",e.BONE_POSE="bonePose",e.GLUE_WEIGHTS="glueWeights",e.GLUE_MESHES="glueMeshes",e.BONES="bones",e.POSITION_MODE="positionMode",e.SPACING_MODE="spacingMode",e.ROTATE_MODE="rotateMode",e.SPACING="spacing",e.ROTATE_OFFSET="rotateOffset",e.ROTATE_MIX="rotateMix",e.TRANSLATE_MIX="translateMix",e.TARGET_DISPLAY="targetDisplay",e.CLOSED="closed",e.CONSTANT_SPEED="constantSpeed",e.VERTEX_COUNT="vertexCount",e.LENGTHS="lengths",e.GOTO_AND_PLAY="gotoAndPlay",e.DEFAULT_NAME="default",e}();t.DataParser=e}(s4),function(t){var e=function(e){function s(){var i=null!==e&&e.apply(this,arguments)||this;return i._rawTextureAtlasIndex=0,i._rawBones=[],i._data=null,i._armature=null,i._bone=null,i._surface=null,i._slot=null,i._skin=null,i._mesh=null,i._animation=null,i._timeline=null,i._rawTextureAtlases=null,i._defaultColorOffset=-1,i._prevClockwise=0,i._prevRotation=0,i._helpMatrixA=new t.Matrix,i._helpMatrixB=new t.Matrix,i._helpTransform=new t.Transform,i._helpColorTransform=new t.ColorTransform,i._helpPoint=new t.Point,i._helpArray=[],i._intArray=[],i._floatArray=[],i._frameIntArray=[],i._frameFloatArray=[],i._frameArray=[],i._timelineArray=[],i._cacheRawMeshes=[],i._cacheMeshes=[],i._actionFrames=[],i._weightSlotPose={},i._weightBonePoses={},i._cacheBones={},i._slotChildActions={},i}return i4(s,e),s._getBoolean=function(t,e,i){if(e in t){var s=t[e],r=typeof s;if("boolean"===r)return s;if("string"!==r)return!!s;switch(s){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},s._getNumber=function(t,e,i){if(e in t){var s=t[e];return null===s||"NaN"===s?i:+s||0}return i},s._getString=function(e,i,s){if(i in e){var r=e[i];if("string"==typeof r){if(t.DragonBones.webAssembly)for(var n=0,o=r.length;n<o;++n)if(r.charCodeAt(n)>255)return encodeURI(r);return r}return String(r)}return s},s.prototype._getCurvePoint=function(t,e,i,s,r,n,o,a,h,l){var c=1-h,u=c*c,d=h*h,_=c*u,p=3*h*u,m=3*c*d,g=h*d;l.x=_*t+p*i+m*r+g*o,l.y=_*e+p*s+m*n+g*a},s.prototype._samplingEasingCurve=function(t,e){for(var i=t.length,s=-2,r=0,n=e.length;r<n;++r){for(var o=(r+1)/(n+1);(s+6<i?t[s+6]:1)<o;)s+=6;for(var a=s>=0&&s+6<i,h=a?t[s]:0,l=a?t[s+1]:0,c=t[s+2],u=t[s+3],d=t[s+4],_=t[s+5],p=a?t[s+6]:1,m=a?t[s+7]:1,g=0,f=1;f-g>1e-4;){var y=.5*(f+g);this._getCurvePoint(h,l,c,u,d,_,p,m,y,this._helpPoint),o-this._helpPoint.x>0?g=y:f=y}e[r]=this._helpPoint.y}},s.prototype._parseActionDataInFrame=function(e,i,s,r){t.DataParser.EVENT in e&&this._mergeActionFrame(e[t.DataParser.EVENT],i,10,s,r),t.DataParser.SOUND in e&&this._mergeActionFrame(e[t.DataParser.SOUND],i,11,s,r),t.DataParser.ACTION in e&&this._mergeActionFrame(e[t.DataParser.ACTION],i,0,s,r),t.DataParser.EVENTS in e&&this._mergeActionFrame(e[t.DataParser.EVENTS],i,10,s,r),t.DataParser.ACTIONS in e&&this._mergeActionFrame(e[t.DataParser.ACTIONS],i,0,s,r)},s.prototype._mergeActionFrame=function(e,s,r,n,o){for(var a=t.DragonBones.webAssembly?this._armature.actions.size():this._armature.actions.length,h=this._parseActionData(e,r,n,o),l=0,c=null,u=0,d=h;u<d.length;u++){var _=d[u];this._armature.addAction(_,!1)}0===this._actionFrames.length&&((c=new i).frameStart=0,this._actionFrames.push(c),c=null);for(var p=0,m=this._actionFrames;p<m.length;p++){var g=m[p];if(g.frameStart===s){c=g;break}if(g.frameStart>s)break;l++}null===c&&((c=new i).frameStart=s,this._actionFrames.splice(l+1,0,c));for(var f=0;f<h.length;++f)c.actions.push(a+f)},s.prototype._parseArmature=function(e,i){var r=t.BaseObject.borrowObject(t.ArmatureData);if(r.name=s._getString(e,t.DataParser.NAME,""),r.frameRate=s._getNumber(e,t.DataParser.FRAME_RATE,this._data.frameRate),r.scale=i,t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?r.type=t.DataParser._getArmatureType(e[t.DataParser.TYPE]):r.type=s._getNumber(e,t.DataParser.TYPE,0),0===r.frameRate&&(r.frameRate=24),this._armature=r,t.DataParser.CANVAS in e){var n=e[t.DataParser.CANVAS],o=t.BaseObject.borrowObject(t.CanvasData);t.DataParser.COLOR in n?o.hasBackground=!0:o.hasBackground=!1,o.color=s._getNumber(n,t.DataParser.COLOR,0),o.x=s._getNumber(n,t.DataParser.X,0)*r.scale,o.y=s._getNumber(n,t.DataParser.Y,0)*r.scale,o.width=s._getNumber(n,t.DataParser.WIDTH,0)*r.scale,o.height=s._getNumber(n,t.DataParser.HEIGHT,0)*r.scale,r.canvas=o}if(t.DataParser.AABB in e){var a=e[t.DataParser.AABB];r.aabb.x=s._getNumber(a,t.DataParser.X,0)*r.scale,r.aabb.y=s._getNumber(a,t.DataParser.Y,0)*r.scale,r.aabb.width=s._getNumber(a,t.DataParser.WIDTH,0)*r.scale,r.aabb.height=s._getNumber(a,t.DataParser.HEIGHT,0)*r.scale}if(t.DataParser.BONE in e)for(var h=0,l=e[t.DataParser.BONE];h<l.length;h++){var c=l[h],u=s._getString(c,t.DataParser.PARENT,""),d=this._parseBone(c);if(u.length>0){var _=r.getBone(u);null!==_?d.parent=_:(u in this._cacheBones||(this._cacheBones[u]=[]),this._cacheBones[u].push(d))}if(d.name in this._cacheBones){for(var p=0,m=this._cacheBones[d.name];p<m.length;p++)m[p].parent=d;delete this._cacheBones[d.name]}r.addBone(d),this._rawBones.push(d)}if(t.DataParser.IK in e)for(var g=0,f=e[t.DataParser.IK];g<f.length;g++){var y=f[g];(E=this._parseIKConstraint(y))&&r.addConstraint(E)}if(r.sortBones(),t.DataParser.SLOT in e)for(var b=0,v=0,S=e[t.DataParser.SLOT];v<S.length;v++){var T=S[v];r.addSlot(this._parseSlot(T,b++))}if(t.DataParser.SKIN in e)for(var w=0,x=e[t.DataParser.SKIN];w<x.length;w++){var C=x[w];r.addSkin(this._parseSkin(C))}if(t.DataParser.PATH_CONSTRAINT in e)for(var A=0,D=e[t.DataParser.PATH_CONSTRAINT];A<D.length;A++){var E,I=D[A];(E=this._parsePathConstraint(I))&&r.addConstraint(E)}for(var M=0,P=this._cacheRawMeshes.length;M<P;++M){var O=this._cacheRawMeshes[M];t.DataParser.GLUE_WEIGHTS in O&&t.DataParser.GLUE_MESHES in O&&this._parseMeshGlue(O,this._cacheMeshes[M])}for(M=0,P=this._cacheRawMeshes.length;M<P;++M){var R=this._cacheRawMeshes[M],B=s._getString(R,t.DataParser.SHARE,"");if(0!==B.length){var F=s._getString(R,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME);0===F.length&&(F=t.DataParser.DEFAULT_NAME);var N=r.getMesh(F,"",B);null!==N&&this._cacheMeshes[M].vertices.shareFrom(N.vertices)}}if(t.DataParser.ANIMATION in e)for(var L=0,k=e[t.DataParser.ANIMATION];L<k.length;L++){var z=k[L],U=this._parseAnimation(z);r.addAnimation(U)}if(t.DataParser.DEFAULT_ACTIONS in e)for(var V=0,j=this._parseActionData(e[t.DataParser.DEFAULT_ACTIONS],0,null,null);V<j.length;V++){var H=j[V];r.addAction(H,!0),0===H.type&&null!==(U=r.getAnimation(H.name))&&(r.defaultAnimation=U)}if(t.DataParser.ACTIONS in e)for(var G=0,W=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);G<W.length;G++)H=W[G],r.addAction(H,!1);for(var X in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[X];for(var X in this._weightBonePoses)delete this._weightBonePoses[X];for(var X in this._cacheBones)delete this._cacheBones[X];for(var X in this._slotChildActions)delete this._slotChildActions[X];return r},s.prototype._parseBone=function(e){var i=this._armature.scale;if(0===(t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getBoneType(e[t.DataParser.TYPE]):s._getNumber(e,t.DataParser.TYPE,0))){var r=t.BaseObject.borrowObject(t.BoneData);return r.inheritTranslation=s._getBoolean(e,t.DataParser.INHERIT_TRANSLATION,!0),r.inheritRotation=s._getBoolean(e,t.DataParser.INHERIT_ROTATION,!0),r.inheritScale=s._getBoolean(e,t.DataParser.INHERIT_SCALE,!0),r.inheritReflection=s._getBoolean(e,t.DataParser.INHERIT_REFLECTION,!0),r.length=s._getNumber(e,t.DataParser.LENGTH,0)*i,r.name=s._getString(e,t.DataParser.NAME,""),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],r.transform,i),r}var n=t.BaseObject.borrowObject(t.SurfaceData);if(n.name=s._getString(e,t.DataParser.NAME,""),n.segmentX=s._getNumber(e,t.DataParser.SEGMENT_X,0),n.segmentY=s._getNumber(e,t.DataParser.SEGMENT_Y,0),n.vertices.length=(n.segmentX+1)*(n.segmentY+1)*2,t.DataParser.VERTICES in e)for(var o=e[t.DataParser.VERTICES],a=0,h=n.vertices.length;a<h;++a)a<o.length?n.vertices[a]=o[a]*i:n.vertices[a]=0;return n},s.prototype._parseIKConstraint=function(e){var i=this._armature.getBone(s._getString(e,t.DataParser.BONE,""));if(null===i)return null;var r=this._armature.getBone(s._getString(e,t.DataParser.TARGET,""));if(null===r)return null;var n=t.BaseObject.borrowObject(t.IKConstraintData);return n.scaleEnabled=s._getBoolean(e,t.DataParser.SCALE,!1),n.bendPositive=s._getBoolean(e,t.DataParser.BEND_POSITIVE,!0),n.weight=s._getNumber(e,t.DataParser.WEIGHT,1),n.name=s._getString(e,t.DataParser.NAME,""),n.type=0,n.target=r,s._getNumber(e,t.DataParser.CHAIN,0)>0&&null!==i.parent?(n.root=i.parent,n.bone=i):(n.root=i,n.bone=null),n},s.prototype._parsePathConstraint=function(e){var i=this._armature.getSlot(s._getString(e,t.DataParser.TARGET,""));if(null===i)return null;var r=this._armature.defaultSkin;if(null===r)return null;var n=r.getDisplay(i.name,s._getString(e,t.DataParser.TARGET_DISPLAY,i.name));if(null===n||!(n instanceof t.PathDisplayData))return null;var o=e[t.DataParser.BONES];if(null===o||0===o.length)return null;var a=t.BaseObject.borrowObject(t.PathConstraintData);a.name=s._getString(e,t.DataParser.NAME,""),a.type=1,a.pathSlot=i,a.pathDisplayData=n,a.target=i.parent,a.positionMode=t.DataParser._getPositionMode(s._getString(e,t.DataParser.POSITION_MODE,"")),a.spacingMode=t.DataParser._getSpacingMode(s._getString(e,t.DataParser.SPACING_MODE,"")),a.rotateMode=t.DataParser._getRotateMode(s._getString(e,t.DataParser.ROTATE_MODE,"")),a.position=s._getNumber(e,t.DataParser.POSITION,0),a.spacing=s._getNumber(e,t.DataParser.SPACING,0),a.rotateOffset=s._getNumber(e,t.DataParser.ROTATE_OFFSET,0),a.rotateMix=s._getNumber(e,t.DataParser.ROTATE_MIX,1),a.translateMix=s._getNumber(e,t.DataParser.TRANSLATE_MIX,1);for(var h=0,l=o;h<l.length;h++){var c=l[h],u=this._armature.getBone(c);null!==u&&(a.AddBone(u),null===a.root&&(a.root=u))}return a},s.prototype._parseSlot=function(e,i){var r=t.BaseObject.borrowObject(t.SlotData);return r.displayIndex=s._getNumber(e,t.DataParser.DISPLAY_INDEX,0),r.zOrder=i,r.name=s._getString(e,t.DataParser.NAME,""),r.parent=this._armature.getBone(s._getString(e,t.DataParser.PARENT,"")),t.DataParser.BLEND_MODE in e&&"string"==typeof e[t.DataParser.BLEND_MODE]?r.blendMode=t.DataParser._getBlendMode(e[t.DataParser.BLEND_MODE]):r.blendMode=s._getNumber(e,t.DataParser.BLEND_MODE,0),t.DataParser.COLOR in e?(r.color=t.SlotData.createColor(),this._parseColorTransform(e[t.DataParser.COLOR],r.color)):r.color=t.SlotData.DEFAULT_COLOR,t.DataParser.ACTIONS in e&&(this._slotChildActions[r.name]=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null)),r},s.prototype._parseSkin=function(e){var i=t.BaseObject.borrowObject(t.SkinData);if(i.name=s._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),t.DataParser.SLOT in e){var r=e[t.DataParser.SLOT];this._skin=i;for(var n=0,o=r;n<o.length;n++){var a=o[n],h=s._getString(a,t.DataParser.NAME,""),l=this._armature.getSlot(h);if(null!==l){if(this._slot=l,t.DataParser.DISPLAY in a)for(var c=0,u=a[t.DataParser.DISPLAY];c<u.length;c++){var d=u[c];d?i.addDisplay(h,this._parseDisplay(d)):i.addDisplay(h,null)}this._slot=null}}this._skin=null}return i},s.prototype._parseDisplay=function(e){var i=s._getString(e,t.DataParser.NAME,""),r=s._getString(e,t.DataParser.PATH,""),n=0,o=null;switch(n=t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getDisplayType(e[t.DataParser.TYPE]):s._getNumber(e,t.DataParser.TYPE,n)){case 0:var a=o=t.BaseObject.borrowObject(t.ImageDisplayData);a.name=i,a.path=r.length>0?r:i,this._parsePivot(e,a);break;case 1:var h=o=t.BaseObject.borrowObject(t.ArmatureDisplayData);if(h.name=i,h.path=r.length>0?r:i,h.inheritAnimation=!0,t.DataParser.ACTIONS in e)for(var l=0,c=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);l<c.length;l++){var u=c[l];h.addAction(u)}else if(this._slot.name in this._slotChildActions){var d=this._skin.getDisplays(this._slot.name);if(null===d?0===this._slot.displayIndex:this._slot.displayIndex===d.length){for(var _=0,p=this._slotChildActions[this._slot.name];_<p.length;_++)u=p[_],h.addAction(u);delete this._slotChildActions[this._slot.name]}}break;case 2:var m=o=t.BaseObject.borrowObject(t.MeshDisplayData);m.vertices.inheritDeform=s._getBoolean(e,t.DataParser.INHERIT_DEFORM,!0),m.name=i,m.path=r.length>0?r:i,m.vertices.data=this._data,t.DataParser.SHARE in e?(this._cacheRawMeshes.push(e),this._cacheMeshes.push(m)):this._parseMesh(e,m),t.DataParser.GLUE_WEIGHTS in e&&t.DataParser.GLUE_MESHES in e&&(this._cacheRawMeshes.push(e),this._cacheMeshes.push(m));break;case 3:var g=this._parseBoundingBox(e);if(null!==g){var f=o=t.BaseObject.borrowObject(t.BoundingBoxDisplayData);f.name=i,f.path=r.length>0?r:i,f.boundingBox=g}break;case 4:var y=e[t.DataParser.LENGTHS],b=o=t.BaseObject.borrowObject(t.PathDisplayData);b.closed=s._getBoolean(e,t.DataParser.CLOSED,!1),b.constantSpeed=s._getBoolean(e,t.DataParser.CONSTANT_SPEED,!1),b.name=i,b.path=r.length>0?r:i,b.vertices.data=this._data,b.curveLengths.length=y.length;for(var v=0,S=y.length;v<S;++v)b.curveLengths[v]=y[v];this._parsePath(e,b)}return null!==o&&t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],o.transform,this._armature.scale),o},s.prototype._parsePath=function(e,i){var r=e[t.DataParser.VERTICES],n=s._getNumber(e,t.DataParser.VERTEX_COUNT,0),o=this._floatArray.length,a=this._intArray.length;if(i.vertices.offset=a,this._intArray.length+=2,this._intArray[a+0]=n,this._intArray[a+2]=o,t.DataParser.WEIGHTS in e){var h=e[t.DataParser.WEIGHTS],l=e[t.DataParser.BONES],c=l.length,u=Math.floor(h.length-n)/2,d=this._intArray.length,_=this._floatArray.length,p=this._armature.sortedBones,m=t.BaseObject.borrowObject(t.WeightData);for(m.count=u,m.offset=d,this._intArray.length+=2+c+n+u,this._intArray[d+0]=c,this._intArray[d+1]=_,E=0;E<c;E++){var g=l[E],f=this._rawBones[g];m.addBone(f),this._intArray[d+2+E]=p.indexOf(f)}this._floatArray.length+=3*u,E=0;for(var y=0,b=0,v=d+2+c,S=_;E<u;E++){var T=h[y++];this._intArray[v++]=T;for(var w=0;w<T;w++){var x=h[y++],C=h[y++],A=r[b++],D=r[b++];this._intArray[v++]=l.indexOf(x),this._floatArray[S++]=C,this._floatArray[S++]=A,this._floatArray[S++]=D}}i.vertices.weight=m}else{this._floatArray.length+=r.length;for(var E=0,I=r.length;E<I;++E)this._floatArray[o+E]=r[E]}},s.prototype._parsePivot=function(e,i){if(t.DataParser.PIVOT in e){var r=e[t.DataParser.PIVOT];i.pivot.x=s._getNumber(r,t.DataParser.X,0),i.pivot.y=s._getNumber(r,t.DataParser.Y,0)}else i.pivot.x=.5,i.pivot.y=.5},s.prototype._parseMesh=function(e,i){var s=e[t.DataParser.VERTICES],r=e[t.DataParser.UVS],n=e[t.DataParser.TRIANGLES],o=Math.floor(s.length/2),a=Math.floor(n.length/3),h=this._floatArray.length,l=h+2*o,c=this._intArray.length,u=this._skin.name+"_"+this._slot.name+"_"+i.name;i.vertices.offset=c,this._intArray.length+=4+3*a,this._intArray[c+0]=o,this._intArray[c+1]=a,this._intArray[c+2]=h;for(var d=0,_=3*a;d<_;++d)this._intArray[c+4+d]=n[d];for(this._floatArray.length+=2*o+2*o,d=0,_=2*o;d<_;++d)this._floatArray[h+d]=s[d],this._floatArray[l+d]=r[d];if(t.DataParser.WEIGHTS in e){var p=e[t.DataParser.WEIGHTS],m=e[t.DataParser.SLOT_POSE],g=e[t.DataParser.BONE_POSE],f=this._armature.sortedBones,y=new Array,b=Math.floor(g.length/7),v=this._floatArray.length,S=Math.floor(p.length-o)/2,T=this._intArray.length,w=t.BaseObject.borrowObject(t.WeightData);for(w.count=S,w.offset=T,y.length=b,this._intArray.length+=2+b+o+S,this._intArray[T+1]=v,d=0;d<b;++d){var x=g[7*d],C=this._rawBones[x];w.addBone(C),y[d]=x,this._intArray[T+2+d]=f.indexOf(C)}this._floatArray.length+=3*S,this._helpMatrixA.copyFromArray(m,0),d=0;for(var A=0,D=T+2+b,E=v;d<o;++d){var I=2*d,M=this._intArray[D++]=p[A++],P=this._floatArray[h+I],O=this._floatArray[h+I+1];this._helpMatrixA.transformPoint(P,O,this._helpPoint),P=this._helpPoint.x,O=this._helpPoint.y;for(var R=0;R<M;++R){x=p[A++];var B=y.indexOf(x);this._helpMatrixB.copyFromArray(g,7*B+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(P,O,this._helpPoint),this._intArray[D++]=B,this._floatArray[E++]=p[A++],this._floatArray[E++]=this._helpPoint.x,this._floatArray[E++]=this._helpPoint.y}}i.vertices.weight=w,this._weightSlotPose[u]=m,this._weightBonePoses[u]=g}},s.prototype._parseMeshGlue=function(){},s.prototype._parseBoundingBox=function(e){var i=null,r=0;switch(r=t.DataParser.SUB_TYPE in e&&"string"==typeof e[t.DataParser.SUB_TYPE]?t.DataParser._getBoundingBoxType(e[t.DataParser.SUB_TYPE]):s._getNumber(e,t.DataParser.SUB_TYPE,r)){case 0:i=t.BaseObject.borrowObject(t.RectangleBoundingBoxData);break;case 1:i=t.BaseObject.borrowObject(t.EllipseBoundingBoxData);break;case 2:i=this._parsePolygonBoundingBox(e)}return null!==i&&(i.color=s._getNumber(e,t.DataParser.COLOR,0),0!==i.type&&1!==i.type||(i.width=s._getNumber(e,t.DataParser.WIDTH,0),i.height=s._getNumber(e,t.DataParser.HEIGHT,0))),i},s.prototype._parsePolygonBoundingBox=function(e){var i=t.BaseObject.borrowObject(t.PolygonBoundingBoxData);if(t.DataParser.VERTICES in e){var s=this._armature.scale,r=e[t.DataParser.VERTICES],n=i.vertices;t.DragonBones.webAssembly?n.resize(r.length,0):n.length=r.length;for(var o=0,a=r.length;o<a;o+=2){var h=r[o]*s,l=r[o+1]*s;t.DragonBones.webAssembly?(n.set(o,h),n.set(o+1,l)):(n[o]=h,n[o+1]=l),0===o?(i.x=h,i.y=l,i.width=h,i.height=l):(h<i.x?i.x=h:h>i.width&&(i.width=h),l<i.y?i.y=l:l>i.height&&(i.height=l))}i.width-=i.x,i.height-=i.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return i},s.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);if(i.frameCount=Math.max(s._getNumber(e,t.DataParser.DURATION,1),1),i.playTimes=s._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=s._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=s._getNumber(e,t.DataParser.SCALE,1),i.name=s._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),i.frameIntOffset=this._frameIntArray.length,i.frameFloatOffset=this._frameFloatArray.length,i.frameOffset=this._frameArray.length,this._animation=i,t.DataParser.FRAME in e){var r=e[t.DataParser.FRAME],n=r.length;if(n>0)for(var o=0,a=0;o<n;++o){var h=r[o];this._parseActionDataInFrame(h,a,null,null),a+=s._getNumber(h,t.DataParser.DURATION,1)}}if(t.DataParser.Z_ORDER in e&&(this._animation.zOrderTimeline=this._parseTimeline(e[t.DataParser.Z_ORDER],null,t.DataParser.FRAME,1,!1,!1,0,this._parseZOrderFrame)),t.DataParser.BONE in e)for(var l=0,c=e[t.DataParser.BONE];l<c.length;l++){var u=c[l];this._parseBoneTimeline(u)}if(t.DataParser.SURFACE in e)for(var d=0,_=e[t.DataParser.SURFACE];d<_.length;d++){u=_[d];var p=s._getString(u,t.DataParser.NAME,"");this._surface=this._armature.getBone(p),null!==this._surface&&(null!==(E=this._parseTimeline(u,null,t.DataParser.FRAME,50,!1,!0,0,this._parseSurfaceFrame))&&this._animation.addSurfaceTimeline(this._surface,E),this._surface=null)}if(t.DataParser.SLOT in e)for(var m=0,g=e[t.DataParser.SLOT];m<g.length;m++)u=g[m],this._parseSlotTimeline(u);if(t.DataParser.FFD in e)for(var f=0,y=e[t.DataParser.FFD];f<y.length;f++){u=y[f];var b=s._getString(u,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME),v=s._getString(u,t.DataParser.SLOT,""),S=s._getString(u,t.DataParser.NAME,"");0===b.length&&(b=t.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(v),this._mesh=this._armature.getMesh(b,v,S),null!==this._slot&&null!==this._mesh&&(null!==(E=this._parseTimeline(u,null,t.DataParser.FRAME,22,!1,!0,0,this._parseSlotFFDFrame))&&this._animation.addSlotTimeline(this._slot,E),this._slot=null,this._mesh=null)}if(t.DataParser.IK in e)for(var T=0,w=e[t.DataParser.IK];T<w.length;T++){u=w[T];var x=s._getString(u,t.DataParser.NAME,""),C=this._armature.getConstraint(x);null!==C&&null!==(E=this._parseTimeline(u,null,t.DataParser.FRAME,30,!0,!1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(C,E)}if(t.DataParser.ANIMATION in e)for(var A=0,D=e[t.DataParser.ANIMATION];A<D.length;A++){u=D[A];var E,I=s._getString(u,t.DataParser.NAME,"");null!==(E=this._parseTimeline(u,null,t.DataParser.FRAME,40,!0,!1,2,this._parseAnimationFrame))&&this._animation.addAnimationTimeline(I,E)}return this._actionFrames.length>0&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,!1,!1,0,this._parseActionFrame),this._actionFrames.length=0),this._animation=null,i},s.prototype._parseTimeline=function(e,r,n,o,a,h,l,c){if(null!==e&&n.length>0&&n in e&&(r=e[n]),null===r)return null;var u=r.length;if(0===u)return null;var d=this._frameIntArray.length,_=this._frameFloatArray.length,p=t.BaseObject.borrowObject(t.TimelineData),m=this._timelineArray.length;if(this._timelineArray.length+=5+u,null!==e?(this._timelineArray[m+0]=Math.round(100*s._getNumber(e,t.DataParser.SCALE,1)),this._timelineArray[m+1]=Math.round(100*s._getNumber(e,t.DataParser.OFFSET,0))):(this._timelineArray[m+0]=100,this._timelineArray[m+1]=0),this._timelineArray[m+2]=u,this._timelineArray[m+3]=l,this._timelineArray[m+4]=a?d-this._animation.frameIntOffset:h?_-this._animation.frameFloatOffset:0,this._timeline=p,p.type=o,p.offset=m,1===u)p.frameIndicesOffset=-1,this._timelineArray[m+5+0]=c.call(this,r[0],0,0)-this._animation.frameOffset;else{var g=this._animation.frameCount+1,f=this._data.frameIndices,y=0;t.DragonBones.webAssembly?(y=f.size(),f.resize(y+g,0)):(y=f.length,f.length+=g),p.frameIndicesOffset=y;for(var b=0,v=0,S=0,T=0;b<g;++b){if(S+T<=b&&v<u){var w=r[v];S=b,T=v===u-1?this._animation.frameCount-S:w instanceof i?this._actionFrames[v+1].frameStart-S:s._getNumber(w,t.DataParser.DURATION,1),this._timelineArray[m+5+v]=c.call(this,w,S,T)-this._animation.frameOffset,v++}t.DragonBones.webAssembly?f.set(y+b,v-1):f[y+b]=v-1}}return this._timeline=null,p},s.prototype._parseBoneTimeline=function(e){var i,r=this._armature.getBone(s._getString(e,t.DataParser.NAME,""));null!==r&&(this._bone=r,this._slot=this._armature.getSlot(this._bone.name),t.DataParser.TRANSLATE_FRAME in e&&null!==(i=this._parseTimeline(e,null,t.DataParser.TRANSLATE_FRAME,11,!1,!0,2,this._parseBoneTranslateFrame))&&this._animation.addBoneTimeline(r,i),t.DataParser.ROTATE_FRAME in e&&null!==(i=this._parseTimeline(e,null,t.DataParser.ROTATE_FRAME,12,!1,!0,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(r,i),t.DataParser.SCALE_FRAME in e&&null!==(i=this._parseTimeline(e,null,t.DataParser.SCALE_FRAME,13,!1,!0,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(r,i),t.DataParser.FRAME in e&&null!==(i=this._parseTimeline(e,null,t.DataParser.FRAME,10,!1,!0,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(r,i),this._bone=null,this._slot=null)},s.prototype._parseSlotTimeline=function(e){var i=this._armature.getSlot(s._getString(e,t.DataParser.NAME,""));if(null!==i){this._slot=i;var r;null!==(r=t.DataParser.DISPLAY_FRAME in e?this._parseTimeline(e,null,t.DataParser.DISPLAY_FRAME,20,!1,!1,0,this._parseSlotDisplayFrame):this._parseTimeline(e,null,t.DataParser.FRAME,20,!1,!1,0,this._parseSlotDisplayFrame))&&this._animation.addSlotTimeline(i,r);var n;null!==(n=t.DataParser.COLOR_FRAME in e?this._parseTimeline(e,null,t.DataParser.COLOR_FRAME,21,!0,!1,1,this._parseSlotColorFrame):this._parseTimeline(e,null,t.DataParser.FRAME,21,!0,!1,1,this._parseSlotColorFrame))&&this._animation.addSlotTimeline(i,n),this._slot=null}},s.prototype._parseFrame=function(t,e){var i=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[i+0]=e,i},s.prototype._parseTweenFrame=function(e,i,r){var n=this._parseFrame(e,i,r);if(r>0)if(t.DataParser.CURVE in e){var o=r+1;this._helpArray.length=o,this._samplingEasingCurve(e[t.DataParser.CURVE],this._helpArray),this._frameArray.length+=2+this._helpArray.length,this._frameArray[n+1]=2,this._frameArray[n+2]=o;for(var a=0;a<o;++a)this._frameArray[n+3+a]=Math.round(1e4*this._helpArray[a])}else{var h=-2;t.DataParser.TWEEN_EASING in e&&(h=s._getNumber(e,t.DataParser.TWEEN_EASING,-2)),-2===h?(this._frameArray.length+=1,this._frameArray[n+1]=0):0===h?(this._frameArray.length+=1,this._frameArray[n+1]=1):h<0?(this._frameArray.length+=2,this._frameArray[n+1]=3,this._frameArray[n+2]=Math.round(100*-h)):h<=1?(this._frameArray.length+=2,this._frameArray[n+1]=4,this._frameArray[n+2]=Math.round(100*h)):(this._frameArray.length+=2,this._frameArray[n+1]=5,this._frameArray[n+2]=Math.round(100*h-100))}else this._frameArray.length+=1,this._frameArray[n+1]=0;return n},s.prototype._parseActionFrame=function(t,e){var i=this._frameArray.length,s=t.actions.length;this._frameArray.length+=2+s,this._frameArray[i+0]=e,this._frameArray[i+0+1]=s;for(var r=0;r<s;++r)this._frameArray[i+0+2+r]=t.actions[r];return i},s.prototype._parseZOrderFrame=function(e,i,s){var r=this._parseFrame(e,i,s);if(t.DataParser.Z_ORDER in e){var n=e[t.DataParser.Z_ORDER];if(n.length>0){for(var o=this._armature.sortedSlots.length,a=new Array(o-n.length/2),h=new Array(o),l=0;l<a.length;++l)a[l]=0;for(var c=0;c<o;++c)h[c]=-1;for(var u=0,d=0,_=0,p=n.length;_<p;_+=2){for(var m=n[_],g=n[_+1];u!==m;)a[d++]=u++;h[u+g]=u++}for(;u<o;)a[d++]=u++;this._frameArray.length+=1+o,this._frameArray[r+1]=o;for(var f=o;f--;)-1===h[f]?this._frameArray[r+2+f]=a[--d]||0:this._frameArray[r+2+f]=h[f]||0;return r}}return this._frameArray.length+=1,this._frameArray[r+1]=0,r},s.prototype._parseBoneAllFrame=function(e,i,r){this._helpTransform.identity(),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],this._helpTransform,1);var n=this._helpTransform.rotation;0!==i&&(0===this._prevClockwise?n=this._prevRotation+t.Transform.normalizeRadian(n-this._prevRotation):((this._prevClockwise>0?n>=this._prevRotation:n<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),n=this._prevRotation+n-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=s._getNumber(e,t.DataParser.TWEEN_ROTATE,0),this._prevRotation=n;var o=this._parseTweenFrame(e,i,r),a=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[a++]=this._helpTransform.x,this._frameFloatArray[a++]=this._helpTransform.y,this._frameFloatArray[a++]=n,this._frameFloatArray[a++]=this._helpTransform.skew,this._frameFloatArray[a++]=this._helpTransform.scaleX,this._frameFloatArray[a++]=this._helpTransform.scaleY,this._parseActionDataInFrame(e,i,this._bone,this._slot),o},s.prototype._parseBoneTranslateFrame=function(e,i,r){var n=this._parseTweenFrame(e,i,r),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=s._getNumber(e,t.DataParser.X,0),this._frameFloatArray[o++]=s._getNumber(e,t.DataParser.Y,0),n},s.prototype._parseBoneRotateFrame=function(e,i,r){var n=s._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD;0!==i&&(0===this._prevClockwise?n=this._prevRotation+t.Transform.normalizeRadian(n-this._prevRotation):((this._prevClockwise>0?n>=this._prevRotation:n<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),n=this._prevRotation+n-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=s._getNumber(e,t.DataParser.CLOCK_WISE,0),this._prevRotation=n;var o=this._parseTweenFrame(e,i,r),a=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[a++]=n,this._frameFloatArray[a++]=s._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD,o},s.prototype._parseBoneScaleFrame=function(e,i,r){var n=this._parseTweenFrame(e,i,r),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=s._getNumber(e,t.DataParser.X,1),this._frameFloatArray[o++]=s._getNumber(e,t.DataParser.Y,1),n},s.prototype._parseSurfaceFrame=function(e,i,r){var n=this._frameFloatArray.length,o=this._parseTweenFrame(e,i,r),a=e[t.DataParser.VERTICES],h=s._getNumber(e,t.DataParser.OFFSET,0),l=this._surface.vertices.length/2,c=0,u=0;this._frameFloatArray.length+=2*l;for(var d=0;d<2*l;d+=2)c=d<h||d-h>=a.length?0:a[d-h],u=d+1<h||d+1-h>=a.length?0:a[d+1-h],this._frameFloatArray[n+d]=c,this._frameFloatArray[n+d+1]=u;if(0===i){var _=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[_+0]=0,this._frameIntArray[_+1]=this._frameFloatArray.length-n,this._frameIntArray[_+2]=this._frameFloatArray.length-n,this._frameIntArray[_+3]=0,this._frameIntArray[_+4]=n-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=_-this._animation.frameIntOffset}return o},s.prototype._parseSlotDisplayFrame=function(e,i,r){var n=this._parseFrame(e,i,r);return this._frameArray.length+=1,t.DataParser.VALUE in e?this._frameArray[n+1]=s._getNumber(e,t.DataParser.VALUE,0):this._frameArray[n+1]=s._getNumber(e,t.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(e,i,this._slot.parent,this._slot),n},s.prototype._parseSlotColorFrame=function(e,i,s){var r=this._parseTweenFrame(e,i,s),n=-1;if(t.DataParser.VALUE in e||t.DataParser.COLOR in e){var o=t.DataParser.VALUE in e?e[t.DataParser.VALUE]:e[t.DataParser.COLOR];for(var a in o){this._parseColorTransform(o,this._helpColorTransform),n=this._intArray.length,this._intArray.length+=8,this._intArray[n++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._intArray[n++]=Math.round(100*this._helpColorTransform.redMultiplier),this._intArray[n++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._intArray[n++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._intArray[n++]=Math.round(this._helpColorTransform.alphaOffset),this._intArray[n++]=Math.round(this._helpColorTransform.redOffset),this._intArray[n++]=Math.round(this._helpColorTransform.greenOffset),this._intArray[n++]=Math.round(this._helpColorTransform.blueOffset),n-=8;break}}n<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=n=this._intArray.length,this._intArray.length+=8,this._intArray[n++]=100,this._intArray[n++]=100,this._intArray[n++]=100,this._intArray[n++]=100,this._intArray[n++]=0,this._intArray[n++]=0,this._intArray[n++]=0,this._intArray[n++]=0),n=this._defaultColorOffset);var h=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[h]=n,r},s.prototype._parseSlotFFDFrame=function(e,i,r){var n=this._frameFloatArray.length,o=this._parseTweenFrame(e,i,r),a=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:null,h=s._getNumber(e,t.DataParser.OFFSET,0),l=this._intArray[this._mesh.vertices.offset+0],c=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,u=this._mesh.vertices.weight,d=0,_=0,p=0,m=0;if(null!==u){var g=this._weightSlotPose[c];this._helpMatrixA.copyFromArray(g,0),this._frameFloatArray.length+=2*u.count,p=u.offset+2+u.bones.length}else this._frameFloatArray.length+=2*l;for(var f=0;f<2*l;f+=2)if(null===a?(d=0,_=0):(d=f<h||f-h>=a.length?0:a[f-h],_=f+1<h||f+1-h>=a.length?0:a[f+1-h]),null!==u){var y=this._weightBonePoses[c],b=this._intArray[p++];this._helpMatrixA.transformPoint(d,_,this._helpPoint,!0),d=this._helpPoint.x,_=this._helpPoint.y;for(var v=0;v<b;++v){var S=this._intArray[p++];this._helpMatrixB.copyFromArray(y,7*S+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(d,_,this._helpPoint,!0),this._frameFloatArray[n+m++]=this._helpPoint.x,this._frameFloatArray[n+m++]=this._helpPoint.y}}else this._frameFloatArray[n+f]=d,this._frameFloatArray[n+f+1]=_;if(0===i){var T=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[T+0]=this._mesh.vertices.offset,this._frameIntArray[T+1]=this._frameFloatArray.length-n,this._frameIntArray[T+2]=this._frameFloatArray.length-n,this._frameIntArray[T+3]=0,this._frameIntArray[T+4]=n-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=T-this._animation.frameIntOffset}return o},s.prototype._parseIKConstraintFrame=function(e,i,r){var n=this._parseTweenFrame(e,i,r),o=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[o++]=s._getBoolean(e,t.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[o++]=Math.round(100*s._getNumber(e,t.DataParser.WEIGHT,1)),n},s.prototype._parseAnimationFrame=function(e,i,r){var n=this._parseTweenFrame(e,i,r),o=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[o++]=s._getNumber(e,t.DataParser.VALUE,0),this._frameIntArray[o++]=Math.round(100*s._getNumber(e,t.DataParser.WEIGHT,1)),n},s.prototype._parseActionData=function(e,i,r,n){var o=new Array;if("string"==typeof e)(c=t.BaseObject.borrowObject(t.ActionData)).type=i,c.name=e,c.bone=r,c.slot=n,o.push(c);else if(e instanceof Array)for(var a=0,h=e;a<h.length;a++){var l=h[a],c=t.BaseObject.borrowObject(t.ActionData);if(t.DataParser.GOTO_AND_PLAY in l?(c.type=0,c.name=s._getString(l,t.DataParser.GOTO_AND_PLAY,"")):(t.DataParser.TYPE in l&&"string"==typeof l[t.DataParser.TYPE]?c.type=t.DataParser._getActionType(l[t.DataParser.TYPE]):c.type=s._getNumber(l,t.DataParser.TYPE,i),c.name=s._getString(l,t.DataParser.NAME,"")),t.DataParser.BONE in l){var u=s._getString(l,t.DataParser.BONE,"");c.bone=this._armature.getBone(u)}else c.bone=r;if(t.DataParser.SLOT in l){var d=s._getString(l,t.DataParser.SLOT,"");c.slot=this._armature.getSlot(d)}else c.slot=n;var _=null;if(t.DataParser.INTS in l){null===_&&(_=t.BaseObject.borrowObject(t.UserData));for(var p=0,m=l[t.DataParser.INTS];p<m.length;p++){var g=m[p];_.addInt(g)}}if(t.DataParser.FLOATS in l){null===_&&(_=t.BaseObject.borrowObject(t.UserData));for(var f=0,y=l[t.DataParser.FLOATS];f<y.length;f++)g=y[f],_.addFloat(g)}if(t.DataParser.STRINGS in l){null===_&&(_=t.BaseObject.borrowObject(t.UserData));for(var b=0,v=l[t.DataParser.STRINGS];b<v.length;b++)g=v[b],_.addString(g)}c.data=_,o.push(c)}return o},s.prototype._parseTransform=function(e,i,r){i.x=s._getNumber(e,t.DataParser.X,0)*r,i.y=s._getNumber(e,t.DataParser.Y,0)*r,t.DataParser.ROTATE in e||t.DataParser.SKEW in e?(i.rotation=t.Transform.normalizeRadian(s._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(s._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD)):(t.DataParser.SKEW_X in e||t.DataParser.SKEW_Y in e)&&(i.rotation=t.Transform.normalizeRadian(s._getNumber(e,t.DataParser.SKEW_Y,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(s._getNumber(e,t.DataParser.SKEW_X,0)*t.Transform.DEG_RAD)-i.rotation),i.scaleX=s._getNumber(e,t.DataParser.SCALE_X,1),i.scaleY=s._getNumber(e,t.DataParser.SCALE_Y,1)},s.prototype._parseColorTransform=function(e,i){i.alphaMultiplier=.01*s._getNumber(e,t.DataParser.ALPHA_MULTIPLIER,100),i.redMultiplier=.01*s._getNumber(e,t.DataParser.RED_MULTIPLIER,100),i.greenMultiplier=.01*s._getNumber(e,t.DataParser.GREEN_MULTIPLIER,100),i.blueMultiplier=.01*s._getNumber(e,t.DataParser.BLUE_MULTIPLIER,100),i.alphaOffset=s._getNumber(e,t.DataParser.ALPHA_OFFSET,0),i.redOffset=s._getNumber(e,t.DataParser.RED_OFFSET,0),i.greenOffset=s._getNumber(e,t.DataParser.GREEN_OFFSET,0),i.blueOffset=s._getNumber(e,t.DataParser.BLUE_OFFSET,0)},s.prototype._parseArray=function(){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0},s.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0);var e=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,i=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,s=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,r=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,n=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,o=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,a=e+i+s+r+n+o;if(t.DragonBones.webAssembly){for(var h=t.webAssemblyModule.HEAP16.buffer,l=t.webAssemblyModule._malloc(a),c=new Int16Array(h,l,this._intArray.length),u=new Float32Array(h,l+e,this._floatArray.length),d=new Int16Array(h,l+e+i,this._frameIntArray.length),_=new Float32Array(h,l+e+i+s,this._frameFloatArray.length),p=new Int16Array(h,l+e+i+s+r,this._frameArray.length),m=new Uint16Array(h,l+e+i+s+r+n,this._timelineArray.length),g=0,f=this._intArray.length;g<f;++g)c[g]=this._intArray[g];for(g=0,f=this._floatArray.length;g<f;++g)u[g]=this._floatArray[g];for(g=0,f=this._frameIntArray.length;g<f;++g)d[g]=this._frameIntArray[g];for(g=0,f=this._frameFloatArray.length;g<f;++g)_[g]=this._frameFloatArray[g];for(g=0,f=this._frameArray.length;g<f;++g)p[g]=this._frameArray[g];for(g=0,f=this._timelineArray.length;g<f;++g)m[g]=this._timelineArray[g];t.webAssemblyModule.setDataBinary(this._data,l,e,i,s,r,n,o)}else{var y=new ArrayBuffer(a);for(c=new Int16Array(y,0,this._intArray.length),u=new Float32Array(y,e,this._floatArray.length),d=new Int16Array(y,e+i,this._frameIntArray.length),_=new Float32Array(y,e+i+s,this._frameFloatArray.length),p=new Int16Array(y,e+i+s+r,this._frameArray.length),m=new Uint16Array(y,e+i+s+r+n,this._timelineArray.length),g=0,f=this._intArray.length;g<f;++g)c[g]=this._intArray[g];for(g=0,f=this._floatArray.length;g<f;++g)u[g]=this._floatArray[g];for(g=0,f=this._frameIntArray.length;g<f;++g)d[g]=this._frameIntArray[g];for(g=0,f=this._frameFloatArray.length;g<f;++g)_[g]=this._frameFloatArray[g];for(g=0,f=this._frameArray.length;g<f;++g)p[g]=this._frameArray[g];for(g=0,f=this._timelineArray.length;g<f;++g)m[g]=this._timelineArray[g];this._data.binary=y,this._data.intArray=c,this._data.floatArray=u,this._data.frameIntArray=d,this._data.frameFloatArray=_,this._data.frameArray=p,this._data.timelineArray=m}this._defaultColorOffset=-1},s.prototype.parseDragonBonesData=function(e,i){void 0===i&&(i=1),console.assert(null!=e,"Data error.");var r=s._getString(e,t.DataParser.VERSION,""),n=s._getString(e,t.DataParser.COMPATIBLE_VERSION,"");if(t.DataParser.DATA_VERSIONS.indexOf(r)>=0||t.DataParser.DATA_VERSIONS.indexOf(n)>=0){var o=t.BaseObject.borrowObject(t.DragonBonesData);if(o.version=r,o.name=s._getString(e,t.DataParser.NAME,""),o.frameRate=s._getNumber(e,t.DataParser.FRAME_RATE,24),0===o.frameRate&&(o.frameRate=24),t.DataParser.ARMATURE in e){this._data=o,this._parseArray(e);for(var a=0,h=e[t.DataParser.ARMATURE];a<h.length;a++){var l=h[a];o.addArmature(this._parseArmature(l,i))}this._data.binary||this._modifyArray(),t.DataParser.STAGE in e?o.stage=o.getArmature(s._getString(e,t.DataParser.STAGE,"")):o.armatureNames.length>0&&(o.stage=o.getArmature(o.armatureNames[0])),this._data=null}return t.DataParser.TEXTURE_ATLAS in e&&(this._rawTextureAtlases=e[t.DataParser.TEXTURE_ATLAS]),o}return console.assert(!1,"Nonsupport data version: "+r+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},s.prototype.parseTextureAtlasData=function(e,i,r){if(void 0===r&&(r=1),console.assert(void 0!==e),null===e){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var n=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(n,i,r),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(i.width=s._getNumber(e,t.DataParser.WIDTH,0),i.height=s._getNumber(e,t.DataParser.HEIGHT,0),i.scale=1===r?1/s._getNumber(e,t.DataParser.SCALE,1):r,i.name=s._getString(e,t.DataParser.NAME,""),i.imagePath=s._getString(e,t.DataParser.IMAGE_PATH,""),t.DataParser.SUB_TEXTURE in e)for(var o=e[t.DataParser.SUB_TEXTURE],a=0,h=o.length;a<h;++a){var l=o[a],c=i.createTexture();c.rotated=s._getBoolean(l,t.DataParser.ROTATED,!1),c.name=s._getString(l,t.DataParser.NAME,""),c.region.x=s._getNumber(l,t.DataParser.X,0),c.region.y=s._getNumber(l,t.DataParser.Y,0),c.region.width=s._getNumber(l,t.DataParser.WIDTH,0),c.region.height=s._getNumber(l,t.DataParser.HEIGHT,0);var u=s._getNumber(l,t.DataParser.FRAME_WIDTH,-1),d=s._getNumber(l,t.DataParser.FRAME_HEIGHT,-1);u>0&&d>0&&(c.frame=t.TextureData.createRectangle(),c.frame.x=s._getNumber(l,t.DataParser.FRAME_X,0),c.frame.y=s._getNumber(l,t.DataParser.FRAME_Y,0),c.frame.width=u,c.frame.height=d),i.addTexture(c)}return!0},s.getInstance=function(){return null===s._objectDataParserInstance&&(s._objectDataParserInstance=new s),s._objectDataParserInstance},s._objectDataParserInstance=null,s}(t.DataParser);t.ObjectDataParser=e;var i=function(){this.frameStart=0,this.actions=[]};t.ActionFrame=i}(s4),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return i4(i,e),i.prototype._inRange=function(t,e,i){return e<=t&&t<=i},i.prototype._decodeUTF8=function(t){for(var e,i=0,s="",r=0,n=0,o=0,a=0;t.length>i;){var h=t[i++];if(-1===h)e=0!==n?65533:-1;else if(0===n)this._inRange(h,0,127)?e=h:(this._inRange(h,194,223)?(n=1,a=128,r=h-192):this._inRange(h,224,239)?(n=2,a=2048,r=h-224):this._inRange(h,240,244)&&(n=3,a=65536,r=h-240),r*=Math.pow(64,n),e=null);else if(this._inRange(h,128,191))if(o+=1,r+=(h-128)*Math.pow(64,n-o),o!==n)e=null;else{var l=r,c=a;r=0,n=0,o=0,a=0,e=this._inRange(l,c,1114111)&&!this._inRange(l,55296,57343)?l:h}else r=0,n=0,o=0,a=0,i--,e=h;null!==e&&-1!==e&&(e<=65535?e>0&&(s+=String.fromCharCode(e)):(e-=65536,s+=String.fromCharCode(55296+(e>>10&1023)),s+=String.fromCharCode(56320+(1023&e))))}return s},i.prototype._getUTF16Key=function(t){for(var e=0,i=t.length;e<i;++e)if(t.charCodeAt(e)>255)return encodeURI(t);return t},i.prototype._parseBinaryTimeline=function(e,i,s){void 0===s&&(s=null);var r=null!==s?s:t.BaseObject.borrowObject(t.TimelineData);r.type=e,r.offset=i,this._timeline=r;var n=this._timelineArrayBuffer[r.offset+2];if(1===n)r.frameIndicesOffset=-1;else{var o=0,a=this._animation.frameCount+1,h=this._data.frameIndices;t.DragonBones.webAssembly?(o=h.size(),h.resize(o+a,0)):(o=h.length,h.length+=a),r.frameIndicesOffset=o;for(var l=0,c=0,u=0,d=0;l<a;++l)u+d<=l&&c<n&&(u=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[r.offset+5+c]],d=c===n-1?this._animation.frameCount-u:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[r.offset+5+c+1]]-u,c++),t.DragonBones.webAssembly?h.set(o+l,c-1):h[o+l]=c-1}return this._timeline=null,r},i.prototype._parseVertices=function(e,i){i.offset=e[t.DataParser.OFFSET];var s=this._intArrayBuffer[i.offset+3];if(s>=0){var r=t.BaseObject.borrowObject(t.WeightData),n=this._intArrayBuffer[i.offset+0],o=this._intArrayBuffer[s+0];r.offset=s;for(var a=0;a<o;++a){var h=this._intArrayBuffer[s+2+a];r.addBone(this._rawBones[h])}for(var l=s+2+o,c=0,u=(a=0,n);a<u;++a){var d=this._intArrayBuffer[l++];c+=d,l+=d}r.count=c,i.weight=r}},i.prototype._parseMesh=function(t,e){this._parseVertices(t,e.vertices)},i.prototype._parsePath=function(t,e){this._parseVertices(t,e.vertices)},i.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);i.frameCount=Math.max(t.ObjectDataParser._getNumber(e,t.DataParser.DURATION,1),1),i.playTimes=t.ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=t.ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=t.ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),i.name=t.ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME);var s=e[t.DataParser.OFFSET];if(i.frameIntOffset=s[0],i.frameFloatOffset=s[1],i.frameOffset=s[2],this._animation=i,t.DataParser.ACTION in e&&(i.actionTimeline=this._parseBinaryTimeline(0,e[t.DataParser.ACTION])),t.DataParser.Z_ORDER in e&&(i.zOrderTimeline=this._parseBinaryTimeline(1,e[t.DataParser.Z_ORDER])),t.DataParser.BONE in e){var r=e[t.DataParser.BONE];for(var n in r){var o=r[n];t.DragonBones.webAssembly&&(n=this._getUTF16Key(n));var a=this._armature.getBone(n);if(null!==a)for(var h=0,l=o.length;h<l;h+=2){var c=o[h],u=o[h+1],d=this._parseBinaryTimeline(c,u);this._animation.addBoneTimeline(a,d)}}}if(t.DataParser.SURFACE in e)for(var n in r=e[t.DataParser.SURFACE]){o=r[n],t.DragonBones.webAssembly&&(n=this._getUTF16Key(n));var _=this._armature.getBone(n);if(null!==_)for(h=0,l=o.length;h<l;h+=2)c=o[h],u=o[h+1],d=this._parseBinaryTimeline(c,u),this._animation.addSurfaceTimeline(_,d)}if(t.DataParser.SLOT in e)for(var n in r=e[t.DataParser.SLOT]){o=r[n],t.DragonBones.webAssembly&&(n=this._getUTF16Key(n));var p=this._armature.getSlot(n);if(null!==p)for(h=0,l=o.length;h<l;h+=2)c=o[h],u=o[h+1],d=this._parseBinaryTimeline(c,u),this._animation.addSlotTimeline(p,d)}if(t.DataParser.CONSTRAINT in e)for(var n in r=e[t.DataParser.CONSTRAINT]){o=r[n],t.DragonBones.webAssembly&&(n=this._getUTF16Key(n));var m=this._armature.getConstraint(n);if(null!==m)for(h=0,l=o.length;h<l;h+=2)c=o[h],u=o[h+1],d=this._parseBinaryTimeline(c,u),this._animation.addConstraintTimeline(m,d)}if(t.DataParser.ANIMATION in e)for(var n in r=e[t.DataParser.ANIMATION])for(o=r[n],t.DragonBones.webAssembly&&(n=this._getUTF16Key(n)),h=0,l=o.length;h<l;h+=2)c=o[h],u=o[h+1],d=this._parseBinaryTimeline(c,u),this._animation.addAnimationTimeline(n,d);return this._animation=null,i},i.prototype._parseArray=function(e){var i=e[t.DataParser.OFFSET],s=i[1],r=i[3],n=i[5],o=i[7],a=i[9],h=i[11],l=new Int16Array(this._binary,this._binaryOffset+i[0],s/Int16Array.BYTES_PER_ELEMENT),c=new Float32Array(this._binary,this._binaryOffset+i[2],r/Float32Array.BYTES_PER_ELEMENT),u=new Int16Array(this._binary,this._binaryOffset+i[4],n/Int16Array.BYTES_PER_ELEMENT),d=new Float32Array(this._binary,this._binaryOffset+i[6],o/Float32Array.BYTES_PER_ELEMENT),_=new Int16Array(this._binary,this._binaryOffset+i[8],a/Int16Array.BYTES_PER_ELEMENT),p=new Uint16Array(this._binary,this._binaryOffset+i[10],h/Uint16Array.BYTES_PER_ELEMENT);if(t.DragonBones.webAssembly){for(var m=s+r+n+o+a+h,g=t.webAssemblyModule._malloc(m),f=new Uint8Array(this._binary,this._binaryOffset,m/Uint8Array.BYTES_PER_ELEMENT),y=new Uint8Array(t.webAssemblyModule.HEAP16.buffer,g,f.length),b=0,v=f.length;b<v;++b)y[b]=f[b];t.webAssemblyModule.setDataBinary(this._data,g,s,r,n,o,a,h),this._intArrayBuffer=l,this._floatArrayBuffer=c,this._frameIntArrayBuffer=u,this._frameFloatArrayBuffer=d,this._frameArrayBuffer=_,this._timelineArrayBuffer=p}else this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=l,this._data.floatArray=this._floatArrayBuffer=c,this._data.frameIntArray=this._frameIntArrayBuffer=u,this._data.frameFloatArray=this._frameFloatArrayBuffer=d,this._data.frameArray=this._frameArrayBuffer=_,this._data.timelineArray=this._timelineArrayBuffer=p},i.prototype.parseDragonBonesData=function(t,i){void 0===i&&(i=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var s=new Uint8Array(t,0,8);if(s[0]!=="D".charCodeAt(0)||s[1]!=="B".charCodeAt(0)||s[2]!=="D".charCodeAt(0)||s[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var r=new Uint32Array(t,8,1)[0],n=new Uint8Array(t,12,r),o=this._decodeUTF8(n),a=JSON.parse(o);return this._binaryOffset=12+r,this._binary=t,e.prototype.parseDragonBonesData.call(this,a,i)},i.getInstance=function(){return null===i._binaryDataParserInstance&&(i._binaryDataParserInstance=new i),i._binaryDataParserInstance},i._binaryDataParserInstance=null,i}(t.ObjectDataParser);t.BinaryDataParser=e}(s4),function(t){var e=function(){function e(i){void 0===i&&(i=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,this._dataParser=null,null===e._objectParser&&(e._objectParser=new t.ObjectDataParser),null===e._binaryParser&&(e._binaryParser=new t.BinaryDataParser),this._dataParser=null!==i?i:e._objectParser}return e.prototype._isSupportMesh=function(){return!0},e.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var i=0,s=this._textureAtlasDataMap[t];i<s.length;i++)if(null!==(h=(a=s[i]).getTexture(e)))return h;if(this.autoSearch)for(var r in this._textureAtlasDataMap)for(var n=0,o=this._textureAtlasDataMap[r];n<o.length;n++){var a,h;if((a=o[n]).autoSearch&&null!==(h=a.getTexture(e)))return h}return null},e.prototype._fillBuildArmaturePackage=function(t,e,i,s,r){var n=null,o=null;if(e.length>0&&e in this._dragonBonesDataMap&&(o=(n=this._dragonBonesDataMap[e]).getArmature(i)),null===o&&(0===e.length||this.autoSearch))for(var a in this._dragonBonesDataMap)if(n=this._dragonBonesDataMap[a],(0===e.length||n.autoSearch)&&null!==(o=n.getArmature(i))){e=a;break}if(null!==o){if(t.dataName=e,t.textureAtlasName=r,t.data=n,t.armature=o,t.skin=null,s.length>0&&(t.skin=o.getSkin(s),null===t.skin&&this.autoSearch))for(var a in this._dragonBonesDataMap){var h=this._dragonBonesDataMap[a].getArmature(s);if(null!==h){t.skin=h.defaultSkin;break}}return null===t.skin&&(t.skin=o.defaultSkin),!0}return!1},e.prototype._buildBones=function(e,i){for(var s=0,r=e.armature.sortedBones;s<r.length;s++){var n=r[s];t.BaseObject.borrowObject(0===n.type?t.Bone:t.Surface).init(n,i)}},e.prototype._buildSlots=function(e,i){var s=e.skin,r=e.armature.defaultSkin;if(null!==s&&null!==r){var n={};for(var o in r.displays){var a=r.getDisplays(o);n[o]=a}if(s!==r)for(var o in s.displays)a=s.getDisplays(o),n[o]=a;for(var h=0,l=e.armature.sortedSlots;h<l.length;h++){var c=l[h],u=c.name in n?n[c.name]:null,d=this._buildSlot(e,c,i);if(d.rawDisplayDatas=u,null!==u){for(var _=new Array,p=0,m=t.DragonBones.webAssembly?u.size():u.length;p<m;++p){var g=t.DragonBones.webAssembly?u.get(p):u[p];null!==g?_.push(this._getSlotDisplay(e,g,null,d)):_.push(null)}d._setDisplayList(_)}d._setDisplayIndex(c.displayIndex,!0)}}},e.prototype._buildConstraints=function(e,i){var s=e.armature.constraints;for(var r in s){var n=s[r];switch(n.type){case 0:var o=t.BaseObject.borrowObject(t.IKConstraint);o.init(n,i),i._addConstraint(o);break;case 1:var a=t.BaseObject.borrowObject(t.PathConstraint);a.init(n,i),i._addConstraint(a);break;default:var h=t.BaseObject.borrowObject(t.IKConstraint);h.init(n,i),i._addConstraint(h)}}},e.prototype._buildChildArmature=function(t,e,i){return this.buildArmature(i.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},e.prototype._getSlotDisplay=function(e,i,s,r){var n=null!==e?e.dataName:i.parent.parent.parent.name,o=null;switch(i.type){case 0:var a=i;null!==e&&e.textureAtlasName.length>0&&(a.texture=this._getTextureData(e.textureAtlasName,i.path)),null===a.texture&&(a.texture=this._getTextureData(n,i.path)),o=null!==s&&2===s.type&&this._isSupportMesh()?r.meshDisplay:r.rawDisplay;break;case 2:var h=i;null!==e&&e.textureAtlasName.length>0&&(h.texture=this._getTextureData(e.textureAtlasName,h.path)),null===h.texture&&(h.texture=this._getTextureData(n,h.path)),o=this._isSupportMesh()?r.meshDisplay:r.rawDisplay;break;case 1:var l=i,c=this._buildChildArmature(e,r,i);if(null!==c){if(c.inheritAnimation=l.inheritAnimation,!c.inheritAnimation){var u=l.actions.length>0?l.actions:c.armatureData.defaultActions;if(u.length>0)for(var d=0,_=u;d<_.length;d++){var p=_[d],m=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(p,m,r.armature),m.slot=r,r.armature._bufferAction(m,!1)}else c.animation.play()}l.armature=c.armatureData}o=c}return o},e.prototype.parseDragonBonesData=function(t,i,s){void 0===i&&(i=null),void 0===s&&(s=1);for(var r=t instanceof ArrayBuffer?e._binaryParser:this._dataParser,n=r.parseDragonBonesData(t,s);;){var o=this._buildTextureAtlasData(null,null);if(!r.parseTextureAtlasData(null,o,s)){o.returnToPool();break}this.addTextureAtlasData(o,i)}return null!==n&&this.addDragonBonesData(n,i),n},e.prototype.parseTextureAtlasData=function(t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=1);var r=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,r,s),this._buildTextureAtlasData(r,e||null),this.addTextureAtlasData(r,i),r},e.prototype.updateTextureAtlasData=function(t,e){var i=this.getTextureAtlasData(t);if(null!==i)for(var s=0,r=i.length;s<r;++s)s<e.length&&this._buildTextureAtlasData(i[s],e[s])},e.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},e.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),(e=null!==e?e:t.name)in this._dragonBonesDataMap){if(this._dragonBonesDataMap[e]===t)return;console.warn("Can not add same name data: "+e)}else this._dragonBonesDataMap[e]=t},e.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},e.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},e.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null);var i=(e=null!==e?e:t.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];i.indexOf(t)<0&&i.push(t)},e.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var i=this._textureAtlasDataMap[t];if(e)for(var s=0,r=i;s<r.length;s++){var n=r[s];this._dragonBones.bufferObject(n)}delete this._textureAtlasDataMap[t]}},e.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var s=new i;return this._fillBuildArmaturePackage(s,e,t,"","")?s.armature:null},e.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var i=0,s=this._textureAtlasDataMap[e];i<s.length;i++){var r=s[i];this._dragonBones.bufferObject(r)}delete this._textureAtlasDataMap[e]}},e.prototype.buildArmature=function(t,e,s,r){void 0===e&&(e=""),void 0===s&&(s=""),void 0===r&&(r="");var n=new i;if(!this._fillBuildArmaturePackage(n,e||"",t,s||"",r||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;var o=this._buildArmature(n);return this._buildBones(n,o),this._buildSlots(n,o),this._buildConstraints(n,o),o.invalidUpdate(null,!0),o.advanceTime(0),o},e.prototype.replaceDisplay=function(e,i,s){void 0===s&&(s=-1),s<0&&(s=e.displayIndex),s<0&&(s=0),e.replaceDisplayData(i,s);var r=e.displayList;if(r.length<=s){r.length=s+1;for(var n=0,o=r.length;n<o;++n)r[n]||(r[n]=null)}if(null!==i){var a=e.rawDisplayDatas,h=null;a&&(t.DragonBones.webAssembly?s<a.size()&&(h=a.get(s)):s<a.length&&(h=a[s])),r[s]=this._getSlotDisplay(null,i,h,e)}else r[s]=null;e.displayList=r},e.prototype.replaceSlotDisplay=function(t,e,i,s,r,n){void 0===n&&(n=-1);var o=this.getArmatureData(e,t||"");if(!o||!o.defaultSkin)return!1;var a=o.defaultSkin.getDisplay(i,s);return!!a&&(this.replaceDisplay(r,a,n),!0)},e.prototype.replaceSlotDisplayList=function(e,i,s,r){var n=this.getArmatureData(i,e||"");if(!n||!n.defaultSkin)return!1;var o=n.defaultSkin.getDisplays(s);if(!o)return!1;for(var a=0,h=0,l=t.DragonBones.webAssembly?o.size():o.length;h<l;++h){var c=t.DragonBones.webAssembly?o.get(h):o[h];this.replaceDisplay(r,c,a++)}return!0},e.prototype.replaceSkin=function(e,i,s,r){void 0===s&&(s=!1),void 0===r&&(r=null);for(var n=!1,o=i.parent.defaultSkin,a=0,h=e.getSlots();a<h.length;a++){var l=h[a];if(!(null!==r&&r.indexOf(l.name)>=0)){var c=i.getDisplays(l.name);if(c||(null!==o&&i!==o&&(c=o.getDisplays(l.name)),c)){var u=t.DragonBones.webAssembly?c.size():c.length,d=l.displayList;d.length=u;for(var _=0,p=u;_<p;++_){var m=t.DragonBones.webAssembly?c.get(_):c[_];d[_]=null!==m?this._getSlotDisplay(null,m,null,l):null}n=!0,l.rawDisplayDatas=c,l.displayList=d}else s&&(l.rawDisplayDatas=null,l.displayList=[])}}return n},e.prototype.replaceAnimation=function(e,i,s){void 0===s&&(s=!0);var r=i.defaultSkin;if(null===r)return!1;if(s)e.animation.animations=i.animations;else{var n=e.animation.animations,o={};for(var a in n)o[a]=n[a];for(var a in i.animations)o[a]=i.animations[a];e.animation.animations=o}for(var h=0,l=e.getSlots();h<l.length;h++)for(var c=l[h],u=0,d=0,_=c.displayList;d<_.length;d++){var p=_[d];if(p instanceof t.Armature){var m=r.getDisplays(c.name);if(null!==m&&u<(t.DragonBones.webAssembly?m.size():m.length)){var g=t.DragonBones.webAssembly?m.get(u):m[u];if(null!==g&&1===g.type){var f=this.getArmatureData(g.path,g.parent.parent.parent.name);f&&this.replaceAnimation(p,f,s)}}}u++}return!0},e.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},e.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(e.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),e.prototype.changeSkin=function(t,e,i){return void 0===i&&(i=null),this.replaceSkin(t,e,!1,i)},e.prototype.copyAnimationsToArmature=function(t,e,i,s,r){void 0===s&&(s=""),void 0===r&&(r=!0);var n=this.getArmatureData(e,s);return!!n&&this.replaceAnimation(t,n,r)},e._objectParser=null,e._binaryParser=null,e}();t.BaseFactory=e;var i=function(){this.dataName="",this.textureAtlasName="",this.skin=null};t.BuildArmaturePackage=i}(s4),function(t){t.BinaryOffset={WeigthBoneCount:0,WeigthFloatOffset:1,WeigthBoneIndices:2,MeshVertexCount:0,MeshTriangleCount:1,MeshFloatOffset:2,MeshWeightOffset:3,MeshVertexIndices:4,TimelineScale:0,TimelineOffset:1,TimelineKeyFrameCount:2,TimelineFrameValueCount:3,TimelineFrameValueOffset:4,TimelineFrameOffset:5,FramePosition:0,FrameTweenType:1,FrameTweenEasingOrCurveSampleCount:2,FrameCurveSamples:3,DeformMeshOffset:0,DeformCount:1,DeformValueCount:2,DeformValueOffset:3,DeformFloatOffset:4},t.ArmatureType={Armature:0,MovieClip:1,Stage:2},t.BoneType={Bone:0,Surface:1},t.DisplayType={Image:0,Armature:1,Mesh:2,BoundingBox:3},t.BoundingBoxType={Rectangle:0,Ellipse:1,Polygon:2},t.ActionType={Play:0,Stop:1,GotoAndPlay:2,GotoAndStop:3,FadeIn:4,FadeOut:5,Frame:10,Sound:11},t.BlendMode={Normal:0,Add:1,Alpha:2,Darken:3,Difference:4,Erase:5,HardLight:6,Invert:7,Layer:8,Lighten:9,Multiply:10,Overlay:11,Screen:12,Subtract:13},t.TweenType={None:0,Line:1,Curve:2,QuadIn:3,QuadOut:4,QuadInOut:5},t.TimelineType={Action:0,ZOrder:1,BoneAll:10,BoneTranslate:11,BoneRotate:12,BoneScale:13,Surface:50,SlotDisplay:20,SlotColor:21,SlotFFD:22,IKConstraint:30,AnimationTime:40,AnimationWeight:41}}(s4);const r4=s4.DragonBones,n4=s4.BaseObject,o4=s4.Matrix,a4=s4.DisplayData,h4=s4.TextureAtlasData,l4=s4.TextureData,c4=s4.Armature,u4=s4.Slot,d4=s4.Animation,_4=s4.EventObject,p4=s4.BaseFactory,m4=s4.BinaryOffset,g4=s4.BoneType;var f4,y4;const{ccclass:b4}=il;let v4=b4("dragonBones.CCTextureAtlasData")(f4=class extends h4{constructor(...t){super(...t),this._renderTexture=null}get renderTexture(){return this._renderTexture}set renderTexture(t){if(this._renderTexture=t,t)for(const e in this.textures){const i=this.textures[e];if(!i.spriteFrame){let e=null;i.rotated?e=new Wr(i.region.x,i.region.y,i.region.height,i.region.width):(e=new Wr(i.region.x,i.region.y,i.region.width,i.region.height),i.spriteFrame=new yD,i.spriteFrame.texture=t,i.spriteFrame.rect=e)}}else for(const t in this.textures)this.textures[t].spriteFrame=null}static toString(){return"[class dragonBones.CCTextureAtlasData]"}createTexture(){return n4.borrowObject(S4)}_onClear(){super._onClear(),this.renderTexture=null}})||f4,S4=b4("dragonBones.CCTextureData")(y4=class extends l4{constructor(...t){super(...t),this.spriteFrame=null}static toString(){return"[class dragonBones.CCTextureData]"}_onClear(){super._onClear(),this.spriteFrame=null}})||y4;var T4;const{ccclass:w4}=il;let x4=w4("dragonBones.CCSlot")(T4=class extends u4{static toString(){return"[class dragonBones.CCSlot]"}constructor(){super(),this._localVertices=void 0,this._indices=void 0,this._matrix=void 0,this._worldMatrix=void 0,this._worldMatrixDirty=void 0,this._color=void 0,this._localVertices=[],this._indices=[],this._matrix=new vr,this._worldMatrix=new vr,this._worldMatrixDirty=!0,this._visible=!1,this._color=new Ls}getTexture(){return this._textureData?this._textureData.spriteFrame.texture:null}calculWorldMatrix(){const t=this._armature._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):vr.copy(this._worldMatrix,this._matrix),this._worldMatrixDirty=!1}_onClear(){super._onClear(),this._localVertices.length=0,this._indices.length=0,vr.identity(this._matrix),vr.identity(this._worldMatrix),this._worldMatrixDirty=!0,this._color=new Ls,this._visible=!1}_onUpdateDisplay(){}_initDisplay(t){}_addDisplay(){this._visible=!0}_replaceDisplay(t){}_removeDisplay(){this._visible=!1}_disposeDisplay(t){}_updateVisible(){this._visible=this.parent.visible}_updateGlueMesh(){}_updateZOrder(){}_updateBlendMode(){if(this._childArmature){const t=this._childArmature.getSlots();for(let e=0,i=t.length;e<i;e++){const i=t[e];i._blendMode=this._blendMode,i._updateBlendMode()}}}_updateColor(){const t=this._color;t.r=255*this._colorTransform.redMultiplier,t.g=255*this._colorTransform.greenMultiplier,t.b=255*this._colorTransform.blueMultiplier,t.a=255*this._colorTransform.alphaMultiplier}_updateFrame(){this._indices.length=0;const t=this._indices,e=this._localVertices;let i=0,s=0;const r=this._textureData;if(!this._display||this._displayIndex<0||!r||!r.spriteFrame)return;const n=r.spriteFrame.texture,o=n.width,a=n.height,h=r.region;if(0===o||0===a)return void console.error(`SpriteFrame ${r.spriteFrame.name} incorrect size ${o} x ${a}`);const l=null!==this._deformVertices&&this._display===this._meshDisplay?this._deformVertices.verticesData:null;if(l){const r=l.data,n=r.intArray,c=r.floatArray,u=n[l.offset+m4.MeshVertexCount],d=n[l.offset+m4.MeshTriangleCount];let _=n[l.offset+m4.MeshFloatOffset];_<0&&(_+=65536);const p=_+2*u,m=this._armature._armatureData.scale;for(let t=0,i=2*u;t<i;t+=2)e[s++]=c[_+t]*m,e[s++]=-c[_+t+1]*m,l.rotated?(e[s++]=(h.x+(1-c[p+t])*h.width)/o,e[s++]=(h.y+c[p+t+1]*h.height)/a):(e[s++]=(h.x+c[p+t]*h.width)/o,e[s++]=(h.y+c[p+t+1]*h.height)/a);for(let e=0;e<3*d;++e)t[i++]=n[l.offset+m4.MeshVertexIndices+e];e.length=s,t.length=i,l.weight&&this._identityTransform()}else{const i=h.x/o,r=(h.y+h.height)/a,n=(h.x+h.width)/o,l=h.y/a;e[s++]=0,e[s++]=0,e[s++]=i,e[s++]=r,e[s++]=h.width,e[s++]=0,e[s++]=n,e[s++]=r,e[s++]=0,e[s++]=h.height,e[s++]=i,e[s++]=l,e[s++]=h.width,e[s++]=h.height,e[s++]=n,e[s++]=l,t[0]=0,t[1]=1,t[2]=2,t[3]=1,t[4]=3,t[5]=2,e.length=s,t.length=6}this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0}_updateMesh(){const t=this._armature._armatureData.scale,e=this._deformVertices.vertices,i=this._deformVertices.bones,s=this._deformVertices.verticesData,r=s.weight,n=e.length>0&&s.inheritDeform,o=this._localVertices;if(r){const a=s.data,h=a.intArray,l=a.floatArray,c=h[s.offset+m4.MeshVertexCount];let u=h[r.offset+m4.WeigthFloatOffset];u<0&&(u+=65536);for(let s=0,a=r.offset+m4.WeigthBoneIndices+i.length,d=u,_=0,p=0;s<c;s++,p+=4){const s=h[a++];let r=0,c=0;for(let o=0;o<s;++o){const s=i[h[a++]];if(null!==s){const i=s.globalTransformMatrix,o=l[d++];let a=l[d++]*t,h=l[d++]*t;n&&(a+=e[_++],h+=e[_++]),r+=(i.a*a+i.c*h+i.tx)*o,c+=(i.b*a+i.d*h+i.ty)*o}}o[p]=r,o[p+1]=-c}}else if(n){const i=this._parent._boneData.type!==g4.Bone,r=s.data,n=r.intArray,a=r.floatArray,h=n[s.offset+m4.MeshVertexCount];let l=n[s.offset+m4.MeshFloatOffset];l<0&&(l+=65536);for(let s=0,r=h,n=0;s<r;s++,n+=4){const r=a[l+2*s]*t+e[2*s],h=a[l+2*s+1]*t+e[2*s+1];if(i){const t=this._parent._getGlobalTransformMatrix(r,h);o[n]=t.a*r+t.c*h+t.tx,o[n+1]=-t.b*r+t.d*h+t.ty}else o[n]=r,o[n+1]=-h}}r&&this._identityTransform()}_identityTransform(){const t=this._matrix;t.m00=1,t.m01=0,t.m04=-0,t.m05=-1,t.m12=0,t.m13=0,this._worldMatrixDirty=!0}_updateTransform(){const t=this._matrix;t.m00=this.globalTransformMatrix.a,t.m01=this.globalTransformMatrix.b,t.m04=-this.globalTransformMatrix.c,t.m05=-this.globalTransformMatrix.d,this._childArmature?(t.m12=this.globalTransformMatrix.tx,t.m13=this.globalTransformMatrix.ty):(t.m12=this.globalTransformMatrix.tx-(this.globalTransformMatrix.a*this._pivotX-this.globalTransformMatrix.c*this._pivotY),t.m13=this.globalTransformMatrix.ty-(this.globalTransformMatrix.b*this._pivotX-this.globalTransformMatrix.d*this._pivotY)),this._worldMatrixDirty=!0}updateWorldMatrix(){if(!this._armature)return;const t=this._armature._parent;if(t&&t.updateWorldMatrix(),this._worldMatrixDirty){this.calculWorldMatrix();const t=this.childArmature;if(!t)return;const e=t.getSlots();for(let t=0,i=e.length;t<i;t++){const i=e[t];i&&(i._worldMatrixDirty=!0)}}}_mulMat(t,e,i){const s=e.m00,r=e.m01,n=e.m04,o=e.m05,a=e.m12,h=e.m13,l=i.m00,c=i.m01,u=i.m04,d=i.m05,_=i.m12,p=i.m13;0!==r||0!==n?(t.m00=l*s+c*n,t.m01=l*r+c*o,t.m04=u*s+d*n,t.m05=u*r+d*o,t.m12=s*_+n*p+a,t.m13=r*_+o*p+h):(t.m00=l*s,t.m01=c*o,t.m04=u*s,t.m05=d*o,t.m12=s*_+a,t.m13=o*p+h)}})||T4;var C4;const{ccclass:A4}=il;let D4=A4("dragonBones.CCArmatureDisplay")(C4=class extends a4{get node(){return this}constructor(){super(),this.shouldAdvanced=!1,this._ccNode=null,this._ccComponent=null,this._eventTarget=void 0,this._armature=null,this._eventTarget=new zo}hasEvent(t){return M("Method not implemented."),!1}addEvent(t,e,i){M("Method not implemented.")}removeEvent(t,e,i){M("Method not implemented.")}setEventTarget(t){this._eventTarget=t}getRootDisplay(){let t,e=this._armature._parent;if(!e)return this;for(;e;)t=e,e=e._armature._parent;return t._armature.display}convertToRootSpace(t){const e=this._armature._parent;if(!e)return t;e.updateWorldMatrix();const i=e._worldMatrix,s=new Ms(0,0);return s.x=t.x*i.m00+t.y*i.m04+i.m12,s.y=t.x*i.m01+t.y*i.m05+i.m13,s}convertToWorldSpace(t){var e;const i=this.convertToRootSpace(t),s=this.getRootNode();return null==s||null==(e=s._getUITransformComp())?void 0:e.convertToWorldSpaceAR(i)}getRootNode(){const t=this.getRootDisplay();return t&&t._ccNode}dbInit(t){this._armature=t}dbClear(){this._armature=null}dbUpdate(){this._ccComponent&&this._ccComponent._markForUpdateRenderData()}advanceTimeBySelf(t){this.shouldAdvanced=!!t}hasDBEventListener(t){return this._eventTarget.hasEventListener(t)}addDBEventListener(t,e,i){this._eventTarget.on(t,e,i)}removeDBEventListener(t,e,i){this._eventTarget.off(t,e,i)}dispatchDBEvent(t,e){this._eventTarget.emit(t,e)}})||C4;var E4,I4;const{ccclass:M4}=il;let P4=M4("CCFactory")((I4=class t extends p4{static getInstance(){return t._factory||(t._factory=new t),t._factory}constructor(){super(),this.id=void 0,this.uuid=void 0,this._slots=void 0;const t=new D4;this._dragonBones=new r4(t),nC.getScheduler()&&(JA.on(QA.EVENT_RESTART,this.onRestart,this),this.initUpdate()),this.id=this.uuid="CCFactory"}onRestart(){t._factory=null}initUpdate(t){Uu.enableForTarget(this),nC.getScheduler().scheduleUpdate(this,200,!1)}update(t){this._dragonBones.advanceTime(t)}getDragonBonesDataByRawData(t){return(t instanceof ArrayBuffer?p4._binaryParser:this._dataParser).parseDragonBonesData(t,1)}buildArmatureDisplay(t,e,i,s){const r=this.buildArmature(t,e,i,s);return r?r._display:null}createArmatureNode(t,e,i){let s=(i=i||new tb).getComponent("dragonBones.ArmatureDisplay");return s||(s=i.addComponent("dragonBones.ArmatureDisplay")),i.name=e,s._armatureName=e,s._dragonAsset=t.dragonAsset,s._dragonAtlasAsset=t.dragonAtlasAsset,s._init(),s}_buildTextureAtlasData(t,e){return t?t.renderTexture=e:t=n4.borrowObject(v4),t}_sortSlots(){const t=this._slots,e=[];for(let i=0,s=t.length;i<s;i++){const s=t[i],r=s._zOrder;let n=!1;for(let t=e.length-1;t>=0;t--)if(r>=e[t]._zOrder){e.splice(t+1,0,s),n=!0;break}n||e.unshift(s)}this._slots=e}_buildArmature(t){const e=n4.borrowObject(c4);e._skinData=t.skin,e._animation=n4.borrowObject(d4),e._animation._armature=e,e._animation.animations=t.armature.animations,e._isChildArmature=!1;const i=new D4;return e.init(t.armature,i,i,this._dragonBones),e}_buildSlot(t,e,i){const s=n4.borrowObject(x4),r=s;return s.init(e,i,r,r),s}getDragonBonesDataByUUID(t){for(const e in this._dragonBonesDataMap)if(-1!==e.indexOf(t))return this._dragonBonesDataMap[e];return null}removeDragonBonesDataByUUID(t,e){void 0===e&&(e=!0);for(const i in this._dragonBonesDataMap)-1!==i.indexOf(t)&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[i]),delete this._dragonBonesDataMap[i])}},I4._factory=null,E4=I4))||E4;var O4;const R4=1/60,B4=[],F4=[];let N4,L4,k4=0,z4=0,U4=0,V4=null,j4=null,H4=0,G4=0,W4=0,X4=0,Y4=0,q4=class{constructor(){this.maxVertexCount=0,this.maxIndexCount=0,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this.isCompleted=!1,this._frameIdx=-1,this._armatureInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null}init(t,e){this._inited=!0,this._armatureInfo=t,this._animationName=e}clear(){this._inited=!1;for(let t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()}begin(){if(!this._invalid)return;const t=this._armatureInfo,e=t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame()),t.armature.animation.play(this._animationName,1),t.curAnimationCache=this,this._invalid=!1,this._frameIdx=-1,this.totalTime=0,this.isCompleted=!1}end(){this._needToUpdate()||(this._armatureInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0)}_needToUpdate(t){return!this._armatureInfo.armature.animation.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)}updateToFrame(t){if(!this._inited)return;if(this.begin(),!this._needToUpdate(t))return;const e=this._armatureInfo.armature;do{e.advanceTime(R4),this._frameIdx++,this.updateFrame(e,this._frameIdx),this.totalTime+=R4}while(this._needToUpdate(t));this.end()}isInited(){return this._inited}isInvalid(){return this._invalid}invalidAllFrame(){this.isCompleted=!1,this._invalid=!0}updateAllFrame(){this.invalidAllFrame(),this.updateToFrame()}enableCacheAttachedInfo(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())}updateFrame(t,e){U4=0,k4=0,z4=0,V4=null,j4=null,H4=0,G4=0,W4=0,X4=0,Y4=0,this.frames[e]=this.frames[e]||{segments:[],colors:[],boneInfos:[],vertices:new Float32Array,uintVert:new Uint32Array,indices:new Uint16Array};const i=this.frames[e],s=this._tempSegments=i.segments,r=this._tempColors=i.colors,n=this._tempBoneInfos=i.boneInfos;this._traverseArmature(t,1),X4>0&&(r[X4-1].vfOffset=U4),r.length=X4,n.length=k4;const o=W4-1;if(o>=0)if(G4>0){const t=s[o];t.indexCount=G4,t.vfCount=9*H4,t.vertexCount=H4,s.length=W4}else s.length=W4-1;if(0===s.length)return;let a=i.vertices;const h=U4/5,l=9*h;let c;(!a||a.length<U4)&&(a=i.vertices=new Float32Array(l));for(let t=0,e=0;t<l;)a[t]=B4[e++],a[t+1]=B4[e++],a[t+3]=B4[e++],a[t+4]=B4[e++],c=B4[e++],a[t+5]=(255&c)/255,a[t+6]=(c>>8&255)/255,a[t+7]=(c>>16&255)/255,a[t+8]=(c>>24&255)/255,t+=9;let u=i.indices;(!u||u.length<z4)&&(u=i.indices=new Uint16Array(z4));for(let t=0;t<z4;t++)u[t]=F4[t];i.vertices=a,i.indices=u,this.maxVertexCount=h>this.maxVertexCount?h:this.maxVertexCount,this.maxIndexCount=u.length>this.maxIndexCount?u.length:this.maxIndexCount}_traverseArmature(t,e){const i=this._tempColors,s=this._tempSegments,r=this._tempBoneInfos,n=t._slots;let o,a,h,l,c,u,d,_,p;const m=t._bones;if(this._enableCacheAttachedInfo)for(let t=0,e=m.length;t<e;t++,k4++){const e=m[t];let i=r[k4];i||(i=r[k4]={globalTransformMatrix:new o4});const s=e.globalTransformMatrix;i.globalTransformMatrix.copyFrom(s)}for(let t=0,r=n.length;t<r;t++)if(h=n[t],h._visible&&h._displayData)if(h.updateWorldMatrix(),c=h._color,h.childArmature)this._traverseArmature(h.childArmature,e*c.a/255);else if(d=h.getTexture(),d){V4===d.nativeUrl&&j4===h._blendMode||(V4=d.nativeUrl,j4=h._blendMode,_=W4-1,_>=0&&(G4>0?(p=s[_],p.indexCount=G4,p.vertexCount=H4,p.vfCount=9*H4):W4--),s[W4]={tex:d,blendMode:h._blendMode,indexCount:0,vertexCount:0,vfCount:0},W4++,G4=0,H4=0),u=(c.a*e<<24>>>0)+(c.b<<16)+(c.g<<8)+c.r,Y4!==u&&(Y4=u,X4>0&&(i[X4-1].vfOffset=U4),i[X4++]={r:c.r,g:c.g,b:c.b,a:c.a*e,vfOffset:0}),o=h._localVertices,a=h._indices,l=h._worldMatrix;for(let t=0,e=o.length;t<e;)N4=o[t++],L4=o[t++],B4[U4++]=N4*l.m00+L4*l.m04+l.m12,B4[U4++]=N4*l.m01+L4*l.m05+l.m13,B4[U4++]=o[t++],B4[U4++]=o[t++],B4[U4++]=u;for(let t=0,e=a.length;t<e;t++)F4[z4++]=H4+a[t];G4+=a.length,H4+=o.length/4}}};class $4{constructor(){this._privateMode=!1,this._animationPool={},this._armatureCache={}}enablePrivateMode(){this._privateMode=!0}dispose(){for(const t in this._armatureCache){const e=this._armatureCache[t];if(e){const t=e.armature;t&&t.dispose()}}this._armatureCache={},this._animationPool={}}_removeArmature(t){const e=this._armatureCache[t],i=e.animationsCache;for(const e in i){const s=i[e];s&&(this._animationPool[`${t}#${e}`]=s,s.clear())}const s=e.armature;s&&s.dispose(),delete this._armatureCache[t]}resetArmature(t){for(const e in this._armatureCache)-1!==e.indexOf(t)&&this._removeArmature(e)}getArmatureCache(t,e,i){const s=this._armatureCache[e];let r;if(s)r=s.armature;else{const s=P4.getInstance().buildArmatureDisplay(t,e,"",i);if(!s||!s._armature)return null;if(r=s._armature,!$4.canCache(r))return r.dispose(),null;this._armatureCache[e]={armature:r,animationsCache:{},curAnimationCache:null}}return r}getAnimationCache(t,e){const i=this._armatureCache[t];return i?i.animationsCache[e]:null}initAnimationCache(t,e){if(!e)return null;const i=this._armatureCache[t],s=i&&i.armature;if(!s)return null;if(!s.animation.hasAnimation(e))return null;const r=i.animationsCache;let n=r[e];if(!n){const s=`${t}#${e}`;n=this._animationPool[s],n?delete this._animationPool[s]:(n=new q4,n._privateMode=this._privateMode),n.init(i,e),r[e]=n}return n}invalidAnimationCache(t){const e=this._armatureCache[t];if(!e||!e.armature)return;const i=e.animationsCache;for(const t in i)i[t].invalidAllFrame()}updateAnimationCache(t,e){if(e){const i=this.initAnimationCache(t,e);if(!i)return;i.updateAllFrame()}else{const e=this._armatureCache[t];if(!e||!e.armature)return;const i=e.animationsCache;for(const t in i)i[t].updateAllFrame()}}static canCache(t){const e=t._slots;for(let t=0,i=e.length;t<i;t++)if(e[t].childArmature)return!1;return!0}}var K4,Z4,Q4;O4=$4,$4.FrameTime=R4,$4.sharedCache=new O4;const{ccclass:J4,serializable:t6}=il;let e6=J4("dragonBones.DragonBonesAsset")((Z4=class extends fm{get dragonBonesJson(){return this._dragonBonesJson}set dragonBonesJson(t){this._dragonBonesJson=t,this._dragonBonesJsonData=JSON.parse(t),this.reset()}constructor(t){super(t),this._dragonBonesJson=Q4&&Q4(),this._factory=null,this._dragonBonesJsonData=void 0,this._armaturesEnum=null,this.reset()}createNode(t){const e=new tb(this.name);return e.addComponent("dragonBones.ArmatureDisplay").dragonAsset=this,t(null,e)}reset(){this._clear()}init(t,e){this._factory=t||P4.getInstance(),!this._dragonBonesJsonData&&this.dragonBonesJson&&(this._dragonBonesJsonData=JSON.parse(this.dragonBonesJson));let i=null;if(i=this._dragonBonesJsonData?this._dragonBonesJsonData:this._nativeAsset,!this._uuid){const t=this._factory.getDragonBonesDataByRawData(i);t?this._uuid=t.name:M("dragonbones name is empty")}const s=`${this._uuid}#${e}`;return this._factory.getDragonBonesData(s)||this._factory.parseDragonBonesData(i instanceof ArrayBuffer?i:i.buffer instanceof ArrayBuffer?i.buffer:i,s),s}getArmatureEnum(){if(this._armaturesEnum)return this._armaturesEnum;this.init();const t=this._factory.getDragonBonesDataByUUID(this._uuid);if(t){const e=t.armatureNames,i={};for(let t=0;t<e.length;t++)i[e[t]]=t;return this._armaturesEnum=pe(i)}return null}getAnimsEnum(t){this.init();const e=this._factory.getDragonBonesDataByUUID(this._uuid);if(e){const i=e.getArmature(t);if(!i)return null;const s={"<None>":0},r=i.animations;let n=0;for(const t in r)r.hasOwnProperty(t)&&(s[t]=n+1,n++);return pe(s)}return null}destroy(){return this._clear(),super.destroy()}_clear(){this._factory&&($4.sharedCache.resetArmature(this._uuid),this._factory.removeDragonBonesDataByUUID(this._uuid,!0))}},Q4=Za(Z4.prototype,"_dragonBonesJson",[t6],(function(){return""})),K4=Z4))||K4;var i6,s6,r6,n6,o6,a6,h6,l6;a.internal.DragonBonesAsset=e6;const{ccclass:c6,serializable:u6,type:d6}=il;let _6=(i6=c6("dragonBones.DragonBonesAtlasAsset"),s6=d6(ff),i6((n6=class extends fm{constructor(){super(),this._atlasJson=o6&&o6(),this._texture=a6&&a6(),this._atlasJsonData=h6&&h6(),this._factory=null,this._textureAtlasData=l6&&l6(),this._clear()}get atlasJson(){return this._atlasJson}set atlasJson(t){this._atlasJson=t,this._atlasJsonData=JSON.parse(this.atlasJson),this._clear()}get texture(){return this._texture}set texture(t){this._texture=t,this._clear()}createNode(t){const e=new tb(this.name);return e.addComponent("dragonBones.ArmatureDisplay").dragonAtlasAsset=this,t(null,e)}init(t){this._factory=t,this._atlasJsonData||(this._atlasJsonData=JSON.parse(this.atlasJson));const e=this._atlasJsonData;this._uuid=this._uuid||e.name,this._textureAtlasData?t.addTextureAtlasData(this._textureAtlasData,this._uuid):this._textureAtlasData=t.parseTextureAtlasData(e,this.texture,this._uuid)}destroy(){return this._clear(),super.destroy()}_clear(){}},o6=Za(n6.prototype,"_atlasJson",[u6],(function(){return""})),a6=Za(n6.prototype,"_texture",[u6,s6],(function(){return null})),h6=Za(n6.prototype,"_atlasJsonData",[u6],(function(){return{}})),l6=Za(n6.prototype,"_textureAtlasData",[u6],(function(){return null})),r6=n6))||r6);var p6;a.internal.DragonBonesAtlasAsset=_6;const m6=new vr,{ccclass:g6}=il;let f6=g6("dragonBones.AttachUtil")(p6=class{constructor(){this._inited=!1,this._armature=null,this._armatureNode=null,this._armatureDisplay=null}init(t){this._inited=!0,this._armature=t._armature,this._armatureNode=t.node,this._armatureDisplay=t}reset(){this._inited=!1,this._armature=null,this._armatureNode=null,this._armatureDisplay=null}_syncAttachedNode(){if(!this._inited)return;this._armatureNode.worldMatrix;let t=null;const e=this._armatureDisplay.isAnimationCached();if(e&&this._armatureDisplay&&(t=this._armatureDisplay._curFrame&&this._armatureDisplay._curFrame.boneInfos,!t))return;const i=this._armatureDisplay.sockets,s=this._armatureDisplay.socketNodes,r=(t,e)=>{const i=m6;i.m00=e.a,i.m01=e.b,i.m04=-e.c,i.m05=-e.d,i.m12=e.tx,i.m13=e.ty,t.matrix=m6},n=this._armature.getBones();for(let o=i.length-1;o>=0;o--){const a=i[o],h=a.target;if(!h)continue;if(!h.isValid){s.delete(a.path),i.splice(o,1);continue}const l=e?t[a.boneIndex]:n[a.boneIndex];l&&r(h,l.globalTransformMatrix)}}})||p6;class y6 extends Bu{constructor(){super(),this._armatures=new Set}static getInstance(){return y6._instance||(y6._instance=new y6,nC.registerSystem(y6.ID,y6._instance,200)),y6._instance}add(t){t&&(this._armatures.has(t)||this._armatures.add(t))}remove(t){t&&this._armatures.has(t)&&this._armatures.delete(t)}postUpdate(t){this._armatures&&this._armatures.forEach((e=>{e.updateAnimation(t),e.syncAttachedNode()}))}prepareRenderData(){this._armatures&&this._armatures.forEach((t=>{t._markForUpdateRenderData()}))}}var b6,v6,S6,T6,w6,x6,C6,A6,D6,E6,I6,M6,P6,O6,R6,B6,F6,N6,L6,k6,z6,U6,V6,j6,H6,G6,W6,X6,Y6,q6;y6.ID="ARMATURE",y6._instance=void 0,a.internal.ArmatureSystem=y6;const $6={default:-1};fe($6);const K6={"<None>":0};fe(K6);const Z6={REALTIME:0};fe(Z6);const Q6={REALTIME:0,SHARED_CACHE:1,PRIVATE_CACHE:2};fe(Q6);const{ccclass:J6,serializable:t8,editable:e8,type:i8,help:s8,menu:r8,tooltip:n8,visible:o8,displayName:a8,override:h8,displayOrder:l8,executeInEditMode:c8}=il;let u8=(b6=J6("dragonBones.ArmatureDisplay.DragonBoneSocket"),v6=i8(tb),b6((T6=class{constructor(t="",e=null){this.path=w6&&w6(),this.target=x6&&x6(),this.boneIndex=null,this.path=t,this.target=e}},w6=Za(T6.prototype,"path",[t8],(function(){return""})),x6=Za(T6.prototype,"target",[v6,t8],(function(){return null})),S6=T6))||S6);Xt(u8,"dragonBones.ArmatureDisplay.DragonBoneSocket");let d8=(C6=J6("dragonBones.ArmatureDisplay"),A6=i8(e6),D6=i8(_6),E6=i8($6),I6=i8(K6),M6=i8([u8]),P6=i8(fv),C6((q6=class t extends uM{get dragonAsset(){return this._dragonAsset}set dragonAsset(t){this._dragonAsset=t,this.destroyRenderData(),this._refresh()}get dragonAtlasAsset(){return this._dragonAtlasAsset}set dragonAtlasAsset(t){this._dragonAtlasAsset=t,this._parseDragonAtlasAsset(),this._refresh()}get armatureName(){return this._armatureName}set armatureName(t){this._armatureName=t;const e=this.getAnimationNames(this._armatureName);(!this.animationName||e.indexOf(this.animationName)<0)&&(this.animationName=""),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature),this._refresh(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature)}get animationName(){return this._animationName}set animationName(t){this._animationName=t}get _defaultArmatureIndex(){return this._defaultArmatureIndexValue}set _defaultArmatureIndex(t){this._defaultArmatureIndexValue=t;let e="";if(this.dragonAsset){let t;if(this.dragonAsset&&(t=this.dragonAsset.getArmatureEnum()),!t)return void G(7400,this.name);e=t[this._defaultArmatureIndex]}void 0!==e?this.armatureName=e:G(7401,this.name),this._markForUpdateRenderData()}get _animationIndex(){return this._animationIndexValue}set _animationIndex(t){if(this._animationIndexValue=t,0===this._animationIndex)return void(this.animationName="");let e;if(this.dragonAsset&&(e=this.dragonAsset.getAnimsEnum(this.armatureName)),!e)return;const i=e[this._animationIndex];void 0!==i?this.playAnimation(i,this.playTimes):G(7402,this.name)}get _defaultCacheMode(){return this._defaultCacheModeValue}set _defaultCacheMode(t){if(this._defaultCacheModeValue=t,0!==this._defaultCacheMode&&this._armature&&!$4.canCache(this._armature))return this._defaultCacheMode=0,void M("Animation cache mode doesn't support skeletal nesting");this.setAnimationCacheMode(this._defaultCacheMode)}get timeScale(){return this._timeScale}set timeScale(t){this._timeScale=t,this._armature&&!this.isAnimationCached()&&(this._armature.animation.timeScale=this.timeScale)}get debugBones(){return this._debugBones}set debugBones(t){this._debugBones=t,this._updateDebugDraw()}get enableBatch(){return this._enableBatch}set enableBatch(t){t!==this._enableBatch&&(this._enableBatch=t,this._updateBatch())}get sockets(){return this._sockets}set sockets(t){this._verifySockets(t),this._sockets=t,this._updateSocketBindings(),t.length>0&&this._frameCache&&this._frameCache.enableCacheAttachedInfo()}get socketNodes(){return this._socketNodes}get drawList(){return this._drawList}requestDrawInfo(t){return this._drawInfoList[t]||(this._drawInfoList[t]=new mI),this._drawInfoList[t]}constructor(){super(),this.playTimes=B6&&B6(),this.premultipliedAlpha=F6&&F6(),this._armature=null,this.attachUtil=void 0,this._defaultArmatureIndexValue=N6&&N6(),this._dragonAsset=L6&&L6(),this._dragonAtlasAsset=k6&&k6(),this._armatureName=z6&&z6(),this._animationName=U6&&U6(),this._animationIndexValue=V6&&V6(),this._preCacheMode=-1,this._cacheMode=0,this._defaultCacheModeValue=j6&&j6(),this._timeScale=H6&&H6(),this._playTimes=G6&&G6(),this._debugBones=W6&&W6(),this._enableBatch=X6&&X6(),this._debugDraw=null,this._armatureKey="",this._accTime=0,this._playCount=0,this._frameCache=null,this._curFrame=null,this._playing=!1,this._armatureCache=null,this._eventTarget=void 0,this._factory=null,this._displayProxy=null,this._drawIdx=0,this._drawList=new So((()=>({material:null,texture:null,indexOffset:0,indexCount:0})),1),this.maxVertexCount=0,this.maxIndexCount=0,this._materialCache={},this._enumArmatures=pe({}),this._enumAnimations=pe({}),this._socketNodes=new Map,this._cachedSockets=new Map,this._sockets=Y6&&Y6(),this._inited=void 0,this._drawInfoList=[],this._cacheModeEnum=void 0,this._eventTarget=new zo,this._inited=!1,this.attachUtil=new f6,this.initFactory(),ri(this,"_animationIndex",this._enumAnimations),ri(this,"_defaultArmatureIndex",this._enumArmatures),this._useVertexOpacity=!0}initFactory(){this._factory=P4.getInstance()}onLoad(){super.onLoad()}_requestDrawData(t,e,i,s){const r=this._drawList.add();return r.material=t,r.texture=e,r.indexOffset=i,r.indexCount=s,r}destroyRenderData(){this._drawList.reset(),super.destroyRenderData()}getMaterialTemplate(){return null!==this.customMaterial?this.customMaterial:(this.material||this.updateMaterial(),this.material)}getMaterialForBlend(t,e){const i=`${t}/${e}`;let s=this._materialCache[i];if(s)return s;const r=this.getMaterialTemplate();return s=new BI({parent:r,subModelIdx:0,owner:this}),s.recompileShaders({TWO_COLORED:!1,USE_LOCAL:!1}),this._materialCache[i]=s,s.overridePipelineStates({blendState:{targets:[{blendSrc:t,blendDst:e}]}}),s}_updateBuiltinMaterial(){return iC.get("default-spine-material")}get customMaterial(){return this._customMaterial}set customMaterial(t){this._customMaterial=t,this.updateMaterial(),this._markForUpdateRenderData()}updateMaterial(){let t;t=this._customMaterial?this._customMaterial:this._updateBuiltinMaterial(),this.setSharedMaterial(t,0),this._cleanMaterialCache()}_render(t){let e=0;if(this.renderData&&this._drawList){const i=this.renderData,s=i.chunk,r=s.vertexAccessor,n=i.getMeshBuffer(),o=n.indexOffset;for(let i=0;i<this._drawList.length;i++){this._drawIdx=i;const s=this._drawList.data[i];s.texture&&t.commitMiddleware(this,n,o+s.indexOffset,s.indexCount,s.texture,s.material,this._enableBatch),e+=s.indexCount}const a=i.indices.subarray(0,e);r.appendIndices(s.bufferId,a)}}__preload(){super.__preload(),this._init()}_init(){if(this._cacheMode=this._defaultCacheMode,this._inited)return;this._inited=!0,this._parseDragonAtlasAsset(),this._refresh();const t=this.node.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];i&&"DEBUG_DRAW_NODE"===i.name&&i.destroy()}this._updateDebugDraw(),this._indexBoneSockets(),this._updateSocketBindings()}getArmatureKey(){return this._armatureKey}setAnimationCacheMode(t){this._preCacheMode!==t&&(this._cacheMode=t,this._buildArmature(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature),this._updateSocketBindings(),this._markForUpdateRenderData())}isAnimationCached(){return 0!==this._cacheMode}onEnable(){super.onEnable(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature),this._flushAssembler(),y6.getInstance().add(this)}onDisable(){super.onDisable(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature),y6.getInstance().remove(this)}_emitCacheCompleteEvent(){this._eventTarget.emit(_4.LOOP_COMPLETE),this._eventTarget.emit(_4.COMPLETE)}updateAnimation(t){if(this._markForUpdateRenderData(),!this.isAnimationCached())return;if(!this._frameCache)return;const e=this._frameCache;if(!e.isInited())return;const i=e.frames;if(!this._playing)return void(e.isInvalid()&&(e.updateToFrame(),this._curFrame=i[i.length-1],this.renderData&&(this.renderData.vertexCount<e.maxVertexCount||this.renderData.indexCount<e.maxIndexCount)&&(this.maxVertexCount=e.maxVertexCount>this.maxVertexCount?e.maxVertexCount:this.maxVertexCount,this.maxIndexCount=e.maxIndexCount>this.maxIndexCount?e.maxIndexCount:this.maxIndexCount,this.renderData.resize(this.maxVertexCount,this.maxIndexCount),(!this.renderData.indices||this.maxIndexCount>this.renderData.indices.length)&&(this.renderData.indices=new Uint16Array(this.maxIndexCount)))));const s=$4.FrameTime;0===this._accTime&&0===this._playCount&&this._eventTarget.emit(_4.START),this._accTime+=t*this.timeScale*1;let r=Math.floor(this._accTime/s);if(e.isCompleted||(e.updateToFrame(r),this.renderData&&(this.renderData.vertexCount<e.maxVertexCount||this.renderData.indexCount<e.maxIndexCount)&&(this.maxVertexCount=e.maxVertexCount>this.maxVertexCount?e.maxVertexCount:this.maxVertexCount,this.maxIndexCount=e.maxIndexCount>this.maxIndexCount?e.maxIndexCount:this.maxIndexCount,this.renderData.resize(this.maxVertexCount,this.maxIndexCount),(!this.renderData.indices||this.maxIndexCount>this.renderData.indices.length)&&(this.renderData.indices=new Uint16Array(this.maxIndexCount)))),e.isCompleted&&r>=i.length){if(this._playCount++,this.playTimes>0&&this._playCount>=this.playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playing=!1,this._playCount=0,this._emitCacheCompleteEvent(),void this.attachUtil._syncAttachedNode();this._accTime=0,r=0,this._emitCacheCompleteEvent()}this._curFrame=i[r],this.attachUtil._syncAttachedNode()}onDestroy(){this._materialInstances=this._materialInstances.filter((t=>!!t)),this._inited=!1,2===this._cacheMode?(this._armatureCache.dispose(),this._armatureCache=null,this._armature=null):1===this._cacheMode?(this._armatureCache=null,this._armature=null):this._armature&&(this._armature.dispose(),this._armature=null),this._drawList.destroy(),super.onDestroy()}_updateDebugDraw(){if(this.debugBones){if(!this._debugDraw){let t,e=new tb("DEBUG_DRAW_NODE");e.hideFlags|=1032;try{t=e.addComponent("cc.Graphics"),t.lineWidth=1,t.strokeColor=new Ls(255,0,0,255),this._debugDraw=t,this._debugDraw.node.parent=this.node}catch(t){G(4501,t.message),e.destroy(),e=null}}}else this._debugDraw&&(this._debugDraw.node.parent=null);this._markForUpdateRenderData()}_updateBatch(){this._cleanMaterialCache(),this._markForUpdateRenderData()}_buildArmature(){if(!this.dragonAsset||!this.dragonAtlasAsset||!this.armatureName)return;this._armature&&(2===this._preCacheMode?this._armatureCache.dispose():0===this._preCacheMode&&this._armature.dispose(),this._armatureCache=null,this._armature=null,this._displayProxy=null,this._frameCache=null,this._curFrame=null,this._playing=!1,this._preCacheMode=-1),1===this._cacheMode?this._armatureCache=$4.sharedCache:2===this._cacheMode&&(this._armatureCache=new $4,this._armatureCache.enablePrivateMode());const t=this.dragonAtlasAsset._uuid;if(this._armatureKey=this.dragonAsset.init(this._factory,t),this.isAnimationCached()&&(this._armature=this._armatureCache.getArmatureCache(this.armatureName,this._armatureKey,t),this._armature||(this._cacheMode=0)),this._preCacheMode=this._cacheMode,0===this._cacheMode){if(this._displayProxy=this._factory.buildArmatureDisplay(this.armatureName,this._armatureKey,"",t),!this._displayProxy)return;this._displayProxy._ccNode=this.node,this._displayProxy._ccComponent=this,this._displayProxy.setEventTarget(this._eventTarget),this._armature=this._displayProxy._armature,this._armature.animation.timeScale=this.timeScale}if(0!==this._cacheMode&&this.debugBones&&M("Debug bones is invalid in cached mode"),this._armature){const t=this._armature.armatureData.aabb;this.node._getUITransformComp().setContentSize(t.width,t.height)}this.attachUtil.init(this),this.animationName&&this.playAnimation(this.animationName,this.playTimes),this._flushAssembler()}querySockets(){return this._armature?(0===this._cachedSockets.size&&this._indexBoneSockets(),Array.from(this._cachedSockets.keys()).sort()):[]}querySocketPathByName(t){const e=[];for(const i of this._cachedSockets.keys())i.endsWith(t)&&e.push(i);return e}_parseDragonAtlasAsset(){this.dragonAtlasAsset&&this.dragonAtlasAsset.init(this._factory)}_refresh(){this._buildArmature(),this._indexBoneSockets(),this._markForUpdateRenderData()}_updateCacheModeEnum(){this._cacheModeEnum=pe({}),this._armature?Object.assign(this._cacheModeEnum,Q6):Object.assign(this._cacheModeEnum,Z6),ri(this,"_defaultCacheMode",this._cacheModeEnum)}_updateAnimEnum(){let t;t=this.dragonAsset?this.dragonAsset.getAnimsEnum(this.armatureName):K6,this._enumAnimations=pe({}),Object.assign(this._enumAnimations,t||K6),pe.update(this._enumAnimations),ri(this,"_animationIndex",this._enumAnimations)}_updateArmatureEnum(){let t;t=this.dragonAsset?this.dragonAsset.getArmatureEnum():$6,this._enumArmatures=pe({}),Object.assign(this._enumArmatures,t||$6),pe.update(this._enumArmatures),ri(this,"_defaultArmatureIndex",this._enumArmatures)}_indexBoneSockets(){if(!this._armature)return;this._cachedSockets.clear();const t=this._cachedSockets,e=(t,i,s)=>{if(s.has(t))return s.get(t);const r=i[t];if(!r.parent)return s.set(t,r.name),r.path=r.name,r.name;const n=`${e(r.parent._boneIndex,i,s)}/${r.name}`;return s.set(t,n),r.path=n,n},i=(s,r)=>{const n=r.getBones(),o=new Map;for(let t=0;t<n.length;t++)n[t]._boneIndex=t;for(let t=0;t<n.length;t++)e(t,n,o);for(const e of o.keys())t.set(`${s}${o.get(e)}`,e);const a=r.getSlots();for(let t=0;t<a.length;t++)a[t].childArmature&&i(a[t].name,a[t].childArmature)};i("",this._armature)}playAnimation(t,e){if(this.playTimes=void 0===e?-1:e,this.animationName=t,this.isAnimationCached()){let e=this._armatureCache.getAnimationCache(this._armatureKey,t);e||(e=this._armatureCache.initAnimationCache(this._armatureKey,t)),e&&(this._accTime=0,this._playCount=0,this._frameCache=e,this._sockets.length>0&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._playing=!0,this._curFrame=this._frameCache.frames[0])}else if(this._armature)return this._armature.animation.play(t,this.playTimes);return this._markForUpdateRenderData(),null}updateAnimationCache(t){this.isAnimationCached()&&this._armatureCache.updateAnimationCache(this._armatureKey,t)}invalidAnimationCache(){this.isAnimationCached()&&this._armatureCache.invalidAnimationCache(this._armatureKey)}getArmatureNames(){const t=this._factory.getDragonBonesData(this._armatureKey);return t&&t.armatureNames||[]}getAnimationNames(t){const e=[],i=this._factory.getDragonBonesData(this._armatureKey);if(i){const s=i.getArmature(t);if(s)for(const t in s.animations)s.animations.hasOwnProperty(t)&&e.push(t)}return e}on(t,e,i){this.addEventListener(t,e,i)}off(t,e,i){this.removeEventListener(t,e,i)}once(t,e,i){this._eventTarget.once(t,e,i)}addEventListener(t,e,i){this._eventTarget.on(t,e,i)}removeEventListener(t,e,i){this._eventTarget.off(t,e,i)}buildArmature(t,e){return this._factory.createArmatureNode(this,t,e)}armature(){return this._armature}_flushAssembler(){const e=t.Assembler.getAssembler(this);this._assembler!==e&&(this._assembler=e),this._armature&&this._assembler&&(this._renderData=this._assembler.createData(this),this._renderData&&(this.maxVertexCount=this._renderData.vertexCount,this.maxIndexCount=this._renderData.indexCount),this._markForUpdateRenderData(),this._updateColor())}_updateSocketBindings(){if(this._armature){this._socketNodes.clear();for(let t=0,e=this._sockets.length;t<e;t++){const e=this._sockets[t];if(e.path&&e.target){const t=this._cachedSockets.get(e.path);if(!t){console.error(`Skeleton data does not contain path ${e.path}`);continue}e.boneIndex=t,this._socketNodes.set(e.path,e.target)}}}}_verifySockets(t){for(let e=0,i=t.length;e<i;e++){const i=t[e].target;!i||i.parent&&i.parent===this.node||console.error(`Target node ${i.name} is expected to be a direct child of ${this.node.name}`)}}_cleanMaterialCache(){for(const t in this._materialCache)this._materialCache[t].destroy();this._materialCache={}}createRenderEntity(){const t=new KI(1);return t.setUseLocal(!1),t}markForUpdateRenderData(t=!0){super._markForUpdateRenderData(t),this._debugDraw&&this._debugDraw._markForUpdateRenderData(t)}syncAttachedNode(){this.attachUtil._syncAttachedNode()}},q6.AnimationCacheMode=Q6,s((R6=q6).prototype,"dragonAsset",[A6],Object.getOwnPropertyDescriptor(R6.prototype,"dragonAsset"),R6.prototype),s(R6.prototype,"dragonAtlasAsset",[D6],Object.getOwnPropertyDescriptor(R6.prototype,"dragonAtlasAsset"),R6.prototype),s(R6.prototype,"_defaultArmatureIndex",[E6],Object.getOwnPropertyDescriptor(R6.prototype,"_defaultArmatureIndex"),R6.prototype),s(R6.prototype,"_animationIndex",[I6],Object.getOwnPropertyDescriptor(R6.prototype,"_animationIndex"),R6.prototype),s(R6.prototype,"timeScale",[t8],Object.getOwnPropertyDescriptor(R6.prototype,"timeScale"),R6.prototype),B6=Za(R6.prototype,"playTimes",[t8],(function(){return-1})),F6=Za(R6.prototype,"premultipliedAlpha",[t8],(function(){return!1})),s(R6.prototype,"sockets",[M6],Object.getOwnPropertyDescriptor(R6.prototype,"sockets"),R6.prototype),N6=Za(R6.prototype,"_defaultArmatureIndexValue",[t8],(function(){return-1})),L6=Za(R6.prototype,"_dragonAsset",[t8],(function(){return null})),k6=Za(R6.prototype,"_dragonAtlasAsset",[t8],(function(){return null})),z6=Za(R6.prototype,"_armatureName",[t8],(function(){return""})),U6=Za(R6.prototype,"_animationName",[t8],(function(){return""})),V6=Za(R6.prototype,"_animationIndexValue",[t8],(function(){return 0})),j6=Za(R6.prototype,"_defaultCacheModeValue",[t8],(function(){return 0})),H6=Za(R6.prototype,"_timeScale",[t8],(function(){return 1})),G6=Za(R6.prototype,"_playTimes",[t8],(function(){return-1})),W6=Za(R6.prototype,"_debugBones",[t8],(function(){return!1})),X6=Za(R6.prototype,"_enableBatch",[t8],(function(){return!1})),Y6=Za(R6.prototype,"_sockets",[t8],(function(){return[]})),s(R6.prototype,"customMaterial",[h8,P6],Object.getOwnPropertyDescriptor(R6.prototype,"customMaterial"),R6.prototype),O6=R6))||O6);a.internal.ArmatureDisplay=d8;const _8=new Ls(255,0,0,255),p8=new Ls(0,0,255,255),m8=new Ls(0,255,0,255);let g8,f8,y8,b8,v8,S8,T8,w8,x8,C8,A8=0,D8=0,E8=0,I8=0,M8=0,P8=0,O8=0,R8=0,B8=0;const F8=new Float32Array(4);let N8;const L8=new Ms(0,0,0),k8=new vr;let z8=null,U8=null;function V8(t,e){if(!t)return null;let i,s;switch(e){case 1:i=v8?1:2,s=1;break;case 10:i=7,s=4;break;case 12:i=1,s=8;break;default:i=v8?1:2,s=4}return C8.getMaterialForBlend(i,s)}function j8(t,e){const i=t.a*e*b8,s=v8?i/255:1,r=t.r*g8*s/255,n=t.g*f8*s/255,o=t.b*y8*s/255;F8[0]=r,F8[1]=n,F8[2]=o,F8[3]=v8?1:i/255}let H8=null;const G8=new class{constructor(){this.accessor=H8,this.vCount=32767}ensureAccessor(){if(!H8){const t=nC.root.device,e=nC.root.batcher2D,i=QE;this.accessor=H8=new dI(t,i,this.vCount),e.registerBufferAccessor(Number.parseInt("DRAGONBONES",36),H8)}return this.accessor}createData(t){let e=t.renderData;if(!e){this.ensureAccessor();const i=t._armature._slots;let s=0,r=0;for(let t=0;t<i.length;++t){const e=i[t],n=e._localVertices.length%4;s+=0===n?e._localVertices.length/4:(e._localVertices.length-n)/4+1,r+=e._indices.length}e=yI.add(QE,this.accessor),e.resize(s,r),e.indices&&r===e.indices.length||(e.indices=new Uint16Array(r))}return e}updateRenderData(t){C8=t,t._armature&&Y8(t)}updateColor(t){t&&(C8=t,C8._markForUpdateRenderData())}};function W8(t,e,i){const s=T8;if(!s)return;x8=s.chunk.vb,w8=s.indices;const r=t._slots;let n,o,a,h,l,c=0;for(let t=0,c=r.length;t<c;t++){if(l=r[t],h=l._color,!l._visible||!l._displayData)continue;if(i?vr.multiply(l._worldMatrix,i,l._matrix):vr.copy(l._worldMatrix,l._matrix),l.childArmature){W8(l.childArmature,h.a/255,l._worldMatrix);continue}if(n=V8(l.getTexture(),l._blendMode),!n)continue;z8||(z8=n);const c=l.getTexture();if(S8||n.hash!==z8.hash||c&&U8!==c){S8=!1;const t=P8-B8;t>0&&(C8._requestDrawData(z8,U8,B8,t),B8=P8),U8=c,z8=n}j8(h,e),k8.set(l._worldMatrix),o=l._localVertices,D8=o.length/4,A8=9*D8,a=l._indices,M8=a.length;let u=!1;if(E8+D8>O8&&(O8=E8+D8,u=!0),P8+M8>R8&&(R8=P8+M8,u=!0),u){const t=w8,e=s.chunk.vertexOffset;s.resizeAndCopy(O8,R8>s.indexCount?R8:s.indexCount),x8=s.chunk.vb,R8>w8.length&&(w8=s.indices=new Uint16Array(R8));const i=s.chunk.vertexOffset-e;for(let e=0;e<P8;++e)w8[e]=t[e]+i}for(let t=0,e=o.length,i=I8;t<e;i+=9)L8.x=o[t++],L8.y=o[t++],L8.z=0,L8.transformMat4(k8),x8[i]=L8.x,x8[i+1]=L8.y,x8[i+2]=L8.z,x8[i+3]=o[t++],x8[i+4]=o[t++],x8.set(F8,i+5);const d=s.chunk.vertexOffset;for(let t=0,e=a.length,i=P8;t<e;t++,i++)w8[i]=E8+a[t]+d;I8+=A8,E8+=D8,P8+=M8,D8=0,M8=0}c=P8-B8,U8&&c>0&&(C8._requestDrawData(z8,U8,B8,c),B8=P8),C8.maxIndexCount<R8&&(C8.maxIndexCount=R8),C8.maxVertexCount<O8&&(C8.maxVertexCount=O8)}function X8(t,e){if(!t)return;const i=t.segments,s=T8;if(0===i.length||!s)return;let r=null;const n=t.vertices,o=t.indices;let a=0,h=0,l=0,c=0,u=0;const d=t.colors;let _=d[u++],p=_.vfOffset;j8(_,1);const m=s.chunk.vb,g=s.indices;for(let t=0,f=i.length;t<f;t++){const f=i[t];if(r=V8(f.tex,f.blendMode),!r)continue;if(z8||(z8=r),S8||r.hash!==z8.hash||f.tex&&f.tex!==U8){S8=!1;const t=P8-B8;t>0&&(C8._requestDrawData(z8,U8,B8,t),B8=P8),z8=r,U8=f.tex}D8=f.vertexCount,M8=f.indexCount,a=s.chunk.vertexOffset;for(let t=P8,e=P8+M8;t<e;t++)g[t]=a+E8+o[l++];c=f.vfCount;const y=n.subarray(h,c);m.set(y,h);let b=0;if(e)for(let t=0,i=D8;t<i;t++)L8.x=m[b],L8.y=m[b+1],L8.z=0,L8.transformMat4(e),m[b]=L8.x,m[b+1]=L8.y,m[b+2]=L8.z,b+=9;if(1&N8){let t=h/9*5;for(let e=h,i=h+c;e<i;e+=9,t+=5)t>=p&&(_=d[u++],j8(_,1),p=_.vfOffset),m.set(F8,e+5)}h+=c,E8+=D8,P8+=M8,D8=0,M8=0}const f=P8-B8;U8&&f>0&&C8._requestDrawData(z8,U8,B8,f)}function Y8(t){const e=t._armature;if(!e||null===t.renderData)return;S8=!0,v8=t.premultipliedAlpha,t.drawList.reset(),C8=t,t.node,T8=t.renderData,C8=t,N8=0,z8=null;const i=t.color;g8=i.r/255,f8=i.g/255,y8=i.b/255,b8=t.node._uiProps.opacity,4294967295!==Ls.toUint32(i)&&(N8|=1);const s=t.node.getWorldMatrix();if(A8=0,E8=0,I8=0,M8=0,P8=0,B8=0,O8=C8.maxVertexCount,R8=C8.maxIndexCount,t.isAnimationCached())X8(t._curFrame,s);else{W8(e,1,s);const i=t._debugDraw;if(t.debugBones&&i){i.clear(),i.lineWidth=5,i.strokeColor=_8,i.fillColor=p8;const t=e.getBones();for(let e=0,s=t.length;e<s;e++){const s=t[e],r=Math.max(s.boneData.length,5),n=s.globalTransformMatrix.tx,o=s.globalTransformMatrix.ty,a=n+s.globalTransformMatrix.a*r,h=o+s.globalTransformMatrix.b*r;i.moveTo(n,o),i.lineTo(a,h),i.stroke(),i.circle(n,o,2*Math.PI),i.fill(),0===e&&(i.fillColor=m8)}}}H8.getMeshBuffer(T8.chunk.bufferId).setDirty(),C8=void 0}a.internal.DragonBonesAssembler=G8;const q8={getAssembler:()=>G8};let $8,K8;d8.Assembler=q8,function(t){t[t.FFD=0]="FFD",t[t.AdjustColor=10]="AdjustColor",t[t.BevelFilter=11]="BevelFilter",t[t.BlurFilter=12]="BlurFilter",t[t.DropShadowFilter=13]="DropShadowFilter",t[t.GlowFilter=14]="GlowFilter",t[t.GradientBevelFilter=15]="GradientBevelFilter",t[t.GradientGlowFilter=16]="GradientGlowFilter"}($8||($8={})),function(t){t[t.Frame=0]="Frame",t[t.Sound=1]="Sound"}(K8||(K8={}));const Z8=K8;let Q8;!function(t){t[t.None=0]="None",t[t.SameLayer=1]="SameLayer",t[t.SameGroup=2]="SameGroup",t[t.SameLayerAndGroup=3]="SameLayerAndGroup",t[t.All=4]="All"}(Q8||(Q8={}));const J8=globalThis.dragonBones,t7=J8.Slot,e7=J8.Matrix,i7=J8.BaseObject,s7=J8.BoundingBoxData,r7=J8.PolygonBoundingBoxData,n7=J8.Transform,o7=J8.Animation,a7=J8.TextureData,h7=J8.CCTextureData,l7=J8.BaseFactory,c7=J8.CCFactory,u7=J8.WorldClock,d7=J8.TextureAtlasData,_7=J8.CCArmatureDisplay,p7=J8.AnimationState,m7=J8.BoneData,g7=J8.EllipseBoundingBoxData,f7=J8.ArmatureData,y7=J8.CCTextureAtlasData,b7=J8.TransformObject,v7=J8.CCSlot,S7=J8.Armature,T7=J8.Bone,w7=J8.RectangleBoundingBoxData,x7=J8.ArmatureCacheMgr,C7=J8.SkinData,A7=J8.EventObject,D7=J8.SlotData,E7=J8.DragonBonesData,I7=J8.AnimationData,M7=J8.CCArmatureCacheDisplay;t("dragonBones",Object.freeze({__proto__:null,Animation:o7,AnimationCacheMode:Q6,AnimationData:I7,get AnimationFadeOutMode(){return Q8},AnimationState:p7,Armature:S7,ArmatureCacheMgr:x7,ArmatureData:f7,ArmatureDisplay:d8,AttachUtil:f6,BaseFactory:l7,BaseObject:i7,Bone:T7,BoneData:m7,BoundingBoxData:s7,CCArmatureCacheDisplay:M7,CCArmatureDisplay:_7,CCFactory:c7,CCSlot:v7,CCTextureAtlasData:y7,CCTextureData:h7,DragonBoneSocket:u8,DragonBonesAsset:e6,DragonBonesAtlasAsset:_6,DragonBonesData:E7,get DragonBonesEventType(){return K8},EllipseBoundingBoxData:g7,EventObject:A7,EventType:Z8,get ExtensionType(){return $8},Matrix:e7,PolygonBoundingBoxData:r7,RectangleBoundingBoxData:w7,SkinData:C7,Slot:t7,SlotData:D7,TextureAtlasData:d7,TextureData:a7,Transform:n7,TransformObject:b7,WorldClock:u7,simpleDragonBoneAssembler:q8,timeScale:1}));class P7{constructor(t,e,i){this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=i}}function O7(t,e,i,s,r){let n=0,o=null;if(r===J7(t,e,i,s)>0)for(n=e;n<i;n+=s)o=Z7(n,t[n],t[n+1],o);else for(n=i-s;n>=e;n-=s)o=Z7(n,t[n],t[n+1],o);return o&&W7(o,o.next)&&(Q7(o),o=o.next),o}function R7(t,e=null){if(!t)return t;e||(e=t);let i=t,s=!1;do{if(s=!1,i.steiner||!W7(i,i.next)&&0!==G7(i.prev,i,i.next))i=i.next;else{if(Q7(i),i=e=i.prev,i===i.next)return null;s=!0}}while(s||i!==e);return e}function B7(t,e,i,s,r,n,o=0){if(!t)return;!o&&n&&z7(t,s,r,n);let a=t,h=null,l=null;for(;t.prev!==t.next;)if(h=t.prev,l=t.next,n?N7(t,s,r,n):F7(t))e.push(h.i/i),e.push(t.i/i),e.push(l.i/i),Q7(t),t=l.next,a=l.next;else if((t=l)===a){o?1===o?B7(t=L7(t,e,i),e,i,s,r,n,2):2===o&&k7(t,e,i,s,r,n):B7(R7(t),e,i,s,r,n,1);break}}function F7(t){const e=t.prev,i=t,s=t.next;if(G7(e,i,s)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(j7(e.x,e.y,i.x,i.y,s.x,s.y,r.x,r.y)&&G7(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function N7(t,e,i,s){const r=t.prev,n=t,o=t.next;if(G7(r,n,o)>=0)return!1;const a=r.x<n.x?r.x<o.x?r.x:o.x:n.x<o.x?n.x:o.x,h=r.y<n.y?r.y<o.y?r.y:o.y:n.y<o.y?n.y:o.y,l=r.x>n.x?r.x>o.x?r.x:o.x:n.x>o.x?n.x:o.x,c=r.y>n.y?r.y>o.y?r.y:o.y:n.y>o.y?n.y:o.y,u=V7(a,h,e,i,s),d=V7(l,c,e,i,s);let _=t.nextZ;for(;_&&_.z<=d;){if(_!==t.prev&&_!==t.next&&j7(r.x,r.y,n.x,n.y,o.x,o.y,_.x,_.y)&&G7(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(_=t.prevZ;_&&_.z>=u;){if(_!==t.prev&&_!==t.next&&j7(r.x,r.y,n.x,n.y,o.x,o.y,_.x,_.y)&&G7(_.prev,_,_.next)>=0)return!1;_=_.prevZ}return!0}function L7(t,e,i){let s=t;do{const r=s.prev,n=s.next.next;!W7(r,n)&&X7(r,s,s.next,n)&&q7(r,n)&&q7(n,r)&&(e.push(r.i/i),e.push(s.i/i),e.push(n.i/i),Q7(s),Q7(s.next),s=t=n),s=s.next}while(s!==t);return s}function k7(t,e,i,s,r,n){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&H7(o,t)){let a=K7(o,t);return o=R7(o,o.next),a=R7(a,a.next),B7(o,e,i,s,r,n),void B7(a,e,i,s,r,n)}t=t.next}o=o.next}while(o!==t)}function z7(t,e,i,s){let r=t;do{null===r.z&&(r.z=V7(r.x,r.y,e,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,U7(r)}function U7(t){let e=0,i=null,s=null,r=null,n=null,o=0,a=0,h=0,l=1;do{for(i=t,t=null,n=null,o=0;i;){for(o++,s=i,a=0,e=0;e<l&&(a++,s=s.nextZ,s);e++);for(h=l;a>0||h>0&&s;)0===a?(r=s,s=s.nextZ,h--):0!==h&&s?i.z<=s.z?(r=i,i=i.nextZ,a--):(r=s,s=s.nextZ,h--):(r=i,i=i.nextZ,a--),n?n.nextZ=r:t=r,r.prevZ=n,n=r;i=s}n.nextZ=null,l*=2}while(o>1);return t}function V7(t,e,i,s,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function j7(t,e,i,s,r,n,o,a){return(r-o)*(e-a)-(t-o)*(n-a)>=0&&(t-o)*(s-a)-(i-o)*(e-a)>=0&&(i-o)*(n-a)-(r-o)*(s-a)>=0}function H7(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Y7(t,e)&&q7(t,e)&&q7(e,t)&&$7(t,e)}function G7(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function W7(t,e){return t.x===e.x&&t.y===e.y}function X7(t,e,i,s){return!!(W7(t,e)&&W7(i,s)||W7(t,s)&&W7(i,e))||G7(t,e,i)>0!=G7(t,e,s)>0&&G7(i,s,t)>0!=G7(i,s,e)>0}function Y7(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&X7(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function q7(t,e){return G7(t.prev,t,t.next)<0?G7(t,e,t.next)>=0&&G7(t,t.prev,e)>=0:G7(t,e,t.prev)<0||G7(t,t.next,e)<0}function $7(t,e){let i=t,s=!1;const r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}function K7(t,e){const i=new P7(t.i,t.x,t.y),s=new P7(e.i,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}function Z7(t,e,i,s){const r=new P7(t,e,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function Q7(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function J7(t,e,i,s){let r=0;for(let n=e,o=i-s;n<i;n+=s)r+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return r}function t9(t,e,i){i=i||3;const s=t.length;let r=O7(t,0,s,i,!0);const n=[];if(!r)return n;let o=0,a=0,h=0,l=0,c=0,u=0,d=0;if(t.length>80*i){o=h=t[0],a=l=t[1];for(let e=i;e<s;e+=i)c=t[e],u=t[e+1],c<o&&(o=c),u<a&&(a=u),c>h&&(h=c),u>l&&(l=u);d=Math.max(h-o,l-a)}return B7(r,n,i,o,a,d),n}const e9=Math.PI,i9=Math.min,s9=Math.max,r9=Math.ceil,n9=Math.acos,o9=Math.cos,a9=Math.sin,h9=Math.atan2;let l9=null,c9=null;const u9=new Ls,d9=[];for(let t=0;t<4;t++)d9.push(new Ms);function _9(t,e,i){const s=2*n9(t/(t+i));return s9(2,r9(e/s))}function p9(t,e,i){return t<e?e:t>i?i:t}const m9=new class{updateRenderData(t){t.renderData&&(t.renderData.material=t.getMaterialInstance(0))}getRenderData(t,e){if(!c9)return null;const i=c9.getRenderDataList();let s=i[c9.dataOffset];if(!s)return null;let r=s;const n=r?r.vertexStart+e:0;return(n>65535||3*n>131070)&&(++c9.dataOffset,c9.dataOffset<i.length?s=i[c9.dataOffset]:(s=c9.requestRenderData(),i[c9.dataOffset]=s),r=s),r&&r.vertexCount<n&&r.request(e,3*e),s}stroke(t){Ls.copy(u9,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))}fill(t){Ls.copy(u9,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)}end(t){t._markForUpdateRenderData()}_expandStroke(t){const e=.5*t.lineWidth,i=t.lineCap,s=t.lineJoin,r=t.miterLimit;if(c9=t.impl,!c9)return;const n=_9(e,e9,c9.tessTol);this._calculateJoins(c9,e,s,r);const o=c9.paths;let a=0;for(let t=c9.pathOffset,e=c9.pathLength;t<e;t++){const e=o[t],r=e.points.length;a+=1===s?2*(r+e.bevel*(n+2)+1):2*(r+5*e.bevel+1),e.closed||(a+=1===i?2*(2*n+2):12)}const h=l9=this.getRenderData(t,a);if(!h)return;const l=h.vData,c=h.iData;for(let t=c9.pathOffset,r=c9.pathLength;t<r;t++){const r=o[t],a=r.points,u=a.length,d=h.vertexStart;let _,p,m=0,g=0;const f=r.closed;if(f?(_=a[u-1],p=a[0],m=0,g=u):(_=a[0],p=a[1],m=1,g=u-1),p=p||_,!f){const t=new kO(p.x,p.y);t.subtract(_),t.normalize();const s=t.x,r=t.y;0===i?this._buttCapStart(_,s,r,e,0):2===i?this._buttCapStart(_,s,r,e,e):1===i&&this._roundCapStart(_,s,r,e,n)}for(let t=m;t<g;++t)1===s?this._roundJoin(_,p,e,e,n):12&p.flags?this._bevelJoin(_,p,e,e):(this._vSet(p.x+p.dmx*e,p.y+p.dmy*e,1),this._vSet(p.x-p.dmx*e,p.y-p.dmy*e,-1)),_=p,p=a[t+1];if(f){const t=8*d;this._vSet(l[t],l[t+1],1),this._vSet(l[t+8],l[t+8+1],-1)}else{const t=new kO(p.x,p.y);t.subtract(_),t.normalize();const s=t.x,r=t.y;0===i?this._buttCapEnd(p,s,r,e,0):2===i?this._buttCapEnd(p,s,r,e,e):1===i&&this._roundCapEnd(p,s,r,e,n)}let y=h.indexStart;for(let t=d+2,e=h.vertexStart;t<e;t++)c[y++]=t-2,c[y++]=t-1,c[y++]=t;h.indexStart=y}l9=null,c9=null}_expandFill(t){if(c9=t.impl,!c9)return;const e=c9.paths;let i=0;for(let t=c9.pathOffset,s=c9.pathLength;t<s;t++)i+=e[t].points.length;const s=l9=this.getRenderData(t,i);if(!s)return;const r=s,n=r.vData,o=r.iData;for(let t=c9.pathOffset,i=c9.pathLength;t<i;t++){const i=e[t],a=i.points,h=a.length;if(0===h)continue;const l=s.vertexStart;for(let t=0;t<h;++t)this._vSet(a[t].x,a[t].y);let c=s.indexStart;if(i.complex){const t=[];for(let e=l,i=s.vertexStart;e<i;e++){let i=8*e;t.push(n[i++]),t.push(n[i++]),t.push(n[i++])}const e=t9(t,0,3);if(!e||0===e.length)continue;for(let t=0,i=e.length;t<i;t++)o[c++]=e[t]+l}else{const t=l;for(let e=l+2,i=r.vertexStart;e<i;e++)o[c++]=t,o[c++]=e-1,o[c++]=e}r.indexStart=c}l9=null,c9=null}_calculateJoins(t,e,i,s){let r=0;e>0&&(r=1/e);const n=t.paths;for(let e=t.pathOffset,o=t.pathLength;e<o;e++){const t=n[e],o=t.points,a=o.length;let h=o[a-1],l=o[0];t.bevel=0;for(let e=0;e<a;e++){let n=0,a=0,c=0;const u=h.dy,d=-h.dx,_=l.dy,p=-l.dx;if(l.dmx=.5*(u+_),l.dmy=.5*(d+p),n=l.dmx*l.dmx+l.dmy*l.dmy,n>1e-6){let t=1/n;t>600&&(t=600),l.dmx*=t,l.dmy*=t}a=l.dx*h.dy-h.dx*l.dy,a>0&&(l.flags|=2),c=s9(11,i9(h.len,l.len)*r),n*c*c<1&&(l.flags|=8),1&l.flags&&(n*s*s<1||0===i||1===i)&&(l.flags|=4),12&l.flags&&t.bevel++,h=l,l=o[e+1]}}}_flattenPaths(t){const e=t.paths;for(let i=t.pathOffset,s=t.pathLength;i<s;i++){const t=e[i],s=t.points;let r=s[s.length-1],n=s[0];s.length>2&&r.equals(n)&&(t.closed=!0,s.pop(),r=s[s.length-1]);for(let t=0,e=s.length;t<e;t++){const e=new kO(n.x,n.y);e.subtract(r),r.len=e.length(),(e.x||e.y)&&e.normalize(),r.dx=e.x,r.dy=e.y,r=n,n=s[t+1]}}}_chooseBevel(t,e,i,s){const r=i.x,n=i.y;let o=0,a=0,h=0,l=0;return 0!==t?(o=r+e.dy*s,a=n-e.dx*s,h=r+i.dy*s,l=n-i.dx*s):(o=h=r+i.dmx*s,a=l=n+i.dmy*s),[o,a,h,l]}_buttCapStart(t,e,i,s,r){const n=t.x-e*r,o=t.y-i*r,a=i,h=-e;this._vSet(n+a*s,o+h*s,1),this._vSet(n-a*s,o-h*s,-1)}_buttCapEnd(t,e,i,s,r){const n=t.x+e*r,o=t.y+i*r,a=i,h=-e;this._vSet(n+a*s,o+h*s,1),this._vSet(n-a*s,o-h*s,-1)}_roundCapStart(t,e,i,s,r){const n=t.x,o=t.y,a=i,h=-e;for(let t=0;t<r;t++){const l=t/(r-1)*e9,c=o9(l)*s,u=a9(l)*s;this._vSet(n-a*c-e*u,o-h*c-i*u,1),this._vSet(n,o,0)}this._vSet(n+a*s,o+h*s,1),this._vSet(n-a*s,o-h*s,-1)}_roundCapEnd(t,e,i,s,r){const n=t.x,o=t.y,a=i,h=-e;this._vSet(n+a*s,o+h*s,1),this._vSet(n-a*s,o-h*s,-1);for(let t=0;t<r;t++){const l=t/(r-1)*e9,c=o9(l)*s,u=a9(l)*s;this._vSet(n,o,0),this._vSet(n-a*c+e*u,o-h*c+i*u,1)}}_roundJoin(t,e,i,s,r){const n=t.dy,o=-t.dx,a=e.dy,h=-e.dx,l=e.x,c=e.y;if(2&e.flags){const u=this._chooseBevel(8&e.flags,t,e,i),d=u[0],_=u[1],p=u[2],m=u[3],g=h9(-o,-n);let f=h9(-h,-a);f>g&&(f-=2*e9),this._vSet(d,_,1),this._vSet(l-n*s,e.y-o*s,-1);const y=p9(r9((g-f)/e9)*r,2,r);for(let t=0;t<y;t++){const e=g+t/(y-1)*(f-g),i=l+o9(e)*s,r=c+a9(e)*s;this._vSet(l,c,0),this._vSet(i,r,-1)}this._vSet(p,m,1),this._vSet(l-a*s,c-h*s,-1)}else{const u=this._chooseBevel(8&e.flags,t,e,-s),d=u[0],_=u[1],p=u[2],m=u[3],g=h9(o,n);let f=h9(h,a);f<g&&(f+=2*e9),this._vSet(l+n*s,c+o*s,1),this._vSet(d,_,-1);const y=p9(r9((f-g)/e9)*r,2,r);for(let t=0;t<y;t++){const e=g+t/(y-1)*(f-g),s=l+o9(e)*i,r=c+a9(e)*i;this._vSet(s,r,1),this._vSet(l,c,0)}this._vSet(l+a*s,c+h*s,1),this._vSet(p,m,-1)}}_bevelJoin(t,e,i,s){let r=0,n=0,o=0,a=0,h=0,l=0,c=0,u=0;const d=t.dy,_=-t.dx,p=e.dy,m=-e.dx;if(2&e.flags){const r=this._chooseBevel(8&e.flags,t,e,i);h=r[0],l=r[1],c=r[2],u=r[3],this._vSet(h,l,1),this._vSet(e.x-d*s,e.y-_*s,-1),this._vSet(c,u,1),this._vSet(e.x-p*s,e.y-m*s,-1)}else{const h=this._chooseBevel(8&e.flags,t,e,-s);r=h[0],n=h[1],o=h[2],a=h[3],this._vSet(e.x+d*i,e.y+_*i,1),this._vSet(r,n,-1),this._vSet(e.x+p*i,e.y+m*i,1),this._vSet(o,a,-1)}}_vSet(t,e,i=0){if(!l9)return;const s=l9;let r=8*s.vertexStart;const n=s.vData;n[r++]=t,n[r++]=e,n[r++]=0,Ls.toArray(n,u9,r),r+=4,n[r++]=i,s.vertexStart++}},g9=t("graphicsAssembler",{getAssembler:()=>m9});function f9(t,e,i,s){const r=(s.x-i.x)*(t.y-i.y)-(s.y-i.y)*(t.x-i.x),n=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),o=(s.y-i.y)*(e.x-t.x)-(s.x-i.x)*(e.y-t.y);if(0!==o){const t=r/o,e=n/o;if(t>=0&&t<=1&&e>=0&&e<=1)return!0}return!1}sR.Assembler=g9,a.UI.graphicsAssembler=g9;const y9=new kr,b9=new kr,v9=new kr,S9=new kr;function T9(t,e,i){const s=i.length;for(let r=0;r<s;++r)if(f9(t,e,i[r],i[(r+1)%s]))return!0;return!1}function w9(t,e){let i=!1;const s=t.x,r=t.y,n=e.length;for(let t=0,o=n-1;t<n;o=t++){const n=e[t].x,a=e[t].y,h=e[o].x,l=e[o].y;a>r!=l>r&&s<(h-n)*(r-a)/(l-a)+n&&(i=!i)}return i}function x9(t,e,i,s){let r=i.x-e.x,n=i.y-e.y;const o=r*r+n*n,a=((t.x-e.x)*r+(t.y-e.y)*n)/o;let h;return h=s?o?a<0?e:a>1?i:y9.set(e.x+a*r,e.y+a*n):e:y9.set(e.x+a*r,e.y+a*n),r=t.x-h.x,n=t.y-h.y,Math.sqrt(r*r+n*n)}class C9{}var A9,D9,E9,I9,M9,P9,O9,R9,B9,F9,N9,L9;function k9(){const t=new z9;return window.oh||t.initialize({flows:[]}),t}t("Intersection2D",C9),C9.lineLine=f9,C9.lineRect=function(t,e,i){const s=y9.set(i.x,i.y),r=b9.set(i.x,i.yMax),n=v9.set(i.xMax,i.yMax),o=S9.set(i.xMax,i.y);return!!(f9(t,e,s,r)||f9(t,e,r,n)||f9(t,e,n,o)||f9(t,e,o,s))},C9.linePolygon=T9,C9.rectRect=function(t,e){const i=t.x,s=t.y,r=t.x+t.width,n=t.y+t.height,o=e.x,a=e.y,h=e.x+e.width,l=e.y+e.height;return i<=h&&r>=o&&s<=l&&n>=a},C9.rectPolygon=function(t,e){const i=y9.set(t.x,t.y),s=b9.set(t.x,t.yMax),r=v9.set(t.xMax,t.yMax),n=S9.set(t.xMax,t.y);if(T9(i,s,e))return!0;if(T9(s,r,e))return!0;if(T9(r,n,e))return!0;if(T9(n,i,e))return!0;for(let i=0,s=e.length;i<s;++i)if(t.contains(e[i]))return!0;return!!(w9(i,e)||w9(s,e)||w9(r,e)||w9(n,e))},C9.rectCircle=function(t,e,i){const s=e.x,r=e.y,n=t.x,o=t.y,a=t.width,h=t.height;let l=s,c=r;s<n?l=n:s>n+a&&(l=n+a),r<o?c=o:r>o+h&&(c=o+h);const u=s-l,d=r-c;return Math.sqrt(u*u+d*d)<=i},C9.polygonPolygon=function(t,e){let i,s;for(i=0,s=t.length;i<s;++i)if(T9(t[i],t[(i+1)%s],e))return!0;for(i=0,s=e.length;i<s;++i)if(w9(e[i],t))return!0;for(i=0,s=t.length;i<s;++i)if(w9(t[i],e))return!0;return!1},C9.circleCircle=function(t,e,i,s){return kr.distance(t,i)<e+s},C9.polygonCircle=function(t,e,i){const s=e;if(w9(s,t))return!0;for(let e=0,r=t.length;e<r;e++)if(x9(s,0===e?t[t.length-1]:t[e-1],t[e],!0)<i)return!0;return!1},C9.pointInPolygon=w9,C9.pointLineDistance=x9;const z9=t("ForwardPipeline",nr.ForwardPipeline),U9=t("ForwardFlow",nr.ForwardFlow),V9=t("ShadowFlow",nr.ShadowFlow),j9=t("ForwardStage",nr.ForwardStage),H9=t("ShadowStage",nr.ShadowStage),G9=t("DeferredPipeline",nr.DeferredPipeline),W9=t("MainFlow",nr.MainFlow),X9=t("LightingStage",nr.LightingStage),Y9=t("PostProcessStage",nr.PostProcessStage),q9=t("GbufferStage",nr.GbufferStage),$9=t("BloomStage",nr.BloomStage),K9=t("ReflectionProbeFlow",nr.ReflectionProbeFlow),Z9=t("ReflectionProbeStage",nr.ReflectionProbeStage),Q9=t("RenderPipeline",nr.RenderPipeline),J9=t("RenderFlow",nr.RenderFlow),ttt=t("RenderStage",nr.RenderStage);h.RenderFlow=J9,h.RenderStage=ttt,h.RenderPipeline=Q9;const ett=z9.prototype;ett._ctor=function(){this._tag=0,this._flows=[]},ett.init=function(){for(let t=0;t<this._flows.length;t++)this._flows[t].init(this);const t={tag:this._tag,flows:this._flows};this.initialize(t)};const itt=ett.onLoaded;ett.onLoaded=function(){itt&&itt.call(this);for(let t=0;t<this._flows.length;t++)this._flows[t].init(this);const t={tag:this._tag,flows:this._flows};this.initialize(t)};const stt=U9.prototype;stt._ctor=function(){this._name=0,this._priority=0,this._tag=0,this._stages=[]},stt.init=function(t){for(let e=0;e<this._stages.length;e++)this._stages[e].init(t);const e={name:this._name,priority:this._priority,tag:this._tag,stages:this._stages};this.initialize(e)};const rtt=V9.prototype;rtt._ctor=function(){this._name=0,this._priority=0,this._tag=0,this._stages=[]},rtt.init=function(t){for(let e=0;e<this._stages.length;e++)this._stages[e].init(t);const e={name:this._name,priority:this._priority,tag:this._tag,stages:this._stages};this.initialize(e)};const ntt=j9.prototype;ntt._ctor=function(){this._name=0,this._priority=0,this._tag=0,this.renderQueues=[]},ntt.init=function(){const t=[];for(let e=0;e<this.renderQueues.length;e++)t.push(this.renderQueues[e].init());const e={name:this._name,priority:this._priority,tag:this._tag,renderQueues:t};this.initialize(e)};const ott=H9.prototype;ott._ctor=function(){this._name=0,this._priority=0,this._tag=0},ott.init=function(){const t={name:this._name,priority:this._priority,tag:this._tag,renderQueues:[]};this.initialize(t)};const att=G9.prototype;att._ctor=function(){this._tag=0,this._flows=[],this.renderTextures=[],this.materials=[]};const htt=att.onLoaded;att.onLoaded=function(){htt&&htt.call(this);for(let t=0;t<this._flows.length;t++)this._flows[t].init(this);let t={tag:this._tag,flows:this._flows};this.initialize(t)};const ltt=W9.prototype;ltt._ctor=function(){this._name=0,this._priority=0,this._tag=0,this._stages=[]},ltt.init=function(t){for(let e=0;e<this._stages.length;e++)this._stages[e].init(t);const e={name:this._name,priority:this._priority,tag:this._tag,stages:this._stages};this.initialize(e)};const ctt=q9.prototype;ctt._ctor=function(){this._name=0,this._priority=0,this._tag=0,this.renderQueues=[]},ctt.init=function(){const t=[];for(let e=0;e<this.renderQueues.length;e++)t.push(this.renderQueues[e].init());const e={name:this._name,priority:this._priority,tag:this._tag,renderQueues:t};this.initialize(e)};const utt=X9.prototype;utt._ctor=function(){this._name=0,this._priority=0,this._tag=0,this.renderQueues=[],this._deferredMaterial=null},utt.init=function(t){const e=[];for(let t=0;t<this.renderQueues.length;t++)e.push(this.renderQueues[t].init());t.pipelineSceneData.deferredLightingMaterial=this._deferredMaterial;const i={name:this._name,priority:this._priority,tag:this._tag,renderQueues:e};this.initialize(i)};const dtt=$9.prototype;dtt._ctor=function(){this._name=0,this._priority=0,this._tag=0,this.renderQueues=[],this._bloomMaterial=null},dtt.init=function(t){const e=[];for(let t=0;t<this.renderQueues.length;t++)e.push(this.renderQueues[t].init());t.pipelineSceneData.bloomMaterial=this._bloomMaterial;const i={name:this._name,priority:this._priority,tag:this._tag,renderQueues:e};this.initialize(i)};const _tt=Y9.prototype;_tt._ctor=function(){this._name=0,this._priority=0,this._tag=0,this.renderQueues=[],this._postProcessMaterial=null},_tt.init=function(t){const e=[];for(let t=0;t<this.renderQueues.length;t++)e.push(this.renderQueues[t].init());t.pipelineSceneData.postProcessMaterial=this._postProcessMaterial;const i={name:this._name,priority:this._priority,tag:this._tag,renderQueues:e};this.initialize(i)};const ptt=K9.prototype;ptt._ctor=function(){this._name=0,this._priority=0,this._tag=0,this._stages=[]},ptt.init=function(t){for(let e=0;e<this._stages.length;e++)this._stages[e].init(t);const e={name:this._name,priority:this._priority,tag:this._tag,stages:this._stages};this.initialize(e)};const mtt=Z9.prototype;mtt._ctor=function(){this._name=0,this._priority=0,this._tag=0,this.renderQueues=[]},mtt.init=function(){const t=[];for(let e=0;e<this.renderQueues.length;e++)t.push(this.renderQueues[e].init());const e={name:this._name,priority:this._priority,tag:this._tag,renderQueues:t};this.initialize(e)};let gtt,ftt=(A9=ah("RenderTextureConfig"),D9=Xh(SD),A9((I9=class{constructor(){this.name=M9&&M9(),this.texture=P9&&P9()}},M9=Za(I9.prototype,"name",[vh],(function(){return""})),P9=Za(I9.prototype,"texture",[D9],(function(){return null})),E9=I9))||E9);t("RenderQueueSortMode",gtt),function(t){t[t.FRONT_TO_BACK=0]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=1]="BACK_TO_FRONT"}(gtt||t("RenderQueueSortMode",gtt={})),fe(gtt);let ytt=t("RenderQueueDesc",(O9=Xh(gtt),R9=Xh([Ye]),B9=class{constructor(){this.isTransparent=F9&&F9(),this.sortMode=N9&&N9(),this.stages=L9&&L9(),this.stages=[]}init(){return new nr.RenderQueueDesc(this.isTransparent,this.sortMode,this.stages)}},F9=Za(B9.prototype,"isTransparent",[vh],(function(){return!1})),N9=Za(B9.prototype,"sortMode",[O9],(function(){return gtt.FRONT_TO_BACK})),L9=Za(B9.prototype,"stages",[R9],(function(){return[]})),B9)),btt=function(t,e){const i=`_${e}_target`;Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return this[i]||(this[i]=[]),t=this,e=i,new Proxy(t[e],{get:(t,e,i)=>Reflect.get(t,e,i),set(i,s,r){const n=Reflect.set(i,s,r);return t[e]=i,n}});var t,e},set:function(t){this[i]=t}})};btt(J9.prototype,"_stages"),btt(Q9.prototype,"_flows");const vtt=jsb.Material;!function(t,e=dm){const{GbufferStage:i,RenderQueueDesc:s}={...t};e((()=>{Uh()(i.prototype,"renderQueues",(()=>[]))}),"displayOrder","renderQueues"),e((()=>{vh(i.prototype,"renderQueues",(()=>[]))}),"serializable","renderQueues"),e((()=>{Xh([s])(i.prototype,"renderQueues",(()=>[]))}),"type","renderQueues"),e((()=>{ah("GbufferStage")(i)}),"ccclass",null)}({GbufferStage:q9,RenderQueueDesc:ytt}),function(t,e=dm){const{LightingStage:i,Material:s,RenderQueueDesc:r}={...t};e((()=>{Uh()(i.prototype,"_deferredMaterial",(()=>null))}),"displayOrder","_deferredMaterial"),e((()=>{vh(i.prototype,"_deferredMaterial",(()=>null))}),"serializable","_deferredMaterial"),e((()=>{Xh(s)(i.prototype,"_deferredMaterial",(()=>null))}),"type","_deferredMaterial"),e((()=>{Uh()(i.prototype,"renderQueues",(()=>[]))}),"displayOrder","renderQueues"),e((()=>{vh(i.prototype,"renderQueues",(()=>[]))}),"serializable","renderQueues"),e((()=>{Xh([r])(i.prototype,"renderQueues",(()=>[]))}),"type","renderQueues"),e((()=>{ah("LightingStage")(i)}),"ccclass",null)}({LightingStage:X9,RenderQueueDesc:ytt,Material:vtt}),function(t,e=dm){const{BloomStage:i,Material:s}={...t};e((()=>{Uh()(i.prototype,"_bloomMaterial",(()=>null))}),"displayOrder","_bloomMaterial"),e((()=>{vh(i.prototype,"_bloomMaterial",(()=>null))}),"serializable","_bloomMaterial"),e((()=>{Xh(s)(i.prototype,"_bloomMaterial",(()=>null))}),"type","_bloomMaterial"),e((()=>{ah("BloomStage")(i)}),"ccclass",null)}({BloomStage:$9,Material:vtt}),function(t,e=dm){const{PostProcessStage:i,Material:s,RenderQueueDesc:r}={...t};e((()=>{Uh()(i.prototype,"_postProcessMaterial",(()=>null))}),"displayOrder","_postProcessMaterial"),e((()=>{vh(i.prototype,"_postProcessMaterial",(()=>null))}),"serializable","_postProcessMaterial"),e((()=>{Xh(s)(i.prototype,"_postProcessMaterial",(()=>null))}),"type","_postProcessMaterial"),e((()=>{Uh()(i.prototype,"renderQueues",(()=>[]))}),"displayOrder","renderQueues"),e((()=>{vh(i.prototype,"renderQueues",(()=>[]))}),"serializable","renderQueues"),e((()=>{Xh([r])(i.prototype,"renderQueues",(()=>[]))}),"type","renderQueues"),e((()=>{ah("PostProcessStage")(i)}),"ccclass",null)}({PostProcessStage:Y9,Material:vtt,RenderQueueDesc:ytt}),function(t,e=dm){const{ForwardStage:i,RenderQueueDesc:s}={...t};e((()=>{Uh()(i.prototype,"renderQueues",(()=>[]))}),"displayOrder","renderQueues"),e((()=>{vh(i.prototype,"renderQueues",(()=>[]))}),"serializable","renderQueues"),e((()=>{Xh([s])(i.prototype,"renderQueues",(()=>[]))}),"type","renderQueues"),e((()=>{ah("ForwardStage")(i)}),"ccclass",null)}({ForwardStage:j9,RenderQueueDesc:ytt}),function(t,e=dm){const{ShadowStage:i}={...t};e((()=>{ah("ShadowStage")(i)}),"ccclass",null)}({ShadowStage:H9}),function(t,e=dm){const{ReflectionProbeStage:i}={...t};e((()=>{ah("ReflectionProbeStage")(i)}),"ccclass",null)}({ReflectionProbeStage:Z9}),function(t,e=dm){const{MainFlow:i}={...t};e((()=>{ah("MainFlow")(i)}),"ccclass",null)}({MainFlow:W9}),function(t,e=dm){const{ForwardFlow:i}={...t};e((()=>{ah("ForwardFlow")(i)}),"ccclass",null)}({ForwardFlow:U9}),function(t,e=dm){const{ShadowFlow:i}={...t};e((()=>{ah("ShadowFlow")(i)}),"ccclass",null)}({ShadowFlow:V9}),function(t,e=dm){const{ReflectionProbeFlow:i}={...t};e((()=>{ah("ReflectionProbeFlow")(i)}),"ccclass",null)}({ReflectionProbeFlow:K9}),function(t,e=dm){const{ForwardPipeline:i,RenderTextureConfig:s}={...t};e((()=>{Uh()(i.prototype,"renderTextures",(()=>[]))}),"displayOrder","renderTextures"),e((()=>{vh(i.prototype,"renderTextures",(()=>[]))}),"serializable","renderTextures"),e((()=>{Xh([s])(i.prototype,"renderTextures",(()=>[]))}),"type","renderTextures"),e((()=>{ah("ForwardPipeline")(i)}),"ccclass",null)}({ForwardPipeline:z9,RenderTextureConfig:ftt}),function(t,e=dm){const{DeferredPipeline:i,RenderTextureConfig:s}={...t};e((()=>{Uh()(i.prototype,"renderTextures",(()=>[]))}),"displayOrder","renderTextures"),e((()=>{vh(i.prototype,"renderTextures",(()=>[]))}),"serializable","renderTextures"),e((()=>{Xh([s])(i.prototype,"renderTextures",(()=>[]))}),"type","renderTextures"),e((()=>{ah("DeferredPipeline")(i)}),"ccclass",null)}({DeferredPipeline:G9,RenderTextureConfig:ftt}),function(t,e=dm){const{RenderQueueDesc:i,RenderQueueSortMode:s,CCString:r}={...t};e((()=>{Ph(i.prototype)}),"editable","isTransparent"),e((()=>{vh(i.prototype,"isTransparent",(()=>!1))}),"serializable","isTransparent"),e((()=>{Xh(s)(i.prototype,"sortMode",(()=>s.FRONT_TO_BACK))}),"type","sortMode"),e((()=>{Xh([r])(i.prototype,"stages",(()=>[]))}),"type","stages"),e((()=>{ah("RenderQueueDesc")(i)}),"ccclass",null)}({RenderQueueDesc:ytt,RenderQueueSortMode:gtt,CCString:Ye}),function(t,e=dm){const{RenderStage:i}={...t};e((()=>{vh(i.prototype,"_name",(()=>""))}),"serializable","_name"),e((()=>{Uh()(i.prototype,"_name",(()=>""))}),"displayOrder","_name"),e((()=>{vh(i.prototype,"_priority",(()=>0))}),"serializable","_priority"),e((()=>{Uh()(i.prototype,"_priority",(()=>0))}),"displayOrder","_priority"),e((()=>{vh(i.prototype,"_tag",(()=>0))}),"serializable","_tag"),e((()=>{Uh()(i.prototype,"_tag",(()=>0))}),"displayOrder","_tag"),e((()=>{ah("RenderStage")(i)}),"ccclass",null)}({RenderStage:ttt}),function(t,e=dm){const{RenderFlow:i,RenderStage:s}={...t};e((()=>{vh(i.prototype,"_name",(()=>""))}),"serializable","_name"),e((()=>{Uh()(i.prototype,"_name",(()=>""))}),"displayOrder","_name"),e((()=>{vh(i.prototype,"_priority",(()=>0))}),"serializable","_priority"),e((()=>{Uh()(i.prototype,"_priority",(()=>0))}),"displayOrder","_priority"),e((()=>{vh(i.prototype,"_tag",(()=>0))}),"serializable","_tag"),e((()=>{Uh()(i.prototype,"_tag",(()=>0))}),"displayOrder","_tag"),e((()=>{vh(i.prototype,"_stages",(()=>[]))}),"serializable","_stages"),e((()=>{Xh([s])(i.prototype,"_stages",(()=>[]))}),"type","_stages"),e((()=>{Uh()(i.prototype,"_stages",(()=>[]))}),"displayOrder","_stages"),e((()=>{ah("RenderFlow")(i)}),"ccclass",null)}({RenderFlow:J9,RenderStage:ttt}),function(t,e=dm){const{RenderPipeline:i,RenderFlow:s}={...t};e((()=>{vh(i.prototype,"_tag",(()=>0))}),"serializable","_tag"),e((()=>{Uh()(i.prototype,"_tag",(()=>0))}),"displayOrder","_tag"),e((()=>{vh(i.prototype,"_flows",(()=>[]))}),"serializable","_flows"),e((()=>{Xh([s])(i.prototype,"_flows",(()=>[]))}),"type","_flows"),e((()=>{Uh()(i.prototype,"_flows",(()=>[]))}),"displayOrder","_flows"),e((()=>{ah("cc.RenderPipeline")(i)}),"ccclass",null)}({RenderPipeline:Q9,RenderFlow:J9});var Stt=Object.freeze({__proto__:null,BloomStage:$9,DeferredPipeline:G9,ForwardFlow:U9,ForwardPipeline:z9,ForwardStage:j9,GbufferStage:q9,LightingStage:X9,MainFlow:W9,PostProcessStage:Y9,ReflectionProbeFlow:K9,ReflectionProbeStage:Z9,RenderFlow:J9,RenderPipeline:Q9,RenderQueueDesc:ytt,get RenderQueueSortMode(){return gtt},RenderStage:ttt,ShadowFlow:V9,ShadowStage:H9,createDefaultPipeline:k9});h.legacy_rendering=Stt;const Ttt=t("PlaceMethod",pe({UNIFORM:0,ADAPTIVE:1}));class wtt{static generate(t){switch(t.method){case Ttt.UNIFORM:return this.doGenerateUniform(t);case Ttt.ADAPTIVE:return this.doGenerateAdaptive(t);default:return[]}}static doGenerateUniform(t){if(t.nProbesX<2||t.nProbesY<2||t.nProbesZ<2)return[];const e=[],i=new Ms(0,0,0),s=new Ms((t.maxPos.x-t.minPos.x)/(t.nProbesX-1),(t.maxPos.y-t.minPos.y)/(t.nProbesY-1),(t.maxPos.z-t.minPos.z)/(t.nProbesZ-1));for(let r=0;r<t.nProbesX;r++){i.x=r*s.x+t.minPos.x;for(let r=0;r<t.nProbesY;r++){i.y=r*s.y+t.minPos.y;for(let r=0;r<t.nProbesZ;r++)i.z=r*s.z+t.minPos.z,e.push(new Ms(i))}}return e}static doGenerateAdaptive(t){return this.doGenerateUniform(t)}}t("AutoPlacement",wtt);const xtt=t("Vertex",jsb.Vertex);!function(t,e=dm){const{Vertex:i,Vec3:s}={...t};e((()=>{vh(i.prototype,"position",(()=>new s(0,0,0)))}),"serializable","position"),e((()=>{vh(i.prototype,"normal",(()=>new s(0,0,0)))}),"serializable","normal"),e((()=>{vh(i.prototype,"coefficients",(()=>[]))}),"serializable","coefficients"),e((()=>{ah("cc.Vertex")(i)}),"ccclass",null)}({Vertex:xtt,Vec3:Ms});const Ctt=t("CircumSphere",jsb.CircumSphere);!function(t,e=dm){const{CircumSphere:i,Vec3:s}={...t};e((()=>{vh(i.prototype,"center",(()=>new s(0,0,0)))}),"serializable","center"),e((()=>{vh(i.prototype,"radiusSquared",(()=>0))}),"serializable","radiusSquared"),e((()=>{ah("cc.CircumSphere")(i)}),"ccclass",null)}({CircumSphere:Ctt,Vec3:Ms});const Att=t("Tetrahedron",jsb.Tetrahedron);!function(t,e=dm){const{Tetrahedron:i,Mat3:s,Vec3:r,CircumSphere:n}={...t};e((()=>{vh(i.prototype,"invalid",(()=>!1))}),"serializable","invalid"),e((()=>{vh(i.prototype,"vertex0",(()=>-1))}),"serializable","vertex0"),e((()=>{vh(i.prototype,"vertex1",(()=>-1))}),"serializable","vertex1"),e((()=>{vh(i.prototype,"vertex2",(()=>-1))}),"serializable","vertex2"),e((()=>{vh(i.prototype,"vertex3",(()=>-1))}),"serializable","vertex3"),e((()=>{vh(i.prototype,"neighbours",(()=>[-1,-1,-1,-1]))}),"serializable","neighbours"),e((()=>{vh(i.prototype,"matrix",(()=>new s))}),"serializable","matrix"),e((()=>{vh(i.prototype,"offset",(()=>new r(0,0,0)))}),"serializable","offset"),e((()=>{vh(i.prototype,"sphere",(()=>new n))}),"serializable","sphere"),e((()=>{ah("cc.Tetrahedron")(i)}),"ccclass",null)}({Tetrahedron:Att,Mat3:js,Vec3:Ms,CircumSphere:Ctt});class Dtt{static uniformSampleSphere(t,e){const i=1-2*t,s=Math.sqrt(Math.max(0,1-i*i)),r=2*Math.PI*e,n=s*Math.cos(r),o=s*Math.sin(r);return new Ms(n,o,i)}static uniformSampleSphereAll(t){const e=Math.floor(Math.sqrt(t)),i=e,s=[],r=1/e,n=1/i;for(let t=0;t<e;t++){const e=(t+.5)*r;for(let t=0;t<i;t++){const i=(t+.5)*n,r=this.uniformSampleSphere(e,i);s.push(r)}}return s}static uniformSpherePdf(){return 1/(4*Math.PI)}}t("LightProbeSampler",Dtt);class Ett{static updateUBOData(t,e,i){t[e++]=i[3].x*this.basisOverPI[3],t[e++]=i[1].x*this.basisOverPI[1],t[e++]=i[2].x*this.basisOverPI[2],t[e++]=i[0].x*this.basisOverPI[0]-i[6].x*this.basisOverPI[6]/3,t[e++]=i[3].y*this.basisOverPI[3],t[e++]=i[1].y*this.basisOverPI[1],t[e++]=i[2].y*this.basisOverPI[2],t[e++]=i[0].y*this.basisOverPI[0]-i[6].y*this.basisOverPI[6]/3,t[e++]=i[3].z*this.basisOverPI[3],t[e++]=i[1].z*this.basisOverPI[1],t[e++]=i[2].z*this.basisOverPI[2],t[e++]=i[0].z*this.basisOverPI[0]-i[6].z*this.basisOverPI[6]/3,t[e++]=i[4].x*this.basisOverPI[4],t[e++]=i[5].x*this.basisOverPI[5],t[e++]=i[6].x*this.basisOverPI[6],t[e++]=i[7].x*this.basisOverPI[7],t[e++]=i[4].y*this.basisOverPI[4],t[e++]=i[5].y*this.basisOverPI[5],t[e++]=i[6].y*this.basisOverPI[6],t[e++]=i[7].y*this.basisOverPI[7],t[e++]=i[4].z*this.basisOverPI[4],t[e++]=i[5].z*this.basisOverPI[5],t[e++]=i[6].z*this.basisOverPI[6],t[e++]=i[7].z*this.basisOverPI[7],t[e++]=i[8].x*this.basisOverPI[8],t[e++]=i[8].y*this.basisOverPI[8],t[e++]=i[8].z*this.basisOverPI[8],t[e++]=0}static shaderEvaluate(t,e){const i=new ms(e[3].x*this.basisOverPI[3],e[1].x*this.basisOverPI[1],e[2].x*this.basisOverPI[2],e[0].x*this.basisOverPI[0]-e[6].x*this.basisOverPI[6]/3),s=new ms(e[3].y*this.basisOverPI[3],e[1].y*this.basisOverPI[1],e[2].y*this.basisOverPI[2],e[0].y*this.basisOverPI[0]-e[6].y*this.basisOverPI[6]/3),r=new ms(e[3].z*this.basisOverPI[3],e[1].z*this.basisOverPI[1],e[2].z*this.basisOverPI[2],e[0].z*this.basisOverPI[0]-e[6].z*this.basisOverPI[6]/3),n=new ms(e[4].x*this.basisOverPI[4],e[5].x*this.basisOverPI[5],e[6].x*this.basisOverPI[6],e[7].x*this.basisOverPI[7]),o=new ms(e[4].y*this.basisOverPI[4],e[5].y*this.basisOverPI[5],e[6].y*this.basisOverPI[6],e[7].y*this.basisOverPI[7]),a=new ms(e[4].z*this.basisOverPI[4],e[5].z*this.basisOverPI[5],e[6].z*this.basisOverPI[6],e[7].z*this.basisOverPI[7]),h=new Ms(e[8].x*this.basisOverPI[8],e[8].y*this.basisOverPI[8],e[8].z*this.basisOverPI[8]),l=new Ms(0,0,0),c=new ms(t.x,t.y,t.z,1);l.x=ms.dot(i,c),l.y=ms.dot(s,c),l.z=ms.dot(r,c);const u=new ms(t.x*t.y,t.y*t.z,t.z*t.z,t.z*t.x),d=t.x*t.x-t.y*t.y;return l.x+=ms.dot(n,u),l.y+=ms.dot(o,u),l.z+=ms.dot(a,u),Ms.scaleAndAdd(l,l,h,d),l}static evaluate(t,e){const i=new Ms(0,0,0),s=e.length;for(let r=0;r<s;r++){const s=e[r];Ms.scaleAndAdd(i,i,s,this.evaluateBasis(r,t))}return i}static project(t,e){t.length>0&&(t.length,e.length);const i=this.getBasisCount(),s=t.length,r=1/(Dtt.uniformSpherePdf()*s),n=[];for(let o=0;o<i;o++){const i=new Ms(0,0,0);for(let r=0;r<s;r++)Ms.scaleAndAdd(i,i,e[r],this.evaluateBasis(o,t[r]));Ms.multiplyScalar(i,i,r),n.push(i)}return n}static convolveCosine(t){const e=[.8862268925,1.0233267546,.495415926],i=[];for(let s=0;s<=this.LMAX;s++)for(let r=-s;r<=s;r++){const n=this.toIndex(s,r),o=new Ms(0,0,0);Ms.multiplyScalar(o,t[n],this.lambda(s)*e[s]),i.push(o)}return i}static getBasisCount(){return 9}static evaluateBasis(t,e){return this.getBasisCount(),(0,this.basisFunctions[t])(e)}static reduceRinging(t,e){if(0!==e)for(let i=0;i<=this.LMAX;++i){const s=1/(1+e*i*i*(i+1)*(i+1));for(let e=-i;e<=i;++e){const r=this.toIndex(i,e);Ms.multiplyScalar(t[r],t[r],s)}}}static lambda(t){return Math.sqrt(4*Math.PI/(2*t+1))}static toIndex(t,e){return t*t+t+e}}t("SH",Ett),Ett.LMAX=2,Ett.basisFunctions=[()=>.282095,t=>.488603*t.y,t=>.488603*t.z,t=>.488603*t.x,t=>1.09255*t.y*t.x,t=>1.09255*t.y*t.z,t=>.946175*(t.z*t.z-1/3),t=>1.09255*t.z*t.x,t=>.546274*(t.x*t.x-t.y*t.y)],Ett.basisOverPI=[.0897936,.155527,.155527,.155527,.347769,.347769,.301177,.347769,.173884],a.internal.SH=Ett;const Itt=t("LightProbes",jsb.LightProbes);var Mtt,Ptt,Ott,Rtt,Btt,Ftt,Ntt,Ltt,ktt,ztt,Utt,Vtt,jtt,Htt,Gtt,Wtt,Xtt,Ytt,qtt,$tt,Ktt,Ztt,Qtt,Jtt,tet;ah("cc.LightProbes")(Itt),function(t,e=dm){const{LightProbesData:i,Vertex:s,Tetrahedron:r}={...t};e((()=>{Xh([s])(i.prototype,"_probes",(()=>[]))}),"type","_probes"),e((()=>{vh(i.prototype,"_probes",(()=>[]))}),"serializable","_probes"),e((()=>{Xh([r])(i.prototype,"_tetrahedrons",(()=>[]))}),"type","_tetrahedrons"),e((()=>{vh(i.prototype,"_tetrahedrons",(()=>[]))}),"serializable","_tetrahedrons"),e((()=>{ah("cc.LightProbesData")(i)}),"ccclass",null)}({LightProbesData:t("LightProbesData",jsb.LightProbesData),Vertex:xtt,Tetrahedron:Att}),t("LightProbeGroup",(Mtt=ah("cc.LightProbeGroup"),Ptt=Xh([Ms]),Ott=Xh(Ttt),Rtt=Xh(Ge),Btt=Xh(Ge),Ftt=Xh(Ge),Mtt(Ntt=ch((Ltt=class extends Km{constructor(...t){super(...t),this._probes=ktt&&ktt(),this._method=ztt&&ztt(),this._minPos=Utt&&Utt(),this._maxPos=Vtt&&Vtt(),this._nProbesX=jtt&&jtt(),this._nProbesY=Htt&&Htt(),this._nProbesZ=Gtt&&Gtt()}get probes(){return this._probes}set probes(t){this._probes=t}get method(){return this._method}get minPos(){return this._minPos}set minPos(t){this._minPos=t}get maxPos(){return this._maxPos}set maxPos(t){this._maxPos=t}get nProbesX(){return this._nProbesX}set nProbesX(t){this._nProbesX=t}get nProbesY(){return this._nProbesY}set nProbesY(t){this._nProbesY=t}get nProbesZ(){return this._nProbesZ}set nProbesZ(t){this._nProbesZ=t}onLoad(){}onEnable(){}onDisable(){}generateLightProbes(){this.node&&(this._probes=wtt.generate({method:this._method,nProbesX:this._nProbesX,nProbesY:this._nProbesY,nProbesZ:this._nProbesZ,minPos:this._minPos,maxPos:this._maxPos}),this.onProbeChanged())}onProbeChanged(t=!0,e=!0){const i=this.node.scene.globals.lightProbeInfo;i.syncData(this.node,this.probes),i.update(t),e&&this.node.emit("light-probe-changed")}},ktt=Za(Ltt.prototype,"_probes",[vh],(function(){return[]})),ztt=Za(Ltt.prototype,"_method",[vh],(function(){return Ttt.UNIFORM})),Utt=Za(Ltt.prototype,"_minPos",[vh],(function(){return new Ms(-5,-5,-5)})),Vtt=Za(Ltt.prototype,"_maxPos",[vh],(function(){return new Ms(5,5,5)})),jtt=Za(Ltt.prototype,"_nProbesX",[vh],(function(){return 3})),Htt=Za(Ltt.prototype,"_nProbesY",[vh],(function(){return 3})),Gtt=Za(Ltt.prototype,"_nProbesZ",[vh],(function(){return 3})),s(Ltt.prototype,"probes",[Ptt],Object.getOwnPropertyDescriptor(Ltt.prototype,"probes"),Ltt.prototype),s(Ltt.prototype,"method",[Ott],Object.getOwnPropertyDescriptor(Ltt.prototype,"method"),Ltt.prototype),s(Ltt.prototype,"nProbesX",[Rtt],Object.getOwnPropertyDescriptor(Ltt.prototype,"nProbesX"),Ltt.prototype),s(Ltt.prototype,"nProbesY",[Btt],Object.getOwnPropertyDescriptor(Ltt.prototype,"nProbesY"),Ltt.prototype),s(Ltt.prototype,"nProbesZ",[Ftt],Object.getOwnPropertyDescriptor(Ltt.prototype,"nProbesZ"),Ltt.prototype),Ntt=Ltt))||Ntt)||Ntt));let eet=(Wtt=ah("cc.Billboard"),Xtt=Xh(ff),Ytt=Xh(ff),Wtt(($tt=class extends Km{get texture(){return this._texture}set texture(t){this._texture=t,this.updateTexture()}updateTexture(){this._material&&this._material.setProperty("mainTexture",this._texture)}get height(){return this._height}set height(t){this._height=t,this.updateHeight()}updateHeight(){this._material&&(this._uniform.y=this._height,this._material.setProperty("cc_size_rotation",this._uniform))}get width(){return this._width}set width(t){this._width=t,this.updateWidth()}updateWidth(){this._material&&(this._uniform.x=this._width,this._material.setProperty("cc_size_rotation",this._uniform))}get rotation(){return Math.round(100*Li(this._rotation))/100}set rotation(t){this._rotation=Ni(t),this.updateRotation()}updateRotation(){this._material&&(this._uniform.z=this._rotation,this._material.setProperty("cc_size_rotation",this._uniform))}get technique(){return this._techIndex}set technique(t){var e,i;t=Math.floor(t);const s=null==(e=this._material)||null==(i=e.effectAsset)?void 0:i.techniques;s&&t>=s.length&&(t=s.length-1),t<0&&(t=0),this._techIndex=t,this.updateTechnique()}updateTechnique(){this._model&&this._mesh&&this._material&&this._material.technique!==this._techIndex&&(this.detachFromScene(),this._model.destroy(),this._model=null,this._material.destroy(),this._material=null,this._mesh.destroy(),this._mesh=null,this.createModel(),this.updateWidth(),this.updateHeight(),this.updateRotation(),this.updateTexture(),this.enabled?(this.attachToScene(),this._model.enabled=!0):this._model.enabled=!1)}constructor(){super(),this._texture=Ktt&&Ktt(),this._height=Ztt&&Ztt(),this._width=Qtt&&Qtt(),this._rotation=Jtt&&Jtt(),this._techIndex=tet&&tet(),this._model=null,this._mesh=null,this._material=null,this._uniform=new ms(1,1,0,0)}onLoad(){this.createModel()}onEnable(){this.attachToScene(),this._model.enabled=!0,this.updateWidth(),this.updateHeight(),this.updateRotation(),this.updateTexture(),this.updateTechnique()}onDisable(){this.detachFromScene()}attachToScene(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this.detachFromScene(),this._getRenderScene().addModel(this._model))}detachFromScene(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)}createModel(){this._mesh=lD({primitiveMode:7,positions:[0,0,0,0,0,0,0,0,0,0,0,0],uvs:[0,0,1,0,0,1,1,1],colors:[Ls.WHITE.r,Ls.WHITE.g,Ls.WHITE.b,Ls.WHITE.a,Ls.WHITE.r,Ls.WHITE.g,Ls.WHITE.b,Ls.WHITE.a,Ls.WHITE.r,Ls.WHITE.g,Ls.WHITE.b,Ls.WHITE.a,Ls.WHITE.r,Ls.WHITE.g,Ls.WHITE.b,Ls.WHITE.a],attributes:[new x_("a_position",32),new x_("a_texCoord",21),new x_("a_color",39,!0)],indices:[0,1,2,1,2,3]},void 0,{calculateBounds:!1});const t=this._model=a.director.root.createModel(mb);t.node=t.transform=this.node,null==this._material&&(this._material=new fv,this._material.copy(iC.get("default-billboard-material"),{technique:this._techIndex})),t.initSubModel(0,this._mesh.renderingSubMeshes[0],this._material)}},Ktt=Za($tt.prototype,"_texture",[Xtt],(function(){return null})),s($tt.prototype,"texture",[Ytt],Object.getOwnPropertyDescriptor($tt.prototype,"texture"),$tt.prototype),Ztt=Za($tt.prototype,"_height",[vh],(function(){return 0})),Qtt=Za($tt.prototype,"_width",[vh],(function(){return 0})),Jtt=Za($tt.prototype,"_rotation",[vh],(function(){return 0})),tet=Za($tt.prototype,"_techIndex",[vh],(function(){return 0})),qtt=$tt))||qtt);t({Billboard:eet,BillboardComponent:eet});const iet=[new x_("a_position",32),new x_("a_texCoord",44),new x_("a_texCoord1",32),new x_("a_color",35,!0)],set=new Ms,ret=new Ms;class net extends mb{constructor(){super(),this._capacity=void 0,this._vertSize=0,this._vBuffer=null,this._vertAttrsFloatCount=0,this._vdataF32=null,this._vdataUint32=null,this._subMeshData=null,this._vertCount=0,this._indexCount=0,this._material=null,this._iaVertCount=0,this._iaIndexCount=0,this._registerListeners(),this.type=5,this._capacity=100}setCapacity(t){this._capacity=t,this.createBuffer()}createBuffer(){this._vertSize=0;for(const t of iet)t.offset=this._vertSize,this._vertSize+=tp[t.format].size;this._vertAttrsFloatCount=this._vertSize/4,this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)}updateMaterial(t){this._material=t,super.setSubModelMaterial(0,t)}createSubMeshData(){this._subMeshData&&this.destroySubMeshData(),this._vertCount=2,this._indexCount=6;const t=this._device.createBuffer(new a_(10,1,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);t.update(e);const i=new Uint16Array((this._capacity-1)*this._indexCount);let s=0;for(let t=0;t<this._capacity-1;++t){const e=2*t;i[s++]=e,i[s++]=e+1,i[s++]=e+2,i[s++]=e+3,i[s++]=e+2,i[s++]=e+1}const r=this._device.createBuffer(new a_(6,1,(this._capacity-1)*this._indexCount*2,2));return r.update(i),this._iaVertCount=this._capacity*this._vertCount,this._iaIndexCount=(this._capacity-1)*this._indexCount,this._subMeshData=new wD([t],iet,7,r),this.initSubModel(0,this._subMeshData,this._material),e}addLineVertexData(t,e,i){if(t.length>1){let s=0;Ms.subtract(set,t[1],t[0]),this._vdataF32[s++]=t[0].x,this._vdataF32[s++]=t[0].y,this._vdataF32[s++]=t[0].z,this._vdataF32[s++]=0,this._vdataF32[s++]=e.evaluate(0,1),this._vdataF32[s++]=0,this._vdataF32[s++]=0,this._vdataF32[s++]=set.x,this._vdataF32[s++]=set.y,this._vdataF32[s++]=set.z,this._vdataUint32[s++]=Ls.toUint32(i.evaluate(0,1)),this._vdataF32[s++]=t[0].x,this._vdataF32[s++]=t[0].y,this._vdataF32[s++]=t[0].z,this._vdataF32[s++]=1,this._vdataF32[s++]=e.evaluate(0,1),this._vdataF32[s++]=0,this._vdataF32[s++]=1,this._vdataF32[s++]=set.x,this._vdataF32[s++]=set.y,this._vdataF32[s++]=set.z,this._vdataUint32[s++]=Ls.toUint32(i.evaluate(0,1));for(let r=1;r<t.length-1;r++){Ms.subtract(set,t[r-1],t[r]),Ms.subtract(ret,t[r+1],t[r]),Ms.subtract(ret,ret,set);const n=r/t.length;this._vdataF32[s++]=t[r].x,this._vdataF32[s++]=t[r].y,this._vdataF32[s++]=t[r].z,this._vdataF32[s++]=0,this._vdataF32[s++]=e.evaluate(n,1),this._vdataF32[s++]=n,this._vdataF32[s++]=0,this._vdataF32[s++]=ret.x,this._vdataF32[s++]=ret.y,this._vdataF32[s++]=ret.z,this._vdataUint32[s++]=Ls.toUint32(i.evaluate(n,1)),this._vdataF32[s++]=t[r].x,this._vdataF32[s++]=t[r].y,this._vdataF32[s++]=t[r].z,this._vdataF32[s++]=1,this._vdataF32[s++]=e.evaluate(n,1),this._vdataF32[s++]=n,this._vdataF32[s++]=1,this._vdataF32[s++]=ret.x,this._vdataF32[s++]=ret.y,this._vdataF32[s++]=ret.z,this._vdataUint32[s++]=Ls.toUint32(i.evaluate(n,1))}Ms.subtract(set,t[t.length-1],t[t.length-2]),this._vdataF32[s++]=t[t.length-1].x,this._vdataF32[s++]=t[t.length-1].y,this._vdataF32[s++]=t[t.length-1].z,this._vdataF32[s++]=0,this._vdataF32[s++]=e.evaluate(1,1),this._vdataF32[s++]=1,this._vdataF32[s++]=0,this._vdataF32[s++]=set.x,this._vdataF32[s++]=set.y,this._vdataF32[s++]=set.z,this._vdataUint32[s++]=Ls.toUint32(i.evaluate(1,1)),this._vdataF32[s++]=t[t.length-1].x,this._vdataF32[s++]=t[t.length-1].y,this._vdataF32[s++]=t[t.length-1].z,this._vdataF32[s++]=1,this._vdataF32[s++]=e.evaluate(1,1),this._vdataF32[s++]=1,this._vdataF32[s++]=1,this._vdataF32[s++]=set.x,this._vdataF32[s++]=set.y,this._vdataF32[s++]=set.z,this._vdataUint32[s++]=Ls.toUint32(i.evaluate(1,1))}this.updateIA(Math.max(0,t.length-1))}updateIA(t){const e=this._subModels[0].inputAssembler;e.vertexBuffers[0].update(this._vdataF32),e.firstIndex=0,e.indexCount=this._indexCount*t,e.vertexCount=this._iaVertCount}destroySubMeshData(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)}}var oet,aet;const het=yi.Attr.setClassAttr,cet=[["mode","constant","multiplier"],["mode","spline","multiplier"],["mode","splineMin","splineMax","multiplier"],["mode","constantMin","constantMax","multiplier"]],uet=pe({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3});let det=t("CurveRange",ah("cc.CurveRange")((aet=class{set mode(t){switch(this._mode=t,t){case uet.Constant:case uet.TwoConstants:break;case uet.Curve:this.spline||(this.spline=xu());break;case uet.TwoCurves:this.splineMax||(this.splineMax=xu()),this.splineMin||(this.splineMin=xu())}}get mode(){return this._mode}get curve(){var t;return null!==(t=this._curve)&&void 0!==t?t:this._curve=new Su(this.spline)}set curve(t){this._curve=t,this.spline=t._internalCurve}get curveMin(){var t;return null!==(t=this._curveMin)&&void 0!==t?t:this._curveMin=new Su(this.splineMin)}set curveMin(t){this._curveMin=t,this.splineMin=t._internalCurve}get curveMax(){var t;return null!==(t=this._curveMax)&&void 0!==t?t:this._curveMax=new Su(this.splineMax)}set curveMax(t){this._curveMax=t,this.splineMax=t._internalCurve}constructor(){this.constant=0,this.constantMin=0,this.constantMax=0,this.multiplier=1,this._mode=uet.Constant}evaluate(t,e){switch(this._mode){default:case uet.Constant:return this.constant;case uet.Curve:return this.spline.evaluate(t)*this.multiplier;case uet.TwoCurves:return Fi(this.splineMin.evaluate(t),this.splineMax.evaluate(t),e)*this.multiplier;case uet.TwoConstants:return Fi(this.constantMin,this.constantMax,e)}}getMax(){switch(this._mode){default:case uet.Constant:return this.constant;case uet.Curve:return this.multiplier;case uet.TwoConstants:return this.constantMax;case uet.TwoCurves:return this.multiplier}}isZero(){switch(this._mode){default:case uet.Constant:return Oi(this.constant,0,Mi);case uet.Curve:return Oi(this.multiplier,0,Mi);case uet.TwoConstants:return Oi(Math.max(Math.abs(this.constantMax),Math.abs(this.constantMin)),0,Mi);case uet.TwoCurves:return Oi(this.multiplier,0,Mi)}}_onBeforeSerialize(t){return cet[this._mode]}},aet.Mode=uet,oet=aet))||oet);function _et(t,e,i){switch(t.mode){case uet.Constant:return t.constant;case uet.Curve:return t.spline.evaluate(e)*t.multiplier;case uet.TwoCurves:return 0===i?t.splineMin.evaluate(e)*t.multiplier:t.splineMax.evaluate(e)*t.multiplier;case uet.TwoConstants:return 0===i?t.constantMin:t.constantMax;default:return 0}}function pet(t){switch(t.mode){case uet.TwoConstants:case uet.TwoCurves:return 2;default:return 1}}function met(t,e,i){const s=new Sm({width:e,height:i,_data:t,_compressed:!1,format:44}),r=new ff;return r.setFilters(1,1),r.setMipFilter(0),r.setWrapMode(2,2,2),r.image=s,r}function get(t,e,i,s){return null===t||i!==t.width||s!==t.height?(t&&t.destroy(),t=met(e,i,s)):t.uploadData(e),t}function fet(t,e,i,s){const r=pet(s),n=i*r*4;null!==e&&e.length===n||(e=new Float32Array(i*r*4));const o=1/(i-1);let a=0;for(let t=0;t<r;t++)for(let r=0;r<i;r++){const i=_et(s,o*r,t);e[a+2]=i,a+=4}return{texture:get(t,e,i,r),texdata:e}}function yet(t,e,i,s){const r=pet(s),n=i*r*4;null!==e&&e.length===n||(e=new Float32Array(i*r*4));const o=1/(i-1);let a=0,h=0;for(let t=0;t<r;t++)for(let r=0;r<i;r++)a=_et(s,o*r,t),e[h]=a,e[h+1]=a,e[h+2]=a,h+=4;return{texture:get(t,e,i,r),texdata:e}}function bet(t,e,i,s,r){const n=Math.max(pet(s),pet(r)),o=i*n*4;null!==e&&e.length===o||(e=new Float32Array(i*n*4));const a=[s,r],h=1/(i-1);for(let t=0;t<n;t++)for(let s=0;s<2;s++){const r=a[s];let n=0;for(let o=0;o<i;o++)n=_et(r,h*o,t),e[4*(t*i+o)+s]=n}return{texture:get(t,e,i,n),texdata:e}}function vet(t,e,i,s,r,n,o){const a=Math.max(pet(s),pet(r),pet(n)),h=i*a*4;null!==e&&e.length===h||(e=new Float32Array(i*a*4));const l=[s,r,n],c=1/(i-1);for(let t=0;t<a;t++)for(let s=0;s<3;s++){const r=l[s];let n=0,a=0;for(let h=0;h<i;h++){const l=_et(r,c*h,t);o?a=l:(n+=l,a=n/(h+1)),e[4*(t*i+h)+s]=a}}return{texture:get(t,e,i,a),texdata:e}}function Tet(t,e,i,s,r,n,o){const a=Math.max(pet(s),pet(r),pet(n),pet(o)),h=i*a*4;null!==e&&e.length===h||(e=new Float32Array(i*a*4));const l=[s,r,n,o],c=1/(i-1);for(let t=0;t<a;t++)for(let s=0;s<4;s++){const r=l[s];let n=0,o=0;for(let a=0;a<i;a++)n+=_et(r,c*a,t),o=n/(a+1),e[4*(t*i+a)+s]=o}return{texture:get(t,e,i,a),texdata:e}}var wet,xet,Cet,Aet,Det,Eet,Iet,Met,Pet,Oet,Ret,Bet,Fet,Net,Let,ket;yi.fastDefine("cc.CurveRange",det,{multiplier:1,constantMax:0,constantMin:0,constant:0,mode:uet.Constant,splineMax:Object.freeze(xu()),splineMin:Object.freeze(xu()),spline:Object.freeze(xu())}),het(det,"multiplier","visible",!0),het(det,"constantMax","visible",!0),het(det,"constantMin","visible",!0),het(det,"constant","visible",!0),ri(det,"mode",uet),het(det,"mode","visible",!0),het(det,"splineMax","type","Object"),het(det,"splineMax","ctor",hc),het(det,"splineMax","visible",!0),het(det,"splineMin","type","Object"),het(det,"splineMin","ctor",hc),het(det,"splineMin","visible",!0),het(det,"spline","type","Object"),het(det,"spline","ctor",hc),het(det,"spline","visible",!0);const zet=pe({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),Uet=new Ls,Vet=new Ls;let jet=t("GradientRange",(wet=ah("cc.GradientRange"),xet=Xh(zet),Cet=Xh(fu),Aet=Xh(fu),Det=Xh(fu),Eet=Xh(zet),wet((ket=class{constructor(){this.color=Pet&&Pet(),this.colorMin=Oet&&Oet(),this.colorMax=Ret&&Ret(),this.gradient=Bet&&Bet(),this.gradientMin=Fet&&Fet(),this.gradientMax=Net&&Net(),this._mode=Let&&Let(),this._color=Ls.WHITE.clone()}get mode(){return this._mode}set mode(t){this._mode=t}evaluate(t,e){switch(this._mode){case zet.Color:return this.color;case zet.TwoColors:return Ls.lerp(this._color,this.colorMin,this.colorMax,e),this._color;case zet.RandomColor:return this.gradient.getRandomColor(this._color);case zet.Gradient:return this.gradient.evaluateFast(this._color,t);case zet.TwoGradients:return Ls.lerp(this._color,this.gradientMin.evaluateFast(Uet,t),this.gradientMax.evaluateFast(Vet,t),e),this._color;default:return this.color}}_onBeforeSerialize(t){return(!1)[this._mode]}},ket.Mode=zet,s((Met=ket).prototype,"mode",[xet],Object.getOwnPropertyDescriptor(Met.prototype,"mode"),Met.prototype),Pet=Za(Met.prototype,"color",[vh],(function(){return Ls.WHITE.clone()})),Oet=Za(Met.prototype,"colorMin",[vh],(function(){return Ls.WHITE.clone()})),Ret=Za(Met.prototype,"colorMax",[vh],(function(){return Ls.WHITE.clone()})),Bet=Za(Met.prototype,"gradient",[Cet],(function(){return new fu})),Fet=Za(Met.prototype,"gradientMin",[Aet],(function(){return new fu})),Net=Za(Met.prototype,"gradientMax",[Det],(function(){return new fu})),Let=Za(Met.prototype,"_mode",[Eet],(function(){return zet.Color})),Iet=Met))||Iet));function Het(t,e,i){switch(t.mode){case zet.Color:return t.color;case zet.TwoColors:return 0===i?t.colorMin:t.colorMax;case zet.RandomColor:return t.gradient.getRandomColor(Uet);case zet.Gradient:return t.gradient.evaluateFast(Uet,e);case zet.TwoGradients:return 0===i?t.gradientMin.evaluateFast(Uet,e):t.gradientMax.evaluateFast(Uet,e);default:return t.color}}function Get(t){switch(t.mode){case zet.TwoColors:case zet.TwoGradients:return 2;default:return 1}}function Wet(t,e,i,s){const r=Get(s),n=i*r*4;null!==e&&e.length===n||(e=new Uint8Array(i*r*4));const o=1/(i-1);let a=0;for(let t=0;t<r;t++)for(let r=0;r<i;r++){const i=Het(s,o*r,t);e[a]=i.r,e[a+1]=i.g,e[a+2]=i.b,e[a+3]=i.a,a+=4}return null!==t&&i===t.width&&r===t.height||(t&&t.destroy(),(t=new ff).create(i,r,35),t.setFilters(2,2),t.setWrapMode(2,2)),t.uploadData(e),{texture:t,texdata:e}}var Xet,Yet,qet,$et,Ket,Zet,Qet,Jet,tit,eit,iit,sit,rit,nit,oit,ait,hit,lit,cit,uit;const dit="CC_USE_WORLD_SPACE",_it={CC_USE_WORLD_SPACE:!1,CC_USE_WORLD_SCALE:!0};let pit=(Xet=ah("cc.Line"),Yet=Xh(ff),qet=Xh(ff),$et=Xh(fv),Ket=Xh([Ms]),Zet=Xh([Ms]),Qet=Xh(det),Jet=Xh(jet),tit=Xh(kr),eit=Xh(kr),Xet((sit=class extends LB{get texture(){return this._texture}set texture(t){this._texture=t,this.material&&this.material.setProperty("mainTexture",t)}get lineMaterial(){return this.getSharedMaterial(0)}set lineMaterial(t){this.setSharedMaterial(t,0)}get sharedMaterials(){return super.sharedMaterials}set sharedMaterials(t){super.sharedMaterials=t}get worldSpace(){return this._worldSpace}set worldSpace(t){this._worldSpace=t;const e=this.getMaterialInstance(0);e&&(_it[dit]=this.worldSpace,e.recompileShaders(_it),this._models[0]&&this._models[0].setSubModelMaterial(0,e))}get positions(){return this._positions}set positions(t){this._positions=t,this._models[0]&&this._models[0].addLineVertexData(this._positions,this.width,this.color)}get width(){return this._width}set width(t){this._width=t,this._models[0]&&this._models[0].addLineVertexData(this._positions,this._width,this._color)}get color(){return this._color}set color(t){this._color=t,this._models[0]&&this._models[0].addLineVertexData(this._positions,this._width,this._color)}get tile(){return this._tile}set tile(t){this._tile.set(t),this.material&&(this._tile_offset.x=this._tile.x,this._tile_offset.y=this._tile.y,this.material.setProperty("mainTiling_Offset",this._tile_offset))}get offset(){return this._offset}set offset(t){this._offset.set(t),this.material&&(this._tile_offset.z=this._offset.x,this._tile_offset.w=this._offset.y,this.material.setProperty("mainTiling_Offset",this._tile_offset))}constructor(){super(),this._texture=rit&&rit(),this._material=nit&&nit(),this._worldSpace=oit&&oit(),this._positions=ait&&ait(),this._width=hit&&hit(),this._color=lit&&lit(),this._tile=cit&&cit(),this._tile_offset=new ms,this._offset=uit&&uit()}onLoad(){const t=a.director.root.createModel(net);if(0===this._models.length?this._models.push(t):this._models[0]=t,t.node=t.transform=this.node,this._material&&(this.lineMaterial=this._material,this._material=null),null===this.lineMaterial){const t=iC.get("default-trail-material");this.material=t}const e=this.getMaterialInstance(0);e&&(_it[dit]=this.worldSpace,e.recompileShaders(_it),t.updateMaterial(e)),t.setCapacity(100)}onEnable(){super.onEnable(),0!==this._models.length&&this._models[0]&&(this._attachToScene(),this.texture=this._texture,this.tile=this._tile,this.offset=this._offset,this._models[0].addLineVertexData(this._positions,this.width,this.color))}onDisable(){this._models.length>0&&this._models[0]&&this._detachFromScene()}_attachToScene(){if(super._attachToScene(),this._models.length>0&&this._models[0]&&this.node&&this.node.scene){const t=this._models[0];t.scene&&this._detachFromScene(),this._getRenderScene().addModel(t)}}_detachFromScene(){if(super._detachFromScene(),this._models.length>0&&this._models[0]){const t=this._models[0];t.scene&&t.scene.removeModel(t)}}_onMaterialModified(t,e){super._onMaterialModified(t,e);const i=this.getMaterialInstance(0);i&&(_it[dit]=this.worldSpace,i.recompileShaders(_it),this._models[0])&&this._models[0].updateMaterial(i)}},rit=Za(sit.prototype,"_texture",[Yet],(function(){return null})),s(sit.prototype,"texture",[qet],Object.getOwnPropertyDescriptor(sit.prototype,"texture"),sit.prototype),nit=Za(sit.prototype,"_material",[vh],(function(){return null})),s(sit.prototype,"lineMaterial",[$et],Object.getOwnPropertyDescriptor(sit.prototype,"lineMaterial"),sit.prototype),s(sit.prototype,"sharedMaterials",[Yh,vh],Object.getOwnPropertyDescriptor(sit.prototype,"sharedMaterials"),sit.prototype),oit=Za(sit.prototype,"_worldSpace",[vh],(function(){return!1})),ait=Za(sit.prototype,"_positions",[Ket],(function(){return[]})),s(sit.prototype,"positions",[Zet],Object.getOwnPropertyDescriptor(sit.prototype,"positions"),sit.prototype),s(sit.prototype,"width",[Qet],Object.getOwnPropertyDescriptor(sit.prototype,"width"),sit.prototype),hit=Za(sit.prototype,"_width",[vh],(function(){return new det})),s(sit.prototype,"color",[Jet],Object.getOwnPropertyDescriptor(sit.prototype,"color"),sit.prototype),lit=Za(sit.prototype,"_color",[vh],(function(){return new jet})),cit=Za(sit.prototype,"_tile",[vh],(function(){return new kr(1,1)})),s(sit.prototype,"tile",[tit],Object.getOwnPropertyDescriptor(sit.prototype,"tile"),sit.prototype),uit=Za(sit.prototype,"_offset",[vh],(function(){return new kr(0,0)})),s(sit.prototype,"offset",[eit],Object.getOwnPropertyDescriptor(sit.prototype,"offset"),sit.prototype),iit=sit))||iit);t({Line:pit,LineComponent:pit});let mit=class{constructor(t){this.particleSystem=void 0,this.position=void 0,this.velocity=void 0,this.animatedVelocity=void 0,this.ultimateVelocity=void 0,this.angularVelocity=void 0,this.axisOfRotation=void 0,this.rotation=void 0,this.startEuler=void 0,this.startRotation=void 0,this.startRotated=void 0,this.deltaQuat=void 0,this.deltaMat=void 0,this.localMat=void 0,this.startSize=void 0,this.size=void 0,this.startColor=void 0,this.color=void 0,this.randomSeed=void 0,this.remainingLifetime=void 0,this.loopCount=void 0,this.lastLoop=void 0,this.trailDelay=void 0,this.startLifetime=void 0,this.emitAccumulator0=void 0,this.emitAccumulator1=void 0,this.frameIndex=void 0,this.startRow=void 0,this.particleSystem=t,this.position=new Ms(0,0,0),this.velocity=new Ms(0,0,0),this.animatedVelocity=new Ms(0,0,0),this.ultimateVelocity=new Ms(0,0,0),this.angularVelocity=new Ms(0,0,0),this.axisOfRotation=new Ms(0,0,0),this.rotation=new Ms(0,0,0),this.startEuler=new Ms(0,0,0),this.startRotation=new sr,this.startRotated=!1,this.deltaQuat=new sr,this.deltaMat=new vr,this.localMat=new vr,this.startSize=new Ms(0,0,0),this.size=new Ms(0,0,0),this.startColor=Ls.WHITE.clone(),this.color=Ls.WHITE.clone(),this.randomSeed=0,this.remainingLifetime=0,this.loopCount=0,this.lastLoop=0,this.trailDelay=0,this.startLifetime=0,this.emitAccumulator0=0,this.emitAccumulator1=0,this.frameIndex=0,this.startRow=0}reset(){this.rotation.set(0,0,0),this.startEuler.set(0,0,0),this.startRotation.set(0,0,0,1),this.startRotated=!1,this.deltaQuat.set(0,0,0,1),this.deltaMat.identity(),this.localMat.identity()}};mit.INDENTIFY_NEG_QUAT=10,mit.R2D=180/Math.PI;const git="noiseModule",fit=["sizeModule","colorModule","forceModule","velocityModule","limitModule","rotationModule","textureModule","noiseModule"],yit=["_colorOverLifetimeModule","_shapeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule","_noiseModule","_trailModule"];class bit{constructor(){this.target=null,this.needUpdate=!1,this.needAnimate=!0,this.name=void 0}bindTarget(t){this.target=t}update(t,e){}}const vit=new Ms(0,0,-1);function Sit(t,e,i,s){return e!==t?(0===t||vr.invert(i,i),vr.getRotation(s,i),!0):(sr.set(s,0,0,0,1),!1)}function Tit(t,e){kr.set(t,Math.cos(e),Math.sin(e))}function wit(t){const e=Ui(-1,1),i=Ui(0,2*Math.PI),s=Math.sqrt(1-e*e),r=s*Math.cos(i),n=s*Math.sin(i);Ms.set(t,r,n,e)}function xit(t,e,i){wit(t),Ms.multiplyScalar(t,t,e+(i-e)*ki())}function Cit(t,e,i,s){Tit(t,s),t.z=0,Ms.multiplyScalar(t,t,e+(i-e)*ki())}function Ait(t){for(let e=0;e<t.length;e++){const i=e+Vi(0,t.length-e),s=t[i];t[i]=t[e],t[e]=s}}function Dit(){let t=Ui(-1,1);return 0===t&&t++,d(t)}function Eit(t){const e=det.Mode;switch(t.mode){case e.TwoCurves:case e.TwoConstants:return!0;default:return!1}}function Iit(t){const e=jet.Mode;switch(t.mode){case e.TwoGradients:case e.TwoColors:return!0;default:return!1}}var Mit,Pit,Oit,Rit,Bit,Fit;let Nit=(Mit=ah("cc.ColorOvertimeModule"),Pit=Xh(jet),Mit((Rit=class extends bit{constructor(){super(),this._enable=Bit&&Bit(),this.color=Fit&&Fit(),this.name="colorModule"}get enable(){return this._enable}set enable(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}animate(t){t.color.set(t.startColor);const e=Iit(this.color)?ji(t.randomSeed+91041):0;t.color.multiply(this.color.evaluate(1-t.remainingLifetime/t.startLifetime,e))}},Bit=Za(Rit.prototype,"_enable",[vh],(function(){return!1})),Fit=Za(Rit.prototype,"color",[Pit,vh],(function(){return new jet})),Oit=Rit))||Oit);const Lit={World:0,Local:1,Custom:2};pe(Lit);const kit={Pause:0,PauseAndCatchup:1,AlwaysSimulate:2};pe(kit);const zit={World:0,Local:1,View:2};pe(zit);const Uit={Billboard:0,StrecthedBillboard:1,HorizontalBillboard:2,VerticalBillboard:3,Mesh:4};pe(Uit);const Vit={Box:0,Circle:1,Cone:2,Sphere:3,Hemisphere:4};pe(Vit);const jit={Base:0,Edge:1,Shell:2,Volume:3};pe(jit);const Hit={Random:0,Loop:1,PingPong:2};pe(Hit);const Git={Particles:0};pe(Git);const Wit={Stretch:0};var Xit,Yit,qit,$it,Kit,Zit,Qit,Jit,tst,est,ist,sst;pe(Wit);const rst=212165,nst=new Ms;let ost=(Xit=ah("cc.ForceOvertimeModule"),Yit=Xh(det),qit=Xh(det),$it=Xh(det),Kit=Xh(Lit),Xit((Qit=class extends bit{get enable(){return this._enable}set enable(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}constructor(){super(),this._enable=Jit&&Jit(),this.x=tst&&tst(),this.y=est&&est(),this.z=ist&&ist(),this.space=sst&&sst(),this.randomized=!1,this.rotation=void 0,this.needTransform=void 0,this.name="forceModule",this.rotation=new sr,this.needTransform=!1,this.needUpdate=!0}update(t,e){this.needTransform=Sit(t,this.space,e,this.rotation)}animate(t,e){const i=1-t.remainingLifetime/t.startLifetime,s=Eit(this.x)?ji(t.randomSeed+rst):0,r=Eit(this.y)?ji(t.randomSeed+rst):0,n=Eit(this.z)?ji(t.randomSeed+rst):0,o=Ms.set(nst,this.x.evaluate(i,s),this.y.evaluate(i,r),this.z.evaluate(i,n));this.needTransform&&Ms.transformQuat(o,o,this.rotation),Ms.scaleAndAdd(t.velocity,t.velocity,o,e),Ms.copy(t.ultimateVelocity,t.velocity)}},Jit=Za(Qit.prototype,"_enable",[vh],(function(){return!1})),tst=Za(Qit.prototype,"x",[Yit,vh],(function(){return new det})),est=Za(Qit.prototype,"y",[qit,vh],(function(){return new det})),ist=Za(Qit.prototype,"z",[$it,vh],(function(){return new det})),sst=Za(Qit.prototype,"space",[Kit,vh],(function(){return 1})),Zit=Qit))||Zit);var ast,hst,lst,cst,ust,dst,_st,pst,mst,gst,fst,yst,bst,vst,Sst,Tst;const wst=23541,xst=new Ms,Cst=new Ms;let Ast=(ast=ah("cc.LimitVelocityOvertimeModule"),hst=Xh(det),lst=Xh(det),cst=Xh(det),ust=Xh(det),dst=Xh(Lit),ast((pst=class extends bit{get enable(){return this._enable}set enable(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}constructor(){super(),this._enable=mst&&mst(),this.limitX=gst&&gst(),this.limitY=fst&&fst(),this.limitZ=yst&&yst(),this.limit=bst&&bst(),this.dampen=vst&&vst(),this.separateAxes=Sst&&Sst(),this.space=Tst&&Tst(),this.drag=null,this.multiplyDragByParticleSize=!1,this.multiplyDragByParticleVelocity=!1,this.name="limitModule",this.rotation=void 0,this.needTransform=void 0,this.rotation=new sr,this.needTransform=!1,this.needUpdate=!0}update(t,e){this.needTransform=Sit(t,this.space,e,this.rotation)}animate(t,e){const i=1-t.remainingLifetime/t.startLifetime,s=xst;if(this.separateAxes){const e=Eit(this.limitX)?ji(t.randomSeed+wst):0,r=Eit(this.limitY)?ji(t.randomSeed+wst):0,n=Eit(this.limitZ)?ji(t.randomSeed+wst):0;Ms.set(Cst,this.limitX.evaluate(i,e),this.limitY.evaluate(i,r),this.limitZ.evaluate(i,n)),this.needTransform&&Ms.transformQuat(Cst,Cst,this.rotation),Ms.set(s,Dst(t.ultimateVelocity.x,Cst.x,this.dampen),Dst(t.ultimateVelocity.y,Cst.y,this.dampen),Dst(t.ultimateVelocity.z,Cst.z,this.dampen))}else{Ms.normalize(s,t.ultimateVelocity);const e=Eit(this.limit)?ji(t.randomSeed+wst):0;Ms.multiplyScalar(s,s,Dst(t.ultimateVelocity.length(),this.limit.evaluate(i,e),this.dampen))}Ms.copy(t.ultimateVelocity,s),Ms.copy(t.velocity,t.ultimateVelocity)}},mst=Za(pst.prototype,"_enable",[vh],(function(){return!1})),gst=Za(pst.prototype,"limitX",[hst,vh],(function(){return new det})),fst=Za(pst.prototype,"limitY",[lst,vh],(function(){return new det})),yst=Za(pst.prototype,"limitZ",[cst,vh],(function(){return new det})),bst=Za(pst.prototype,"limit",[ust,vh],(function(){return new det})),vst=Za(pst.prototype,"dampen",[vh],(function(){return 3})),Sst=Za(pst.prototype,"separateAxes",[vh],(function(){return!1})),Tst=Za(pst.prototype,"space",[dst,vh],(function(){return 1})),_st=pst))||_st);function Dst(t,e,i){const s=Math.sign(t);let r=Math.abs(t);if(r>e){const t=r-r*i;r=t>e?t:e}return r*s}var Est,Ist,Mst,Pst,Ost,Rst,Bst,Fst,Nst,Lst,kst;const zst=125292;let Ust=(Est=ah("cc.RotationOvertimeModule"),Ist=Xh(det),Mst=Xh(det),Pst=Xh(det),Est((Rst=class extends bit{constructor(){super(),this._enable=Bst&&Bst(),this._separateAxes=Fst&&Fst(),this.x=Nst&&Nst(),this.y=Lst&&Lst(),this.z=kst&&kst(),this.name="rotationModule",this._startMat=new vr,this._matRot=new vr,this._quatRot=new sr,this._otherEuler=new Ms}get enable(){return this._enable}set enable(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}get separateAxes(){return this._separateAxes}set separateAxes(t){this._separateAxes=t}_processRotation(t,e){const i=t.particleSystem.processor.getInfo().renderMode;4!==i&&1===i&&this._quatRot.set(0,0,0,1),sr.normalize(this._quatRot,this._quatRot),this._quatRot.w<0&&(this._quatRot.x+=mit.INDENTIFY_NEG_QUAT)}animate(t,e){const i=1-t.remainingLifetime/t.startLifetime,s=Eit(this.z)?ji(t.randomSeed+zst):0,r=t.particleSystem.processor.getInfo().renderMode;if(this._separateAxes&&3!==r&&2!==r){const r=Eit(this.x)?ji(t.randomSeed+zst):0,n=Eit(this.y)?ji(t.randomSeed+zst):0;sr.fromEuler(t.deltaQuat,this.x.evaluate(i,r)*e*mit.R2D,this.y.evaluate(i,n)*e*mit.R2D,this.z.evaluate(i,s)*e*mit.R2D)}else sr.fromEuler(t.deltaQuat,0,0,this.z.evaluate(i,s)*e*mit.R2D);t.deltaMat=vr.fromQuat(t.deltaMat,t.deltaQuat),t.localMat=t.localMat.multiply(t.deltaMat),t.startRotated||(4!==r&&(1===r?t.startEuler.set(0,0,0):0!==r&&t.startEuler.set(0,0,t.startEuler.z)),sr.fromEuler(t.startRotation,t.startEuler.x*mit.R2D,t.startEuler.y*mit.R2D,t.startEuler.z*mit.R2D),t.startRotated=!0),this._startMat=vr.fromQuat(this._startMat,t.startRotation),this._matRot=this._startMat.multiply(t.localMat),vr.getRotation(this._quatRot,this._matRot),this._processRotation(t,mit.R2D),t.rotation.set(this._quatRot.x,this._quatRot.y,this._quatRot.z)}},Bst=Za(Rst.prototype,"_enable",[vh],(function(){return!1})),Fst=Za(Rst.prototype,"_separateAxes",[vh],(function(){return!1})),Nst=Za(Rst.prototype,"x",[Ist,vh],(function(){return new det})),Lst=Za(Rst.prototype,"y",[Mst,vh],(function(){return new det})),kst=Za(Rst.prototype,"z",[Pst,vh],(function(){return new det})),Ost=Rst))||Ost);var Vst,jst,Hst,Gst,Wst,Xst,Yst,qst,$st,Kst,Zst,Qst,Jst;const trt=39825;let ert=(Vst=ah("cc.SizeOvertimeModule"),jst=Xh(det),Hst=Xh(det),Gst=Xh(det),Wst=Xh(det),Vst((Yst=class extends bit{constructor(){super(),this._enable=qst&&qst(),this.separateAxes=$st&&$st(),this.size=Kst&&Kst(),this.x=Zst&&Zst(),this.y=Qst&&Qst(),this.z=Jst&&Jst(),this.name="sizeModule"}get enable(){return this._enable}set enable(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}animate(t,e){if(this.separateAxes){const e=1-t.remainingLifetime/t.startLifetime,i=Eit(this.x)?ji(t.randomSeed+trt):0,s=Eit(this.y)?ji(t.randomSeed+trt):0,r=Eit(this.z)?ji(t.randomSeed+trt):0;t.size.x=t.startSize.x*this.x.evaluate(e,i),t.size.y=t.startSize.y*this.y.evaluate(e,s),t.size.z=t.startSize.z*this.z.evaluate(e,r)}else{const e=Eit(this.size)?ji(t.randomSeed+trt):0;Ms.multiplyScalar(t.size,t.startSize,this.size.evaluate(1-t.remainingLifetime/t.startLifetime,e))}}},qst=Za(Yst.prototype,"_enable",[vh],(function(){return!1})),$st=Za(Yst.prototype,"separateAxes",[vh],(function(){return!1})),Kst=Za(Yst.prototype,"size",[jst,vh],(function(){return new det})),Zst=Za(Yst.prototype,"x",[Hst,vh],(function(){return new det})),Qst=Za(Yst.prototype,"y",[Gst,vh],(function(){return new det})),Jst=Za(Yst.prototype,"z",[Wst,vh],(function(){return new det})),Xst=Yst))||Xst);var irt,srt,rrt,nrt,ort,art,hrt,lrt,crt,urt,drt,_rt,prt,mrt,grt,frt,yrt,brt,vrt,Srt,Trt,wrt,xrt;const Crt=pe({Grid:0}),Art=pe({WholeSheet:0,SingleRow:1});let Drt=(irt=ah("cc.TextureAnimationModule"),srt=Sh("numTilesX"),rrt=Sh("numTilesY"),nrt=Xh(Crt),ort=Xh(Crt),art=Xh(Art),hrt=Xh(det),lrt=Xh(det),irt((urt=class extends bit{constructor(){super(),this._enable=drt&&drt(),this._numTilesX=_rt&&_rt(),this._numTilesY=prt&&prt(),this._mode=mrt&&mrt(),this.animation=grt&&grt(),this.frameOverTime=frt&&frt(),this.startFrame=yrt&&yrt(),this.cycleCount=brt&&brt(),this._flipU=vrt&&vrt(),this._flipV=Srt&&Srt(),this._uvChannelMask=Trt&&Trt(),this.randomRow=wrt&&wrt(),this.rowIndex=xrt&&xrt(),this.name="textureModule"}get enable(){return this._enable}set enable(t){this._enable!==t&&(this._enable=t,this.target&&(this.target.updateMaterialParams(),this.target.enableModule(this.name,t,this)))}get mode(){return this._mode}set mode(t){t!==Crt.Grid&&P("particle texture animation's sprites is not supported!")}get numTilesX(){return this._numTilesX}set numTilesX(t){this._numTilesX!==t&&(this._numTilesX=t,this.target.updateMaterialParams())}get numTilesY(){return this._numTilesY}set numTilesY(t){this._numTilesY!==t&&(this._numTilesY=t,this.target.updateMaterialParams())}get flipU(){return this._flipU}set flipU(t){P("particle texture animation's flipU is not supported!")}get flipV(){return this._flipV}set flipV(t){P("particle texture animation's flipV is not supported!")}get uvChannelMask(){return this._uvChannelMask}set uvChannelMask(t){P("particle texture animation's uvChannelMask is not supported!")}init(t){t.startRow=Math.floor(ki()*this.numTilesY)}animate(t,e){const i=1-t.remainingLifetime/t.startLifetime,s=Eit(this.startFrame)?ji(t.randomSeed+90794):0,r=Eit(this.frameOverTime)?ji(t.randomSeed+90794):0,n=this.startFrame.evaluate(i,s)/(this.numTilesX*this.numTilesY);if(this.animation===Art.WholeSheet)t.frameIndex=Xi(this.cycleCount*(this.frameOverTime.evaluate(i,r)+n),1);else if(this.animation===Art.SingleRow){const e=1/this.numTilesY;if(this.randomRow){const s=Xi(this.cycleCount*(this.frameOverTime.evaluate(i,r)+n),1),o=t.startRow*e,a=o+e;t.frameIndex=Fi(o,a,s)}else{const s=this.rowIndex*e,o=s+e;t.frameIndex=Fi(s,o,Xi(this.cycleCount*(this.frameOverTime.evaluate(i,r)+n),1))}}}scaleNumTilesXY(t){this._numTilesX*=t,this._numTilesY*=t}},drt=Za(urt.prototype,"_enable",[vh],(function(){return!1})),_rt=Za(urt.prototype,"_numTilesX",[srt],(function(){return 0})),prt=Za(urt.prototype,"_numTilesY",[rrt],(function(){return 0})),mrt=Za(urt.prototype,"_mode",[nrt],(function(){return Crt.Grid})),s(urt.prototype,"mode",[ort],Object.getOwnPropertyDescriptor(urt.prototype,"mode"),urt.prototype),grt=Za(urt.prototype,"animation",[art,vh],(function(){return Art.WholeSheet})),frt=Za(urt.prototype,"frameOverTime",[hrt,vh],(function(){return new det})),yrt=Za(urt.prototype,"startFrame",[lrt,vh],(function(){return new det})),brt=Za(urt.prototype,"cycleCount",[vh],(function(){return 0})),vrt=Za(urt.prototype,"_flipU",[vh],(function(){return 0})),Srt=Za(urt.prototype,"_flipV",[vh],(function(){return 0})),Trt=Za(urt.prototype,"_uvChannelMask",[vh],(function(){return-1})),wrt=Za(urt.prototype,"randomRow",[vh],(function(){return!1})),xrt=Za(urt.prototype,"rowIndex",[vh],(function(){return 0})),crt=urt))||crt);var Ert,Irt,Mrt,Prt,Ort,Rrt,Brt,Frt,Nrt,Lrt,krt,zrt,Urt,Vrt;const jrt=197866,Hrt=new Ms;let Grt=(Ert=ah("cc.VelocityOvertimeModule"),Irt=Xh(det),Mrt=Xh(det),Prt=Xh(det),Ort=Xh(det),Rrt=Xh(Lit),Ert((Frt=class extends bit{get enable(){return this._enable}set enable(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}constructor(){super(),this._enable=Nrt&&Nrt(),this.x=Lrt&&Lrt(),this.y=krt&&krt(),this.z=zrt&&zrt(),this.speedModifier=Urt&&Urt(),this.space=Vrt&&Vrt(),this.rotation=void 0,this.needTransform=void 0,this.name="velocityModule",this.rotation=new sr,this.speedModifier.constant=1,this.needTransform=!1,this.needUpdate=!0}update(t,e){this.needTransform=Sit(t,this.space,e,this.rotation)}animate(t,e){const i=1-t.remainingLifetime/t.startLifetime,s=Eit(this.x)?ji(t.randomSeed^jrt):0,r=Eit(this.y)?ji(156497^t.randomSeed):0,n=Eit(this.z)?ji(984136^t.randomSeed):0,o=Eit(this.speedModifier)?ji(t.randomSeed+jrt):0,a=Ms.set(Hrt,this.x.evaluate(i,s),this.y.evaluate(i,r),this.z.evaluate(i,n));this.needTransform&&Ms.transformQuat(a,a,this.rotation),Ms.add(t.animatedVelocity,t.animatedVelocity,a),Ms.add(t.ultimateVelocity,t.velocity,t.animatedVelocity),Ms.multiplyScalar(t.ultimateVelocity,t.ultimateVelocity,this.speedModifier.evaluate(1-t.remainingLifetime/t.startLifetime,o))}},Nrt=Za(Frt.prototype,"_enable",[vh],(function(){return!1})),Lrt=Za(Frt.prototype,"x",[Irt,vh],(function(){return new det})),krt=Za(Frt.prototype,"y",[Mrt,vh],(function(){return new det})),zrt=Za(Frt.prototype,"z",[Prt,vh],(function(){return new det})),Urt=Za(Frt.prototype,"speedModifier",[Ort,vh],(function(){return new det})),Vrt=Za(Frt.prototype,"space",[Rrt,vh],(function(){return 1})),Brt=Frt))||Brt);var Wrt,Xrt,Yrt,qrt,$rt,Krt,Zrt,Qrt;let Jrt=t("Burst",(Wrt=ah("cc.Burst"),Xrt=Xh(det),Wrt((qrt=class{get time(){return this._time}set time(t){this._time=t,this._curTime=t}get repeatCount(){return this._repeatCount}set repeatCount(t){this._repeatCount=t,this._remainingCount=t}constructor(){this._time=$rt&&$rt(),this._repeatCount=Krt&&Krt(),this.repeatInterval=Zrt&&Zrt(),this.count=Qrt&&Qrt(),this._remainingCount=0,this._curTime=0}update(t,e){if(0===this._remainingCount&&(this._remainingCount=this._repeatCount,this._curTime=this._time),this._remainingCount>0){let i=Xi(t.time-t.startDelay.evaluate(0,1),t.duration)-e;i=i>0?i:0;const s=Xi(t.time-t.startDelay.evaluate(0,1),t.duration);this._curTime>=i&&this._curTime<s&&(t.emit(this.count.evaluate(this._curTime/t.duration,1),e-(s-this._curTime)),this._curTime+=this.repeatInterval,--this._remainingCount)}}reset(){this._remainingCount=0,this._curTime=0}getMaxCount(t){return this.count.getMax()*Math.min(Math.ceil(t.duration/this.repeatInterval),this.repeatCount)}},$rt=Za(qrt.prototype,"_time",[vh],(function(){return 0})),Krt=Za(qrt.prototype,"_repeatCount",[vh],(function(){return 1})),Zrt=Za(qrt.prototype,"repeatInterval",[vh],(function(){return 1})),Qrt=Za(qrt.prototype,"count",[Xrt,vh],(function(){return new det})),Yrt=qrt))||Yrt));var tnt,ent,int,snt,rnt,nnt,ont,ant,hnt,lnt,cnt,unt,dnt,_nt,pnt,mnt,gnt,fnt,ynt,bnt,vnt,Snt,Tnt,wnt,xnt,Cnt,Ant,Dnt;const Ent=new Ms(0,0,0),Int=[0,0,0],Mnt=new Ms(.5,.5,.5);let Pnt=(tnt=ah("cc.ShapeModule"),ent=Xh(Vit),int=Sh("shapeType"),snt=Xh(Vit),rnt=Xh(jit),nnt=Xh(Hit),ont=Xh(det),tnt((hnt=class{get position(){return this._position}set position(t){this._position=t,this.constructMat()}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this.constructMat()}get scale(){return this._scale}set scale(t){this._scale=t,this.constructMat()}get arc(){return Li(this._arc)}set arc(t){this._arc=Ni(t)}get angle(){return Math.round(100*Li(this._angle))/100}set angle(t){this._angle=Ni(t)}get enable(){return this._enable}set enable(t){this._enable=t}get shapeType(){return this._shapeType}set shapeType(t){switch(this._shapeType=t,this._shapeType){case 0:0===this.emitFrom&&(this.emitFrom=3);break;case 2:1===this.emitFrom&&(this.emitFrom=0);break;case 3:case 4:0!==this.emitFrom&&1!==this.emitFrom||(this.emitFrom=3)}}constructor(){this._enable=lnt&&lnt(),this._shapeType=cnt&&cnt(),this.emitFrom=unt&&unt(),this.alignToDirection=dnt&&dnt(),this.randomDirectionAmount=_nt&&_nt(),this.sphericalDirectionAmount=pnt&&pnt(),this.randomPositionAmount=mnt&&mnt(),this.radius=gnt&&gnt(),this.radiusThickness=fnt&&fnt(),this.arcMode=ynt&&ynt(),this.arcSpread=bnt&&bnt(),this.arcSpeed=vnt&&vnt(),this.length=Snt&&Snt(),this.boxThickness=Tnt&&Tnt(),this._position=wnt&&wnt(),this._rotation=xnt&&xnt(),this._scale=Cnt&&Cnt(),this._arc=Ant&&Ant(),this._angle=Dnt&&Dnt(),this.mat=new vr,this.quat=new sr,this.particleSystem=null,this.lastTime=0,this.totalAngle=0}onInit(t){this.particleSystem=t,this.constructMat(),this.lastTime=this.particleSystem.time}emit(t){switch(this.shapeType){case 0:Fnt(this.emitFrom,this.boxThickness,t.position,t.velocity);break;case 1:Nnt(this.radius,this.radiusThickness,this.generateArcAngle(),t.position,t.velocity);break;case 2:Bnt(this.emitFrom,this.radius,this.radiusThickness,this.generateArcAngle(),this._angle,this.length,t.position,t.velocity);break;case 3:Ont(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;case 4:Rnt(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;default:M(`${this.shapeType} shapeType is not supported by ShapeModule.`)}if(this.randomPositionAmount>0&&(t.position.x+=Ui(-this.randomPositionAmount,this.randomPositionAmount),t.position.y+=Ui(-this.randomPositionAmount,this.randomPositionAmount),t.position.z+=Ui(-this.randomPositionAmount,this.randomPositionAmount)),Ms.transformQuat(t.velocity,t.velocity,this.quat),Ms.transformMat4(t.position,t.position,this.mat),this.sphericalDirectionAmount>0){const e=Ms.normalize(Ent,t.position);Ms.lerp(t.velocity,t.velocity,e,this.sphericalDirectionAmount)}this.lastTime=this.particleSystem.time}constructMat(){sr.fromEuler(this.quat,this._rotation.x,this._rotation.y,this._rotation.z),vr.fromRTS(this.mat,this.quat,this._position,this._scale)}generateArcAngle(){if(0===this.arcMode)return Ui(0,this._arc);let t=this.totalAngle+2*Math.PI*this.arcSpeed.evaluate(this.particleSystem.time,1)*(this.particleSystem.time-this.lastTime);switch(this.totalAngle=t,0!==this.arcSpread&&(t=Math.floor(t/(this._arc*this.arcSpread))*this._arc*this.arcSpread),this.arcMode){case 1:default:return Xi(t,this._arc);case 2:return Yi(t,this._arc)}}},lnt=Za(hnt.prototype,"_enable",[vh],(function(){return!1})),cnt=Za(hnt.prototype,"_shapeType",[ent,int],(function(){return 2})),s(hnt.prototype,"shapeType",[snt],Object.getOwnPropertyDescriptor(hnt.prototype,"shapeType"),hnt.prototype),unt=Za(hnt.prototype,"emitFrom",[rnt,vh],(function(){return 3})),dnt=Za(hnt.prototype,"alignToDirection",[vh],(function(){return!1})),_nt=Za(hnt.prototype,"randomDirectionAmount",[vh],(function(){return 0})),pnt=Za(hnt.prototype,"sphericalDirectionAmount",[vh],(function(){return 0})),mnt=Za(hnt.prototype,"randomPositionAmount",[vh],(function(){return 0})),gnt=Za(hnt.prototype,"radius",[vh],(function(){return 1})),fnt=Za(hnt.prototype,"radiusThickness",[vh],(function(){return 1})),ynt=Za(hnt.prototype,"arcMode",[nnt,vh],(function(){return 0})),bnt=Za(hnt.prototype,"arcSpread",[vh],(function(){return 0})),vnt=Za(hnt.prototype,"arcSpeed",[ont,vh],(function(){return new det})),Snt=Za(hnt.prototype,"length",[vh],(function(){return 5})),Tnt=Za(hnt.prototype,"boxThickness",[vh],(function(){return new Ms(0,0,0)})),wnt=Za(hnt.prototype,"_position",[vh],(function(){return new Ms(0,0,0)})),xnt=Za(hnt.prototype,"_rotation",[vh],(function(){return new Ms(0,0,0)})),Cnt=Za(hnt.prototype,"_scale",[vh],(function(){return new Ms(1,1,1)})),Ant=Za(hnt.prototype,"_arc",[vh],(function(){return Ni(360)})),Dnt=Za(hnt.prototype,"_angle",[vh],(function(){return Ni(25)})),ant=hnt))||ant);function Ont(t,e,i,s,r){switch(t){case 3:xit(s,e*(1-i),e),Ms.normalize(r,s);break;case 2:wit(s),Ms.multiplyScalar(s,s,e),Ms.normalize(r,s);break;default:M(`${t} is not supported for sphere emitter.`)}}function Rnt(t,e,i,s,r){switch(t){case 3:xit(s,e*(1-i),e),s.z>0&&(s.z*=-1),Ms.normalize(r,s);break;case 2:wit(s),Ms.multiplyScalar(s,s,e),s.z>0&&(s.z*=-1),Ms.normalize(r,s);break;default:M(`${t} is not supported for hemisphere emitter.`)}}function Bnt(t,e,i,s,r,n,o,a){switch(t){case 0:Cit(o,e*(1-i),e,s),kr.multiplyScalar(a,o,Math.sin(r)),a.z=-Math.cos(r)*e,Ms.normalize(a,a),o.z=0;break;case 2:Tit(o,s),kr.multiplyScalar(a,o,Math.sin(r)),a.z=-Math.cos(r),Ms.normalize(a,a),kr.multiplyScalar(o,o,e),o.z=0;break;case 3:Cit(o,e*(1-i),e,s),kr.multiplyScalar(a,o,Math.sin(r)),a.z=-Math.cos(r)*e,Ms.normalize(a,a),o.z=0,Ms.add(o,o,Ms.multiplyScalar(Ent,a,n*ki()/-a.z));break;default:M(`${t} is not supported for cone emitter.`)}}function Fnt(t,e,i,s){switch(t){case 3:r=i,n=Mnt,Ms.set(r,Ui(-n.x,n.x),Ui(-n.y,n.y),Ui(-n.z,n.z));break;case 2:Int[0]=Ui(-.5,.5),Int[1]=Ui(-.5,.5),Int[2]=.5*Dit(),Ait(Int),Lnt(Int,e),Ms.set(i,Int[0],Int[1],Int[2]);break;case 1:Int[0]=Ui(-.5,.5),Int[1]=.5*Dit(),Int[2]=.5*Dit(),Ait(Int),Lnt(Int,e),Ms.set(i,Int[0],Int[1],Int[2]);break;default:M(`${t} is not supported for box emitter.`)}var r,n;Ms.copy(s,vit)}function Nnt(t,e,i,s,r){Cit(s,t*(1-e),t,i),Ms.normalize(r,s)}function Lnt(t,e){e.x>0&&(t[0]+=.5*Ui(-e.x,e.x),t[0]=Ri(t[0],-.5,.5)),e.y>0&&(t[1]+=.5*Ui(-e.y,e.y),t[1]=Ri(t[1],-.5,.5)),e.z>0&&(t[2]+=.5*Ui(-e.z,e.z),t[2]=Ri(t[2],-.5,.5))}const knt=[0,0,1,0,0,1,1,1],znt=[0,0,0,1,0,0,0,1,0,1,1,0];class Unt extends mb{constructor(){super(),this._capacity=void 0,this._bufferSize=void 0,this._vertAttrs=void 0,this._vertAttribSize=void 0,this._vBuffer=void 0,this._vertAttrsFloatCount=void 0,this._vdataF32=void 0,this._vdataUint32=void 0,this._subMeshData=void 0,this._mesh=void 0,this._vertCount=0,this._indexCount=0,this._startTimeOffset=0,this._lifeTimeOffset=0,this._material=null,this._vertAttribSizeStatic=void 0,this._vertStaticAttrsFloatCount=void 0,this._insBuffers=void 0,this._insIndices=void 0,this._useInstance=void 0,this._iaVertCount=0,this._iaIndexCount=0,this._registerListeners(),this.type=4,this._capacity=0,this._bufferSize=16,this._vertAttrs=null,this._vertAttribSize=0,this._vBuffer=null,this._vertAttrsFloatCount=0,this._vdataF32=null,this._vdataUint32=null,this._vertAttribSizeStatic=0,this._vertStaticAttrsFloatCount=0,this._insBuffers=[],this._insIndices=null,yp.gfxDevice.hasFeature(1)?this._useInstance=!0:this._useInstance=!1,this._subMeshData=null,this._mesh=null}setCapacity(t){const e=this._capacity!==t;this._capacity=t,this._bufferSize=Math.max(this._capacity,16),this._subMeshData&&e&&this.rebuild()}setVertexAttributes(t,e){if(this._useInstance)this.setVertexAttributesIns(t,e);else{if(this._mesh===t&&this._vertAttrs===e)return;this._mesh=t,this._vertAttrs=e,this._vertAttribSize=0;for(const t of this._vertAttrs)t.offset=this._vertAttribSize,this._vertAttribSize+=tp[t.format].size;this._vertAttrsFloatCount=this._vertAttribSize/4,this.rebuild()}}setVertexAttributesIns(t,e){if(this._mesh!==t||this._vertAttrs!==e){this._mesh=t,this._vertAttrs=e,this._vertAttribSize=0,this._vertAttribSizeStatic=0;for(const t of this._vertAttrs)0===t.stream?(t.offset=this._vertAttribSize,this._vertAttribSize+=tp[t.format].size):1===t.stream&&(t.offset=this._vertAttribSizeStatic,this._vertAttribSizeStatic+=tp[t.format].size);this._vertAttrsFloatCount=this._vertAttribSize/4,this._vertStaticAttrsFloatCount=this._vertAttribSizeStatic/4,this.rebuild()}}createSubMeshData(){this.destroySubMeshData(),this._vertCount=4,this._indexCount=6,this._mesh&&(this._vertCount=this._mesh.struct.vertexBundles[this._mesh.struct.primitives[0].vertexBundelIndices[0]].view.count,this._indexCount=this._mesh.struct.primitives[0].indexView.count);const t=this._device.createBuffer(new a_(10,3,this._vertAttribSize*this._bufferSize*this._vertCount,this._vertAttribSize)),e=new ArrayBuffer(this._vertAttribSize*this._bufferSize*this._vertCount);if(this._mesh&&this._capacity>0){let t=this._vertAttrs[this._vertAttrs.findIndex((t=>"a_texCoord"===t.name))].offset;this._mesh.copyAttribute(0,"a_texCoord",e,this._vertAttribSize,t);let i=this._vertAttrs.findIndex((t=>"a_texCoord3"===t.name));if(t=this._vertAttrs[i++].offset,this._mesh.copyAttribute(0,"a_position",e,this._vertAttribSize,t),t=this._vertAttrs[i++].offset,this._mesh.copyAttribute(0,"a_normal",e,this._vertAttribSize,t),t=this._vertAttrs[i++].offset,!this._mesh.copyAttribute(0,"a_color",e,this._vertAttribSize,t)){const i=new Uint32Array(e);for(let e=0;e<this._vertCount;++e)i[e*this._vertAttrsFloatCount+t/4]=Ls.toUint32(Ls.WHITE)}const s=new Float32Array(e);for(let t=1;t<this._capacity;t++)s.copyWithin(t*this._vertAttribSize*this._vertCount/4,0,this._vertAttribSize*this._vertCount/4)}t.update(e);const i=new Uint16Array(this._bufferSize*this._indexCount);if(this._mesh&&this._capacity>0){this._mesh.copyIndices(0,i);for(let t=1;t<this._capacity;t++)for(let e=0;e<this._indexCount;e++)i[t*this._indexCount+e]=i[e]+t*this._vertCount}else{let t=0;for(let e=0;e<this._capacity;++e){const s=4*e;i[t++]=s,i[t++]=s+1,i[t++]=s+2,i[t++]=s+3,i[t++]=s+2,i[t++]=s+1}}const s=this._device.createBuffer(new a_(6,1,this._bufferSize*this._indexCount*2,2));return s.update(i),this._iaVertCount=this._capacity*this._vertCount,this._iaIndexCount=this._capacity*this._indexCount,this._subMeshData=new wD([t],this._vertAttrs,7,s),this.initSubModel(0,this._subMeshData,this._material),e}createSubMeshDataInsDynamic(){this._insBuffers.length=0,this.destroySubMeshData();const t=this._device.createBuffer(new a_(10,3,this._vertAttribSize*this._bufferSize,this._vertAttribSize)),e=new ArrayBuffer(this._vertAttribSize*this._bufferSize);return t.update(e),this._insBuffers.push(t),e}createSubMeshDataInsStatic(){this._vertCount=4,this._indexCount=6,this._mesh&&(this._vertCount=this._mesh.struct.vertexBundles[this._mesh.struct.primitives[0].vertexBundelIndices[0]].view.count,this._indexCount=this._mesh.struct.primitives[0].indexView.count);const t=this._device.createBuffer(new a_(10,3,this._vertAttribSizeStatic*this._vertCount,this._vertAttribSizeStatic)),e=new ArrayBuffer(this._vertAttribSizeStatic*this._vertCount);if(this._mesh){let t=this._vertAttrs.findIndex((t=>"a_texCoord"===t.name)),i=this._vertAttrs[t].offset;if(this._mesh.copyAttribute(0,"a_texCoord",e,this._vertAttribSizeStatic,i),t=this._vertAttrs.findIndex((t=>"a_texCoord3"===t.name)),i=this._vertAttrs[t++].offset,this._mesh.copyAttribute(0,"a_position",e,this._vertAttribSizeStatic,i),i=this._vertAttrs[t++].offset,this._mesh.copyAttribute(0,"a_normal",e,this._vertAttribSizeStatic,i),i=this._vertAttrs[t++].offset,!this._mesh.copyAttribute(0,"a_color",e,this._vertAttribSizeStatic,i)){const t=new Uint32Array(e);for(let e=0;e<this._vertCount;++e)t[e*this._vertStaticAttrsFloatCount+i/4]=Ls.toUint32(Ls.WHITE)}}else{const t=new Float32Array(e);for(let e=0;e<znt.length;++e)t[e]=znt[e]}t.update(e);const i=new Uint16Array(this._indexCount);this._mesh?this._mesh.copyIndices(0,i):(i[0]=0,i[1]=1,i[2]=2,i[3]=3,i[4]=2,i[5]=1);const s=this._device.createBuffer(new a_(6,1,2*this._indexCount,2));s.update(i),this._insIndices=s,this._iaVertCount=this._vertCount,this._iaIndexCount=this._indexCount,this._insBuffers.push(t)}createInsSubmesh(){this._subMeshData=new wD(this._insBuffers,this._vertAttrs,7,this._insIndices),this.initSubModel(0,this._subMeshData,this._material)}updateMaterial(t){this._material=t,this.setSubModelMaterial(0,t)}addParticleVertexData(t,e){if(this._useInstance)this.addParticleVertexDataIns(t,e);else if(this._mesh)for(let i=0;i<this._vertCount;i++){let s=(t*this._vertCount+i)*this._vertAttrsFloatCount;this._vdataF32[s++]=e.position.x,this._vdataF32[s++]=e.position.y,this._vdataF32[s++]=e.position.z,s+=2,this._vdataF32[s++]=e.texcoord.z,this._vdataF32[s++]=e.size.x,this._vdataF32[s++]=e.size.y,this._vdataF32[s++]=e.size.z,this._vdataF32[s++]=e.rotation.x,this._vdataF32[s++]=e.rotation.y,this._vdataF32[s++]=e.rotation.z,this._vdataUint32[s++]=e.color}else{let i=t*this._vertAttrsFloatCount;this._vdataF32[i++]=e.position.x,this._vdataF32[i++]=e.position.y,this._vdataF32[i++]=e.position.z,this._vdataF32[i++]=e.texcoord.x,this._vdataF32[i++]=e.texcoord.y,this._vdataF32[i++]=e.texcoord.z,this._vdataF32[i++]=e.size.x,this._vdataF32[i++]=e.size.y,this._vdataF32[i++]=e.size.z,this._vdataF32[i++]=e.rotation.x,this._vdataF32[i++]=e.rotation.y,this._vdataF32[i++]=e.rotation.z,this._vdataUint32[i++]=e.color,e.velocity&&(this._vdataF32[i++]=e.velocity.x,this._vdataF32[i++]=e.velocity.y,this._vdataF32[i++]=e.velocity.z)}}addParticleVertexDataIns(t,e){let i=t*this._vertAttrsFloatCount;this._mesh?(this._vdataF32[i++]=e.position.x,this._vdataF32[i++]=e.position.y,this._vdataF32[i++]=e.position.z,this._vdataF32[i++]=e.texcoord.z,this._vdataF32[i++]=e.size.x,this._vdataF32[i++]=e.size.y,this._vdataF32[i++]=e.size.z,this._vdataF32[i++]=e.rotation.x,this._vdataF32[i++]=e.rotation.y,this._vdataF32[i++]=e.rotation.z,this._vdataUint32[i++]=e.color):(this._vdataF32[i++]=e.position.x,this._vdataF32[i++]=e.position.y,this._vdataF32[i++]=e.position.z,this._vdataF32[i++]=e.texcoord.z,this._vdataF32[i++]=e.size.x,this._vdataF32[i++]=e.size.y,this._vdataF32[i++]=e.size.z,this._vdataF32[i++]=e.rotation.x,this._vdataF32[i++]=e.rotation.y,this._vdataF32[i++]=e.rotation.z,this._vdataUint32[i++]=e.color,e.velocity&&(this._vdataF32[i++]=e.velocity.x,this._vdataF32[i++]=e.velocity.y,this._vdataF32[i++]=e.velocity.z))}addGPUParticleVertexData(t,e,i){if(this._useInstance)this.addGPUParticleVertexDataIns(t,e,i);else{let s=e*this._vertAttrsFloatCount*this._vertCount;for(let e=0;e<this._vertCount;e++){let r=s;this._vdataF32[r++]=t.position.x,this._vdataF32[r++]=t.position.y,this._vdataF32[r++]=t.position.z,this._vdataF32[r++]=i,this._vdataF32[r++]=t.startSize.x,this._vdataF32[r++]=t.startSize.y,this._vdataF32[r++]=t.startSize.z,this._vdataF32[r++]=knt[2*e],this._vdataF32[r++]=t.rotation.x,this._vdataF32[r++]=t.rotation.y,this._vdataF32[r++]=t.rotation.z,this._vdataF32[r++]=knt[2*e+1],this._vdataF32[r++]=t.startColor.r/255,this._vdataF32[r++]=t.startColor.g/255,this._vdataF32[r++]=t.startColor.b/255,this._vdataF32[r++]=t.startColor.a/255,this._vdataF32[r++]=t.velocity.x,this._vdataF32[r++]=t.velocity.y,this._vdataF32[r++]=t.velocity.z,this._vdataF32[r++]=t.startLifetime,this._vdataF32[r++]=t.randomSeed,s+=this._vertAttrsFloatCount}}}addGPUParticleVertexDataIns(t,e,i){let s=e*this._vertAttrsFloatCount,r=s;this._vdataF32[r++]=t.position.x,this._vdataF32[r++]=t.position.y,this._vdataF32[r++]=t.position.z,this._vdataF32[r++]=i,this._vdataF32[r++]=t.startSize.x,this._vdataF32[r++]=t.startSize.y,this._vdataF32[r++]=t.startSize.z,this._vdataF32[r++]=t.frameIndex,this._vdataF32[r++]=t.rotation.x,this._vdataF32[r++]=t.rotation.y,this._vdataF32[r++]=t.rotation.z,this._vdataF32[r++]=t.startColor.r/255,this._vdataF32[r++]=t.startColor.g/255,this._vdataF32[r++]=t.startColor.b/255,this._vdataF32[r++]=t.startColor.a/255,this._vdataF32[r++]=t.velocity.x,this._vdataF32[r++]=t.velocity.y,this._vdataF32[r++]=t.velocity.z,this._vdataF32[r++]=t.startLifetime,this._vdataF32[r++]=t.randomSeed,s+=this._vertAttrsFloatCount}updateGPUParticles(t,e,i){if(this._useInstance)return this.updateGPUParticlesIns(t,e,i);{const s=this._vertAttrsFloatCount*this._vertCount;let r=0,n=0,o=0,a=0,h=0;for(let l=0;l<t;++l)r=l*s,n=this._vdataF32[r+this._startTimeOffset],o=this._vdataF32[r+this._lifeTimeOffset],h=e-n,o-h<i&&(a=--t*s,this._vdataF32.copyWithin(r,a,a+s),l--);return t}}updateGPUParticlesIns(t,e,i){const s=this._vertAttrsFloatCount;let r=0,n=0,o=0,a=0,h=0;for(let l=0;l<t;++l)r=l*s,n=this._vdataF32[r+this._startTimeOffset],o=this._vdataF32[r+this._lifeTimeOffset],h=e-n,o-h<i&&(a=--t*s,this._vdataF32.copyWithin(r,a,a+s),l--);return t}constructAttributeIndex(){if(!this._vertAttrs)return;let t=this._vertAttrs.findIndex((t=>"a_position_starttime"===t.name)),e=this._vertAttrs[t].offset;this._startTimeOffset=e/4+3,t=this._vertAttrs.findIndex((t=>"a_dir_life"===t.name)),e=this._vertAttrs[t].offset,this._lifeTimeOffset=e/4+3}updateIA(t){if(this._useInstance)this.updateIAIns(t);else{if(t<=0)return;const e=this._subModels[0].inputAssembler;e.vertexBuffers[0].update(this._vdataF32),e.firstIndex=0,e.indexCount=this._indexCount*t,e.vertexCount=this._iaVertCount}}updateIAIns(t){if(t<=0)return;const e=this._subModels[0].inputAssembler;e.vertexBuffers[0].update(this._vdataF32),e.instanceCount=t,e.firstIndex=0,e.indexCount=this._indexCount,e.instanceCount=t,e.vertexCount=this._iaVertCount}clear(){this._useInstance?this.clearIns():this._subModels[0].inputAssembler.indexCount=0}clearIns(){this._subModels[0].inputAssembler.instanceCount=0}destroy(){super.destroy(),this.doDestroy()}doDestroy(){this._vBuffer=null,this._vdataF32=null,this._vdataUint32=null,this._insBuffers=[],this._insIndices=null,this._vertAttrs=null,this._material=null,this._mesh=null,this.destroySubMeshData()}rebuild(){this._useInstance?this.rebuildIns():(this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer))}rebuildIns(){this._vBuffer=this.createSubMeshDataInsDynamic(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer),this.createSubMeshDataInsStatic(),this.createInsSubmesh()}destroySubMeshData(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)}set useInstance(t){this._useInstance!==t&&(this._useInstance=t)}get useInstance(){return this._useInstance}}class Vnt{get model(){return this._model}constructor(t){this._particleSystem=null,this._model=null,this._renderInfo=null,this._vertAttrs=[],this._useInstance=void 0,this._renderInfo=t,yp.gfxDevice.hasFeature(1)?this._useInstance=!0:this._useInstance=!1}getUseInstance(){return this._useInstance}getInfo(){return this._renderInfo}onInit(t){this._particleSystem=t}onEnable(){if(!this._particleSystem)return;this.attachToScene();const t=this._model;t&&(t.node=t.transform=this._particleSystem.node)}onDisable(){this.detachFromScene()}onDestroy(){this._model&&(a.director.root.destroyModel(this._model),this._model=null)}attachToScene(){var t;this._model&&(this._model.scene&&this.detachFromScene(),null==(t=this._particleSystem)||t._getRenderScene().addModel(this._model))}detachFromScene(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)}setVertexAttributes(){this._model&&(this.updateVertexAttrib(),this._model.setVertexAttributes(4===this._renderInfo.renderMode?this._renderInfo.mesh:null,this._vertAttrs))}clear(){this._model&&(this._model.enabled=!1)}getModel(){return this._model}_initModel(){!this._model&&this._particleSystem&&(this._model=a.director.root.createModel(Unt),this._model.setCapacity(this._particleSystem.capacity),this._model.visFlags=this._particleSystem.visibility)}updateTrailMaterial(){}getDefaultTrailMaterial(){return null}}class jnt{constructor(t){this.permutation=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.accSpeed=new Ms,this.noiseSpeed=new Ms,this.noiseFrequency=0,this.noiseAbs=new Ms,this.noiseAmplitude=new Ms,this.octaves=new Ms,this.dt=0,this.point=new Ms,this.result=new Ms,this.mixOut=new kr,t&&(this.permutation=t)}noise(t,e,i,s=0,r=1){const n=new Array(512);for(let t=0;t<256;t++)n[256+t]=n[t]=this.permutation[t];const o=255&Math.floor(t),a=255&Math.floor(e),h=255&Math.floor(i);t-=Math.floor(t),e-=Math.floor(e),i-=Math.floor(i);const l=this.fade(t),c=this.fade(e),u=this.fade(i),d=n[o]+a,_=n[d]+h,p=n[d+1]+h,m=n[o+1]+a,g=n[m]+h,f=n[m+1]+h;return s+this.scale(this.lerp(u,this.lerp(c,this.lerp(l,this.grad(n[_],t,e,i),this.grad(n[g],t-1,e,i)),this.lerp(l,this.grad(n[p],t,e-1,i),this.grad(n[f],t-1,e-1,i))),this.lerp(c,this.lerp(l,this.grad(n[_+1],t,e,i-1),this.grad(n[g+1],t-1,e,i-1)),this.lerp(l,this.grad(n[p+1],t,e-1,i-1),this.grad(n[f+1],t-1,e-1,i-1)))))*(r-s)}fade(t){return t*t*t*(t*(6*t-15)+10)}lerp(t,e,i){return e+t*(i-e)}grad(t,e,i,s){const r=15&t,n=r<8?e:i,o=r<4?i:12===r||14===r?e:s;return(1&r?-n:n)+(2&r?-o:o)}scale(t){return(1+t)/2}setSpeed(t,e,i){this.noiseSpeed.set(t,e,i)}setFrequency(t){this.noiseFrequency=t}setAbs(t,e,i){this.noiseAbs.set(t,e,i)}setAmplititude(t,e,i){this.noiseAmplitude.set(t,e,i)}setOctaves(t,e,i){this.octaves.set(t,e,i)}setTime(t){this.dt=t}setSamplePoint(t){this.point.set(t)}getResult(){return this.result}getNoise(t,e,i,s,r,n,o){let a=n,h=0;if(h+=this.noise(t*a,e*a,i*a,-1,1),1===o.x)return h;let l=1,c=1;for(let s=1;s<o.x;++s)l*=o.y,a*=o.z,c+=l,h+=this.noise(t*a,e*a,i*a,-1,1)*l;return h/c}getNoiseMix(t,e,i,s,r,n){t.x=this.getNoise(e.x,e.y,e.z,i,s,r,n),t.y=this.getNoise(e.y,e.z,e.x,i,s,r,n)}getNoiseParticle(){this.accSpeed.set(this.noiseSpeed.x*this.dt,this.noiseSpeed.y*this.dt,this.noiseSpeed.z*this.dt);const t=this.getNoise(this.point.z+this.accSpeed.x,this.point.y,this.point.x,this.dt,this.accSpeed,this.noiseFrequency,this.octaves),e=this.getNoise(this.point.x+1e3,this.point.z+this.accSpeed.y,this.point.y,this.dt,this.accSpeed,this.noiseFrequency,this.octaves),i=this.getNoise(this.point.y,this.point.x+1e3,this.point.z+this.accSpeed.z,this.dt,this.accSpeed,this.noiseFrequency,this.octaves);this.result.set(t*this.noiseAmplitude.x,e*this.noiseAmplitude.y,i*this.noiseAmplitude.z)}getPreview(t,e,i){for(let s=0;s<i;++s)for(let r=0;r<e;++r){const n=(r-.5*e)/e+this.noiseSpeed.x*this.dt,o=(s-.5*i)/i+this.noiseSpeed.y*this.dt,a=this.getNoise(n,o,0,this.dt,this.accSpeed,this.noiseFrequency,this.octaves);t[s*e+r]=.5*(a+1)}}}const Hnt=new ms,Gnt=Ps(),Wnt=new vr,Xnt=new vr,Ynt=new sr,qnt=["_colorOverLifetimeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule","_noiseModule"],$nt=[0,0,1,0,0,1,1,1],Knt="CC_USE_WORLD_SPACE",Znt="CC_USE_EMBEDDED_ALPHA",Qnt="CC_RENDER_MODE",Jnt="a_position",tot="a_normal",eot="a_color",iot="a_color1",sot="a_texCoord",rot="a_texCoord1",not="a_texCoord2",oot="a_texCoord3",aot="a_texCoord4";function hot(t,e,i=!1,s=0,r=!1,n=0){return new x_(t,e,i,s,r,n)}const lot=[hot(Jnt,32),hot(sot,32),hot(rot,32),hot(not,32),hot(eot,35,!0)],cot=[hot(Jnt,32),hot(sot,32),hot(rot,32),hot(not,32),hot(eot,35,!0),hot(iot,32)],uot=[hot(Jnt,32),hot(sot,32),hot(rot,32),hot(not,32),hot(eot,35,!0),hot(oot,32),hot(tot,32),hot(iot,35,!0)],dot=[hot(aot,44,!1,0,!0),hot(rot,32,!1,0,!0),hot(not,32,!1,0,!0),hot(eot,35,!0,0,!0),hot(sot,32,!1,1)],_ot=[hot(aot,44,!1,0,!0),hot(rot,32,!1,0,!0),hot(not,32,!1,0,!0),hot(eot,35,!0,0,!0),hot(iot,32,!1,0,!0),hot(sot,32,!1,1)],pot=[hot(aot,44,!1,0,!0),hot(rot,32,!1,0,!0),hot(not,32,!1,0,!0),hot(eot,35,!0,0,!0),hot(sot,32,!1,1),hot(oot,32,!1,1),hot(tot,32,!1,1),hot(iot,35,!0,1)],mot={parent:null,owner:null,subModelIdx:0};class got{constructor(){this.position=void 0,this.texcoord=void 0,this.size=void 0,this.rotation=void 0,this.color=void 0,this.velocity=void 0,this.position=Ps(),this.texcoord=Ps(),this.size=Ps(),this.rotation=Ps(),this.color=0,this.velocity=null}}class fot extends Vnt{constructor(t){super(t),this._defines=void 0,this._trailDefines=void 0,this._frameTile_velLenScale=void 0,this._tmp_velLenScale=void 0,this._defaultMat=null,this._node_scale=void 0,this._particleVertexData=void 0,this._particles=null,this._defaultTrailMat=null,this._updateList=new Map,this._animateList=new Map,this._runAnimateList=[],this._fillDataFunc=null,this._uScaleHandle=0,this._uLenHandle=0,this._uNodeRotHandle=0,this._alignSpace=2,this._inited=!1,this._localMat=new vr,this._gravity=new ms,this.noise=new jnt,this._model=null,this._frameTile_velLenScale=new ms(1,1,0,0),this._tmp_velLenScale=this._frameTile_velLenScale.clone(),this._node_scale=Ps(),this._particleVertexData=new got,this._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1},this._trailDefines={CC_USE_WORLD_SPACE:!0}}onInit(t){super.onInit(t),this._particles=new So((()=>new mit(this)),16),this._setVertexAttrib(),this._setFillFunc(),this._initModuleList(),this._initModel(),this.updateMaterialParams(),this.updateTrailMaterial(),this.setVertexAttributes(),this._inited=!0}clear(){super.clear(),this._particles.reset(),this._particleSystem&&this._particleSystem._trailModule&&this._particleSystem._trailModule.clear(),this.updateRenderData(),this._model.enabled=!1}updateRenderMode(){this._setVertexAttrib(),this._setFillFunc(),this.updateMaterialParams(),this.setVertexAttributes()}onDestroy(){var t;null==(t=this._particles)||t.destroy(),super.onDestroy()}getFreeParticle(){return this._particleSystem&&this._particles.length>=this._particleSystem.capacity?null:this._particles.add()}getDefaultTrailMaterial(){return this._defaultTrailMat}setNewParticle(t){}_initModuleList(){qnt.forEach((t=>{if(!this._particleSystem)return;const e=this._particleSystem[t];e&&e.enable&&(e.needUpdate&&this._updateList.set(e.name,e),e.needAnimate&&this._animateList.set(e.name,e))})),this._runAnimateList.length=0;for(let t=0,e=fit.length;t<e;t++){const e=this._animateList.get(fit[t]);e&&this._runAnimateList.push(e)}}enableModule(t,e,i){e?(i.needUpdate&&this._updateList.set(i.name,i),i.needAnimate&&this._animateList.set(i.name,i)):(this._animateList.delete(t),this._updateList.delete(t)),this._runAnimateList.length=0;for(let t=0,e=fit.length;t<e;t++){const e=this._animateList.get(fit[t]);e&&this._runAnimateList.push(e)}this.updateMaterialParams()}updateAlignSpace(t){this._alignSpace=t}getDefaultMaterial(){return this._defaultMat}updateRotation(t){t&&this.doUpdateRotation(t)}doUpdateRotation(t){if(4===this._renderInfo.renderMode||2!==this._alignSpace){var e;if(1===this._alignSpace)null==(e=this._particleSystem)||e.node.getRotation(Ynt);else if(0===this._alignSpace){var i;null==(i=this._particleSystem)||i.node.getWorldRotation(Ynt)}else if(2===this._alignSpace){var s,r;Ynt.set(0,0,0,1);const t=null==(s=this._particleSystem)||null==(r=s.node.scene.renderScene)?void 0:r.cameras;if(void 0!==t)for(let e=0;e<(null==t?void 0:t.length);++e){const i=t[e];if((i.visibility&this._particleSystem.node.layer)===this._particleSystem.node.layer){sr.fromViewUp(Ynt,i.forward);break}}}else Ynt.set(0,0,0,1);t.setUniform(this._uNodeRotHandle,Ynt)}}updateScale(t){t&&this.doUpdateScale(t)}doUpdateScale(t){var e,i,s;const r=this._node_scale;switch(null==(e=this._particleSystem)?void 0:e.scaleSpace){case 1:null==(i=this._particleSystem)||i.node.getScale(r);break;case 0:null==(s=this._particleSystem)||s.node.getWorldScale(r)}t.setUniform(this._uScaleHandle,Hnt.set(r.x,r.y,r.z))}updateParticles(t){const e=this._particleSystem;if(!e)return this._particles.length;e.node.getWorldMatrix(Wnt);const i=(e.getMaterialInstance(0)||this._defaultMat).passes[0];this.doUpdateScale(i),this.doUpdateRotation(i),this._updateList.forEach((()=>{}));const s=e._trailModule,r=s&&s.enable;r&&s.update();const n=!e.gravityModifier.isZero();if(n){if(1===e.simulationSpace){const t=e.node.getRotation();vr.fromQuat(this._localMat,t),this._localMat.transpose()}if(e.node.parent){const t=e.node.parent.worldRotation;vr.fromQuat(Xnt,t),Xnt.transpose()}}for(let i=this._particles.length-1;i>=0;i--){const o=this._particles.data[i];if(o.remainingLifetime-=t,Ms.set(o.animatedVelocity,0,0,0),o.remainingLifetime<0)r&&s.removeParticle(o),this._particles.removeAt(i);else{if(n){const i=Eit(e.gravityModifier)?ji(o.randomSeed):0;if(1===e.simulationSpace){const s=1-o.remainingLifetime/o.startLifetime,r=9.8*-e.gravityModifier.evaluate(s,i)*t;this._gravity.x=0,this._gravity.y=r,this._gravity.z=0,this._gravity.w=1,Oi(r,0,Mi)||(e.node.parent&&(this._gravity=this._gravity.transformMat4(Xnt)),this._gravity=this._gravity.transformMat4(this._localMat),o.velocity.x+=this._gravity.x,o.velocity.y+=this._gravity.y,o.velocity.z+=this._gravity.z)}else o.velocity.y-=9.8*e.gravityModifier.evaluate(1-o.remainingLifetime/o.startLifetime,i)*t}Ms.copy(o.ultimateVelocity,o.velocity),this._runAnimateList.forEach((e=>{e.animate(o,t)})),Ms.scaleAndAdd(o.position,o.position,o.ultimateVelocity,t),r&&s.animate(o,t)}}return this._model.enabled=this._particles.length>0,this._particles.length}getNoisePreview(t,e,i){this._runAnimateList.forEach((s=>{s.name===git&&s.getNoisePreview(t,this._particleSystem,e,i)}))}updateRenderData(){let t=0;for(let e=0;e<this._particles.length;++e){const i=this._particles.data[e];let s=0;const r=this._particleSystem._textureAnimationModule;r&&r.enable&&(s=i.frameIndex),t=4*e,this._fillDataFunc(i,t,s)}}beforeRender(){this._model.updateIA(this._particles.length)}getParticleCount(){return this._particles.length}onMaterialModified(t,e){this._inited&&(0===t?this.updateMaterialParams():this.updateTrailMaterial())}onRebuildPSO(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e);const i=this._particleSystem._trailModule,s=null==i?void 0:i.getModel();s&&1===t&&s.setSubModelMaterial(0,e)}_setFillFunc(){4===this._renderInfo.renderMode?this._fillDataFunc=this._fillMeshData:1===this._renderInfo.renderMode?this._fillDataFunc=this._fillStrecthedData:this._fillDataFunc=this._fillNormalData}_fillMeshData(t,e,i){const s=this._particleVertexData,r=e/4;Ms.copy(s.position,t.position),Gnt.z=i,Ms.copy(s.texcoord,Gnt),Ms.copy(s.size,t.size),Ms.copy(s.rotation,t.rotation),s.color=Ls.toUint32(t.color),this._model.addParticleVertexData(r,s)}_fillStrecthedData(t,e,i){const s=this._particleVertexData;if(this._useInstance)this._fillStrecthedDataIns(t,e,i);else for(let r=0;r<4;++r)Ms.copy(s.position,t.position),Gnt.x=$nt[2*r],Gnt.y=$nt[2*r+1],Gnt.z=i,Ms.copy(s.texcoord,Gnt),Ms.copy(s.size,t.size),Ms.copy(s.rotation,t.rotation),s.color=Ls.toUint32(t.color),s.velocity=t.ultimateVelocity,this._model.addParticleVertexData(e++,s)}_fillStrecthedDataIns(t,e,i){const s=this._particleVertexData,r=e/4;Ms.copy(s.position,t.position),Gnt.z=i,Ms.copy(s.texcoord,Gnt),Ms.copy(s.size,t.size),Ms.copy(s.rotation,t.rotation),s.color=Ls.toUint32(t.color),s.velocity=t.ultimateVelocity,this._model.addParticleVertexData(r,s)}_fillNormalData(t,e,i){const s=this._particleVertexData;if(this._useInstance)this._fillNormalDataIns(t,e,i);else for(let r=0;r<4;++r)Ms.copy(s.position,t.position),Gnt.x=$nt[2*r],Gnt.y=$nt[2*r+1],Gnt.z=i,Ms.copy(s.texcoord,Gnt),Ms.copy(s.size,t.size),Ms.copy(s.rotation,t.rotation),this._particleVertexData.color=Ls.toUint32(t.color),this._model.addParticleVertexData(e++,s)}_fillNormalDataIns(t,e,i){const s=this._particleVertexData,r=e/4;Ms.copy(s.position,t.position),Gnt.z=i,Ms.copy(s.texcoord,Gnt),Ms.copy(s.size,t.size),Ms.copy(s.rotation,t.rotation),this._particleVertexData.color=Ls.toUint32(t.color),this._model.addParticleVertexData(r,s)}updateVertexAttrib(){if(4===this._renderInfo.renderMode&&this._renderInfo.mesh){const t=this._renderInfo.mesh.readAttributeFormat(0,"a_color");if(t){let e=35;for(let i=0;i<tp.length;++i)if(tp[i].name===t.name){e=i;break}this._vertAttrs[7]=hot(iot,e,!0,this._useInstance?1:0)}else{const t=35;this._vertAttrs[7]=hot(iot,t,!0,this._useInstance?1:0)}}}_setVertexAttrib(){if(this._useInstance)this._setVertexAttribIns();else switch(this._renderInfo.renderMode){case 1:this._vertAttrs=cot.slice();break;case 4:this._vertAttrs=uot.slice();break;default:this._vertAttrs=lot.slice()}}_setVertexAttribIns(){switch(this._renderInfo.renderMode){case 1:this._vertAttrs=_ot.slice();break;case 4:this._vertAttrs=pot.slice();break;default:this._vertAttrs=dot.slice()}}updateMaterialParams(){if(!this._particleSystem)return;const t=this._particleSystem,e=t.sharedMaterial;null!=e&&(this._renderInfo.mainTexture=e.getProperty("mainTexture",0)),null==t.sharedMaterial&&null==this._defaultMat&&(mot.parent=iC.get("default-particle-material"),mot.owner=this._particleSystem,mot.subModelIdx=0,this._defaultMat=new BI(mot),mot.parent=null,mot.owner=null,mot.subModelIdx=0,null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));const i=t.getMaterialInstance(0)||this._defaultMat;0===t.simulationSpace?this._defines[Knt]=!0:this._defines[Knt]=!1;const s=i.passes[0];this._uScaleHandle=s.getHandle("scale"),this._uLenHandle=s.getHandle("frameTile_velLenScale"),this._uNodeRotHandle=s.getHandle("nodeRotation");const r=this._renderInfo.renderMode,n=this._frameTile_velLenScale;0===r?this._defines[Qnt]=0:1===r?(this._defines[Qnt]=1,n.z=this._renderInfo.velocityScale,n.w=this._renderInfo.lengthScale):2===r?this._defines[Qnt]=2:3===r?this._defines[Qnt]=3:4===r?this._defines[Qnt]=4:M(`particle system renderMode ${r} not support.`);const o=t._textureAnimationModule;if(o&&o.enable){const t=i.getProperty("mainTexture",0);t&&t.isAlphaAtlas&&(o.scaleNumTilesXY(2),this._defines[Znt]=!0),ms.copy(this._tmp_velLenScale,n),kr.set(this._tmp_velLenScale,o.numTilesX,o.numTilesY),s.setUniform(this._uLenHandle,this._tmp_velLenScale)}else s.setUniform(this._uLenHandle,n);let a=!1;const h=this._particleSystem._rotationOvertimeModule;a=!!h&&h.enable,this._defines.ROTATION_OVER_TIME_MODULE_ENABLE=a,this._defines.CC_INSTANCE_PARTICLE=this._useInstance,i.recompileShaders(this._defines),this._model&&this._model.updateMaterial(i)}updateTrailMaterial(){if(!this._particleSystem)return;const t=this._particleSystem,e=t._trailModule;if(e&&e.enable){0===t.simulationSpace||0===e.space?this._trailDefines[Knt]=!0:this._trailDefines[Knt]=!1;let i=t.getMaterialInstance(1);null===i&&null===this._defaultTrailMat&&(mot.parent=iC.get("default-trail-material"),mot.owner=this._particleSystem,mot.subModelIdx=1,this._defaultTrailMat=new BI(mot),mot.parent=null,mot.owner=null,mot.subModelIdx=0),i=i||this._defaultTrailMat;const s=i.getProperty("mainTexture",0);s&&s.isAlphaAtlas&&(this._trailDefines[Znt]=!0),i.recompileShaders(this._trailDefines),e.updateMaterial()}}setUseInstance(t){this._useInstance!==t&&(this._useInstance=t,this._model&&(this._model.useInstance=t,this._model.doDestroy()),this.updateRenderMode())}}const yot=new ms,bot=new vr,vot=new ms,Sot=new sr,Tot=new sr;new Ms;const wot=32,xot="CC_USE_WORLD_SPACE",Cot="CC_RENDER_MODE",Aot="a_position_starttime",Dot="a_size_uv",Eot="a_rotation_uv",Iot="a_color",Mot="a_dir_life",Pot="a_rndSeed",Oot="a_size_fid",Rot="a_rotation",Bot=[new x_(Aot,44),new x_(Dot,44),new x_(Eot,44),new x_(Iot,44),new x_(Mot,44),new x_(Pot,11)],Fot=[new x_(Aot,44),new x_(Dot,44),new x_(Eot,44),new x_(Iot,44),new x_(Mot,44),new x_(Pot,11),new x_("a_texCoord",32),new x_("a_texCoord3",32),new x_("a_normal",32),new x_("a_color1",35,!0)],Not=[new x_(Aot,44,!1,0,!0),new x_(Oot,44,!1,0,!0),new x_(Rot,32,!1,0,!0),new x_(Iot,44,!1,0,!0),new x_(Mot,44,!1,0,!0),new x_(Pot,11,!1,0,!0),new x_("a_uv",32,!1,1)],Lot=[new x_(Aot,44,!1,0,!0),new x_(Oot,44,!1,0,!0),new x_(Rot,32,!1,0,!0),new x_(Iot,44,!1,0,!0),new x_(Mot,44,!1,0,!0),new x_(Pot,11,!1,0,!0),new x_("a_texCoord",32,!1,1),new x_("a_texCoord3",32,!1,1),new x_("a_normal",32,!1,1),new x_("a_color1",35,!0,1)],kot={parent:null,owner:null,subModelIdx:0};class zot extends Vnt{constructor(t){super(t),this._defines=void 0,this._frameTile_velLenScale=void 0,this._unifrom_velLenScale=void 0,this._tmp_velLenScale=void 0,this._node_scale=void 0,this._vertAttrs=[],this._defaultMat=null,this._particleNum=0,this._tempParticle=null,this._colorTexture=null,this._forceTexture=null,this._velocityTexture=null,this._rotationTexture=null,this._sizeTexture=null,this._animTexture=null,this._colorData=null,this._forceData=null,this._velocityData=null,this._rotationData=null,this._sizeData=null,this._animData=null,this._uTimeHandle=0,this._uRotHandle=0,this._uNodeRotHandle=0,this._alignSpace=2,this._inited=!1,this._frameTile_velLenScale=new ms(1,1,0,0),this._unifrom_velLenScale=this._frameTile_velLenScale.clone(),this._tmp_velLenScale=this._frameTile_velLenScale.clone(),this._node_scale=new Ms,this._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1,COLOR_OVER_TIME_MODULE_ENABLE:!1},this._tempParticle=new mit(null),this._particleNum=0}onInit(t){super.onInit(t),this._setVertexAttrib(),this._initModel(),this.updateMaterialParams(),this.setVertexAttributes(),this._inited=!0}updateRenderMode(){this._setVertexAttrib(),this.updateMaterialParams(),this.setVertexAttributes()}setVertexAttributes(){super.setVertexAttributes(),this._model.constructAttributeIndex()}clear(){super.clear(),this._particleNum=0,this.updateRenderData()}onDestroy(){super.onDestroy(),this._forceTexture&&this._forceTexture.destroy(),this._velocityTexture&&this._velocityTexture.destroy(),this._colorTexture&&this._colorTexture.destroy(),this._sizeTexture&&this._sizeTexture.destroy(),this._rotationTexture&&this._rotationTexture.destroy(),this._animTexture&&this._animTexture.destroy(),this._forceData=null,this._velocityData=null,this._colorData=null,this._sizeData=null,this._rotationData=null,this._animData=null}enableModule(t,e,i){var s;const r=(null==(s=this._particleSystem)?void 0:s.getMaterialInstance(0))||this._defaultMat;r&&(this.initShaderUniform(r),r.recompileShaders(this._defines),this._model&&this._model.setSubModelMaterial(0,r))}getFreeParticle(){var t;return this._particleSystem&&this._particleNum>=(null==(t=this._particleSystem)?void 0:t.capacity)?null:this._tempParticle}setNewParticle(t){this._particleSystem&&(this._model.addGPUParticleVertexData(t,this._particleNum,this._particleSystem.time),this._particleNum++)}getDefaultMaterial(){return this._defaultMat}updateRotation(t){t&&this.doUpdateRotation(t)}doUpdateRotation(t){if(4===this._renderInfo.renderMode||2!==this._alignSpace){var e;if(1===this._alignSpace)null==(e=this._particleSystem)||e.node.getRotation(Tot);else if(0===this._alignSpace){var i;null==(i=this._particleSystem)||i.node.getWorldRotation(Tot)}else if(2===this._alignSpace){var s,r;Tot.set(0,0,0,1);const t=null==(s=this._particleSystem)||null==(r=s.node.scene.renderScene)?void 0:r.cameras;if(void 0!==t&&this._particleSystem)for(let e=0;e<(null==t?void 0:t.length);++e){const i=t[e];if((i.visibility&this._particleSystem.node.layer)===this._particleSystem.node.layer){sr.fromViewUp(Tot,i.forward);break}}}else Tot.set(0,0,0,1);t.setUniform(this._uNodeRotHandle,Tot)}}updateScale(t){t&&this.doUpdateScale(t)}doUpdateScale(t){var e;const i=this._node_scale;switch(null==(e=this._particleSystem)?void 0:e.scaleSpace){case 1:this._particleSystem.node.getScale(i);break;case 0:this._particleSystem.node.getWorldScale(i)}t.setUniform(t.getHandle("scale"),yot.set(i.x,i.y,i.z))}updateParticles(t){return this._particleSystem?(this._particleNum=this._model.updateGPUParticles(this._particleNum,this._particleSystem.time,t),this.updateShaderUniform(t),this._model.enabled=this._particleNum>0,this._particleNum):this._particleNum}updateRenderData(){}beforeRender(){this._model.updateIA(this._particleNum)}updateAlignSpace(t){this._alignSpace=t}updateShaderUniform(t){if(!this._particleSystem)return;const e=this._particleSystem.getMaterialInstance(0)||this._defaultMat;if(!e)return;const i=e.passes[0];vot.x=this._particleSystem.time,vot.y=t,i.setUniform(this._uTimeHandle,vot),this._particleSystem.node.getWorldRotation(Sot),i.setUniform(this._uRotHandle,Sot),this.doUpdateRotation(i)}initShaderUniform(t){var e,i,s,r,n,o;const a=t.passes[0];this._uTimeHandle=a.getHandle("u_timeDelta"),this._uRotHandle=a.getHandle("u_worldRot"),this._uNodeRotHandle=a.getHandle("nodeRotation"),this.doUpdateScale(a),a.setUniform(a.getHandle("frameTile_velLenScale"),this._unifrom_velLenScale),vot.x=wot,vot.y=.03125,a.setUniform(a.getHandle("u_sampleInfo"),vot);let h=!1;const l=null==(e=this._particleSystem)?void 0:e._forceOvertimeModule;if(h=!!l&&l.enable,this._defines.FORCE_OVER_TIME_MODULE_ENABLE=h,h){const t=vet(this._forceTexture,this._forceData,wot,l.x,l.y,l.z);this._forceTexture=t.texture,this._forceData=t.texdata;const e=a.getHandle("force_over_time_tex0"),i=YP(e);a.bindSampler(i,this._forceTexture.getGFXSampler()),a.bindTexture(i,this._forceTexture.getGFXTexture());const s=a.getHandle("u_force_space");a.setUniform(s,l.space);const r=a.getHandle("u_force_mode");a.setUniform(r,this._forceTexture.height)}const c=null==(i=this._particleSystem)?void 0:i._velocityOvertimeModule;if(h=!!c&&c.enable,this._defines.VELOCITY_OVER_TIME_MODULE_ENABLE=h,h){const t=Tet(this._velocityTexture,this._velocityData,wot,c.x,c.y,c.z,c.speedModifier);this._velocityTexture=t.texture,this._velocityData=t.texdata;const e=a.getHandle("velocity_over_time_tex0"),i=YP(e);a.bindSampler(i,this._velocityTexture.getGFXSampler()),a.bindTexture(i,this._velocityTexture.getGFXTexture());const s=a.getHandle("u_velocity_space");a.setUniform(s,c.space);const r=a.getHandle("u_velocity_mode");a.setUniform(r,this._velocityTexture.height)}const u=null==(s=this._particleSystem)?void 0:s._colorOverLifetimeModule;if(h=!!u&&u.enable,this._defines.COLOR_OVER_TIME_MODULE_ENABLE=h,h){const t=Wet(this._colorTexture,this._colorData,wot,u.color);this._colorTexture=t.texture,this._colorData=t.texdata;const e=a.getHandle("color_over_time_tex0"),i=YP(e);a.bindSampler(i,this._colorTexture.getGFXSampler()),a.bindTexture(i,this._colorTexture.getGFXTexture());const s=a.getHandle("u_color_mode");a.setUniform(s,this._colorTexture.height)}const d=null==(r=this._particleSystem)?void 0:r._rotationOvertimeModule;if(h=!!d&&d.enable,this._defines.ROTATION_OVER_TIME_MODULE_ENABLE=h,h){let t;if(t=d.separateAxes?vet(this._rotationTexture,this._rotationData,wot,d.x,d.y,d.z):fet(this._rotationTexture,this._rotationData,wot,d.z),this._rotationTexture=t.texture,this._rotationData=t.texdata,this._rotationTexture){const t=a.getHandle("rotation_over_time_tex0"),e=YP(t);a.bindSampler(e,this._rotationTexture.getGFXSampler()),a.bindTexture(e,this._rotationTexture.getGFXTexture());const i=a.getHandle("u_rotation_mode");a.setUniform(i,this._rotationTexture.height)}}const _=null==(n=this._particleSystem)?void 0:n._sizeOvertimeModule;if(h=!!_&&_.enable,this._defines.SIZE_OVER_TIME_MODULE_ENABLE=h,h){let t;if(t=_.separateAxes?vet(this._sizeTexture,this._sizeData,wot,_.x,_.y,_.z,!0):yet(this._sizeTexture,this._sizeData,wot,_.size),this._sizeTexture=t.texture,this._sizeData=t.texdata,this._sizeTexture){const t=a.getHandle("size_over_time_tex0"),e=YP(t);a.bindSampler(e,this._sizeTexture.getGFXSampler()),a.bindTexture(e,this._sizeTexture.getGFXTexture());const i=a.getHandle("u_size_mode");a.setUniform(i,this._sizeTexture.height)}}const p=null==(o=this._particleSystem)?void 0:o._textureAnimationModule;if(h=!!p&&p.enable,this._defines.TEXTURE_ANIMATION_MODULE_ENABLE=h,h){const t=bet(this._animTexture,this._animData,wot,p.startFrame,p.frameOverTime);this._animTexture=t.texture,this._animData=t.texdata;const e=a.getHandle("texture_animation_tex0"),i=YP(e);a.bindSampler(i,this._animTexture.getGFXSampler()),a.bindTexture(i,this._animTexture.getGFXTexture());const s=a.getHandle("u_anim_info");vot.x=this._animTexture.height,vot.y=p.numTilesX*p.numTilesY,vot.z=p.cycleCount,a.setUniform(s,vot)}this._defines.USE_VK_SHADER=4===yp.gfxDevice.gfxAPI,this._defines.CC_INSTANCE_PARTICLE=this._useInstance}getParticleCount(){return this._particleNum}onMaterialModified(t,e){this._inited&&this.updateMaterialParams()}onRebuildPSO(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e)}updateVertexAttrib(){if(4===this._renderInfo.renderMode&&this._renderInfo.mesh){const t=this._renderInfo.mesh.readAttributeFormat(0,"a_color");if(t){let e=35;for(let i=0;i<tp.length;++i)if(tp[i].name===t.name){e=i;break}this._vertAttrs[9]=new x_("a_color1",e,!0,this._useInstance?1:0)}else{const t=35;this._vertAttrs[9]=new x_("a_color1",t,!0,this._useInstance?1:0)}}}_setVertexAttrib(){if(this._useInstance)this._setVertexAttribIns();else switch(this._renderInfo.renderMode){case 1:default:this._vertAttrs=Bot.slice();break;case 4:this._vertAttrs=Fot.slice()}}_setVertexAttribIns(){switch(this._renderInfo.renderMode){case 1:default:this._vertAttrs=Not.slice();break;case 4:this._vertAttrs=Lot.slice()}}updateMaterialParams(){if(!this._particleSystem)return;const t=this._particleSystem,e=t.sharedMaterial;null!==e&&(this._renderInfo.mainTexture=e.getProperty("mainTexture",0)),null==t.sharedMaterial&&null==this._defaultMat&&(kot.parent=iC.get("default-particle-gpu-material"),kot.owner=t,kot.subModelIdx=0,this._defaultMat=new BI(kot),kot.parent=null,kot.owner=null,kot.subModelIdx=0,null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));const i=t.getMaterialInstance(0)||this._defaultMat;t.node.getWorldMatrix(bot),0===t.simulationSpace?this._defines[xot]=!0:this._defines[xot]=!1;const s=this._renderInfo.renderMode;0===s?this._defines[Cot]=0:1===s?(this._defines[Cot]=1,this._frameTile_velLenScale.z=this._renderInfo.velocityScale,this._frameTile_velLenScale.w=this._renderInfo.lengthScale):2===s?this._defines[Cot]=2:3===s?this._defines[Cot]=3:4===s?this._defines[Cot]=4:M(`particle system renderMode ${s} not support.`);const r=t._textureAnimationModule;if(r&&r.enable){const t=i.getProperty("mainTexture",0);t&&t.isAlphaAtlas&&(r.scaleNumTilesXY(2),this._defines.CC_USE_EMBEDDED_ALPHA=!0),kr.set(this._frameTile_velLenScale,r.numTilesX,r.numTilesY),ms.copy(this._unifrom_velLenScale,this._frameTile_velLenScale)}else this._tmp_velLenScale.z=this._frameTile_velLenScale.z,this._tmp_velLenScale.w=this._frameTile_velLenScale.w,ms.copy(this._unifrom_velLenScale,this._tmp_velLenScale);this.initShaderUniform(i),i.recompileShaders(this._defines),this._model&&this._model.updateMaterial(i)}setUseInstance(t){this._useInstance!==t&&(this._useInstance=t,this._model&&(this._model.useInstance=t,this._model.doDestroy()),this.updateRenderMode())}getNoisePreview(t,e,i){}}var Uot,Vot,jot,Hot,Got,Wot,Xot,Yot,qot,$ot,Kot,Zot,Qot,Jot,tat,eat,iat,sat,rat,nat,oat;function aat(){const t=nC.root.device;return!!(t.capabilities.maxVertexTextureUnits>=8&&3&t.getFormatFeatures(44))||(a.warn("Maybe the device has restrictions on vertex textures or does not support float textures."),!1)}let hat=(Uot=ah("cc.ParticleSystemRenderer"),Vot=Xh(Uit),jot=Xh(Uit),Hot=Xh(uL),Got=Xh(fv),Wot=Xh(fv),Xot=Xh(fv),Yot=Xh(fv),qot=Xh(zit),Uot(((oat=class{constructor(){this._renderMode=Zot&&Zot(),this._velocityScale=Qot&&Qot(),this._lengthScale=Jot&&Jot(),this._mesh=tat&&tat(),this._cpuMaterial=eat&&eat(),this._gpuMaterial=iat&&iat(),this._mainTexture=sat&&sat(),this._useGPU=rat&&rat(),this._alignSpace=nat&&nat(),this._particleSystem=null}get renderMode(){return this._renderMode}set renderMode(t){this._renderMode!==t&&(this._renderMode=t,this._particleSystem&&this._particleSystem.processor.updateRenderMode())}get velocityScale(){return this._velocityScale}set velocityScale(t){this._velocityScale=t,this._particleSystem&&this._particleSystem.processor.updateMaterialParams()}get lengthScale(){return this._lengthScale}set lengthScale(t){this._lengthScale=t,this._particleSystem&&this._particleSystem.processor.updateMaterialParams()}get mesh(){return this._mesh}set mesh(t){this._mesh=t,this._particleSystem&&this._particleSystem.processor.setVertexAttributes()}get particleMaterial(){return this._particleSystem?this._particleSystem.getSharedMaterial(0):null}set particleMaterial(t){this._particleSystem&&this._particleSystem.setSharedMaterial(t,0)}get cpuMaterial(){return this._cpuMaterial}set cpuMaterial(t){if(t){const e=t.effectName;if(-1===e.indexOf("particle")||-1!==e.indexOf("particle-gpu"))return void j(6035)}this._cpuMaterial=t,this.particleMaterial=this._cpuMaterial}get gpuMaterial(){return this._gpuMaterial}set gpuMaterial(t){t&&-1===t.effectName.indexOf("particle-gpu")?j(6035):(this._gpuMaterial=t,this.particleMaterial=this._gpuMaterial)}get trailMaterial(){return this._particleSystem?this._particleSystem.getSharedMaterial(1):null}set trailMaterial(t){this._particleSystem&&this._particleSystem.setSharedMaterial(t,1)}get mainTexture(){return this._mainTexture}set mainTexture(t){this._mainTexture=t}get useGPU(){return this._useGPU}set useGPU(t){this._useGPU!==t&&(aat()?this._useGPU=t:this._useGPU=!1,this._switchProcessor())}get alignSpace(){return this._alignSpace}set alignSpace(t){this._alignSpace=t,this._particleSystem.processor.updateAlignSpace(this._alignSpace)}create(t){null===this._particleSystem?this._particleSystem=t:this._particleSystem!==t&&G(6033)}onInit(t){this.create(t);const e=this._useGPU&&aat();this._particleSystem.processor?G(6034):(this._particleSystem.processor=e?new zot(this):new fot(this),this._particleSystem.processor.updateAlignSpace(this.alignSpace),this._particleSystem.processor.onInit(t)),e?this.gpuMaterial=this.particleMaterial:(this.particleMaterial&&-1!==this.particleMaterial.effectName.indexOf("particle-gpu")&&(this.particleMaterial=null,j(6035)),this.cpuMaterial=this.particleMaterial)}_switchProcessor(){if(!this._particleSystem)return;this._particleSystem.processor&&(this._particleSystem.processor.detachFromScene(),this._particleSystem.processor.clear(),this._particleSystem.processor=null);const t=this._useGPU&&aat();this.particleMaterial=t?this.gpuMaterial:this.cpuMaterial,this._particleSystem.processor=t?new zot(this):new fot(this),this._particleSystem.processor.updateAlignSpace(this.alignSpace),this._particleSystem.processor.onInit(this._particleSystem),this._particleSystem.processor.onEnable(),this._particleSystem.bindModule()}}).AlignmentSpace=zit,s((Kot=oat).prototype,"renderMode",[Vot],Object.getOwnPropertyDescriptor(Kot.prototype,"renderMode"),Kot.prototype),Zot=Za(Kot.prototype,"_renderMode",[jot,vh],(function(){return 0})),Qot=Za(Kot.prototype,"_velocityScale",[vh],(function(){return 1})),Jot=Za(Kot.prototype,"_lengthScale",[vh],(function(){return 1})),tat=Za(Kot.prototype,"_mesh",[vh],(function(){return null})),s(Kot.prototype,"mesh",[Hot],Object.getOwnPropertyDescriptor(Kot.prototype,"mesh"),Kot.prototype),s(Kot.prototype,"particleMaterial",[Got],Object.getOwnPropertyDescriptor(Kot.prototype,"particleMaterial"),Kot.prototype),s(Kot.prototype,"cpuMaterial",[Wot],Object.getOwnPropertyDescriptor(Kot.prototype,"cpuMaterial"),Kot.prototype),eat=Za(Kot.prototype,"_cpuMaterial",[vh],(function(){return null})),s(Kot.prototype,"gpuMaterial",[Xot],Object.getOwnPropertyDescriptor(Kot.prototype,"gpuMaterial"),Kot.prototype),iat=Za(Kot.prototype,"_gpuMaterial",[vh],(function(){return null})),s(Kot.prototype,"trailMaterial",[Yot],Object.getOwnPropertyDescriptor(Kot.prototype,"trailMaterial"),Kot.prototype),sat=Za(Kot.prototype,"_mainTexture",[vh],(function(){return null})),rat=Za(Kot.prototype,"_useGPU",[vh],(function(){return!1})),s(Kot.prototype,"alignSpace",[qot],Object.getOwnPropertyDescriptor(Kot.prototype,"alignSpace"),Kot.prototype),nat=Za(Kot.prototype,"_alignSpace",[vh],(function(){return 2})),$ot=Kot))||$ot);var lat,cat,uat,dat,_at,pat,mat,gat,fat,yat,bat,vat,Sat,Tat,wat,xat,Cat,Aat,Dat,Eat,Iat,Mat,Pat,Oat;const Rat=Math.cos(Ni(100)),Bat={position:new Ms,velocity:new Ms},Fat=new sr,Nat=new Ms,Lat=new Ms,kat=new Ls;class zat{constructor(t){for(this.start=void 0,this.end=void 0,this.trailElements=void 0,this.start=-1,this.end=-1,this.trailElements=[];t--;)this.trailElements.push({position:new Ms,lifetime:0,width:0,velocity:new Ms,direction:0,color:new Ls})}getElement(t){return-1===this.start?null:(t<0&&(t=(t+this.trailElements.length)%this.trailElements.length),t>=this.trailElements.length&&(t%=this.trailElements.length),this.trailElements[t])}addElement(){if(0===this.trailElements.length)return null;if(-1===this.start)return this.start=0,this.end=1,this.trailElements[0];this.start===this.end&&(this.trailElements.splice(this.end,0,{position:new Ms,lifetime:0,width:0,velocity:new Ms,direction:0,color:new Ls}),this.start++,this.start%=this.trailElements.length);const t=this.end++;return this.end%=this.trailElements.length,this.trailElements[t]}iterateElement(t,e,i,s){const r=this.start>=this.end?this.end+this.trailElements.length:this.end;for(let n=this.start;n<r;n++)e(t,this.trailElements[n%this.trailElements.length],i,s)&&(this.start++,this.start%=this.trailElements.length);this.start===r&&(this.start=-1,this.end=-1)}count(){return this.start<this.end?this.end-this.start:this.trailElements.length+this.end-this.start}clear(){this.start=-1,this.end=-1}}let Uat=(lat=ah("cc.TrailModule"),cat=Xh(Git),uat=Xh(det),dat=Xh(Lit),_at=Xh(Wit),pat=Xh(det),mat=Xh(jet),gat=Xh(jet),fat=Xh(Lit),lat((bat=class{get enable(){return this._enable}set enable(t){t===this._enable&&this._trailModel||(t&&!this._enable&&(this._enable=t,this._particleSystem.processor&&this._particleSystem.processor.updateTrailMaterial()),t&&!this._trailModel&&(this._createModel(),this.rebuild()),this._enable=t,this._trailModel&&(this._trailModel.enabled=t),t?this.onEnable():this.onDisable())}get minParticleDistance(){return this._minParticleDistance}set minParticleDistance(t){this._minParticleDistance=t,this._minSquaredDistance=t*t}get space(){return this._space}set space(t){this._space=t;const e=this._particleSystem;e&&e.processor&&e.processor.updateTrailMaterial()}getModel(){return this._trailModel}get inited(){return this._inited}constructor(){this._enable=vat&&vat(),this.mode=Sat&&Sat(),this.lifeTime=Tat&&Tat(),this._minParticleDistance=wat&&wat(),this.existWithParticles=xat&&xat(),this.textureMode=Cat&&Cat(),this.widthFromParticle=Aat&&Aat(),this.widthRatio=Dat&&Dat(),this.colorFromParticle=Eat&&Eat(),this.colorOverTrail=Iat&&Iat(),this.colorOvertime=Mat&&Mat(),this._space=Pat&&Pat(),this._particleSystem=Oat&&Oat(),this._minSquaredDistance=0,this._vertSize=void 0,this._trailNum=0,this._trailLifetime=0,this.vbOffset=0,this.ibOffset=0,this._trailSegments=null,this._particleTrail=void 0,this._trailModel=null,this._subMeshData=null,this._vertAttrs=void 0,this._vbF32=null,this._vbUint32=null,this._iBuffer=null,this._needTransform=!1,this._material=null,this._psTransform=new vr,this._iaVertCount=0,this._iaIndexCount=0,this._vertAttrs=[new x_("a_position",32),new x_("a_texCoord",44),new x_("a_texCoord1",32),new x_("a_color",35,!0)],this._vertSize=this._vertAttrs.reduce(((t,e)=>t+tp[e.format].size),0),this._particleTrail=new Map,this._inited=!1}onInit(t){this._particleSystem=t,this.minParticleDistance=this._minParticleDistance;let e=0;const i=t.startLifetime.getMax(),s=t.rateOverTime.getMax(),r=t.duration;for(let s=0,n=t.bursts.length;s<n;s++)e+=t.bursts[s].getMaxCount(t)*Math.ceil(i/r);this.lifeTime.getMax()<1&&j(6036),this._trailNum=Math.ceil(i*Math.ceil(this.lifeTime.getMax())*60*(s*r+e)),this._trailSegments=new vo((()=>new zat(10)),Math.ceil(s*r),(t=>{t.trailElements.length=0})),this._enable&&(this.enable=this._enable),this._inited=!0}onEnable(){this._attachToScene()}onDisable(){this._particleTrail.clear(),this._detachFromScene()}_attachToScene(){this._trailModel&&(this._trailModel.scene&&this._detachFromScene(),this._particleSystem._getRenderScene().addModel(this._trailModel))}_detachFromScene(){this._trailModel&&this._trailModel.scene&&this._trailModel.scene.removeModel(this._trailModel)}destroy(){this.destroySubMeshData(),this._trailModel&&(nC.root.destroyModel(this._trailModel),this._trailModel=null),this._trailSegments&&(this._trailSegments.destroy(),this._trailSegments=null)}play(){this._trailModel&&this._enable&&(this._trailModel.enabled=!0)}clear(){if(this.enable){const t=this._particleTrail.values();let e=t.next();for(;!e.done;)e.value.clear(),e=t.next();this._particleTrail.clear(),this.updateRenderData(),this._trailModel&&(this._trailModel.enabled=!1)}}updateMaterial(){this._particleSystem&&(this._material=this._particleSystem.getMaterialInstance(1)||this._particleSystem.processor.getDefaultTrailMaterial(),this._trailModel&&this._trailModel.setSubModelMaterial(0,this._material))}update(){this._trailLifetime=this.lifeTime.evaluate(this._particleSystem.time,1),0===this.space&&1===this._particleSystem.simulationSpace?(this._needTransform=!0,this._particleSystem.node.getWorldMatrix(this._psTransform),this._particleSystem.node.getWorldRotation(Fat)):this._needTransform=!1}animate(t,e){if(!this._trailSegments)return;if(t.loopCount>t.lastLoop)return void(t.trailDelay>1?(t.lastLoop=t.loopCount,t.trailDelay=0):t.trailDelay++);let i=this._particleTrail.get(t);if(!i)return i=this._trailSegments.alloc(),void this._particleTrail.set(t,i);let s=i.getElement(i.end-1);if(this._needTransform?Ms.transformMat4(Nat,t.position,this._psTransform):Ms.copy(Nat,t.position),s&&(i.iterateElement(this,this._updateTrailElement,t,e),Ms.squaredDistance(s.position,Nat)<this._minSquaredDistance))return;if(s=i.addElement(),!s)return;Ms.copy(s.position,Nat),s.lifetime=0,this.widthFromParticle?s.width=t.size.x*this.widthRatio.evaluate(0,1):s.width=this.widthRatio.evaluate(0,1);const r=i.count();if(2===r){const t=i.getElement(i.end-2);Ms.subtract(t.velocity,s.position,t.position)}else if(r>2){const t=i.getElement(i.end-2),e=i.getElement(i.end-3);Ms.subtract(Nat,e.position,t.position),Ms.subtract(Lat,s.position,t.position),Ms.subtract(t.velocity,Lat,Nat),Ms.equals(Ms.ZERO,t.velocity)&&Ms.copy(t.velocity,Nat),Ms.normalize(t.velocity,t.velocity),this._checkDirectionReverse(t,e)}this.colorFromParticle?s.color.set(t.color):s.color.set(this.colorOvertime.evaluate(0,1))}removeParticle(t){const e=this._particleTrail.get(t);e&&this._trailSegments&&(e.clear(),this._trailSegments.free(e),this._particleTrail.delete(t))}updateRenderData(){this.vbOffset=0,this.ibOffset=0;for(const t of this._particleTrail.keys()){const e=this._particleTrail.get(t);if(-1===e.start)continue;const i=4*this.vbOffset/this._vertSize,s=e.start>=e.end?e.end+e.trailElements.length:e.end,r=s-e.start,n=1/r,o=e.trailElements[e.start];this._fillVertexBuffer(o,this.colorOverTrail.evaluate(1,1),i,1,0,4);for(let t=e.start+1;t<s;t++){const s=e.trailElements[t%e.trailElements.length],o=t-e.start;this._fillVertexBuffer(s,this.colorOverTrail.evaluate(1-o/r,1),i,1-o*n,o,5)}this._needTransform?Ms.transformMat4(Bat.position,t.position,this._psTransform):Ms.copy(Bat.position,t.position);const a=this._trailModel;if(a&&a.node.invalidateChildren(1),1===r||2===r){const t=e.getElement(e.end-1);Ms.subtract(t.velocity,Bat.position,t.position);const i=this._vbF32,s=this.vbOffset,r=this._vertSize/4,n=t.velocity;i[s-r-4]=n.x,i[s-r-3]=n.y,i[s-r-2]=n.z,i[s-4]=n.x,i[s-3]=n.y,i[s-2]=n.z,Ms.subtract(Bat.velocity,Bat.position,t.position),this._checkDirectionReverse(Bat,t)}else if(r>2){const t=e.getElement(e.end-1),s=e.getElement(e.end-2);Ms.subtract(Nat,s.position,t.position),Ms.subtract(Lat,Bat.position,t.position),Ms.normalize(Nat,Nat),Ms.normalize(Lat,Lat),Ms.subtract(t.velocity,Lat,Nat),Ms.normalize(t.velocity,t.velocity),this._checkDirectionReverse(t,s),this.vbOffset-=this._vertSize/4*2,this.ibOffset-=6,this._fillVertexBuffer(t,this.colorOverTrail.evaluate(n,1),i,n,r-1,5),Ms.subtract(Bat.velocity,Bat.position,t.position),Ms.normalize(Bat.velocity,Bat.velocity),this._checkDirectionReverse(Bat,t)}this.widthFromParticle?Bat.width=t.size.x*this.widthRatio.evaluate(0,1):Bat.width=this.widthRatio.evaluate(0,1),Bat.color=t.color,Ms.equals(Bat.velocity,Ms.ZERO)?this.ibOffset-=3:this._fillVertexBuffer(Bat,this.colorOverTrail.evaluate(0,1),i,0,r,1)}this._trailModel&&(this._trailModel.enabled=this.ibOffset>0)}updateIA(t){const e=this._trailModel&&this._trailModel.subModels;if(e&&e.length>0){const i=e[0];i.inputAssembler.vertexBuffers[0].update(this._vbF32),i.inputAssembler.indexBuffer.update(this._iBuffer),i.inputAssembler.firstIndex=0,i.inputAssembler.indexCount=t,i.inputAssembler.vertexCount=this._iaVertCount}}beforeRender(){this.updateIA(this.ibOffset)}_createModel(){this._trailModel||(this._trailModel=a.director.root.createModel(mb))}rebuild(){const t=this,e=nC.root.device,i=e.createBuffer(new a_(10,3,t._vertSize*(t._trailNum+1)*2,t._vertSize)),s=new ArrayBuffer(t._vertSize*(t._trailNum+1)*2);t._vbF32=new Float32Array(s),t._vbUint32=new Uint32Array(s),i.update(s);const r=e.createBuffer(new a_(6,3,12*Math.max(1,t._trailNum),2));t._iBuffer=new Uint16Array(6*Math.max(1,t._trailNum)),r.update(t._iBuffer),t._iaVertCount=2*(t._trailNum+1),t._iaIndexCount=6*t._trailNum,t._subMeshData=new wD([i],t._vertAttrs,7,r);const n=t._trailModel;n&&t._material&&(n.node=n.transform=t._particleSystem.node,n.visFlags=t._particleSystem.visibility,n.initSubModel(0,t._subMeshData,t._material),n.enabled=!0)}_updateTrailElement(t,e,i,s){return e.lifetime+=s,t.colorFromParticle?(e.color.set(i.color),e.color.multiply(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1))):e.color.set(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1)),t.widthFromParticle?e.width=i.size.x*t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1):e.width=t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1),e.lifetime>t._trailLifetime}_fillVertexBuffer(t,e,i,s,r,n){this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=s,this._vbF32[this.vbOffset++]=0,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,kat.set(t.color),kat.multiply(e),this._vbUint32[this.vbOffset++]=Ls.toUint32(kat),this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=1-t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=s,this._vbF32[this.vbOffset++]=1,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,this._vbUint32[this.vbOffset++]=Ls.toUint32(kat),1&n&&(this._iBuffer[this.ibOffset++]=i+2*r,this._iBuffer[this.ibOffset++]=i+2*r-1,this._iBuffer[this.ibOffset++]=i+2*r+1),4&n&&(this._iBuffer[this.ibOffset++]=i+2*r,this._iBuffer[this.ibOffset++]=i+2*r+1,this._iBuffer[this.ibOffset++]=i+2*r+2)}_checkDirectionReverse(t,e){Ms.dot(t.velocity,e.velocity)<Rat?t.direction=1-e.direction:t.direction=e.direction}destroySubMeshData(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)}},vat=Za(bat.prototype,"_enable",[vh],(function(){return!1})),Sat=Za(bat.prototype,"mode",[cat,vh],(function(){return 0})),Tat=Za(bat.prototype,"lifeTime",[uat,vh],(function(){return new det})),wat=Za(bat.prototype,"_minParticleDistance",[vh],(function(){return.1})),s(bat.prototype,"space",[dat],Object.getOwnPropertyDescriptor(bat.prototype,"space"),bat.prototype),xat=Za(bat.prototype,"existWithParticles",[vh],(function(){return!0})),Cat=Za(bat.prototype,"textureMode",[_at,vh],(function(){return 0})),Aat=Za(bat.prototype,"widthFromParticle",[vh],(function(){return!0})),Dat=Za(bat.prototype,"widthRatio",[pat,vh],(function(){return new det})),Eat=Za(bat.prototype,"colorFromParticle",[vh],(function(){return!1})),Iat=Za(bat.prototype,"colorOverTrail",[mat,vh],(function(){return new jet})),Mat=Za(bat.prototype,"colorOvertime",[gat,vh],(function(){return new jet})),Pat=Za(bat.prototype,"_space",[fat],(function(){return 0})),Oat=Za(bat.prototype,"_particleSystem",[vh],(function(){return null})),yat=bat))||yat);const Vat=new vr,jat=new vr,Hat=new sr,Gat=new Ms,Wat=["_colorOverLifetimeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule"];class Xat{constructor(t){this._particleSystem=void 0,this._processor=void 0,this._node=void 0,this._particlesAll=void 0,this._updateList=new Map,this._animateList=new Map,this._runAnimateList=[],this._localMat=new vr,this._gravity=new ms,this.minPos=new Ms,this.maxPos=new Ms,this._nodePos=new Ms,this._nodeSize=new Ms,this._particleSystem=t,this._processor=this._particleSystem.processor,this._node=t.node,this._particlesAll=[],this._initModuleList()}_updateBoundingNode(){this._nodeSize.set(this.maxPos.x-this.minPos.x,this.maxPos.y-this.minPos.y,this.maxPos.z-this.minPos.z),this._nodePos.set(this.minPos.x+.5*this._nodeSize.x,this.minPos.y+.5*this._nodeSize.y,this.minPos.z+.5*this._nodeSize.z)}setBoundingBoxSize(t){this.maxPos.x=this._nodePos.x+t.x,this.maxPos.y=this._nodePos.y+t.y,this.maxPos.z=this._nodePos.z+t.z,this.minPos.x=this._nodePos.x-t.x,this.minPos.y=this._nodePos.y-t.y,this.minPos.z=this._nodePos.z-t.z,this._updateBoundingNode()}setBoundingBoxCenter(t,e,i){this.maxPos.x=t+.5*this._nodeSize.x,this.maxPos.y=e+.5*this._nodeSize.y,this.maxPos.z=i+.5*this._nodeSize.z,this.minPos.x=t-.5*this._nodeSize.x,this.minPos.y=e-.5*this._nodeSize.y,this.minPos.z=i-.5*this._nodeSize.z,this._updateBoundingNode()}_initModuleList(){Wat.forEach((t=>{const e=this._particleSystem[t];e&&e.enable&&(e.needUpdate&&this._updateList.set(e.name,e),e.needAnimate&&this._animateList.set(e.name,e))})),this._runAnimateList.length=0;for(let t=0,e=fit.length;t<e;t++){const e=this._animateList.get(fit[t]);e&&this._runAnimateList.push(e)}}_emit(t,e,i){const s=this._particleSystem,r=this._node,n=s.time%s.duration/s.duration;r.invalidateChildren(1),0===s.simulationSpace&&(r.getWorldMatrix(Vat),r.getWorldRotation(Hat));for(let r=0;r<t;++r){const t=new mit(s);t.particleSystem=s,t.reset();const r=ji(Vi(0,u));s._shapeModule&&s._shapeModule.enable?s._shapeModule.emit(t):(Ms.set(t.position,0,0,0),Ms.copy(t.velocity,vit)),s._textureAnimationModule&&s._textureAnimationModule.enable&&s._textureAnimationModule.init(t);const o=s.startSpeed.evaluate(n,r);Ms.multiplyScalar(t.velocity,t.velocity,o),0===s.simulationSpace&&(Ms.transformMat4(t.position,t.position,Vat),Ms.transformQuat(t.velocity,t.velocity,Hat)),Ms.copy(t.ultimateVelocity,t.velocity),Ms.set(t.rotation,0,0,0),s.startSize3D?Ms.set(t.startSize,s.startSizeX.evaluate(n,r),s.startSizeY.evaluate(n,r),s.startSizeZ.evaluate(n,r)):(Ms.set(t.startSize,s.startSizeX.evaluate(n,r),1,1),t.startSize.y=t.startSize.x),Ms.copy(t.size,t.startSize),t.startLifetime=s.startLifetime.evaluate(n,r)+e,t.remainingLifetime=t.startLifetime,i.push(t)}}_updateParticles(t,e){const i=this._particleSystem;switch(i.node.getWorldMatrix(Vat),i.scaleSpace){case 1:i.node.getScale(Gat);break;case 0:i.node.getWorldScale(Gat)}if(this._updateList.forEach((()=>{})),1===i.simulationSpace){const t=i.node.getRotation();vr.fromQuat(this._localMat,t),this._localMat.transpose()}i.node.parent&&(i.node.parent.getWorldMatrix(jat),jat.invert());for(let s=0;s<e.length;++s){const r=e[s];if(r.remainingLifetime-=t,Ms.set(r.animatedVelocity,0,0,0),i.gravityModifier.mode!==uet.Constant||0!==i.gravityModifier.constant){const e=Eit(i.gravityModifier)?ji(r.randomSeed):0;if(1===i.simulationSpace){const s=9.8*-i.gravityModifier.evaluate(1-r.remainingLifetime/r.startLifetime,e)*t;this._gravity.x=0,this._gravity.y=s,this._gravity.z=0,this._gravity.w=1,Oi(s,0,Mi)||(i.node.parent&&(this._gravity=this._gravity.transformMat4(jat)),this._gravity=this._gravity.transformMat4(this._localMat),r.velocity.x+=this._gravity.x,r.velocity.y+=this._gravity.y,r.velocity.z+=this._gravity.z)}else r.velocity.y-=9.8*i.gravityModifier.evaluate(1-r.remainingLifetime/r.startLifetime,e)*t}Ms.copy(r.ultimateVelocity,r.velocity),this._runAnimateList.forEach((e=>{e.animate(r,t)})),Ms.scaleAndAdd(r.position,r.position,r.ultimateVelocity,t)}}_calculateBounding(t){const e=new Ms,i=new Ms,s=new Ms,r=new Ms,n=new Ms(1,1,1);if(4===this._processor.getInfo().renderMode){const t=this._processor.getInfo().mesh;if(t&&t.struct.minPosition&&t.struct.maxPosition){const e=new Ca;Ca.fromPoints(e,t.struct.minPosition,t.struct.maxPosition);const i=Math.max(e.halfExtents.x,e.halfExtents.y,e.halfExtents.z);n.set(i,i,i)}}const o=this._particleSystem.node.worldMatrix;for(let a=0;a<this._particlesAll.length;++a){const h=this._particlesAll[a];Ms.multiply(e,Gat,h.size),Ms.multiply(e,e,n),i.set(h.position),0!==this._particleSystem.simulationSpace&&Ms.transformMat4(i,i,o),t&&0===a?(Ms.subtract(this.minPos,i,e),Ms.add(this.maxPos,i,e)):(Ms.subtract(s,i,e),Ms.add(r,i,e),Ms.min(this.minPos,this.minPos,s),Ms.max(this.maxPos,this.maxPos,r))}}calculatePositions(){this._emit(this._particleSystem.capacity,0,this._particlesAll);const t=Eit(this._particleSystem.startLifetime)?ji(Vi(0,u)):0;this._updateParticles(0,this._particlesAll),this._calculateBounding(!0),this._updateParticles(this._particleSystem.startLifetime.evaluate(0,t),this._particlesAll),this._calculateBounding(!1),this._updateBoundingNode()}clear(){this._particlesAll.length=0}destroy(){}}var Yat,qat,$at,Kat,Zat,Qat,Jat,tht,eht,iht,sht,rht,nht,oht,aht,hht,lht,cht,uht,dht,_ht,pht,mht,ght,fht,yht,bht,vht,Sht,Tht;const{ccclass:wht,serializable:xht,displayOrder:Cht,type:Aht,range:Dht,slide:Eht,visible:Iht}=il;let Mht=(Yat=wht("cc.NoiseModule"),qat=Aht(We),$at=Aht(We),Kat=Aht(We),Zat=Aht(We),Qat=Aht(We),Jat=Aht(We),tht=Aht(We),eht=Aht(We),iht=Aht(We),sht=Aht(We),rht=Aht(Ge),nht=Aht(We),oht=Aht(We),Yat((hht=class extends bit{constructor(){super(),this._enable=lht&&lht(),this._strengthX=cht&&cht(),this._strengthY=uht&&uht(),this._strengthZ=dht&&dht(),this._noiseSpeedX=_ht&&_ht(),this._noiseSpeedY=pht&&pht(),this._noiseSpeedZ=mht&&mht(),this._noiseFrequency=ght&&ght(),this._remapX=fht&&fht(),this._remapY=yht&&yht(),this._remapZ=bht&&bht(),this._octaves=vht&&vht(),this._octaveMultiplier=Sht&&Sht(),this._octaveScale=Tht&&Tht(),this.name=git,this.noise=new jnt,this.samplePosition=new Ms}get enable(){return this._enable}set enable(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}get strengthX(){return this._strengthX}set strengthX(t){this._strengthX=t}get strengthY(){return this._strengthY}set strengthY(t){this._strengthY=t}get strengthZ(){return this._strengthZ}set strengthZ(t){this._strengthZ=t}get noiseSpeedX(){return this._noiseSpeedX}set noiseSpeedX(t){this._noiseSpeedX=t}get noiseSpeedY(){return this._noiseSpeedY}set noiseSpeedY(t){this._noiseSpeedY=t}get noiseSpeedZ(){return this._noiseSpeedZ}set noiseSpeedZ(t){this._noiseSpeedZ=t}get noiseFrequency(){return this._noiseFrequency}set noiseFrequency(t){this._noiseFrequency=t}get remapX(){return this._remapX}set remapX(t){this._remapX=t}get remapY(){return this._remapY}set remapY(t){this._remapY=t}get remapZ(){return this._remapZ}set remapZ(t){this._remapZ=t}get octaves(){return this._octaves}set octaves(t){this._octaves=t}get octaveMultiplier(){return this._octaveMultiplier}set octaveMultiplier(t){this._octaveMultiplier=t}get octaveScale(){return this._octaveScale}set octaveScale(t){this._octaveScale=t}animate(t,e){this.noise.setTime(t.particleSystem.time),this.noise.setSpeed(this.noiseSpeedX,this.noiseSpeedY,this.noiseSpeedZ),this.noise.setFrequency(this.noiseFrequency),this.noise.setAbs(this.remapX,this.remapY,this.remapZ),this.noise.setAmplititude(this.strengthX,this.strengthY,this.strengthZ),this.noise.setOctaves(this.octaves,this.octaveMultiplier,this.octaveScale),this.samplePosition.set(t.position),this.samplePosition.add3f(1*ki(),1*ki(),1*ki()),this.noise.setSamplePoint(this.samplePosition),this.noise.getNoiseParticle();const i=this.noise.getResult();i.multiply3f(ki(),ki(),ki()),Ms.add(t.position,t.position,i.multiplyScalar(e))}getNoisePreview(t,e,i,s){this.noise.setTime(e.time),this.noise.setSpeed(this.noiseSpeedX,this.noiseSpeedY,this.noiseSpeedZ),this.noise.setFrequency(this.noiseFrequency),this.noise.setAbs(this.remapX,this.remapY,this.remapZ),this.noise.setAmplititude(this.strengthX,this.strengthY,this.strengthZ),this.noise.setOctaves(this.octaves,this.octaveMultiplier,this.octaveScale),this.noise.getNoiseParticle(),this.noise.getPreview(t,i,s)}},lht=Za(hht.prototype,"_enable",[xht],(function(){return!1})),s(hht.prototype,"strengthX",[qat],Object.getOwnPropertyDescriptor(hht.prototype,"strengthX"),hht.prototype),cht=Za(hht.prototype,"_strengthX",[xht],(function(){return 10})),s(hht.prototype,"strengthY",[$at],Object.getOwnPropertyDescriptor(hht.prototype,"strengthY"),hht.prototype),uht=Za(hht.prototype,"_strengthY",[xht],(function(){return 10})),s(hht.prototype,"strengthZ",[Kat],Object.getOwnPropertyDescriptor(hht.prototype,"strengthZ"),hht.prototype),dht=Za(hht.prototype,"_strengthZ",[xht],(function(){return 10})),s(hht.prototype,"noiseSpeedX",[Zat],Object.getOwnPropertyDescriptor(hht.prototype,"noiseSpeedX"),hht.prototype),_ht=Za(hht.prototype,"_noiseSpeedX",[xht],(function(){return 0})),s(hht.prototype,"noiseSpeedY",[Qat],Object.getOwnPropertyDescriptor(hht.prototype,"noiseSpeedY"),hht.prototype),pht=Za(hht.prototype,"_noiseSpeedY",[xht],(function(){return 0})),s(hht.prototype,"noiseSpeedZ",[Jat],Object.getOwnPropertyDescriptor(hht.prototype,"noiseSpeedZ"),hht.prototype),mht=Za(hht.prototype,"_noiseSpeedZ",[xht],(function(){return 0})),s(hht.prototype,"noiseFrequency",[tht],Object.getOwnPropertyDescriptor(hht.prototype,"noiseFrequency"),hht.prototype),ght=Za(hht.prototype,"_noiseFrequency",[xht],(function(){return 1})),s(hht.prototype,"remapX",[eht],Object.getOwnPropertyDescriptor(hht.prototype,"remapX"),hht.prototype),fht=Za(hht.prototype,"_remapX",[xht],(function(){return 0})),s(hht.prototype,"remapY",[iht],Object.getOwnPropertyDescriptor(hht.prototype,"remapY"),hht.prototype),yht=Za(hht.prototype,"_remapY",[xht],(function(){return 0})),s(hht.prototype,"remapZ",[sht],Object.getOwnPropertyDescriptor(hht.prototype,"remapZ"),hht.prototype),bht=Za(hht.prototype,"_remapZ",[xht],(function(){return 0})),s(hht.prototype,"octaves",[rht],Object.getOwnPropertyDescriptor(hht.prototype,"octaves"),hht.prototype),vht=Za(hht.prototype,"_octaves",[xht],(function(){return 1})),s(hht.prototype,"octaveMultiplier",[nht],Object.getOwnPropertyDescriptor(hht.prototype,"octaveMultiplier"),hht.prototype),Sht=Za(hht.prototype,"_octaveMultiplier",[xht],(function(){return.5})),s(hht.prototype,"octaveScale",[oht],Object.getOwnPropertyDescriptor(hht.prototype,"octaveScale"),hht.prototype),Tht=Za(hht.prototype,"_octaveScale",[xht],(function(){return 2})),aht=hht))||aht);var Pht,Oht,Rht,Bht,Fht,Nht,Lht,kht,zht,Uht,Vht,jht,Hht,Ght,Wht,Xht,Yht,qht,$ht,Kht,Zht,Qht,Jht,tlt,elt,ilt,slt,rlt,nlt,olt,alt,hlt,llt,clt,ult,dlt,_lt,plt,mlt,glt,flt,ylt,blt,vlt,Slt,Tlt,wlt,xlt,Clt,Alt,Dlt,Elt,Ilt,Mlt,Plt,Olt,Rlt,Blt,Flt,Nlt,Llt,klt,zlt,Ult,Vlt,jlt,Hlt,Glt,Wlt,Xlt,Ylt,qlt,$lt,Klt,Zlt,Qlt,Jlt,tct,ect,ict,sct,rct,nct,oct,act,hct,lct,cct,uct,dct,_ct;const pct=new vr,mct=new sr,gct=Object.getOwnPropertyDescriptor($I.prototype,"sharedMaterials");let fct=(Pht=ah("cc.ParticleSystem"),Oht=lh(99),Rht=Xh(jet),Bht=Xh(Lit),Fht=Sh("startSize"),Nht=Xh(det),Lht=Xh(det),kht=Xh(det),zht=Xh(det),Uht=Xh(det),Vht=Xh(det),jht=Xh(det),Hht=Sh("startRotation"),Ght=Xh(det),Wht=Xh(det),Xht=Xh(Lit),Yht=Xh(det),qht=Xh(det),$ht=Xh(det),Kht=Xh([Jrt]),Zht=Xh(Xe),Qht=Xh(kit),Jht=Xh(We),tlt=Xh(We),elt=Xh(We),ilt=Sh("enableCulling"),slt=Xh(Nit),rlt=Xh(Nit),nlt=Xh(Pnt),olt=Xh(Pnt),alt=Xh(ert),hlt=Xh(ert),llt=Xh(Grt),clt=Xh(Grt),ult=Xh(ost),dlt=Xh(ost),_lt=Xh(Ast),plt=Xh(Ast),mlt=Xh(Ust),glt=Xh(Ust),flt=Xh(Drt),ylt=Xh(Drt),blt=Xh(Mht),vlt=Xh(Mht),Slt=Xh(Uat),Tlt=Xh(Uat),wlt=Xh(hat),Pht(xlt=Oht((_ct=class extends LB{get capacity(){return this._capacity}set capacity(t){this._capacity=Math.floor(t>0?t:0),this.processor&&this.processor.model&&this.processor.model.setCapacity(this._capacity)}get prewarm(){return this._prewarm}set prewarm(t){!0===t&&this.loop,this._prewarm=t}get simulationSpace(){return this._simulationSpace}set simulationSpace(t){t!==this._simulationSpace&&(this._simulationSpace=t,this.processor&&(this.processor.updateMaterialParams(),this.processor.updateTrailMaterial()))}set renderCulling(t){this._renderCulling=t,t&&(this._boundingBox||(this._boundingBox=new Ca,this._calculateBounding(!1)))}get renderCulling(){return this._renderCulling}get cullingMode(){return this._cullingMode}set cullingMode(t){this._cullingMode=t}get aabbHalfX(){return this.getBoundingX()||0}set aabbHalfX(t){this.setBoundingX(t)}get aabbHalfY(){return this.getBoundingY()||0}set aabbHalfY(t){this.setBoundingY(t)}get aabbHalfZ(){return this.getBoundingZ()||0}set aabbHalfZ(t){this.setBoundingZ(t)}get dataCulling(){return this._dataCulling}set dataCulling(t){this._dataCulling=t}get sharedMaterials(){return gct.get.call(this)}set sharedMaterials(t){gct.set.call(this,t)}get colorOverLifetimeModule(){return this._colorOverLifetimeModule}set colorOverLifetimeModule(t){t&&(this._colorOverLifetimeModule=t)}get shapeModule(){return this._shapeModule}set shapeModule(t){t&&(this._shapeModule=t)}get sizeOvertimeModule(){return this._sizeOvertimeModule}set sizeOvertimeModule(t){t&&(this._sizeOvertimeModule=t)}get velocityOvertimeModule(){return this._velocityOvertimeModule}set velocityOvertimeModule(t){t&&(this._velocityOvertimeModule=t)}get forceOvertimeModule(){return this._forceOvertimeModule}set forceOvertimeModule(t){t&&(this._forceOvertimeModule=t)}get limitVelocityOvertimeModule(){return this._limitVelocityOvertimeModule}set limitVelocityOvertimeModule(t){t&&(this._limitVelocityOvertimeModule=t)}get rotationOvertimeModule(){return this._rotationOvertimeModule}set rotationOvertimeModule(t){t&&(this._rotationOvertimeModule=t)}get textureAnimationModule(){return this._textureAnimationModule}set textureAnimationModule(t){t&&(this._textureAnimationModule=t)}get noiseModule(){return this._noiseModule}set noiseModule(t){t&&(this._noiseModule=t)}get trailModule(){return this._trailModule}set trailModule(t){t&&(this._trailModule=t)}constructor(){super(),this.startColor=Alt&&Alt(),this.scaleSpace=Dlt&&Dlt(),this.startSize3D=Elt&&Elt(),this.startSizeX=Ilt&&Ilt(),this.startSizeY=Mlt&&Mlt(),this.startSizeZ=Plt&&Plt(),this.startSpeed=Olt&&Olt(),this.startRotation3D=Rlt&&Rlt(),this.startRotationX=Blt&&Blt(),this.startRotationY=Flt&&Flt(),this.startRotationZ=Nlt&&Nlt(),this.startDelay=Llt&&Llt(),this.startLifetime=klt&&klt(),this.duration=zlt&&zlt(),this.loop=Ult&&Ult(),this.simulationSpeed=Vlt&&Vlt(),this.playOnAwake=jlt&&jlt(),this.gravityModifier=Hlt&&Hlt(),this.rateOverTime=Glt&&Glt(),this.rateOverDistance=Wlt&&Wlt(),this.bursts=Xlt&&Xlt(),this._renderCulling=Ylt&&Ylt(),this._cullingMode=qlt&&qlt(),this._aabbHalfX=$lt&&$lt(),this._aabbHalfY=Klt&&Klt(),this._aabbHalfZ=Zlt&&Zlt(),this._dataCulling=Qlt&&Qlt(),this._colorOverLifetimeModule=Jlt&&Jlt(),this._shapeModule=tct&&tct(),this._sizeOvertimeModule=ect&&ect(),this._velocityOvertimeModule=ict&&ict(),this._forceOvertimeModule=sct&&sct(),this._limitVelocityOvertimeModule=rct&&rct(),this._rotationOvertimeModule=nct&&nct(),this._textureAnimationModule=oct&&oct(),this._noiseModule=act&&act(),this._trailModule=hct&&hct(),this.renderer=lct&&lct(),this._prewarm=cct&&cct(),this._capacity=uct&&uct(),this._simulationSpace=dct&&dct(),this.processor=null;const t=this;t.rateOverTime.constant=10,t.startLifetime.constant=5,t.startSizeX.constant=1,t.startSpeed.constant=5,t._isPlaying=!1,t._isPaused=!1,t._isStopped=!0,t._isEmitting=!1,t._needToRestart=!1,t._needRefresh=!0,t._needAttach=!1,t._time=0,t._emitRateTimeCounter=0,t._emitRateDistanceCounter=0,t._oldWPos=new Ms,t._curWPos=new Ms,t._boundingBox=null,t._culler=null,t._oldPos=null,t._curPos=null,t._isCulled=!1,t._isSimulating=!0,t._customData1=new kr,t._customData2=new kr,t._subEmitters=[]}onFocusInEditor(){this.renderer.create(this)}onLoad(){this.renderer.onInit(this),this._shapeModule&&this._shapeModule.onInit(this),this._trailModule&&!this.renderer.useGPU&&this._trailModule.enable&&this._trailModule.onInit(this),this.bindModule(),this._resetPosition()}_onMaterialModified(t,e){null!==this.processor&&this.processor.onMaterialModified(t,e)}_onRebuildPSO(t,e){this.processor.onRebuildPSO(t,e)}_collectModels(){return this._models.length=0,this._models.push(this.processor.model),this._trailModule&&this._trailModule.enable&&this._trailModule.getModel()&&this._models.push(this._trailModule.getModel()),this._models}_attachToScene(){this.processor.attachToScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._attachToScene()}_detachFromScene(){this.processor.detachFromScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._detachFromScene(),this._boundingBox&&(this._boundingBox=null),this._culler&&(this._culler.clear(),this._culler.destroy(),this._culler=null)}bindModule(){this._colorOverLifetimeModule&&this._colorOverLifetimeModule.bindTarget(this.processor),this._sizeOvertimeModule&&this._sizeOvertimeModule.bindTarget(this.processor),this._rotationOvertimeModule&&this._rotationOvertimeModule.bindTarget(this.processor),this._forceOvertimeModule&&this._forceOvertimeModule.bindTarget(this.processor),this._limitVelocityOvertimeModule&&this._limitVelocityOvertimeModule.bindTarget(this.processor),this._velocityOvertimeModule&&this._velocityOvertimeModule.bindTarget(this.processor),this._textureAnimationModule&&this._textureAnimationModule.bindTarget(this.processor),this._noiseModule&&this._noiseModule.bindTarget(this.processor)}play(){if(this._needToRestart&&(this.reset(),this._needToRestart=!1),this._isPaused&&(this._isPaused=!1),this._isStopped&&(this._isStopped=!1),this._isPlaying=!0,this._isEmitting=!0,this._resetPosition(),this._prewarm&&this._prewarmSystem(),this._trailModule&&this._trailModule.play(),this.processor){const t=this.processor.getModel();t&&(t.enabled=this.enabledInHierarchy)}}pause(){this._isStopped?M("pause(): particle system is already stopped."):(this._isPlaying&&(this._isPlaying=!1),this._isPaused=!0)}stopEmitting(){this._isEmitting=!1,this._needToRestart=!0}stop(){(this._isPlaying||this._isPaused)&&this.clear(),this._isPlaying&&(this._isPlaying=!1),this._isPaused&&(this._isPaused=!1),this._isEmitting&&(this._isEmitting=!1),this._isStopped=!0,this._needRefresh=!0,this.reset()}reset(){this._time=0,this._emitRateTimeCounter=0,this._emitRateDistanceCounter=0,this._resetPosition(),this.bursts.forEach((t=>{t.reset()}))}clear(){this.enabledInHierarchy&&(this.processor.clear(),this._trailModule&&this._trailModule.clear()),this._calculateBounding(!1)}getParticleCount(){return this.processor?this.processor.getParticleCount():0}setCustomData1(t,e){kr.set(this._customData1,t,e)}setCustomData2(t,e){kr.set(this._customData2,t,e)}onDestroy(){var t;this.stop(),null!=(t=this.processor.getModel())&&t.scene&&(this.processor.detachFromScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._detachFromScene()),nC.off("director_before_commit",this.beforeRender,this),this.processor.onDestroy(),this._trailModule&&this._trailModule.destroy(),this._culler&&(this._culler.clear(),this._culler.destroy(),this._culler=null)}onEnable(){super.onEnable(),nC.on("director_before_commit",this.beforeRender,this),this.playOnAwake&&this.play(),this.processor.onEnable(),this._trailModule&&this._trailModule.onEnable()}onDisable(){nC.off("director_before_commit",this.beforeRender,this),this.processor.onDisable(),this._trailModule&&this._trailModule.onDisable(),this._boundingBox&&(this._boundingBox=null),this._oldPos=null,this._culler&&(this._culler.clear(),this._culler.destroy(),this._culler=null)}_calculateBounding(t){const e=this;e._boundingBox&&(e._culler||(e._culler=new Xat(e)),e._culler.calculatePositions(),Ca.fromPoints(e._boundingBox,e._culler.minPos,e._culler.maxPos),t?(e.aabbHalfX=e._boundingBox.halfExtents.x,e.aabbHalfY=e._boundingBox.halfExtents.y,e.aabbHalfZ=e._boundingBox.halfExtents.z):(e.aabbHalfX?e.setBoundingX(e.aabbHalfX):e.aabbHalfX=e._boundingBox.halfExtents.x,e.aabbHalfY?e.setBoundingY(e.aabbHalfY):e.aabbHalfY=e._boundingBox.halfExtents.y,e.aabbHalfZ?e.setBoundingZ(e.aabbHalfZ):e.aabbHalfZ=e._boundingBox.halfExtents.z),e._culler.clear())}update(t){const e=this,i=e.processor,s=e.trailModule,r=t*e.simulationSpeed;if(e.renderCulling){e._boundingBox||(e._boundingBox=new Ca,e._calculateBounding(!1)),e._curPos||(e._curPos=new Ms),e.node.getWorldPosition(e._curPos),e._oldPos||(e._oldPos=new Ms,e._oldPos.set(e._curPos));const t=e._curPos,n=e._oldPos;if(!t.equals(n)&&e._boundingBox&&e._culler){const i=t.x-n.x,s=t.y-n.y,r=t.z-n.z,o=e._boundingBox.center;o.x+=i,o.y+=s,o.z+=r,e._culler.setBoundingBoxCenter(o.x,o.y,o.z),n.set(t)}const o=e.node.scene.renderScene,a=o?o.cameras:void 0;let h=!0;if(void 0!==a&&e._boundingBox)for(let t=0;t<a.length;++t){const i=a[t];if((i.visibility&e.node.layer)===e.node.layer&&co.aabbFrustum(e._boundingBox,i.frustum)){h=!1;break}}if(h){if(2!==e._cullingMode&&(e._isSimulating=!1),e._isCulled||(i.detachFromScene(),e._isCulled=!0),s&&s.enable&&s._detachFromScene(),1===e._cullingMode&&(e._time+=r),2!==e._cullingMode)return}else e._isCulled&&(e._attachToScene(),e._isCulled=!1),e._isSimulating||(e._isSimulating=!0);if(!e._isSimulating)return}else e._boundingBox&&(e._boundingBox=null),e._culler&&(e._culler.clear(),e._culler.destroy(),e._culler=null),e._isSimulating=!0;if(e._isPlaying)e._time+=r,e._emit(r),0!==i.updateParticles(r)||e._isEmitting||e.stop();else{const t=(e.getMaterialInstance(0)||i.getDefaultMaterial()).passes[0];i.updateRotation(t),i.updateScale(t)}var n,o;e._needAttach&&e.getParticleCount()>0&&!e._isCulled&&(null!=(n=i.getModel())&&n.scene||i.attachToScene(),s&&s.enable&&(null!=(o=s.getModel())&&o.scene||s._attachToScene()),e._needAttach=!1);!e.renderer.useGPU&&s&&s.enable&&(s.inited||(s.clear(),s.destroy(),s.onInit(this),s.enable=!1,s.enable=!0))}beforeRender(){var t;const e=this,i=e.processor,s=e.trailModule;var r;e.getParticleCount()<=0?null!=(r=i.getModel())&&r.scene&&(i.detachFromScene(),s&&s.enable&&s._detachFromScene(),e._needAttach=!1):null!=(t=i.getModel())&&t.scene||(e._needAttach=!0),e._isPlaying&&(i.updateRenderData(),i.beforeRender(),s&&s.enable&&(s.updateRenderData(),s.beforeRender()))}_onVisibilityChange(t){this.processor.model&&(this.processor.model.visFlags=t)}emit(t,e){const i=this,s=i.node,r=i._time%i.duration/i.duration;i._needRefresh&&(s.invalidateChildren(1),i._needRefresh=!1),0===i._simulationSpace&&(s.getWorldMatrix(pct),s.getWorldRotation(mct));for(let s=0;s<t;++s){const t=i.processor.getFreeParticle();if(null===t)return;t.particleSystem=i,t.reset();const s=ji(Vi(0,u));i._shapeModule&&i._shapeModule.enable?i._shapeModule.emit(t):(Ms.set(t.position,0,0,0),Ms.copy(t.velocity,vit)),i._textureAnimationModule&&i._textureAnimationModule.enable&&i._textureAnimationModule.init(t);const n=i.startSpeed.evaluate(r,s);Ms.multiplyScalar(t.velocity,t.velocity,n),0===i._simulationSpace&&(Ms.transformMat4(t.position,t.position,pct),Ms.transformQuat(t.velocity,t.velocity,mct)),Ms.copy(t.ultimateVelocity,t.velocity),i.startRotation3D?t.startEuler.set(i.startRotationX.evaluate(r,s),i.startRotationY.evaluate(r,s),i.startRotationZ.evaluate(r,s)):t.startEuler.set(0,0,i.startRotationZ.evaluate(r,s)),t.rotation.set(t.startEuler),i.startSize3D?Ms.set(t.startSize,i.startSizeX.evaluate(r,s),i.startSizeY.evaluate(r,s),i.startSizeZ.evaluate(r,s)):(Ms.set(t.startSize,i.startSizeX.evaluate(r,s),1,1),t.startSize.y=t.startSize.x),Ms.copy(t.size,t.startSize),t.startColor.set(i.startColor.evaluate(r,s)),t.color.set(t.startColor),t.startLifetime=i.startLifetime.evaluate(r,s)+e,t.remainingLifetime=t.startLifetime,t.randomSeed=Vi(0,233280),t.loopCount++,i.processor.setNewParticle(t)}}_prewarmSystem(){this.startDelay.mode=uet.Constant,this.startDelay.constant=0;const t=this.duration/1;for(let e=0;e<t;++e)this._time+=1,this._emit(1),this.processor.updateParticles(1)}_emit(t){const e=this,i=e.startDelay.evaluate(0,1);if(e._time>i){if(e._time>e.duration+i&&(e.loop||(e._isEmitting=!1)),!e._isEmitting)return;if(e._emitRateTimeCounter+=e.rateOverTime.evaluate(e._time/e.duration,1)*t,e._emitRateTimeCounter>1){const i=Math.floor(e._emitRateTimeCounter);e._emitRateTimeCounter-=i,e.emit(i,t)}const s=e.rateOverDistance.evaluate(e._time/e.duration,1);if(s>0){Ms.copy(e._oldWPos,e._curWPos),e.node.getWorldPosition(e._curWPos);const t=Ms.distance(e._curWPos,e._oldWPos);e._emitRateDistanceCounter+=t*s}if(e._emitRateDistanceCounter>1){const i=Math.floor(e._emitRateDistanceCounter);e._emitRateDistanceCounter-=i,e.emit(i,t)}for(const i of e.bursts)i.update(e,t)}}_resetPosition(){this.node.getWorldPosition(this._oldWPos),Ms.copy(this._curWPos,this._oldWPos)}addSubEmitter(t){this._subEmitters.push(t)}removeSubEmitter(t){this._subEmitters.splice(this._subEmitters.indexOf(t),1)}addBurst(t){this.bursts.push(t)}removeBurst(t){const e=this.bursts.indexOf(t);e>-1&&this.bursts.splice(e,1)}getBoundingX(){return this._aabbHalfX}getBoundingY(){return this._aabbHalfY}getBoundingZ(){return this._aabbHalfZ}setBoundingX(t){this._boundingBox&&this._culler&&(this._boundingBox.halfExtents.x=t,this._culler.setBoundingBoxSize(this._boundingBox.halfExtents),this._aabbHalfX=t)}setBoundingY(t){this._boundingBox&&this._culler&&(this._boundingBox.halfExtents.y=t,this._culler.setBoundingBoxSize(this._boundingBox.halfExtents),this._aabbHalfY=t)}setBoundingZ(t){this._boundingBox&&this._culler&&(this._boundingBox.halfExtents.z=t,this._culler.setBoundingBoxSize(this._boundingBox.halfExtents),this._aabbHalfZ=t)}get isPlaying(){return this._isPlaying}get isPaused(){return this._isPaused}get isStopped(){return this._isStopped}get isEmitting(){return this._isEmitting}get time(){return this._time}_onBeforeSerialize(t){return this.dataCulling?t.filter((t=>!yit.includes(t)||this[t]&&this[t].enable)):t}getNoisePreview(t,e){const i=[];return this.processor&&this.processor.getNoisePreview(i,t,e),i}},_ct.CullingMode=kit,Alt=Za((Clt=_ct).prototype,"startColor",[Rht,vh],(function(){return new jet})),Dlt=Za(Clt.prototype,"scaleSpace",[Bht,vh],(function(){return 1})),Elt=Za(Clt.prototype,"startSize3D",[vh],(function(){return!1})),Ilt=Za(Clt.prototype,"startSizeX",[Fht,Nht],(function(){return new det})),Mlt=Za(Clt.prototype,"startSizeY",[Lht,vh],(function(){return new det})),Plt=Za(Clt.prototype,"startSizeZ",[kht,vh],(function(){return new det})),Olt=Za(Clt.prototype,"startSpeed",[zht,vh],(function(){return new det})),Rlt=Za(Clt.prototype,"startRotation3D",[vh],(function(){return!1})),Blt=Za(Clt.prototype,"startRotationX",[Uht,vh],(function(){return new det})),Flt=Za(Clt.prototype,"startRotationY",[Vht,vh],(function(){return new det})),Nlt=Za(Clt.prototype,"startRotationZ",[jht,Hht],(function(){return new det})),Llt=Za(Clt.prototype,"startDelay",[Ght,vh],(function(){return new det})),klt=Za(Clt.prototype,"startLifetime",[Wht,vh],(function(){return new det})),zlt=Za(Clt.prototype,"duration",[vh],(function(){return 5})),Ult=Za(Clt.prototype,"loop",[vh],(function(){return!0})),s(Clt.prototype,"simulationSpace",[Xht,vh],Object.getOwnPropertyDescriptor(Clt.prototype,"simulationSpace"),Clt.prototype),Vlt=Za(Clt.prototype,"simulationSpeed",[vh],(function(){return 1})),jlt=Za(Clt.prototype,"playOnAwake",[vh],(function(){return!0})),Hlt=Za(Clt.prototype,"gravityModifier",[Yht,vh],(function(){return new det})),Glt=Za(Clt.prototype,"rateOverTime",[qht,vh],(function(){return new det})),Wlt=Za(Clt.prototype,"rateOverDistance",[$ht,vh],(function(){return new det})),Xlt=Za(Clt.prototype,"bursts",[Kht,vh],(function(){return[]})),s(Clt.prototype,"renderCulling",[Zht],Object.getOwnPropertyDescriptor(Clt.prototype,"renderCulling"),Clt.prototype),Ylt=Za(Clt.prototype,"_renderCulling",[vh],(function(){return!1})),s(Clt.prototype,"cullingMode",[Qht],Object.getOwnPropertyDescriptor(Clt.prototype,"cullingMode"),Clt.prototype),qlt=Za(Clt.prototype,"_cullingMode",[vh],(function(){return 0})),s(Clt.prototype,"aabbHalfX",[Jht],Object.getOwnPropertyDescriptor(Clt.prototype,"aabbHalfX"),Clt.prototype),$lt=Za(Clt.prototype,"_aabbHalfX",[vh],(function(){return 0})),s(Clt.prototype,"aabbHalfY",[tlt],Object.getOwnPropertyDescriptor(Clt.prototype,"aabbHalfY"),Clt.prototype),Klt=Za(Clt.prototype,"_aabbHalfY",[vh],(function(){return 0})),s(Clt.prototype,"aabbHalfZ",[elt],Object.getOwnPropertyDescriptor(Clt.prototype,"aabbHalfZ"),Clt.prototype),Zlt=Za(Clt.prototype,"_aabbHalfZ",[vh],(function(){return 0})),Qlt=Za(Clt.prototype,"_dataCulling",[vh,ilt],(function(){return!1})),s(Clt.prototype,"sharedMaterials",[Yh,vh],Object.getOwnPropertyDescriptor(Clt.prototype,"sharedMaterials"),Clt.prototype),Jlt=Za(Clt.prototype,"_colorOverLifetimeModule",[slt],(function(){return null})),s(Clt.prototype,"colorOverLifetimeModule",[rlt],Object.getOwnPropertyDescriptor(Clt.prototype,"colorOverLifetimeModule"),Clt.prototype),tct=Za(Clt.prototype,"_shapeModule",[nlt],(function(){return null})),s(Clt.prototype,"shapeModule",[olt],Object.getOwnPropertyDescriptor(Clt.prototype,"shapeModule"),Clt.prototype),ect=Za(Clt.prototype,"_sizeOvertimeModule",[alt],(function(){return null})),s(Clt.prototype,"sizeOvertimeModule",[hlt],Object.getOwnPropertyDescriptor(Clt.prototype,"sizeOvertimeModule"),Clt.prototype),ict=Za(Clt.prototype,"_velocityOvertimeModule",[llt],(function(){return null})),s(Clt.prototype,"velocityOvertimeModule",[clt],Object.getOwnPropertyDescriptor(Clt.prototype,"velocityOvertimeModule"),Clt.prototype),sct=Za(Clt.prototype,"_forceOvertimeModule",[ult],(function(){return null})),s(Clt.prototype,"forceOvertimeModule",[dlt],Object.getOwnPropertyDescriptor(Clt.prototype,"forceOvertimeModule"),Clt.prototype),rct=Za(Clt.prototype,"_limitVelocityOvertimeModule",[_lt],(function(){return null})),s(Clt.prototype,"limitVelocityOvertimeModule",[plt],Object.getOwnPropertyDescriptor(Clt.prototype,"limitVelocityOvertimeModule"),Clt.prototype),nct=Za(Clt.prototype,"_rotationOvertimeModule",[mlt],(function(){return null})),s(Clt.prototype,"rotationOvertimeModule",[glt],Object.getOwnPropertyDescriptor(Clt.prototype,"rotationOvertimeModule"),Clt.prototype),oct=Za(Clt.prototype,"_textureAnimationModule",[flt],(function(){return null})),s(Clt.prototype,"textureAnimationModule",[ylt],Object.getOwnPropertyDescriptor(Clt.prototype,"textureAnimationModule"),Clt.prototype),act=Za(Clt.prototype,"_noiseModule",[blt],(function(){return null})),s(Clt.prototype,"noiseModule",[vlt],Object.getOwnPropertyDescriptor(Clt.prototype,"noiseModule"),Clt.prototype),hct=Za(Clt.prototype,"_trailModule",[Slt],(function(){return null})),s(Clt.prototype,"trailModule",[Tlt],Object.getOwnPropertyDescriptor(Clt.prototype,"trailModule"),Clt.prototype),lct=Za(Clt.prototype,"renderer",[wlt,vh],(function(){return new hat})),cct=Za(Clt.prototype,"_prewarm",[vh],(function(){return!1})),uct=Za(Clt.prototype,"_capacity",[vh],(function(){return 100})),dct=Za(Clt.prototype,"_simulationSpace",[vh],(function(){return 1})),xlt=Clt))||xlt)||xlt);t({ParticleSystem:fct,ParticleSystemComponent:fct});class yct{static instantiate(t){this.registeredSceneEvent||(nC.on("director_before_scene_launch",this.onSceneUnload,this),this.registeredSceneEvent=!0);const e=t._uuid;if(!this.particleSystemPool.has(e)){const i=new vo((()=>HX(t)||new tb),1,(t=>t.destroy()));this.particleSystemPool.set(e,i)}return this.particleSystemPool.get(e).alloc()}static destroy(t){var e,i;const s=null==(e=t.prefab)||null==(i=e.asset)?void 0:i.uuid;s&&this.particleSystemPool.has(s)&&(this.stop(t),this.particleSystemPool.get(s).free(t))}static play(t){for(const e of t.getComponentsInChildren(fct))e.play()}static stop(t){for(const e of t.getComponentsInChildren(fct))e.stop()}static onSceneUnload(){this.particleSystemPool.forEach((t=>t.destroy())),this.particleSystemPool.clear()}}t("ParticleUtils",yct),yct.particleSystemPool=new Map,yct.registeredSceneEvent=!1,J(Jrt.prototype,"Burst.prototype",[{name:"minCount"},{name:"maxCount"}]),Q(fct.prototype,"ParticleSystem.prototype",[{name:"enableCulling",newName:"dataCulling"}]),a.ParticleSystemComponent=fct,Xt(fct,"cc.ParticleSystemComponent"),a.BillboardComponent=eet,Xt(eet,"cc.BillboardComponent"),a.LineComponent=pit,Xt(pit,"cc.LineComponent"),a.ParticleUtils=yct;const bct=pe({GRAVITY:0,RADIUS:1}),vct=pe({FREE:0,RELATIVE:1,GROUPED:2}),Sct=new kr,Tct=new kr,wct=new kr,xct=new kr,Cct=new ms,Act=iI(QE);function Dct(t){let e=0,i=t;for(;i;)e+=i.eulerAngles.z,i=i.parent;return e}class Ect{constructor(){this.pos=new kr(0,0),this.startPos=new kr(0,0),this.color=new Ls(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new kr(0,0),this.aspectRatio=1,this.dir=new kr(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0}}const Ict=new class extends Jt{get(){return this._get()||new Ect}}((t=>{t.pos.set(kr.ZERO),t.startPos.set(kr.ZERO),t.color.set(0,0,0,255),t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(kr.ZERO),t.aspectRatio=1,t.dir.set(kr.ZERO),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0}),1024);class Mct{constructor(t){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.renderData=null,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this._worldRotation=0,this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this.uvFilled=0,this._worldRotation=0}stop(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0}reset(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;const t=this.particles;for(let e=0;e<t.length;++e)Ict.put(t[e]);t.length=0,this.renderData&&this.renderData.resize(0,0)}emitParticle(t){const e=this.sys,i=Ict.get();this.particles.push(i),i.timeToLive=e.life+e.lifeVar*(ki()-.5)*2;const s=i.timeToLive=Math.max(0,i.timeToLive);i.pos.x=e.sourcePos.x+e.posVar.x*(ki()-.5)*2,i.pos.y=e.sourcePos.y+e.posVar.y*(ki()-.5)*2;let r=0,n=0,o=0,a=0;const h=e.startColor,l=e.startColorVar,c=e.endColor,u=e.endColorVar;i.color.r=r=Ri(h.r+l.r*(ki()-.5)*2,0,255),i.color.g=n=Ri(h.g+l.g*(ki()-.5)*2,0,255),i.color.b=o=Ri(h.b+l.b*(ki()-.5)*2,0,255),i.color.a=a=Ri(h.a+l.a*(ki()-.5)*2,0,255),i.deltaColor.r=(Ri(c.r+u.r*(ki()-.5)*2,0,255)-r)/s,i.deltaColor.g=(Ri(c.g+u.g*(ki()-.5)*2,0,255)-n)/s,i.deltaColor.b=(Ri(c.b+u.b*(ki()-.5)*2,0,255)-o)/s,i.deltaColor.a=(Ri(c.a+u.a*(ki()-.5)*2,0,255)-a)/s;let d=e.startSize+e.startSizeVar*(ki()-.5)*2;if(d=Math.max(0,d),i.size=d,-1===e.endSize)i.deltaSize=0;else{let t=e.endSize+e.endSizeVar*(ki()-.5)*2;t=Math.max(0,t),i.deltaSize=(t-d)/s}const _=e.startSpin+e.startSpinVar*(ki()-.5)*2,p=e.endSpin+e.endSpinVar*(ki()-.5)*2;i.rotation=_,i.deltaRotation=(p-_)/s,i.startPos.x=t.x,i.startPos.y=t.y,i.aspectRatio=e.aspectRatio||1;const m=Ni(e.angle+this._worldRotation+e.angleVar*(ki()-.5)*2);if(e.emitterMode===bct.GRAVITY){const t=e.speed+e.speedVar*(ki()-.5)*2;i.dir.x=Math.cos(m),i.dir.y=Math.sin(m),i.dir.multiplyScalar(t),i.radialAccel=e.radialAccel+e.radialAccelVar*(ki()-.5)*2,i.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(ki()-.5)*2,e.rotationIsDir&&(i.rotation=-Li(Math.atan2(i.dir.y,i.dir.x)))}else{const t=e.startRadius+e.startRadiusVar*(ki()-.5)*2,r=e.endRadius+e.endRadiusVar*(ki()-.5)*2;i.radius=t,i.deltaRadius=-1===e.endRadius?0:(r-t)/s,i.angle=m,i.degreesPerSecond=Ni(e.rotatePerS+e.rotatePerSVar*(ki()-.5)*2)}}updateUVs(t){const e=this.renderData;if(e&&this.sys._renderSpriteFrame){const i=e.vData,s=this.sys._renderSpriteFrame.uv,r=t?0:this.uvFilled,n=this.particles.length;for(let t=r;t<n;t++){const e=t*Act*4;i[e+3]=s[0],i[e+4]=s[1],i[e+12]=s[2],i[e+13]=s[3],i[e+21]=s[4],i[e+22]=s[5],i[e+30]=s[6],i[e+31]=s[7]}this.uvFilled=n}}updateParticleBuffer(t,e,i,s){const r=i.vData,n=e.x,o=e.y;let a=t.size,h=a;const l=t.aspectRatio;l>1?h=a/l:a=h*l;const c=a/2,u=h/2;if(t.rotation){const e=-c,i=-u,a=c,h=u,l=-Ni(t.rotation),d=Math.cos(l),_=Math.sin(l);r[s]=e*d-i*_+n,r[s+1]=e*_+i*d+o,r[s+2]=0,r[s+9]=a*d-i*_+n,r[s+10]=a*_+i*d+o,r[s+11]=0,r[s+18]=e*d-h*_+n,r[s+19]=e*_+h*d+o,r[s+20]=0,r[s+27]=a*d-h*_+n,r[s+28]=a*_+h*d+o,r[s+29]=0}else r[s]=n-c,r[s+1]=o-u,r[s+2]=0,r[s+9]=n+c,r[s+10]=o-u,r[s+11]=0,r[s+18]=n-c,r[s+19]=o+u,r[s+20]=0,r[s+27]=n+c,r[s+28]=o+u,r[s+29]=0;const d=t.color;Cct.x=d.r/255,Cct.y=d.g/255,Cct.z=d.b/255,Cct.w=d.a/255,ms.toArray(r,Cct,s+5),ms.toArray(r,Cct,s+14),ms.toArray(r,Cct,s+23),ms.toArray(r,Cct,s+32)}step(t){const e=this.sys.assembler,i=this.sys,s=i.node,r=this.particles;if(t=t>e.maxParticleDeltaTime?e.maxParticleDeltaTime:t,s.updateWorldTransform(),i.positionType===vct.FREE){this._worldRotation=Dct(s);const t=s.worldMatrix;Sct.x=t.m12,Sct.y=t.m13}else i.positionType===vct.RELATIVE?(this._worldRotation=s.eulerAngles.z,Sct.x=s.position.x,Sct.y=s.position.y):this._worldRotation=0;if(this.active&&i.emissionRate){const e=1/i.emissionRate;for(r.length<i.totalParticles&&(this.emitCounter+=t);r.length<i.totalParticles&&this.emitCounter>e;)this.emitParticle(Sct),this.emitCounter-=e;this.elapsed+=t,-1!==i.duration&&i.duration<this.elapsed&&i.stopSystem()}const n=this.renderData;if(!n)return;const o=r.length;n.reset(),this.requestData(4*o,6*o),o>this.uvFilled&&this.updateUVs();let a=0;for(;a<r.length;){Tct.x=Tct.y=wct.x=wct.y=xct.x=xct.y=0;const e=r[a];if(e.timeToLive-=t,e.timeToLive>0){if(i.emitterMode===bct.GRAVITY){const s=xct,r=Tct,n=wct;(e.pos.x||e.pos.y)&&(r.set(e.pos),r.normalize()),n.set(r),r.multiplyScalar(e.radialAccel);const o=n.x;n.x=-n.y,n.y=o,n.multiplyScalar(e.tangentialAccel),s.set(r),s.add(n),s.add(i.gravity),s.multiplyScalar(t),e.dir.add(s),s.set(e.dir),s.multiplyScalar(t),e.pos.add(s)}else e.angle+=e.degreesPerSecond*t,e.radius+=e.deltaRadius*t,e.pos.x=-Math.cos(e.angle)*e.radius,e.pos.y=-Math.sin(e.angle)*e.radius;e.color.r+=e.deltaColor.r*t,e.color.g+=e.deltaColor.g*t,e.color.b+=e.deltaColor.b*t,e.color.a+=e.deltaColor.a*t,e.size+=e.deltaSize*t,e.size<0&&(e.size=0),e.rotation+=e.deltaRotation*t;const s=Tct;s.set(e.pos),i.positionType!==vct.GROUPED&&s.add(e.startPos);const r=Act*a*4;this.updateParticleBuffer(e,s,n,r),++a}else{const t=r[a];a!==r.length-1&&(r[a]=r[r.length-1]),Ict.put(t),r.length--,n.resize(n.vertexCount-4,n.indexCount-6)}}n.material=this.sys.getRenderMaterial(0),n.frame=this.sys._renderSpriteFrame,n.setRenderDrawInfoAttributes(),0!==r.length||this.active||this.readyToPlay||(this.finished=!0,i._finishedSimulation())}requestData(t,e){if(!this.renderData)return;let i=this.renderData.indexCount;this.renderData.request(t,e);const s=this.renderData.indexCount/6,r=this.renderData.iData;for(let t=i;t<s;t++){const e=4*t;r[i++]=e,r[i++]=e+1,r[i++]=e+2,r[i++]=e+1,r[i++]=e+3,r[i++]=e+2}}initDrawInfo(){var t;null==(t=this.renderData)||t.setRenderDrawInfoAttributes()}}var Pct,Oct,Rct;const{ccclass:Bct,serializable:Fct,editable:Nct}=il;let Lct=t("ParticleAsset",Bct("cc.ParticleAsset")((Oct=class extends fm{constructor(...t){super(...t),this.spriteFrame=Rct&&Rct()}},Rct=Za(Oct.prototype,"spriteFrame",[Fct],(function(){return null})),Pct=Oct))||Pct);a.ParticleAsset=Lct;var kct={};(function(){function t(t){throw t}var e=void 0,i=this;function s(t,s){var r,n=t.split("."),o=i;!(n[0]in o)&&o.execScript&&o.execScript("var "+n[0]);for(;n.length&&(r=n.shift());)n.length||s===e?o=o[r]?o[r]:o[r]={}:o[r]=s}var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function n(t){var e,i,s,n,o,a,h,l,c,u,d=t.length,_=0,p=Number.POSITIVE_INFINITY;for(l=0;l<d;++l)t[l]>_&&(_=t[l]),t[l]<p&&(p=t[l]);for(e=1<<_,i=new(r?Uint32Array:Array)(e),s=1,n=0,o=2;s<=_;){for(l=0;l<d;++l)if(t[l]===s){for(a=0,h=n,c=0;c<s;++c)a=a<<1|1&h,h>>=1;for(u=s<<16|l,c=a;c<e;c+=o)i[c]=u;++n}++s,n<<=1,o<<=1}return[i,_,p]}function o(e,i){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.j=0,this.input=r?new Uint8Array(e):e,this.k=!1,this.e=h,this.o=!1,!i&&(i={})||(i.index&&(this.a=i.index),i.bufferSize&&(this.h=i.bufferSize),i.bufferType&&(this.e=i.bufferType),i.resize&&(this.o=i.resize)),this.e){case a:this.b=32768,this.c=new(r?Uint8Array:Array)(32768+this.h+258);break;case h:this.b=0,this.c=new(r?Uint8Array:Array)(this.h);break;default:t(Error("invalid inflate mode"))}}var a=0,h=1,l={q:a,p:h};o.prototype.i=function(){for(;!this.k;){var i=E(this,3);switch(1&i&&(this.k=!0),i>>>=1){case 0:var s=this.input,o=this.a,l=this.c,c=this.b,u=s.length,d=e,p=l.length,m=e;switch(this.d=this.f=0,o+1>=u&&t(Error("invalid uncompressed block header: LEN")),d=s[o++]|s[o++]<<8,o+1>=u&&t(Error("invalid uncompressed block header: NLEN")),d===~(s[o++]|s[o++]<<8)&&t(Error("invalid uncompressed block header: length verify")),o+d>s.length&&t(Error("input buffer is broken")),this.e){case a:for(;c+d>l.length;){if(d-=m=p-c,r)l.set(s.subarray(o,o+m),c),c+=m,o+=m;else for(;m--;)l[c++]=s[o++];this.b=c,l=O(this),c=this.b}break;case h:for(;c+d>l.length;)l=R(this,{m:2});break;default:t(Error("invalid inflate mode"))}if(r)l.set(s.subarray(o,o+d),c),c+=d,o+=d;else for(;d--;)l[c++]=s[o++];this.a=o,this.b=c,this.c=l;break;case 1:switch(this.e){case h:P(this,C,D);break;case a:M(this,C,D);break;default:t(Error("invalid inflate mode"))}break;case 2:var g,f,y,b,v=E(this,5)+257,S=E(this,5)+1,T=E(this,4)+4,w=new(r?Uint8Array:Array)(_.length),x=e,A=e,B=e,F=e,N=e;for(N=0;N<T;++N)w[_[N]]=E(this,3);if(!r)for(N=T,T=w.length;N<T;++N)w[_[N]]=0;for(g=n(w),x=new(r?Uint8Array:Array)(v+S),N=0,b=v+S;N<b;)switch(A=I(this,g),A){case 16:for(F=3+E(this,2);F--;)x[N++]=B;break;case 17:for(F=3+E(this,3);F--;)x[N++]=0;B=0;break;case 18:for(F=11+E(this,7);F--;)x[N++]=0;B=0;break;default:B=x[N++]=A}switch(f=n(r?x.subarray(0,v):x.slice(0,v)),y=n(r?x.subarray(v):x.slice(v)),this.e){case h:P(this,f,y);break;case a:M(this,f,y);break;default:t(Error("invalid inflate mode"))}break;default:t(Error("unknown BTYPE: "+i))}}switch(this.e){case a:var L,k,z,U,V,j,H=0,G=this.c,W=this.g,X=new(r?Uint8Array:Array)(this.j+(this.b-32768));if(0===W.length)L=r?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);else{for(z=0,U=W.length;z<U;++z)for(V=0,j=(k=W[z]).length;V<j;++V)X[H++]=k[V];for(z=32768,U=this.b;z<U;++z)X[H++]=G[z];this.g=[],L=this.buffer=X}return L;case h:var Y,q=this.b;return r?this.o?(Y=new Uint8Array(q)).set(this.c.subarray(0,q)):Y=this.c.subarray(0,q):(this.c.length>q&&(this.c.length=q),Y=this.c),this.buffer=Y;default:t(Error("invalid inflate mode"))}};var c,u,d=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],_=r?new Uint16Array(d):d,p=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],m=r?new Uint16Array(p):p,g=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],f=r?new Uint8Array(g):g,y=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],b=r?new Uint16Array(y):y,v=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=r?new Uint8Array(v):v,T=new(r?Uint8Array:Array)(288);for(c=0,u=T.length;c<u;++c)T[c]=143>=c?8:255>=c?9:279>=c?7:8;var w,x,C=n(T),A=new(r?Uint8Array:Array)(30);for(w=0,x=A.length;w<x;++w)A[w]=5;var D=n(A);function E(e,i){var s,r=e.f,n=e.d,o=e.input,a=e.a;for(a+(i-n+7>>3)>=o.length&&t(Error("input buffer is broken"));n<i;)r|=o[a++]<<n,n+=8;return s=r&(1<<i)-1,e.f=r>>>i,e.d=n-i,e.a=a,s}function I(e,i){for(var s,r,n=e.f,o=e.d,a=e.input,h=e.a,l=a.length,c=i[0],u=i[1];o<u&&!(h>=l);)n|=a[h++]<<o,o+=8;return(r=(s=c[n&(1<<u)-1])>>>16)>o&&t(Error("invalid code length: "+r)),e.f=n>>r,e.d=o-r,e.a=h,65535&s}function M(t,e,i){var s=t.c,r=t.b;t.l=e;for(var n,o,a,h,l=s.length-258;256!==(n=I(t,e));)if(256>n)r>=l&&(t.b=r,s=O(t),r=t.b),s[r++]=n;else for(h=m[o=n-257],0<f[o]&&(h+=E(t,f[o])),n=I(t,i),a=b[n],0<S[n]&&(a+=E(t,S[n])),r>=l&&(t.b=r,s=O(t),r=t.b);h--;)s[r]=s[r++-a];for(;8<=t.d;)t.d-=8,t.a--;t.b=r}function P(t,e,i){var s=t.c,r=t.b;t.l=e;for(var n,o,a,h,l=s.length;256!==(n=I(t,e));)if(256>n)r>=l&&(l=(s=R(t)).length),s[r++]=n;else for(h=m[o=n-257],0<f[o]&&(h+=E(t,f[o])),n=I(t,i),a=b[n],0<S[n]&&(a+=E(t,S[n])),r+h>l&&(l=(s=R(t)).length);h--;)s[r]=s[r++-a];for(;8<=t.d;)t.d-=8,t.a--;t.b=r}function O(t){var e,i,s=new(r?Uint8Array:Array)(t.b-32768),n=t.b-32768,o=t.c;if(r)s.set(o.subarray(32768,s.length));else for(e=0,i=s.length;e<i;++e)s[e]=o[e+32768];if(t.g.push(s),t.j+=s.length,r)o.set(o.subarray(n,n+32768));else for(e=0;32768>e;++e)o[e]=o[n+e];return t.b=32768,o}function R(t,e){var i,s,n,o=t.input.length/t.a+1|0,a=t.input,h=t.c;return e&&("number"==typeof e.m&&(o=e.m),"number"==typeof e.r&&(o+=e.r)),s=2>o?(n=(a.length-t.a)/t.l[2]/2*258|0)<h.length?h.length+n:h.length<<1:h.length*o,r?(i=new Uint8Array(s)).set(h):i=h,t.c=i,t.c}function B(e,i){var s,r;this.input=e,this.a=0,!i&&(i={})||(i.index&&(this.a=i.index),i.verify&&(this.s=i.verify)),s=e[this.a++],r=e[this.a++],(15&s)===F?this.method=F:t(Error("unsupported compression method")),0!=((s<<8)+r)%31&&t(Error("invalid fcheck flag:"+((s<<8)+r)%31)),32&r&&t(Error("fdict flag is not supported")),this.n=new o(e,{index:this.a,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}B.prototype.i=function(){var e,i,s=this.input;if(e=this.n.i(),this.a=this.n.a,this.s){i=(s[this.a++]<<24|s[this.a++]<<16|s[this.a++]<<8|s[this.a++])>>>0;var r=e;if("string"==typeof r){var n,o,a=r.split("");for(n=0,o=a.length;n<o;n++)a[n]=(255&a[n].charCodeAt(0))>>>0;r=a}for(var h,l=1,c=0,u=r.length,d=0;0<u;){u-=h=1024<u?1024:u;do{c+=l+=r[d++]}while(--h);l%=65521,c%=65521}i!==(c<<16|l)>>>0&&t(Error("invalid adler-32 checksum"))}return e};var F=8;s("Zlib.Inflate",B),s("Zlib.Inflate.prototype.decompress",B.prototype.i);var N,L,k,z,U={ADAPTIVE:l.p,BLOCK:l.q};if(Object.keys)N=Object.keys(U);else for(L in N=[],k=0,U)N[k++]=L;for(k=0,z=N.length;k<z;++k)s("Zlib.Inflate.BufferType."+(L=N[k]),U[L])}).call(kct);var zct=kct.Zlib;zct.Inflate=zct.Inflate,zct.Inflate.BufferType=zct.Inflate.BufferType,zct.Inflate.prototype.decompress=zct.Inflate.prototype.decompress;class Uct{constructor(t){this.pos=8,this.palette=[],this.imgData=[],this.transparency={indexed:[],rgb:[],grayscale:0},this.text={},this.width=0,this.height=0,this.bits=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.hasAlphaChannel=!1,this.pixelBitlength=0,this._decodedPalette=null;const e=this.data=t;let i,s=0;for(;;){s=this.readUInt32();const r=(()=>{const t=[];for(let i=0;i<4;++i)t.push(String.fromCharCode(e[this.pos++]));return t}).call(this).join("");switch(r){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=e[this.pos++],this.colorType=e[this.pos++],this.compressionMethod=e[this.pos++],this.filterMethod=e[this.pos++],this.interlaceMethod=e[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(s);break;case"fcTL":{i&&this.animation.frames.push(i),this.pos+=4,i={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32(),delay:0,disposeOp:0,blendOp:0,data:[]};const t=this.readUInt16(),s=this.readUInt16()||100;i.delay=1e3*t/s,i.disposeOp=e[this.pos++],i.blendOp=e[this.pos++];break}case"IDAT":case"fdAT":"fdAT"===r&&(this.pos+=4,s-=4),t=(null!=i?i.data:void 0)||this.imgData;for(let i=0;s>=0?i<s:i>s;s>=0?++i:--i)t.push(e[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:{this.transparency.indexed=this.read(s);const t=255-this.transparency.indexed.length;if(t>0)for(let e=0;t>=0?e<t:e>t;t>=0?++e:--e)this.transparency.indexed.push(255);break}case 0:this.transparency.grayscale=this.read(s)[0];break;case 2:this.transparency.rgb=this.read(s)}break;case"tEXt":{const t=this.read(s),e=t.indexOf(0),i=String.fromCharCode.apply(String,t.slice(0,e));this.text[i]=String.fromCharCode.apply(String,t.slice(e+1));break}case"IEND":{i&&this.animation.frames.push(i),this.colors=(()=>{switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3;default:return}}).call(this);const t=this.colorType;this.hasAlphaChannel=4===t||6===t;const e=this.colors+(this.hasAlphaChannel?1:0);return this.pixelBitlength=this.bits*e,this.colorSpace=(()=>{switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB";default:return}}).call(this),void(this.imgData instanceof Uint8Array||(this.imgData=new Uint8Array(this.imgData)))}default:this.pos+=s}if(this.pos+=4,this.pos>e.length)throw new Error(q(6017))}}read(t){let e=0;const i=[];for(e=0;t>=0?e<t:e>t;t>=0?++e:--e)i.push(this.data[this.pos++]);return i}readUInt32(){const t=this.data;return t[this.pos++]<<24|t[this.pos++]<<16|t[this.pos++]<<8|t[this.pos++]}readUInt16(){return this.data[this.pos++]<<8|this.data[this.pos++]}decodePixels(t){if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);t=new zct.Inflate(t,{index:0,verify:!1}).decompress();const e=this.pixelBitlength/8,i=e*this.width,s=new Uint8Array(i*this.height),r=t.length;let n=0,o=0,a=0,h=0,l=0,c=0,u=0,d=0,_=0,p=0,m=0,g=0,f=0,y=0,b=0,v=0,S=0,T=0,w=0;for(;o<r;){switch(t[o++]){case 0:for(c=u=0;u<i;c=u+=1)s[a++]=t[o++];break;case 1:for(c=d=0;d<i;c=d+=1)h=t[o++],g=c<e?0:s[a-e],s[a++]=(h+g)%256;break;case 2:for(c=_=0;_<i;c=_+=1)h=t[o++],l=(c-c%e)/e,T=n&&s[(n-1)*i+l*e+c%e],s[a++]=(T+h)%256;break;case 3:for(c=p=0;p<i;c=p+=1)h=t[o++],l=(c-c%e)/e,g=c<e?0:s[a-e],T=n&&s[(n-1)*i+l*e+c%e],s[a++]=(h+Math.floor((g+T)/2))%256;break;case 4:for(c=m=0;m<i;c=m+=1)h=t[o++],l=(c-c%e)/e,g=c<e?0:s[a-e],0===n?T=w=0:(T=s[(n-1)*i+l*e+c%e],w=l&&s[(n-1)*i+(l-1)*e+c%e]),f=g+T-w,y=Math.abs(f-g),v=Math.abs(f-T),S=Math.abs(f-w),b=y<=v&&y<=S?g:v<=S?T:w,s[a++]=(h+b)%256;break;default:throw new Error(q(6018,t[o-1]))}n++}return s}copyToImageData(t,e){let i,s=this.hasAlphaChannel,r=this.colors;this.palette.length&&(i=null!=this._decodedPalette?this._decodedPalette:this._decodedPalette=this.decodePalette(),r=4,s=!0);const n=t.data||t,o=n.length,a=i||e;let h=0,l=0,c=0,u=0;if(1===r)for(;h<o;)c=i?4*e[h/4]:l,u=a[c++],n[h++]=u,n[h++]=u,n[h++]=u,n[h++]=s?a[c++]:255,l=c;else for(;h<o;)c=i?4*e[h/4]:l,n[h++]=a[c++],n[h++]=a[c++],n[h++]=a[c++],n[h++]=s?a[c++]:255,l=c}decodePalette(){const t=this.palette,e=this.transparency.indexed||[],i=new Uint8Array((e.length||0)+t.length);let s=0,r=0,n=0;for(let o=0,a=0,h=t.length;a<h;o=a+=3)i[s++]=t[o],i[s++]=t[o+1],i[s++]=t[o+2],n=e[r++],i[s++]=null!=n?n:255;return i}render(t){t.width=this.width,t.height=this.height;const e=t.getContext("2d");if(!e)return;const i=e.createImageData(this.width,this.height);this.copyToImageData(i,this.decodePixels(null)),e.putImageData(i,0,0)}}const Vct={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},jct={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"},Hct=new class{constructor(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[],this._canvas=null}getUint8(t){return this._tiffData[t]}getUint16(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]}getUint32(t){const e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}checkLittleEndian(){const t=this.getUint16(0);if(18761===t)this._littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(q(6019));this._littleEndian=!1}return this._littleEndian}hasTowel(){if(42!==this.getUint16(2))throw RangeError(q(6020));return!0}getFieldTypeName(t){return t in jct?jct[t]:null}getFieldTagName(t){return t in Vct?Vct[t]:(k(6021,t),`Tag${t}`)}getFieldTypeLength(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:0}getFieldValues(t,e,i,s){const r=[],n=this.getFieldTypeLength(e);if(n*i<=4)!1===this._littleEndian?r.push(s>>>8*(4-n)):r.push(s);else for(let t=0;t<i;t++){const i=n*t;n>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(r.push(this.getUint32(s+i)),r.push(this.getUint32(s+i+4))):k(8e3):r.push(this.getBytes(n,s+i))}return"ASCII"===e&&r.forEach(((t,e,i)=>{i[e]=String.fromCharCode(t)})),r}getBytes(t,e){if(t<=0)k(8001);else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);k(8002)}return 0}getBits(t,e,i){i=i||0;const s=e+Math.floor(i/8),r=i+t,n=32-t;let o=0,a=0;return r<=0?k(6023):r<=8?(o=24+i,a=this.getUint8(s)):r<=16?(o=16+i,a=this.getUint16(s)):r<=32?(o=i,a=this.getUint32(s)):k(6022),{bits:a<<o>>>n,byteOffset:s+Math.floor(r/8),bitOffset:r%8}}parseFileDirectory(t){const e=this.getUint16(t),i={};let s=0,r=0;for(s=t+2,r=0;r<e;s+=12,r++){const t=this.getUint16(s),e=this.getUint16(s+2),r=this.getUint32(s+4),n=this.getUint32(s+8),o=this.getFieldTagName(t),a=this.getFieldTypeName(e),h=this.getFieldValues(o,a,r,n);i[o]={type:a,values:h}}this._fileDirectories.push(i);const n=this.getUint32(s);0!==n&&this.parseFileDirectory(n)}clampColorSample(t,e){const i=2**(8-e);return Math.floor(t*i+(i-1))}reset(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[],this._canvas=null}parseTIFF(t,e){if(e=e||c.document.createElement("canvas"),this._tiffData=t,this._canvas=e,this.checkLittleEndian(),!this.hasTowel())return;const i=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(i);const s=this._fileDirectories[0],r=s.ImageWidth.values[0],n=s.ImageLength.values[0];this._canvas.width=r,this._canvas.height=n;const o=[],a=s.Compression?s.Compression.values[0]:1,h=s.SamplesPerPixel.values[0],l=[];let u=0,d=!1;s.BitsPerSample.values.forEach(((t,e)=>{l[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(l[e].hasBytesPerSample=!0,l[e].bytesPerSample=t/8),u+=t}),this);let _=0;u%8==0&&(d=!0,_=u/8);const p=s.StripOffsets.values,m=p.length;let g;if(s.StripByteCounts)g=s.StripByteCounts.values;else{if(k(8003),1!==m)throw Error(q(6024));g=[Math.ceil(r*n*u/8)]}let f=1,y=1;for(let t=0;t<m;t++){const e=p[t];o[t]=[];const i=g[t];for(let s=0,r=0,n=1,c=!0,u=[],p=0,m=0,g=0;s<i;s+=n)switch(a){case 1:u=[];for(let t=0;t<h;t++){const i=l[t];if(!i.hasBytesPerSample){const t=this.getBits(i.bitsPerSample,e+s,r);throw u.push(t.bits),s=t.byteOffset-e,r=t.bitOffset,RangeError(q(6025))}{const r=i.bytesPerSample*t;u.push(this.getBytes(i.bytesPerSample,e+s+r))}}if(o[t].push(u),!d)throw n=0,RangeError(q(6026));n=_;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(c){c=!1;const t=this.getUint8(e+s);t>=0&&t<=127?f=t+1:t>=-127&&t<=-1?y=1-t:c=!0}else{const i=this.getUint8(e+s);for(let e=0;e<y;e++){const e=l[m];if(!e.hasBytesPerSample)throw RangeError(q(6025));g=g<<8*p|i,p++,p===e.bytesPerSample&&(u.push(g),g=p=0,m++),m===h&&(o[t].push(u),u=[],m=0)}f--,0===f&&(c=!0)}n=1}}const b=this._canvas.getContext("2d");if(!b)return;b.fillStyle="rgba(255, 255, 255, 0)";const v=s.RowsPerStrip?s.RowsPerStrip.values[0]:n,S=o.length,T=n%v,w=0===T?v:T;let x=v,C=0;const A=s.PhotometricInterpretation.values[0];let D=[],E=0;s.ExtraSamples&&(D=s.ExtraSamples.values,E=D.length);let I=[],M=0;s.ColorMap&&(I=s.ColorMap.values,M=2**l[0].bitsPerSample);for(let t=0;t<S;t++){t+1===S&&(x=w);const e=o[t].length,i=C*t;for(let s=0,n=0;s<x&&n<e;s++)for(let e=0;e<r;e++,n++){const r=o[t][n];let a=0,h=0,c=0,u=1;if(E>0)for(let t=0;t<E;t++)if(1===D[t]||2===D[t]){u=r[3+t]/256;break}switch(A){case 0:{let t=0;l[0].hasBytesPerSample&&(t=16**(2*l[0].bytesPerSample)),r.forEach(((e,i,s)=>{s[i]=t-e}))}case 1:a=h=c=this.clampColorSample(r[0],l[0].bitsPerSample);break;case 2:a=this.clampColorSample(r[0],l[0].bitsPerSample),h=this.clampColorSample(r[1],l[1].bitsPerSample),c=this.clampColorSample(r[2],l[2].bitsPerSample);break;case 3:{if(void 0===I)throw Error(q(6027));const t=r[0];a=this.clampColorSample(I[t],16),h=this.clampColorSample(I[M+t],16),c=this.clampColorSample(I[2*M+t],16);break}default:throw RangeError(q(6028,A))}b.fillStyle=`rgba(${a}, ${h}, ${c}, ${u})`,b.fillRect(e,i+s,1,1)}C=x}}},Gct=new Array(123);for(let t=0;t<123;++t)Gct[t]=64;for(let t=0;t<64;++t)Gct["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(t)]=t;var Wct={name:"Jacob__Codec__Base64",decode:function(t){var e,i,s,r,n,o,a=[],h=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<t.length;)e=Gct[t.charCodeAt(h++)]<<2|(r=Gct[t.charCodeAt(h++)])>>4,i=(15&r)<<4|(n=Gct[t.charCodeAt(h++)])>>2,s=(3&n)<<6|(o=Gct[t.charCodeAt(h++)]),a.push(String.fromCharCode(e)),64!==n&&a.push(String.fromCharCode(i)),64!==o&&a.push(String.fromCharCode(s));return a.join("")},decodeAsArray:function(t,e){var i,s,r,n=this.decode(t),o=[];for(i=0,r=n.length/e;i<r;i++)for(o[i]=0,s=e-1;s>=0;--s)o[i]+=n.charCodeAt(i*e+s)<<8*s;return o}},Xct=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(Xct.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};Xct.gunzip=function(t){return t.constructor===Array||t.constructor,new Xct(t).gunzip()[0][0]},Xct.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},Xct.LITERALS=288,Xct.NAMEMAX=256,Xct.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],Xct.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Xct.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],Xct.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Xct.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Xct.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Xct.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},Xct.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},Xct.prototype.byteAlign=function(){this.bb=1},Xct.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},Xct.prototype.readBits=function(t){for(var e=0,i=t;i--;)e=e<<1|this.readBit();return t&&(e=Xct.bitReverse[e]>>8-t),e},Xct.prototype.flushBuffer=function(){this.bIdx=0},Xct.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},Xct.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},Xct.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(t=this.IsPat())>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if((t=this.IsPat())>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},Xct.prototype.CreateTree=function(t,e,i){var s;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,s=0;s<17;s++)this.fpos[s]=0;return this.len=0,this.Rec()?-1:0},Xct.prototype.DecodeValue=function(t){for(var e,i,s=0,r=t[s];;)if(this.readBit()){if(!(32768&r.b1))return r.b1;for(r=r.jump,e=t.length,i=0;i<e;i++)if(t[i]===r){s=i;break}}else{if(!(32768&r.b0))return r.b0;r=t[++s]}return-1},Xct.prototype.DeflateLoop=function(){var t,e,i;do{var s,r;if(t=this.readBit(),0===(e=this.readBits(2)))for(this.byteAlign(),s=this.readByte(),s|=this.readByte()<<8,r=this.readByte(),65535&(s^~(r|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");s--;)n=this.readByte(),this.addBuffer(n);else if(1===e)for(;;)if((o=Xct.bitReverse[this.readBits(7)]>>1)>23?(o=o<<1|this.readBit())>199?o=(o-=128)<<1|this.readBit():(o-=48)>143&&(o+=136):o+=256,o<256)this.addBuffer(o);else{if(256===o)break;for(o-=257,p=this.readBits(Xct.cplext[o])+Xct.cplens[o],o=Xct.bitReverse[this.readBits(5)]>>3,Xct.cpdext[o]>8?(m=this.readBits(8),m|=this.readBits(Xct.cpdext[o]-8)<<8):m=this.readBits(Xct.cpdext[o]),m+=Xct.cpdist[o],o=0;o<p;o++){var n=this.buf32k[this.bIdx-m&32767];this.addBuffer(n)}}else if(2===e){var o,a,h,l,c,u=new Array(320);for(h=257+this.readBits(5),l=1+this.readBits(5),c=4+this.readBits(4),o=0;o<19;o++)u[o]=0;for(o=0;o<c;o++)u[Xct.border[o]]=this.readBits(3);for(p=this.distanceTree.length,i=0;i<p;i++)this.distanceTree[i]=new Xct.HufNode;if(this.CreateTree(this.distanceTree,19,u,0))return this.flushBuffer(),1;for(a=h+l,i=0;i<a;)if((o=this.DecodeValue(this.distanceTree))<16)u[i++]=o;else if(16===o){var d;if(i+(o=3+this.readBits(2))>a)return this.flushBuffer(),1;for(d=i?u[i-1]:0;o--;)u[i++]=d}else{if(i+(o=17===o?3+this.readBits(3):11+this.readBits(7))>a)return this.flushBuffer(),1;for(;o--;)u[i++]=0}for(p=this.literalTree.length,i=0;i<p;i++)this.literalTree[i]=new Xct.HufNode;if(this.CreateTree(this.literalTree,h,u,0))return this.flushBuffer(),1;for(p=this.literalTree.length,i=0;i<p;i++)this.distanceTree[i]=new Xct.HufNode;var _=new Array;for(i=h;i<u.length;i++)_[i-h]=u[i];if(this.CreateTree(this.distanceTree,l,_,0))return this.flushBuffer(),1;for(;;)if((o=this.DecodeValue(this.literalTree))>=256){var p,m;if(0==(o-=256))break;for(o--,p=this.readBits(Xct.cplext[o])+Xct.cplens[o],o=this.DecodeValue(this.distanceTree),Xct.cpdext[o]>8?(m=this.readBits(8),m|=this.readBits(Xct.cpdext[o]-8)<<8):m=this.readBits(Xct.cpdext[o]),m+=Xct.cpdist[o];p--;)n=this.buf32k[this.bIdx-m&32767],this.addBuffer(n)}else this.addBuffer(o)}}while(!t);return this.flushBuffer(),this.byteAlign(),0},Xct.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},Xct.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var i=this.readByte();i|=this.readByte()<<8;var s=this.readByte();for(s|=this.readByte()<<8,n=0,this.nameBuf=[];i--;){var r=this.readByte();"/"===r|":"===r?n=0:n<Xct.NAMEMAX-1&&(this.nameBuf[n++]=String.fromCharCode(r))}this.fileout||(this.fileout=this.nameBuf);for(var n=0;n<s;)r=this.readByte(),n++;8===e&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},Xct.prototype.skipdir=function(){var t,e,i=[];if(8&this.gpflags&&(i[0]=this.readByte(),i[1]=this.readByte(),i[2]=this.readByte(),i[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),i[0]=this.readByte(),8!==i[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(i[0]=this.readByte(),i[2]=this.readByte(),this.len=i[0]+256*i[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];e=this.readByte();)"7"!==e&&":"!==e||(t=0),t<Xct.NAMEMAX-1&&(this.nameBuf[t++]=e);if(16&this.gpflags)for(;e=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()};var Yct,qct,$ct,Kct,Zct,Qct,Jct,tut,eut,iut,sut,rut,nut,out,aut,hut,lut,cut,uut,dut,_ut,put,mut,gut,fut,yut,but,vut,Sut,Tut,wut,xut,Cut,Aut,Dut,Eut,Iut,Mut,Put,Out,Rut,But,Fut,Nut,Lut,kut,zut,Uut,Vut,jut,Hut,Gut,Wut={name:"Jacob__Codec"};function Xut(t){const e=t.parent,i=t.getComponent($ut);return e&&i?Xut(e):t.getComponentsInChildren($ut)}Wut.Base64=Wct,Wut.GZip=Xct,Wut.unzip=function(){return Wut.GZip.gunzip.apply(Wut.GZip,arguments)},Wut.unzipBase64=function(){var t=Wut.Base64.decode.apply(Wut.Base64,arguments);try{return Wut.GZip.gunzip.call(Wut.GZip,t)}catch(e){return t.slice(7)}},Wut.unzipBase64AsArray=function(t,e){e=e||1;var i,s,r,n=this.unzipBase64(t),o=[];for(i=0,r=n.length/e;i<r;i++)for(o[i]=0,s=e-1;s>=0;--s)o[i]+=n.charCodeAt(i*e+s)<<8*s;return o},Wut.unzipAsArray=function(t,e){e=e||1;var i,s,r,n=this.unzip(t),o=[];for(i=0,r=n.length/e;i<r;i++)for(o[i]=0,s=e-1;s>=0;--s)o[i]+=n.charCodeAt(i*e+s)<<8*s;return o};const Yut=parseInt,qut=parseFloat;let $ut=t("ParticleSystem2D",(Yct=ah("cc.ParticleSystem2D"),qct=Xh(Lct),$ct=Xh(yD),Kct=Xh(vct),Zct=Xh(bct),Qct=Sh("preview"),Yct((Gut=class t extends uM{get custom(){return this._custom}set custom(t){this._custom!==t&&(this._custom=t,this._applyFile(),this._updateMaterial())}get file(){return this._file}set file(t){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)}get spriteFrame(){return this._spriteFrame}set spriteFrame(t){this._renderSpriteFrame!==t&&(this._renderSpriteFrame=t,t&&!t._uuid||(this._spriteFrame=t),this._applySpriteFrame())}get particleCount(){return this._simulator.particles.length}get totalParticles(){return this._totalParticles}set totalParticles(t){this._totalParticles!==t&&(this._totalParticles=t)}get startColor(){return this._startColor}set startColor(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}get startColorVar(){return this._startColorVar}set startColorVar(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}set color(t){}get color(){return this._color}get endColor(){return this._endColor}set endColor(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}get endColorVar(){return this._endColorVar}set endColorVar(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}get positionType(){return this._positionType}set positionType(t){this._positionType=t,this._updateMaterial(),this._updatePositionType()}get preview(){return this._preview}set preview(t){t?this._startPreview():this._stopPreview(),this._preview=t}get stopped(){return this._stopped}get active(){return this._simulator.active}get assembler(){return this._assembler}constructor(){super(),this.duration=eut&&eut(),this.emissionRate=iut&&iut(),this.life=sut&&sut(),this.lifeVar=rut&&rut(),this.angle=nut&&nut(),this.angleVar=out&&out(),this.startSize=aut&&aut(),this.startSizeVar=hut&&hut(),this.endSize=lut&&lut(),this.endSizeVar=cut&&cut(),this.startSpin=uut&&uut(),this.startSpinVar=dut&&dut(),this.endSpin=_ut&&_ut(),this.endSpinVar=put&&put(),this.sourcePos=mut&&mut(),this.posVar=gut&&gut(),this.emitterMode=fut&&fut(),this.gravity=yut&&yut(),this.speed=but&&but(),this.speedVar=vut&&vut(),this.tangentialAccel=Sut&&Sut(),this.tangentialAccelVar=Tut&&Tut(),this.radialAccel=wut&&wut(),this.radialAccelVar=xut&&xut(),this.rotationIsDir=Cut&&Cut(),this.startRadius=Aut&&Aut(),this.startRadiusVar=Dut&&Dut(),this.endRadius=Eut&&Eut(),this.endRadiusVar=Iut&&Iut(),this.rotatePerS=Mut&&Mut(),this.rotatePerSVar=Put&&Put(),this.aspectRatio=1,this.playOnLoad=Out&&Out(),this.autoRemoveOnFinish=Rut&&Rut(),this._preview=But&&But(),this._custom=Fut&&Fut(),this._file=Nut&&Nut(),this._spriteFrame=Lut&&Lut(),this._totalParticles=kut&&kut(),this._startColor=zut&&zut(),this._startColorVar=Uut&&Uut(),this._endColor=Vut&&Vut(),this._endColorVar=jut&&jut(),this._positionType=Hut&&Hut(),this._stopped=!0,this._useFile=void 0,this.initProperties(),this._useFile=!1}onEnable(){super.onEnable(),this._updateMaterial(),this._updatePositionType()}onDestroy(){super.onDestroy(),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0,this.destroyRenderData()}initProperties(){this._previewTimer=null,this._focused=!1,this.aspectRatio=1,this._simulator=new Mct(this)}onFocusInEditor(){this._focused=!0;const t=Xut(this.node);for(let e=0;e<t.length;++e)t[e]._startPreview()}onLostFocusInEditor(){this._focused=!1;const t=Xut(this.node);for(let e=0;e<t.length;++e)t[e]._stopPreview()}_startPreview(){this._preview&&this.resetSystem()}_stopPreview(){this._preview&&(this.resetSystem(),this.stopSystem()),this._previewTimer&&clearInterval(this._previewTimer)}__preload(){super.__preload(),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()}destroyRenderData(){if(this._simulator.renderData){const t=this._assembler;t&&t.removeData&&t.removeData(this._simulator.renderData),this._simulator.renderData=null}super.destroyRenderData()}_flushAssembler(){const e=t.Assembler.getAssembler(this);if(this._assembler!==e&&(this._assembler=e),this._assembler&&this._assembler.createData){const t=this._simulator;let e=t.renderData;e||(e=t.renderData=this._assembler.createData(this),t.uvFilled=0,e.particleInitRenderDrawInfo(this.renderEntity),t.initDrawInfo())}}lateUpdate(t){this._simulator.finished||this._simulator.step(t)}addParticle(){}stopSystem(){this._stopped=!0,this._simulator.stop()}resetSystem(){this._stopped=!1,this._simulator.reset(),this._markForUpdateRenderData()}isFull(){return this.particleCount>=this.totalParticles}_applyFile(){const t=this._file;if(t){if(!t)return void G(6029);if(!this.isValid)return;this._plistFile=t.nativeUrl,this._custom||(this._spriteFrame!==t.spriteFrame&&(this.spriteFrame=t.spriteFrame),this._initWithDictionary(t._nativeAsset)),this._spriteFrame?!this._renderSpriteFrame&&this._spriteFrame&&this._applySpriteFrame():t.spriteFrame?this.spriteFrame=t.spriteFrame:this._custom&&this._initTextureWithDictionary(t._nativeAsset)}}_initTextureWithDictionary(t){if(t.spriteFrameUuid){const e=t.spriteFrameUuid;jx.loadAny(e,((e,i)=>{this.isValid&&(e?(t.spriteFrameUuid=void 0,this._initTextureWithDictionary(t),P(e)):this.spriteFrame=i)}))}else{const i=na(this._plistFile,t.textureFileName||"");if(t.textureFileName)jx.loadRemote(i,((e,i)=>{this.isValid&&(e?(t.textureFileName=void 0,this._initTextureWithDictionary(t),P(e)):this.spriteFrame=i?yD.createWithImage(i):yD.createWithImage(iC.get("white-texture")))}));else if(t.textureImageData){const s=t.textureImageData;if(!(s&&s.length>0))return!1;{let t=i;this.file&&(t+=`-${this.file.uuid}`);let r=jx.assets.get(t);if(!r){const i=Wut.unzipBase64AsArray(s,1);if(!i)return j(6030,this._file.name),!1;const n=(e=i).length>8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]?1:e.length>2&&(73===e[0]&&73===e[1]||77===e[0]&&77===e[1]||255===e[0]&&216===e[1])?2:10;if(2!==n&&1!==n)return j(6031,this._file.name),!1;const o=c.document.createElement("canvas");1===n?new Uct(i).render(o):(Hct.parseTIFF(i,o),Hct.reset()),r=new Sm(o),jx.assets.add(t,r)}r||j(6032,this._file.name),this.spriteFrame=r?yD.createWithImage(r):yD.createWithImage(iC.get("white-texture"))}}}var e;return!0}_initWithDictionary(t){this._useFile=!0,this.totalParticles=Yut(t.maxParticles||0),this.life=qut(t.particleLifespan||0),this.lifeVar=qut(t.particleLifespanVariance||0);const e=t.emissionRate;this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=qut(t.duration||0),this._srcBlendFactor=Yut(t.blendFuncSource||2),this._dstBlendFactor=Yut(t.blendFuncDestination||4);const i=this._startColor;i.r=255*qut(t.startColorRed||0),i.g=255*qut(t.startColorGreen||0),i.b=255*qut(t.startColorBlue||0),i.a=255*qut(t.startColorAlpha||0);const s=this._startColorVar;s.r=255*qut(t.startColorVarianceRed||0),s.g=255*qut(t.startColorVarianceGreen||0),s.b=255*qut(t.startColorVarianceBlue||0),s.a=255*qut(t.startColorVarianceAlpha||0);const r=this._endColor;r.r=255*qut(t.finishColorRed||0),r.g=255*qut(t.finishColorGreen||0),r.b=255*qut(t.finishColorBlue||0),r.a=255*qut(t.finishColorAlpha||0);const n=this._endColorVar;if(n.r=255*qut(t.finishColorVarianceRed||0),n.g=255*qut(t.finishColorVarianceGreen||0),n.b=255*qut(t.finishColorVarianceBlue||0),n.a=255*qut(t.finishColorVarianceAlpha||0),this.startSize=qut(t.startParticleSize||0),this.startSizeVar=qut(t.startParticleSizeVariance||0),this.endSize=qut(t.finishParticleSize||0),this.endSizeVar=qut(t.finishParticleSizeVariance||0),this.positionType=qut(void 0!==t.positionType?t.positionType:vct.FREE),this.sourcePos.set(0,0),this.posVar.set(qut(t.sourcePositionVariancex||0),qut(t.sourcePositionVariancey||0)),this.angle=qut(t.angle||0),this.angleVar=qut(t.angleVariance||0),this.startSpin=qut(t.rotationStart||0),this.startSpinVar=qut(t.rotationStartVariance||0),this.endSpin=qut(t.rotationEnd||0),this.endSpinVar=qut(t.rotationEndVariance||0),this.emitterMode=Yut(t.emitterType||bct.GRAVITY),this.emitterMode===bct.GRAVITY){this.gravity.set(qut(t.gravityx||0),qut(t.gravityy||0)),this.speed=qut(t.speed||0),this.speedVar=qut(t.speedVariance||0),this.radialAccel=qut(t.radialAcceleration||0),this.radialAccelVar=qut(t.radialAccelVariance||0),this.tangentialAccel=qut(t.tangentialAcceleration||0),this.tangentialAccelVar=qut(t.tangentialAccelVariance||0);let e=t.rotationIsDir||"";null!==e?(e=e.toString().toLowerCase(),this.rotationIsDir="true"===e||"1"===e):this.rotationIsDir=!1}else{if(this.emitterMode!==bct.RADIUS)return j(6009),!1;this.startRadius=qut(t.maxRadius||0),this.startRadiusVar=qut(t.maxRadiusVariance||0),this.endRadius=qut(t.minRadius||0),this.endRadiusVar=qut(t.minRadiusVariance||0),this.rotatePerS=qut(t.rotatePerSecond||0),this.rotatePerSVar=qut(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0}_syncAspect(){if(this._renderSpriteFrame){const t=this._renderSpriteFrame.rect;this.aspectRatio=t.width/t.height}}_applySpriteFrame(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.texture&&(this._simulator&&this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this._stopped=!1,this._markForUpdateRenderData()):this.resetSystem()}_getTexture(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture}_updateMaterial(){if(this._customMaterial){this.setSharedMaterial(this._customMaterial,0);const t=this.getRenderMaterial(0).passes[0].blendState.targets[0];this._dstBlendFactor=t.blendDst,this._srcBlendFactor=t.blendSrc}const t=this.getMaterialInstance(0);t&&t.recompileShaders({USE_LOCAL:this._positionType!==vct.FREE}),t&&t.passes.length>0&&this._updateBlendFunc()}_finishedSimulation(){this.resetSystem(),this.stopSystem(),this._markForUpdateRenderData(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()}_canRender(){return super._canRender()&&!this._stopped&&null!==this._renderSpriteFrame&&void 0!==this._renderSpriteFrame}_render(t){this._positionType===vct.RELATIVE?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node.parent):this.positionType===vct.GROUPED?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node):t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,null)}_updatePositionType(){this._positionType===vct.RELATIVE?(this._renderEntity.setRenderTransform(this.node.parent),this._renderEntity.setUseLocal(!0)):this.positionType===vct.GROUPED?(this._renderEntity.setRenderTransform(this.node),this._renderEntity.setUseLocal(!0)):(this._renderEntity.setRenderTransform(null),this._renderEntity.setUseLocal(!1))}},Gut.EmitterMode=bct,Gut.PositionType=vct,Gut.DURATION_INFINITY=-1,Gut.START_SIZE_EQUAL_TO_END_SIZE=-1,Gut.START_RADIUS_EQUAL_TO_END_RADIUS=-1,s((tut=Gut).prototype,"file",[qct],Object.getOwnPropertyDescriptor(tut.prototype,"file"),tut.prototype),s(tut.prototype,"spriteFrame",[$ct],Object.getOwnPropertyDescriptor(tut.prototype,"spriteFrame"),tut.prototype),eut=Za(tut.prototype,"duration",[vh],(function(){return-1})),iut=Za(tut.prototype,"emissionRate",[vh],(function(){return 10})),sut=Za(tut.prototype,"life",[vh],(function(){return 1})),rut=Za(tut.prototype,"lifeVar",[vh],(function(){return 0})),s(tut.prototype,"color",[Yh],Object.getOwnPropertyDescriptor(tut.prototype,"color"),tut.prototype),nut=Za(tut.prototype,"angle",[vh],(function(){return 90})),out=Za(tut.prototype,"angleVar",[vh],(function(){return 20})),aut=Za(tut.prototype,"startSize",[vh],(function(){return 50})),hut=Za(tut.prototype,"startSizeVar",[vh],(function(){return 0})),lut=Za(tut.prototype,"endSize",[vh],(function(){return 0})),cut=Za(tut.prototype,"endSizeVar",[vh],(function(){return 0})),uut=Za(tut.prototype,"startSpin",[vh],(function(){return 0})),dut=Za(tut.prototype,"startSpinVar",[vh],(function(){return 0})),_ut=Za(tut.prototype,"endSpin",[vh],(function(){return 0})),put=Za(tut.prototype,"endSpinVar",[vh],(function(){return 0})),mut=Za(tut.prototype,"sourcePos",[vh],(function(){return kr.ZERO.clone()})),gut=Za(tut.prototype,"posVar",[vh],(function(){return kr.ZERO.clone()})),s(tut.prototype,"positionType",[Kct],Object.getOwnPropertyDescriptor(tut.prototype,"positionType"),tut.prototype),fut=Za(tut.prototype,"emitterMode",[vh,Zct],(function(){return bct.GRAVITY})),yut=Za(tut.prototype,"gravity",[vh],(function(){return kr.ZERO.clone()})),but=Za(tut.prototype,"speed",[vh],(function(){return 180})),vut=Za(tut.prototype,"speedVar",[vh],(function(){return 50})),Sut=Za(tut.prototype,"tangentialAccel",[vh],(function(){return 80})),Tut=Za(tut.prototype,"tangentialAccelVar",[vh],(function(){return 0})),wut=Za(tut.prototype,"radialAccel",[vh],(function(){return 0})),xut=Za(tut.prototype,"radialAccelVar",[vh],(function(){return 0})),Cut=Za(tut.prototype,"rotationIsDir",[vh],(function(){return!1})),Aut=Za(tut.prototype,"startRadius",[vh],(function(){return 0})),Dut=Za(tut.prototype,"startRadiusVar",[vh],(function(){return 0})),Eut=Za(tut.prototype,"endRadius",[vh],(function(){return 0})),Iut=Za(tut.prototype,"endRadiusVar",[vh],(function(){return 0})),Mut=Za(tut.prototype,"rotatePerS",[vh],(function(){return 0})),Put=Za(tut.prototype,"rotatePerSVar",[vh],(function(){return 0})),Out=Za(tut.prototype,"playOnLoad",[vh],(function(){return!0})),Rut=Za(tut.prototype,"autoRemoveOnFinish",[vh],(function(){return!1})),But=Za(tut.prototype,"_preview",[Qct],(function(){return!0})),Fut=Za(tut.prototype,"_custom",[vh],(function(){return!1})),Nut=Za(tut.prototype,"_file",[vh],(function(){return null})),Lut=Za(tut.prototype,"_spriteFrame",[vh],(function(){return null})),kut=Za(tut.prototype,"_totalParticles",[vh],(function(){return 150})),zut=Za(tut.prototype,"_startColor",[vh],(function(){return new Ls(255,255,255,255)})),Uut=Za(tut.prototype,"_startColorVar",[vh],(function(){return new Ls(0,0,0,0)})),Vut=Za(tut.prototype,"_endColor",[vh],(function(){return new Ls(255,255,255,0)})),jut=Za(tut.prototype,"_endColorVar",[vh],(function(){return new Ls(0,0,0,0)})),Hut=Za(tut.prototype,"_positionType",[vh],(function(){return vct.FREE})),Jct=tut))||Jct));var Kut,Zut,Qut,Jut,tdt,edt,idt,sdt,rdt,ndt,odt;class adt{constructor(t,e){this.point=new kr,this.dir=new kr,this.distance=0,this.time=0,t&&this.point.set(t),e&&this.dir.set(e)}setPoint(t,e){this.point.x=t,this.point.y=e}setDir(t,e){this.dir.x=t,this.dir.y=e}}let hdt=t("MotionStreak",(Kut=ah("cc.MotionStreak"),Zut=Xh(ff),Kut((odt=class t extends uM{constructor(){super(),this._preview=tdt&&tdt(),this._fadeTime=edt&&edt(),this._minSeg=idt&&idt(),this._stroke=sdt&&sdt(),this._texture=rdt&&rdt(),this._fastMode=ndt&&ndt(),this._points=[],this.setFillColorType(1)}get preview(){return this._preview}set preview(t){this._preview=t,this.reset()}get fadeTime(){return this._fadeTime}set fadeTime(t){this._fadeTime=t,this.reset()}get minSeg(){return this._minSeg}set minSeg(t){this._minSeg=t}get stroke(){return this._stroke}set stroke(t){this._stroke=t}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t)}get fastMode(){return this._fastMode}set fastMode(t){this._fastMode=t}get points(){return this._points}onEnable(){super.onEnable(),this.reset()}_flushAssembler(){const e=t.Assembler.getAssembler(this);this._assembler!==e&&(this._assembler=e),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material,this._renderData.renderDrawInfo.setVertexPositionInWorld(!0),this._updateColor())}onFocusInEditor(){this._preview&&this.reset()}onLostFocusInEditor(){this._preview&&this.reset()}reset(){this._points.length=0,this._renderData&&this._renderData.clear()}lateUpdate(t){this._assembler&&this._assembler.update&&this._assembler.update(this,t)}_render(t){t.commitComp(this,this._renderData,this._texture,this._assembler,null)}},odt.Point=adt,s((Jut=odt).prototype,"texture",[Zut],Object.getOwnPropertyDescriptor(Jut.prototype,"texture"),Jut.prototype),tdt=Za(Jut.prototype,"_preview",[vh],(function(){return!1})),edt=Za(Jut.prototype,"_fadeTime",[vh],(function(){return 1})),idt=Za(Jut.prototype,"_minSeg",[vh],(function(){return 1})),sdt=Za(Jut.prototype,"_stroke",[vh],(function(){return 64})),rdt=Za(Jut.prototype,"_texture",[vh],(function(){return null})),ndt=Za(Jut.prototype,"_fastMode",[vh],(function(){return!1})),Qut=Jut))||Qut));const ldt=new kr,cdt=new kr;let udt=null;function ddt(t,e){return t.x=-e.y,t.y=e.x,t}const _dt=new class{createData(t){const e=t.requestRenderData();return e.dataLength=4,e.resize(16,42),e}update(t,e){const i=t.stroke/2,s=t.node,r=s.worldMatrix,n=r.m12,o=r.m13,a=t.points;let h;if(a.length>1){const e=a[0],i=e.point.x-n,s=e.point.y-o;i*i+s*s<t.minSeg&&(h=e)}h||(h=new adt,a.unshift(h)),h.setPoint(n,o),h.time=t.fadeTime+e;let l=0,c=0;const u=t.renderData;if(a.length<2||!u)return;this.updateRenderDataCache(t,u);const d=t.color,_=d.r,p=d.g,m=d.b,g=s._uiProps.opacity*d.a,f=a[1];f.distance=kr.subtract(cdt,h.point,f.point).length(),cdt.normalize(),f.setDir(cdt.x,cdt.y),h.setDir(cdt.x,cdt.y),u.dataLength=2*a.length;const y=u.data,b=t.fadeTime;let v=!1;for(let t=a.length-1;t>=0;t--){const s=a[t],r=s.point,n=s.dir;if(s.time-=e,s.time<0){a.splice(t,1);continue}const o=s.time/b,h=a[t-1];if(!v){if(!h){a.splice(t,1);continue}r.x=h.point.x-n.x*o,r.y=h.point.y-n.y*o}v=!0,ddt(ldt,n);const c=o*g;let u=l;y[u].x=r.x+ldt.x*i,y[u].y=r.y+ldt.y*i,y[u].u=1,y[u].v=o,y[u].color.set(_,p,m,c),u+=1,y[u].x=r.x-ldt.x*i,y[u].y=r.y-ldt.y*i,y[u].u=0,y[u].v=o,y[u].color.set(_,p,m,c),l+=2}c=l<=2?0:3*(l-2),u.resize(l,c);{const e=u.indexCount;this.createQuadIndices(t,e),u.chunk.setIndexBuffer(udt),this.updateWorldVertexAllData(t),u.updateRenderData(t,t.texture),t._markForUpdateRenderData()}}updateWorldVertexAllData(t){const e=t.renderData;if(!e)return;const i=e.floatStride,s=e.data,r=e.chunk.vb,n=e.vertexCount;for(let t=0;t<n;t++){const e=t*i;r[e+0]=s[t].x,r[e+1]=s[t].y,r[e+2]=s[t].z,r[e+3]=s[t].u,r[e+4]=s[t].v,Ls.toArray(r,s[t].color,e+5)}}createQuadIndices(t,e){const i=t.renderData;if(!i)return;let s=i.chunk.meshBuffer.indexOffset;udt=null,udt=new Uint16Array(e);for(let t=0,i=e;t<i;t+=2){const e=0+t;udt[s++]=e,udt[s++]=e+2,udt[s++]=e+1,udt[s++]=e+1,udt[s++]=e+2,udt[s++]=e+3}}updateRenderDataCache(t,e){e.passDirty&&e.updatePass(t),e.nodeDirty&&e.updateNode(t),e.textureDirty&&t.texture&&(e.updateTexture(t.texture),e.material=t.getRenderMaterial(0)),e.hashDirty&&e.updateHash()}fillBuffers(t,e){const i=t.renderData;if(!i)return;const s=i.chunk,r=i.data,n=i.vertexCount,o=i.indexCount,a=s.vb;let h=0;for(let t=0;t<n;t++){const e=r[t];a[h++]=e.x,a[h++]=e.y,a[h++]=e.z,a[h++]=e.u,a[h++]=e.v,Ls.toArray(a,e.color,h),h+=4}s.bufferId;const l=s.vertexOffset,c=s.meshBuffer,u=s.meshBuffer.iData;let d=c.indexOffset;for(let t=0,e=o;t<e;t+=2){const e=l+t;u[d++]=e,u[d++]=e+2,u[d++]=e+1,u[d++]=e+1,u[d++]=e+2,u[d++]=e+3}c.indexOffset+=i.indexCount,c.setDirty()}},pdt=t("MotionStreakAssemblerManager",{getAssembler:()=>_dt});hdt.Assembler=pdt;const mdt=new class{constructor(){this.maxParticleDeltaTime=0}createData(t){return bI.add()}removeData(t){bI.remove(t)}},gdt=t("ParticleSystem2DAssembler",{getAssembler:()=>(mdt.maxParticleDeltaTime||(mdt.maxParticleDeltaTime=a.game.frameTime/1e3*2),mdt)});$ut.Assembler=gdt;const fdt=t("selector",{id:"",switchTo:function(t){const e=fdt;fdt.physicsWorld&&t!==fdt.id&&null!=fdt.backend[t]?(I(`[PHYSICS2D]: switch from ${fdt.id} to ${t}.`),e.id=t,e.wrapper=fdt.backend[t],e.physicsWorld=bdt()):(I(`[PHYSICS2D]: using ${e.id}.`),e.physicsWorld=bdt())},register:function(t,e){if(I(`[PHYSICS2D]: register ${t}.`),fdt.backend[t]=e,!fdt.physicsWorld||fdt.id===t){const i=fdt;i.id=t,i.wrapper=e}},wrapper:{},backend:{},physicsWorld:null,runInEditor:!0}),ydt=()=>0;function bdt(){return new fdt.wrapper.PhysicsWorld}const vdt={impl:null,rigidBody:null,isAwake:!1,isSleeping:!1,initialize:ydt,setType:ydt,setLinearDamping:ydt,setAngularDamping:ydt,setGravityScale:ydt,setFixedRotation:ydt,setAllowSleep:ydt,isActive:ydt,setActive:ydt,wakeUp:ydt,sleep:ydt,getMass:ydt,getInertia:ydt,getLinearVelocity:ydt,setLinearVelocity:ydt,getLinearVelocityFromWorldPoint:ydt,getAngularVelocity:ydt,setAngularVelocity:ydt,getLocalVector:ydt,getWorldVector:ydt,getLocalPoint:ydt,getWorldPoint:ydt,getLocalCenter:ydt,getWorldCenter:ydt,applyForce:ydt,applyForceToCenter:ydt,applyTorque:ydt,applyLinearImpulse:ydt,applyLinearImpulseToCenter:ydt,applyAngularImpulse:ydt,onEnable:ydt,onDisable:ydt,onDestroy:ydt},Sdt={INITED:!1};function Tdt(t){return Sdt.INITED||(Sdt.INITED=!0,Sdt[1]=function(){return new fdt.wrapper.BoxShape},Sdt[2]=function(){return new fdt.wrapper.CircleShape},Sdt[3]=function(){return new fdt.wrapper.PolygonShape}),Sdt[t]()}const wdt={INITED:!1},xdt={impl:null,initialize:ydt,apply:ydt,setDampingRatio:ydt,setFrequency:ydt,setMaxForce:ydt,setTarget:ydt,setDistance:ydt,setAngularOffset:ydt,setCorrectionFactor:ydt,setLinearOffset:ydt,setMaxLength:ydt,setMaxTorque:ydt,setLowerLimit:ydt,setUpperLimit:ydt,setMaxMotorForce:ydt,setMaxMotorTorque:ydt,setMotorSpeed:ydt,enableLimit:ydt,enableMotor:ydt,setLowerAngle:ydt,setUpperAngle:ydt};function Cdt(t){return Adt(),wdt[t]()}function Adt(){if(wdt.INITED)return;wdt.INITED=!0;const t="builtin"===fdt.id;wdt[2]=function(){return t?xdt:new fdt.wrapper.SpringJoint},wdt[1]=function(){return t?xdt:new fdt.wrapper.DistanceJoint},wdt[5]=function(){return t?xdt:new fdt.wrapper.FixedJoint},wdt[4]=function(){return t?xdt:new fdt.wrapper.MouseJoint},wdt[7]=function(){return t?xdt:new fdt.wrapper.RelativeJoint},wdt[6]=function(){return t?xdt:new fdt.wrapper.SliderJoint},wdt[3]=function(){return t?xdt:new fdt.wrapper.WheelJoint},wdt[8]=function(){return t?xdt:new fdt.wrapper.HingeJoint}}function Ddt(t,e){const i=e.length;return e[t<0?i- -t%i:t%i]}function Edt(t,e,i){const s=[];for(;e<t;)e+=i.length;for(;t<=e;++t)s.push(Ddt(t,i));return s}function Idt(t,e,i){if(Mdt(t,i)){if(Rdt(Ddt(t,i),Ddt(t-1,i),Ddt(e,i))&&Bdt(Ddt(t,i),Ddt(t+1,i),Ddt(e,i)))return!1}else if(Bdt(Ddt(t,i),Ddt(t+1,i),Ddt(e,i))||Rdt(Ddt(t,i),Ddt(t-1,i),Ddt(e,i)))return!1;if(Mdt(e,i)){if(Rdt(Ddt(e,i),Ddt(e-1,i),Ddt(t,i))&&Bdt(Ddt(e,i),Ddt(e+1,i),Ddt(t,i)))return!1}else if(Bdt(Ddt(e,i),Ddt(e+1,i),Ddt(t,i))||Rdt(Ddt(e,i),Ddt(e-1,i),Ddt(t,i)))return!1;for(let s=0;s<i.length;++s){if((s+1)%i.length==t||s==t||(s+1)%i.length==e||s==e)continue;const r=new kr;if(Udt(Ddt(t,i),Ddt(e,i),Ddt(s,i),Ddt(s+1,i),r))return!1}return!0}function Mdt(t,e){return Pdt(t,e)}function Pdt(t,e,i){if(void 0===i){const s=t,r=e;t=Ddt(s-1,r),e=Ddt(s,r),void 0===t&&(t=e),void 0===(i=Ddt(s+1,r))&&(i=e)}return Vdt(t,e,i)<0}function Odt(t,e,i){return Vdt(t,e,i)>0}function Rdt(t,e,i){return Vdt(t,e,i)>=0}function Bdt(t,e,i){return Vdt(t,e,i)<=0}function Fdt(t,e){const i=e.x-t.x,s=e.y-t.y;return i*i+s*s}function Ndt(t){Ldt(t)||t.reverse()}function Ldt(t){return t.length<3||kdt(t)>0}function kdt(t){let e,i=0;for(e=0;e<t.length;e++){const s=(e+1)%t.length;i+=t[e].x*t[s].y,i-=t[e].y*t[s].x}return i/=2,i}function zdt(t,e,i,s){const r=new kr,n=e.y-t.y,o=t.x-e.x,a=n*t.x+o*t.y,h=s.y-i.y,l=i.x-s.x,c=h*i.x+l*i.y,u=n*l-h*o;var d;return d=u,Math.abs(d-0)<=1e-6||(r.x=(l*a-o*c)/u,r.y=(n*c-h*a)/u),r}function Udt(t,e,i,s,r){if(t==i||t==s||e==i||e==s)return!1;const n=t.x,o=t.y,a=e.x,h=e.y,l=i.x,c=i.y,u=s.x,d=s.y;if(Math.max(n,a)<Math.min(l,u)||Math.max(l,u)<Math.min(n,a))return!1;if(Math.max(o,h)<Math.min(c,d)||Math.max(c,d)<Math.min(o,h))return!1;let _=(u-l)*(o-c)-(d-c)*(n-l),p=(a-n)*(o-c)-(h-o)*(n-l);const m=(d-c)*(a-n)-(u-l)*(h-o);return!(Math.abs(m)<1e-6)&&(_/=m,p/=m,_>0&&_<1&&p>0&&p<1&&(r.x=n+_*(a-n),r.y=o+_*(h-o),!0))}function Vdt(t,e,i){return t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y)}var jdt=Object.freeze({__proto__:null,ConvexPartition:function t(e){Ndt(e);let i,s,r,n=[],o=0,a=0,h=0,l=new kr,c=new kr,u=0,d=0;for(let _=0;_<e.length;++_)if(Mdt(_,e)){a=h=1e8;for(let t=0;t<e.length;++t)Odt(Ddt(_-1,e),Ddt(_,e),Ddt(t,e))&&Bdt(Ddt(_-1,e),Ddt(_,e),Ddt(t-1,e))&&(i=zdt(Ddt(_-1,e),Ddt(_,e),Ddt(t,e),Ddt(t-1,e)),Pdt(Ddt(_+1,e),Ddt(_,e),i)&&(o=Fdt(Ddt(_,e),i),o<a&&(a=o,l=i,u=t))),Odt(Ddt(_+1,e),Ddt(_,e),Ddt(t+1,e))&&Bdt(Ddt(_+1,e),Ddt(_,e),Ddt(t,e))&&(i=zdt(Ddt(_+1,e),Ddt(_,e),Ddt(t,e),Ddt(t+1,e)),Odt(Ddt(_-1,e),Ddt(_,e),i)&&(o=Fdt(Ddt(_,e),i),o<h&&(h=o,d=t,c=i)));if(u==(d+1)%e.length){const t=l.add(c).multiplyScalar(.5);s=Edt(_,d,e),s.push(t),r=Edt(u,_,e),r.push(t)}else{let t=0,i=u;for(;d<u;)d+=e.length;for(let s=u;s<=d;++s)if(Idt(_,s,e)){let r=1/(Fdt(Ddt(_,e),Ddt(s,e))+1);Mdt(s,e)?Bdt(Ddt(s-1,e),Ddt(s,e),Ddt(_,e))&&Rdt(Ddt(s+1,e),Ddt(s,e),Ddt(_,e))?r+=3:r+=2:r+=1,r>t&&(i=s,t=r)}s=Edt(_,i,e),r=Edt(i,_,e)}return n=n.concat(t(s)),n=n.concat(t(r)),n}n.push(e);for(let t=n.length-1;t>=0;t--)0==n[t].length&&n.splice(t,0);return n},ForceCounterClockWise:Ndt,IsCounterClockWise:Ldt});class Hdt{constructor(){this.isActive=!1,this.isConvex=!1,this.isEar=!1,this.point=null,this.angleCos=0,this.shouldUpdate=!1,this.index=0,this.prev=null,this.next=null}}function Gdt(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Wdt(t,e,i){return Gdt(t,e,i)<0}function Xdt(t,e){return t.x===e.x&&t.y===e.y}function Ydt(t){let e=0;for(let i=0,s=t.length;i<s;++i){const r=t[i],n=t[(i+1)%s];e+=(n.x-r.x)*(n.y+r.y)}return e>0}function qdt(t){Ydt(t)&&t.reverse()}function $dt(t,e){if(!t.shouldUpdate)return;t.shouldUpdate=!1;const i=t.prev.point,s=t.point,r=t.next.point;t.isConvex=Wdt(i,s,r);let n=i.x-s.x,o=i.y-s.y;const a=Math.sqrt(n*n+o*o);n/=a,o/=a;let h=r.x-s.x,l=r.y-s.y;const c=Math.sqrt(h*h+l*l);if(h/=c,l/=c,t.angleCos=n*h+o*l,t.isConvex){t.isEar=!0;for(let n=0,o=e.length;n<o;++n){const o=e[n];if(!o.isActive||o===t)continue;const a=o.point;if(Xdt(i,a)||Xdt(s,a)||Xdt(r,a))continue;const h=Gdt(i,a,s),l=Gdt(s,a,r),c=Gdt(r,a,i);if(h>0&&l>0&&c>0){t.isEar=!1;break}if(0===h&&l>=0&&c>=0&&(Gdt(i,o.prev.point,s)>0||Gdt(i,o.next.point,s)>0)){t.isEar=!1;break}if(0===l&&h>=0&&c>=0&&(Gdt(s,o.prev.point,r)>0||Gdt(s,o.next.point,r)>0)){t.isEar=!1;break}if(0===c&&h>=0&&l>=0&&(Gdt(r,o.prev.point,i)>0||Gdt(r,o.next.point,i)>0)){t.isEar=!1;break}}}else t.isEar=!1}function Kdt(t){for(let e=t,i=t;;)if(Xdt(e.point,e.next.point)||0===Gdt(e.prev.point,e.point,e.next.point)){if(e.prev.next=e.next,e.next.prev=e.prev,e.prev.shouldUpdate=!0,e.next.shouldUpdate=!0,e===e.next)break;i=e.prev,e=e.next}else if(e=e.next,e===i)break}function Zdt(t){if(qdt(t),t.length<4)return[t];const e=t.length,i=[],s=[];for(let s=0;s<e;++s){const e=new Hdt;e.isActive=!0,e.isConvex=!1,e.isEar=!1,e.point=t[s],e.angleCos=0,e.shouldUpdate=!0,e.index=s,i.push(e)}for(let t=0;t<e;++t){const s=i[t];s.prev=i[(t+e-1)%e],s.next=i[(t+1)%e]}i.forEach((t=>$dt(t,i)));for(let t=0;t<e-3;++t){let r;for(let t=0;t<e;++t){const e=i[t];e.isActive&&e.isEar&&(r?e.angleCos>r.angleCos&&(r=e):r=e)}if(!r){for(let t=0;t<e;++t){const e=i[t];if(e.isActive){const t=e.prev.point,i=e.point,s=e.next.point;if(Math.abs(Gdt(t,i,s))>1e-5)return k(9644),null}}break}if(s.push([r.prev.point,r.point,r.next.point]),r.isActive=!1,r.prev.next=r.next,r.next.prev=r.prev,r.prev.shouldUpdate=!0,r.next.shouldUpdate=!0,Kdt(r.next),t===e-4)break;for(let t=0;t<e;++t)$dt(i[t],i)}for(let t=0;t<e;++t){const e=i[t];if(e.isActive){e.prev.isActive=!1,e.next.isActive=!1;const t=e.prev.point,i=e.point,r=e.next.point;Math.abs(Gdt(t,i,r))>1e-5&&s.push([t,i,r])}}return s}var Qdt=Object.freeze({__proto__:null,ConvexPartition:function(t){qdt(t);let e=!0;for(let i=0,s=t.length;i<s;++i)if(!Wdt(t[(i+s-1)%s],t[i],t[(i+1)%s])){e=!1;break}if(e)return[t];const i=[],s=Zdt(t);if(!s)return null;for(;s.length;){let t=s.splice(0,1)[0];for(let e=0,i=t.length;e<i;++e){const r=t[e],n=t[(e+1)%i];let o=null,a=0;for(;a<s.length;++a){const t=s[a];for(let e=0;e<3;++e){const i=t[e];if(Xdt(r,t[(e+1)%3])&&Xdt(n,i)){o=t[(e+2)%3];break}}if(o)break}if(!o)continue;if(Gdt(t[(e+i-1)%i],r,o)>0)continue;if(Gdt(o,n,t[(e+2)%i])>0)continue;const h=[];for(let s=(e+1)%i;s!==e;s=(s+1)%i)h.push(t[s]);h.push(r,o),t=h,i=h.length,e=-1,s.splice(a,1)}i.push(t)}return i}});const Jdt=t("ERigidBody2DType",{Static:0,Kinematic:1,Dynamic:2,Animated:3});pe(Jdt),pe(t("ECollider2DType",{None:0,BOX:1,CIRCLE:2,POLYGON:3})),pe(t("EJoint2DType",{None:0,DISTANCE:1,SPRING:2,WHEEL:3,MOUSE:4,FIXED:5,SLIDER:6,RELATIVE:7,HINGE:8}));const t_t=t("PhysicsGroup2D",{DEFAULT:1});pe(t_t),t("PhysicsGroup",t_t),t("ERaycast2DType",{Closest:0,Any:1,AllClosest:2,All:3});const e_t=t("Contact2DType",{None:"none-contact",BEGIN_CONTACT:"begin-contact",END_CONTACT:"end-contact",PRE_SOLVE:"pre-solve",POST_SOLVE:"post-solve"}),i_t=(t("EPhysics2DDrawFlags",{None:0,Shape:1,Joint:2,Aabb:4,Pair:8,CenterOfMass:16,Particle:32,Controller:64,All:63}),t("PHYSICS_2D_PTM_RATIO",32));class s_t{constructor(t){if(1===t){const t=this;for(let e=0;e<32;e++){const i="_"+(1<<e);t[i]=0,t.updateArray=[],Object.defineProperty(t,1<<e,{get(){return this[i]},set(t){this[i]!==t&&(this[i]=t,this.updateArray.indexOf(e)<0&&this.updateArray.push(e))}})}this._1=1}else{for(let t=0;t<32;t++)this[""+(1<<t)]=0;this[1]=1}}}let r_t=null;a.internal.PhysicsGroup2D=t_t;class n_t extends(ko(Bu)){get enable(){return this._enable}set enable(t){this._enable=t}get allowSleep(){return this._allowSleep}set allowSleep(t){this._allowSleep=t,this.physicsWorld.setAllowSleep(t)}get gravity(){return this._gravity}set gravity(t){this._gravity.set(t),this.physicsWorld.setGravity(new kr(t.x/i_t,t.y/i_t))}get maxSubSteps(){return this._maxSubSteps}set maxSubSteps(t){this._maxSubSteps=t}get fixedTimeStep(){return this._fixedTimeStep}set fixedTimeStep(t){this._fixedTimeStep=t}get autoSimulation(){return this._autoSimulation}set autoSimulation(t){this._autoSimulation=t}get debugDrawFlags(){return this.physicsWorld.debugDrawFlags}set debugDrawFlags(t){this.physicsWorld.debugDrawFlags=t}get physicsWorld(){return fdt.physicsWorld}static get PHYSICS_NONE(){return!fdt.id}static get PHYSICS_BUILTIN(){return"builtin"===fdt.id}static get PHYSICS_BOX2D(){return"box2d"===fdt.id}static get PHYSICS_BOX2D_WASM(){return"box2d-wasm"===fdt.id}static get PhysicsGroup(){return t_t}static get instance(){return r_t||(r_t=new n_t),r_t}get stepping(){return this._steping}constructor(){var t,e,i,s;super(),this.velocityIterations=10,this.positionIterations=10,this.collisionMatrix=new s_t,this._enable=!0,this._allowSleep=!0,this._maxSubSteps=1,this._fixedTimeStep=1/60,this._autoSimulation=!0,this._accumulator=0,this._steping=!1,this._gravity=new kr(0,-10*i_t),this._delayEvents=[];const r=Se.querySettings("physics","gravity");r&&(kr.copy(this._gravity,r),this._gravity.multiplyScalar(i_t)),this._allowSleep=null!==(t=Se.querySettings("physics","allowSleep"))&&void 0!==t?t:this._allowSleep,this._fixedTimeStep=null!==(e=Se.querySettings("physics","fixedTimeStep"))&&void 0!==e?e:this._fixedTimeStep,this._maxSubSteps=null!==(i=Se.querySettings("physics","maxSubSteps"))&&void 0!==i?i:this._maxSubSteps,this._autoSimulation=null!==(s=Se.querySettings("physics","autoSimulation"))&&void 0!==s?s:this._autoSimulation;const n=Se.querySettings("physics","collisionMatrix");if(n)for(const t in n){const e=parseInt(t),i=1<<parseInt(t);this.collisionMatrix[`${i}`]=n[e]}const o=Se.querySettings("physics","collisionGroups");o&&o instanceof Array&&(o.forEach((t=>{t_t[t.name]=1<<t.index})),pe.update(t_t)),fdt.physicsWorld=bdt(),this.gravity=this._gravity,this.allowSleep=this._allowSleep}postUpdate(t){if(!this._enable)return;if(!this._autoSimulation)return;nC.emit("director_before_physics"),this.physicsWorld.syncSceneToPhysics(),this._steping=!0;const e=this._fixedTimeStep,i=this.velocityIterations,s=this.positionIterations;this._accumulator+=t;let r=0;for(;r++<this._maxSubSteps&&this._accumulator>e;)this.physicsWorld.step(e,i,s),this._accumulator-=e;const n=this._delayEvents;for(let t=0,e=n.length;t<e;t++){const e=n[t];e.func.call(e.target)}n.length=0,this.physicsWorld.syncPhysicsToScene(),this.debugDrawFlags&&this.physicsWorld.drawDebug(),this._steping=!1,nC.emit("director_after_physics")}_callAfterStep(t,e){this._steping?this._delayEvents.push({target:t,func:e}):e.call(t)}resetAccumulator(t=0){this._accumulator=t}step(t){this.physicsWorld.step(t,this.velocityIterations,this.positionIterations)}raycast(t,e,i=0,s=4294967295){return this.physicsWorld.raycast(t,e,i,s)}testPoint(t){return this.physicsWorld.testPoint(t)}testAABB(t){return this.physicsWorld.testAABB(t)}static constructAndRegister(){nC.registerSystem(n_t.ID,n_t.instance,0)}}t("PhysicsSystem2D",n_t),n_t.ID="PHYSICS_2D",nC.once("director_init",(()=>{n_t.constructAndRegister()})),t("Physics2DManifoldType",{Circles:0,FaceA:1,FaceB:2});const o_t=t("ERigidBodyType",{DYNAMIC:1,STATIC:2,KINEMATIC:4});pe(o_t);const a_t=t("EAxisDirection",{X_AXIS:0,Y_AXIS:1,Z_AXIS:2});pe(a_t);const h_t={X:0,Y:1,Z:2,SWING1:3,SWING2:4,TWIST:5};pe(h_t);const l_t={VERTEX:1,LINE:2,TRIANGLE:3,TETRAHEDRON:4};pe(l_t);const c_t=t("EColliderType",{BOX:0,SPHERE:1,CAPSULE:2,CYLINDER:3,CONE:4,MESH:5,PLANE:6,SIMPLEX:7,TERRAIN:8});pe(c_t);const u_t={POINT_TO_POINT:0,HINGE:1,FIXED:2,CONFIGURABLE:3};pe(u_t);const d_t={FREE:0,LIMITED:1,LOCKED:2};pe(d_t);const __t={DISABLED:0,SERVO:1,INDUCTION:2};pe(__t);const p_t={BOX:0,CAPSULE:1};pe(p_t);const m_t={DEFAULT:1};pe(m_t);const g_t=t("EPhysicsDrawFlags",{NONE:0,WIRE_FRAME:1,CONSTRAINT:2,AABB:4});var f_t,y_t,b_t,v_t,S_t,T_t,w_t,x_t,C_t,A_t,D_t,E_t,I_t,M_t,P_t,O_t,R_t,B_t,F_t,N_t,L_t,k_t,z_t,U_t;pe(g_t);const{type:V_t,menu:j_t,ccclass:H_t}=il;let G_t=t("RigidBody2D",(f_t=H_t("cc.RigidBody2D"),y_t=V_t(m_t),b_t=V_t(Jdt),v_t=V_t(Xe),S_t=V_t(We),T_t=V_t(We),w_t=V_t(We),x_t=V_t(kr),C_t=V_t(We),A_t=V_t(Xe),f_t((s((E_t=class extends Km{constructor(...t){super(...t),this.enabledContactListener=I_t&&I_t(),this.bullet=M_t&&M_t(),this.awakeOnLoad=P_t&&P_t(),this._body=null,this._group=O_t&&O_t(),this._type=R_t&&R_t(),this._allowSleep=B_t&&B_t(),this._gravityScale=F_t&&F_t(),this._linearDamping=N_t&&N_t(),this._angularDamping=L_t&&L_t(),this._linearVelocity=k_t&&k_t(),this._angularVelocity=z_t&&z_t(),this._fixedRotation=U_t&&U_t()}get group(){return this._group}set group(t){this._group=t}get type(){return this._type}set type(t){this._type=t,this._body&&(3===t?this._body.setType(1):this._body.setType(t))}get allowSleep(){return this._allowSleep}set allowSleep(t){this._allowSleep=t,this._body&&this._body.setAllowSleep(t)}get gravityScale(){return this._gravityScale}set gravityScale(t){this._gravityScale=t,this._body&&this._body.setGravityScale(t)}get linearDamping(){return this._linearDamping}set linearDamping(t){this._linearDamping=t,this._body&&this._body.setLinearDamping(t)}get angularDamping(){return this._angularDamping}set angularDamping(t){this._angularDamping=t,this._body&&this._body.setAngularDamping(t)}get linearVelocity(){return this._body&&this._body.getLinearVelocity(this._linearVelocity),this._linearVelocity}set linearVelocity(t){this._linearVelocity=t,this._body&&this._body.setLinearVelocity(t)}get angularVelocity(){return this._body&&(this._angularVelocity=this._body.getAngularVelocity()),this._angularVelocity}set angularVelocity(t){this._angularVelocity=t,this._body&&this._body.setAngularVelocity(t)}get fixedRotation(){return this._fixedRotation}set fixedRotation(t){this._fixedRotation=t,this._body&&this._body.setFixedRotation(t)}isAwake(){return!!this._body&&this._body.isAwake}wakeUp(){this._body&&this._body.wakeUp()}sleep(){this._body&&this._body.sleep()}getMass(){return this._body?this._body.getMass():0}applyForce(t,e,i){this._body&&this._body.applyForce(t,e,i)}applyForceToCenter(t,e){this._body&&this._body.applyForceToCenter(t,e)}applyTorque(t,e){this._body&&this._body.applyTorque(t,e)}applyLinearImpulse(t,e,i){this._body&&this._body.applyLinearImpulse(t,e,i)}applyLinearImpulseToCenter(t,e){this._body&&this._body.applyLinearImpulseToCenter(t,e)}applyAngularImpulse(t,e){this._body&&this._body.applyAngularImpulse(t,e)}getLinearVelocityFromWorldPoint(t,e){return this._body?this._body.getLinearVelocityFromWorldPoint(t,e):e}getLocalVector(t,e){return this._body?this._body.getLocalVector(t,e):e}getWorldVector(t,e){return this._body?this._body.getWorldVector(t,e):e}getLocalPoint(t,e){return this._body?this._body.getLocalPoint(t,e):e}getWorldPoint(t,e){return this._body?this._body.getWorldPoint(t,e):e}getLocalCenter(t){return this._body?this._body.getLocalCenter(t):t}getWorldCenter(t){return this._body?this._body.getWorldCenter(t):t}getInertia(){return this._body?this._body.getInertia():0}onLoad(){this._body="builtin"===fdt.id?vdt:new fdt.wrapper.RigidBody,this._body.initialize(this)}onEnable(){this._body&&this._body.onEnable()}onDisable(){this._body&&this._body.onDisable()}onDestroy(){this._body&&this._body.onDestroy()}get impl(){return this._body}}).prototype,"group",[y_t],Object.getOwnPropertyDescriptor(E_t.prototype,"group"),E_t.prototype),I_t=Za(E_t.prototype,"enabledContactListener",[vh],(function(){return!1})),M_t=Za(E_t.prototype,"bullet",[vh],(function(){return!1})),s(E_t.prototype,"type",[b_t],Object.getOwnPropertyDescriptor(E_t.prototype,"type"),E_t.prototype),s(E_t.prototype,"allowSleep",[v_t],Object.getOwnPropertyDescriptor(E_t.prototype,"allowSleep"),E_t.prototype),s(E_t.prototype,"gravityScale",[S_t],Object.getOwnPropertyDescriptor(E_t.prototype,"gravityScale"),E_t.prototype),s(E_t.prototype,"linearDamping",[T_t],Object.getOwnPropertyDescriptor(E_t.prototype,"linearDamping"),E_t.prototype),s(E_t.prototype,"angularDamping",[w_t],Object.getOwnPropertyDescriptor(E_t.prototype,"angularDamping"),E_t.prototype),s(E_t.prototype,"linearVelocity",[x_t],Object.getOwnPropertyDescriptor(E_t.prototype,"linearVelocity"),E_t.prototype),s(E_t.prototype,"angularVelocity",[C_t],Object.getOwnPropertyDescriptor(E_t.prototype,"angularVelocity"),E_t.prototype),s(E_t.prototype,"fixedRotation",[A_t],Object.getOwnPropertyDescriptor(E_t.prototype,"fixedRotation"),E_t.prototype),P_t=Za(E_t.prototype,"awakeOnLoad",[vh],(function(){return!0})),O_t=Za(E_t.prototype,"_group",[vh],(function(){return 1})),R_t=Za(E_t.prototype,"_type",[vh],(function(){return 2})),B_t=Za(E_t.prototype,"_allowSleep",[vh],(function(){return!0})),F_t=Za(E_t.prototype,"_gravityScale",[vh],(function(){return 1})),N_t=Za(E_t.prototype,"_linearDamping",[vh],(function(){return 0})),L_t=Za(E_t.prototype,"_angularDamping",[vh],(function(){return 0})),k_t=Za(E_t.prototype,"_linearVelocity",[vh],(function(){return new kr})),z_t=Za(E_t.prototype,"_angularVelocity",[vh],(function(){return 0})),U_t=Za(E_t.prototype,"_fixedRotation",[vh],(function(){return!1})),D_t=E_t))||D_t));var W_t,X_t,Y_t,q_t,$_t,K_t,Z_t,Q_t,J_t,tpt,ept,ipt,spt,rpt,npt,opt,apt;const{ccclass:hpt,editable:lpt,type:cpt}=il;let upt=t("Collider2D",(W_t=hpt("cc.Collider2D"),X_t=cpt(We),Y_t=cpt(m_t),q_t=cpt(We),$_t=cpt(Xe),K_t=cpt(We),Z_t=cpt(We),Q_t=cpt(kr),W_t((tpt=class extends(ko(Km)){constructor(...t){super(...t),this.editing=!1,this.tag=ept&&ept(),this.TYPE=0,this._shape=null,this._body=null,this._group=ipt&&ipt(),this._density=spt&&spt(),this._sensor=rpt&&rpt(),this._friction=npt&&npt(),this._restitution=opt&&opt(),this._offset=apt&&apt()}get group(){return this._group}set group(t){this._group=t,this._shape&&this._shape.onGroupChanged&&this._shape.onGroupChanged()}get density(){return this._density}set density(t){this._density=t}get sensor(){return this._sensor}set sensor(t){this._sensor=t}get friction(){return this._friction}set friction(t){this._friction=t}get restitution(){return this._restitution}set restitution(t){this._restitution=t}get offset(){return this._offset}set offset(t){this._offset=t}get body(){return this._body}get impl(){return this._shape}onLoad(){this._shape=Tdt(this.TYPE),this._shape.initialize(this),this._shape.onLoad&&this._shape.onLoad(),this._body=this.getComponent(G_t)}onEnable(){this._shape&&this._shape.onEnable()}onDisable(){this._shape&&this._shape.onDisable&&this._shape.onDisable()}onDestroy(){this._shape&&this._shape.onDestroy&&this._shape.onDestroy()}apply(){this._shape&&this._shape.apply&&this._shape.apply()}get worldAABB(){return this._shape?this._shape.worldAABB:new Wr}},ept=Za(tpt.prototype,"tag",[X_t,vh],(function(){return 0})),s(tpt.prototype,"group",[Y_t],Object.getOwnPropertyDescriptor(tpt.prototype,"group"),tpt.prototype),s(tpt.prototype,"density",[q_t],Object.getOwnPropertyDescriptor(tpt.prototype,"density"),tpt.prototype),s(tpt.prototype,"sensor",[$_t],Object.getOwnPropertyDescriptor(tpt.prototype,"sensor"),tpt.prototype),s(tpt.prototype,"friction",[K_t],Object.getOwnPropertyDescriptor(tpt.prototype,"friction"),tpt.prototype),s(tpt.prototype,"restitution",[Z_t],Object.getOwnPropertyDescriptor(tpt.prototype,"restitution"),tpt.prototype),s(tpt.prototype,"offset",[Q_t],Object.getOwnPropertyDescriptor(tpt.prototype,"offset"),tpt.prototype),ipt=Za(tpt.prototype,"_group",[vh],(function(){return 1})),spt=Za(tpt.prototype,"_density",[vh],(function(){return 1})),rpt=Za(tpt.prototype,"_sensor",[vh],(function(){return!1})),npt=Za(tpt.prototype,"_friction",[vh],(function(){return.2})),opt=Za(tpt.prototype,"_restitution",[vh],(function(){return 0})),apt=Za(tpt.prototype,"_offset",[vh],(function(){return new kr})),J_t=tpt))||J_t));var dpt,_pt,ppt,mpt,gpt;const{ccclass:fpt,menu:ypt}=il;var bpt,vpt,Spt,Tpt,wpt;t("BoxCollider2D",(dpt=fpt("cc.BoxCollider2D"),_pt=Xh(Vr),dpt((mpt=class extends upt{constructor(...t){super(...t),this._size=gpt&&gpt(),this.TYPE=1}get size(){return this._size}set size(t){this._size=t}get worldPoints(){return this._shape?this._shape.worldPoints:[]}},gpt=Za(mpt.prototype,"_size",[vh],(function(){return new Vr(1,1)})),s(mpt.prototype,"size",[_pt],Object.getOwnPropertyDescriptor(mpt.prototype,"size"),mpt.prototype),ppt=mpt))||ppt));const{ccclass:xpt,menu:Cpt}=il;var Apt,Dpt,Ept,Ipt,Mpt,Ppt,Opt;t("CircleCollider2D",(bpt=xpt("cc.CircleCollider2D"),vpt=Xh(We),bpt((Tpt=class extends upt{constructor(...t){super(...t),this._radius=wpt&&wpt(),this.TYPE=2}get radius(){return this._radius}set radius(t){this._radius=t<0?0:t}get worldPosition(){return this._shape?this._shape.worldPosition:new kr}get worldRadius(){return this._shape?this._shape.worldRadius:0}},wpt=Za(Tpt.prototype,"_radius",[vh],(function(){return 1})),s(Tpt.prototype,"radius",[vpt],Object.getOwnPropertyDescriptor(Tpt.prototype,"radius"),Tpt.prototype),Spt=Tpt))||Spt));const{ccclass:Rpt,menu:Bpt}=il;var Fpt,Npt,Lpt,kpt,zpt,Upt,Vpt,jpt;t("PolygonCollider2D",(Apt=Rpt("cc.PolygonCollider2D"),Dpt=Xh(We),Ept=Xh([kr]),Apt((Mpt=class extends upt{constructor(...t){super(...t),this.threshold=Ppt&&Ppt(),this._points=Opt&&Opt(),this.TYPE=3}get points(){return this._points}set points(t){this._points=t}get worldPoints(){return this._shape?this._shape.worldPoints:[]}},Ppt=Za(Mpt.prototype,"threshold",[Dpt],(function(){return 1})),Opt=Za(Mpt.prototype,"_points",[vh],(function(){return[new kr(-1,-1),new kr(1,-1),new kr(1,1),new kr(-1,1)]})),s(Mpt.prototype,"points",[Ept],Object.getOwnPropertyDescriptor(Mpt.prototype,"points"),Mpt.prototype),Ipt=Mpt))||Ipt));const{ccclass:Hpt,type:Gpt}=il;let Wpt=t("Joint2D",(Fpt=Hpt("cc.Joint2D"),Npt=Gpt(G_t),Fpt((kpt=class extends Km{constructor(...t){super(...t),this.anchor=zpt&&zpt(),this.connectedAnchor=Upt&&Upt(),this.collideConnected=Vpt&&Vpt(),this.connectedBody=jpt&&jpt(),this._body=null,this._joint=null,this.TYPE=0}get body(){return this._body}get impl(){return this._joint}onLoad(){this._joint=Cdt(this.TYPE),this._joint.initialize(this),this._body=this.getComponent(G_t)}onEnable(){this._joint&&this._joint.onEnable&&this._joint.onEnable()}onDisable(){this._joint&&this._joint.onDisable&&this._joint.onDisable()}start(){this._joint&&this._joint.start&&this._joint.start()}onDestroy(){this._joint&&this._joint.onDestroy&&this._joint.onDestroy()}apply(){this._joint&&this._joint.apply&&this._joint.apply()}},zpt=Za(kpt.prototype,"anchor",[vh],(function(){return new kr})),Upt=Za(kpt.prototype,"connectedAnchor",[vh],(function(){return new kr})),Vpt=Za(kpt.prototype,"collideConnected",[vh],(function(){return!1})),jpt=Za(kpt.prototype,"connectedBody",[Npt,vh],(function(){return null})),Lpt=kpt))||Lpt));var Xpt,Ypt,qpt,$pt,Kpt,Zpt,Qpt;const{ccclass:Jpt,menu:tmt}=il;var emt,imt,smt,rmt,nmt,omt,amt,hmt,lmt,cmt,umt;t("DistanceJoint2D",(Xpt=Jpt("cc.DistanceJoint2D"),Ypt=Xh(We),qpt=Xh(Xe),Xpt((s((Kpt=class extends Wpt{constructor(...t){super(...t),this.TYPE=1,this._maxLength=Zpt&&Zpt(),this._autoCalcDistance=Qpt&&Qpt()}get maxLength(){return this._autoCalcDistance?this.connectedBody?Ms.distance(this.node.worldPosition,this.connectedBody.node.worldPosition):Ms.len(this.node.worldPosition):this._maxLength}set maxLength(t){this._maxLength=t,this._joint&&this._joint.setMaxLength(t)}get autoCalcDistance(){return this._autoCalcDistance}set autoCalcDistance(t){this._autoCalcDistance=t}}).prototype,"maxLength",[Ypt],Object.getOwnPropertyDescriptor(Kpt.prototype,"maxLength"),Kpt.prototype),s(Kpt.prototype,"autoCalcDistance",[qpt],Object.getOwnPropertyDescriptor(Kpt.prototype,"autoCalcDistance"),Kpt.prototype),Zpt=Za(Kpt.prototype,"_maxLength",[vh],(function(){return 5})),Qpt=Za(Kpt.prototype,"_autoCalcDistance",[vh],(function(){return!0})),$pt=Kpt))||$pt));const{ccclass:dmt,menu:_mt}=il;var pmt,mmt,gmt,fmt,ymt,bmt,vmt,Smt,Tmt;t("SpringJoint2D",(emt=dmt("cc.SpringJoint2D"),imt=Xh(We),smt=Xh(We),rmt=Xh(We),nmt=Xh(Xe),emt((s((amt=class extends Wpt{constructor(...t){super(...t),this.TYPE=2,this._frequency=hmt&&hmt(),this._dampingRatio=lmt&&lmt(),this._distance=cmt&&cmt(),this._autoCalcDistance=umt&&umt()}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}get dampingRatio(){return this._dampingRatio}set dampingRatio(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}get distance(){return this._autoCalcDistance?this.connectedBody?Ms.distance(this.node.worldPosition,this.connectedBody.node.worldPosition):Ms.len(this.node.worldPosition):this._distance}set distance(t){this._distance=t,this._joint&&this._joint.setDistance(t)}get autoCalcDistance(){return this._autoCalcDistance}set autoCalcDistance(t){this._autoCalcDistance=t}}).prototype,"frequency",[imt],Object.getOwnPropertyDescriptor(amt.prototype,"frequency"),amt.prototype),s(amt.prototype,"dampingRatio",[smt],Object.getOwnPropertyDescriptor(amt.prototype,"dampingRatio"),amt.prototype),s(amt.prototype,"distance",[rmt],Object.getOwnPropertyDescriptor(amt.prototype,"distance"),amt.prototype),s(amt.prototype,"autoCalcDistance",[nmt],Object.getOwnPropertyDescriptor(amt.prototype,"autoCalcDistance"),amt.prototype),hmt=Za(amt.prototype,"_frequency",[vh],(function(){return 5})),lmt=Za(amt.prototype,"_dampingRatio",[vh],(function(){return.7})),cmt=Za(amt.prototype,"_distance",[vh],(function(){return 10})),umt=Za(amt.prototype,"_autoCalcDistance",[vh],(function(){return!0})),omt=amt))||omt));const{ccclass:wmt,menu:xmt}=il;var Cmt,Amt,Dmt,Emt,Imt,Mmt,Pmt,Omt,Rmt,Bmt,Fmt,Nmt,Lmt,kmt,zmt;t("MouseJoint2D",(pmt=wmt("cc.MouseJoint2D"),mmt=Xh(We),gmt=Xh(We),fmt=Xh(We),pmt((s((bmt=class extends Wpt{constructor(...t){super(...t),this.TYPE=4,this._maxForce=vmt&&vmt(),this._dampingRatio=Smt&&Smt(),this._frequency=Tmt&&Tmt(),this._target=new kr}get target(){return this._target}set target(t){this._target=t,this._joint&&this._joint.setTarget(t)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}get dampingRatio(){return this._dampingRatio}set dampingRatio(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}get maxForce(){return this._maxForce}set maxForce(t){this._maxForce=t,this._joint&&this._joint.setMaxForce(t)}update(t){this._joint.update(t)}}).prototype,"frequency",[mmt],Object.getOwnPropertyDescriptor(bmt.prototype,"frequency"),bmt.prototype),s(bmt.prototype,"dampingRatio",[gmt],Object.getOwnPropertyDescriptor(bmt.prototype,"dampingRatio"),bmt.prototype),s(bmt.prototype,"maxForce",[fmt],Object.getOwnPropertyDescriptor(bmt.prototype,"maxForce"),bmt.prototype),vmt=Za(bmt.prototype,"_maxForce",[vh],(function(){return 1e3})),Smt=Za(bmt.prototype,"_dampingRatio",[vh],(function(){return.7})),Tmt=Za(bmt.prototype,"_frequency",[vh],(function(){return 5})),ymt=bmt))||ymt));const Umt=new Ms,Vmt=new Ms,{ccclass:jmt,menu:Hmt}=il;var Gmt,Wmt,Xmt,Ymt,qmt,$mt,Kmt,Zmt,Qmt,Jmt,tgt,egt,igt,sgt,rgt,ngt,ogt,agt,hgt;t("RelativeJoint2D",(Cmt=jmt("cc.RelativeJoint2D"),Amt=Xh(We),Dmt=Xh(We),Emt=Xh(We),Imt=Xh(kr),Mmt=Xh(We),Pmt=Xh(Xe),Cmt((s((Rmt=class extends Wpt{constructor(...t){super(...t),this.TYPE=7,this._maxForce=Bmt&&Bmt(),this._maxTorque=Fmt&&Fmt(),this._correctionFactor=Nmt&&Nmt(),this._angularOffset=Lmt&&Lmt(),this._linearOffset=kmt&&kmt(),this._autoCalcOffset=zmt&&zmt()}get maxForce(){return this._maxForce}set maxForce(t){this._maxForce=t,this._joint&&this._joint.setMaxForce(t)}get maxTorque(){return this._maxTorque}set maxTorque(t){this._maxTorque=t,this._joint&&this._joint.setMaxTorque(t)}get correctionFactor(){return this._correctionFactor}set correctionFactor(t){this._correctionFactor=t,this._joint&&this._joint.setCorrectionFactor(t)}get linearOffset(){return this._autoCalcOffset?this.connectedBody?kr.subtract(this._linearOffset,this.connectedBody.node.worldPosition,this.node.worldPosition):kr.subtract(this._linearOffset,new kr(0,0),this.node.worldPosition):this._linearOffset}set linearOffset(t){this._linearOffset.set(t),this._joint&&this._joint.setLinearOffset(t)}get angularOffset(){return this._autoCalcOffset&&(sr.toEuler(Umt,this.node.worldRotation),this.connectedBody?sr.toEuler(Vmt,this.connectedBody.node.worldRotation):sr.toEuler(Vmt,new sr),this._angularOffset=Vmt.z-Umt.z),this._angularOffset}set angularOffset(t){this._angularOffset=t,this._joint&&this._joint.setAngularOffset(t)}get autoCalcOffset(){return this._autoCalcOffset}set autoCalcOffset(t){this._autoCalcOffset=t}}).prototype,"maxForce",[Amt],Object.getOwnPropertyDescriptor(Rmt.prototype,"maxForce"),Rmt.prototype),s(Rmt.prototype,"maxTorque",[Dmt],Object.getOwnPropertyDescriptor(Rmt.prototype,"maxTorque"),Rmt.prototype),s(Rmt.prototype,"correctionFactor",[Emt],Object.getOwnPropertyDescriptor(Rmt.prototype,"correctionFactor"),Rmt.prototype),s(Rmt.prototype,"linearOffset",[Imt],Object.getOwnPropertyDescriptor(Rmt.prototype,"linearOffset"),Rmt.prototype),s(Rmt.prototype,"angularOffset",[Mmt],Object.getOwnPropertyDescriptor(Rmt.prototype,"angularOffset"),Rmt.prototype),s(Rmt.prototype,"autoCalcOffset",[Pmt],Object.getOwnPropertyDescriptor(Rmt.prototype,"autoCalcOffset"),Rmt.prototype),Bmt=Za(Rmt.prototype,"_maxForce",[vh],(function(){return 5})),Fmt=Za(Rmt.prototype,"_maxTorque",[vh],(function(){return.7})),Nmt=Za(Rmt.prototype,"_correctionFactor",[vh],(function(){return.3})),Lmt=Za(Rmt.prototype,"_angularOffset",[vh],(function(){return 0})),kmt=Za(Rmt.prototype,"_linearOffset",[vh],(function(){return new kr})),zmt=Za(Rmt.prototype,"_autoCalcOffset",[vh],(function(){return!0})),Omt=Rmt))||Omt));const lgt=new kr,{ccclass:cgt,menu:ugt}=il;var dgt,_gt,pgt,mgt,ggt,fgt,ygt;t("SliderJoint2D",(Gmt=cgt("cc.SliderJoint2D"),Wmt=Xh(We),Xmt=Xh(Xe),Ymt=Xh(Xe),qmt=Xh(We),$mt=Xh(We),Kmt=Xh(Xe),Zmt=Xh(We),Qmt=Xh(We),Gmt((s((tgt=class extends Wpt{constructor(...t){super(...t),this.TYPE=6,this._angle=egt&&egt(),this._autoCalcAngle=igt&&igt(),this._enableMotor=sgt&&sgt(),this._maxMotorForce=rgt&&rgt(),this._motorSpeed=ngt&&ngt(),this._enableLimit=ogt&&ogt(),this._lowerLimit=agt&&agt(),this._upperLimit=hgt&&hgt()}get angle(){return this._autoCalcAngle&&(this.connectedBody?kr.subtract(lgt,this.connectedBody.node.worldPosition,this.node.worldPosition):kr.subtract(lgt,new kr(0,0),this.node.worldPosition),this._angle=Li(Math.atan2(lgt.y,lgt.x))),this._angle}set angle(t){this._angle=t}get autoCalcAngle(){return this._autoCalcAngle}set autoCalcAngle(t){this._autoCalcAngle=t}get enableMotor(){return this._enableMotor}set enableMotor(t){this._enableMotor=t}get maxMotorForce(){return this._maxMotorForce}set maxMotorForce(t){this._maxMotorForce=t,this._joint&&this._joint.setMaxMotorForce(t)}get motorSpeed(){return this._motorSpeed}set motorSpeed(t){this._motorSpeed=t,this._joint&&this._joint.setMotorSpeed(t)}get enableLimit(){return this._enableLimit}set enableLimit(t){this._enableLimit=t}get lowerLimit(){return this._lowerLimit}set lowerLimit(t){this._lowerLimit=t,this._joint&&this._joint.setLowerLimit(t)}get upperLimit(){return this._upperLimit}set upperLimit(t){this._upperLimit=t,this._joint&&this._joint.setUpperLimit(t)}}).prototype,"angle",[Wmt],Object.getOwnPropertyDescriptor(tgt.prototype,"angle"),tgt.prototype),s(tgt.prototype,"autoCalcAngle",[Xmt],Object.getOwnPropertyDescriptor(tgt.prototype,"autoCalcAngle"),tgt.prototype),s(tgt.prototype,"enableMotor",[Ymt],Object.getOwnPropertyDescriptor(tgt.prototype,"enableMotor"),tgt.prototype),s(tgt.prototype,"maxMotorForce",[qmt],Object.getOwnPropertyDescriptor(tgt.prototype,"maxMotorForce"),tgt.prototype),s(tgt.prototype,"motorSpeed",[$mt],Object.getOwnPropertyDescriptor(tgt.prototype,"motorSpeed"),tgt.prototype),s(tgt.prototype,"enableLimit",[Kmt],Object.getOwnPropertyDescriptor(tgt.prototype,"enableLimit"),tgt.prototype),s(tgt.prototype,"lowerLimit",[Zmt],Object.getOwnPropertyDescriptor(tgt.prototype,"lowerLimit"),tgt.prototype),s(tgt.prototype,"upperLimit",[Qmt],Object.getOwnPropertyDescriptor(tgt.prototype,"upperLimit"),tgt.prototype),egt=Za(tgt.prototype,"_angle",[vh],(function(){return 0})),igt=Za(tgt.prototype,"_autoCalcAngle",[vh],(function(){return!0})),sgt=Za(tgt.prototype,"_enableMotor",[vh],(function(){return!1})),rgt=Za(tgt.prototype,"_maxMotorForce",[vh],(function(){return 1e3})),ngt=Za(tgt.prototype,"_motorSpeed",[vh],(function(){return 1e3})),ogt=Za(tgt.prototype,"_enableLimit",[vh],(function(){return!1})),agt=Za(tgt.prototype,"_lowerLimit",[vh],(function(){return 0})),hgt=Za(tgt.prototype,"_upperLimit",[vh],(function(){return 0})),Jmt=tgt))||Jmt));const{ccclass:bgt,menu:vgt}=il;var Sgt,Tgt,wgt,xgt,Cgt,Agt,Dgt,Egt,Igt,Mgt,Pgt,Ogt,Rgt,Bgt,Fgt;t("FixedJoint2D",(dgt=bgt("cc.FixedJoint2D"),_gt=Xh(We),pgt=Xh(We),dgt((s((ggt=class extends Wpt{constructor(...t){super(...t),this.TYPE=5,this._frequency=fgt&&fgt(),this._dampingRatio=ygt&&ygt()}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}get dampingRatio(){return this._dampingRatio}set dampingRatio(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}}).prototype,"frequency",[_gt],Object.getOwnPropertyDescriptor(ggt.prototype,"frequency"),ggt.prototype),s(ggt.prototype,"dampingRatio",[pgt],Object.getOwnPropertyDescriptor(ggt.prototype,"dampingRatio"),ggt.prototype),fgt=Za(ggt.prototype,"_frequency",[vh],(function(){return.7})),ygt=Za(ggt.prototype,"_dampingRatio",[vh],(function(){return.5})),mgt=ggt))||mgt));const{ccclass:Ngt,menu:Lgt}=il;var kgt,zgt,Ugt,Vgt,jgt,Hgt,Ggt,Wgt,Xgt,Ygt,qgt,$gt,Kgt,Zgt,Qgt;t("WheelJoint2D",(Sgt=Ngt("cc.WheelJoint2D"),Tgt=Xh(We),wgt=Xh(Xe),xgt=Xh(We),Cgt=Xh(We),Agt=Xh(We),Dgt=Xh(We),Sgt((s((Igt=class extends Wpt{constructor(...t){super(...t),this.TYPE=3,this._angle=Mgt&&Mgt(),this._enableMotor=Pgt&&Pgt(),this._maxMotorTorque=Ogt&&Ogt(),this._motorSpeed=Rgt&&Rgt(),this._frequency=Bgt&&Bgt(),this._dampingRatio=Fgt&&Fgt()}get angle(){return this._angle}set angle(t){this._angle=t}get enableMotor(){return this._enableMotor}set enableMotor(t){this._enableMotor=t,this._joint&&this._joint.enableMotor(t)}get maxMotorTorque(){return this._maxMotorTorque}set maxMotorTorque(t){this._maxMotorTorque=t,this._joint&&this._joint.setMaxMotorTorque(t)}get motorSpeed(){return this._motorSpeed}set motorSpeed(t){this._motorSpeed=t,this._joint&&this._joint.setMotorSpeed(t)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}get dampingRatio(){return this._dampingRatio}set dampingRatio(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}}).prototype,"angle",[Tgt],Object.getOwnPropertyDescriptor(Igt.prototype,"angle"),Igt.prototype),s(Igt.prototype,"enableMotor",[wgt],Object.getOwnPropertyDescriptor(Igt.prototype,"enableMotor"),Igt.prototype),s(Igt.prototype,"maxMotorTorque",[xgt],Object.getOwnPropertyDescriptor(Igt.prototype,"maxMotorTorque"),Igt.prototype),s(Igt.prototype,"motorSpeed",[Cgt],Object.getOwnPropertyDescriptor(Igt.prototype,"motorSpeed"),Igt.prototype),s(Igt.prototype,"frequency",[Agt],Object.getOwnPropertyDescriptor(Igt.prototype,"frequency"),Igt.prototype),s(Igt.prototype,"dampingRatio",[Dgt],Object.getOwnPropertyDescriptor(Igt.prototype,"dampingRatio"),Igt.prototype),Mgt=Za(Igt.prototype,"_angle",[vh],(function(){return 90})),Pgt=Za(Igt.prototype,"_enableMotor",[vh],(function(){return!1})),Ogt=Za(Igt.prototype,"_maxMotorTorque",[vh],(function(){return 1e3})),Rgt=Za(Igt.prototype,"_motorSpeed",[vh],(function(){return 0})),Bgt=Za(Igt.prototype,"_frequency",[vh],(function(){return 5})),Fgt=Za(Igt.prototype,"_dampingRatio",[vh],(function(){return.7})),Egt=Igt))||Egt));const{ccclass:Jgt,menu:tft}=il;t("HingeJoint2D",(kgt=Jgt("cc.HingeJoint2D"),zgt=Xh(Xe),Ugt=Xh(We),Vgt=Xh(We),jgt=Xh(Xe),Hgt=Xh(We),Ggt=Xh(We),kgt((s((Xgt=class extends Wpt{constructor(...t){super(...t),this.TYPE=8,this._enableLimit=Ygt&&Ygt(),this._lowerAngle=qgt&&qgt(),this._upperAngle=$gt&&$gt(),this._enableMotor=Kgt&&Kgt(),this._maxMotorTorque=Zgt&&Zgt(),this._motorSpeed=Qgt&&Qgt()}get enableLimit(){return this._enableLimit}set enableLimit(t){this._enableLimit=t}get lowerAngle(){return this._lowerAngle}set lowerAngle(t){this._lowerAngle=t,this._joint&&this._joint.setLowerAngle(t)}get upperAngle(){return this._upperAngle}set upperAngle(t){this._upperAngle=t,this._joint&&this._joint.setUpperAngle(t)}get enableMotor(){return this._enableMotor}set enableMotor(t){this._enableMotor=t,this._joint&&this._joint.enableMotor(t)}get maxMotorTorque(){return this._maxMotorTorque}set maxMotorTorque(t){this._maxMotorTorque=t,this._joint&&this._joint.setMaxMotorTorque(t)}get motorSpeed(){return this._motorSpeed}set motorSpeed(t){this._motorSpeed=t,this._joint&&this._joint.setMotorSpeed(t)}}).prototype,"enableLimit",[zgt],Object.getOwnPropertyDescriptor(Xgt.prototype,"enableLimit"),Xgt.prototype),s(Xgt.prototype,"lowerAngle",[Ugt],Object.getOwnPropertyDescriptor(Xgt.prototype,"lowerAngle"),Xgt.prototype),s(Xgt.prototype,"upperAngle",[Vgt],Object.getOwnPropertyDescriptor(Xgt.prototype,"upperAngle"),Xgt.prototype),s(Xgt.prototype,"enableMotor",[jgt],Object.getOwnPropertyDescriptor(Xgt.prototype,"enableMotor"),Xgt.prototype),s(Xgt.prototype,"maxMotorTorque",[Hgt],Object.getOwnPropertyDescriptor(Xgt.prototype,"maxMotorTorque"),Xgt.prototype),s(Xgt.prototype,"motorSpeed",[Ggt],Object.getOwnPropertyDescriptor(Xgt.prototype,"motorSpeed"),Xgt.prototype),Ygt=Za(Xgt.prototype,"_enableLimit",[vh],(function(){return!1})),qgt=Za(Xgt.prototype,"_lowerAngle",[vh],(function(){return 0})),$gt=Za(Xgt.prototype,"_upperAngle",[vh],(function(){return 0})),Kgt=Za(Xgt.prototype,"_enableMotor",[vh],(function(){return!1})),Zgt=Za(Xgt.prototype,"_maxMotorTorque",[vh],(function(){return 1e3})),Qgt=Za(Xgt.prototype,"_motorSpeed",[vh],(function(){return 0})),Wgt=Xgt))||Wgt)),t("Physics2DUtils",{PolygonSeparator:jdt,PolygonPartition:Qdt}),a.internal.physics2d={selector:fdt};class eft{constructor(){this._collider=null,this._worldAabb=new Wr,this._contacts=[]}get impl(){return null}get collider(){return this._collider}apply(){}initialize(t){this._collider=t}onLoad(){}onEnable(){n_t.instance.physicsWorld.addShape(this)}onDisable(){n_t.instance.physicsWorld.removeShape(this)}start(){}update(){}get worldAABB(){return this._worldAabb}containsPoint(t){return!!this.worldAABB.contains(t)}intersectsRect(t){return!!this.worldAABB.intersects(t)}onGroupChanged(){n_t.instance.physicsWorld.updateShapeGroup(this)}}class ift extends eft{constructor(...t){super(...t),this._worldPoints=[new kr,new kr,new kr,new kr]}get worldPoints(){return this._worldPoints}update(){const t=this._worldAabb,e=this.collider,i=e.size,s=e.offset;t.x=s.x-i.width/2,t.y=s.y-i.height/2,t.width=i.width,t.height=i.height;const r=this._worldPoints,n=r[0],o=r[1],a=r[2],h=r[3];t.transformMat4ToPoints(e.node.worldMatrix,n,o,a,h);const l=Math.min(n.x,o.x,a.x,h.x),c=Math.min(n.y,o.y,a.y,h.y),u=Math.max(n.x,o.x,a.x,h.x),d=Math.max(n.y,o.y,a.y,h.y);t.x=l,t.y=c,t.width=u-l,t.height=d-c}containsPoint(t){return!!this.worldAABB.contains(t)&&C9.pointInPolygon(t,this.worldPoints)}intersectsRect(t){return!!this.worldAABB.intersects(t)&&C9.rectPolygon(t,this.worldPoints)}}const sft=new kr,rft=new vr;class nft extends eft{constructor(...t){super(...t),this._worldPosition=new kr,this._worldRadius=0}get worldPosition(){return this._worldPosition}get worldRadius(){return this._worldRadius}update(){const t=this._worldAabb,e=this.collider,i=e.node.getWorldMatrix(rft);kr.transformMat4(sft,e.offset,i);const s=this._worldPosition;s.x=sft.x,s.y=sft.y,i.m12=i.m13=0,sft.x=e.radius,sft.y=0,kr.transformMat4(sft,sft,i);const r=this._worldRadius=sft.length();t.x=s.x-r,t.y=s.y-r,t.width=2*r,t.height=2*r}containsPoint(t){return!!this.worldAABB.contains(t)&&kr.subtract(sft,t,this.worldPosition).length()<this.worldRadius}intersectsRect(t){return!!this.worldAABB.intersects(t)&&C9.rectCircle(t,this.worldPosition,this.worldRadius)}}const oft=new kr;class aft extends eft{constructor(...t){super(...t),this._worldPoints=[]}get worldPoints(){return this._worldPoints}update(){const t=this._worldAabb,e=this.collider,i=e.points,s=e.offset,r=e.node.worldMatrix,n=this._worldPoints;n.length=i.length;let o=1e6,a=1e6,h=-1e6,l=-1e6;for(let t=0,e=i.length;t<e;t++){n[t]||(n[t]=new kr),oft.x=i[t].x+s.x,oft.y=i[t].y+s.y,kr.transformMat4(oft,oft,r);const e=oft.x,c=oft.y;n[t].x=e,n[t].y=c,e>h&&(h=e),e<o&&(o=e),c>l&&(l=c),c<a&&(a=c)}t.x=o,t.y=a,t.width=h-o,t.height=l-a}containsPoint(t){return!!this.worldAABB.contains(t)&&C9.pointInPolygon(t,this.worldPoints)}intersectsRect(t){return!!this.worldAABB.intersects(t)&&C9.rectPolygon(t,this.worldPoints)}}class hft{constructor(t,e){this.shape1=void 0,this.shape2=void 0,this.testFunc=void 0,this.touching=!1,this.type=e_t.None,this.shape1=t,this.shape2=e,this.touching=!1;const i=t instanceof ift||t instanceof aft,s=e instanceof ift||e instanceof aft,r=t instanceof nft,n=e instanceof nft;i&&s?this.testFunc=C9.polygonPolygon:r&&n?this.testFunc=C9.circleCircle:i&&n?this.testFunc=C9.polygonCircle:r&&s?(this.testFunc=C9.polygonCircle,this.shape1=e,this.shape2=t):P(`Can not find contact for builtin shape: ${t.constructor.name}, ${e.constructor.name}`)}test(){const t=this.shape1,e=this.shape2;return!!t.worldAABB.intersects(e.worldAABB)&&(this.testFunc===C9.polygonPolygon?C9.polygonPolygon(t.worldPoints,e.worldPoints):this.testFunc===C9.circleCircle?C9.circleCircle(t.worldPosition,t.worldRadius,e.worldPosition,e.worldRadius):this.testFunc===C9.polygonCircle&&C9.polygonCircle(t.worldPoints,e.worldPosition,e.worldRadius))}updateState(){const t=this.test();let e=e_t.None;return t&&!this.touching?(this.touching=!0,e=e_t.BEGIN_CONTACT):!t&&this.touching&&(this.touching=!1,e=e_t.END_CONTACT),this.type=e,e}}const lft=[],cft=[];class uft{constructor(){this._contacts=[],this._shapes=[],this._debugGraphics=null,this._debugDrawFlags=0}get debugDrawFlags(){return this._debugDrawFlags}set debugDrawFlags(t){this._debugDrawFlags=t}shouldCollide(t,e){const i=t.collider,s=e.collider,r=n_t.instance.collisionMatrix;return i!==s&&i.node!==s.node&&r[i.group]&s.group&&r[s.group]&i.group}addShape(t){const e=this._shapes;if(-1===e.indexOf(t)){for(let i=0,s=e.length;i<s;i++){const s=e[i];if(this.shouldCollide(t,s)){const e=new hft(t,s);this._contacts.push(e),-1===t._contacts.indexOf(e)&&t._contacts.push(e),-1===s._contacts.indexOf(e)&&s._contacts.push(e)}}e.push(t)}}removeShape(t){const e=this._shapes,i=e.indexOf(t);if(i>=0){ie(e,i);const s=this._contacts;for(let e=s.length-1;e>=0;e--){const i=s[e];if(i.shape1===t||i.shape2===t){i.touching&&this._emitCollide(i,e_t.END_CONTACT),ie(s,e);const r=i.shape1===t?i.shape2:i.shape1,n=r._contacts.indexOf(i);n>=0&&ie(r._contacts,n)}}}t._contacts.length=0}updateShapeGroup(t){this.removeShape(t),t.collider.enabledInHierarchy&&this.addShape(t)}step(t,e=10,i=10){const s=this._shapes;for(let t=0,e=s.length;t<e;t++)s[t].update();const r=this._contacts;lft.length=0;for(let t=0,e=r.length;t<e;t++)r[t].updateState()!==e_t.None&&lft.push(r[t]);for(let t=0,e=lft.length;t<e;t++){const e=lft[t];this._emitCollide(e)}}drawDebug(){if(!this._debugDrawFlags)return;this._checkDebugDrawValid();const t=this._debugGraphics;if(!t)return;t.clear(),t.lineWidth=3;const e=this._shapes;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(t.strokeColor=Ls.WHITE,s instanceof ift||s instanceof aft){const e=s.worldPoints;if(e.length>0){t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.close(),t.stroke()}}else s instanceof nft&&(t.circle(s.worldPosition.x,s.worldPosition.y,s.worldRadius),t.stroke());if(4&this._debugDrawFlags){const e=s.worldAABB;t.strokeColor=Ls.BLUE,t.moveTo(e.xMin,e.yMin),t.lineTo(e.xMin,e.yMax),t.lineTo(e.xMax,e.yMax),t.lineTo(e.xMax,e.yMin),t.close(),t.stroke()}}}_emitCollide(t,e){e=e||t.type;const i=t.shape1.collider,s=t.shape2.collider;n_t.instance.emit(e,i,s),i.emit(e,i,s),s.emit(e,s,i)}_checkDebugDrawValid(){if(!this._debugGraphics||!this._debugGraphics.isValid){let t=vT("Canvas");if(!t){const e=nC.getScene();if(!e)return;t=new tb("Canvas"),t.addComponent("cc.Canvas"),t.parent=e}let e=new tb("PHYSICS_2D_DEBUG_DRAW");e.hideFlags|=8,e.parent=t,e.worldPosition=Ms.ZERO;try{this._debugGraphics=e.addComponent("cc.Graphics"),this._debugGraphics.lineWidth=2}catch(t){G(4501,t.message),e.destroy(),e=null}}if(this._debugGraphics){const t=this._debugGraphics.node.parent;this._debugGraphics.node.setSiblingIndex(t.children.length-1)}}testPoint(t){const e=this._shapes;cft.length=0;for(let i=0;i<e.length;i++){const s=e[i];s.containsPoint(t)&&cft.push(s.collider)}return cft}testAABB(t){const e=this._shapes;cft.length=0;for(let i=0;i<e.length;i++){const s=e[i];s.intersectsRect(t)&&cft.push(s.collider)}return cft}impl(){return null}setGravity(){}setAllowSleep(){}syncPhysicsToScene(){}syncSceneToPhysics(){}raycast(t,e,i){return[]}}function dft(t){a._global.CC_PHYSICS_BUILTIN="builtin"===t,a._global.CC_PHYSICS_CANNON="cannon.js"===t,a._global.CC_PHYSICS_AMMO="bullet"===t}let _ft;JA.once(QA.EVENT_PRE_SUBSYSTEM_INIT,(()=>{fdt.register("builtin",{PhysicsWorld:uft,RigidBody:null,BoxShape:ift,CircleShape:nft,PolygonShape:aft,MouseJoint:null,DistanceJoint:null,SpringJoint:null,RelativeJoint:null,SliderJoint:null,FixedJoint:null,WheelJoint:null,HingeJoint:null})}));const pft={id:"",switchTo:function(t){if(!pft.runInEditor)return;const e=pft;if(pft.physicsWorld&&t!==pft.id&&null!=pft.backend[t]?(pft.physicsWorld.destroy(),I(`[PHYSICS]: switch from ${pft.id} to ${t}.`),dft(t),e.id=t,e.wrapper=pft.backend[t],e.physicsWorld=vft()):(I(`[PHYSICS]: using ${t}.`),e.physicsWorld=vft()),_ft){const t=e.physicsWorld;t.setGravity(_ft.gravity),t.setAllowSleep(_ft.allowSleep)}},register:function(t,e){if(I(`[PHYSICS]: register ${t}.`),pft.backend[t]=e,!pft.physicsWorld||pft.id===t){dft(t);const i=pft;i.id=t,i.wrapper=e}},wrapper:{},backend:{},physicsWorld:null,runInEditor:!0};function mft(t){if(_ft||(_ft=t),pft.runInEditor&&!pft.physicsWorld){I(`[PHYSICS]: using ${pft.id}.`);const t=pft.physicsWorld=vft();t.setGravity(_ft.gravity),t.setAllowSleep(_ft.allowSleep)}}const gft=()=>0,fft={impl:null,debugDrawFlags:0,debugDrawConstraintSize:0,setGravity:gft,setAllowSleep:gft,setDefaultMaterial:gft,step:gft,syncAfterEvents:gft,syncSceneToPhysics:gft,raycast:gft,raycastClosest:gft,sweepBox:gft,sweepBoxClosest:gft,sweepSphere:gft,sweepSphereClosest:gft,sweepCapsule:gft,sweepCapsuleClosest:gft,emitEvents:gft,destroy:gft},yft={World:0,RigidBody:1,BoxCollider:2,SphereCollider:3,CapsuleCollider:4,MeshCollider:5,CylinderCollider:6,ConeCollider:7,TerrainCollider:8,SimplexCollider:9,PlaneCollider:10,PointToPointConstraint:11,HingeConstraint:12,FixedConstraint:13,ConfigurableConstraint:14,BoxCharacterController:15,CapsuleCharacterController:16};function bft(t,e){return null==t&&(pft.id?M(`${pft.id} physics does not support ${yft[e]}`):G(9600),!0)}function vft(){return bft(pft.wrapper.PhysicsWorld,0)?fft:new pft.wrapper.PhysicsWorld}const Sft={impl:null,rigidBody:null,isAwake:!1,isSleepy:!1,isSleeping:!1,initialize:gft,onEnable:gft,onDisable:gft,onDestroy:gft,setType:gft,setMass:gft,setLinearDamping:gft,setAngularDamping:gft,useGravity:gft,setLinearFactor:gft,setAngularFactor:gft,setAllowSleep:gft,wakeUp:gft,sleep:gft,clearState:gft,clearForces:gft,clearVelocity:gft,setSleepThreshold:gft,getSleepThreshold:gft,getLinearVelocity:gft,setLinearVelocity:gft,getAngularVelocity:gft,setAngularVelocity:gft,applyForce:gft,applyLocalForce:gft,applyImpulse:gft,applyLocalImpulse:gft,applyTorque:gft,applyLocalTorque:gft,setGroup:gft,getGroup:gft,addGroup:gft,removeGroup:gft,setMask:gft,getMask:gft,addMask:gft,removeMask:gft,isUsingCCD:gft,useCCD:gft},Tft={INITED:!1},wft={impl:null,collider:null,attachedRigidBody:null,initialize:gft,onLoad:gft,onEnable:gft,onDisable:gft,onDestroy:gft,setGroup:gft,getGroup:gft,addGroup:gft,removeGroup:gft,setMask:gft,getMask:gft,addMask:gft,removeMask:gft,setMaterial:gft,setAsTrigger:gft,setCenter:gft,getAABB:gft,getBoundingSphere:gft,updateSize:gft,updateRadius:gft,setRadius:gft,setCylinderHeight:gft,setDirection:gft,setHeight:gft,setShapeType:gft,setVertices:gft,setMesh:gft,setTerrain:gft,setNormal:gft,setConstant:gft,updateEventListener:gft};function xft(t){return Tft.INITED||(Tft.INITED=!0,Tft[0]=function(){return bft(pft.wrapper.BoxShape,2)?wft:new pft.wrapper.BoxShape},Tft[1]=function(){return bft(pft.wrapper.SphereShape,3)?wft:new pft.wrapper.SphereShape},Tft[2]=function(){return bft(pft.wrapper.CapsuleShape,4)?wft:new pft.wrapper.CapsuleShape},Tft[3]=function(){return bft(pft.wrapper.CylinderShape,6)?wft:new pft.wrapper.CylinderShape},Tft[4]=function(){return bft(pft.wrapper.ConeShape,7)?wft:new pft.wrapper.ConeShape},Tft[5]=function(){return bft(pft.wrapper.TrimeshShape,5)?wft:new pft.wrapper.TrimeshShape},Tft[8]=function(){return bft(pft.wrapper.TerrainShape,8)?wft:new pft.wrapper.TerrainShape},Tft[7]=function(){return bft(pft.wrapper.SimplexShape,9)?wft:new pft.wrapper.SimplexShape},Tft[6]=function(){return bft(pft.wrapper.PlaneShape,10)?wft:new pft.wrapper.PlaneShape}),Tft[t]()}const Cft={INITED:!1},Aft={impl:null,initialize:gft,onLoad:gft,onEnable:gft,onDisable:gft,onDestroy:gft,setEnableCollision:gft,setConnectedBody:gft,setPivotA:gft,setPivotB:gft,setAxis:gft,setSecondaryAxis:gft,setBreakForce:gft,setBreakTorque:gft,setConstraintMode:gft,setLinearLimit:gft,setAngularExtent:gft,setLinearSoftConstraint:gft,setLinearStiffness:gft,setLinearDamping:gft,setLinearRestitution:gft,setSwingSoftConstraint:gft,setTwistSoftConstraint:gft,setSwingStiffness:gft,setSwingDamping:gft,setSwingRestitution:gft,setTwistStiffness:gft,setTwistDamping:gft,setTwistRestitution:gft,setDriverMode:gft,setLinearMotorTarget:gft,setLinearMotorVelocity:gft,setLinearMotorForceLimit:gft,setAngularMotorTarget:gft,setAngularMotorVelocity:gft,setAngularMotorForceLimit:gft,setAutoPivotB:gft,setLimitEnabled:gft,setLowerLimit:gft,setUpperLimit:gft,setMotorEnabled:gft,setMotorVelocity:gft,setMotorForceLimit:gft};function Dft(t){return Cft.INITED||(Cft.INITED=!0,Cft[0]=function(){return bft(pft.wrapper.PointToPointConstraint,11)?Aft:new pft.wrapper.PointToPointConstraint},Cft[1]=function(){return bft(pft.wrapper.HingeConstraint,12)?Aft:new pft.wrapper.HingeConstraint},Cft[2]=function(){return bft(pft.wrapper.FixedConstraint,13)?Aft:new pft.wrapper.FixedConstraint},Cft[3]=function(){return bft(pft.wrapper.ConfigurableConstraint,14)?Aft:new pft.wrapper.ConfigurableConstraint}),Cft[t]()}const Eft={INITED:!1},Ift={initialize:gft,onLoad:gft,onEnable:gft,onDisable:gft,onDestroy:gft,onGround:gft,getPosition:gft,setPosition:gft,setStepOffset:gft,setSlopeLimit:gft,setContactOffset:gft,setDetectCollisions:gft,setOverlapRecovery:gft,setGroup:gft,getGroup:gft,addGroup:gft,removeGroup:gft,setMask:gft,getMask:gft,addMask:gft,removeMask:gft,move:gft,syncPhysicsToScene:gft,updateEventListener:gft,setHalfHeight:gft,setHalfSideExtent:gft,setHalfForwardExtent:gft,setRadius:gft,setHeight:gft};function Mft(t){return Eft.INITED||(Eft.INITED=!0,Eft[0]=function(){return bft(pft.wrapper.BoxCharacterController,15)?Ift:new pft.wrapper.BoxCharacterController},Eft[1]=function(){return bft(pft.wrapper.CapsuleCharacterController,16)?Ift:new pft.wrapper.CapsuleCharacterController}),Eft[t]()}function Pft(t,e){return(i=t,new Promise(((t,e)=>{try{i=`src/cocos-js/${i}`;t(e4.fileUtils.getDataFromFile(i))}catch(t){e(t)}}))).then((t=>WebAssembly.instantiate(t,e)));var i}let Oft={};const Rft={BODY_CACHE_NAME:"body",CCT_CACHE_NAME:"cct"};JA.onPostInfrastructureInitDelegate.add((function(){return Promise.resolve().then((()=>Promise.all([e.import("./bullet.release.wasm-C_3jgrSE.js").then((function(t){return t.b})),e.import("./bullet.release.wasm-mT4aJDLq.js")]).then((([{default:t},{default:e}])=>{return i=t,s=e,new Promise(((t,e)=>{const r=t=>`[bullet]: bullet wasm lib load failed: ${t}`;i({instantiateWasm(t,i){Pft(s,t).then((t=>{i(t.instance,t.module)})).catch((t=>e(r(t))))}}).then((t=>{I("[bullet]:bullet wasm lib loaded."),Oft=t,globalThis.Bullet=Oft})).then(t).catch((t=>e(r(t))))}));var i,s})))).catch((t=>{P(t)}))}));const Bft={type:"onTriggerEnter",selfCollider:null,otherCollider:null,impl:null},Fft={type:"onCollisionEnter",selfCollider:null,otherCollider:null,contacts:[],impl:null},Nft={type:"onControllerTriggerEnter",collider:null,characterController:null,impl:null};class Lft{constructor(){this.BT_TRANSFORM_0=Oft.Transform_new(),this.BT_TRANSFORM_1=Oft.Transform_new(),this.BT_V3_0=Oft.Vec3_new(0,0,0),this.BT_V3_1=Oft.Vec3_new(0,0,0),this.BT_V3_2=Oft.Vec3_new(0,0,0),this.BT_QUAT_0=Oft.Quat_new(0,0,0,1)}static get instance(){return null==Lft._instance&&(Lft._instance=new Lft),Lft._instance}static setWrapper(t,e,i){this.ROOT[e]||(this.ROOT[e]={}),this.ROOT[e][t]=i}static delWrapper(t,e){delete this.ROOT[e][t]}static getWrapper(t,e){return this.ROOT[e][t]}static isNotEmptyShape(t){return t!==Oft.EmptyShape_static()}}Lft._instance=void 0,Lft.ROOT={},Lft.world=null;const kft=new Ms,zft=new Ms,Uft=new Ms,Vft=new sr,jft=new sr,Hft=new vr;new vr;const Gft=new Ls;function Wft(t,e){return Oft.Vec3_set(t,e.x,e.y,e.z),t}function Xft(t,e){const i=Oft.HEAPF32.subarray(e/4,e/4+3);return t.x=i[0],t.y=i[1],t.z=i[2],t}function Yft(t,e){return Oft.Quat_set(t,e.x,e.y,e.z,e.w),t}function qft(t,e){const i=Oft.HEAPF32.subarray(e/4,e/4+4);return t.x=i[0],t.y=i[1],t.z=i[2],t.w=i[3],t}function $ft(t,e){const i=e.renderingSubMeshes.length;for(let s=0;s<i;s++){const i=e.renderingSubMeshes[s],r=i.geometricInfo;if(r){const e=i.primitiveMode,s=r.positions,n=r.indices,o=Lft.instance.BT_V3_0,a=Lft.instance.BT_V3_1,h=Lft.instance.BT_V3_2;if(7===e){const e=n.length;for(let i=0;i<e;i+=3){const e=3*n[i],r=3*n[i+1],l=3*n[i+2];Oft.Vec3_set(o,s[e],s[e+1],s[e+2]),Oft.Vec3_set(a,s[r],s[r+1],s[r+2]),Oft.Vec3_set(h,s[l],s[l+1],s[l+2]),Oft.TriangleMesh_addTriangle(t,o,a,h,!1)}}else if(8===e){const e=n.length-2;let i=0;for(let r=0;r<e;r+=1){const e=3*n[r-i],l=3*n[r+i+1],c=3*n[r+2];i=~i,Oft.Vec3_set(o,s[e],s[e+1],s[e+2]),Oft.Vec3_set(a,s[l],s[l+1],s[l+2]),Oft.Vec3_set(h,s[c],s[c+1],s[c+2]),Oft.TriangleMesh_addTriangle(t,o,a,h,!1)}}else if(9===e){const e=n.length-1,i=3*n[0];Oft.Vec3_set(o,s[i],s[i+1],s[i+2]);for(let i=1;i<e;i+=1){const e=3*n[i],r=3*n[i+1];Oft.Vec3_set(a,s[e],s[e+1],s[e+2]),Oft.Vec3_set(h,s[r],s[r+1],s[r+2]),Oft.TriangleMesh_addTriangle(t,o,a,h,!1)}}}}return t}function Kft(t,e){return t*e}var Zft,Qft,Jft,tyt,eyt,iyt,syt,ryt,nyt,oyt,ayt,hyt;Rft.CACHE=Lft;let lyt=(Zft=ah("cc.PhysicsMaterial"),Qft=Xh(We),Jft=Xh(We),tyt=Xh(We),eyt=Xh(We),Zft((hyt=class t extends fm{get friction(){return this._friction}set friction(e){Pi(this._friction,e)||(this._friction=e,this.emit(t.EVENT_UPDATE))}get rollingFriction(){return this._rollingFriction}set rollingFriction(e){Pi(this._rollingFriction,e)||(this._rollingFriction=e,this.emit(t.EVENT_UPDATE))}get spinningFriction(){return this._spinningFriction}set spinningFriction(e){Pi(this._spinningFriction,e)||(this._spinningFriction=e,this.emit(t.EVENT_UPDATE))}get restitution(){return this._restitution}set restitution(e){Pi(this._restitution,e)||(this._restitution=e,this.emit(t.EVENT_UPDATE))}constructor(){super(),this.id=void 0,this._friction=ryt&&ryt(),this._rollingFriction=nyt&&nyt(),this._spinningFriction=oyt&&oyt(),this._restitution=ayt&&ayt(),t.allMaterials.push(this),this.id=t._idCounter++,this._uuid||(this._uuid=`pm_${this.id}`)}clone(){const e=new t;return e._friction=this._friction,e._restitution=this._restitution,e._rollingFriction=this._rollingFriction,e._spinningFriction=this._spinningFriction,e}destroy(){if(super.destroy()){const e=t.allMaterials.indexOf(this);return e>=0&&t.allMaterials.splice(e,1),!0}return!1}setValues(e,i,s,r){const n=this._friction!==e||this._rollingFriction!==i||this._spinningFriction!==s||this._restitution!==r;this._friction=e,this._rollingFriction=i,this._spinningFriction=s,this._restitution=r,n&&this.emit(t.EVENT_UPDATE)}},hyt.allMaterials=[],hyt.EVENT_UPDATE="event_update",hyt._idCounter=0,s((syt=hyt).prototype,"friction",[Qft],Object.getOwnPropertyDescriptor(syt.prototype,"friction"),syt.prototype),s(syt.prototype,"rollingFriction",[Jft],Object.getOwnPropertyDescriptor(syt.prototype,"rollingFriction"),syt.prototype),s(syt.prototype,"spinningFriction",[tyt],Object.getOwnPropertyDescriptor(syt.prototype,"spinningFriction"),syt.prototype),s(syt.prototype,"restitution",[eyt],Object.getOwnPropertyDescriptor(syt.prototype,"restitution"),syt.prototype),ryt=Za(syt.prototype,"_friction",[vh],(function(){return.6})),nyt=Za(syt.prototype,"_rollingFriction",[vh],(function(){return 0})),oyt=Za(syt.prototype,"_spinningFriction",[vh],(function(){return 0})),ayt=Za(syt.prototype,"_restitution",[vh],(function(){return 0})),iyt=syt))||iyt);t({PhysicsMaterial:lyt,PhysicMaterial:lyt});class cyt{constructor(){this._hitPoint=new Ms,this._hitNormal=new Ms,this._distance=0,this._collider=null,this._closestHitFraction=0}get hitPoint(){return this._hitPoint}get distance(){return this._distance}get collider(){return this._collider}get hitNormal(){return this._hitNormal}get closestHitFraction(){return this._closestHitFraction}_assign(t,e,i,s,r){Ms.copy(this._hitPoint,t),Ms.copy(this._hitNormal,s),this._distance=e,this._collider=i,r&&(this._closestHitFraction=r)}clone(){const t=new cyt;return Ms.copy(t._hitPoint,this._hitPoint),Ms.copy(t._hitNormal,this._hitNormal),t._distance=this._distance,t._collider=this._collider,t._closestHitFraction=this._closestHitFraction,t}}t("PhysicsRayResult",cyt);class uyt extends cyt{constructor(...t){super(...t),this._id=0}get id(){return this._id}_assign(t,e,i,s,r=0){super._assign(t,e,i,s),this._id=r}clone(){const t=new uyt;return Ms.copy(t._hitPoint,this._hitPoint),Ms.copy(t._hitNormal,this._hitNormal),t._distance=this._distance,t._collider=this._collider,t._id=this._id,t}}t("PhysicsLineStripCastResult",uyt),a.internal.PhysicsGroup=m_t;const dyt=Se.querySettings.bind(Se);class _yt extends Bu{static get PHYSICS_NONE(){return!pft.id}static get PHYSICS_BUILTIN(){return"builtin"===pft.id}static get PHYSICS_CANNON(){return"cannon.js"===pft.id}static get PHYSICS_BULLET(){return"bullet"===pft.id}static get PHYSICS_PHYSX(){return"physx"===pft.id}static get PhysicsGroup(){return m_t}static get instance(){return _yt._instance}get enable(){return this._enable}set enable(t){this._enable=t}get allowSleep(){return this._allowSleep}set allowSleep(t){this._allowSleep=t,this.physicsWorld&&this.physicsWorld.setAllowSleep(t)}get maxSubSteps(){return this._maxSubSteps}set maxSubSteps(t){this._maxSubSteps=t}get fixedTimeStep(){return this._fixedTimeStep}set fixedTimeStep(t){this._fixedTimeStep=t}get gravity(){return this._gravity}set gravity(t){this._gravity.set(t),this.physicsWorld&&this.physicsWorld.setGravity(t)}get sleepThreshold(){return this._sleepThreshold}set sleepThreshold(t){this._sleepThreshold=t}get autoSimulation(){return this._autoSimulation}set autoSimulation(t){this._autoSimulation=t}get defaultMaterial(){return this._material}setDefaultPhysicsMaterial(t){this._material=t,this.physicsWorld.setDefaultMaterial(this._material),this._material.on(lyt.EVENT_UPDATE,this._updateMaterial,this)}initDefaultMaterial(){if(null!=this._material)return Promise.resolve();const t=iC.get("default-physics-material");if(!t)return G(9642),Promise.resolve();const e=dyt("physics","defaultMaterial");return e?new Promise(((t,i)=>{jx.loadAny(e,((e,s)=>!e&&s instanceof lyt?t(s):i(e)))})).then((t=>{this.setDefaultPhysicsMaterial(t)})).catch((i=>{M(i),j(9643,e),this.setDefaultPhysicsMaterial(t)})):(this.setDefaultPhysicsMaterial(t),Promise.resolve())}get physicsWorld(){return pft.physicsWorld}constructor(){super(),this.raycastClosestResult=new cyt,this.raycastResults=[],this.lineStripCastClosestResult=new uyt,this.lineStripCastResults=[],this.sweepCastClosestResult=new cyt,this.sweepCastResults=[],this.collisionMatrix=new s_t(1),this.minVolumeSize=1e-5,this.useNodeChains=!1,this._enable=!0,this._allowSleep=!0,this._maxSubSteps=1,this._subStepCount=0,this._fixedTimeStep=1/60,this._autoSimulation=!0,this._accumulator=0,this._sleepThreshold=.1,this._gravity=new Ms(0,-10,0),this._material=void 0,this.raycastOptions={group:-1,mask:-1,queryTrigger:!0,maxDistance:1e7},this.raycastResultPool=new So((()=>new cyt),1),this.sweepResultPool=new So((()=>new cyt),1)}postUpdate(t){if(this.physicsWorld)if(this._enable){if(this._autoSimulation){for(this._subStepCount=0,this._accumulator+=t,nC.emit("director_before_physics");this._subStepCount<this._maxSubSteps;){if(!(this._accumulator>=this._fixedTimeStep)){this.physicsWorld.syncSceneToPhysics();break}this.physicsWorld.syncSceneToPhysics(),this.physicsWorld.step(this._fixedTimeStep),this.physicsWorld.emitEvents(),this.physicsWorld.syncAfterEvents(),this._accumulator-=this._fixedTimeStep,this._subStepCount++}nC.emit("director_after_physics")}}else this.physicsWorld.syncSceneToPhysics()}resetConfiguration(t){const e=t?t.allowSleep:dyt("physics","allowSleep");"boolean"==typeof e&&(this._allowSleep=e);const i=t?t.fixedTimeStep:dyt("physics","fixedTimeStep");"number"==typeof i&&(this._fixedTimeStep=i);const s=t?t.maxSubSteps:dyt("physics","maxSubSteps");"number"==typeof s&&(this._maxSubSteps=s);const r=t?t.sleepThreshold:dyt("physics","sleepThreshold");"number"==typeof r&&(this._sleepThreshold=r);const n=t?t.autoSimulation:dyt("physics","autoSimulation");"boolean"==typeof n&&(this.autoSimulation=n);const o=t?t.gravity:dyt("physics","gravity");o&&Ms.copy(this._gravity,o);const a=t?t.collisionMatrix:dyt("physics","collisionMatrix");if(a)for(const t in a)this.collisionMatrix[""+(1<<parseInt(t))]=a[t];const h=t?t.collisionGroups:dyt("physics","collisionGroups");h&&h instanceof Array&&(h.forEach((t=>{m_t[t.name]=1<<t.index})),pe.update(m_t)),this.physicsWorld&&(this.physicsWorld.setGravity(this._gravity),this.physicsWorld.setAllowSleep(this._allowSleep))}resetAccumulator(t=0){this._accumulator=t}step(t,e,i){this.physicsWorld&&this.physicsWorld.step(t,e,i)}syncSceneToPhysics(){this.physicsWorld&&this.physicsWorld.syncSceneToPhysics()}emitEvents(){this.physicsWorld&&this.physicsWorld.emitEvents()}get debugDrawFlags(){return this.physicsWorld.debugDrawFlags}set debugDrawFlags(t){this.physicsWorld.debugDrawFlags=t}get debugDrawConstraintSize(){return this.physicsWorld.debugDrawConstraintSize}set debugDrawConstraintSize(t){this.physicsWorld.debugDrawConstraintSize=t}raycast(t,e=4294967295,i=1e7,s=!0){return!!this.physicsWorld&&(this.raycastResultPool.reset(),this.raycastResults.length=0,this.raycastOptions.mask=e>>>0,this.raycastOptions.maxDistance=i,this.raycastOptions.queryTrigger=s,this.physicsWorld.raycast(t,this.raycastOptions,this.raycastResultPool,this.raycastResults))}raycastClosest(t,e=4294967295,i=1e7,s=!0){return!!this.physicsWorld&&(this.raycastOptions.mask=e>>>0,this.raycastOptions.maxDistance=i,this.raycastOptions.queryTrigger=s,this.physicsWorld.raycastClosest(t,this.raycastOptions,this.raycastClosestResult))}lineStripCast(t,e=4294967295,i=1e7,s=!0){if(t.length<2)return!1;this.lineStripCastResults=[];let r=0;const n=new cn;for(let o=1;o<t.length&&!(r>i);++o){const i=t[o-1],a=t[o],h=new Ms;Ms.subtract(h,a,i);const l=Ms.len(h);if(r+=l,Ms.multiplyScalar(h,h,1/l),n.d=h,n.o=i,this.raycast(n,e,l,s))for(let t=0;t<this.raycastResults.length;t++){const e=this.raycastResults[t];if(0===t&&Ms.equals(i,e.hitPoint))continue;const s=new uyt;s._assign(e.hitPoint,e.distance,e.collider,e.hitNormal,o-1),this.lineStripCastResults.push(s)}}return this.lineStripCastResults.length>0}lineStripCastClosest(t,e=4294967295,i=1e7,s=!0){if(t.length<2)return!1;let r=0;const n=new cn;let o=!1;for(let a=1;a<t.length&&!(r>i);++a){const i=t[a-1],h=t[a],l=new Ms;Ms.subtract(l,h,i);const c=Ms.len(l);if(r+=c,Ms.multiplyScalar(l,l,1/c),n.d=l,n.o=i,o=this.raycastClosest(n,e,c,s),o){const t=this.raycastClosestResult,e=new uyt;e._assign(t.hitPoint,t.distance,t.collider,t.hitNormal,a-1),this.lineStripCastClosestResult=e;break}}return o}sweepBox(t,e,i,s=4294967295,r=1e7,n=!0){return!!this.physicsWorld&&(this.sweepResultPool.reset(),this.sweepCastResults.length=0,this.raycastOptions.mask=s>>>0,this.raycastOptions.maxDistance=r,this.raycastOptions.queryTrigger=n,this.physicsWorld.sweepBox(t,e,i,this.raycastOptions,this.sweepResultPool,this.sweepCastResults))}sweepBoxClosest(t,e,i,s=4294967295,r=1e7,n=!0){return!!this.physicsWorld&&(this.raycastOptions.mask=s>>>0,this.raycastOptions.maxDistance=r,this.raycastOptions.queryTrigger=n,this.physicsWorld.sweepBoxClosest(t,e,i,this.raycastOptions,this.sweepCastClosestResult))}sweepSphere(t,e,i=4294967295,s=1e7,r=!0){return!!this.physicsWorld&&(this.sweepResultPool.reset(),this.sweepCastResults.length=0,this.raycastOptions.mask=i>>>0,this.raycastOptions.maxDistance=s,this.raycastOptions.queryTrigger=r,this.physicsWorld.sweepSphere(t,e,this.raycastOptions,this.sweepResultPool,this.sweepCastResults))}sweepSphereClosest(t,e,i=4294967295,s=1e7,r=!0){return!!this.physicsWorld&&(this.raycastOptions.mask=i>>>0,this.raycastOptions.maxDistance=s,this.raycastOptions.queryTrigger=r,this.physicsWorld.sweepSphereClosest(t,e,this.raycastOptions,this.sweepCastClosestResult))}sweepCapsule(t,e,i,s,r=4294967295,n=1e7,o=!0){return!!this.physicsWorld&&(this.sweepResultPool.reset(),this.sweepCastResults.length=0,this.raycastOptions.mask=r>>>0,this.raycastOptions.maxDistance=n,this.raycastOptions.queryTrigger=o,this.physicsWorld.sweepCapsule(t,e,i,s,this.raycastOptions,this.sweepResultPool,this.sweepCastResults))}sweepCapsuleClosest(t,e,i,s,r=4294967295,n=1e7,o=!0){return!!this.physicsWorld&&(this.raycastOptions.mask=r>>>0,this.raycastOptions.maxDistance=n,this.raycastOptions.queryTrigger=o,this.physicsWorld.sweepCapsuleClosest(t,e,i,s,this.raycastOptions,this.sweepCastClosestResult))}_updateMaterial(){this.physicsWorld&&this.physicsWorld.setDefaultMaterial(this._material)}static constructAndRegister(){if(!_yt._instance){const t=this.doConstructAndRegister();t&&JA.onPostProjectInitDelegate.add(t.initDefaultMaterial.bind(t))}}static constructAndRegisterManually(){return Promise.resolve()}static doConstructAndRegister(){var t;if(null!==(t=dyt("physics","enabled"))&&void 0!==t&&!t)return null;if(!_yt._instance){const t=new _yt;_yt._instance=t,t.resetConfiguration(),mft(t),nC.registerSystem(_yt.ID,t,t.priority)}return _yt._instance}}var pyt,myt,gyt,fyt,yyt,byt,vyt,Syt,Tyt,wyt,xyt,Cyt,Ayt,Dyt,Eyt,Iyt;t("PhysicsSystem",_yt),_yt.ID="PHYSICS",_yt._instance=null,nC.once("director_init",(()=>{_yt.constructAndRegister()}));let Myt=(pyt=ah("cc.RigidBody"),myt=lh(-1),gyt=Xh(_yt.PhysicsGroup),fyt=Xh(o_t),pyt(yyt=ch(yyt=myt((Iyt=class extends Km{constructor(...t){super(...t),this._body=null,this._group=vyt&&vyt(),this._type=Syt&&Syt(),this._mass=Tyt&&Tyt(),this._allowSleep=wyt&&wyt(),this._linearDamping=xyt&&xyt(),this._angularDamping=Cyt&&Cyt(),this._useGravity=Ayt&&Ayt(),this._linearFactor=Dyt&&Dyt(),this._angularFactor=Eyt&&Eyt()}get group(){return this._group}set group(t){this._group=t,this._body&&this._body.getGroup()!==t&&this._body.setGroup(t)}get type(){return this._type}set type(t){this._type!==t&&(this._type=t,this._body&&this._body.setType(t))}get mass(){return this._mass}set mass(t){this._mass!==t&&(t=t<=0?1e-4:t,this._mass=t,this._body&&this._body.setMass(t))}get allowSleep(){return this._allowSleep}set allowSleep(t){this._allowSleep=t,this._body&&this._body.setAllowSleep(t)}get linearDamping(){return this._linearDamping}set linearDamping(t){this._linearDamping=t,this._body&&this._body.setLinearDamping(t)}get angularDamping(){return this._angularDamping}set angularDamping(t){this._angularDamping=t,this._body&&this._body.setAngularDamping(t)}get useGravity(){return this._useGravity}set useGravity(t){this._useGravity=t,this._body&&this._body.useGravity(t)}get linearFactor(){return this._linearFactor}set linearFactor(t){Ms.copy(this._linearFactor,t),this._body&&this._body.setLinearFactor(this._linearFactor)}get angularFactor(){return this._angularFactor}set angularFactor(t){Ms.copy(this._angularFactor,t),this._body&&this._body.setAngularFactor(this._angularFactor)}get sleepThreshold(){return this._isInitialized?this._body.getSleepThreshold():.1}set sleepThreshold(t){this._isInitialized&&this._body.setSleepThreshold(t)}get useCCD(){return!!this._isInitialized&&this._body.isUsingCCD()}set useCCD(t){this._isInitialized&&this._body.useCCD(t)}get isAwake(){return!!this._isInitialized&&this._body.isAwake}get isSleepy(){return!!this._isInitialized&&this._body.isSleepy}get isSleeping(){return!!this._isInitialized&&this._body.isSleeping}get isStatic(){return 2===this._type}set isStatic(t){t&&this.isStatic||!t&&!this.isStatic||(this.type=t?2:1)}get isDynamic(){return 1===this._type}set isDynamic(t){t&&this.isDynamic||!t&&!this.isDynamic||(this.type=t?1:4)}get isKinematic(){return 4===this._type}set isKinematic(t){t&&this.isKinematic||!t&&!this.isKinematic||(this.type=t?4:1)}get body(){return this._body}get _isInitialized(){const t=null===this._body;return t&&P("[Physics]: This component has not been call onLoad yet, please make sure the node has been added to the scene."),!t}onLoad(){pft.runInEditor&&(this._body=bft(pft.wrapper.RigidBody,1)?Sft:new pft.wrapper.RigidBody,this._body.initialize(this))}onEnable(){this._body&&this._body.onEnable()}onDisable(){this._body&&this._body.onDisable()}onDestroy(){this._body&&this._body.onDestroy()}applyForce(t,e){this._isInitialized&&this._body.applyForce(t,e)}applyLocalForce(t,e){this._isInitialized&&this._body.applyLocalForce(t,e)}applyImpulse(t,e){this._isInitialized&&this._body.applyImpulse(t,e)}applyLocalImpulse(t,e){this._isInitialized&&this._body.applyLocalImpulse(t,e)}applyTorque(t){this._isInitialized&&this._body.applyTorque(t)}applyLocalTorque(t){this._isInitialized&&this._body.applyLocalTorque(t)}wakeUp(){this._isInitialized&&this._body.wakeUp()}sleep(){this._isInitialized&&this._body.sleep()}clearState(){this._isInitialized&&this._body.clearState()}clearForces(){this._isInitialized&&this._body.clearForces()}clearVelocity(){this._isInitialized&&this._body.clearVelocity()}getLinearVelocity(t){this._isInitialized&&this._body.getLinearVelocity(t)}setLinearVelocity(t){this._isInitialized&&this._body.setLinearVelocity(t)}getAngularVelocity(t){this._isInitialized&&this._body.getAngularVelocity(t)}setAngularVelocity(t){this._isInitialized&&this._body.setAngularVelocity(t)}getGroup(){return this._isInitialized?this._body.getGroup():0}setGroup(t){this._isInitialized&&this._body.setGroup(t)}addGroup(t){this._isInitialized&&this._body.addGroup(t)}removeGroup(t){this._isInitialized&&this._body.removeGroup(t)}getMask(){return this._isInitialized?this._body.getMask():0}setMask(t){this._isInitialized&&this._body.setMask(t)}addMask(t){this._isInitialized&&this._body.addMask(t)}removeMask(t){this._isInitialized&&this._body.removeMask(t)}},Iyt.Type=o_t,s((byt=Iyt).prototype,"group",[gyt],Object.getOwnPropertyDescriptor(byt.prototype,"group"),byt.prototype),s(byt.prototype,"type",[fyt],Object.getOwnPropertyDescriptor(byt.prototype,"type"),byt.prototype),vyt=Za(byt.prototype,"_group",[vh],(function(){return 1})),Syt=Za(byt.prototype,"_type",[vh],(function(){return 1})),Tyt=Za(byt.prototype,"_mass",[vh],(function(){return 1})),wyt=Za(byt.prototype,"_allowSleep",[vh],(function(){return!0})),xyt=Za(byt.prototype,"_linearDamping",[vh],(function(){return.1})),Cyt=Za(byt.prototype,"_angularDamping",[vh],(function(){return.1})),Ayt=Za(byt.prototype,"_useGravity",[vh],(function(){return!0})),Dyt=Za(byt.prototype,"_linearFactor",[vh],(function(){return new Ms(1,1,1)})),Eyt=Za(byt.prototype,"_angularFactor",[vh],(function(){return new Ms(1,1,1)})),yyt=byt))||yyt)||yyt)||yyt);var Pyt,Oyt,Ryt,Byt,Fyt,Nyt,Lyt,kyt,zyt,Uyt,Vyt;t({RigidBody:Myt,RigidBodyComponent:Myt}),Myt||(Myt={},t({RigidBody:Myt,RigidBodyComponent:Myt}));let jyt=(Pyt=ah("cc.Collider"),Oyt=Xh(Myt),Ryt=Xh(lyt),Byt=Xh(Ms),Fyt=Xh(lyt),Pyt((Vyt=class extends(ko(Km)){get attachedRigidBody(){return Hyt(this.node)}get sharedMaterial(){return this._material}set sharedMaterial(t){this.material=t}get material(){return this._isSharedMaterial&&this._material&&(this._material.off(lyt.EVENT_UPDATE,this._updateMaterial,this),this._material=this._material.clone(),this._material.on(lyt.EVENT_UPDATE,this._updateMaterial,this),this._isSharedMaterial=!1),this._material}set material(t){this._shape?(t&&this._material?this._material.id!==t.id&&(this._material.off(lyt.EVENT_UPDATE,this._updateMaterial,this),t.on(lyt.EVENT_UPDATE,this._updateMaterial,this),this._isSharedMaterial=!1,this._material=t):t&&!this._material?(t.on(lyt.EVENT_UPDATE,this._updateMaterial,this),this._material=t):!t&&this._material&&(this._material.off(lyt.EVENT_UPDATE,this._updateMaterial,this),this._material=t),this._updateMaterial()):this._material=t}get isTrigger(){return this._isTrigger}set isTrigger(t){this._isTrigger=t,this._shape&&this._shape.setAsTrigger(this._isTrigger)}get center(){return this._center}set center(t){Ms.copy(this._center,t),this._shape&&this._shape.setCenter(this._center)}get shape(){return this._shape}get worldBounds(){return null==this._aabb&&(this._aabb=new Ca),this._shape&&this._shape.getAABB(this._aabb),this._aabb}get boundingSphere(){return null==this._boundingSphere&&(this._boundingSphere=new gn),this._shape&&this._shape.getBoundingSphere(this._boundingSphere),this._boundingSphere}get needTriggerEvent(){return this._needTriggerEvent}get needCollisionEvent(){return this._needCollisionEvent}get _isInitialized(){const t=null===this._shape;return t&&P("[Physics]: This component has not been call onLoad yet, please make sure the node has been added to the scene."),!t}constructor(t){super(),this.type=void 0,this._shape=null,this._aabb=null,this._boundingSphere=null,this._isSharedMaterial=!0,this._needTriggerEvent=!1,this._needCollisionEvent=!1,this._material=kyt&&kyt(),this._isTrigger=zyt&&zyt(),this._center=Uyt&&Uyt(),this.type=t}on(t,e,i,s){const r=super.on(t,e,i,s);return this._updateNeedEvent(t),r}off(t,e,i){super.off(t,e,i),this._updateNeedEvent()}once(t,e,i){const s=super.once(t,e,i);return this._updateNeedEvent(t),s}removeAll(t){super.removeAll(t),this._updateNeedEvent()}getGroup(){return this._isInitialized?this._shape.getGroup():0}setGroup(t){this._isInitialized&&this._shape.setGroup(t)}addGroup(t){this._isInitialized&&this._shape.addGroup(t)}removeGroup(t){this._isInitialized&&this._shape.removeGroup(t)}getMask(){return this._isInitialized?this._shape.getMask():0}setMask(t){this._isInitialized&&this._shape.setMask(t)}addMask(t){this._isInitialized&&this._shape.addMask(t)}removeMask(t){this._isInitialized&&this._shape.removeMask(t)}onLoad(){pft.runInEditor&&(this.sharedMaterial=this._material,this._shape=xft(this.type),this._shape.initialize(this),this._shape.onLoad())}onEnable(){this._shape&&this._shape.onEnable()}onDisable(){this._shape&&this._shape.onDisable()}onDestroy(){this._shape&&(this._needTriggerEvent=!1,this._needCollisionEvent=!1,this._shape.updateEventListener(),this._material&&this._material.off(lyt.EVENT_UPDATE,this._updateMaterial,this),this._shape.onDestroy()),this._boundingSphere&&this._boundingSphere.destroy()}_updateMaterial(){this._shape&&this._shape.setMaterial(this._material)}_updateNeedEvent(t){this.isValid&&(void 0!==t?("onCollisionEnter"!==t&&"onCollisionStay"!==t&&"onCollisionExit"!==t||(this._needCollisionEvent=!0),"onTriggerEnter"!==t&&"onTriggerStay"!==t&&"onTriggerExit"!==t&&"onControllerTriggerEnter"!==t&&"onControllerTriggerStay"!==t&&"onControllerTriggerExit"!==t||(this._needTriggerEvent=!0)):(this.hasEventListener("onTriggerEnter")||this.hasEventListener("onTriggerStay")||this.hasEventListener("onTriggerExit")||this.hasEventListener("onControllerTriggerEnter")||this.hasEventListener("onControllerTriggerStay")||this.hasEventListener("onControllerTriggerExit")||(this._needTriggerEvent=!1),this.hasEventListener("onCollisionEnter")||this.hasEventListener("onCollisionStay")||this.hasEventListener("onCollisionExit")||(this._needCollisionEvent=!1)),this._shape&&this._shape.updateEventListener())}},Vyt.Type=c_t,Vyt.Axis=a_t,s((Lyt=Vyt).prototype,"attachedRigidBody",[Oyt],Object.getOwnPropertyDescriptor(Lyt.prototype,"attachedRigidBody"),Lyt.prototype),s(Lyt.prototype,"sharedMaterial",[Ryt],Object.getOwnPropertyDescriptor(Lyt.prototype,"sharedMaterial"),Lyt.prototype),s(Lyt.prototype,"center",[Byt],Object.getOwnPropertyDescriptor(Lyt.prototype,"center"),Lyt.prototype),kyt=Za(Lyt.prototype,"_material",[Fyt],(function(){return null})),zyt=Za(Lyt.prototype,"_isTrigger",[vh],(function(){return!1})),Uyt=Za(Lyt.prototype,"_center",[vh],(function(){return new Ms})),Nyt=Lyt))||Nyt);function Hyt(t){const e=t.getComponent(Myt);return e&&e.isValid?e:null}var Gyt,Wyt,Xyt,Yyt,qyt;t({Collider:jyt,ColliderComponent:jyt}),jyt||(jyt={},t({Collider:jyt,ColliderComponent:jyt}));let $yt=(Gyt=ah("cc.BoxCollider"),Wyt=Xh(Ms),Gyt((Yyt=class extends jyt{get size(){return this._size}set size(t){Ms.strictEquals(this._size,t)||(Ms.copy(this._size,t),TH(this._size),this._shape&&this.shape.updateSize())}get shape(){return this._shape}constructor(){super(0),this._size=qyt&&qyt()}},s(Yyt.prototype,"size",[Wyt],Object.getOwnPropertyDescriptor(Yyt.prototype,"size"),Yyt.prototype),qyt=Za(Yyt.prototype,"_size",[vh],(function(){return new Ms(1,1,1)})),Xyt=Yyt))||Xyt);var Kyt,Zyt,Qyt;t({BoxCollider:$yt,BoxColliderComponent:$yt});let Jyt=ah("cc.SphereCollider")((Zyt=class extends jyt{get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=Math.abs(t),this._shape&&this.shape.updateRadius())}get shape(){return this._shape}constructor(){super(1),this._radius=Qyt&&Qyt()}},Qyt=Za(Zyt.prototype,"_radius",[vh],(function(){return.5})),Kyt=Zyt))||Kyt;var tbt,ebt,ibt,sbt,rbt,nbt,obt;t({SphereCollider:Jyt,SphereColliderComponent:Jyt});let abt=(tbt=ah("cc.CapsuleCollider"),ebt=Xh(a_t),tbt((sbt=class extends jyt{get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=Math.abs(t),this._shape&&this.shape.setRadius(t))}get cylinderHeight(){return this._cylinderHeight}set cylinderHeight(t){this._cylinderHeight!==t&&(this._cylinderHeight=Math.abs(t),this._shape&&this.shape.setCylinderHeight(t))}get direction(){return this._direction}set direction(t){(t=Math.floor(t))<0||t>2||this._direction!==t&&(this._direction=t,this._shape&&this.shape.setDirection(t))}get height(){return 2*this._radius+this._cylinderHeight}set height(t){let e=t-2*this._radius;e<0&&(e=0),this.cylinderHeight=e}get worldHeight(){return 2*this._radius*this._getRadiusScale()+this._cylinderHeight*this._getHeightScale()}get shape(){return this._shape}constructor(){super(2),this._radius=rbt&&rbt(),this._cylinderHeight=nbt&&nbt(),this._direction=obt&&obt()}_getRadiusScale(){if(null==this.node)return 1;const t=this.node.worldScale;return 1===this._direction?Math.abs(Ki(t.x,t.z)):0===this._direction?Math.abs(Ki(t.y,t.z)):Math.abs(Ki(t.x,t.y))}_getHeightScale(){if(null==this.node)return 1;const t=this.node.worldScale;return 1===this._direction?Math.abs(t.y):0===this._direction?Math.abs(t.x):Math.abs(t.z)}},s(sbt.prototype,"direction",[ebt],Object.getOwnPropertyDescriptor(sbt.prototype,"direction"),sbt.prototype),rbt=Za(sbt.prototype,"_radius",[vh],(function(){return.5})),nbt=Za(sbt.prototype,"_cylinderHeight",[vh],(function(){return 1})),obt=Za(sbt.prototype,"_direction",[vh],(function(){return 1})),ibt=sbt))||ibt);var hbt,lbt,cbt,ubt,dbt,_bt,pbt;t({CapsuleCollider:abt,CapsuleColliderComponent:abt});let mbt=(hbt=ah("cc.CylinderCollider"),lbt=Xh(a_t),hbt((ubt=class extends jyt{get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=Math.abs(t),this._shape&&this.shape.setRadius(t))}get height(){return this._height}set height(t){this._height!==t&&(this._height=Math.abs(t),this._shape&&this.shape.setHeight(t))}get direction(){return this._direction}set direction(t){this._direction!==t&&(t<0||t>2||(this._direction=t,this._shape&&this.shape.setDirection(t)))}get shape(){return this._shape}constructor(){super(3),this._radius=dbt&&dbt(),this._height=_bt&&_bt(),this._direction=pbt&&pbt()}},s(ubt.prototype,"direction",[lbt],Object.getOwnPropertyDescriptor(ubt.prototype,"direction"),ubt.prototype),dbt=Za(ubt.prototype,"_radius",[vh],(function(){return.5})),_bt=Za(ubt.prototype,"_height",[vh],(function(){return 2})),pbt=Za(ubt.prototype,"_direction",[vh],(function(){return 1})),cbt=ubt))||cbt);var gbt,fbt,ybt,bbt,vbt,Sbt,Tbt;t({CylinderCollider:mbt,CylinderColliderComponent:mbt});let wbt=t("ConeCollider",(gbt=ah("cc.ConeCollider"),fbt=Xh(a_t),gbt((bbt=class extends jyt{get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=Math.abs(t),this._shape&&this.shape.setRadius(t))}get height(){return this._height}set height(t){this._height!==t&&(t<0&&(t=0),this._height=t,this._shape&&this.shape.setHeight(t))}get direction(){return this._direction}set direction(t){this._direction!==t&&(t<0||t>2||(this._direction=t,this._shape&&this.shape.setDirection(t)))}get shape(){return this._shape}constructor(){super(4),this._radius=vbt&&vbt(),this._height=Sbt&&Sbt(),this._direction=Tbt&&Tbt()}},s(bbt.prototype,"direction",[fbt],Object.getOwnPropertyDescriptor(bbt.prototype,"direction"),bbt.prototype),vbt=Za(bbt.prototype,"_radius",[vh],(function(){return.5})),Sbt=Za(bbt.prototype,"_height",[vh],(function(){return 1})),Tbt=Za(bbt.prototype,"_direction",[vh],(function(){return 1})),ybt=bbt))||ybt));var xbt,Cbt,Abt,Dbt,Ebt,Ibt;let Mbt=(xbt=ah("cc.MeshCollider"),Cbt=Xh(uL),xbt((Dbt=class extends jyt{get mesh(){return this._mesh}set mesh(t){this._mesh!==t&&(this._mesh=t,this._shape&&this.shape.setMesh(this._mesh))}get convex(){return this._convex}set convex(t){this._convex!==t&&(this._convex=t,this._shape&&this._mesh&&this.shape.setMesh(this._mesh))}get shape(){return this._shape}onEnable(){if(super.onEnable(),this.node){const t=this.node.getComponent(Myt);t&&t.isValid&&1===t.type&&!this.convex&&j(9630,this.node.name)}}constructor(){super(5),this._mesh=Ebt&&Ebt(),this._convex=Ibt&&Ibt()}},s(Dbt.prototype,"mesh",[Cbt],Object.getOwnPropertyDescriptor(Dbt.prototype,"mesh"),Dbt.prototype),Ebt=Za(Dbt.prototype,"_mesh",[vh],(function(){return null})),Ibt=Za(Dbt.prototype,"_convex",[vh],(function(){return!1})),Abt=Dbt))||Abt);var Pbt,Obt,Rbt,Bbt,Fbt,Nbt;t({MeshCollider:Mbt,MeshColliderComponent:Mbt});let Lbt=t("ConstantForce",ah("cc.ConstantForce")(Pbt=hh(Myt)(Pbt=ch((Obt=class extends Km{constructor(...t){super(...t),this._rigidBody=null,this._force=Rbt&&Rbt(),this._localForce=Bbt&&Bbt(),this._torque=Fbt&&Fbt(),this._localTorque=Nbt&&Nbt(),this._mask=0}get force(){return this._force}set force(t){Ms.copy(this._force,t),this._maskUpdate(this._force,1)}get localForce(){return this._localForce}set localForce(t){Ms.copy(this._localForce,t),this._maskUpdate(this.localForce,2)}get torque(){return this._torque}set torque(t){Ms.copy(this._torque,t),this._maskUpdate(this._torque,4)}get localTorque(){return this._localTorque}set localTorque(t){Ms.copy(this._localTorque,t),this._maskUpdate(this._localTorque,8)}onLoad(){this._rigidBody=this.node.getComponent(Myt),this._maskUpdate(this._force,1),this._maskUpdate(this._localForce,2),this._maskUpdate(this._torque,4),this._maskUpdate(this._localTorque,8)}lateUpdate(t){null!=this._rigidBody&&0!==this._mask&&(1&this._mask&&this._rigidBody.applyForce(this._force),2&this._mask&&this._rigidBody.applyLocalForce(this.localForce),4&this._mask&&this._rigidBody.applyTorque(this._torque),8&this._mask&&this._rigidBody.applyLocalTorque(this._localTorque))}_maskUpdate(t,e){t.strictEquals(Ms.ZERO)?this._mask&=~e:this._mask|=e}},Rbt=Za(Obt.prototype,"_force",[vh],(function(){return new Ms})),Bbt=Za(Obt.prototype,"_localForce",[vh],(function(){return new Ms})),Fbt=Za(Obt.prototype,"_torque",[vh],(function(){return new Ms})),Nbt=Za(Obt.prototype,"_localTorque",[vh],(function(){return new Ms})),Pbt=Obt))||Pbt)||Pbt)||Pbt);var kbt,zbt,Ubt,Vbt,jbt,Hbt,Gbt,Wbt,Xbt,Ybt,qbt,$bt;t("TERRAIN_MAX_LEVELS",4);const Kbt=t("TERRAIN_MAX_BLEND_LAYERS",4),Zbt=t("TERRAIN_MAX_LAYER_COUNT",256),Qbt=t("TERRAIN_BLOCK_TILE_COMPLEXITY",32),Jbt=t("TERRAIN_BLOCK_VERTEX_COMPLEXITY",33),tvt=t("TERRAIN_BLOCK_VERTEX_SIZE",8),evt=t("TERRAIN_HEIGHT_BASE",32768),ivt=t("TERRAIN_HEIGHT_FACTORY",1/128),svt=t("TERRAIN_HEIGHT_FACTORY_V7",1/512),rvt=t("TERRAIN_HEIGHT_FMIN",-32768*ivt),nvt=t("TERRAIN_HEIGHT_FMAX",(65535-evt)*ivt),ovt=(t("TERRAIN_NORTH_INDEX",0),t("TERRAIN_SOUTH_INDEX",1),t("TERRAIN_WEST_INDEX",2),t("TERRAIN_EAST_INDEX",3),t("TERRAIN_DATA_VERSION",16842753)),avt=t("TERRAIN_DATA_VERSION2",16842754),hvt=t("TERRAIN_DATA_VERSION3",16842755),lvt=t("TERRAIN_DATA_VERSION4",16842756),cvt=t("TERRAIN_DATA_VERSION5",16842757),uvt=t("TERRAIN_DATA_VERSION6",16842758),dvt=t("TERRAIN_DATA_VERSION7",16842759),_vt=t("TERRAIN_DATA_VERSION8",16842760),pvt=t("TERRAIN_DATA_VERSION_DEFAULT",16843025);class mvt{constructor(){this.length=0,this.buffer=new Uint8Array(2048),this._buffView=new DataView(this.buffer.buffer),this._seekPos=0}reserve(t){if(this.buffer.byteLength>t)return;let e=this.buffer.byteLength;for(;e<t;)e+=e;const i=new Uint8Array(e);for(let t=0;t<this.length;++t)i[t]=this.buffer[t];this.buffer=i,this._buffView=new DataView(this.buffer.buffer)}assign(t){this.buffer=t,this.length=t.length,this._seekPos=t.byteOffset,this._buffView=new DataView(t.buffer)}writeInt8(t){this.reserve(this.length+1),this._buffView.setInt8(this.length,t),this.length+=1}writeInt16(t){this.reserve(this.length+2),this._buffView.setInt16(this.length,t,!0),this.length+=2}writeInt32(t){this.reserve(this.length+4),this._buffView.setInt32(this.length,t,!0),this.length+=4}writeIntArray(t){this.reserve(this.length+4*t.length);for(let e=0;e<t.length;++e)this._buffView.setInt32(this.length+4*e,t[e],!0);this.length+=4*t.length}writeFloat(t){this.reserve(this.length+4),this._buffView.setFloat32(this.length,t,!0),this.length+=4}writeFloatArray(t){this.reserve(this.length+4*t.length);for(let e=0;e<t.length;++e)this._buffView.setFloat32(this.length+4*e,t[e],!0);this.length+=4*t.length}writeDouble(t){this.reserve(this.length+8),this._buffView.setFloat64(this.length,t,!0),this.length+=8}writeDoubleArray(t){this.reserve(this.length+8*t.length);for(let e=0;e<t.length;++e)this._buffView.setFloat64(this.length+8*e,t[e],!0);this.length+=8*t.length}writeString(t){this.reserve(this.length+t.length+4),this._buffView.setInt32(this.length,t.length,!0);for(let e=0;e<t.length;++e)this._buffView.setInt8(this.length+4+e,t.charCodeAt(e));this.length+=t.length+4}readInt8(){const t=this._buffView.getInt8(this._seekPos);return this._seekPos+=1,t}readInt16(){const t=this._buffView.getInt16(this._seekPos,!0);return this._seekPos+=2,t}readInt(){const t=this._buffView.getInt32(this._seekPos,!0);return this._seekPos+=4,t}readIntArray(t){for(let e=0;e<t.length;++e)t[e]=this._buffView.getInt32(this._seekPos+4*e,!0);return this._seekPos+=4*t.length,t}readFloat(){const t=this._buffView.getFloat32(this._seekPos,!0);return this._seekPos+=4,t}readFloatArray(t){for(let e=0;e<t.length;++e)t[e]=this._buffView.getFloat32(this._seekPos+4*e,!0);return this._seekPos+=4*t.length,t}readDouble(){const t=this._buffView.getFloat64(this._seekPos,!0);return this._seekPos+=8,t}readDoubleArray(t){for(let e=0;e<t.length;++e)t[e]=this._buffView.getFloat64(this._seekPos+4*e,!0);return this._seekPos+=8*t.length,t}readString(){const t=this.readInt();let e="";for(let i=0;i<t;++i)e+=String.fromCharCode(this.readInt8());return e}}let gvt=t("TerrainLayerInfo",ah("cc.TerrainLayerInfo")((zbt=class{constructor(){this.slot=Ubt&&Ubt(),this.tileSize=Vbt&&Vbt(),this.detailMap=jbt&&jbt(),this.normalMap=Hbt&&Hbt(),this.roughness=Gbt&&Gbt(),this.metallic=Wbt&&Wbt()}},Ubt=Za(zbt.prototype,"slot",[vh],(function(){return 0})),Vbt=Za(zbt.prototype,"tileSize",[vh],(function(){return 1})),jbt=Za(zbt.prototype,"detailMap",[vh],(function(){return null})),Hbt=Za(zbt.prototype,"normalMap",[vh],(function(){return null})),Gbt=Za(zbt.prototype,"roughness",[vh],(function(){return 1})),Wbt=Za(zbt.prototype,"metallic",[vh],(function(){return 0})),kbt=zbt))||kbt),fvt=t("TerrainLayerBinaryInfo",ah("cc.TerrainLayerBinaryInfo")(Xbt=class{constructor(){this.slot=0,this.tileSize=1,this.roughness=1,this.metallic=0,this.detailMapId="",this.normalMapId=""}})||Xbt),yvt=t("TerrainAsset",ah("cc.TerrainAsset")((qbt=class extends fm{constructor(){super(),this._version=0,this._data=null,this._tileSize=1,this._blockCount=[1,1],this._weightMapSize=128,this._lightMapSize=128,this._heights=new Uint16Array,this._normals=new Float32Array,this._weights=new Uint8Array,this._layerBuffer=[-1,-1,-1,-1],this._layerBinaryInfos=[],this._layerInfos=$bt&&$bt()}get _nativeAsset(){return this._data.buffer}set _nativeAsset(t){this._data&&this._data.byteLength===t.byteLength?this._data.set(new Uint8Array(t)):this._data=new Uint8Array(t),this._loadNativeData(this._data)}get version(){return this._version}set tileSize(t){this._tileSize=t}get tileSize(){return this._tileSize}set blockCount(t){this._blockCount=t}get blockCount(){return this._blockCount}set lightMapSize(t){this._lightMapSize=t}get lightMapSize(){return this._lightMapSize}set weightMapSize(t){this._weightMapSize=t}get weightMapSize(){return this._weightMapSize}set heights(t){this._heights=t}get heights(){return this._heights}set normals(t){this._normals=t}get normals(){return this._normals}set weights(t){this._weights=t}get weights(){return this._weights}set layerBuffer(t){this._layerBuffer=t}get layerBuffer(){return this._layerBuffer}set layerInfos(t){this._layerInfos=t}get layerInfos(){return this._layerInfos}get layerBinaryInfos(){return this._layerBinaryInfos}getLayer(t,e,i){const s=4*(e*this.blockCount[0]+t)+i;return t<this.blockCount[0]&&e<this.blockCount[1]&&s<this._layerBuffer.length?this._layerBuffer[s]:-1}getHeight(t,e){const i=this._blockCount[0]*Qbt+1;return(this._heights[e*i+t]-evt)*ivt}getVertexCountI(){return this._blockCount.length<1?0:this._blockCount[0]*Qbt+1}getVertexCountJ(){return this._blockCount.length<2?0:this._blockCount[1]*Qbt+1}_setNativeData(t){this._data=t}_loadNativeData(t){if(!t||0===t.length)return!1;const e=new mvt;if(e.assign(t),this._version=e.readInt(),this._version===pvt)return!0;if(this._version!==ovt&&this._version!==avt&&this._version!==hvt&&this._version!==lvt&&this._version!==cvt&&this._version!==uvt&&this._version!==dvt&&this._version!==_vt)return!1;this._version>=dvt?this.tileSize=e.readDouble():this.tileSize=e.readFloat(),this.tileSize=Math.floor(100*this.tileSize)/100,e.readIntArray(this._blockCount),this.weightMapSize=e.readInt16(),this.lightMapSize=e.readInt16();const i=e.readInt();this.heights=new Uint16Array(i);for(let t=0;t<this.heights.length;++t)this.heights[t]=e.readInt16();if(this._version<_vt)for(let t=0;t<this.heights.length;++t){const e=(this._heights[t]-evt)*svt,i=evt+e/ivt;this.heights[t]=i}if(this._version>=uvt){const t=e.readInt();this.normals=new Float32Array(t);for(let t=0;t<this.normals.length;++t)this.normals[t]=e.readFloat()}const s=e.readInt();this.weights=new Uint8Array(s);for(let t=0;t<this.weights.length;++t)this.weights[t]=e.readInt8();if(this._version>=avt){const t=e.readInt();this.layerBuffer=new Array(t);for(let t=0;t<this.layerBuffer.length;++t)this.layerBuffer[t]=e.readInt16()}if(this._version>=hvt){const t=e.readInt();this._layerBinaryInfos=new Array(t);for(let t=0;t<this._layerBinaryInfos.length;++t)this._layerBinaryInfos[t]=new fvt,this._layerBinaryInfos[t].slot=e.readInt(),this._version>=dvt?this._layerBinaryInfos[t].tileSize=e.readDouble():this._layerBinaryInfos[t].tileSize=e.readFloat(),this._layerBinaryInfos[t].detailMapId=e.readString(),this._version>=lvt&&(this._layerBinaryInfos[t].normalMapId=e.readString(),this._version>=dvt?(this._layerBinaryInfos[t].roughness=e.readDouble(),this._layerBinaryInfos[t].metallic=e.readDouble()):(this._layerBinaryInfos[t].roughness=e.readFloat(),this._layerBinaryInfos[t].metallic=e.readFloat()))}return!0}_exportNativeData(){const t=new mvt;t.writeInt32(_vt),t.writeDouble(this.tileSize),t.writeIntArray(this._blockCount),t.writeInt16(this.weightMapSize),t.writeInt16(this.lightMapSize),t.writeInt32(this.heights.length);for(let e=0;e<this.heights.length;++e)t.writeInt16(this.heights[e]);t.writeInt32(this.normals.length);for(let e=0;e<this.normals.length;++e)t.writeFloat(this.normals[e]);t.writeInt32(this.weights.length);for(let e=0;e<this.weights.length;++e)t.writeInt8(this.weights[e]);t.writeInt32(this.layerBuffer.length);for(let e=0;e<this.layerBuffer.length;++e)t.writeInt16(this.layerBuffer[e]);const e=[];e.length=this.layerInfos.length;for(let t=0;t<e.length;++t){const i=this.layerInfos[t],s=new fvt;s.slot=t,s.tileSize=i.tileSize,s.detailMapId=i.detailMap?i.detailMap._uuid:"",s.normalMapId=i.normalMap?i.normalMap._uuid:"",s.metallic=i.metallic,s.roughness=i.roughness,e[t]=s}t.writeInt32(e.length);for(let i=0;i<e.length;++i)t.writeInt32(e[i].slot),t.writeDouble(e[i].tileSize),t.writeString(e[i].detailMapId),t.writeString(e[i].normalMapId),t.writeDouble(e[i].roughness),t.writeDouble(e[i].metallic);return t.buffer}_exportDefaultNativeData(){const t=new mvt;return t.writeInt32(pvt),t.buffer}},$bt=Za(qbt.prototype,"_layerInfos",[vh],(function(){return[]})),Ybt=qbt))||Ybt);var bvt,vvt,Svt,Tvt,wvt;let xvt=t("TerrainCollider",(bvt=ah("cc.TerrainCollider"),vvt=Xh(yvt),bvt((Tvt=class extends jyt{get terrain(){return this._terrain}set terrain(t){this._terrain=t,this._shape&&this.shape.setTerrain(this._terrain)}get shape(){return this._shape}onEnable(){if(super.onEnable(),this.node){const t=this.node.getComponent(Myt);t&&t.isValid&&1===t.type&&j(9630,this.node.name)}}constructor(){super(8),this._terrain=wvt&&wvt()}},s(Tvt.prototype,"terrain",[vvt],Object.getOwnPropertyDescriptor(Tvt.prototype,"terrain"),Tvt.prototype),wvt=Za(Tvt.prototype,"_terrain",[vh],(function(){return null})),Svt=Tvt))||Svt));var Cvt,Avt,Dvt,Evt,Ivt,Mvt,Pvt;let Ovt=t("SimplexCollider",(Cvt=ah("cc.SimplexCollider"),Avt=Xh(l_t),Cvt(((Pvt=class extends jyt{get shapeType(){return this._shapeType}set shapeType(t){this._shapeType=t,this._shape&&this.shape.setShapeType(t)}get vertex0(){return this._vertices[0]}set vertex0(t){Ms.copy(this._vertices[0],t),this.updateVertices()}get vertex1(){return this._vertices[1]}set vertex1(t){Ms.copy(this._vertices[1],t),this.updateVertices()}get vertex2(){return this._vertices[2]}set vertex2(t){Ms.copy(this._vertices[2],t),this.updateVertices()}get vertex3(){return this._vertices[3]}set vertex3(t){Ms.copy(this._vertices[3],t),this.updateVertices()}get shape(){return this._shape}get vertices(){return this._vertices}constructor(){super(7),this._shapeType=Ivt&&Ivt(),this._vertices=Mvt&&Mvt()}updateVertices(){this._shape&&this.shape.setVertices(this._vertices)}}).ESimplexType=l_t,s((Evt=Pvt).prototype,"shapeType",[Avt],Object.getOwnPropertyDescriptor(Evt.prototype,"shapeType"),Evt.prototype),Ivt=Za(Evt.prototype,"_shapeType",[vh],(function(){return 4})),Mvt=Za(Evt.prototype,"_vertices",[vh],(function(){return[new Ms(0,0,0),new Ms(0,0,1),new Ms(1,0,0),new Ms(0,1,0)]})),Dvt=Evt))||Dvt));var Rvt,Bvt,Fvt,Nvt,Lvt,kvt;Ovt||t("SimplexCollider",Ovt={});let zvt=t("PlaneCollider",(Rvt=ah("cc.PlaneCollider"),Bvt=Xh(Ms),Rvt((Nvt=class extends jyt{get normal(){return this._normal}set normal(t){Ms.strictEquals(this._normal,t)||(Ms.copy(this._normal,t),this._shape&&this.shape.setNormal(this._normal))}get constant(){return this._constant}set constant(t){this._constant!==t&&(this._constant=t,this._shape&&this.shape.setConstant(this._constant))}get shape(){return this._shape}onEnable(){if(super.onEnable(),this.node){const t=this.node.getComponent(Myt);t&&t.isValid&&1===t.type&&j(9630,this.node.name)}}constructor(){super(6),this._normal=Lvt&&Lvt(),this._constant=kvt&&kvt()}},s(Nvt.prototype,"normal",[Bvt],Object.getOwnPropertyDescriptor(Nvt.prototype,"normal"),Nvt.prototype),Lvt=Za(Nvt.prototype,"_normal",[vh],(function(){return new Ms(0,1,0)})),kvt=Za(Nvt.prototype,"_constant",[vh],(function(){return 0})),Fvt=Nvt))||Fvt));var Uvt,Vvt,jvt,Hvt,Gvt,Wvt,Xvt,Yvt,qvt,$vt;let Kvt=t("Constraint",(Uvt=ah("cc.Constraint"),Vvt=hh(Myt),jvt=Xh(Myt),Hvt=Xh(Myt),Gvt=Xh(Myt),Uvt(Wvt=Vvt(($vt=class extends(ko(Km)){get attachedBody(){return this.getComponent(Myt)}get connectedBody(){return this._connectedBody}set connectedBody(t){this._connectedBody=t,this._constraint&&this._constraint.setConnectedBody(t)}get enableCollision(){return this._enableCollision}set enableCollision(t){this._enableCollision=t,this._constraint&&this._constraint.setEnableCollision(t)}constructor(t){super(),this.TYPE=void 0,this._enableCollision=Yvt&&Yvt(),this._connectedBody=qvt&&qvt(),this._constraint=null,this.TYPE=t}onLoad(){pft.runInEditor&&(this._constraint=Dft(this.TYPE),this._constraint.initialize(this))}onEnable(){this._constraint&&this._constraint.onEnable()}onDisable(){this._constraint&&this._constraint.onDisable()}onDestroy(){this._constraint&&this._constraint.onDestroy()}},$vt.Type=u_t,s((Xvt=$vt).prototype,"attachedBody",[jvt],Object.getOwnPropertyDescriptor(Xvt.prototype,"attachedBody"),Xvt.prototype),s(Xvt.prototype,"connectedBody",[Hvt],Object.getOwnPropertyDescriptor(Xvt.prototype,"connectedBody"),Xvt.prototype),Yvt=Za(Xvt.prototype,"_enableCollision",[vh],(function(){return!0})),qvt=Za(Xvt.prototype,"_connectedBody",[Gvt],(function(){return null})),Wvt=Xvt))||Wvt)||Wvt));var Zvt,Qvt,Jvt,tSt,eSt,iSt,sSt,rSt,nSt,oSt,aSt,hSt,lSt,cSt,uSt,dSt,_St,pSt,mSt,gSt,fSt,ySt,bSt,vSt,SSt,TSt,wSt,xSt,CSt,ASt,DSt,ESt,ISt,MSt,PSt,OSt,RSt,BSt,FSt,NSt,LSt,kSt,zSt,USt,VSt,jSt;Kvt||t("Constraint",Kvt={});let HSt=(Zvt=ah("cc.HingeLimitData"),Qvt=Sh("enabled"),Jvt=Sh("upperLimit"),tSt=Sh("lowerLimit"),eSt=Xh(Xe),iSt=Xh(We),sSt=Xh(We),Zvt((nSt=class{constructor(){this._enabled=oSt&&oSt(),this._upperLimit=aSt&&aSt(),this._lowerLimit=hSt&&hSt()}get enabled(){return this._enabled}set enabled(t){this._enabled=t}get upperLimit(){return this._upperLimit}set upperLimit(t){this._upperLimit=t}get lowerLimit(){return this._lowerLimit}set lowerLimit(t){this._lowerLimit=t}},oSt=Za(nSt.prototype,"_enabled",[vh,Qvt],(function(){return!1})),aSt=Za(nSt.prototype,"_upperLimit",[vh,Jvt],(function(){return Number.MAX_VALUE})),hSt=Za(nSt.prototype,"_lowerLimit",[vh,tSt],(function(){return-Number.MAX_VALUE})),s(nSt.prototype,"enabled",[eSt],Object.getOwnPropertyDescriptor(nSt.prototype,"enabled"),nSt.prototype),s(nSt.prototype,"upperLimit",[iSt],Object.getOwnPropertyDescriptor(nSt.prototype,"upperLimit"),nSt.prototype),s(nSt.prototype,"lowerLimit",[sSt],Object.getOwnPropertyDescriptor(nSt.prototype,"lowerLimit"),nSt.prototype),rSt=nSt))||rSt),GSt=(lSt=ah("cc.HingeMotorData"),cSt=Sh("enabled"),uSt=Sh("motorVelocity"),dSt=Sh("motorForceLimit"),_St=Xh(Xe),pSt=Xh(We),mSt=Xh(We),lSt((fSt=class{constructor(){this._enabled=ySt&&ySt(),this._motorVelocity=bSt&&bSt(),this._motorForceLimit=vSt&&vSt()}get enabled(){return this._enabled}set enabled(t){this._enabled=t}get motorVelocity(){return this._motorVelocity}set motorVelocity(t){this._motorVelocity=t}get motorForceLimit(){return this._motorForceLimit}set motorForceLimit(t){this._motorForceLimit=t}},ySt=Za(fSt.prototype,"_enabled",[vh,cSt],(function(){return!1})),bSt=Za(fSt.prototype,"_motorVelocity",[vh,uSt],(function(){return 0})),vSt=Za(fSt.prototype,"_motorForceLimit",[vh,dSt],(function(){return 0})),s(fSt.prototype,"enabled",[_St],Object.getOwnPropertyDescriptor(fSt.prototype,"enabled"),fSt.prototype),s(fSt.prototype,"motorVelocity",[pSt],Object.getOwnPropertyDescriptor(fSt.prototype,"motorVelocity"),fSt.prototype),s(fSt.prototype,"motorForceLimit",[mSt],Object.getOwnPropertyDescriptor(fSt.prototype,"motorForceLimit"),fSt.prototype),gSt=fSt))||gSt),WSt=t("HingeConstraint",(SSt=ah("cc.HingeConstraint"),TSt=Xh(Ms),wSt=Xh(Ms),xSt=Xh(Ms),CSt=Xh(Xe),ASt=Xh(We),DSt=Xh(We),ESt=Xh(Xe),ISt=Xh(We),MSt=Xh(We),PSt=Sh("axisA"),OSt=Sh("pivotA"),RSt=Sh("pivotB"),BSt=Sh("limitData"),FSt=Sh("motorData"),SSt((s((LSt=class extends Kvt{get pivotA(){return this._pivotA}set pivotA(t){Ms.copy(this._pivotA,t),this.constraint.setPivotA(this._pivotA)}get pivotB(){return this._pivotB}set pivotB(t){Ms.copy(this._pivotB,t),this.constraint.setPivotB(this._pivotB)}get axis(){return this._axis}set axis(t){Ms.copy(this._axis,t),this.constraint.setAxis(this._axis)}get limitEnabled(){return this._limitData.enabled}set limitEnabled(t){this._limitData.enabled=t,this.constraint.setLimitEnabled(t)}get upperLimit(){return this._limitData.upperLimit}set upperLimit(t){this._limitData.upperLimit=t,this.constraint.setUpperLimit(t)}get lowerLimit(){return this._limitData.lowerLimit}set lowerLimit(t){this._limitData.lowerLimit=t,this.constraint.setLowerLimit(t)}get motorEnabled(){return this._motorData.enabled}set motorEnabled(t){this._motorData.enabled=t,this.constraint.setMotorEnabled(t)}get motorVelocity(){return this._motorData.motorVelocity}set motorVelocity(t){this._motorData.motorVelocity=t,this.constraint.setMotorVelocity(t)}get motorForceLimit(){return this._motorData.motorForceLimit}set motorForceLimit(t){this._motorData.motorForceLimit=t,this.constraint.setMotorForceLimit(t)}get constraint(){return this._constraint}constructor(){super(1),this._axis=kSt&&kSt(),this._pivotA=zSt&&zSt(),this._pivotB=USt&&USt(),this._limitData=VSt&&VSt(),this._motorData=jSt&&jSt()}}).prototype,"pivotA",[TSt],Object.getOwnPropertyDescriptor(LSt.prototype,"pivotA"),LSt.prototype),s(LSt.prototype,"pivotB",[wSt],Object.getOwnPropertyDescriptor(LSt.prototype,"pivotB"),LSt.prototype),s(LSt.prototype,"axis",[xSt],Object.getOwnPropertyDescriptor(LSt.prototype,"axis"),LSt.prototype),s(LSt.prototype,"limitEnabled",[CSt],Object.getOwnPropertyDescriptor(LSt.prototype,"limitEnabled"),LSt.prototype),s(LSt.prototype,"upperLimit",[ASt],Object.getOwnPropertyDescriptor(LSt.prototype,"upperLimit"),LSt.prototype),s(LSt.prototype,"lowerLimit",[DSt],Object.getOwnPropertyDescriptor(LSt.prototype,"lowerLimit"),LSt.prototype),s(LSt.prototype,"motorEnabled",[ESt],Object.getOwnPropertyDescriptor(LSt.prototype,"motorEnabled"),LSt.prototype),s(LSt.prototype,"motorVelocity",[ISt],Object.getOwnPropertyDescriptor(LSt.prototype,"motorVelocity"),LSt.prototype),s(LSt.prototype,"motorForceLimit",[MSt],Object.getOwnPropertyDescriptor(LSt.prototype,"motorForceLimit"),LSt.prototype),kSt=Za(LSt.prototype,"_axis",[vh,PSt],(function(){return new Ms})),zSt=Za(LSt.prototype,"_pivotA",[vh,OSt],(function(){return new Ms})),USt=Za(LSt.prototype,"_pivotB",[vh,RSt],(function(){return new Ms})),VSt=Za(LSt.prototype,"_limitData",[vh,BSt],(function(){return new HSt})),jSt=Za(LSt.prototype,"_motorData",[vh,FSt],(function(){return new GSt})),NSt=LSt))||NSt));var XSt,YSt,qSt,$St,KSt,ZSt,QSt,JSt,tTt;let eTt=t("FixedConstraint",(XSt=ah("cc.FixedConstraint"),YSt=Xh(We),qSt=Xh(We),$St=Sh("breakForce"),KSt=Sh("breakTorque"),XSt((s((QSt=class extends Kvt{get breakForce(){return this._breakForce}set breakForce(t){this._breakForce=t,this.constraint.setBreakForce(t)}get breakTorque(){return this._breakTorque}set breakTorque(t){this._breakTorque=t,this.constraint.setBreakTorque(t)}get constraint(){return this._constraint}constructor(){super(2),this._breakForce=JSt&&JSt(),this._breakTorque=tTt&&tTt()}}).prototype,"breakForce",[YSt],Object.getOwnPropertyDescriptor(QSt.prototype,"breakForce"),QSt.prototype),s(QSt.prototype,"breakTorque",[qSt],Object.getOwnPropertyDescriptor(QSt.prototype,"breakTorque"),QSt.prototype),JSt=Za(QSt.prototype,"_breakForce",[vh,$St],(function(){return 1e8})),tTt=Za(QSt.prototype,"_breakTorque",[vh,KSt],(function(){return 1e8})),ZSt=QSt))||ZSt));var iTt,sTt,rTt,nTt,oTt,aTt,hTt,lTt,cTt,uTt,dTt,_Tt,pTt,mTt,gTt,fTt,yTt,bTt,vTt,STt,TTt,wTt,xTt,CTt,ATt,DTt,ETt,ITt,MTt,PTt,OTt,RTt,BTt,FTt,NTt,LTt,kTt,zTt,UTt,VTt,jTt,HTt,GTt,WTt,XTt,YTt,qTt,$Tt,KTt,ZTt,QTt,JTt,twt,ewt,iwt,swt,rwt,nwt,owt,awt,hwt,lwt,cwt,uwt,dwt,_wt,pwt,mwt,gwt,fwt,ywt,bwt,vwt,Swt,Twt,wwt,xwt,Cwt,Awt,Dwt,Ewt,Iwt,Mwt,Pwt,Owt,Rwt,Bwt,Fwt,Nwt,Lwt,kwt,zwt,Uwt,Vwt,jwt,Hwt,Gwt,Wwt,Xwt,Ywt,qwt,$wt,Kwt,Zwt,Qwt,Jwt,txt,ext,ixt,sxt,rxt;let nxt=(iTt=ah("cc.LinearLimitSettings"),sTt=Xh(d_t),rTt=Xh(d_t),nTt=Xh(d_t),oTt=Xh(Ms),aTt=Xh(Ms),hTt=Xh(We),lTt=Xh(Xe),cTt=Xh(We),uTt=Xh(We),iTt((s((_Tt=class{get xMotion(){return this._xMotion}set xMotion(t){this._xMotion=t,this._impl.setConstraintMode(0,t)}get yMotion(){return this._yMotion}set yMotion(t){this._yMotion=t,this._impl.setConstraintMode(1,t)}get zMotion(){return this._zMotion}set zMotion(t){this._zMotion=t,this._impl.setConstraintMode(2,t)}get upper(){return this._upper}set upper(t){Ms.copy(this._upper,t);{const e=this.lower;this._impl.setLinearLimit(0,e.x,t.x),this._impl.setLinearLimit(1,e.y,t.y),this._impl.setLinearLimit(2,e.z,t.z)}}get lower(){return this._lower}set lower(t){Ms.copy(this._lower,t);{const e=this.upper;this._impl.setLinearLimit(0,t.x,e.x),this._impl.setLinearLimit(1,t.y,e.y),this._impl.setLinearLimit(2,t.z,e.z)}}get restitution(){return this._bounciness}set restitution(t){this._bounciness=t,this._impl.setLinearRestitution(t)}get enableSoftConstraint(){return this._enableSoftConstraint}set enableSoftConstraint(t){this._enableSoftConstraint=t,this._impl.setLinearSoftConstraint(t)}get stiffness(){return this._stiffness}set stiffness(t){this._stiffness=t,this._impl.setLinearStiffness(t)}get damping(){return this._damping}set damping(t){this._damping=t,this._impl.setLinearDamping(t)}set impl(t){this._impl=t}constructor(t){this._xMotion=pTt&&pTt(),this._yMotion=mTt&&mTt(),this._zMotion=gTt&&gTt(),this._upper=fTt&&fTt(),this._lower=yTt&&yTt(),this._enableSoftConstraint=bTt&&bTt(),this._bounciness=vTt&&vTt(),this._stiffness=STt&&STt(),this._damping=TTt&&TTt(),this._impl=void 0,this._impl=t}}).prototype,"xMotion",[sTt],Object.getOwnPropertyDescriptor(_Tt.prototype,"xMotion"),_Tt.prototype),s(_Tt.prototype,"yMotion",[rTt],Object.getOwnPropertyDescriptor(_Tt.prototype,"yMotion"),_Tt.prototype),s(_Tt.prototype,"zMotion",[nTt],Object.getOwnPropertyDescriptor(_Tt.prototype,"zMotion"),_Tt.prototype),s(_Tt.prototype,"upper",[oTt],Object.getOwnPropertyDescriptor(_Tt.prototype,"upper"),_Tt.prototype),s(_Tt.prototype,"lower",[aTt],Object.getOwnPropertyDescriptor(_Tt.prototype,"lower"),_Tt.prototype),s(_Tt.prototype,"restitution",[hTt],Object.getOwnPropertyDescriptor(_Tt.prototype,"restitution"),_Tt.prototype),s(_Tt.prototype,"enableSoftConstraint",[lTt],Object.getOwnPropertyDescriptor(_Tt.prototype,"enableSoftConstraint"),_Tt.prototype),s(_Tt.prototype,"stiffness",[cTt],Object.getOwnPropertyDescriptor(_Tt.prototype,"stiffness"),_Tt.prototype),s(_Tt.prototype,"damping",[uTt],Object.getOwnPropertyDescriptor(_Tt.prototype,"damping"),_Tt.prototype),pTt=Za(_Tt.prototype,"_xMotion",[vh],(function(){return 0})),mTt=Za(_Tt.prototype,"_yMotion",[vh],(function(){return 0})),gTt=Za(_Tt.prototype,"_zMotion",[vh],(function(){return 0})),fTt=Za(_Tt.prototype,"_upper",[vh],(function(){return new Ms})),yTt=Za(_Tt.prototype,"_lower",[vh],(function(){return new Ms})),bTt=Za(_Tt.prototype,"_enableSoftConstraint",[vh],(function(){return!1})),vTt=Za(_Tt.prototype,"_bounciness",[vh],(function(){return 0})),STt=Za(_Tt.prototype,"_stiffness",[vh],(function(){return 0})),TTt=Za(_Tt.prototype,"_damping",[vh],(function(){return 0})),dTt=_Tt))||dTt),oxt=(wTt=ah("cc.AngularLimitSettings"),xTt=Xh(d_t),CTt=Xh(d_t),ATt=Xh(d_t),DTt=Xh(We),ETt=Xh(We),ITt=Xh(We),MTt=Xh(We),PTt=Xh(We),OTt=Xh(Xe),RTt=Xh(We),BTt=Xh(We),FTt=Xh(Xe),NTt=Xh(We),LTt=Xh(We),wTt((s((zTt=class{get twistMotion(){return this._twistMotion}set twistMotion(t){this._twistMotion=t,this._impl.setConstraintMode(3,t)}get swingMotion1(){return this._swing1Motion}set swingMotion1(t){this._swing1Motion=t,this._impl.setConstraintMode(4,t)}get swingMotion2(){return this._swing2Motion}set swingMotion2(t){this._swing2Motion=t,this._impl.setConstraintMode(5,t)}get twistExtent(){return this._twistExtent}set twistExtent(t){this._twistExtent=t,this._impl.setAngularExtent(t,this.swingExtent1,this.swingExtent2)}get swingExtent1(){return this._swingExtent1}set swingExtent1(t){this._swingExtent1=t,this._impl.setAngularExtent(this.twistExtent,t,this.swingExtent2)}get swingExtent2(){return this._swingExtent2}set swingExtent2(t){this._swingExtent2=t,this._impl.setAngularExtent(this.twistExtent,this.swingExtent1,t)}get twistRestitution(){return this._twistBounciness}set twistRestitution(t){this._twistBounciness=t,this._impl.setTwistRestitution(t)}get swingRestitution(){return this._swingBounciness}set swingRestitution(t){this._swingBounciness=t,this._impl.setSwingRestitution(t)}get enableSoftConstraintTwist(){return this._enableSoftConstraintTwist}set enableSoftConstraintTwist(t){this._enableSoftConstraintTwist=t,this._impl.setTwistSoftConstraint(t)}get twistStiffness(){return this._twistStiffness}set twistStiffness(t){this._twistStiffness=t,this._impl.setTwistStiffness(t)}get twistDamping(){return this._twistDamping}set twistDamping(t){this._twistDamping=t,this._impl.setTwistDamping(t)}get enableSoftConstraintSwing(){return this._enableSoftConstraintSwing}set enableSoftConstraintSwing(t){this._enableSoftConstraintSwing=t,this._impl.setSwingSoftConstraint(t)}get swingStiffness(){return this._swingStiffness}set swingStiffness(t){this._swingStiffness=t,this._impl.setSwingStiffness(t)}get swingDamping(){return this._swingDamping}set swingDamping(t){this._swingDamping=t,this._impl.setSwingDamping(t)}set impl(t){this._impl=t}constructor(t){this._swing1Motion=UTt&&UTt(),this._swing2Motion=VTt&&VTt(),this._twistMotion=jTt&&jTt(),this._twistExtent=HTt&&HTt(),this._swingExtent1=GTt&&GTt(),this._swingExtent2=WTt&&WTt(),this._enableSoftConstraintSwing=XTt&&XTt(),this._swingBounciness=YTt&&YTt(),this._swingStiffness=qTt&&qTt(),this._swingDamping=$Tt&&$Tt(),this._enableSoftConstraintTwist=KTt&&KTt(),this._twistBounciness=ZTt&&ZTt(),this._twistStiffness=QTt&&QTt(),this._twistDamping=JTt&&JTt(),this._impl=void 0,this._impl=t}}).prototype,"twistMotion",[xTt],Object.getOwnPropertyDescriptor(zTt.prototype,"twistMotion"),zTt.prototype),s(zTt.prototype,"swingMotion1",[CTt],Object.getOwnPropertyDescriptor(zTt.prototype,"swingMotion1"),zTt.prototype),s(zTt.prototype,"swingMotion2",[ATt],Object.getOwnPropertyDescriptor(zTt.prototype,"swingMotion2"),zTt.prototype),s(zTt.prototype,"twistExtent",[DTt],Object.getOwnPropertyDescriptor(zTt.prototype,"twistExtent"),zTt.prototype),s(zTt.prototype,"swingExtent1",[ETt],Object.getOwnPropertyDescriptor(zTt.prototype,"swingExtent1"),zTt.prototype),s(zTt.prototype,"swingExtent2",[ITt],Object.getOwnPropertyDescriptor(zTt.prototype,"swingExtent2"),zTt.prototype),s(zTt.prototype,"twistRestitution",[MTt],Object.getOwnPropertyDescriptor(zTt.prototype,"twistRestitution"),zTt.prototype),s(zTt.prototype,"swingRestitution",[PTt],Object.getOwnPropertyDescriptor(zTt.prototype,"swingRestitution"),zTt.prototype),s(zTt.prototype,"enableSoftConstraintTwist",[OTt],Object.getOwnPropertyDescriptor(zTt.prototype,"enableSoftConstraintTwist"),zTt.prototype),s(zTt.prototype,"twistStiffness",[RTt],Object.getOwnPropertyDescriptor(zTt.prototype,"twistStiffness"),zTt.prototype),s(zTt.prototype,"twistDamping",[BTt],Object.getOwnPropertyDescriptor(zTt.prototype,"twistDamping"),zTt.prototype),s(zTt.prototype,"enableSoftConstraintSwing",[FTt],Object.getOwnPropertyDescriptor(zTt.prototype,"enableSoftConstraintSwing"),zTt.prototype),s(zTt.prototype,"swingStiffness",[NTt],Object.getOwnPropertyDescriptor(zTt.prototype,"swingStiffness"),zTt.prototype),s(zTt.prototype,"swingDamping",[LTt],Object.getOwnPropertyDescriptor(zTt.prototype,"swingDamping"),zTt.prototype),UTt=Za(zTt.prototype,"_swing1Motion",[vh],(function(){return 0})),VTt=Za(zTt.prototype,"_swing2Motion",[vh],(function(){return 0})),jTt=Za(zTt.prototype,"_twistMotion",[vh],(function(){return 0})),HTt=Za(zTt.prototype,"_twistExtent",[vh],(function(){return 0})),GTt=Za(zTt.prototype,"_swingExtent1",[vh],(function(){return 0})),WTt=Za(zTt.prototype,"_swingExtent2",[vh],(function(){return 0})),XTt=Za(zTt.prototype,"_enableSoftConstraintSwing",[vh],(function(){return!1})),YTt=Za(zTt.prototype,"_swingBounciness",[vh],(function(){return 0})),qTt=Za(zTt.prototype,"_swingStiffness",[vh],(function(){return 0})),$Tt=Za(zTt.prototype,"_swingDamping",[vh],(function(){return 0})),KTt=Za(zTt.prototype,"_enableSoftConstraintTwist",[vh],(function(){return!1})),ZTt=Za(zTt.prototype,"_twistBounciness",[vh],(function(){return 0})),QTt=Za(zTt.prototype,"_twistStiffness",[vh],(function(){return 0})),JTt=Za(zTt.prototype,"_twistDamping",[vh],(function(){return 0})),kTt=zTt))||kTt),axt=(twt=ah("cc.LinearDriverSettings"),ewt=Xh(__t),iwt=Xh(__t),swt=Xh(__t),rwt=Xh(Ms),nwt=Xh(Ms),owt=Xh(We),twt((s((hwt=class{get xDrive(){return this._xDrive}set xDrive(t){this._xDrive=t,this._impl.setDriverMode(0,t)}get yDrive(){return this._yDrive}set yDrive(t){this._yDrive=t,this._impl.setDriverMode(1,t)}get zDrive(){return this._zDrive}set zDrive(t){this._zDrive=t,this._impl.setDriverMode(2,t)}get targetPosition(){return this._target}set targetPosition(t){Ms.copy(this._target,t),this._impl.setLinearMotorTarget(t)}get targetVelocity(){return this._velocity}set targetVelocity(t){Ms.copy(this._velocity,t),this._impl.setLinearMotorVelocity(t)}get strength(){return this._strength}set strength(t){this._strength=t,this._impl.setLinearMotorForceLimit(t)}set impl(t){this._impl=t}constructor(t){this._target=lwt&&lwt(),this._velocity=cwt&&cwt(),this._xDrive=uwt&&uwt(),this._yDrive=dwt&&dwt(),this._zDrive=_wt&&_wt(),this._strength=pwt&&pwt(),this._impl=void 0,this._impl=t}}).prototype,"xDrive",[ewt],Object.getOwnPropertyDescriptor(hwt.prototype,"xDrive"),hwt.prototype),s(hwt.prototype,"yDrive",[iwt],Object.getOwnPropertyDescriptor(hwt.prototype,"yDrive"),hwt.prototype),s(hwt.prototype,"zDrive",[swt],Object.getOwnPropertyDescriptor(hwt.prototype,"zDrive"),hwt.prototype),s(hwt.prototype,"targetPosition",[rwt],Object.getOwnPropertyDescriptor(hwt.prototype,"targetPosition"),hwt.prototype),s(hwt.prototype,"targetVelocity",[nwt],Object.getOwnPropertyDescriptor(hwt.prototype,"targetVelocity"),hwt.prototype),s(hwt.prototype,"strength",[owt],Object.getOwnPropertyDescriptor(hwt.prototype,"strength"),hwt.prototype),lwt=Za(hwt.prototype,"_target",[vh],(function(){return new Ms})),cwt=Za(hwt.prototype,"_velocity",[vh],(function(){return new Ms})),uwt=Za(hwt.prototype,"_xDrive",[vh],(function(){return 0})),dwt=Za(hwt.prototype,"_yDrive",[vh],(function(){return 0})),_wt=Za(hwt.prototype,"_zDrive",[vh],(function(){return 0})),pwt=Za(hwt.prototype,"_strength",[vh],(function(){return 0})),awt=hwt))||awt),hxt=(mwt=ah("cc.AngularDriverSettings"),gwt=Xh(__t),fwt=Xh(__t),ywt=Xh(__t),bwt=Xh(Ms),vwt=Xh(Ms),Swt=Xh(We),mwt((s((wwt=class{get twistDrive(){return this._twistDrive}set twistDrive(t){this._twistDrive=t,this._impl.setDriverMode(3,t)}get swingDrive1(){return this._swingDrive1}set swingDrive1(t){this._swingDrive1=t,this._impl.setDriverMode(4,t)}get swingDrive2(){return this._swingDrive2}set swingDrive2(t){this._swingDrive2=t,this._impl.setDriverMode(5,t)}get targetOrientation(){return this._targetOrientation}set targetOrientation(t){Ms.copy(this._targetOrientation,t),this._impl.setAngularMotorTarget(t)}get targetVelocity(){return this._targetVelocity}set targetVelocity(t){Ms.copy(this._targetVelocity,t),this._impl.setAngularMotorVelocity(t)}get strength(){return this._strength}set strength(t){this._strength=t,this._impl.setAngularMotorForceLimit(t)}set impl(t){this._impl=t}constructor(t){this._swingDrive1=xwt&&xwt(),this._swingDrive2=Cwt&&Cwt(),this._twistDrive=Awt&&Awt(),this._targetOrientation=Dwt&&Dwt(),this._targetVelocity=Ewt&&Ewt(),this._strength=Iwt&&Iwt(),this._impl=void 0,this._impl=t}}).prototype,"twistDrive",[gwt],Object.getOwnPropertyDescriptor(wwt.prototype,"twistDrive"),wwt.prototype),s(wwt.prototype,"swingDrive1",[fwt],Object.getOwnPropertyDescriptor(wwt.prototype,"swingDrive1"),wwt.prototype),s(wwt.prototype,"swingDrive2",[ywt],Object.getOwnPropertyDescriptor(wwt.prototype,"swingDrive2"),wwt.prototype),s(wwt.prototype,"targetOrientation",[bwt],Object.getOwnPropertyDescriptor(wwt.prototype,"targetOrientation"),wwt.prototype),s(wwt.prototype,"targetVelocity",[vwt],Object.getOwnPropertyDescriptor(wwt.prototype,"targetVelocity"),wwt.prototype),s(wwt.prototype,"strength",[Swt],Object.getOwnPropertyDescriptor(wwt.prototype,"strength"),wwt.prototype),xwt=Za(wwt.prototype,"_swingDrive1",[vh],(function(){return 0})),Cwt=Za(wwt.prototype,"_swingDrive2",[vh],(function(){return 0})),Awt=Za(wwt.prototype,"_twistDrive",[vh],(function(){return 0})),Dwt=Za(wwt.prototype,"_targetOrientation",[vh],(function(){return new Ms})),Ewt=Za(wwt.prototype,"_targetVelocity",[vh],(function(){return new Ms})),Iwt=Za(wwt.prototype,"_strength",[vh],(function(){return 0})),Twt=wwt))||Twt),lxt=t("ConfigurableConstraint",(Mwt=ah("cc.ConfigurableConstraint"),Pwt=Xh(Ms),Owt=Xh(Ms),Rwt=Xh(Ms),Bwt=Xh(Ms),Fwt=Xh(Xe),Nwt=Xh(We),Lwt=Xh(We),kwt=Xh(nxt),zwt=Xh(oxt),Uwt=Xh(axt),Vwt=Xh(hxt),jwt=Sh("linearLimitSettings"),Hwt=Sh("angularLimitSettings"),Gwt=Sh("linearDriverSettings"),Wwt=Sh("angularDriverSettings"),Mwt((s((Ywt=class extends Kvt{get axis(){return this._axis}set axis(t){Ms.copy(this._axis,t),this.constraint.setAxis(this._axis)}get secondaryAxis(){return this._secondaryAxis}set secondaryAxis(t){Ms.copy(this._secondaryAxis,t),this.constraint.setSecondaryAxis(this._secondaryAxis)}get pivotA(){return this._pivotA}set pivotA(t){Ms.copy(this._pivotA,t),this.constraint.setPivotA(this._pivotA)}get pivotB(){return this._pivotB}set pivotB(t){Ms.copy(this._pivotB,t),this.constraint.setPivotB(this._pivotB)}get autoPivotB(){return this._autoPivotB}set autoPivotB(t){this._autoPivotB=t,this.constraint.setAutoPivotB(this._autoPivotB)}get breakForce(){return this._breakForce}set breakForce(t){this._breakForce=t,this.constraint.setBreakForce(t)}get breakTorque(){return this._breakTorque}set breakTorque(t){this._breakTorque=t,this.constraint.setBreakTorque(t)}get linearLimitSettings(){return this._linearLimitSettings}set linearLimitSettings(t){this._linearLimitSettings=t;{const e=this.constraint;e.setConstraintMode(0,t.xMotion),e.setConstraintMode(1,t.yMotion),e.setConstraintMode(2,t.zMotion);const i=t.upper,s=t.lower;e.setLinearLimit(0,s.x,i.x),e.setLinearLimit(1,s.y,i.y),e.setLinearLimit(2,s.z,i.z),e.setLinearSoftConstraint(t.enableSoftConstraint),e.setLinearDamping(t.damping),e.setLinearStiffness(t.stiffness),e.setLinearRestitution(t.restitution)}}get angularLimitSettings(){return this._angularLimitSettings}set angularLimitSettings(t){this._angularLimitSettings=t;{const e=this.constraint;e.setConstraintMode(3,t.twistMotion),e.setConstraintMode(4,t.swingMotion1),e.setConstraintMode(5,t.swingMotion2),e.setAngularExtent(t.twistExtent,t.swingExtent1,t.swingExtent2),e.setTwistRestitution(t.twistRestitution),e.setSwingRestitution(t.swingRestitution),e.setTwistSoftConstraint(t.enableSoftConstraintTwist),e.setSwingSoftConstraint(t.enableSoftConstraintSwing),e.setTwistDamping(t.twistDamping),e.setSwingDamping(t.swingDamping),e.setTwistStiffness(t.twistStiffness),e.setSwingStiffness(t.swingStiffness)}}get linearDriverSettings(){return this._linearDriverSettings}set linearDriverSettings(t){this._linearDriverSettings=t;{const e=this.constraint;e.setDriverMode(0,t.xDrive),e.setDriverMode(1,t.yDrive),e.setDriverMode(2,t.zDrive),e.setLinearMotorTarget(t.targetPosition),e.setLinearMotorVelocity(t.targetVelocity),e.setLinearMotorForceLimit(t.strength)}}get angularDriverSettings(){return this._angularDriverSettings}set angularDriverSettings(t){this._angularDriverSettings=t;{const e=this.constraint;e.setDriverMode(3,t.twistDrive),e.setDriverMode(4,t.swingDrive1),e.setDriverMode(5,t.swingDrive2),e.setAngularMotorTarget(t.targetOrientation),e.setAngularMotorVelocity(t.targetVelocity),e.setAngularMotorForceLimit(t.strength)}}get constraint(){return this._constraint}constructor(){super(3),this._breakForce=qwt&&qwt(),this._breakTorque=$wt&&$wt(),this._linearLimitSettings=Kwt&&Kwt(),this._angularLimitSettings=Zwt&&Zwt(),this._linearDriverSettings=Qwt&&Qwt(),this._angularDriverSettings=Jwt&&Jwt(),this._pivotA=txt&&txt(),this._pivotB=ext&&ext(),this._autoPivotB=ixt&&ixt(),this._axis=sxt&&sxt(),this._secondaryAxis=rxt&&rxt(),this._linearLimitSettings=new nxt(this.constraint),this._angularLimitSettings=new oxt(this.constraint),this._linearDriverSettings=new axt(this.constraint),this._angularDriverSettings=new hxt(this.constraint)}onLoad(){super.onLoad(),this.linearLimitSettings.impl=this.constraint,this.angularLimitSettings.impl=this.constraint,this.linearDriverSettings.impl=this.constraint,this.angularDriverSettings.impl=this.constraint}}).prototype,"axis",[Pwt],Object.getOwnPropertyDescriptor(Ywt.prototype,"axis"),Ywt.prototype),s(Ywt.prototype,"secondaryAxis",[Owt],Object.getOwnPropertyDescriptor(Ywt.prototype,"secondaryAxis"),Ywt.prototype),s(Ywt.prototype,"pivotA",[Rwt],Object.getOwnPropertyDescriptor(Ywt.prototype,"pivotA"),Ywt.prototype),s(Ywt.prototype,"pivotB",[Bwt],Object.getOwnPropertyDescriptor(Ywt.prototype,"pivotB"),Ywt.prototype),s(Ywt.prototype,"autoPivotB",[Fwt],Object.getOwnPropertyDescriptor(Ywt.prototype,"autoPivotB"),Ywt.prototype),s(Ywt.prototype,"breakForce",[Nwt],Object.getOwnPropertyDescriptor(Ywt.prototype,"breakForce"),Ywt.prototype),s(Ywt.prototype,"breakTorque",[Lwt],Object.getOwnPropertyDescriptor(Ywt.prototype,"breakTorque"),Ywt.prototype),s(Ywt.prototype,"linearLimitSettings",[kwt],Object.getOwnPropertyDescriptor(Ywt.prototype,"linearLimitSettings"),Ywt.prototype),s(Ywt.prototype,"angularLimitSettings",[zwt],Object.getOwnPropertyDescriptor(Ywt.prototype,"angularLimitSettings"),Ywt.prototype),s(Ywt.prototype,"linearDriverSettings",[Uwt],Object.getOwnPropertyDescriptor(Ywt.prototype,"linearDriverSettings"),Ywt.prototype),s(Ywt.prototype,"angularDriverSettings",[Vwt],Object.getOwnPropertyDescriptor(Ywt.prototype,"angularDriverSettings"),Ywt.prototype),qwt=Za(Ywt.prototype,"_breakForce",[vh],(function(){return 1e8})),$wt=Za(Ywt.prototype,"_breakTorque",[vh],(function(){return 1e8})),Kwt=Za(Ywt.prototype,"_linearLimitSettings",[vh,jwt],null),Zwt=Za(Ywt.prototype,"_angularLimitSettings",[vh,Hwt],null),Qwt=Za(Ywt.prototype,"_linearDriverSettings",[vh,Gwt],null),Jwt=Za(Ywt.prototype,"_angularDriverSettings",[vh,Wwt],null),txt=Za(Ywt.prototype,"_pivotA",[vh],(function(){return new Ms})),ext=Za(Ywt.prototype,"_pivotB",[vh],(function(){return new Ms})),ixt=Za(Ywt.prototype,"_autoPivotB",[vh],(function(){return!1})),sxt=Za(Ywt.prototype,"_axis",[vh],(function(){return new Ms(0,1,0)})),rxt=Za(Ywt.prototype,"_secondaryAxis",[vh],(function(){return new Ms(1,0,0)})),Xwt=Ywt))||Xwt));var cxt,uxt,dxt,_xt,pxt,mxt,gxt;let fxt=t("PointToPointConstraint",(cxt=ah("cc.PointToPointConstraint"),uxt=Xh(Ms),dxt=Xh(Ms),cxt((s((pxt=class extends Kvt{get pivotA(){return this._pivotA}set pivotA(t){Ms.copy(this._pivotA,t),this.constraint.setPivotA(this._pivotA)}get pivotB(){return this._pivotB}set pivotB(t){Ms.copy(this._pivotB,t),this.constraint.setPivotB(this._pivotB)}get constraint(){return this._constraint}constructor(){super(0),this._pivotA=mxt&&mxt(),this._pivotB=gxt&&gxt()}}).prototype,"pivotA",[uxt],Object.getOwnPropertyDescriptor(pxt.prototype,"pivotA"),pxt.prototype),s(pxt.prototype,"pivotB",[dxt],Object.getOwnPropertyDescriptor(pxt.prototype,"pivotB"),pxt.prototype),mxt=Za(pxt.prototype,"_pivotA",[vh],(function(){return new Ms})),gxt=Za(pxt.prototype,"_pivotB",[vh],(function(){return new Ms})),_xt=pxt))||_xt));var yxt,bxt,vxt,Sxt,Txt,wxt,xxt,Cxt,Axt,Dxt,Ext,Ixt,Mxt,Pxt,Oxt;let Rxt=t("CharacterController",(yxt=ah("cc.CharacterController"),bxt=Xh(_yt.PhysicsGroup),vxt=Xh(We),Sxt=Xh(We),Txt=Xh(We),wxt=Xh(We),xxt=Xh(Ms),yxt(Cxt=ch((Axt=class extends(ko(Km)){get group(){return this._group}set group(t){this._group=t,this._cct&&this._cct.getGroup()!==t&&this._cct.setGroup(t)}get minMoveDistance(){return this._minMoveDistance}set minMoveDistance(t){this._minMoveDistance!==t&&(this._minMoveDistance=Math.abs(t))}get stepOffset(){return this._stepOffset}set stepOffset(t){this._stepOffset!==t&&(this._stepOffset=Math.abs(t),this._cct&&this._cct.setStepOffset(t))}get slopeLimit(){return this._slopeLimit}set slopeLimit(t){this._slopeLimit!==t&&(this._slopeLimit=Math.abs(t),this._cct&&this._cct.setSlopeLimit(t))}get skinWidth(){return this._skinWidth}set skinWidth(t){this._skinWidth!==t&&(this._skinWidth=Math.abs(t),this._cct&&this._cct.setContactOffset(Math.max(1e-4,t)))}get center(){return this._center}set center(t){Ms.equals(this._center,t)||Ms.copy(this._center,t)}constructor(t){super(),this.type=void 0,this._cct=null,this._group=Dxt&&Dxt(),this._minMoveDistance=Ext&&Ext(),this._stepOffset=Ixt&&Ixt(),this._slopeLimit=Mxt&&Mxt(),this._skinWidth=Pxt&&Pxt(),this._center=Oxt&&Oxt(),this._initialized=!1,this._prevPos=new Ms,this._currentPos=new Ms,this._velocity=new Ms,this._centerWorldPosition=new Ms,this._needCollisionEvent=!1,this._needTriggerEvent=!1,this.type=t}get _isInitialized(){return!(null===this._cct||!this._initialized)}onLoad(){pft.runInEditor&&(this._cct=Mft(this.type),this._initialized=this._cct.initialize(this),this._cct.onLoad())}onEnable(){this._cct&&this._cct.onEnable()}onDisable(){this._cct&&this._cct.onDisable()}onDestroy(){this._cct&&(this._needCollisionEvent=!1,this._needTriggerEvent=!1,this._cct.updateEventListener(),this._cct.onDestroy(),this._cct=null)}get centerWorldPosition(){return this._isInitialized&&this._cct.getPosition(this._centerWorldPosition),this._centerWorldPosition}set centerWorldPosition(t){this._isInitialized&&this._cct.setPosition(t)}get velocity(){return this._velocity}get isGrounded(){return this._cct.onGround()}move(t){if(!this._isInitialized)return;this._prevPos.set(this.centerWorldPosition);const e=_yt.instance.fixedTimeStep;this._cct.move(t,this._minMoveDistance,e),this._currentPos.set(this.centerWorldPosition),this._velocity=this._currentPos.subtract(this._prevPos).multiplyScalar(1/e),this._cct.syncPhysicsToScene()}on(t,e,i,s){const r=super.on(t,e,i,s);return this._updateNeedEvent(t),r}off(t,e,i){super.off(t,e,i),this._updateNeedEvent()}once(t,e,i){const s=super.once(t,e,i);return this._updateNeedEvent(t),s}getGroup(){return this._isInitialized?this._cct.getGroup():0}setGroup(t){this._isInitialized&&this._cct.setGroup(t)}addGroup(t){this._isInitialized&&this._cct.addGroup(t)}removeGroup(t){this._isInitialized&&this._cct.removeGroup(t)}getMask(){return this._isInitialized?this._cct.getMask():0}setMask(t){this._isInitialized&&this._cct.setMask(t)}addMask(t){this._isInitialized&&this._cct.addMask(t)}removeMask(t){this._isInitialized&&this._cct.removeMask(t)}get needCollisionEvent(){return this._needCollisionEvent}get needTriggerEvent(){return this._needTriggerEvent}_updateNeedEvent(t){this.isValid&&(void 0!==t?("onControllerColliderHit"===t&&(this._needCollisionEvent=!0),"onControllerTriggerEnter"!==t&&"onControllerTriggerStay"!==t&&"onControllerTriggerExit"!==t||(this._needTriggerEvent=!0)):(this.hasEventListener("onControllerColliderHit")||(this._needCollisionEvent=!1),this.hasEventListener("onControllerTriggerEnter")||this.hasEventListener("onControllerTriggerStay")||this.hasEventListener("onControllerTriggerExit")||(this._needTriggerEvent=!1)),this._cct&&this._cct.updateEventListener())}},s(Axt.prototype,"group",[bxt],Object.getOwnPropertyDescriptor(Axt.prototype,"group"),Axt.prototype),s(Axt.prototype,"minMoveDistance",[vxt],Object.getOwnPropertyDescriptor(Axt.prototype,"minMoveDistance"),Axt.prototype),s(Axt.prototype,"stepOffset",[Sxt],Object.getOwnPropertyDescriptor(Axt.prototype,"stepOffset"),Axt.prototype),s(Axt.prototype,"slopeLimit",[Txt],Object.getOwnPropertyDescriptor(Axt.prototype,"slopeLimit"),Axt.prototype),s(Axt.prototype,"skinWidth",[wxt],Object.getOwnPropertyDescriptor(Axt.prototype,"skinWidth"),Axt.prototype),s(Axt.prototype,"center",[xxt],Object.getOwnPropertyDescriptor(Axt.prototype,"center"),Axt.prototype),Dxt=Za(Axt.prototype,"_group",[vh],(function(){return 1})),Ext=Za(Axt.prototype,"_minMoveDistance",[vh],(function(){return.001})),Ixt=Za(Axt.prototype,"_stepOffset",[vh],(function(){return.5})),Mxt=Za(Axt.prototype,"_slopeLimit",[vh],(function(){return 45})),Pxt=Za(Axt.prototype,"_skinWidth",[vh],(function(){return.01})),Oxt=Za(Axt.prototype,"_center",[vh],(function(){return new Ms})),Cxt=Axt))||Cxt)||Cxt));var Bxt,Fxt,Nxt,Lxt,kxt,zxt,Uxt,Vxt,jxt,Hxt;new Ms(0,0,0);let Gxt=t("BoxCharacterController",(Bxt=ah("cc.BoxCharacterController"),Fxt=lh(-1),Nxt=Xh(We),Lxt=Xh(We),kxt=Xh(We),Bxt(zxt=Fxt((Uxt=class extends Rxt{constructor(){super(0),this._halfHeight=Vxt&&Vxt(),this._halfSideExtent=jxt&&jxt(),this._halfForwardExtent=Hxt&&Hxt()}get halfHeight(){return this._halfHeight}set halfHeight(t){this._halfHeight!==t&&(this._halfHeight=Math.abs(t),this._cct&&this._cct.setHalfHeight(t))}get halfSideExtent(){return this._halfSideExtent}set halfSideExtent(t){this._halfSideExtent!==t&&(this._halfSideExtent=Math.abs(t),this._cct&&this._cct.setHalfSideExtent(t))}get halfForwardExtent(){return this._halfForwardExtent}set halfForwardExtent(t){this._halfForwardExtent!==t&&(this._halfForwardExtent=Math.abs(t),this._cct&&this._cct.setHalfForwardExtent(t))}},s(Uxt.prototype,"halfHeight",[Nxt],Object.getOwnPropertyDescriptor(Uxt.prototype,"halfHeight"),Uxt.prototype),s(Uxt.prototype,"halfSideExtent",[Lxt],Object.getOwnPropertyDescriptor(Uxt.prototype,"halfSideExtent"),Uxt.prototype),s(Uxt.prototype,"halfForwardExtent",[kxt],Object.getOwnPropertyDescriptor(Uxt.prototype,"halfForwardExtent"),Uxt.prototype),Vxt=Za(Uxt.prototype,"_halfHeight",[vh],(function(){return.5})),jxt=Za(Uxt.prototype,"_halfSideExtent",[vh],(function(){return.5})),Hxt=Za(Uxt.prototype,"_halfForwardExtent",[vh],(function(){return.5})),zxt=Uxt))||zxt)||zxt));var Wxt,Xxt,Yxt,qxt,$xt,Kxt,Zxt,Qxt;new Ms(0,0,0);let Jxt=t("CapsuleCharacterController",(Wxt=ah("cc.CapsuleCharacterController"),Xxt=lh(-1),Yxt=Xh(We),qxt=Xh(We),Wxt($xt=Xxt((Kxt=class extends Rxt{constructor(){super(1),this._radius=Zxt&&Zxt(),this._height=Qxt&&Qxt()}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=Math.abs(t),this._cct&&this._cct.setRadius(t))}get height(){return this._height}set height(t){this._height!==t&&(this._height=Math.abs(t),this._cct&&this._cct.setHeight(t))}},s(Kxt.prototype,"radius",[Yxt],Object.getOwnPropertyDescriptor(Kxt.prototype,"radius"),Kxt.prototype),s(Kxt.prototype,"height",[qxt],Object.getOwnPropertyDescriptor(Kxt.prototype,"height"),Kxt.prototype),Zxt=Za(Kxt.prototype,"_radius",[vh],(function(){return.5})),Qxt=Za(Kxt.prototype,"_height",[vh],(function(){return 1})),$xt=Kxt))||$xt)||$xt));class tCt{constructor(){this.worldPosition=new Ms,this.worldNormal=new Ms,this.motionDirection=new Ms,this.motionLength=0}}a.PhysicsSystem=_yt,a.PhysicsMaterial=lyt,a.PhysicsRayResult=cyt,a.ConstantForce=Lbt;var eCt=Object.freeze({__proto__:null,BoxCharacterController:Gxt,BoxCollider:$yt,CapsuleCharacterController:Jxt,CapsuleCollider:abt,CharacterController:Rxt,CharacterControllerContact:tCt,get Collider(){return jyt},ConeCollider:wbt,ConfigurableConstraint:lxt,ConstantForce:Lbt,get Constraint(){return Kvt},CylinderCollider:mbt,EAxisDirection:a_t,ECharacterControllerType:p_t,EColliderType:c_t,EConstraintMode:d_t,EConstraintType:u_t,ED6Axis:h_t,EDriverMode:__t,EPhysicsDrawFlags:g_t,ERigidBodyType:o_t,ESimplexType:l_t,FixedConstraint:eTt,HingeConstraint:WSt,MeshCollider:Mbt,PhysicsGroup:m_t,PhysicsLineStripCastResult:uyt,PhysicsMaterial:lyt,PhysicsRayResult:cyt,PhysicsSystem:_yt,PlaneCollider:zvt,PointToPointConstraint:fxt,get RigidBody(){return Myt},get SimplexCollider(){return Ovt},SphereCollider:Jyt,TerrainCollider:xvt,selector:pft,utils:XH});t("physics",eCt),Q(_yt,"PhysicsSystem",[{name:"ins",newName:"instance"},{name:"PHYSICS_AMMO",newName:"PHYSICS_BULLET"}]),Q(_yt.prototype,"PhysicsSystem.prototype",[{name:"deltaTime",newName:"fixedTimeStep"},{name:"maxSubStep",newName:"maxSubSteps"}]),J(_yt.prototype,"PhysicsSystem.prototype",[{name:"useFixedTime"},{name:"useCollisionMatrix"},{name:"updateCollisionMatrix"},{name:"resetCollisionMatrix"},{name:"isCollisionGroup"},{name:"setCollisionGroup"}]),Q(jyt.prototype,"Collider.prototype",[{name:"attachedRigidbody",newName:"attachedRigidBody"},{name:"TYPE",newName:"type"}]),Q(jyt,"Collider",[{name:"EColliderType",newName:"Type"},{name:"EAxisDirection",newName:"Axis"}]),Q(Kvt,"Constraint",[{name:"EConstraintType",newName:"Type"}]),Q($yt.prototype,"BoxCollider.prototype",[{name:"boxShape",newName:"shape"}]),Q(Jyt.prototype,"SphereCollider.prototype",[{name:"sphereShape",newName:"shape"}]),Q(abt.prototype,"CapsuleCollider.prototype",[{name:"capsuleShape",newName:"shape"}]),Q(Myt.prototype,"RigidBody.prototype",[{name:"rigidBody",newName:"body"}]),Q(Myt,"RigidBody",[{name:"ERigidBodyType",newName:"Type"}]),J(Myt.prototype,"RigidBody.prototype",[{name:"fixedRotation"}]),a.RigidBodyComponent=Myt,Xt(Myt,"cc.RigidBodyComponent"),a.ColliderComponent=jyt,Xt(jyt,"cc.ColliderComponent"),a.BoxColliderComponent=$yt,Xt($yt,"cc.BoxColliderComponent"),a.SphereColliderComponent=Jyt,Xt(Jyt,"cc.SphereColliderComponent"),Xt(abt,"cc.CapsuleColliderComponent"),Xt(Mbt,"cc.MeshColliderComponent"),Xt(mbt,"cc.CylinderColliderComponent"),a.PhysicMaterial=lyt,Xt(lyt,"cc.PhysicMaterial"),a.physics=eCt;const iCt=kft,sCt=zft;class rCt{get isAwake(){const t=Oft.CollisionObject_getActivationState(this.impl);return 1===t||4===t}get isSleepy(){return 3===Oft.CollisionObject_getActivationState(this.impl)}get isSleeping(){return 2===Oft.CollisionObject_getActivationState(this.impl)}setMass(t){this._rigidBody.isDynamic&&(Oft.RigidBody_setMass(this.impl,t),this._wakeUpIfSleep(),this._sharedBody.dirty|=1)}setType(t){this._sharedBody.setType(t)}setLinearDamping(t){Oft.RigidBody_setDamping(this.impl,this._rigidBody.linearDamping,this._rigidBody.angularDamping)}setAngularDamping(t){Oft.RigidBody_setDamping(this.impl,this._rigidBody.linearDamping,this._rigidBody.angularDamping)}useGravity(t){if(!this._rigidBody.isDynamic)return;let e=Oft.RigidBody_getFlags(this.impl);t?e&=-2:(Oft.RigidBody_setGravity(this.impl,Wft(Lft.instance.BT_V3_0,Ms.ZERO)),e|=1),Oft.RigidBody_setFlags(this.impl,e),this._wakeUpIfSleep(),this._sharedBody.dirty|=1}useCCD(t){Oft.CollisionObject_setCcdMotionThreshold(this.impl,t?.01:0),Oft.CollisionObject_setCcdSweptSphereRadius(this.impl,t?.1:0),this._isUsingCCD=t}isUsingCCD(){return this._isUsingCCD}setLinearFactor(t){Oft.RigidBody_setLinearFactor(this.impl,Wft(Lft.instance.BT_V3_0,t)),this._wakeUpIfSleep()}setAngularFactor(t){Oft.RigidBody_setAngularFactor(this.impl,Wft(Lft.instance.BT_V3_0,t)),this._wakeUpIfSleep()}setAllowSleep(t){this._rigidBody.isDynamic&&(t?Oft.CollisionObject_forceActivationState(this.impl,1):Oft.CollisionObject_forceActivationState(this.impl,4),this._wakeUpIfSleep())}get impl(){return this._sharedBody.body}get rigidBody(){return this._rigidBody}get sharedBody(){return this._sharedBody}get isEnabled(){return this._isEnabled}constructor(){this.id=void 0,this._isEnabled=!1,this._isUsingCCD=!1,this._sharedBody=void 0,this._rigidBody=void 0,this.id=rCt.idCounter++}clearState(){Oft.RigidBody_clearState(this.impl)}clearVelocity(){this.setLinearVelocity(Ms.ZERO),this.setAngularVelocity(Ms.ZERO)}clearForces(){Oft.RigidBody_clearForces(this.impl)}initialize(t){this._rigidBody=t,this._sharedBody=_yt.instance.physicsWorld.getSharedBody(this._rigidBody.node,this),this._sharedBody.reference=!0}onEnable(){this._isEnabled=!0,this.setMass(this._rigidBody.mass),this.setAllowSleep(this._rigidBody.allowSleep),this.setLinearDamping(this._rigidBody.linearDamping),this.setAngularDamping(this._rigidBody.angularDamping),this.setLinearFactor(this._rigidBody.linearFactor),this.setAngularFactor(this._rigidBody.angularFactor),this.useGravity(this._rigidBody.useGravity),this._sharedBody.bodyEnabled=!0}onDisable(){this._isEnabled=!1,this._sharedBody.bodyEnabled=!1}onDestroy(){this._sharedBody.reference=!1,this._rigidBody=null,this._sharedBody=null}wakeUp(t=!0){Oft.CollisionObject_activate(this.impl,t)}sleep(){const t=Oft.CollisionObject_getActivationState(this.impl);4!==t&&5!==t&&Oft.CollisionObject_forceActivationState(this.impl,2)}setSleepThreshold(t){this._wakeUpIfSleep(),Oft.RigidBody_setSleepingThresholds(this.impl,t,t)}getSleepThreshold(){return Oft.RigidBody_getLinearSleepingThreshold(this.impl)}getLinearVelocity(t){return Xft(t,Oft.RigidBody_getLinearVelocity(this.impl))}setLinearVelocity(t){this._wakeUpIfSleep(),Wft(Oft.RigidBody_getLinearVelocity(this.impl),t)}getAngularVelocity(t){return Xft(t,Oft.RigidBody_getAngularVelocity(this.impl))}setAngularVelocity(t){this._wakeUpIfSleep(),Wft(Oft.RigidBody_getAngularVelocity(this.impl),t)}applyLocalForce(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep();const i=this._sharedBody.node.worldRotation,s=Ms.transformQuat(iCt,t,i),r=e?Ms.transformQuat(sCt,e,i):Ms.ZERO;Oft.RigidBody_applyForce(this.impl,Wft(Lft.instance.BT_V3_0,s),Wft(Lft.instance.BT_V3_1,r))}applyLocalTorque(t){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep(),Ms.transformQuat(iCt,t,this._sharedBody.node.worldRotation),Oft.RigidBody_applyTorque(this.impl,Wft(Lft.instance.BT_V3_0,iCt))}applyLocalImpulse(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep();const i=this._sharedBody.node.worldRotation,s=Ms.transformQuat(iCt,t,i),r=e?Ms.transformQuat(sCt,e,i):Ms.ZERO;Oft.RigidBody_applyImpulse(this.impl,Wft(Lft.instance.BT_V3_0,s),Wft(Lft.instance.BT_V3_1,r))}applyForce(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep();const i=e||Ms.ZERO;Oft.RigidBody_applyForce(this.impl,Wft(Lft.instance.BT_V3_0,t),Wft(Lft.instance.BT_V3_1,i))}applyTorque(t){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep(),Oft.RigidBody_applyTorque(this.impl,Wft(Lft.instance.BT_V3_0,t))}applyImpulse(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep();const i=e||Ms.ZERO;Oft.RigidBody_applyImpulse(this.impl,Wft(Lft.instance.BT_V3_0,t),Wft(Lft.instance.BT_V3_1,i))}getGroup(){return this._sharedBody.collisionFilterGroup}setGroup(t){this._sharedBody.collisionFilterGroup=t}addGroup(t){this._sharedBody.collisionFilterGroup|=t}removeGroup(t){this._sharedBody.collisionFilterGroup&=~t}getMask(){return this._sharedBody.collisionFilterMask}setMask(t){this._sharedBody.collisionFilterMask=t}addMask(t){this._sharedBody.collisionFilterMask|=t}removeMask(t){this._sharedBody.collisionFilterMask&=~t}_wakeUpIfSleep(){this.isAwake||Oft.CollisionObject_activate(this.impl,!0)}}rCt.idCounter=0;const nCt={syncPhysicsToGraphics(t){Rft.CACHE.getWrapper(t,Rft.BODY_CACHE_NAME).syncPhysicsToGraphics()},onShapeHitExt(t,e){Rft.CACHE.getWrapper(e,Rft.CCT_CACHE_NAME).onShapeHitExt(t)},onDebugDrawLine(t,e,i){const s=Rft.CACHE.world;s&&s.onDebugDrawLine(t,e,i)},clearLines(){const t=Rft.CACHE.world;t&&t.onClearLines()},flushLines(){}},oCt=kft,aCt=Vft;let hCt=0;class lCt{static getSharedBody(t,e,i){const s=t.uuid;let r;if(lCt.sharedBodesMap.has(s))r=lCt.sharedBodesMap.get(s);else{r=new lCt(t,e);const i=1,s=_yt.instance.collisionMatrix[i];r._collisionFilterGroup=i,r._collisionFilterMask=s,lCt.sharedBodesMap.set(t.uuid,r)}if(i){r._wrappedBody=i;const t=i.rigidBody.group,e=_yt.instance.collisionMatrix[t];r._collisionFilterGroup=t,r._collisionFilterMask=e}return r}get wrappedBody(){return this._wrappedBody}get bodyCompoundShape(){return this.bodyStruct.compound}get ghostCompoundShape(){return this.ghostStruct.compound}get body(){return this.bodyStruct.body}get ghost(){return this.ghostStruct.ghost}get collisionFilterGroup(){return this._collisionFilterGroup}set collisionFilterGroup(t){t!==this._collisionFilterGroup&&(this._collisionFilterGroup=t,this.dirty|=1,this.dirty|=2)}get collisionFilterMask(){return this._collisionFilterMask}set collisionFilterMask(t){t!==this._collisionFilterMask&&(this._collisionFilterMask=t,this.dirty|=1,this.dirty|=2)}get bodyStruct(){return this._instantiateBodyStruct(),this._bodyStruct}get ghostStruct(){return this._instantiateGhostStruct(),this._ghostStruct}set bodyEnabled(t){if(t){if(this.bodyIndex<0){if(0===this.bodyStruct.wrappedShapes.length){if(!this.wrappedBody)return;if(!this.wrappedBody.rigidBody.isDynamic)return}this.bodyIndex=this.wrappedWorld.bodies.length,this.wrappedWorld.addSharedBody(this),this.syncInitialBody()}}else if(this.bodyIndex>=0&&(0===this.bodyStruct.wrappedShapes.length&&null==this.wrappedBody||0===this.bodyStruct.wrappedShapes.length&&null!=this.wrappedBody&&!this.wrappedBody.isEnabled||0===this.bodyStruct.wrappedShapes.length&&null!=this.wrappedBody&&!this.wrappedBody.rigidBody.enabledInHierarchy)){const t=this.body;this.wrappedWorld.constraints.forEach((e=>{var i,s;(null==(i=e.constraint.attachedBody)||null==(s=i.body)?void 0:s.impl)===t&&this.wrappedWorld.removeConstraint(e)})),Oft.RigidBody_clearState(this.body),this.bodyIndex=-1,this.wrappedWorld.removeSharedBody(this)}}set ghostEnabled(t){t?this.ghostIndex<0&&this.ghostStruct.wrappedShapes.length>0&&(this.ghostIndex=1,this.wrappedWorld.addGhostObject(this),this.syncInitialGhost()):this.ghostIndex>=0&&0===this.ghostStruct.wrappedShapes.length&&this.ghost&&(this.ghostIndex=-1,this.wrappedWorld.removeGhostObject(this))}set reference(t){t?this.ref++:this.ref--,0===this.ref&&this.destroy()}constructor(t,e){this.id=void 0,this.node=void 0,this.wrappedWorld=void 0,this.wrappedJoints0=[],this.wrappedJoints1=[],this.dirty=0,this._collisionFilterGroup=1,this._collisionFilterMask=-1,this.ref=0,this.bodyIndex=-1,this.ghostIndex=-1,this._bodyStruct=void 0,this._ghostStruct=void 0,this._wrappedBody=null,this.id=lCt.idCounter++,this.wrappedWorld=e,this.node=t}_instantiateBodyStruct(){if(this._bodyStruct)return;let t=0;this._wrappedBody&&this._wrappedBody.rigidBody.enabled&&this._wrappedBody.rigidBody.isDynamic&&(t=this._wrappedBody.rigidBody.mass);const e=Lft.instance.BT_TRANSFORM_0,i=Lft.instance.BT_QUAT_0;Wft(Oft.Transform_getOrigin(e),this.node.worldPosition),Yft(i,this.node.worldRotation),Oft.Transform_setRotation(e,i);const s=Oft.MotionState.implement(nCt).$$.ptr;Oft.ccMotionState_setup(s,this.id,e);const r=Oft.RigidBody_new(t,s),n=_yt.instance.sleepThreshold;Oft.RigidBody_setSleepingThresholds(r,n,n),this._bodyStruct={id:hCt++,body:r,motionState:s,compound:Oft.ccCompoundShape_new(),wrappedShapes:[],useCompound:!1},Lft.setWrapper(this.id,Rft.BODY_CACHE_NAME,this),this._ghostStruct&&Oft.CollisionObject_setIgnoreCollisionCheck(this.ghost,this.body,!0),this._wrappedBody&&this.setBodyType(this._wrappedBody.rigidBody.type)}_instantiateGhostStruct(){if(this._ghostStruct)return;const t=Oft.CollisionObject_new(),e=Oft.ccCompoundShape_new();Oft.CollisionObject_setCollisionShape(t,e),Oft.CollisionObject_setCollisionFlags(t,5),this._ghostStruct={id:hCt++,ghost:t,compound:e,wrappedShapes:[]},this._bodyStruct&&Oft.CollisionObject_setIgnoreCollisionCheck(this.body,this.ghost,!0),this._wrappedBody&&this.setGhostType(this._wrappedBody.rigidBody.type)}setType(t){this.setBodyType(t),this.setGhostType(t)}setBodyType(t){if(this._bodyStruct&&this._wrappedBody){const e=this._bodyStruct.body,i=this._wrappedBody,s=i.rigidBody;let r=Oft.CollisionObject_getCollisionFlags(e);const n=Lft.instance.BT_V3_0;switch(t){case 1:r&=-3,r&=-2,Oft.CollisionObject_setCollisionFlags(e,r),i.setMass(s.mass),i.useGravity(s.useGravity),i.setAllowSleep(s.allowSleep);break;case 4:Oft.Vec3_set(n,0,0,0),Oft.RigidBody_setMassProps(e,0,n),r|=2,r&=-2,Oft.CollisionObject_setCollisionFlags(e,r),Oft.CollisionObject_forceActivationState(e,4);break;default:Oft.Vec3_set(n,0,0,0),Oft.RigidBody_setMassProps(e,0,n),r|=1,r&=-3,Oft.CollisionObject_setCollisionFlags(e,r),Oft.CollisionObject_forceActivationState(e,2)}this.dirty|=1}}setGhostType(t){if(this._ghostStruct){const e=this._ghostStruct.ghost;let i=Oft.CollisionObject_getCollisionFlags(e);switch(t){case 1:case 4:i&=-2,i|=2,Oft.CollisionObject_setCollisionFlags(e,i),Oft.CollisionObject_forceActivationState(e,4);break;default:i&=-3,i|=1,Oft.CollisionObject_setCollisionFlags(e,i),Oft.CollisionObject_forceActivationState(e,2)}this.dirty|=2}}addShape(t,e){function i(t,e){Oft.CollisionObject_setCollisionShape(t.body,e),t.dirty|=1,t._wrappedBody&&t._wrappedBody.isEnabled&&t._wrappedBody.setMass(t._wrappedBody.rigidBody.mass)}if(e)this.ghostStruct.wrappedShapes.indexOf(t)<0&&(this.ghostStruct.wrappedShapes.push(t),t.setCompound(this.ghostCompoundShape),this.ghostEnabled=!0);else if(this.bodyStruct.wrappedShapes.indexOf(t)<0){if(this.bodyStruct.wrappedShapes.push(t),this.bodyStruct.useCompound)t.setCompound(this.bodyCompoundShape);else{const e=this.bodyStruct.wrappedShapes.length;if(1!==e||t.needCompound()){this.bodyStruct.useCompound=!0;for(let t=0;t<e;t++)this.bodyStruct.wrappedShapes[t].setCompound(this.bodyCompoundShape);i(this,this.bodyStruct.compound)}else i(this,t.impl)}this.bodyEnabled=!0}}removeShape(t,e){if(e){const e=this.ghostStruct.wrappedShapes.indexOf(t);e>=0&&(ie(this.ghostStruct.wrappedShapes,e),t.setCompound(0),this.ghostEnabled=!1)}else{const e=this.bodyStruct.wrappedShapes.indexOf(t);e>=0&&(this.bodyStruct.useCompound?t.setCompound(0):Oft.CollisionObject_setCollisionShape(this.body,Oft.EmptyShape_static()),Oft.CollisionObject_activate(this.body,!0),this.dirty|=1,ie(this.bodyStruct.wrappedShapes,e),this.bodyEnabled=!1)}}addJoint(t,e){e?this.wrappedJoints1.indexOf(t)<0&&this.wrappedJoints1.push(t):this.wrappedJoints0.indexOf(t)<0&&this.wrappedJoints0.push(t)}removeJoint(t,e){if(e){const e=this.wrappedJoints1.indexOf(t);e>=0&&ie(this.wrappedJoints1,e)}else{const e=this.wrappedJoints0.indexOf(t);e>=0&&ie(this.wrappedJoints0,e)}}updateDirty(){this.dirty&&(this.bodyIndex>=0&&1&this.dirty&&this.updateBodyByReAdd(),this.ghostIndex>=0&&2&this.dirty&&this.updateGhostByReAdd(),this.dirty=0)}syncSceneToPhysics(){if(this.node.hasChangedFlags){const t=Lft.instance.BT_QUAT_0,e=Oft.CollisionObject_getWorldTransform(this.body);if(Yft(t,this.node.worldRotation),Wft(Oft.Transform_getOrigin(e),this.node.worldPosition),Oft.Transform_setRotation(e,t),4&this.node.hasChangedFlags&&this.syncBodyScale(),Oft.CollisionObject_isKinematicObject(this.body)){const t=Oft.RigidBody_getMotionState(this.body);t&&Oft.MotionState_setWorldTransform(t,e)}else this.isBodySleeping()&&Oft.CollisionObject_activate(this.body,!1)}}syncPhysicsToScene(){Oft.CollisionObject_isStaticOrKinematicObject(this.body)||this.syncPhysicsToGraphics()}syncPhysicsToGraphics(){if(this.isBodySleeping())return;const t=Lft.instance.BT_QUAT_0,e=Lft.instance.BT_TRANSFORM_0;Oft.RigidBody_getWorldTransform(this.body,e);const i=Oft.Transform_getRotationAndOrigin(e,t);if(this.node.worldRotation=qft(aCt,t),this.node.worldPosition=Xft(oCt,i),this._ghostStruct){const e=Oft.CollisionObject_getWorldTransform(this.ghost);Wft(Oft.Transform_getOrigin(e),this.node.worldPosition),Yft(t,this.node.worldRotation),Oft.Transform_setRotation(e,t)}}syncSceneToGhost(){if(this.node.hasChangedFlags){const t=Lft.instance.BT_QUAT_0,e=Oft.CollisionObject_getWorldTransform(this.ghost);Wft(Oft.Transform_getOrigin(e),this.node.worldPosition),Yft(t,this.node.worldRotation),Oft.Transform_setRotation(e,t),4&this.node.hasChangedFlags&&this.syncGhostScale(),Oft.CollisionObject_activate(this.ghost,!1)}}syncInitialBody(){const t=Lft.instance.BT_QUAT_0,e=Oft.CollisionObject_getWorldTransform(this.body);Wft(Oft.Transform_getOrigin(e),this.node.worldPosition),Yft(t,this.node.worldRotation),Oft.Transform_setRotation(e,t),this.syncBodyScale(),Oft.CollisionObject_activate(this.body,!1)}syncInitialGhost(){const t=Lft.instance.BT_QUAT_0,e=Oft.CollisionObject_getWorldTransform(this.ghost);Wft(Oft.Transform_getOrigin(e),this.node.worldPosition),Yft(t,this.node.worldRotation),Oft.Transform_setRotation(e,t),this.syncGhostScale(),Oft.CollisionObject_activate(this.body,!1)}syncBodyScale(){for(let t=0;t<this.bodyStruct.wrappedShapes.length;t++)this.bodyStruct.wrappedShapes[t].updateScale();for(let t=0;t<this.wrappedJoints0.length;t++)this.wrappedJoints0[t].updateScale0();for(let t=0;t<this.wrappedJoints1.length;t++)this.wrappedJoints1[t].updateScale1()}syncGhostScale(){for(let t=0;t<this.ghostStruct.wrappedShapes.length;t++)this.ghostStruct.wrappedShapes[t].updateScale()}updateBodyByReAdd(){this.bodyIndex>=0&&(this.wrappedWorld.removeSharedBody(this),this.bodyIndex=this.wrappedWorld.bodies.length,this.wrappedWorld.addSharedBody(this))}updateGhostByReAdd(){this.ghostIndex>=0&&(this.wrappedWorld.removeGhostObject(this),this.ghostIndex=this.wrappedWorld.ghosts.length,this.wrappedWorld.addGhostObject(this))}destroy(){if(lCt.sharedBodesMap.delete(this.node.uuid),this.node=null,this.wrappedWorld=null,this._bodyStruct){const t=this._bodyStruct;Lft.delWrapper(this.id,Rft.BODY_CACHE_NAME),Oft._safe_delete(t.motionState,3),Oft._safe_delete(t.compound,5),Oft._safe_delete(t.body,4),this._bodyStruct=null}if(this._ghostStruct){const t=this._ghostStruct;Oft._safe_delete(t.compound,5),Oft._safe_delete(t.ghost,4),this._ghostStruct=null}}isBodySleeping(){return Oft.CollisionObject_isSleeping(this.body)}}lCt.idCounter=0,lCt.sharedBodesMap=new Map;const cCt=kft,uCt={};class dCt{constructor(){this.id=dCt.idCounter++,this._isEnabled=!1,this._isTrigger=!1,this._isInitialized=!1,this._impl=0,this._compound=0,this.quat=Oft.Quat_new(0,0,0,1),this.transform=Oft.Transform_new(),this._collider=void 0,this._sharedBody=void 0}updateEventListener(){this._sharedBody.wrappedWorld&&this._sharedBody.wrappedWorld.updateNeedEmitEvents(this.collider.needCollisionEvent||this.collider.needTriggerEvent)}setMaterial(t){const e=null==t?_yt.instance.defaultMaterial:t;if(!this._isTrigger&&this._isEnabled)if(this._compound){uCt[e._uuid]||(uCt[e._uuid]=Oft.ccMaterial_new());const t=uCt[e._uuid];Oft.ccMaterial_set(t,e.restitution,e.friction,e.rollingFriction,e.spinningFriction),Oft.CollisionShape_setMaterial(this._impl,t)}else Oft.CollisionObject_setMaterial(this._sharedBody.body,e.restitution,e.friction,e.rollingFriction,e.spinningFriction)}setCenter(t){Ms.copy(cCt,t),cCt.multiply(this._collider.node.worldScale),Wft(Oft.Transform_getOrigin(this.transform),cCt),this.updateCompoundTransform()}setAsTrigger(t){this._isTrigger!==t&&(this._isEnabled&&(this._sharedBody.removeShape(this,!t),this._sharedBody.addShape(this,t)),this._isTrigger=t)}get attachedRigidBody(){return this._sharedBody.wrappedBody?this._sharedBody.wrappedBody.rigidBody:null}get impl(){return this._impl}get collider(){return this._collider}get sharedBody(){return this._sharedBody}getAABB(t){const e=Lft.instance.BT_TRANSFORM_0;Oft.Transform_setIdentity(e),Oft.Transform_setRotation(e,Yft(Lft.instance.BT_QUAT_0,this._collider.node.worldRotation));const i=Lft.instance.BT_V3_0,s=Lft.instance.BT_V3_1;Oft.CollisionShape_getAabb(this._impl,e,i,s),t.halfExtents.x=(Oft.Vec3_x(s)-Oft.Vec3_x(i))/2,t.halfExtents.y=(Oft.Vec3_y(s)-Oft.Vec3_y(i))/2,t.halfExtents.z=(Oft.Vec3_z(s)-Oft.Vec3_z(i))/2,Ms.add(t.center,this._collider.node.worldPosition,this._collider.center)}getBoundingSphere(t){t.radius=Oft.CollisionShape_getLocalBoundingSphere(this._impl),Ms.add(t.center,this._collider.node.worldPosition,this._collider.center)}initialize(t){this._collider=t,this._isInitialized=!0,this._sharedBody=_yt.instance.physicsWorld.getSharedBody(this._collider.node),this._sharedBody.reference=!0,this.onComponentSet(),this.setWrapper()}setWrapper(){Lft.isNotEmptyShape(this._impl)&&(Oft.CollisionShape_setUserPointer(this._impl,this._impl),Lft.setWrapper(this._impl,dCt.TYPE,this))}onLoad(){this.setCenter(this._collider.center),this.setAsTrigger(this._collider.isTrigger)}onEnable(){this._isEnabled=!0,this._sharedBody.addShape(this,this._isTrigger),this.setMaterial(this.collider.sharedMaterial)}onDisable(){this._isEnabled=!1,this._sharedBody.removeShape(this,this._isTrigger)}onDestroy(){this._sharedBody.reference=!1,this._collider=null,Oft._safe_delete(this.quat,1),Oft._safe_delete(this.transform,2),this._compound&&Oft._safe_delete(this._compound,5),Lft.isNotEmptyShape(this._impl)&&(Oft._safe_delete(this._impl,5),Lft.delWrapper(this._impl,dCt.TYPE))}updateByReAdd(){this._isEnabled&&(this._sharedBody.removeShape(this,this._isTrigger),this._sharedBody.addShape(this,this._isTrigger))}getGroup(){return this._sharedBody.collisionFilterGroup}setGroup(t){this._sharedBody.collisionFilterGroup=t}addGroup(t){this._sharedBody.collisionFilterGroup|=t}removeGroup(t){this._sharedBody.collisionFilterGroup&=~t}getMask(){return this._sharedBody.collisionFilterMask}setMask(t){this._sharedBody.collisionFilterMask=t}addMask(t){this._sharedBody.collisionFilterMask|=t}removeMask(t){this._sharedBody.collisionFilterMask&=~t}setCompound(t){this._compound&&Oft.CompoundShape_removeChildShape(this._compound,this._impl),t&&Oft.CompoundShape_addChildShape(t,this.transform,this._impl),this._compound=t}updateScale(){this.setCenter(this._collider.center)}updateCompoundTransform(){this._compound?Oft.CompoundShape_updateChildTransform(this._compound,this._impl,this.transform,!0):this._isEnabled&&!this._isTrigger&&this._sharedBody&&!this._sharedBody.bodyStruct.useCompound&&(this._sharedBody.dirty|=1)}needCompound(){return 8===this._collider.type||!this._collider.center.equals(Ms.ZERO)}}dCt.TYPE="shape",dCt.idCounter=0;class _Ct{constructor(){this.matrix=[]}get(t,e){if(e>t){const i=e;e=t,t=i}return this.matrix[(t*(t+1)>>1)+e-1]}set(t,e,i){if(e>t){const i=e;e=t,t=i}this.matrix[(t*(t+1)>>1)+e-1]=i?1:0}reset(){this.matrix.length=0}setNumObjects(t){this.matrix.length=t*(t-1)>>1}}class pCt{constructor(){this.data=void 0,this.data={keys:[]}}get(t,e){if(t>e){const i=e;e=t,t=i}return this.data[`${t}-${e}`]}set(t,e,i){if(t>e){const i=e;e=t,t=i}const s=`${t}-${e}`;if(null==i){const t=this.data.keys.indexOf(s);if(-1!==t)return this.data.keys.splice(t,1),delete this.data[s],i}return this.get(t,e)||this.data.keys.push(s),this.data[s]=i,this.data[s]}reset(){this.data={keys:[]}}getLength(){return this.data.keys.length}getKeyByIndex(t){return this.data.keys[t]}getDataByKey(t){return this.data[t]}}class mCt{get isBodyA(){return this.event.selfCollider.shape.sharedBody.body===Oft.PersistentManifold_getBody0(this.event.impl)}constructor(t){this.impl=0,this.event=void 0,this.event=t}getLocalPointOnA(t){this.impl&&Xft(t,Oft.ManifoldPoint_get_m_localPointA(this.impl))}getLocalPointOnB(t){this.impl&&Xft(t,Oft.ManifoldPoint_get_m_localPointB(this.impl))}getWorldPointOnA(t){this.impl&&Xft(t,Oft.ManifoldPoint_get_m_positionWorldOnA(this.impl))}getWorldPointOnB(t){this.impl&&Xft(t,Oft.ManifoldPoint_get_m_positionWorldOnB(this.impl))}getLocalNormalOnA(t){if(this.impl){const e=Lft.instance.BT_QUAT_0,i=Oft.PersistentManifold_getBody0(this.event.impl),s=Oft.CollisionObject_getWorldTransform(i);Oft.Transform_getRotation(s,e);const r=Vft;qft(r,e),sr.conjugate(r,r),Xft(t,Oft.ManifoldPoint_get_m_normalWorldOnB(this.impl)),this.isBodyA||Ms.negate(t,t),Ms.transformQuat(t,t,r)}}getLocalNormalOnB(t){if(this.impl){const e=Lft.instance.BT_QUAT_0,i=Oft.PersistentManifold_getBody1(this.event.impl),s=Oft.CollisionObject_getWorldTransform(i);Oft.Transform_getRotation(s,e);const r=Vft;qft(r,e),sr.conjugate(r,r),Xft(t,Oft.ManifoldPoint_get_m_normalWorldOnB(this.impl)),Ms.transformQuat(t,t,r)}}getWorldNormalOnA(t){this.impl&&(Xft(t,Oft.ManifoldPoint_get_m_normalWorldOnB(this.impl)),this.isBodyA||Ms.negate(t,t))}getWorldNormalOnB(t){this.impl&&Xft(t,Oft.ManifoldPoint_get_m_normalWorldOnB(this.impl))}}const gCt=[],fCt=kft,yCt=zft,bCt=Uft,vCt=Gft,SCt=new tCt;class TCt{setDefaultMaterial(t){}setAllowSleep(t){Oft.ccDiscreteDynamicsWorld_setAllowSleep(this._world,t)}setGravity(t){Oft.DynamicsWorld_setGravity(this._world,Wft(Lft.instance.BT_V3_0,t))}updateNeedEmitEvents(t){if(this.ghosts)if(t)this._needEmitEvents=!0;else{this._needEmitEvents=!1;for(let t=0;t<this.ghosts.length;t++){const e=this.ghosts[t].ghostStruct.wrappedShapes;for(let t=0;t<e.length;t++){const i=e[t].collider;if(i.needCollisionEvent||i.needTriggerEvent)return void(this._needEmitEvents=!0)}}for(let t=0;t<this.bodies.length;t++){const e=this.bodies[t].bodyStruct.wrappedShapes;for(let t=0;t<e.length;t++){const i=e[t].collider;if(i.needCollisionEvent||i.needTriggerEvent)return void(this._needEmitEvents=!0)}}}}updateNeedEmitCCTEvents(t){if(this.ccts)if(t)this._needEmitCCTEvents=!0;else{this._needEmitCCTEvents=!1;const t=this.ccts,e=t.length;for(let i=0;i<e;i++)if(t[i].characterController.needCollisionEvent)return void(this._needEmitCCTEvents=!0)}}get impl(){return this._world}constructor(){this._world=void 0,this._broadphase=void 0,this._solver=void 0,this._dispatcher=void 0,this._debugDraw=void 0,this._debugLineCount=0,this._MAX_DEBUG_LINE_COUNT=16384,this._debugDrawFlags=0,this._debugConstraintSize=.3,this._needEmitEvents=!1,this._needSyncAfterEvents=!1,this._needEmitCCTEvents=!1,this.bodies=[],this.ghosts=[],this.ccts=[],this.constraints=[],this.triggerArrayMat=new _Ct,this.characterControllerArrayMat=new _Ct,this.collisionArrayMat=new _Ct,this.contactsDic=new pCt,this.oldContactsDic=new pCt,this.cctShapeEventDic=new pCt,this.cctContactsDic=new pCt,this.cctOldContactsDic=new pCt,Rft.CACHE.world=this,this._broadphase=Oft.DbvtBroadphase_new(),this._dispatcher=Oft.CollisionDispatcher_new(),this._solver=Oft.SequentialImpulseConstraintSolver_new(),this._world=Oft.ccDiscreteDynamicsWorld_new(this._dispatcher,this._broadphase,this._solver);const t=Oft.DebugDraw.implement(nCt);this._debugDraw=t.$$.ptr,Oft.CollisionWorld_setDebugDrawer(this._world,this._debugDraw),Oft.DebugDraw_setDebugMode(this._debugDraw,0),Oft.DebugDraw_setAABBColor(this._debugDraw,0,1,1),Oft.DebugDraw_setActiveObjectColor(this._debugDraw,1,0,1),Oft.DebugDraw_setDeactiveObjectColor(this._debugDraw,1,0,1),Oft.DebugDraw_setWantsDeactivationObjectColor(this._debugDraw,1,0,1),Oft.DebugDraw_setDisabledDeactivationObjectColor(this._debugDraw,1,0,1),Oft.DebugDraw_setDisabledSimulationObjectColor(this._debugDraw,1,0,1),Oft.DebugDraw_setConstraintLimitColor(this._debugDraw,.5,.5,.5)}destroy(){(this.constraints.length||this.bodies.length||this.ccts.length)&&P("You should destroy all physics component first."),Oft._safe_delete(this._world,12),Oft._safe_delete(this._broadphase,10),Oft._safe_delete(this._dispatcher,9),Oft._safe_delete(this._solver,11),Oft._safe_delete(this._debugDraw,14),this.bodies=null,this.ghosts=null,this.ccts=null,this.constraints=null,this.triggerArrayMat=null,this.characterControllerArrayMat=null,this.collisionArrayMat=null,this.contactsDic=null,this.oldContactsDic=null,this.cctShapeEventDic=null,this.cctShapeEventPool=null,gCt.length=0}step(t,e,i=0){(this.bodies.length||this.ghosts.length)&&(void 0===e&&(e=t),Oft.DynamicsWorld_stepSimulation(this._world,e,i,t),Oft.CollisionWorld_debugDrawWorld(this._world))}syncSceneToPhysics(){for(let t=this.ghosts.length-1;t>=0;t--){const e=this.ghosts[t];e.updateDirty(),e.syncSceneToGhost()}for(let t=this.bodies.length-1;t>=0;t--){const e=this.bodies[t];e.updateDirty(),e.syncSceneToPhysics()}const t=this.ccts;for(let e=t.length-1;e>=0;e--){const i=t[e];i.updateDirty(),i.syncSceneToPhysics()}}syncAfterEvents(){this._needSyncAfterEvents&&this.syncSceneToPhysics()}raycast(t,e,i,s){t.computeHit(fCt,e.maxDistance);const r=Wft(Lft.instance.BT_V3_0,fCt),n=Wft(Lft.instance.BT_V3_1,t.o),o=Oft.ccAllRayCallback_static();if(Oft.ccAllRayCallback_reset(o,n,r,e.mask>>>0,e.queryTrigger),Oft.ccAllRayCallback_setFlags(o,4),Oft.CollisionWorld_rayTest(this._world,n,r,o),Oft.RayCallback_hasHit(o)){const e=Oft.ccAllRayCallback_getHitPointWorld(o),r=Oft.ccAllRayCallback_getHitNormalWorld(o),n=Oft.ccAllRayCallback_getCollisionShapePtrs(o),a=Oft.ccAllRayCallback_getClosestHitFraction(o);for(let o=0,h=Oft.int_array_size(n);o<h;o++){Xft(fCt,Oft.Vec3_array_at(e,o)),Xft(yCt,Oft.Vec3_array_at(r,o));const h=Lft.getWrapper(Oft.int_array_at(n,o),dCt.TYPE),l=i.add();s.push(l),l._assign(fCt,Ms.distance(t.o,fCt),h.collider,yCt,a)}return!0}return!1}raycastClosest(t,e,i){t.computeHit(fCt,e.maxDistance);const s=Wft(Lft.instance.BT_V3_0,fCt),r=Wft(Lft.instance.BT_V3_1,t.o),n=Oft.ccClosestRayCallback_static();if(Oft.ccClosestRayCallback_reset(n,r,s,e.mask>>>0,e.queryTrigger),Oft.ccClosestRayCallback_setFlags(n,4),Oft.CollisionWorld_rayTest(this._world,r,s,n),Oft.RayCallback_hasHit(n)){Xft(fCt,Oft.ccClosestRayCallback_getHitPointWorld(n)),Xft(yCt,Oft.ccClosestRayCallback_getHitNormalWorld(n));const e=Lft.getWrapper(Oft.ccClosestRayCallback_getCollisionShapePtr(n),dCt.TYPE),s=Oft.ccClosestConvexCallback_getClosestHitFraction(n);return i._assign(fCt,Ms.distance(t.o,fCt),e.collider,yCt,s),!0}return!1}sweepBox(t,e,i,s,r,n){const o=Lft.instance.BT_V3_0;return Wft(o,e),TCt._sweepBoxGeometry||(TCt._sweepBoxGeometry=Oft.BoxShape_new(o)),Oft.BoxShape_setUnscaledHalfExtents(TCt._sweepBoxGeometry,o),this.sweep(t,TCt._sweepBoxGeometry,i,s,r,n)}sweepBoxClosest(t,e,i,s,r){const n=Lft.instance.BT_V3_0;return Wft(n,e),TCt._sweepBoxGeometry||(TCt._sweepBoxGeometry=Oft.BoxShape_new(n)),Oft.BoxShape_setUnscaledHalfExtents(TCt._sweepBoxGeometry,n),this.sweepClosest(t,TCt._sweepBoxGeometry,i,s,r)}sweepSphere(t,e,i,s,r){return TCt._sweepSphereGeometry||(TCt._sweepSphereGeometry=Oft.SphereShape_new(e)),Oft.SphereShape_setUnscaledRadius(TCt._sweepSphereGeometry,e),this.sweep(t,TCt._sweepSphereGeometry,sr.IDENTITY,i,s,r)}sweepSphereClosest(t,e,i,s){return TCt._sweepSphereGeometry||(TCt._sweepSphereGeometry=Oft.SphereShape_new(e)),Oft.SphereShape_setUnscaledRadius(TCt._sweepSphereGeometry,e),this.sweepClosest(t,TCt._sweepSphereGeometry,sr.IDENTITY,i,s)}sweepCapsule(t,e,i,s,r,n,o){return TCt._sweepCapsuleGeometry||(TCt._sweepCapsuleGeometry=Oft.CapsuleShape_new(e,i)),Oft.CapsuleShape_updateProp(TCt._sweepCapsuleGeometry,e,.5*i,1),this.sweep(t,TCt._sweepCapsuleGeometry,s,r,n,o)}sweepCapsuleClosest(t,e,i,s,r,n){return TCt._sweepCapsuleGeometry||(TCt._sweepCapsuleGeometry=Oft.CapsuleShape_new(e,i)),Oft.CapsuleShape_updateProp(TCt._sweepCapsuleGeometry,e,.5*i,1),this.sweepClosest(t,TCt._sweepCapsuleGeometry,s,r,n)}sweep(t,e,i,s,r,n){const o=Oft.Transform_new(),a=Oft.Transform_new(),h=Oft.Quat_new(0,0,0,1);Wft(Oft.Transform_getOrigin(o),t.o),Yft(h,i),Oft.Transform_setRotation(o,h),t.computeHit(fCt,s.maxDistance),Wft(Oft.Transform_getOrigin(a),fCt),Yft(h,i),Oft.Transform_setRotation(a,h);const l=Oft.ccAllConvexCallback_static();if(Oft.ccAllConvexCallback_reset(l,o,a,s.mask>>>0,s.queryTrigger),Oft.CollisionWorld_convexSweepTest(this._world,e,o,a,l,0),Oft._safe_delete(o,2),Oft._safe_delete(a,2),Oft._safe_delete(h,1),Oft.ConvexCallback_hasHit(l)){const e=Oft.ccAllConvexCallback_getHitPointWorld(l),i=Oft.ccAllConvexCallback_getHitNormalWorld(l),s=Oft.ccAllConvexCallback_getCollisionShapePtrs(l),o=Oft.ccAllConvexCallback_getClosestHitFraction(l);for(let a=0,h=Oft.int_array_size(s);a<h;a++){Xft(fCt,Oft.Vec3_array_at(e,a)),Xft(yCt,Oft.Vec3_array_at(i,a));const h=Lft.getWrapper(Oft.int_array_at(s,a),dCt.TYPE),l=r.add();n.push(l),l._assign(fCt,Ms.distance(t.o,fCt),h.collider,yCt,o)}return!0}return!1}sweepClosest(t,e,i,s,r){const n=Oft.Transform_new(),o=Oft.Transform_new(),a=Oft.Quat_new(0,0,0,1);Wft(Oft.Transform_getOrigin(n),t.o),Yft(a,i),Oft.Transform_setRotation(n,a),t.computeHit(fCt,s.maxDistance),Wft(Oft.Transform_getOrigin(o),fCt),Yft(a,i),Oft.Transform_setRotation(o,a);const h=Oft.ccClosestConvexCallback_static();if(Oft.ccClosestConvexCallback_reset(h,n,o,s.mask>>>0,s.queryTrigger),Oft.CollisionWorld_convexSweepTest(this._world,e,n,o,h,0),Oft._safe_delete(n,2),Oft._safe_delete(o,2),Oft._safe_delete(a,1),Oft.ConvexCallback_hasHit(h)){Xft(fCt,Oft.ccClosestConvexCallback_getHitPointWorld(h)),Xft(yCt,Oft.ccClosestConvexCallback_getHitNormalWorld(h));const e=Lft.getWrapper(Oft.ccClosestConvexCallback_getCollisionShapePtr(h),dCt.TYPE),i=Oft.ccClosestConvexCallback_getClosestHitFraction(h);return r._assign(fCt,Ms.distance(t.o,fCt),e.collider,yCt,i),!0}return!1}getSharedBody(t,e){return lCt.getSharedBody(t,this,e)}addSharedBody(t){if(this.bodies.indexOf(t)<0){this.bodies.push(t);const e=t.collisionFilterGroup,i=t.collisionFilterMask;Oft.DynamicsWorld_addRigidBody(this._world,t.body,e>>>0,i>>>0)}}removeSharedBody(t){const e=this.bodies.indexOf(t);e>=0&&(ie(this.bodies,e),Oft.DynamicsWorld_removeRigidBody(this._world,t.body))}addGhostObject(t){if(this.ghosts.indexOf(t)<0){this.ghosts.push(t);const e=t.collisionFilterGroup,i=t.collisionFilterMask;Oft.CollisionWorld_addCollisionObject(this._world,t.ghost,e>>>0,i>>>0)}}removeGhostObject(t){const e=this.ghosts.indexOf(t);e>=0&&(ie(this.ghosts,e),Oft.CollisionWorld_removeCollisionObject(this._world,t.ghost))}addCCT(t){if(this.ccts.indexOf(t)<0){this.ccts.push(t);const e=Oft.CharacterController_getGhostObject(t.impl),i=t.getGroup(),s=t.getMask();Oft.CollisionWorld_addCollisionObject(this._world,e,i>>>0,s>>>0),Oft.DynamicsWorld_addAction(this._world,t.impl)}}removeCCT(t){const e=this.ccts.indexOf(t);if(e>=0){ie(this.ccts,e);const i=Oft.CharacterController_getGhostObject(t.impl);Oft.CollisionWorld_removeCollisionObject(this._world,i),Oft.DynamicsWorld_removeAction(this._world,t.impl)}}addConstraint(t){const e=this.constraints.indexOf(t);e<0&&(this.constraints.push(t),Oft.DynamicsWorld_addConstraint(this.impl,t.impl,!t.constraint.enableCollision),t.index=e)}removeConstraint(t){const e=this.constraints.indexOf(t);e>=0&&(this.constraints.splice(e,1),Oft.DynamicsWorld_removeConstraint(this.impl,t.impl),t.index=-1)}emitEvents(){this._needSyncAfterEvents=!1,this._needEmitEvents&&(this.gatherConatactData(),this.emitCollisionAndTriggerEvent(),this.emitCCTTriggerEvent()),this._needEmitCCTEvents&&this.emitCCTCollisionEvent()}emitCollisionAndTriggerEvent(){let t=this.contactsDic.getLength();for(;t--;){gCt.push.apply(gCt,Fft.contacts),Fft.contacts.length=0;const e=this.contactsDic.getKeyByIndex(t),i=this.contactsDic.getDataByKey(e),s=i.shape0,r=i.shape1;this.oldContactsDic.set(s.id,r.id,i);const n=s.collider,o=r.collider;if(n&&o){if(n.isTrigger||o.isTrigger)this.triggerArrayMat.get(s.id,r.id)?Bft.type="onTriggerStay":(Bft.type="onTriggerEnter",this.triggerArrayMat.set(s.id,r.id,!0)),Bft.impl=i.impl,Bft.selfCollider=n,Bft.otherCollider=o,n.emit(Bft.type,Bft),Bft.selfCollider=o,Bft.otherCollider=n,o.emit(Bft.type,Bft),this._needSyncAfterEvents=!0;else{const t=n.attachedRigidBody,e=o.attachedRigidBody;if(t&&e){if(t.isSleeping&&e.isSleeping)continue}else if(!t&&e){if(e.isSleeping)continue}else if(!e&&t&&t.isSleeping)continue;this.collisionArrayMat.get(s.id,r.id)?Fft.type="onCollisionStay":(Fft.type="onCollisionEnter",this.collisionArrayMat.set(s.id,r.id,!0));for(let t=0;t<i.contacts.length;t++){const e=i.contacts[t];if(gCt.length>0){const t=gCt.pop();t.impl=e,Fft.contacts.push(t)}else{const t=new mCt(Fft);t.impl=e,Fft.contacts.push(t)}}Fft.impl=i.impl,Fft.selfCollider=n,Fft.otherCollider=o,n.emit(Fft.type,Fft),Fft.selfCollider=o,Fft.otherCollider=n,o.emit(Fft.type,Fft),this._needSyncAfterEvents=!0}null==this.oldContactsDic.get(s.id,r.id)&&this.oldContactsDic.set(s.id,r.id,i)}}let e=this.oldContactsDic.getLength();for(;e--;){const t=this.oldContactsDic.getKeyByIndex(e),i=this.oldContactsDic.getDataByKey(t),s=i.shape0,r=i.shape1,n=s.collider,o=r.collider;if(n&&o){const e=n.isTrigger||o.isTrigger;null==this.contactsDic.getDataByKey(t)&&(e?this.triggerArrayMat.get(s.id,r.id)&&(Bft.type="onTriggerExit",Bft.selfCollider=n,Bft.otherCollider=o,n.emit(Bft.type,Bft),Bft.selfCollider=o,Bft.otherCollider=n,o.emit(Bft.type,Bft),this.triggerArrayMat.set(s.id,r.id,!1),this.oldContactsDic.set(s.id,r.id,null),this._needSyncAfterEvents=!0):this.collisionArrayMat.get(s.id,r.id)&&(gCt.push.apply(gCt,Fft.contacts),Fft.contacts.length=0,Fft.type="onCollisionExit",Fft.selfCollider=n,Fft.otherCollider=o,n.emit(Fft.type,Fft),Fft.selfCollider=o,Fft.otherCollider=n,o.emit(Fft.type,Fft),this.collisionArrayMat.set(s.id,r.id,!1),this.oldContactsDic.set(s.id,r.id,null),this._needSyncAfterEvents=!0))}}this.contactsDic.reset()}emitCCTTriggerEvent(){let t=this.cctContactsDic.getLength();for(;t--;){const e=this.cctContactsDic.getKeyByIndex(t),i=this.cctContactsDic.getDataByKey(e),s=i.shape,r=i.cct;this.cctOldContactsDic.set(s.id,r.id,i);const n=s.collider,o=r.characterController;n&&o&&(n.isTrigger&&(this.characterControllerArrayMat.get(s.id,r.id)?Nft.type="onControllerTriggerStay":(Nft.type="onControllerTriggerEnter",this.characterControllerArrayMat.set(s.id,r.id,!0)),Nft.impl=i.impl,Nft.collider=n,Nft.characterController=o,n.emit(Nft.type,Nft),Nft.collider=n,Nft.characterController=o,o.emit(Nft.type,Nft),this._needSyncAfterEvents=!0),null==this.cctOldContactsDic.get(s.id,r.id)&&this.cctOldContactsDic.set(s.id,r.id,i))}let e=this.cctOldContactsDic.getLength();for(;e--;){const t=this.cctOldContactsDic.getKeyByIndex(e),i=this.cctOldContactsDic.getDataByKey(t),s=i.shape,r=i.cct,n=s.collider,o=r.characterController;if(n&&o){const e=n.isTrigger;null==this.cctContactsDic.getDataByKey(t)&&e&&this.characterControllerArrayMat.get(s.id,r.id)&&(Nft.type="onControllerTriggerExit",Nft.collider=n,Nft.characterController=o,n.emit(Nft.type,Nft),Nft.collider=n,Nft.characterController=o,o.emit(Nft.type,Nft),this.characterControllerArrayMat.set(s.id,r.id,!1),this.cctOldContactsDic.set(s.id,r.id,null),this._needSyncAfterEvents=!0)}}this.cctContactsDic.reset()}emitCCTCollisionEvent(){let t=this.cctShapeEventDic.getLength();for(;t--;){var e;const i=this.cctShapeEventDic.getKeyByIndex(t),s=this.cctShapeEventDic.getDataByKey(i),r=s.BulletCharacterController,n=s.BulletShape,o=s.worldPos,a=s.worldNormal,h=s.motionDir,l=s.motionLength;SCt.controller=r.characterController,SCt.collider=n.collider,SCt.worldPosition.set(o.x,o.y,o.z),SCt.worldNormal.set(a.x,a.y,a.z),SCt.motionDirection.set(h.x,h.y,h.z),SCt.motionLength=l,null==(e=SCt.controller)||e.emit("onControllerColliderHit",SCt),this._needSyncAfterEvents=!0}this.cctShapeEventDic.reset()}gatherConatactData(){const t=Oft.Dispatcher_getNumManifolds(this._dispatcher);for(let e=0;e<t;e++){const t=Oft.Dispatcher_getManifoldByIndexInternal(this._dispatcher,e),i=Oft.PersistentManifold_getNumContacts(t);for(let e=0;e<i;e++){const i=Oft.PersistentManifold_getContactPoint(t,e),s=Oft.ManifoldPoint_getShape0(i),r=Oft.ManifoldPoint_getShape1(i);let n=!1;if(!n){const e=Lft.getWrapper(s,dCt.TYPE),o=Lft.getWrapper(r,dCt.TYPE);if(e&&o&&(n=!0,e.collider.needTriggerEvent||o.collider.needTriggerEvent||e.collider.needCollisionEvent||o.collider.needCollisionEvent)){let s=this.contactsDic.get(e.id,o.id);s||(s=this.contactsDic.set(e.id,o.id,{shape0:e,shape1:o,contacts:[],impl:t})),s.contacts.push(i)}}if(!n){const e=Lft.getWrapper(s,dCt.TYPE),o=Lft.getWrapper(r,Rft.CCT_CACHE_NAME);if(e&&o&&(n=!0,e.collider.needTriggerEvent)){let s=this.cctContactsDic.get(e.id,o.id);s||(s=this.cctContactsDic.set(e.id,o.id,{shape:e,cct:o,contacts:[],impl:t})),s.contacts.push(i),n=!0}}if(!n){const e=Lft.getWrapper(s,Rft.CCT_CACHE_NAME),o=Lft.getWrapper(r,dCt.TYPE);if(o&&e&&(n=!0,o.collider.needTriggerEvent)){let s=this.cctContactsDic.get(o.id,e.id);s||(s=this.cctContactsDic.set(o.id,e.id,{shape:o,cct:e,contacts:[],impl:t})),s.contacts.push(i),n=!0}}}}}get debugDrawFlags(){return this._debugDrawFlags}set debugDrawFlags(t){this._debugDrawFlags=t,this._debugDraw&&this._setDebugDrawMode()}get debugDrawConstraintSize(){return this._debugConstraintSize}set debugDrawConstraintSize(t){this._debugConstraintSize=t;for(let t=0;t<this.constraints.length;t++)this.constraints[t].updateDebugDrawSize()}_setDebugDrawMode(){let t=0;1&this._debugDrawFlags&&(t|=1),2&this._debugDrawFlags&&(t|=2048,t|=4096),4&this._debugDrawFlags&&(t|=2),Oft.DebugDraw_setDebugMode(this._debugDraw,t)}_getDebugRenderer(){var t;const e=null==(t=nC.root.mainWindow)?void 0:t.cameras;return e?0===e.length?null:e[0]?(e[0].initGeometryRenderer(),e[0].geometryRenderer):null:null}onDebugDrawLine(t,e,i){const s=this._getDebugRenderer();s&&this._debugLineCount<this._MAX_DEBUG_LINE_COUNT&&(this._debugLineCount++,Xft(fCt,t),Xft(yCt,e),Xft(bCt,i),vCt.set(255*bCt.x,255*bCt.y,255*bCt.z,255),s.addLine(fCt,yCt,vCt))}onClearLines(){this._debugLineCount=0}}TCt._sweepBoxGeometry=void 0,TCt._sweepSphereGeometry=void 0,TCt._sweepCapsuleGeometry=void 0;class wCt extends dCt{updateSize(){const t=Lft.instance.BT_V3_0;Wft(t,this.getMinUnscaledHalfExtents(SH)),Oft.BoxShape_setUnscaledHalfExtents(this.impl,t),this.updateCompoundTransform()}get collider(){return this._collider}onComponentSet(){const t=Lft.instance.BT_V3_0;Wft(t,this.getMinUnscaledHalfExtents(SH)),this._impl=Oft.BoxShape_new(t),this.updateScale()}updateScale(){super.updateScale();const t=Lft.instance.BT_V3_0;Oft.CollisionShape_setLocalScaling(this._impl,Wft(t,this.getMinScale(SH))),this.updateCompoundTransform()}getMinUnscaledHalfExtents(t){const e=this.collider.size,i=TH(SH.set(this._collider.node.worldScale)),s=_yt.instance.minVolumeSize,r=e.x/2,n=e.y/2,o=e.z/2,a=r*i.x<s?s/i.x:r,h=n*i.y<s?s/i.y:n,l=o*i.z<s?s/i.z:o;return t.set(a,h,l),t}getMinScale(t){const e=this.collider.size,i=TH(SH.set(this._collider.node.worldScale)),s=_yt.instance.minVolumeSize,r=e.x/2,n=e.y/2,o=e.z/2,a=r*i.x<s?s/r:i.x,h=n*i.y<s?s/n:i.y,l=o*i.z<s?s/o:i.z;return t.set(a,h,l),t}}class xCt extends dCt{updateRadius(){Oft.SphereShape_setUnscaledRadius(this.impl,this.getMinUnscaledRadius()),this.updateCompoundTransform()}get collider(){return this._collider}onComponentSet(){this._impl=Oft.SphereShape_new(this.getMinUnscaledRadius()),this.updateScale()}updateScale(){super.updateScale();const t=this.getMinScale();kft.set(t,t,t);const e=Lft.instance.BT_V3_0;Oft.CollisionShape_setLocalScaling(this._impl,Wft(e,kft)),this.updateCompoundTransform()}getMinUnscaledRadius(){const t=this.collider.radius,e=Math.abs($i(this._collider.node.worldScale)),i=_yt.instance.minVolumeSize;return e*t<i?i/e:t}getMinScale(){const t=this.collider.radius,e=Math.abs($i(this._collider.node.worldScale)),i=_yt.instance.minVolumeSize;return e*t<i?i/t:e}}class CCt extends dCt{setCylinderHeight(t){this.updateProperties(this.collider.radius,this.collider.cylinderHeight,this.collider.direction,this._collider.node.worldScale)}setDirection(t){this.updateProperties(this.collider.radius,this.collider.cylinderHeight,this.collider.direction,this._collider.node.worldScale)}setRadius(t){this.updateProperties(this.collider.radius,this.collider.cylinderHeight,this.collider.direction,this._collider.node.worldScale)}get collider(){return this._collider}onComponentSet(){this._impl=Oft.CapsuleShape_new(.5,1),this.setRadius(this.collider.radius)}updateScale(){super.updateScale(),this.setRadius(this.collider.radius)}updateProperties(t,e,i,s){const r=s,n=i;let o,a;1===n?(o=t*Math.abs(Ki(r.x,r.z)),a=e/2*Math.abs(r.y)):0===n?(o=t*Math.abs(Ki(r.y,r.z)),a=e/2*Math.abs(r.x)):(o=t*Math.abs(Ki(r.x,r.y)),a=e/2*Math.abs(r.z)),Oft.CapsuleShape_updateProp(this._impl,o,a,n),this.updateCompoundTransform()}}class ACt{static getBulletBvhTriangleMeshShape(t,e){let i;return ACt.BulletBvhTriangleMeshShapeMap.has(t)?(i=ACt.BulletBvhTriangleMeshShapeMap.get(t),i.reference=!0):(i=new ACt(t,e),ACt.BulletBvhTriangleMeshShapeMap.set(t,i)),i}set reference(t){t?this.ref++:this.ref--,0===this.ref&&this.destroy()}constructor(t,e){this.key=void 0,this.ref=0,this.bulletBvhTriangleMeshShapePtr=void 0,this.btTriangleMeshPtr=0,this.reference=!0,this.key=t,this.btTriangleMeshPtr=Oft.TriangleMesh_new(),$ft(this.btTriangleMeshPtr,e),this.bulletBvhTriangleMeshShapePtr=Oft.BvhTriangleMeshShape_new(this.btTriangleMeshPtr,!0,!0)}destroy(){this.bulletBvhTriangleMeshShapePtr&&Oft._safe_delete(this.bulletBvhTriangleMeshShapePtr,5),this.btTriangleMeshPtr&&Oft._safe_delete(this.btTriangleMeshPtr,8),ACt.BulletBvhTriangleMeshShapeMap.delete(this.key)}}ACt.BulletBvhTriangleMeshShapeMap=new Map;class DCt extends dCt{constructor(...t){super(...t),this.btBVHMeshShape=null,this.refBtTriangleMesh=0}get collider(){return this._collider}setMesh(t){if(!this._isInitialized)return;this._impl&&Lft.isNotEmptyShape(this._impl)&&(this._compound&&Oft.CompoundShape_removeChildShape(this._compound,this._impl),Oft._safe_delete(this._impl,5),Lft.delWrapper(this._impl,dCt.TYPE),this._impl=0);const e=t;if(e&&e.renderingSubMeshes.length>0){if(this.collider.convex){const t=this._getBtTriangleMesh(e);this._impl=Oft.ConvexTriangleMeshShape_new(t)}else this.btBVHMeshShape=ACt.getBulletBvhTriangleMeshShape(e.hash,e),this._impl=Oft.ScaledBvhTriangleMeshShape_new(this.btBVHMeshShape.bulletBvhTriangleMeshShapePtr,1,1,1);const t=Lft.instance.BT_V3_0;Wft(t,this._collider.node.worldScale),Oft.CollisionShape_setLocalScaling(this._impl,t),Oft.CollisionShape_setMargin(this._impl,.01),this.setCompound(this._compound),this.updateByReAdd(),this.setWrapper()}else this._impl=Oft.EmptyShape_static()}onComponentSet(){this.setMesh(this.collider.mesh)}onDestroy(){this.collider.convex?this.refBtTriangleMesh&&Oft._safe_delete(this.refBtTriangleMesh,8):this.btBVHMeshShape&&(this.btBVHMeshShape.reference=!1),super.onDestroy()}updateScale(){super.updateScale();const t=Lft.instance.BT_V3_0;Wft(t,this._collider.node.worldScale),Oft.CollisionShape_setLocalScaling(this._impl,t),this.updateCompoundTransform()}_getBtTriangleMesh(t){return this.refBtTriangleMesh=Oft.TriangleMesh_new(),$ft(this.refBtTriangleMesh,t),this.refBtTriangleMesh}}class ECt extends dCt{setHeight(t){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)}setDirection(t){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)}setRadius(t){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)}get collider(){return this._collider}onComponentSet(){const t=Lft.instance.BT_V3_0;Oft.Vec3_set(t,.5,1,.5),this._impl=Oft.CylinderShape_new(t),this.setRadius(this.collider.radius)}updateScale(){super.updateScale(),this.setRadius(this.collider.radius)}updateProperties(t,e,i,s){const r=s,n=i;let o,a;1===n?(a=e*Math.abs(r.y),o=t*Math.abs(Ki(r.x,r.z))):0===n?(a=e*Math.abs(r.x),o=t*Math.abs(Ki(r.y,r.z))):(a=e*Math.abs(r.z),o=t*Math.abs(Ki(r.x,r.y))),Oft.CylinderShape_updateProp(this._impl,o,a/2,n),this.updateCompoundTransform()}}class ICt extends dCt{setHeight(t){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)}setDirection(t){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)}setRadius(t){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)}get impl(){return this._impl}get collider(){return this._collider}onComponentSet(){this._impl=Oft.ConeShape_new(.5,1),this.setRadius(this.collider.radius)}updateScale(){super.updateScale(),this.setRadius(this.collider.radius)}updateProperties(t,e,i,s){const r=s,n=i;let o,a;1===n?(a=e*Math.abs(r.y),o=t*Math.abs(Ki(r.x,r.z))):0===n?(a=e*Math.abs(r.x),o=t*Math.abs(Ki(r.y,r.z))):(a=e*Math.abs(r.z),o=t*Math.abs(Ki(r.x,r.y))),Oft.ConeShape_setRadius(this._impl,o),Oft.ConeShape_setHeight(this._impl,a),Oft.ConeShape_setConeUpIndex(this._impl,n);const h=Lft.instance.BT_V3_0;Oft.Vec3_set(h,1,1,1),Oft.CollisionShape_setLocalScaling(this._impl,h),this.updateCompoundTransform()}}class MCt extends dCt{constructor(...t){super(...t),this._bufPtr=0,this._tileSize=0,this._localOffset=new Ms}get collider(){return this._collider}setTerrain(t){if(this._isInitialized)if(this._impl&&Lft.isNotEmptyShape(this._impl))M("[Physics][Bullet]: change the terrain asset after initialization is not support.");else{const e=t;if(e){this._tileSize=e.tileSize;const t=e.getVertexCountI(),i=e.getVertexCountJ();this._bufPtr=Oft._malloc(4*t*i);let s=0,r=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;for(let o=0;o<i;o++)for(let i=0;i<t;i++){const t=e.getHeight(i,o);Oft._write_f32(this._bufPtr+s,t),r>t&&(r=t),t>n&&(n=t),s+=4}n+=.01,r-=.01,this._localOffset.set((t-1)/2*this._tileSize,(n+r)/2,(i-1)/2*this._tileSize),this._impl=Oft.TerrainShape_new(t,i,this._bufPtr,1,r,n);const o=Lft.instance.BT_V3_0;Oft.Vec3_set(o,this._tileSize,1,this._tileSize),Oft.CollisionShape_setLocalScaling(this._impl,o),this.setCompound(this._compound),this.updateByReAdd(),this.setWrapper()}else this._impl=Oft.EmptyShape_static()}}onComponentSet(){this.setTerrain(this.collider.terrain)}onDestroy(){this._bufPtr&&Oft._free(this._bufPtr),super.onDestroy()}setCenter(t){Ms.copy(kft,t),kft.add(this._localOffset),Wft(Oft.Transform_getOrigin(this.transform),kft),this.updateCompoundTransform()}}class PCt extends dCt{setShapeType(t){}setVertices(t){}get collider(){return this._collider}onComponentSet(){this._impl=Oft.SimplexShape_new();const t=this.collider.shapeType,e=this.collider.vertices,i=Lft.instance.BT_V3_0;for(let s=0;s<t;s++)Oft.SimplexShape_addVertex(this._impl,Wft(i,e[s]));Oft.CollisionShape_setLocalScaling(this._impl,Wft(i,this._collider.node.worldScale))}onLoad(){super.onLoad(),this.collider.updateVertices()}updateScale(){super.updateScale();const t=Lft.instance.BT_V3_0;Oft.CollisionShape_setLocalScaling(this._impl,Wft(t,this._collider.node.worldScale))}}class OCt extends dCt{setNormal(t){Wft(Oft.StaticPlaneShape_getPlaneNormal(this.impl),t),this.updateCompoundTransform()}setConstant(t){Oft.StaticPlaneShape_setPlaneConstant(this.impl,t),this.updateCompoundTransform()}updateScale(){super.updateScale();const t=Lft.instance.BT_V3_0;Wft(t,this._collider.node.worldScale),Oft.CollisionShape_setLocalScaling(this._impl,t),this.updateCompoundTransform()}get collider(){return this._collider}onComponentSet(){const t=Lft.instance.BT_V3_0;Wft(t,this.collider.normal),this._impl=Oft.StaticPlaneShape_new(t,this.collider.constant),this.updateScale()}}class RCt{constructor(){this.dirty=0,this.index=-1,this._impl=0,this._com=void 0,this._rigidBody=void 0,this._connectedBody=null,this._collided=!1}setConnectedBody(t){if(this._connectedBody===t)return;const e=this._connectedBody;e&&e.body.sharedBody.removeJoint(this,1);const i=this._rigidBody.body.sharedBody;i.removeJoint(this,0),this._impl&&(i.wrappedWorld.removeConstraint(this),Oft._safe_delete(this._impl,13)),this._connectedBody=t;const s=this._connectedBody;this.onComponentSet(),this.setEnableCollision(this._collided),i.wrappedWorld.addConstraint(this),i.addJoint(this,0),s&&s.body.sharedBody.addJoint(this,1)}setEnableCollision(t){this._collided!==t&&(this._collided=t,this.updateByReAdd())}get impl(){return this._impl}get constraint(){return this._com}updateByReAdd(){if(this._rigidBody&&this.index>=0){const t=this._rigidBody.body.sharedBody;t.wrappedWorld.removeConstraint(this),t.wrappedWorld.addConstraint(this)}}initialize(t){this._com=t,this._rigidBody=t.attachedBody,this._connectedBody=t.connectedBody,this._collided=t.enableCollision,this.onComponentSet(),this.setEnableCollision(this._collided)}updateDebugDrawSize(){if(this.impl){const t=_yt.instance.physicsWorld.debugDrawConstraintSize;Oft.TypedConstraint_setDbgDrawSize(this.impl,t)}}onEnable(){const t=this._rigidBody.body.sharedBody;t.wrappedWorld.addConstraint(this),t.addJoint(this,0);const e=this._connectedBody;e&&e.body.sharedBody.addJoint(this,1)}onDisable(){const t=this._rigidBody.body.sharedBody;t.wrappedWorld.removeConstraint(this),t.removeJoint(this,0);const e=this._connectedBody;e&&e.body.sharedBody.removeJoint(this,1)}onDestroy(){Oft._safe_delete(this._impl,13),this._com=null,this._rigidBody=null,this._connectedBody=null}}class BCt extends RCt{setPivotA(t){const e=this.constraint,i=Lft.instance.BT_V3_0;Ms.multiply(kft,e.node.worldScale,e.pivotA),Wft(i,kft),Oft.P2PConstraint_setPivotA(this._impl,i),e.connectedBody||this.setPivotB(e.pivotB)}setPivotB(t){const e=this.constraint,i=this._rigidBody.node,s=Lft.instance.BT_V3_0,r=e.connectedBody;r?(Ms.multiply(kft,r.node.worldScale,e.pivotB),Wft(s,kft)):(Ms.multiply(kft,i.worldScale,e.pivotA),Ms.transformQuat(kft,kft,i.worldRotation),Ms.add(kft,kft,i.worldPosition),Wft(s,kft)),Oft.P2PConstraint_setPivotB(this._impl,s)}get constraint(){return this._com}onComponentSet(){const t=this.constraint.connectedBody,e=this._rigidBody.body.impl,i=t?t.body.impl:Oft.TypedConstraint_getFixedBody(),s=Lft.instance.BT_V3_0,r=Lft.instance.BT_V3_1;this._impl=Oft.P2PConstraint_new(e,i,s,r),this.setPivotA(this.constraint.pivotA),this.setPivotB(this.constraint.pivotB),this.updateDebugDrawSize()}updateScale0(){this.setPivotA(this.constraint.pivotA)}updateScale1(){this.setPivotB(this.constraint.pivotB)}}class FCt extends RCt{setBreakForce(t){Oft.TypedConstraint_setMaxImpulseThreshold(this._impl,t)}setBreakTorque(t){}get constraint(){return this._com}onComponentSet(){const t=this.constraint.connectedBody,e=this._rigidBody.body.impl,i=t?t.body.impl:Oft.TypedConstraint_getFixedBody(),s=Lft.instance.BT_TRANSFORM_0,r=Lft.instance.BT_TRANSFORM_1;this._impl=Oft.FixedConstraint_new(e,i,s,r),this.setBreakForce(this.constraint.breakForce),this.setBreakTorque(this.constraint.breakTorque),this.updateFrames(),this.updateDebugDrawSize()}updateFrames(){const t=this.constraint.connectedBody,e=this._rigidBody.body.sharedBody,i=kft,s=Vft,r=Oft.Transform_new(),n=Oft.Transform_new(),o=Oft.Quat_new(0,0,0,1),a=Hft;if(vr.fromRT(a,e.node.worldRotation,e.node.worldPosition),vr.invert(a,a),vr.getRotation(s,a),vr.getTranslation(i,a),Wft(Oft.Transform_getOrigin(r),i),Yft(o,s),Oft.Transform_setRotation(r,o),t){const e=t.body.sharedBody;vr.fromRT(a,e.node.worldRotation,e.node.worldPosition),vr.invert(a,a),vr.getRotation(s,a),vr.getTranslation(i,a),Wft(Oft.Transform_getOrigin(n),i),Yft(o,s),Oft.Transform_setRotation(n,o)}else Oft.Transform_setIdentity(n);Oft.FixedConstraint_setFrames(this._impl,r,n),Oft._safe_delete(r,2),Oft._safe_delete(n,2),Oft._safe_delete(o,1)}updateScale0(){this.updateFrames()}updateScale1(){this.updateFrames()}}class NCt extends RCt{setPivotA(t){this.updateFrames()}setPivotB(t){this.updateFrames()}setAxis(t){this.updateFrames()}setLimitEnabled(t){this.constraint.limitEnabled?Oft.HingeConstraint_setLimit(this._impl,Ni(this.constraint.lowerLimit),Ni(this.constraint.upperLimit),.9,.3,1):Oft.HingeConstraint_setLimit(this._impl,1,0,.9,.3,1)}setLowerLimit(t){this.constraint.limitEnabled&&Oft.HingeConstraint_setLimit(this._impl,Ni(this.constraint.lowerLimit),Ni(this.constraint.upperLimit),.9,.3,1)}setUpperLimit(t){this.constraint.limitEnabled&&Oft.HingeConstraint_setLimit(this._impl,Ni(this.constraint.lowerLimit),Ni(this.constraint.upperLimit),.9,.3,1)}setMotorEnabled(t){Oft.HingeConstraint_enableMotor(this._impl,t);const e=-this.constraint.motorVelocity/60,i=Kft(this.constraint.motorForceLimit,_yt.instance.fixedTimeStep);Oft.HingeConstraint_setMotorVelocity(this._impl,e),Oft.HingeConstraint_setMaxMotorImpulse(this._impl,i)}setMotorVelocity(t){if(this.constraint.motorEnabled){const e=-t/60;Oft.HingeConstraint_setMotorVelocity(this._impl,e)}}setMotorForceLimit(t){if(this.constraint.motorEnabled){const e=Kft(t,_yt.instance.fixedTimeStep);Oft.HingeConstraint_setMaxMotorImpulse(this._impl,e)}}get constraint(){return this._com}onComponentSet(){const t=this.constraint.connectedBody,e=this._rigidBody.body.impl,i=t?t.body.impl:Oft.TypedConstraint_getFixedBody(),s=Lft.instance.BT_TRANSFORM_0,r=Lft.instance.BT_TRANSFORM_1;this._impl=Oft.HingeConstraint_new(e,i,s,r),this.setLimitEnabled(this.constraint.limitEnabled),this.setLowerLimit(this.constraint.lowerLimit),this.setUpperLimit(this.constraint.upperLimit),this.setMotorEnabled(this.constraint.motorEnabled),this.setMotorVelocity(this.constraint.motorVelocity),this.setMotorForceLimit(this.constraint.motorForceLimit),this.updateFrames(),this.updateDebugDrawSize()}updateFrames(){const t=this.constraint,e=t.node,i=kft,s=Vft,r=jft,n=Lft.instance.BT_TRANSFORM_0;Ms.multiply(i,e.worldScale,t.pivotA),Wft(Oft.Transform_getOrigin(n),i);const o=Lft.instance.BT_QUAT_0;Ms.normalize(i,t.axis),sr.rotationTo(r,Ms.UNIT_Z,i),Yft(o,r),Oft.Transform_setRotation(n,o);const a=Lft.instance.BT_TRANSFORM_1,h=this.constraint.connectedBody;h?(Ms.multiply(i,h.node.worldScale,t.pivotB),sr.multiply(r,e.worldRotation,r),sr.invert(s,h.node.worldRotation),sr.multiply(r,s,r)):(Ms.multiply(i,e.worldScale,t.pivotA),Ms.transformQuat(i,i,e.worldRotation),Ms.add(i,i,e.worldPosition),sr.multiply(r,e.worldRotation,r)),Wft(Oft.Transform_getOrigin(a),i),Yft(o,r),Oft.Transform_setRotation(a,o),Oft.HingeConstraint_setFrames(this._impl,n,a)}updateScale0(){this.updateFrames()}updateScale1(){this.updateFrames()}}class LCt extends RCt{_setLimit(t,e,i,s){switch(t){case 2:Oft.Generic6DofSpring2Constraint_setLimit(this._impl,e,0,0);break;case 1:Oft.Generic6DofSpring2Constraint_setLimit(this._impl,e,i,s);break;case 0:Oft.Generic6DofSpring2Constraint_setLimit(this._impl,e,1,0)}}setConstraintMode(t,e){const i=this.constraint.linearLimitSettings,s=this.constraint.angularLimitSettings,r=[0,0,0],n=[0,0,0];let o=0,a=0;switch(t){case 0:case 1:case 2:Ms.toArray(r,i.lower),Ms.toArray(n,i.upper),a=r[t],o=n[t];break;case 3:o=.5*Ni(s.twistExtent),a=-o;break;case 4:o=.5*Ni(s.swingExtent1),a=-o;break;case 5:o=.5*Ni(s.swingExtent2),a=-o;break;default:P(`idx should be in [0, 5], but give ${t}`)}this._setLimit(e,t,a,o)}setLinearLimit(t,e,i){let s=0;const r=this.constraint.linearLimitSettings;switch(t){case 0:s=r.xMotion;break;case 1:s=r.yMotion;break;case 2:s=r.zMotion}this._setLimit(s,t,e,i)}setAngularExtent(t,e,i){const s=this.constraint.angularLimitSettings;this._setLimit(s.twistMotion,3,.5*-Ni(t),.5*Ni(t)),this._setLimit(s.swingMotion1,4,.5*-Ni(e),.5*Ni(e)),this._setLimit(s.swingMotion2,5,.5*-Ni(i),.5*Ni(i))}setSwingSoftConstraint(t){Oft.Generic6DofSpring2Constraint_enableSpring(this._impl,4,t),Oft.Generic6DofSpring2Constraint_enableSpring(this._impl,5,t)}setTwistSoftConstraint(t){Oft.Generic6DofSpring2Constraint_enableSpring(this._impl,3,t)}setLinearSoftConstraint(t){Oft.Generic6DofSpring2Constraint_enableSpring(this._impl,0,t),Oft.Generic6DofSpring2Constraint_enableSpring(this._impl,1,t),Oft.Generic6DofSpring2Constraint_enableSpring(this._impl,2,t)}setLinearStiffness(t){Oft.Generic6DofSpring2Constraint_setStiffness(this._impl,0,t),Oft.Generic6DofSpring2Constraint_setStiffness(this._impl,1,t),Oft.Generic6DofSpring2Constraint_setStiffness(this._impl,2,t)}setLinearDamping(t){Oft.Generic6DofSpring2Constraint_setDamping(this._impl,0,t),Oft.Generic6DofSpring2Constraint_setDamping(this._impl,1,t),Oft.Generic6DofSpring2Constraint_setDamping(this._impl,2,t)}setLinearRestitution(t){Oft.Generic6DofSpring2Constraint_setBounce(this._impl,0,t),Oft.Generic6DofSpring2Constraint_setBounce(this._impl,1,t),Oft.Generic6DofSpring2Constraint_setBounce(this._impl,2,t)}setSwingStiffness(t){Oft.Generic6DofSpring2Constraint_setStiffness(this._impl,4,t),Oft.Generic6DofSpring2Constraint_setStiffness(this._impl,5,t)}setSwingDamping(t){Oft.Generic6DofSpring2Constraint_setDamping(this._impl,4,t),Oft.Generic6DofSpring2Constraint_setDamping(this._impl,5,t)}setSwingRestitution(t){Oft.Generic6DofSpring2Constraint_setBounce(this._impl,4,t),Oft.Generic6DofSpring2Constraint_setBounce(this._impl,5,t)}setTwistStiffness(t){Oft.Generic6DofSpring2Constraint_setStiffness(this._impl,3,t)}setTwistDamping(t){Oft.Generic6DofSpring2Constraint_setDamping(this._impl,3,t)}setTwistRestitution(t){Oft.Generic6DofSpring2Constraint_setBounce(this._impl,3,t)}setDriverMode(t,e){0===e?Oft.Generic6DofSpring2Constraint_enableMotor(this._impl,t,!1):1===e?(Oft.Generic6DofSpring2Constraint_enableMotor(this._impl,t,!0),Oft.Generic6DofSpring2Constraint_setServo(this._impl,t,!0)):2===e&&(Oft.Generic6DofSpring2Constraint_enableMotor(this._impl,t,!0),Oft.Generic6DofSpring2Constraint_setServo(this._impl,t,!1))}_updateMotorTargetAndVelocity(t){let e=0,i=0,s=0,r=0;const n=this.constraint.linearDriverSettings,o=this.constraint.angularDriverSettings;switch(t){case 0:i=0,e=n.xDrive,s=n.targetPosition.x,r=-n.targetVelocity.x;break;case 1:i=1,e=n.yDrive,s=n.targetPosition.y,r=-n.targetVelocity.y;break;case 2:i=2,e=n.zDrive,s=n.targetPosition.z,r=-n.targetVelocity.z;break;case 3:i=3,e=o.twistDrive,s=-Ni(o.targetOrientation.x),r=-Ni(o.targetVelocity.x);break;case 4:i=4,e=o.swingDrive1,s=-Ni(o.targetOrientation.y),r=-Ni(o.targetVelocity.y);break;case 5:i=5,e=o.swingDrive2,s=-Ni(o.targetOrientation.z),r=-Ni(o.targetVelocity.z)}const a=t>2?o.strength:n.strength;Oft.Generic6DofSpring2Constraint_setServoTarget(this._impl,i,s),1===e?t>2?Oft.Generic6DofSpring2Constraint_setTargetVelocity(this._impl,i,-s*a*.1):Oft.Generic6DofSpring2Constraint_setTargetVelocity(this._impl,i,s*a*.1):2===e&&Oft.Generic6DofSpring2Constraint_setTargetVelocity(this._impl,i,r)}setLinearMotorTarget(t){this._updateMotorTargetAndVelocity(0),this._updateMotorTargetAndVelocity(1),this._updateMotorTargetAndVelocity(2)}setLinearMotorVelocity(t){this._updateMotorTargetAndVelocity(0),this._updateMotorTargetAndVelocity(1),this._updateMotorTargetAndVelocity(2)}setLinearMotorForceLimit(t){Oft.Generic6DofSpring2Constraint_setMaxMotorForce(this._impl,0,t),Oft.Generic6DofSpring2Constraint_setMaxMotorForce(this._impl,1,t),Oft.Generic6DofSpring2Constraint_setMaxMotorForce(this._impl,2,t)}setAngularMotorTarget(t){this._updateMotorTargetAndVelocity(3),this._updateMotorTargetAndVelocity(4),this._updateMotorTargetAndVelocity(5)}setAngularMotorVelocity(t){this._updateMotorTargetAndVelocity(3),this._updateMotorTargetAndVelocity(4),this._updateMotorTargetAndVelocity(5)}setAngularMotorForceLimit(t){Oft.Generic6DofSpring2Constraint_setMaxMotorForce(this._impl,3,t),Oft.Generic6DofSpring2Constraint_setMaxMotorForce(this._impl,4,t),Oft.Generic6DofSpring2Constraint_setMaxMotorForce(this._impl,5,t)}setPivotA(t){this.updateFrames()}setPivotB(t){this.updateFrames()}setAutoPivotB(t){this.updateFrames()}setAxis(t){this.updateFrames()}setSecondaryAxis(t){this.updateFrames()}setBreakForce(t){const e=Kft(Math.max(this.constraint.breakForce,this.constraint.breakTorque),_yt.instance.fixedTimeStep);Oft.TypedConstraint_setMaxImpulseThreshold(this._impl,e)}setBreakTorque(t){const e=Kft(Math.max(this.constraint.breakForce,this.constraint.breakTorque),_yt.instance.fixedTimeStep);Oft.TypedConstraint_setMaxImpulseThreshold(this._impl,e)}get constraint(){return this._com}onComponentSet(){const t=this.constraint.connectedBody,e=this._rigidBody.body.impl,i=t&&t.body.impl||Oft.TypedConstraint_getFixedBody(),s=Lft.instance.BT_TRANSFORM_0,r=Lft.instance.BT_TRANSFORM_1;this._impl=Oft.Generic6DofSpring2Constraint_new(e,i,s,r,3);const n=this.constraint.linearLimitSettings,o=this.constraint.angularLimitSettings;this.setConstraintMode(0,n.xMotion),this.setConstraintMode(1,n.yMotion),this.setConstraintMode(2,n.zMotion),this.setConstraintMode(3,o.twistMotion),this.setConstraintMode(4,o.swingMotion1),this.setConstraintMode(5,o.swingMotion2),this.setLinearSoftConstraint(n.enableSoftConstraint),this.setLinearStiffness(n.stiffness),this.setLinearDamping(n.damping),this.setLinearRestitution(n.restitution),this.setSwingSoftConstraint(o.enableSoftConstraintSwing),this.setSwingRestitution(o.swingRestitution),this.setSwingStiffness(o.swingStiffness),this.setSwingDamping(o.swingDamping),this.setTwistSoftConstraint(o.enableSoftConstraintTwist),this.setTwistRestitution(o.twistRestitution),this.setTwistStiffness(o.twistStiffness),this.setTwistDamping(o.twistDamping);const a=this.constraint.linearDriverSettings,h=this.constraint.angularDriverSettings;this.setDriverMode(0,a.xDrive),this.setDriverMode(1,a.yDrive),this.setDriverMode(2,a.zDrive),this.setDriverMode(3,h.twistDrive),this.setDriverMode(4,h.swingDrive1),this.setDriverMode(5,h.swingDrive2),this.setLinearMotorTarget(a.targetPosition),this.setLinearMotorVelocity(a.targetVelocity),this.setLinearMotorForceLimit(a.strength),this.setAngularMotorTarget(h.targetOrientation),this.setAngularMotorVelocity(h.targetVelocity),this.setAngularMotorForceLimit(h.strength),this.setBreakForce(this.constraint.breakForce),this.setBreakTorque(this.constraint.breakTorque),this.updateFrames(),this.updateDebugDrawSize()}updateFrames(){const t=this.constraint,e=t.node,i=kft,s=Vft,r=jft,n=Oft.Transform_new();Ms.multiply(i,e.worldScale,t.pivotA),Wft(Oft.Transform_getOrigin(n),i);const o=Oft.Quat_new(0,0,0,1),a=t.axis,h=t.secondaryAxis,l=Ms.cross(zft,a,h);vr.set(Hft,a.x,a.y,a.z,0,h.x,h.y,h.z,0,l.x,l.y,l.z,0,0,0,0,1).getRotation(s),Yft(o,s),Oft.Transform_setRotation(n,o);const c=Oft.Transform_new(),u=this.constraint.connectedBody;u?(sr.multiply(s,e.worldRotation,s),sr.invert(r,u.node.worldRotation),sr.multiply(s,r,s),t.autoPivotB?(Ms.multiply(i,t.node.worldScale,t.pivotA),Ms.transformQuat(i,i,e.worldRotation),Ms.add(i,i,t.node.worldPosition),Ms.subtract(i,i,u.node.worldPosition),Ms.transformQuat(i,i,r)):Ms.multiply(i,u.node.worldScale,t.pivotB)):(Ms.multiply(i,e.worldScale,t.pivotA),Ms.transformQuat(i,i,e.worldRotation),Ms.add(i,i,e.worldPosition),sr.multiply(s,e.worldRotation,s)),Wft(Oft.Transform_getOrigin(c),i),Yft(o,s),Oft.Transform_setRotation(c,o),Oft.Generic6DofSpring2Constraint_setFrames(this._impl,n,c),Oft._safe_delete(n,2),Oft._safe_delete(c,2),Oft._safe_delete(o,1)}updateScale0(){this.updateFrames()}updateScale1(){this.updateFrames()}}const kCt=new Ms(0,0,0),zCt=new Ms(0,0,0);new Ms(0,0,0);class UCt{get isEnabled(){return this._isEnabled}get impl(){return this._impl}get characterController(){return this._comp}constructor(){this.wrappedWorld=void 0,this._isEnabled=!1,this._impl=0,this._comp=null,this._btCollisionFlags=0,this._word3=0,this._dirty=!1,this._collisionFilterGroup=1,this._collisionFilterMask=-1,this.id=UCt.idCounter++,this.wrappedWorld=_yt.instance.physicsWorld}onComponentSet(){}updateScale(){}initialize(t){this._comp=t;const e=this._comp.group,i=_yt.instance.collisionMatrix[e];return this._collisionFilterGroup=e,this._collisionFilterMask=i,this.onComponentSet(),0!==this._impl||(P("[Physics]: Initialize BulletCharacterController failed"),!1)}setWrapper(){Lft.setWrapper(this._impl,Rft.CCT_CACHE_NAME,this);const t=Oft.CharacterController_getCollisionShape(this.impl);Lft.setWrapper(t,Rft.CCT_CACHE_NAME,this)}onEnable(){this._isEnabled=!0,this._impl||this.onComponentSet(),this.setDetectCollisions(!1),this.setOverlapRecovery(!0),_yt.instance.physicsWorld.addCCT(this),this.setWrapper()}onDisable(){this._isEnabled=!1,this.wrappedWorld.removeCCT(this),this.onDestroy()}onDestroy(){Oft._safe_delete(this._impl,6),Lft.delWrapper(this._impl,Rft.CCT_CACHE_NAME),this._impl=0}onLoad(){}getPosition(t){this._impl&&Xft(t,Oft.CharacterController_getPosition(this.impl))}setPosition(t){this._impl&&(Wft(Oft.CharacterController_getPosition(this.impl),t),this.syncPhysicsToScene())}setContactOffset(t){this._impl&&Oft.CharacterController_setContactOffset(this._impl,t)}setStepOffset(t){this._impl&&Oft.CharacterController_setStepOffset(this._impl,t)}setSlopeLimit(t){this._impl&&Oft.CharacterController_setSlopeLimit(this._impl,Fe(t))}setDetectCollisions(t){this._impl&&Oft.CharacterController_setCollision(this.impl,t)}setOverlapRecovery(t){this._impl&&Oft.CharacterController_setOverlapRecovery(this.impl,t)}onGround(){return(4&this._btCollisionFlags)>0}syncSceneToPhysics(){const t=this.characterController.node;t.hasChangedFlags&&(4&t.hasChangedFlags&&this.syncScale(),1&t.hasChangedFlags&&(Ms.add(kCt,t.worldPosition,this.scaledCenter),this.setPosition(kCt)))}syncPhysicsToScene(){this.getPosition(kCt),kCt.subtract(this.scaledCenter),this._comp.node.setWorldPosition(kCt)}syncScale(){this.updateScale()}get scaledCenter(){return Ms.multiply(zCt,this._comp.center,this._comp.node.worldScale),zCt}move(t,e,i){if(!this._isEnabled)return;const s=Lft.instance.BT_V3_0;Oft.Vec3_set(s,t.x,t.y,t.z),this._btCollisionFlags=Oft.CharacterController_move(this.impl,s,e,i)}setGroup(t){t!==this._collisionFilterGroup&&(this._collisionFilterGroup=t,this._dirty=!0)}getGroup(){return this._collisionFilterGroup}addGroup(t){this._collisionFilterGroup|=t,this._dirty=!0}removeGroup(t){this._collisionFilterGroup&=~t,this._dirty=!0}setMask(t){t!==this._collisionFilterMask&&(this._collisionFilterMask=t,this._dirty=!0)}getMask(){return this._collisionFilterMask}addMask(t){this._collisionFilterMask|=t,this._dirty=!0}removeMask(t){this._collisionFilterMask&=~t,this._dirty=!0}updateEventListener(){this.wrappedWorld.updateNeedEmitCCTEvents(this.characterController.needCollisionEvent)}updateDirty(){this._dirty&&(_yt.instance.physicsWorld.removeCCT(this),_yt.instance.physicsWorld.addCCT(this),this._dirty=!1)}onShapeHitExt(t){const e=Oft.ControllerShapeHit_getHitShape(t),i=_yt.instance.physicsWorld;i.cctShapeEventDic.get(this.impl,e);const s=new Ms;Xft(s,Oft.ControllerHit_getHitWorldPos(t));const r=new Ms;Xft(r,Oft.ControllerHit_getHitWorldNormal(t));const n=new Ms;Xft(n,Oft.ControllerHit_getHitMotionDir(t));const o=Oft.ControllerHit_getHitMotionLength(t),a=Lft.getWrapper(e,dCt.TYPE);a&&i.cctShapeEventDic.set(this.impl,e,{BulletCharacterController:this,BulletShape:a,worldPos:s,worldNormal:r,motionDir:n,motionLength:o})}}UCt.idCounter=0;const VCt=new Ms(0,0,0);class jCt extends UCt{get component(){return this._comp}onComponentSet(){this.component.node.getWorldPosition(VCt),VCt.add(this.scaledCenter);const t=Lft.instance.BT_V3_0;Oft.Vec3_set(t,VCt.x,VCt.y,VCt.z);const e=Ms.UNIT_Y,i=Lft.instance.BT_V3_1;Oft.Vec3_set(i,e.x,e.y,e.z);const s=Oft.ControllerHitReport.implement(nCt).$$.ptr,r=_yt.instance.physicsWorld,n=Oft.CapsuleCharacterControllerDesc_new(Fe(this.component.slopeLimit),this.component.stepOffset,this.component.skinWidth,i,t,s,this.component.radius,this.component.height);this._impl=Oft.CapsuleCharacterController_new(r.impl,n,0),this.updateScale()}setRadius(t){this.updateScale()}setHeight(t){this.updateScale()}updateScale(){this.updateGeometry()}updateGeometry(){const t=this.component.node.worldScale,e=this.component.radius*Ki(t.x,t.z),i=this.component.height*Math.abs(t.y);Oft.CapsuleCharacterController_setRadius(this.impl,e),Oft.CapsuleCharacterController_setHeight(this.impl,i),this._dirty=!0}}const HCt=new Ms(0,0,0);class GCt extends UCt{get component(){return this._comp}onComponentSet(){this.component.node.getWorldPosition(HCt),HCt.add(this.scaledCenter);const t=Lft.instance.BT_V3_0;Oft.Vec3_set(t,HCt.x,HCt.y,HCt.z);const e=Ms.UNIT_Y,i=Lft.instance.BT_V3_1;Oft.Vec3_set(i,e.x,e.y,e.z);const s=Oft.ControllerHitReport.implement(nCt).$$.ptr,r=_yt.instance.physicsWorld,n=Oft.BoxCharacterControllerDesc_new(Fe(this.component.slopeLimit),this.component.stepOffset,this.component.skinWidth,i,t,s,this.component.halfHeight,this.component.halfSideExtent,this.component.halfForwardExtent);this._impl=Oft.BoxCharacterController_new(r.impl,n,0),this.updateScale()}setHalfHeight(t){this.updateScale()}setHalfSideExtent(t){this.updateScale()}setHalfForwardExtent(t){this.updateScale()}updateScale(){this.updateGeometry()}updateGeometry(){const t=this.component.node.worldScale;Oft.BoxCharacterController_setHalfSideExtent(this.impl,this.component.halfSideExtent*t.x),Oft.BoxCharacterController_setHalfHeight(this.impl,this.component.halfHeight*t.y),Oft.BoxCharacterController_setHalfForwardExtent(this.impl,this.component.halfForwardExtent*t.z),this._dirty=!0}}var WCt,XCt,YCt,qCt,$Ct,KCt,ZCt;JA.once(QA.EVENT_PRE_SUBSYSTEM_INIT,(()=>{pft.register("bullet",{PhysicsWorld:TCt,RigidBody:rCt,BoxShape:wCt,SphereShape:xCt,CapsuleShape:CCt,TrimeshShape:DCt,CylinderShape:ECt,ConeShape:ICt,TerrainShape:MCt,SimplexShape:PCt,PlaneShape:OCt,PointToPointConstraint:BCt,HingeConstraint:NCt,FixedConstraint:FCt,ConfigurableConstraint:LCt,BoxCharacterController:GCt,CapsuleCharacterController:jCt})}));const QCt={BOX:0,SPHERE:1,CYLINDER:2,CONE:3,CAPSULE:4,TORUS:5,PLANE:6,QUAD:7};pe(QCt);let JCt=t("Primitive",(WCt=ah("cc.Primitive"),XCt=Xh(QCt),WCt((ZCt=class extends uL{constructor(t=0){super(),this.type=$Ct&&$Ct(),this.info=KCt&&KCt(),this.type=t}onLoaded(){const t=vH[QCt[this.type].toLowerCase()];lD(t(this.info),this)}},ZCt.PrimitiveType=QCt,$Ct=Za((qCt=ZCt).prototype,"type",[XCt],(function(){return 0})),KCt=Za(qCt.prototype,"info",[vh],(function(){return{}})),YCt=qCt))||YCt));a.Primitive=JCt,h.primitives=vH;class tAt{get value(){return this._value}set value(t){this._value=t}constructor(t,e,i){this._total=0,this._value=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._id=t,this._opts=e,this._accumStart=i}sample(t){this._average(this._value,t)}human(){const{average:t,isInteger:e}=this._opts,i=t?this._averageValue:this._value;return e?Math.round(i):Math.round(100*i)/100}alarm(){return void 0!==this._opts.below&&this._value<this._opts.below||void 0!==this._opts.over&&this._value>this._opts.over}_average(t,e=0){if(this._opts.average){this._accumValue+=t,++this._accumSamples;const i=e;i-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=i,this._accumSamples=0)}}}var eAt;let iAt=ah("cc.PerfCounter")(eAt=class extends tAt{constructor(t,e,i){super(t,e,i),this._time=i}start(t=0){this._time=t}end(t=0){this._value=t-this._time,this._average(this._value)}tick(){this.end(),this.start()}frame(t){const e=t,i=e-this._time;this._total++,i>(this._opts.average||1e3)&&(this._value=1e3*this._total/i,this._total=0,this._time=e,this._average(this._value))}})||eAt;const sAt="0123456789. ",rAt=500,nAt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,".":10},oAt={fps:{desc:"Framerate (FPS)",below:30,average:rAt,isInteger:!0},draws:{desc:"Draw call",isInteger:!0},frame:{desc:"Frame time (ms)",min:0,max:50,average:rAt},instances:{desc:"Instance Count",isInteger:!0},tricount:{desc:"Triangle",isInteger:!0},logic:{desc:"Game Logic (ms)",min:0,max:50,average:rAt,color:"#080"},physics:{desc:"Physics (ms)",min:0,max:50,average:rAt},render:{desc:"Renderer (ms)",min:0,max:50,average:rAt,color:"#f90"},present:{desc:"Present (ms)",min:0,max:50,average:rAt,color:"#f90"},textureMemory:{desc:"GFX Texture Mem(M)"},bufferMemory:{desc:"GFX Buffer Mem(M)"}},aAt={fontSize:23,quadHeight:.4,segmentsPerLine:8,textureWidth:280,textureHeight:280};class hAt extends Bu{constructor(){super(),this._profilerStats=null,this._showFPS=!1,this._rootNode=null,this._device=null,this._swapchain=null,this._meshRenderer=null,this._canvas=null,this._ctx=null,this._texture=null,this._region=new t_,this._canvasArr=[],this._regionArr=[this._region],this.digitsData=null,this.offsetData=null,this.pass=null,this._canvasDone=!1,this._statsDone=!1,this._inited=!1,this._lineHeight=aAt.textureHeight/(Object.keys(oAt).length+1),this._wordHeight=0,this._eachNumWidth=0,this._totalLines=0,this.lastTime=0,this._backgroundColor=new Ls(150,150,150,100),this._fontColor=Ls.WHITE.clone()}init(){Se.querySettings("profiling","showFPS")?this.showStats():this.hideStats()}setBackgroundColor(t){this._backgroundColor.equals(t)||(this._backgroundColor.set(t),this._showFPS&&(this.hideStats(),this.showStats()))}setFontColor(t){this._fontColor.equals(t)||(this._fontColor.set(t),this._showFPS&&(this.hideStats(),this.showStats()))}get _stats(){return j(16381),this._profilerStats}get stats(){return this._profilerStats}isShowingStats(){return this._showFPS}hideStats(){const t=this;if(t._showFPS){t._profilerStats=null,t._rootNode&&(t._rootNode.destroy(),t._rootNode=null),t._device=null,t._swapchain=null;const s=t._meshRenderer;var e,i;s&&(null==(e=s.sharedMaterial)||e.destroy(),null==(i=s.mesh)||i.destroy(),s.destroy(),t._meshRenderer=null),t._canvas=null,t._ctx=null,t._texture&&(t._texture.destroy(),t._texture=null),t._canvasArr.length=0,t.digitsData=null,t.offsetData=null,t.pass=null,t._canvasDone=!1,t._statsDone=!1,t._inited=!1,t._wordHeight=0,t._eachNumWidth=0,t._totalLines=0,t.lastTime=0,nC.off("director_before_update",t.beforeUpdate,t),nC.off("director_after_update",t.afterUpdate,t),nC.off("director_before_physics",t.beforePhysics,t),nC.off("director_after_physics",t.afterPhysics,t),nC.off("director_before_draw",t.beforeDraw,t),nC.off("director_after_render",t.afterRender,t),nC.off("director_after_draw",t.afterPresent,t),t._showFPS=!1,nC.root.pipeline.profiler=null,a.game.config.showFPS=!1}}showStats(){const t=a.game;if(!this._showFPS){if(this._canvas=c.document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvasArr.push(this._canvas),!this._device){const t=a.director.root;this._device=yp.gfxDevice,this._swapchain=t.mainWindow.swapchain}this.generateCanvas(),this.generateStats(),t.once(QA.EVENT_ENGINE_INITED,this.generateNode,this),t.on(QA.EVENT_RESTART,this.generateNode,this),this._rootNode&&(this._rootNode.active=!0),nC.on("director_before_update",this.beforeUpdate,this),nC.on("director_after_update",this.afterUpdate,this),nC.on("director_before_physics",this.beforePhysics,this),nC.on("director_after_physics",this.afterPhysics,this),nC.on("director_before_draw",this.beforeDraw,this),nC.on("director_after_render",this.afterRender,this),nC.on("director_after_draw",this.afterPresent,this),this._showFPS=!0,this._canvasDone=!0,this._statsDone=!0,t.config.showFPS=!0}}generateCanvas(){if(this._canvasDone)return;const{textureWidth:t,textureHeight:e}=aAt,i=this._canvas,s=this._ctx;if(!s||!i)return;i.width=t,i.height=e,i.style.width=`${i.width}`,i.style.height=`${i.height}`,s.font=`${aAt.fontSize}px Arial`,s.textBaseline="top";const r=this._fontColor;s.fillStyle=`rgba(${r.r}, ${r.g}, ${r.b}, ${r.a/255})`,this._texture=this._device.createTexture(new d_(1,6,35,t,e));const n=this._region.texExtent;n.width=t,n.height=e}generateStats(){const t=this._canvas,e=this._ctx;if(this._statsDone||!e||!t)return;this._profilerStats=null;const i=performance.now();e.textAlign="left";let s=0;for(const t in oAt){const r=oAt[t];e.fillText(r.desc,0,s*this._lineHeight),r.counter=new iAt(t,r,i),s++}this._totalLines=s,this._wordHeight=this._totalLines*this._lineHeight/t.height;let r=0;for(r=0;r<12;++r){const t=e.measureText(sAt[r]).width;this._eachNumWidth=Math.max(this._eachNumWidth,t)}for(r=0;r<12;++r)e.fillText(sAt[r],r*this._eachNumWidth,this._totalLines*this._lineHeight);const n=this._backgroundColor;e.fillStyle=`rgba(${n.r}, ${n.g}, ${n.b}, ${n.a/255})`,e.fillRect(t.width-4,t.height-4,4,4),this._eachNumWidth/=t.width,this._profilerStats=oAt,this._canvasArr[0]=t,this._device.copyTexImagesToTexture(this._canvasArr,this._texture,this._regionArr)}generateNode(){if(this._rootNode&&this._rootNode.isValid)return;const t=this._canvas;this._rootNode=new tb("PROFILER_NODE"),this._rootNode._objFlags=1032,JA.addPersistRootNode(this._rootNode);const e=new tb("Profiler_Root");e.parent=this._rootNode;const i=aAt.quadHeight,s=i/this._totalLines,r=i/this._wordHeight,n=s/aAt.fontSize,o=this._eachNumWidth*t.width*n,a=r+aAt.segmentsPerLine*o,h=[-o,i+o,0,a+o,i+o,0,a+o,-o,0,-o,-o,0],l=[0,2,1,0,3,2],c=(t.width-3)/t.width,u=(t.height-3)/t.height,d=(t.width-1)/t.width,_=(t.height-1)/t.width,p=[c,u,-1,0,d,u,-1,0,d,_,-1,0,c,_,-1,0];h.push(0,i,0,r,i,0,r,0,0,0,0,0),l.push(4,6,5,4,7,6),p.push(0,0,-1,0,1,0,-1,0,1,this._wordHeight,-1,0,0,this._wordHeight,-1,0);let m=0;for(let t=0;t<this._totalLines;t++)for(let e=0;e<aAt.segmentsPerLine;e++){h.push(r+e*o,i-t*s,0),h.push(r+(e+1)*o,i-t*s,0),h.push(r+(e+1)*o,i-(t+1)*s,0),h.push(r+e*o,i-(t+1)*s,0),m=4*(t*aAt.segmentsPerLine+e+2),l.push(0+m,2+m,1+m,0+m,3+m,2+m);const n=t*aAt.segmentsPerLine+e,a=Math.floor(n/4),c=n-4*a;p.push(0,this._wordHeight,a,c),p.push(this._eachNumWidth,this._wordHeight,a,c),p.push(this._eachNumWidth,1,a,c),p.push(0,1,a,c)}this._meshRenderer=e.addComponent(Tk),this._meshRenderer.mesh=lD({positions:h,indices:l,colors:p});const g=new fv;g.initialize({effectName:"util/profiler"});const f=this.pass=g.passes[0],y=f.getBinding("mainTexture"),b=f.getBinding("digits"),v=f.getBinding("offset");f.bindTexture(y,this._texture),this.digitsData=f.blocks[b],this.offsetData=f.blocks[v],this.offsetData[3]=-1,this._meshRenderer.material=g,this._meshRenderer.node.layer=Hy.Enum.PROFILER,this._inited=!0}beforeUpdate(){const t=this._profilerStats;if(!t)return;const e=performance.now();t.frame.counter.start(e),t.logic.counter.start(e)}afterUpdate(){const t=this._profilerStats;if(!t)return;const e=performance.now();nC.isPaused()?t.frame.counter.start(e):t.logic.counter.end(e)}beforePhysics(){if(!this._profilerStats)return;const t=performance.now();this._profilerStats.physics.counter.start(t)}afterPhysics(){if(!this._profilerStats)return;const t=performance.now();this._profilerStats.physics.counter.end(t)}beforeDraw(){if(!this._profilerStats||!this._inited)return;const t=this._swapchain.surfaceTransform,e=this._device.capabilities.clipSpaceSignY;if(t!==this.offsetData[3]){const i=_r[t];let s=-.9,r=-.9*e;this.offsetData[0]=s*i[0]+r*i[2],this.offsetData[1]=s*i[1]+r*i[3],this.offsetData[2]=this._eachNumWidth,this.offsetData[3]=t}this.pass.setRootBufferDirty(!0),this._meshRenderer.model?nC.root.pipeline.profiler=this._meshRenderer.model:nC.root.pipeline.profiler=null;const i=performance.now();this._profilerStats.render.counter.start(i)}afterRender(){const t=this._profilerStats;if(!t||!this._inited)return;const e=performance.now();t.render.counter.end(e),t.present.counter.start(e)}afterPresent(){const t=this._profilerStats;if(!t||!this._inited)return;const e=performance.now();if(t.frame.counter.end(e),t.fps.counter.frame(e),t.present.counter.end(e),e-this.lastTime<rAt)return;this.lastTime=e;const i=this._device;t.draws.counter.value=i.numDrawCalls,t.instances.counter.value=i.numInstances,t.bufferMemory.counter.value=i.memoryStatus.bufferSize/1048576,t.textureMemory.counter.value=i.memoryStatus.textureSize/1048576,t.tricount.counter.value=i.numTris;let s=0;const r=this.digitsData,n=aAt.segmentsPerLine;for(const i in t){const o=t[i];o.counter.sample(e);const a=o.counter.human().toString();for(let t=n-1;t>=0;t--){const e=s*n+t,i=a[a.length-(n-t)];let o=nAt[i];void 0===o&&(o=11),r[e]=o}s++}}}t("Profiler",hAt);const lAt=t("profiler",new hAt);nC.registerSystem("profiler",lAt,0),a.profiler=lAt;const cAt=function(t,e,i){t[e+0]=i.m00,t[e+1]=i.m01,t[e+2]=i.m02,t[e+3]=i.m12,t[e+4]=i.m04,t[e+5]=i.m05,t[e+6]=i.m06,t[e+7]=i.m13,t[e+8]=i.m08,t[e+9]=i.m09,t[e+10]=i.m10,t[e+11]=i.m14};function uAt(t){return 2&t.getFormatFeatures(44)?44:35}function dAt(t,e){const i=4/Math.sqrt(e);return 12*Math.ceil(Math.max(480*i,t)/12)}new sr,new sr,new Ms,new sr,new Ms;const _At=new Ms,pAt=new Ms,mAt=new Ms,gAt=new Ms,fAt=new vr,yAt=new vr,bAt=new Ca,vAt=Number.MAX_SAFE_INTEGER;class SAt{get pixelsPerJoint(){return this._pixelsPerJoint}constructor(t){this._device=void 0,this._pool=void 0,this._textureBuffers=new Map,this._formatSize=void 0,this._pixelsPerJoint=void 0,this._customPool=void 0,this._chunkIdxMap=new Map,this._device=t;const e=uAt(this._device);this._formatSize=tp[e].size,this._pixelsPerJoint=48/this._formatSize,this._pool=new rO(t),this._pool.initialize({format:e,roundUpFn:dAt}),this._customPool=new rO(t),this._customPool.initialize({format:e,roundUpFn:dAt})}clear(){this._pool.destroy(),this._textureBuffers.clear()}registerCustomTextureLayouts(t){for(let e=0;e<t.length;e++){const i=t[e];let s=i.textureLength;2&this._device.getFormatFeatures(44)||(s*=2);const r=this._customPool.createChunk(s);for(let t=0;t<i.contents.length;t++){const e=i.contents[t],{skeleton:s}=e;this._chunkIdxMap.set(s,r);for(let t=0;t<e.clips.length;t++){const i=e.clips[t];this._chunkIdxMap.set(s^i,r)}}}}getDefaultPoseTexture(t,e,i){const s=0^t.hash;let r=this._textureBuffers.get(s)||null;if(r&&r.bounds.has(e.hash))return r.refCount++,r;const{joints:n,bindposes:o}=t;let a=null,h=!1;const l=n.length;if(r)r.refCount++;else{const e=12*l,i=this._chunkIdxMap.get(s),n=void 0!==i?this._customPool.alloc(4*e,i):this._pool.alloc(4*e);if(!n)return r;r={pixelOffset:n.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:0,readyToBeDeleted:!1,handle:n},a=new Float32Array(e),h=!0}Ms.set(mAt,vAt,vAt,vAt),Ms.set(gAt,-vAt,-vAt,-vAt);const c=e.getBoneSpaceBounds(t);for(let e=0,s=0;e<l;e++,s+=12){const r=i.getChildByPath(n[e]),l=r?KV(r,i,fAt):t.inverseBindposes[e],u=c[e];u&&(Ca.transform(bAt,u,l),bAt.getBoundary(_At,pAt),Ms.min(mAt,mAt,_At),Ms.max(gAt,gAt,pAt)),h&&(r&&vr.multiply(l,l,o[e]),cAt(a,s,r?l:vr.IDENTITY))}const u=[new Ca];return r.bounds.set(e.hash,u),Ca.fromPoints(u[0],mAt,gAt),h&&(this._pool.update(r.handle,a.buffer),this._textureBuffers.set(s,r)),r}getSequencePoseTexture(t,e,i,s){const r=t.hash^e.hash;let n=this._textureBuffers.get(r)||null;if(n&&n.bounds.has(i.hash))return n.refCount++,n;const{joints:o,bindposes:a}=t,h=O$.getOrExtract(e),{frames:l}=h;let c=null,u=!1;const d=o.length;if(n)n.refCount++;else{const i=12*d*l,o=this._chunkIdxMap.get(r),a=void 0!==o?this._customPool.alloc(4*i,o):this._pool.alloc(4*i);if(!a)return null;const h=this._createAnimInfos(t,e,s);n={pixelOffset:a.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:e.hash,readyToBeDeleted:!1,handle:a,animInfos:h},c=new Float32Array(i),u=!0}const _=i.getBoneSpaceBounds(t),p=[];n.bounds.set(i.hash,p);for(let t=0;t<l;t++)p.push(new Ca(vAt,vAt,vAt,-vAt,-vAt,-vAt));for(let e=0,i=0;e<l;e++){const s=p[e];for(let r=0;r<d;r++,i+=12){const{curveData:o,downstream:h,bindposeIdx:l,bindposeCorrection:d}=n.animInfos[r];let p,m=!0;o&&h?p=vr.multiply(fAt,o[e],h):o?p=o[e]:h?p=h:(p=t.inverseBindposes[l],m=!1);const g=_[r];if(g){const t=d?vr.multiply(yAt,p,d):p;Ca.transform(bAt,g,t),bAt.getBoundary(_At,pAt),Ms.min(s.center,s.center,_At),Ms.max(s.halfExtents,s.halfExtents,pAt)}u&&(m&&vr.multiply(fAt,p,a[l]),cAt(c,i,m?fAt:vr.IDENTITY))}Ca.fromPoints(s,s.center,s.halfExtents)}return u&&(this._pool.update(n.handle,c.buffer),this._textureBuffers.set(r,n)),n}releaseHandle(t){if(t.refCount>0&&t.refCount--,!t.refCount&&t.readyToBeDeleted){const e=t.skeletonHash^t.clipHash;(void 0!==this._chunkIdxMap.get(e)?this._customPool:this._pool).free(t.handle),this._textureBuffers.get(e)===t&&this._textureBuffers.delete(e)}}releaseSkeleton(t){const e=this._textureBuffers.values();let i=e.next();for(;!i.done;){const s=i.value;s.skeletonHash===t.hash&&(s.readyToBeDeleted=!0,s.refCount?this._textureBuffers.delete(s.skeletonHash^s.clipHash):this.releaseHandle(s)),i=e.next()}}releaseAnimationClip(t){const e=this._textureBuffers.values();let i=e.next();for(;!i.done;){const s=i.value;s.clipHash===t.hash&&(s.readyToBeDeleted=!0,s.refCount?this._textureBuffers.delete(s.skeletonHash^s.clipHash):this.releaseHandle(s)),i=e.next()}}_createAnimInfos(t,e,i){const s=[],{joints:r,bindposes:n}=t,o=r.length,a=O$.getOrExtract(e);for(let e=0;e<o;e++){let h,l,c=r[e],u=a.joints[c],d=i.getChildByPath(c);for(;!u;){const t=c.lastIndexOf("/");if(c=c.substring(0,t),u=a.joints[c],d?(h||(h=new vr),vr.fromRTS(fAt,d.rotation,d.position,d.scale),vr.multiply(h,fAt,h),d=d.parent):l=c,t<0)break}let _,p=e;if(void 0!==l&&u){p=e-1;for(let i=0;i<o;i++)if(r[i]===l){p=i,_=new vr,vr.multiply(_,n[i],t.inverseBindposes[e]);break}}s.push({curveData:u&&u.transforms,downstream:h,bindposeIdx:p,bindposeCorrection:_})}return s}}class TAt{constructor(t){this._pool=new Map,this._device=void 0,this._device=t}getData(t="-1"){const e=this._pool.get(t);if(e)return e;const i=this._device.createBuffer(new a_(18,3,KC.SIZE,KC.SIZE)),s=new Float32Array([0,0,0,0]);i.update(s);const r={buffer:i,data:s,dirty:!1,dirtyForJSB:new Uint8Array([0]),currentClip:null};return this._pool.set(t,r),r}destroy(t){const e=this._pool.get(t);e&&(e.buffer.destroy(),this._pool.delete(t))}switchClip(t,e){return t.currentClip=e,t.data[0]=0,t.buffer.update(t.data),t.dirty=!1,t.dirtyForJSB[0]=0,t}clear(){for(const t of this._pool.values())t.buffer.destroy();this._pool.clear()}}a.internal.DataPoolManager=class{constructor(t){this.jointTexturePool=void 0,this.jointAnimationInfo=void 0,this.jointTexturePool=new SAt(t),this.jointAnimationInfo=new TAt(t)}releaseSkeleton(t){this.jointTexturePool.releaseSkeleton(t)}releaseAnimationClip(t){this.jointTexturePool.releaseAnimationClip(t)}clear(){this.jointTexturePool.clear(),this.jointAnimationInfo.clear()}};const wAt=new vr,xAt=new vr;class CAt extends cG{constructor(t,e=""){super(t,e),this._frames=1,this._bakedDuration=0,this._animInfo=null,this._sockets=[],this._animInfoMgr=void 0,this._parent=null,this._curvesInited=!1,this._animInfoMgr=a.director.root.dataPoolManager.jointAnimationInfo}initialize(t){if(this._curveLoaded)return;this._parent=t.getComponent("cc.SkeletalAnimation");const e=this._parent.useBakedAnimation;this._doNotCreateEval=e,super.initialize(t),this._curvesInited=!e;const{frames:i,samples:s}=O$.getOrExtract(this.clip);this._frames=i-1,this._animInfo=this._animInfoMgr.getData(t.uuid),this._bakedDuration=this._frames/s,this.setUseBaked(e)}onPlay(){super.onPlay(),this._parent.useBakedAnimation&&(this._animInfoMgr.switchClip(this._animInfo,this.clip),this._parent.getUsers().forEach((t=>{t.uploadAnimation(this.clip)})))}setUseBaked(t){t?(this._sampleCurves=this._sampleCurvesBaked,this.duration=this._bakedDuration):(this._sampleCurves=super._sampleCurves,this.duration=this.clip.duration,this._curvesInited||(this._curveLoaded=!1,super.initialize(this._targetNode),this._curvesInited=!0))}rebuildSocketCurves(t){if(this._sockets.length=0,!this._targetNode)return;const e=this._targetNode;for(let i=0;i<t.length;++i){const s=t[i],r=e.getChildByPath(s.path);if(!s.target)continue;const n=O$.getOrExtract(this.clip);let o,a=s.path,h=n.joints[a],l=r;for(;!h;){const t=a.lastIndexOf("/");if(a=a.substring(0,t),h=n.joints[a],l&&(o||(o=vr.identity(xAt)),vr.fromRTS(wAt,l.rotation,l.position,l.scale),vr.multiply(o,wAt,o),l=l.parent),t<0)break}const c=h&&h.transforms,{frames:u}=n,d=[];for(let t=0;t<u;t++){let e;e=c&&o?vr.multiply(wAt,c[t],o):c?c[t]:o||new vr;const i={pos:new Ms,rot:new sr,scale:new Ms};vr.toSRT(e,i.rot,i.pos,i.scale),d.push(i)}this._sockets.push({target:s.target,frames:d})}}_sampleCurvesBaked(t){const e=t/this.duration,i=this._animInfo,s=this.clip;i.currentClip!==s&&(this._animInfoMgr.switchClip(this._animInfo,s),this._parent.getUsers().forEach((t=>{t.uploadAnimation(s)})),i.data[0]=-1);const r=e*this._frames+.5|0;if(r!==i.data[0]){i.data[0]=r,i.dirty=!0,i.dirtyForJSB[0]=1;for(let t=0;t<this._sockets.length;++t){const{target:e,frames:i}=this._sockets[t],{pos:s,rot:n,scale:o}=i[r];e.setRTS(n,s,o)}}}}var AAt,DAt,EAt,IAt,MAt,PAt,OAt,RAt,BAt,FAt,NAt,LAt,kAt,zAt,UAt;t("SkeletalAnimationState",CAt);let VAt=t("Socket",(AAt=ah("cc.SkeletalAnimation.Socket"),DAt=Xh(tb),AAt((IAt=class{constructor(t="",e=null){this.path=MAt&&MAt(),this.target=PAt&&PAt(),this.path=t,this.target=e}},MAt=Za(IAt.prototype,"path",[vh],(function(){return""})),PAt=Za(IAt.prototype,"target",[DAt],(function(){return null})),EAt=IAt))||EAt));Xt(VAt,"cc.SkeletalAnimationComponent.Socket");const jAt=new vr,HAt=new vr;function GAt(t,e="",i=[]){for(let s=0;s<t.children.length;s++){const r=t.children[s];if(!r)continue;const n=e?`${e}/${r.name}`:r.name;i.push(n),GAt(r,n,i)}return i}let WAt=(OAt=ah("cc.SkeletalAnimation"),RAt=lh(99),BAt=Xh([VAt]),FAt=Xh([VAt]),OAt(NAt=RAt((UAt=class extends m5{constructor(...t){super(...t),this._useBakedAnimation=kAt&&kAt(),this._sockets=zAt&&zAt(),this._users=new Set,this._currentBakedState=null}get sockets(){return this._sockets}set sockets(t){if(!this._useBakedEffectively){const e=hG();e.removeSockets(this.node,this._sockets),e.addSockets(this.node,t)}this._sockets=t,this.rebuildSocketAnimations()}get useBakedAnimation(){return this._useBakedAnimation}set useBakedAnimation(t){this._useBakedAnimation=t,this._applyBakeFlagChange()}onLoad(){super.onLoad();const t=this.node.getComponentsInChildren(qV);for(let e=0;e<t.length;++e){const i=t[e];i.skinningRoot===this.node&&this.notifySkinnedMeshAdded(i)}}onDestroy(){super.onDestroy(),a.director.root.dataPoolManager.jointAnimationInfo.destroy(this.node.uuid),hG().removeSockets(this.node,this._sockets),this._removeAllUsers()}onEnable(){var t;super.onEnable(),null==(t=this._currentBakedState)||t.resume()}onDisable(){var t;super.onDisable(),null==(t=this._currentBakedState)||t.pause()}start(){this.sockets=this._sockets,this._applyBakeFlagChange(),super.start()}pause(){var t;this._useBakedEffectively?null==(t=this._currentBakedState)||t.pause():super.pause()}resume(){var t;this._useBakedEffectively?null==(t=this._currentBakedState)||t.resume():super.resume()}stop(){this._useBakedEffectively?this._currentBakedState&&(this._currentBakedState.stop(),this._currentBakedState=null):super.stop()}querySockets(){const t=this._defaultClip&&Object.keys(O$.getOrExtract(this._defaultClip).joints).sort().reduce(((t,e)=>(e.startsWith(`${t[t.length-1]}/`)||t.push(e),t)),[])||[];if(!t.length)return["please specify a valid default animation clip first"];const e=[];for(let i=0;i<t.length;i++){const s=t[i],r=this.node.getChildByPath(s);r&&(e.push(s),GAt(r,s,e))}return e}rebuildSocketAnimations(){this._sockets.forEach((t=>{const e=this.node.getChildByPath(t.path),{target:i}=t;e&&i&&(i.name=`${t.path.substring(t.path.lastIndexOf("/")+1)} Socket`,i.parent=this.node,KV(e,this.node,jAt),vr.fromRTS(HAt,i.rotation,i.position,i.scale),vr.equals(HAt,jAt)||(i.matrix=jAt))}));for(const t in this._nameToState)this._nameToState[t].rebuildSocketCurves(this._sockets)}createSocket(t){const e=this._sockets.find((e=>e.path===t));if(e)return e.target;if(!this.node.getChildByPath(t))return M("illegal socket path"),null;const i=new tb;return i.parent=this.node,this._sockets.push(new VAt(t,i)),this.rebuildSocketAnimations(),i}notifySkinnedMeshAdded(t){const{_useBakedEffectively:e}=this,i=t.associatedAnimation;if(i&&i._users.delete(t),t.associatedAnimation=this,t.setUseBakedAnimation(e,!0),e){const{_currentBakedState:e}=this;e&&t.uploadAnimation(e.clip)}this._users.add(t)}notifySkinnedMeshRemoved(t){t.associatedAnimation===this||t.associatedAnimation,t.setUseBakedAnimation(!1),t.associatedAnimation=null,this._users.delete(t)}getUsers(){return this._users}_createState(t,e){return new CAt(t,e)}_doCreateState(t,e){const i=super._doCreateState(t,e);return i.rebuildSocketCurves(this._sockets),i}doPlayOrCrossFade(t,e){if(this._useBakedEffectively){this._currentBakedState&&this._currentBakedState.stop();const e=t;this._currentBakedState=e,e.play()}else super.doPlayOrCrossFade(t,e)}_removeAllUsers(){Array.from(this._users).forEach((t=>{this.notifySkinnedMeshRemoved(t)}))}get _useBakedEffectively(){return this._useBakedAnimation}_applyBakeFlagChange(){const t=this._useBakedEffectively;for(const e in this._nameToState)this._nameToState[e].setUseBaked(t);this._users.forEach((e=>{e.setUseBakedAnimation(t)})),t?hG().removeSockets(this.node,this._sockets):(hG().addSockets(this.node,this._sockets),this._currentBakedState=null),this._setSkeletonTransformEnabled(!t)}_setSkeletonTransformEnabled(t){this.node.children.forEach((e=>{this._sockets.find((t=>t.target===e))||(e.isSkipTransformUpdate=!t)}))}},UAt.Socket=VAt,s((LAt=UAt).prototype,"sockets",[BAt],Object.getOwnPropertyDescriptor(LAt.prototype,"sockets"),LAt.prototype),kAt=Za(LAt.prototype,"_useBakedAnimation",[vh],(function(){return!0})),zAt=Za(LAt.prototype,"_sockets",[FAt],(function(){return[]})),NAt=LAt))||NAt)||NAt);var XAt;t({SkeletalAnimation:WAt,SkeletalAnimationComponent:WAt}),a.SkeletalAnimationComponent=WAt,Xt(WAt,"cc.SkeletalAnimationComponent"),function(t,e){function i(t){for(var e in t)t[t[e]]=e}var s=t.MixBlend={setup:0,first:1,replace:2,add:3};i(s),i(s=t.MixDirection={mixIn:0,mixOut:1}),i(s=t.TimelineType={rotate:0,translate:1,scale:2,shear:3,attachment:4,color:5,deform:6,event:7,drawOrder:8,ikConstraint:9,transformConstraint:10,pathConstraintPosition:11,pathConstraintSpacing:12,pathConstraintMix:13,twoColor:14}),i(s=t.EventType={start:0,interrupt:1,end:2,complete:3,dispose:4,event:5}),i(s=t.BlendMode={Normal:0,Additive:1,Multiply:2,Screen:3}),i(s=t.TransformMode={Normal:0,OnlyTranslation:1,NoRotationOrReflection:2,NoScale:3,NoScaleOrReflection:4}),i(s=t.PositionMode={Fixed:0,Percent:1}),i(s=t.SpacingMode={Length:0,Fixed:1,Percent:2}),i(s=t.RotateMode={Tangent:0,Chain:1,ChainScale:2}),i(s=t.TextureFilter={Nearest:9728,Linear:9729,MipMap:9987,MipMapNearestNearest:9984,MipMapLinearNearest:9985,MipMapNearestLinear:9986,MipMapLinearLinear:9987}),i(s=t.TextureWrap={MirroredRepeat:33648,ClampToEdge:33071,Repeat:10497}),i(s=t.AttachmentType={Region:0,BoundingBox:1,Mesh:2,LinkedMesh:3,Path:4,Point:5,Clipping:6}),s=null;const r=3.1415927,n=2*r,o=180/r,a=o,h=r/180,l=h;t.MathUtils=(e=class t{static clamp(t,e,i){return t<e?e:t>i?i:t}static cosDeg(t){return Math.cos(t*l)}static sinDeg(t){return Math.sin(t*l)}static signum(t){return t>0?1:t<0?-1:0}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}static cbrt(t){let e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}static randomTriangular(e,i){return t.randomTriangularWith(e,i,.5*(e+i))}static randomTriangularWith(t,e,i){let s=Math.random(),r=e-t;return s<=(i-t)/r?t+Math.sqrt(s*r*(i-t)):e-Math.sqrt((1-s)*r*(e-i))}},e.PI=r,e.PI2=n,e.radiansToDegrees=o,e.radDeg=a,e.degreesToRadians=h,e.degRad=l,e)}(XAt||(XAt={}));var YAt=XAt;let qAt=0,$At=0;class KAt{constructor(){this.start=void 0,this.interrupt=void 0,this.end=void 0,this.dispose=void 0,this.complete=void 0,this.event=void 0}static getListeners(t,e){if(!t.listener){t.listener=new KAt;const i=++$At;e.setTrackEntryListener(i,t),KAt._trackSet.set(i,t)}return t.listener}static emitListener(t,e,i,s){const r=KAt._listenerSet.get(t);if(r)switch(s){case YAt.EventType.event:r.event&&r.event(e,i);break;case YAt.EventType.start:r.start&&r.start(e);break;case YAt.EventType.interrupt:r.interrupt&&r.interrupt(e);break;case YAt.EventType.end:r.end&&r.end(e);break;case YAt.EventType.dispose:r.dispose&&r.dispose(e);break;case YAt.EventType.complete:r.complete&&r.complete(e);break;default:M("emitListener doesn't handled",s)}}static emitTrackEntryListener(t,e,i,s){const r=this._trackSet.get(t);if(r)switch(s){case YAt.EventType.start:r.listener.start&&r.listener.start(e);break;case YAt.EventType.interrupt:r.listener.interrupt&&r.listener.interrupt(e);break;case YAt.EventType.end:r.listener.end&&r.listener.end(e);break;case YAt.EventType.dispose:r.listener.dispose&&r.listener.dispose(e),this._trackSet.delete(t),r.listener=null;break;case YAt.EventType.complete:r.listener.complete&&r.listener.complete(e);break;case YAt.EventType.event:r.listener.event&&r.listener.event(e,i);break;default:M("TrackEntry doesn't handled",s)}}static addListener(t){const e=++qAt;return KAt._listenerSet.set(e,t),e}static removeListener(t){KAt._listenerSet.delete(t)}}var ZAt;KAt._listenerSet=new Map,KAt._trackSet=new Map,globalThis.TrackEntryListeners=KAt;const QAt=1/60;sI(JE);const JAt=sI(eI);class tDt{constructor(){this.a=0,this.b=0,this.c=0,this.d=0,this.worldX=0,this.worldY=0}}class eDt{constructor(){this.vCount=0,this.iCount=0,this.vData=null,this.iData=null,this.meshes=[]}}class iDt{constructor(){this.iCount=0,this.blendMode=0,this.textureID=0}}class sDt{constructor(t){this._instance=null,this._state=null,this._skeletonData=null,this._skeleton=null,this._privateMode=!1,this._curIndex=-1,this._isCompleted=!1,this._maxFrameIdex=0,this._frameIdx=-1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this._skeletonInfo=null,this._animationName=null,this.isCompleted=!1,this.totalTime=0,this.frames=[],this._privateMode=!1,this._inited=!1,this._invalid=!0,this._instance=new YAt.SkeletonInstance,this._instance.isCache=!0,this._skeletonData=t,this._skeleton=this._instance.initSkeleton(t),this._instance.setUseTint(!0)}init(t,e){this._inited=!0,this._animationName=e,this._skeletonInfo=t}get skeleton(){return this._skeleton}setSkin(t){this._skeleton&&this._skeleton.setSkinByName(t),this._instance.setSkin(t)}setAnimation(t){const e=this._skeletonData.animations;let i=null;e.forEach((e=>{e.name===t&&(i=e)})),i?(this._maxFrameIdex=Math.floor(i.duration/QAt),this._maxFrameIdex<=0&&(this._maxFrameIdex=1),this._instance.setAnimation(0,t,!1)):M(`find no animation named ${t} !!!`)}updateToFrame(t){if(this._inited&&(this.begin(),this.needToUpdate(t)))do{this._frameIdx++,this.totalTime+=QAt,this._instance.updateAnimation(QAt);const t=this._instance.updateRenderData();this.updateRenderData(this._frameIdx,t),this._frameIdx>=this._maxFrameIdex&&(this.isCompleted=!0)}while(this.needToUpdate(t))}getFrame(t){const e=t%this._maxFrameIdex;return this.frames[e]}invalidAnimationFrames(){this._curIndex=-1,this._isCompleted=!1,this.frames.length=0}updateRenderData(t,e){const i=e.vCount,s=e.iCount,r=JAt/4,n=new Uint8Array(4*r*i),o=new Uint16Array(s),a=YAt.wasmUtil.wasm.HEAPU8,h=e.vPtr,l=4*i*r;n.set(a.subarray(h,h+l));const c=e.iPtr,u=2*s;new Uint8Array(o.buffer).set(a.subarray(c,c+u));const d=new eDt;d.vCount=i,d.iCount=s,d.vData=n,d.iData=o;const _=e.getData(),p=e.getTextures(),m=_.size();for(let t=0;t<m;t+=5){const e=new iDt;e.iCount=_.get(t+3),e.blendMode=_.get(t+4),e.textureID=p.get(t/5),d.meshes.push(e)}const g=this._skeleton.bones,f=[];g.forEach((t=>{const e=new tDt;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.worldX=t.worldX,e.worldY=t.worldY,f.push(e)})),this.frames[t]={model:d,boneInfos:f}}begin(){if(!this._invalid)return;const t=this._skeletonInfo,e=null==t?void 0:t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame(0));const i=null==t?void 0:t.listener;this._instance.setAnimation(0,this._animationName,!1),this.bind(i),t.curAnimationCache=this,this._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1}end(){this.needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))}bind(t){t.complete=t=>{t&&t.animation.name===this._animationName&&(this.isCompleted=!0)}}unbind(t){t.complete=null}needToUpdate(t){return!this.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)}isInited(){return this._inited}isInvalid(){return this._invalid}invalidAllFrame(){this.isCompleted=!1,this._invalid=!0}enableCacheAttachedInfo(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())}clear(){this._inited=!1,this.invalidAllFrame()}destroy(){this._instance&&(this._instance.destroy(),this._instance=null)}}class rDt{constructor(){this._privateMode=void 0,this._skeletonCache=void 0,this._animationPool=void 0,this._sharedCacheMap=new Map,this._privateMode=!1,this._animationPool={},this._skeletonCache={}}enablePrivateMode(){this._privateMode=!0}clear(){this._animationPool={},this._skeletonCache={}}invalidAnimationCache(t){const e=this._skeletonCache[t];if(!e||!e.skeleton)return;const i=e.animationsCache;for(const t in i)i[t].invalidAllFrame()}destroySkeleton(t){if(!this._privateMode){let e=this._sharedCacheMap.get(t);if(e){if(e-=1,e>0)return void this._sharedCacheMap.set(t,e);this._sharedCacheMap.delete(t)}}const e=this._skeletonCache[t];if(!e)return;const i=this._privateMode?(t,e)=>{e.destroy()}:(e,i)=>{this._animationPool[`${t}#${e}`]=i,i.clear()},s=e.animationsCache;for(const t in s){const e=s[t];e&&i(t,e)}e.skeleton&&YAt.wasmUtil.destroySpineSkeleton(e.skeleton),delete this._skeletonCache[t]}createSkeletonInfo(t){const e=t.uuid,i=t.getRuntimeData();if(!this._privateMode){let t=this._sharedCacheMap.get(e);t?t+=1:t=1,this._sharedCacheMap.set(e,t)}if(this._skeletonCache[e])return this._skeletonCache[e];const s=new YAt.Skeleton(i),r=new KAt;return this._skeletonCache[e]={skeleton:s,clipper:null,state:null,listener:r,animationsCache:{},curAnimationCache:null,assetUUID:e}}getSkeletonInfo(t){const e=t.uuid;return this._skeletonCache[e]}getAnimationCache(t,e){const i=this._skeletonCache[t];return i?i.animationsCache[e]:null}initAnimationCache(t,e,i){const s=e.getRuntimeData();if(!s)return null;const r=this._skeletonCache[t];if(!r||!r.skeleton)return null;const n=r.animationsCache;let o=n[i];if(!o){const e=`${t}#${i}`;o=this._animationPool[e],o?delete this._animationPool[e]:(o=new sDt(s),o._privateMode=this._privateMode),o.init(r,i),n[i]=o}return o.init(r,i),o.setAnimation(i),o}destroyCachedAnimations(t){if(t){const e=this._animationPool;for(const i in e)i.includes(t)&&(e[i].destroy(),delete e[i]);const i=this._skeletonCache[t],s=i&&i.skeleton;s&&YAt.wasmUtil.destroySpineSkeleton(s),i&&delete this._skeletonCache[t]}else{const t=this._animationPool;for(const e in t)t[e].destroy(),delete t[e]}}}var nDt,oDt,aDt,hDt,lDt,cDt,uDt,dDt,_Dt,pDt;ZAt=rDt,rDt.FrameTime=QAt,rDt.sharedCache=new ZAt;let mDt=(nDt=ah("sp.SkeletonData"),oDt=Xh([ff]),aDt=Xh([Ye]),nDt((lDt=class extends fm{get skeletonJsonStr(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}get skeletonJson(){return this._skeletonJson}set skeletonJson(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash)}get atlasText(){return this._atlasText}set atlasText(t){this._atlasText=t,this.reset()}get _nativeAsset(){return this._buffer}set _nativeAsset(t){this._buffer=t,this.reset()}constructor(){super(),this._skeletonJson=cDt&&cDt(),this.textures=uDt&&uDt(),this.textureNames=dDt&&dDt(),this.scale=_Dt&&_Dt(),this._atlasText=pDt&&pDt(),this._buffer=void 0,this._skeletonCache=null,this._skinsEnum=null,this._animsEnum=null,this.reset()}createNode(t){const e=new tb(this.name);return e.addComponent("cc.Skeleton").skeletonData=this,t(null,e)}reset(){this._skeletonCache=null}resetEnums(){}getRuntimeData(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return t||P(`${this.name} no textures found!`),null;const e=this.mergedUUID(),i=YAt.wasmUtil.querySpineSkeletonDataByUUID(e);if(i)this._skeletonCache=i;else{const t=this.textures.length,i=[];for(let e=0;e<t;++e){const t=this.textures[e];i.push(t.uuid||t.getId())}if(this._skeletonJson)this._skeletonCache=YAt.wasmUtil.createSpineSkeletonDataWithJson(this.skeletonJsonStr,this._atlasText,this.textureNames,i),YAt.wasmUtil.registerSpineSkeletonDataWithUUID(this._skeletonCache,e);else{const t=new Uint8Array(this._nativeAsset),s=t.length,r=YAt.wasmUtil.createStoreMemory(s);YAt.wasmUtil.wasm.HEAPU8.subarray(r,r+s).set(t),this._skeletonCache=YAt.wasmUtil.createSpineSkeletonDataWithBinary(s,this._atlasText,this.textureNames,i),YAt.wasmUtil.registerSpineSkeletonDataWithUUID(this._skeletonCache,e),YAt.wasmUtil.freeStoreMemory()}}return this._skeletonCache}getSkinsEnum(){if(this._skinsEnum)return this._skinsEnum;const t=this.getRuntimeData(!0);if(t){const e=t.skins,i={};for(let t=0;t<e.length;t++)i[e[t].name]=t;return this._skinsEnum=pe(i)}return null}getAnimsEnum(){if(this._animsEnum&&Object.keys(this._animsEnum).length>1)return this._animsEnum;const t=this.getRuntimeData(!0);if(t){const e={"<None>":0},i=t.animations;for(let t=0;t<i.length;t++)e[i[t].name]=t+1;return this._animsEnum=pe(e)}return null}mergedUUID(){const t=[this._atlasText,...this.textures.map((t=>t.getId()))].join("");return`${this._uuid}${Gu(t,668)}`}destroy(){return rDt.sharedCache.destroyCachedAnimations(this._uuid),YAt.wasmUtil.destroySpineSkeletonDataWithUUID(this.mergedUUID()),super.destroy()}isEmpty(){return 0===this._atlasText.length&&!this._skeletonJson&&!this._nativeAsset}},cDt=Za(lDt.prototype,"_skeletonJson",[vh],(function(){return null})),uDt=Za(lDt.prototype,"textures",[vh,oDt],(function(){return[]})),dDt=Za(lDt.prototype,"textureNames",[vh,aDt],(function(){return[]})),_Dt=Za(lDt.prototype,"scale",[vh],(function(){return 1})),pDt=Za(lDt.prototype,"_atlasText",[vh],(function(){return""})),hDt=lDt))||hDt);h.internal.SpineSkeletonData=mDt;class gDt extends Bu{constructor(){super(),this._skeletons=new Set}static getInstance(){return gDt._instance||(gDt._instance=new gDt,nC.registerSystem(gDt.ID,gDt._instance,200)),gDt._instance}add(t){t&&(this._skeletons.has(t)||this._skeletons.add(t))}remove(t){t&&this._skeletons.has(t)&&this._skeletons.delete(t)}postUpdate(t){this._skeletons&&this._skeletons.forEach((e=>{e.updateAnimation(t)}))}prepareRenderData(){this._skeletons&&this._skeletons.forEach((t=>{t._markForUpdateRenderData()}))}}gDt.ID="SKELETON",gDt._instance=void 0,h.internal.SpineSkeletonSystem=gDt;const fDt=new vr;class yDt{constructor(){this._isInitialized=!1,this._skeletonBones=null,this._socketNodes=null,this._keysToDelete=[],this._isInitialized=!1}init(t){var e;this._isInitialized=!1,t&&0!==(null==(e=t.socketNodes)?void 0:e.size)&&(this._skeletonBones=t._skeleton.bones,!this._skeletonBones||this._skeletonBones.length<1||(this._socketNodes=t.socketNodes,!this._socketNodes||this._socketNodes.size<=0||(this._isInitialized=!0,this._syncAttachedNode())))}updateSkeletonBones(t){this._skeletonBones=t}reset(){this._isInitialized=!1,this._skeletonBones=null,this._socketNodes=null,this._keysToDelete.length=0}_syncAttachedNode(){if(!this._isInitialized)return;const t=this._socketNodes;for(const[e,i]of t){if(!i||!i.isValid){this._keysToDelete.push(e);continue}const t=this._skeletonBones[e];t&&this.matrixHandle(i,t)}if(!(this._keysToDelete.length<=0)){for(const e of this._keysToDelete)t.delete(e);this._keysToDelete.length=0}}matrixHandle(t,e){const i=fDt;i.m00=e.a,i.m01=e.c,i.m04=e.b,i.m05=e.d,i.m12=e.worldX,i.m13=e.worldY,t.matrix=fDt}}var bDt,vDt,SDt,TDt,wDt,xDt,CDt,ADt,DDt,EDt,IDt,MDt,PDt,ODt,RDt,BDt,FDt,NDt,LDt,kDt,zDt,UDt,VDt,jDt,HDt,GDt,WDt,XDt,YDt,qDt;function $Dt(t){return!!t&&!t.isEmpty()}const KDt={UNSET:-1,REALTIME:0,SHARED_CACHE:1,PRIVATE_CACHE:2};fe(KDt);const ZDt=KDt,QDt={default:0};fe(QDt);const JDt={"<None>":0};fe(JDt);const tEt=JDt;let eEt=(bDt=ah("sp.Skeleton.SpineSocket"),vDt=Xh(tb),bDt((TDt=class{constructor(t="",e=null){this.path=wDt&&wDt(),this.target=xDt&&xDt(),this.path=t,this.target=e}},wDt=Za(TDt.prototype,"path",[vh],(function(){return""})),xDt=Za(TDt.prototype,"target",[vDt,vh],(function(){return null})),SDt=TDt))||SDt);Xt(eEt,"sp.Skeleton.SpineSocket");let iEt=(CDt=ah("sp.Skeleton"),ADt=Xh(mDt),DDt=Xh(QDt),EDt=Xh(JDt),IDt=Xh(KDt),MDt=Xh([eEt]),PDt=Xh(fv),CDt((qDt=class t extends uM{constructor(){super(),this._skeletonData=BDt&&BDt(),this.defaultSkin=FDt&&FDt(),this.defaultAnimation=NDt&&NDt(),this._premultipliedAlpha=LDt&&LDt(),this._timeScale=kDt&&kDt(),this._preCacheMode=zDt&&zDt(),this._cacheMode=UDt&&UDt(),this._sockets=VDt&&VDt(),this._useTint=jDt&&jDt(),this._debugMesh=HDt&&HDt(),this._debugBones=GDt&&GDt(),this._debugSlots=WDt&&WDt(),this._enableBatch=XDt&&XDt(),this._runtimeData=null,this._skeleton=null,this._instance=null,this._state=null,this._textures=[],this._skeletonInfo=null,this._animationName="",this._skinName="",this._drawList=new So((()=>({material:null,texture:null,indexOffset:0,indexCount:0})),1),this._materialCache={},this.paused=!1,this._enumSkins=pe({}),this._enumAnimations=pe({}),this.attachUtil=void 0,this._socketNodes=new Map,this._cachedSockets=new Map,this._startEntry=void 0,this._endEntry=void 0,this._paused=!1,this._accTime=0,this._playCount=0,this._skeletonCache=null,this._animCache=null,this._animationQueue=[],this._headAniInfo=null,this._isAniComplete=!0,this._playTimes=0,this._curFrame=null,this._listener=null,this._debugRenderer=null,this._startSlotIndex=void 0,this._endSlotIndex=void 0,this._customMaterialInstance=null,this._vLength=0,this._vBuffer=null,this._iLength=0,this._iBuffer=null,this._model=void 0,this._tempColor={r:0,g:0,b:0,a:0},this._eventListenerID=-1,this._slotTextures=null,this._isRenderable=!1,this.loop=YDt&&YDt(),this._useVertexOpacity=!0,this._startEntry={animation:{name:""},trackIndex:0},this._endEntry={animation:{name:""},trackIndex:0},this._startSlotIndex=-1,this._endSlotIndex=-1,this.attachUtil=new yDt}get drawList(){return this._drawList}get skeletonData(){return this._skeletonData}set skeletonData(t){t&&t.resetEnums(),this._skeletonData!==t&&(this.destroyRenderData(),this._skeletonData=t,this.defaultSkin="",this.defaultAnimation="",this._animationName="",this._skinName="",this._updateSkeletonData(),this._updateUITransform())}get _defaultSkinIndex(){if($Dt(this.skeletonData)){const t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0,0}else{const e=t[this.defaultSkin];if(void 0!==e)return e}}return 0}set _defaultSkinIndex(t){let e;if($Dt(this.skeletonData)&&(e=this.skeletonData.getSkinsEnum()),!e)return void P(`${this.name} skin enums are invalid`);const i=e[t];void 0!==i?(this.defaultSkin=String(i),this.setSkin(this.defaultSkin),this._refreshInspector(),this._markForUpdateRenderData()):P(`${this.name} skin enums are invalid`)}get _animationIndex(){const t=this.animation;if($Dt(this.skeletonData))if(t){const e=this.skeletonData.getAnimsEnum();if(e){const i=e[t];if(void 0!==i)return i}}else this._refreshInspector();return 0}set _animationIndex(t){let e;if($Dt(this.skeletonData)&&(e=this.skeletonData.getAnimsEnum()),!e)return void P(`${this.name} animation enums are invalid`);const i=String(e[t]);void 0!==i?(this.animation=i,this.animation=i):P(`${this.name} animation enums are invalid`)}get defaultCacheMode(){return this._cacheMode}set defaultCacheMode(t){this._cacheMode=t,this.setAnimationCacheMode(this._cacheMode)}get premultipliedAlpha(){return this._premultipliedAlpha}set premultipliedAlpha(t){t!==this._premultipliedAlpha&&(this._premultipliedAlpha=t,this._instance.setPremultipliedAlpha(t),this._markForUpdateRenderData())}get timeScale(){return this._timeScale}set timeScale(t){t!==this._timeScale&&(this._timeScale=t,this._instance&&(this._instance.dtRate=1*this._timeScale))}get useTint(){return this._useTint}set useTint(t){t!==this._useTint&&(this._useTint=t,this._updateUseTint())}get enableBatch(){return this._enableBatch}set enableBatch(t){t!==this._enableBatch&&(this._enableBatch=t,this._updateBatch())}get sockets(){return this._sockets}set sockets(t){this._sockets=t,this._updateSocketBindings(),this.attachUtil.init(this)}get debugSlots(){return this._debugSlots}set debugSlots(t){t!==this._debugSlots&&(this._debugSlots=t,this._updateDebugDraw(),this._markForUpdateRenderData())}get debugBones(){return this._debugBones}set debugBones(t){t!==this._debugBones&&(this._debugBones=t,this._updateDebugDraw(),this._markForUpdateRenderData())}get debugMesh(){return this._debugMesh}set debugMesh(t){t!==this._debugMesh&&(this._debugMesh=t,this._updateDebugDraw(),this._markForUpdateRenderData())}get socketNodes(){return this._socketNodes}get animation(){return this._animationName}set animation(t){t?this.setAnimation(0,t,this.loop):this.clearAnimation(0)}get customMaterial(){return this._customMaterial}set customMaterial(t){this._customMaterial=t,this.updateMaterial(),this._markForUpdateRenderData()}get customMaterialInstance(){if(!this._customMaterial)return null;if(!this._customMaterialInstance){const t={parent:this._customMaterial,subModelIdx:0,owner:this};this._customMaterialInstance=new BI(t)}return this._customMaterialInstance}__preload(){super.__preload(),this._updateSkeletonData(),this._updateDebugDraw()}onRestore(){this.updateMaterial(),this._markForUpdateRenderData()}getState(){return this._state}onEnable(){super.onEnable(),this._flushAssembler(),gDt.getInstance().add(this),this._isRenderable=!0}onDisable(){super.onDisable(),gDt.getInstance().remove(this),this._isRenderable=!1}onDestroy(){var t;this._eventListenerID>0&&(KAt.removeListener(this._eventListenerID),this._eventListenerID=-1),this._drawList.destroy(),this.destroyRenderData(),this._cleanMaterialCache(),this._vBuffer=null,this._iBuffer=null,this.attachUtil.reset(),null==(t=this._slotTextures)||t.clear(),this._slotTextures=null,this._cachedSockets.clear(),this._socketNodes.clear(),this._animCache=null,gDt.getInstance().remove(this),this._destroySkeletonInfo(this._skeletonCache),this._skeletonCache=null,super.onDestroy()}clearAnimation(t){this.isAnimationCached()||(this.clearTrack(t||0),this.setToSetupPose())}clearAnimations(){this.isAnimationCached()||(this.clearTracks(),this.setToSetupPose())}_updateSkeletonData(){const t=this._skeletonData;if(!$Dt(this._skeletonData))return this._runtimeData=null,this._state=null,this._skeleton=null,this._textures=[],this._refreshInspector(),void(this._isRenderable&&gDt.getInstance().remove(this));this._instance&&(this._instance.dtRate=1*this._timeScale),this._runtimeData=t.getRuntimeData(),this._runtimeData&&(this.setSkeletonData(this._runtimeData),this._textures=t.textures,this._refreshInspector(),this.defaultSkin&&""!==this.defaultSkin?this.setSkin(this.defaultSkin):this._skinName&&""!==this._skinName&&this.setSkin(this._skinName),this.defaultAnimation?this.animation=this.defaultAnimation.toString():this._animationName?this.animation=this._animationName:this.animation="",this._updateUseTint(),this._indexBoneSockets(),this._updateSocketBindings(),this.attachUtil.init(this),this._preCacheMode=this._cacheMode)}setSkeletonData(t){{const t=this._skeletonCache;1===this._cacheMode?this._skeletonCache=rDt.sharedCache:2===this._cacheMode?(this._skeletonCache=new rDt,this._skeletonCache.enablePrivateMode()):this._skeletonCache=null,t!==this._skeletonCache&&this._destroySkeletonInfo(t)}if(this.isAnimationCached()){(this.debugBones||this.debugSlots)&&j(16410);const t=this._skeletonCache.getSkeletonInfo(this._skeletonData);this._skeletonInfo!==t&&(this._destroySkeletonInfo(this._skeletonCache),t||2!==this._cacheMode||(this._animCache=this._skeletonCache.initAnimationCache(this.skeletonData.uuid,this._skeletonData,this._animationName)),this._skeletonInfo=this._skeletonCache.createSkeletonInfo(this._skeletonData)),this._skeletonInfo&&(this._skeleton=this._skeletonInfo.skeleton)}else this._skeleton=this._instance.initSkeleton(t),this._state=this._instance.getAnimationState(),this._instance.setPremultipliedAlpha(this._premultipliedAlpha);this._isRenderable&&gDt.getInstance().add(this),this._flushAssembler()}setSlotsRange(t,e){this.isAnimationCached()?j(16411):(this._startSlotIndex=t,this._endSlotIndex=e)}getAttachment(t,e){return this._skeleton?this._skeleton.getAttachmentByName(t,e):null}setAttachment(t,e){this._skeleton&&this._skeleton.setAttachment(t,e),this.invalidAnimationCache()}getTextureAtlas(t){return t.region}setAnimation(t,e,i){if("string"!=typeof e)return k(7511),null;const s=this._skeleton;if(!s||!s.data.findAnimation(e))return k(7509,e),null;let r=null;if(void 0===i&&(i=!0),this._playTimes=i?0:1,this.isAnimationCached()){if(0!==t&&j(16412),!this._skeletonCache)return null;let i=this._skeletonCache.getAnimationCache(this._skeletonData.uuid,e);i||(i=this._skeletonCache.initAnimationCache(this.skeletonData.uuid,this._skeletonData,e),i&&this._skinName&&i.setSkin(this._skinName)),i&&(this._animationName=e,this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._animCache=i,this._socketNodes.size>0&&this._animCache.enableCacheAttachedInfo(),this._animCache.updateToFrame(0),this._curFrame=this._animCache.frames[0])}else this._animationName=e,r=this._instance.setAnimation(t,e,i);return this._markForUpdateRenderData(),r}addAnimation(t,e,i,s){if(s=s||0,this.isAnimationCached())return 0!==t&&j(16413),this._animationQueue.push({animationName:e,loop:i,delay:s}),null;if(this._skeleton){var r;const n=this._skeleton.data.findAnimation(e);return n?null==(r=this._state)?void 0:r.addAnimationWith(t,n,i,s):(k(7510,e),null)}return null}findAnimation(t){return this._skeleton?this._skeleton.data.findAnimation(t):null}getCurrent(t){if(this.isAnimationCached())j(16414);else if(this._state)return this._state.getCurrent(t);return null}setSkin(t){t&&(this._skeleton&&this._skeleton.setSkinByName(t),this._instance.setSkin(t),this.isAnimationCached()&&this._animCache&&this._animCache.setSkin(t),this._skinName=t,this.invalidAnimationCache())}updateAnimation(t){if(this._markForUpdateRenderData(),!this.paused)if(this.isAnimationCached()){if(t*=1*this._timeScale,this._isAniComplete){var e;if(0===this._animationQueue.length&&!this._headAniInfo){const t=this._animCache;if(t&&t.isInvalid()){t.updateToFrame(0);const e=t.frames;this._curFrame=e[e.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,this._accTime>(null==(e=this._headAniInfo)?void 0:e.delay)){const t=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,null==t?void 0:t.animationName,null==t?void 0:t.loop)}return}this._updateCache(t)}else this._instance.updateAnimation(t)}_updateCache(t){const e=this._animCache;if(!e.isInited())return;const i=e.frames,s=rDt.FrameTime;0===this._accTime&&0===this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t;let r=Math.floor(this._accTime/s);if(e.isCompleted||e.updateToFrame(r),this._curFrame=i[r],void 0!==this._curFrame&&this.attachUtil.updateSkeletonBones(this._curFrame.boneInfos),e.isCompleted&&r>=i.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,void this._emitCacheCompleteEvent();this._accTime=0,r=0,this._curFrame=i[r],this._emitCacheCompleteEvent()}}_emitCacheCompleteEvent(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))}updateRenderData(){return this.isAnimationCached()?this._curFrame?this._curFrame.model:null:this._instance.updateRenderData()}_flushAssembler(){const e=t.Assembler.getAssembler(this);this._assembler!==e&&(this._assembler=e),this._skeleton&&this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._markForUpdateRenderData(),this._updateColor())}_render(t){let e=0;if(this.renderData&&this._drawList.length>0){const i=this.renderData,s=i.chunk,r=s.vertexAccessor,n=i.getMeshBuffer(),o=n.indexOffset;for(let i=0;i<this._drawList.length;i++){const s=this._drawList.data[i];s.texture&&t.commitMiddleware(this,n,o+s.indexOffset,s.indexCount,s.texture,s.material,this._enableBatch),e+=s.indexCount}const a=i.indices.subarray(0,e);r.appendIndices(s.bufferId,a),r.getMeshBuffer(s.bufferId).setDirty()}}requestDrawData(t,e,i,s){const r=this._drawList.add();r.material=t;let n=jx.assets.get(e);var o,a;return n||(n=null==(o=this.skeletonData)?void 0:o.textures.find((t=>t.uuid===e||t.getId()===e)),n||(n=null==(a=this._slotTextures)?void 0:a.get(e))),r.texture=n,r.indexOffset=i,r.indexCount=s,r}_updateBuiltinMaterial(){return iC.get("default-spine-material")}updateMaterial(){let t;t=this._customMaterial?this._customMaterial:this._updateBuiltinMaterial(),this.setSharedMaterial(t,0),this._cleanMaterialCache()}getMaterialTemplate(){return null!==this.customMaterial?this.customMaterial:(this.material||this.updateMaterial(),this.material)}_cleanMaterialCache(){for(const t in this._materialCache)this._materialCache[t].destroy();this._materialCache={}}getMaterialForBlendAndTint(t,e,i){const s=`${i}/${t}/${e}`;let r=this._materialCache[s];if(r)return r;if(this._customMaterialInstance)r=this._customMaterialInstance;else{const t=this.getMaterialTemplate();r=new BI({parent:t,subModelIdx:0,owner:this})}this._materialCache[s]=r,r.overridePipelineStates({blendState:{blendColor:Ls.WHITE,targets:[{blendEq:0,blendAlphaEq:0,blendSrc:t,blendDst:e,blendSrcAlpha:t,blendDstAlpha:e}]}});let n=!1;1===i&&(n=!0);const o=!this._enableBatch;return r.recompileShaders({TWO_COLORED:n,USE_LOCAL:o}),r}_updateAnimEnum(){let t;t=$Dt(this.skeletonData)?this.skeletonData.getAnimsEnum():JDt,this._enumAnimations=pe({}),Object.assign(this._enumAnimations,t),pe.update(this._enumAnimations),ri(this,"_animationIndex",this._enumAnimations)}_updateSkinEnum(){let t;t=$Dt(this.skeletonData)?this.skeletonData.getSkinsEnum():QDt,this._enumSkins=pe({}),Object.assign(this._enumSkins,t),pe.update(this._enumSkins),ri(this,"_defaultSkinIndex",this._enumSkins)}_refreshInspector(){}destroyRenderData(){this._drawList.reset(),super.destroyRenderData()}createRenderEntity(){const t=new KI(1);return t.setUseLocal(!0),t}markForUpdateRenderData(t=!0){super._markForUpdateRenderData(t),this._debugRenderer&&this._debugRenderer._markForUpdateRenderData(t)}syncAttachedNode(){this.attachUtil._syncAttachedNode()}isAnimationCached(){return 0!==this._cacheMode}setAnimationCacheMode(t){this._preCacheMode!==t&&(this._cacheMode=t,this._preCacheMode=t,this._instance&&(this._instance.isCache=this.isAnimationCached()),this._updateSkeletonData(),this._markForUpdateRenderData())}setToSetupPose(){this._skeleton&&this._skeleton.setToSetupPose()}setBonesToSetupPose(){this._skeleton&&this._skeleton.setBonesToSetupPose()}setSlotsToSetupPose(){this._skeleton&&this._skeleton.setSlotsToSetupPose()}invalidAnimationCache(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this._skeletonData.uuid)}findBone(t){return this._skeleton?this._skeleton.findBone(t):null}findSlot(t){return this._skeleton?this._skeleton.findSlot(t):null}setMix(t,e,i){this.isAnimationCached()?j(16415):this._state&&this._instance.setMix(t,e,i)}clearTracks(){this.isAnimationCached()?j(16416):this._state&&(this._state.clearTracks(),this.setToSetupPose())}clearTrack(t){this.isAnimationCached()?j(16417):this._state&&this._state.clearTrack(t)}updateWorldTransform(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()}_verifySockets(t){for(let e=0,i=t.length;e<i;e++){const i=t[e].target;!i||i.parent&&i.parent===this.node||P(`Target node ${i.name} is expected to be a direct child of ${this.node.name}`)}const e=new Map;t.forEach((t=>{t.target&&(e.get(t.target)?P(`Target node ${t.target.name} has existed.`):e.set(t.target,!0))}))}_updateSocketBindings(){if(this._skeleton){this._socketNodes.clear();for(let t=0,e=this._sockets.length;t<e;t++){const e=this._sockets[t];if(e.path&&e.target){const t=this._cachedSockets.get(e.path);if(!t){P(`Skeleton data does not contain path ${e.path}`);continue}this._socketNodes.set(t,e.target)}}}}_indexBoneSockets(){if(!this._skeleton)return;this._cachedSockets.clear();const t=this._skeleton.bones,e=i=>null==i.parent?i.data.name||"<Unamed>":`${e(t[i.parent.data.index])}/${i.data.name}`;for(let i=0,s=t.length;i<s;i++){const s=t[i].data,r=e(t[i]);this._cachedSockets.set(r,s.index)}}querySockets(){return this._skeleton?(0===this._cachedSockets.size&&this._indexBoneSockets(),this._cachedSockets.size>0?Array.from(this._cachedSockets.keys()).sort():[]):[]}_updateUseTint(){this._cleanMaterialCache(),this.destroyRenderData();const t=this._assembler;t&&t.createData&&this._skeleton&&(this._renderData=t.createData(this),this._markForUpdateRenderData())}_updateBatch(){this._cleanMaterialCache(),this._markForUpdateRenderData()}_updateDebugDraw(){if(this.debugBones||this.debugSlots||this.debugMesh){if(!this._debugRenderer){let t=new tb("DEBUG_DRAW_NODE");t.layer=this.node.layer,t.hideFlags|=1032;let e=null;try{e=t.addComponent("cc.Graphics"),e.lineWidth=5,e.strokeColor=new Ls(255,0,0,255),this._debugRenderer=e,t.parent=this.node,this.node.on("layer-changed",this._applyLayer,this)}catch(e){G(4501,e.message),t.destroy(),t=null}}this.isAnimationCached()&&j(16418)}else this._debugRenderer&&(this.node.off("layer-changed",this._applyLayer,this),this._debugRenderer.node.destroy(),this._debugRenderer=null,this.isAnimationCached()||this._instance&&this._instance.setDebugMode(!1))}_updateUITransform(){const t=this.node._getUITransformComp(),e=this._runtimeData;if(!e)return t.setContentSize(100,100),t.anchorX=.5,void(t.anchorX=.5);const i=e.width,s=e.height;i&&s&&(t.setContentSize(i,s),0!==i&&(t.anchorX=Math.abs(e.x)/i),0!==s&&(t.anchorY=Math.abs(e.y)/s))}_updateColor(){const t=this,e=t.node._uiProps,i=t._tempColor,s=t._color,r=t.node.parent?t.node.parent._uiProps.opacity:1,n=e.localOpacity*r*s.a/255;if(i.r===s.r&&i.g===s.g&&i.b===s.b&&i.a===n)return;e.colorDirty=!0,i.r=s.r,i.g=s.g,i.b=s.b,i.a=n;const o=s.r/255,a=s.g/255,h=s.b/255;this._instance.setColor(o,a,h,n)}setVertexEffectDelegate(t){if(!this._instance)return;if(!t)return void this._instance.clearEffect();const e=null==t?void 0:t.getEffectType();if("jitter"===e){const e=null==t?void 0:t.getJitterVertexEffect();this._instance.setJitterEffect(e)}else if("swirl"===e){const e=null==t?void 0:t.getJitterVertexEffect();this._instance.setSwirlEffect(e)}}_ensureListener(){this._listener||(this._listener=new KAt,this._eventListenerID=KAt.addListener(this._listener),this._instance.setListener(this._eventListenerID))}setStartListener(t){this._ensureListener(),this._listener.start=t}setInterruptListener(t){this._ensureListener(),this._listener.interrupt=t}setEndListener(t){this._ensureListener(),this._listener.end=t}setDisposeListener(t){this._ensureListener(),this._listener.dispose=t}setCompleteListener(t){this._ensureListener(),this._listener.complete=t}setEventListener(t){this._ensureListener(),this._listener.event=t}setTrackStartListener(t,e){KAt.getListeners(t,this._instance).start=e}setTrackInterruptListener(t,e){KAt.getListeners(t,this._instance).interrupt=e}setTrackEndListener(t,e){KAt.getListeners(t,this._instance).end=e}setTrackDisposeListener(t,e){KAt.getListeners(t,this._instance).dispose=e}setTrackCompleteListener(t,e){KAt.getListeners(t,this._instance).complete=t=>{const i=Math.floor(t.trackTime/t.animationEnd);e(t,i)}}setTrackEventListener(t,e){KAt.getListeners(t,this._instance).event=e}getDebugShapes(){return this._instance.getDebugShapes()}setSlotTexture(t,e,i){if(this.isAnimationCached())return void P("Cached mode can't change texture of slot");if(!this.findSlot(t))return void P(`No slot named:${t}`);const s=e.width,r=e.height,n=i||!1;this._instance.resizeSlotRegion(t,s,r,n);let o=e.uuid;o||(o=e.getId()),this._instance.setSlotTexture(t,o),this._slotTextures||(this._slotTextures=new Map),this._slotTextures.set(o,e)}_destroySkeletonInfo(t){t&&this._skeletonInfo&&(t.destroySkeleton(this._skeletonInfo.assetUUID),this._skeletonInfo=null)}_applyLayer(){this._debugRenderer&&(this._debugRenderer.node.layer=this.node.layer)}},qDt.SpineSocket=eEt,qDt.AnimationCacheMode=KDt,BDt=Za((RDt=qDt).prototype,"_skeletonData",[vh],(function(){return null})),FDt=Za(RDt.prototype,"defaultSkin",[vh],(function(){return""})),NDt=Za(RDt.prototype,"defaultAnimation",[vh],(function(){return""})),LDt=Za(RDt.prototype,"_premultipliedAlpha",[vh],(function(){return!0})),kDt=Za(RDt.prototype,"_timeScale",[vh],(function(){return 1})),zDt=Za(RDt.prototype,"_preCacheMode",[vh],(function(){return-1})),UDt=Za(RDt.prototype,"_cacheMode",[vh],(function(){return 0})),VDt=Za(RDt.prototype,"_sockets",[vh],(function(){return[]})),jDt=Za(RDt.prototype,"_useTint",[vh],(function(){return!1})),HDt=Za(RDt.prototype,"_debugMesh",[vh],(function(){return!1})),GDt=Za(RDt.prototype,"_debugBones",[vh],(function(){return!1})),WDt=Za(RDt.prototype,"_debugSlots",[vh],(function(){return!1})),XDt=Za(RDt.prototype,"_enableBatch",[vh],(function(){return!1})),s(RDt.prototype,"skeletonData",[ADt],Object.getOwnPropertyDescriptor(RDt.prototype,"skeletonData"),RDt.prototype),s(RDt.prototype,"_defaultSkinIndex",[DDt],Object.getOwnPropertyDescriptor(RDt.prototype,"_defaultSkinIndex"),RDt.prototype),s(RDt.prototype,"_animationIndex",[EDt],Object.getOwnPropertyDescriptor(RDt.prototype,"_animationIndex"),RDt.prototype),s(RDt.prototype,"defaultCacheMode",[IDt],Object.getOwnPropertyDescriptor(RDt.prototype,"defaultCacheMode"),RDt.prototype),YDt=Za(RDt.prototype,"loop",[vh],(function(){return!0})),s(RDt.prototype,"sockets",[MDt],Object.getOwnPropertyDescriptor(RDt.prototype,"sockets"),RDt.prototype),s(RDt.prototype,"customMaterial",[Yh,PDt],Object.getOwnPropertyDescriptor(RDt.prototype,"customMaterial"),RDt.prototype),ODt=RDt))||ODt);h.internal.SpineSkeleton=iEt;const sEt=1.1,rEt=new Ls(0,0,255,255),nEt=new Ls(255,0,0,255),oEt=new Ls(0,255,0,255),aEt=new Ls(255,255,0,255);let hEt,lEt,cEt,uEt,dEt=null,_Et=null,pEt=!1,mEt=!1;const gEt=sI(JE),fEt=sI(eI),yEt=new Ms(0,0,0);function bEt(t,e){let i,s;switch(t){case 1:i=pEt?1:2,s=1;break;case 2:i=7,s=4;break;case 3:i=pEt?1:2,s=8;break;default:i=pEt?1:2,s=4}return e.getMaterialForBlendAndTint(i,s,mEt?1:0)}const vEt=new class{constructor(){this.vCount=32767}ensureAccessor(t){let e=t?_Et:dEt;if(!e){const i=nC.root.device,s=nC.root.batcher2D,r=t?eI:JE;t?(e=_Et=new dI(i,r,this.vCount),s.registerBufferAccessor(Number.parseInt("SPINETINT",36),_Et)):(e=dEt=new dI(i,r,this.vCount),s.registerBufferAccessor(Number.parseInt("SPINE",36),dEt))}return e}createData(t){let e=t.renderData;if(!e){const i=t.useTint||t.isAnimationCached(),s=this.ensureAccessor(i);e=yI.add(i?eI:JE,s)}return e}updateRenderData(t){var e;t._skeleton&&t.node.active&&null!=(e=t.skeletonData)&&e.isValid&&SEt(t)}};function SEt(t){t.drawList.reset();const e=t.renderData;if(0===t.color.a||!e)return;t._updateColor(),pEt=t.premultipliedAlpha,mEt=t.useTint||t.isAnimationCached(),t.isAnimationCached()?wEt(t):TEt(t);const i=mEt?_Et:dEt;t.syncAttachedNode(),(e.vertexCount>0||e.indexCount>0)&&i.getMeshBuffer(e.chunk.bufferId).setDirty()}function TEt(t){var e,i;const s=(t.useTint?fEt:gEt)/4,r=t.updateRenderData(),n=r.vCount,o=r.iCount,a=t.renderData;if(!a||n<1||o<1)return;a.vertexCount===n&&a.indexCount===o||((a.vertexCount<n||a.indexCount<o)&&a.resize(Math.ceil(n*sEt),Math.ceil(o*sEt)),a.indices=new Uint16Array(o),t._vLength=4*n*s,t._vBuffer=new Uint8Array(a.chunk.vb.buffer,a.chunk.vb.byteOffset,t._vLength),t._iLength=2*o,t._iBuffer=new Uint8Array(a.indices.buffer));const h=a.chunk.vb,l=r.vPtr,c=r.iPtr,u=a.indices,d=YAt.wasmUtil.wasm.HEAPU8;null==(e=t._vBuffer)||e.set(d.subarray(l,l+t._vLength),0),null==(i=t._iBuffer)||i.set(d.subarray(c,c+t._iLength),0);const _=a.chunk.vertexOffset;for(let t=0;t<o;t++)u[t]+=_;const p=r.getData(),m=r.getTextures(),g=p.size();let f=0,y=0;for(let e=0;e<g;e+=5){y=p.get(e+3);const i=bEt(p.get(e+4),t);t.requestDrawData(i,m.get(e/5),f,y),f+=y}if(t.enableBatch){const e=t.node.worldMatrix;let i=0;for(let t=0;t<n;t++)i=t*s,yEt.x=h[i],yEt.y=h[i+1],yEt.z=0,yEt.transformMat4(e),h[i]=yEt.x,h[i+1]=yEt.y,h[i+2]=yEt.z}const b=t._debugRenderer,v=t._skeleton;if(b&&(t.debugBones||t.debugSlots||t.debugMesh)){b.clear();const e=t.getDebugShapes(),i=e.size();for(let r=0;r<i;r++){const i=e.get(r);if(0===i.type&&t.debugSlots){b.strokeColor=rEt;const t=i.vOffset*s,e=i.vCount*s;b.moveTo(h[t],h[t+1]);for(let i=t+s,r=t+e;i<r;i+=s)b.lineTo(h[i],h[i+1]);b.close(),b.stroke()}else if(1===i.type&&t.debugMesh){b.strokeColor=aEt;const t=i.iCount,e=i.iOffset;for(let i=e,r=e+t;i<r;i+=3){const t=u[i]*s,e=u[i+1]*s,r=u[i+2]*s;b.moveTo(h[t],h[t+1]),b.lineTo(h[e],h[e+1]),b.lineTo(h[r],h[r+1]),b.close(),b.stroke()}}}if(t.debugBones){b.strokeColor=nEt,b.fillColor=rEt;for(let t=0,e=v.bones.length;t<e;t++){const e=v.bones[t],i=e.data.length*e.a+e.worldX,s=e.data.length*e.c+e.worldY;b.moveTo(e.worldX,e.worldY),b.lineTo(i,s),b.stroke(),b.circle(e.worldX,e.worldY,1.5*Math.PI),b.fill(),0===t&&(b.fillColor=oEt)}}}}function wEt(t){const e=t.updateRenderData();if(!e)return;const i=e.vCount,s=e.iCount,r=t.renderData;if(!r||i<1||s<1)return;r.vertexCount===i&&r.indexCount===s||((r.vertexCount<i||r.indexCount<s)&&r.resize(Math.ceil(i*sEt),Math.ceil(s*sEt)),r.indices=new Uint16Array(s));const n=r.chunk.vb,o=new Uint8Array(n.buffer,n.byteOffset,4*n.length);o.set(e.vData);const a=t.color,h=t.node._uiProps.opacity;if(1-h>Mi||4294967295!==Ls.toUint32(a)||pEt){hEt=a.r/255,lEt=a.g/255,cEt=a.b/255,uEt=h;for(let t=0;t<i;t++){const e=t*fEt+20,i=o[e],s=o[e+1],r=o[e+2],n=o[e+3]*uEt,a=pEt?n/255:1;o[e]=Math.floor(a*i*hEt),o[e+1]=Math.floor(a*s*lEt),o[e+2]=Math.floor(a*r*cEt),o[e+3]=Math.floor(n),o[e+4]=Math.floor(o[e+4]*hEt),o[e+5]=Math.floor(o[e+5]*lEt),o[e+6]=Math.floor(o[e+6]*cEt),o[e+7]=pEt?255:0}}const l=r.indices;l.set(e.iData);const c=r.chunk.vertexOffset;for(let t=0;t<s;t++)l[t]+=c;const u=e.meshes,d=u.length;let _=0,p=0;for(let e=0;e<d;e++){const i=u[e],s=bEt(i.blendMode,t),r=i.textureID;p=i.iCount,t.requestDrawData(s,r,_,p),_+=p}const m=fEt/4;if(t.enableBatch){const e=t.node.worldMatrix;let s=0;for(let t=0;t<i;t++)s=t*m,yEt.x=n[s],yEt.y=n[s+1],yEt.z=0,yEt.transformMat4(e),n[s]=yEt.x,n[s+1]=yEt.y,n[s+2]=yEt.z}}h.internal.SpineAssembler=vEt;const xEt={getAssembler:()=>vEt};iEt.Assembler=xEt;const CEt=globalThis.spine;CEt.EventType=YAt.EventType;const AEt=CEt.VertexEffectDelegate;let DEt,EEt;function IEt(){return Promise.resolve()}!function(t){t[t.REGION=0]="REGION",t[t.BOUNDING_BOX=1]="BOUNDING_BOX",t[t.MESH=2]="MESH",t[t.SKINNED_MESH=3]="SKINNED_MESH"}(DEt||(DEt={})),fe(DEt),function(t){t[t.START=0]="START",t[t.INTERRUPT=1]="INTERRUPT",t[t.END=2]="END",t[t.COMPLETE=3]="COMPLETE",t[t.DISPOSE=4]="DISPOSE",t[t.EVENT=5]="EVENT"}(EEt||(EEt={})),fe(EEt),h.internal.SpineAnimationEventType=EEt,h.internal.SPINE_VERSION="3.8",t("sp",Object.freeze({__proto__:null,get ATTACHMENT_TYPE(){return DEt},AnimationCacheMode:ZDt,get AnimationEventType(){return EEt},DefaultAnimsEnum:tEt,DefaultSkinsEnum:QDt,SPINE_VERSION:"3.8",Skeleton:iEt,SkeletonData:mDt,SpineAnimationCacheMode:KDt,SpineDefaultAnimsEnum:JDt,SpineMaterialType:{COLORED_TEXTURED:0,TWO_COLORED:1},SpineSocket:eEt,VertexEffectDelegate:AEt,isBinaryCompatible:function(){return!1},isJsonCompatible:function(){return!1},loadWasmModuleSpine:IEt,simpleSpineAssembler:xEt,spine:CEt,timeScale:1})),t("HeightField",class{constructor(t,e){this.data=new Uint16Array,this.w=0,this.h=0,this.w=t,this.h=e,this.data=new Uint16Array(t*e);for(let i=0;i<t*e;++i)this.data[i]=0}set(t,e,i){this.data[e*this.w+t]=i}get(t,e){return this.data[e*this.w+t]}getClamp(t,e){return t=Ri(t,0,this.w-1),e=Ri(e,0,this.h-1),this.get(t,e)}getAt(t,e){const i=t,s=e;let r=Math.floor(i),n=Math.floor(s),o=r+1,a=n+1;const h=i-r,l=s-n;r=Ri(r,0,this.w-1),n=Ri(n,0,this.h-1),o=Ri(o,0,this.w-1),a=Ri(a,0,this.h-1);let c=this.get(r,n);const u=this.get(o,n),d=this.get(r,a);let _=this.get(o,a);const p=.5*(u+d);return h+l<=1?_=p+(p-c):c=p+(p-_),(c*(1-h)+u*h)*(1-l)+(d*(1-h)+_*h)*l}});const MEt=33,PEt=1e14;class OEt{constructor(){this.level=0,this.north=0,this.south=0,this.west=0,this.east=0}equals(t){return this.level===t.level&&this.north===t.north&&this.south===t.south&&this.west===t.west&&this.east===t.east}}class REt{constructor(){this.size=0,this.indices=null}}class BEt{constructor(){this.key=new OEt,this.start=0,this.size=0,this.buffer=null,this.primCount=0}}class FEt{static mapIndex(t,e,i){return 16*t+4*e+i}constructor(){this._bodyIndexPool=void 0,this._connecterIndexPool=void 0,this._indexMap=[],this._indexBuffer=new Uint16Array,this._bodyIndexPool=new Array(4);for(let t=0;t<4;++t)this._bodyIndexPool[t]=new REt;this._connecterIndexPool=new Array(64);for(let t=0;t<4;++t)for(let e=0;e<4;++e)for(let i=0;i<4;++i)this._connecterIndexPool[FEt.mapIndex(t,e,i)]=new REt;for(let t=0;t<4;++t)this._genBodyIndex(t);for(let t=0;t<4;++t)for(let e=0;e<4;++e)this._genConnecterIndexNorth(t,e),this._genConnecterIndexSouth(t,e),this._genConnecterIndexWest(t,e),this._genConnecterIndexEast(t,e);for(let t=0;t<4;++t)for(let e=0;e<4;++e)if(!(e<t))for(let i=0;i<4;++i)if(!(i<t))for(let s=0;s<4;++s)if(!(s<t))for(let r=0;r<4;++r){if(r<t)continue;const n=new OEt;n.level=t,n.north=e,n.south=i,n.west=s,n.east=r,this._genIndexData(n)}}getIndexData(t){for(let e=0;e<this._indexMap.length;++e)if(this._indexMap[e].key.equals(t))return this._indexMap[e];return null}_genBodyIndex(t){const e=1<<t;let i=32>>t,s=0;if(t<3&&(i-=2,s=e*MEt+e),0===i||0===i)return;const r=i*i*6;this._bodyIndexPool[t].indices=new Uint16Array(r);let n=0;const o=new Uint16Array(r);let a=s,h=a+MEt*e;for(let t=0;t<i;++t){for(let t=0;t<i;++t)o[n++]=h+t*e,o[n++]=h+(t+1)*e,o[n++]=a+t*e,o[n++]=h+(t+1)*e,o[n++]=a+(t+1)*e,o[n++]=a+t*e;a+=MEt*e,h+=MEt*e}this._bodyIndexPool[t].size=n,this._bodyIndexPool[t].indices=o}_genConnecterIndexNorth(t,e){const i=FEt.mapIndex(t,e,0);if(e<t||3===t)return this._connecterIndexPool[i].size=0,void(this._connecterIndexPool[i].indices=null);const s=1<<t,r=1<<e,n=32>>t;let o=0;const a=new Uint16Array(2*n+2);a[o++]=0,a[o++]=0;for(let t=1;t<n;++t){const e=t*s,i=s*MEt+e,n=(s-s)*MEt+e/r*r;a[o++]=i,a[o++]=n}a[o++]=32,a[o++]=32,this._connecterIndexPool[i].size=o,this._connecterIndexPool[i].indices=a}_genConnecterIndexSouth(t,e){const i=FEt.mapIndex(t,e,1);if(e<t||3===t)return this._connecterIndexPool[i].size=0,void(this._connecterIndexPool[i].indices=null);const s=1<<t,r=1<<e,n=32>>t;let o=0;const a=new Uint16Array(2*n+2);a[o++]=1056,a[o++]=1056;for(let t=1;t<n;++t){const e=t*s,i=32-s,n=(i+s)*MEt+e/r*r,h=i*MEt+e;a[o++]=n,a[o++]=h}a[o++]=1088,a[o++]=1088,this._connecterIndexPool[i].size=o,this._connecterIndexPool[i].indices=a}_genConnecterIndexWest(t,e){const i=FEt.mapIndex(t,e,2);if(e<t||3===t)return this._connecterIndexPool[i].size=0,void(this._connecterIndexPool[i].indices=null);const s=1<<t,r=1<<e,n=32>>t;let o=0;const a=new Uint16Array(2*n+2);a[o++]=0,a[o++]=0;for(let t=1;t<n;++t){const e=t*s/r*r*MEt+0,i=t*s*MEt+s;a[o++]=e,a[o++]=i}a[o++]=1056,a[o++]=1056,this._connecterIndexPool[i].size=o,this._connecterIndexPool[i].indices=a}_genConnecterIndexEast(t,e){const i=FEt.mapIndex(t,e,3);if(e<t||3===t)return this._connecterIndexPool[i].size=0,void(this._connecterIndexPool[i].indices=null);const s=1<<t,r=1<<e,n=32>>t;let o=0;const a=new Uint16Array(2*n+2);a[o++]=32,a[o++]=32;for(let t=1;t<n;++t){const e=t*s*MEt+(32-s),i=t*s/r*r*MEt+32;a[o++]=e,a[o++]=i}a[o++]=1088,a[o++]=1088,this._connecterIndexPool[i].size=o,this._connecterIndexPool[i].indices=a}_getConnenterIndex(t,e,i){return this._connecterIndexPool[FEt.mapIndex(t,e,i)]}_genIndexData(t){let e=this.getIndexData(t);if(null!=e)return e;const i=this._bodyIndexPool[t.level],s=this._getConnenterIndex(t.level,t.north,0),r=this._getConnenterIndex(t.level,t.south,1),n=this._getConnenterIndex(t.level,t.west,2),o=this._getConnenterIndex(t.level,t.east,3);if(e=new BEt,e.size=0,e.primCount=0,null!=i.indices&&(e.size+=i.size),s.indices&&(e.size+=3*(s.size-2)),r.indices&&(e.size+=3*(r.size-2)),n.indices&&(e.size+=3*(n.size-2)),o.indices&&(e.size+=3*(o.size-2)),0===e.size)return null;let a=0;if(e.buffer=new Uint16Array(e.size),e.key.level=t.level,e.key.east=t.east,e.key.west=t.west,e.key.north=t.north,e.key.south=t.south,i.indices)for(let t=0;t<i.size;++t)e.buffer[a++]=i.indices[t];if(s.indices)for(let t=0;t<s.size-2;t+=2){const i=s.indices[t+0],r=s.indices[t+1],n=s.indices[t+2],o=s.indices[t+3];e.buffer[a++]=i,e.buffer[a++]=n,e.buffer[a++]=r,e.buffer[a++]=n,e.buffer[a++]=o,e.buffer[a++]=r}if(r.indices)for(let t=0;t<r.size-2;t+=2){const i=r.indices[t+0],s=r.indices[t+1],n=r.indices[t+2],o=r.indices[t+3];e.buffer[a++]=i,e.buffer[a++]=n,e.buffer[a++]=s,e.buffer[a++]=n,e.buffer[a++]=o,e.buffer[a++]=s}if(n.indices)for(let t=0;t<n.size-2;t+=2){const i=n.indices[t+0],s=n.indices[t+1],r=n.indices[t+2],o=n.indices[t+3];e.buffer[a++]=i,e.buffer[a++]=r,e.buffer[a++]=s,e.buffer[a++]=r,e.buffer[a++]=o,e.buffer[a++]=s}if(o.indices)for(let t=0;t<o.size-2;t+=2){const i=o.indices[t+0],s=o.indices[t+1],r=o.indices[t+2],n=o.indices[t+3];e.buffer[a++]=i,e.buffer[a++]=r,e.buffer[a++]=s,e.buffer[a++]=r,e.buffer[a++]=n,e.buffer[a++]=s}e.primCount=a/3,e.start=this._indexBuffer.length,this._indexMap.push(e);const h=new Uint16Array(e.start+e.size);return h.set(this._indexBuffer,0),h.set(e.buffer,e.start),this._indexBuffer=h,e}}var NEt,LEt,kEt,zEt,UEt,VEt,jEt,HEt,GEt,WEt,XEt,YEt,qEt,$Et,KEt,ZEt,QEt,JEt,tIt,eIt,iIt,sIt,rIt,nIt,oIt,aIt,hIt,lIt,cIt,uIt,dIt,_It,pIt,mIt,gIt,fIt,yIt,bIt;let vIt=t("TerrainInfo",ah("cc.TerrainInfo")((LEt=class{constructor(){this.tileSize=kEt&&kEt(),this.blockCount=zEt&&zEt(),this.weightMapSize=UEt&&UEt(),this.lightMapSize=VEt&&VEt()}get size(){const t=new Vr(0,0);return t.width=this.blockCount[0]*Qbt*this.tileSize,t.height=this.blockCount[1]*Qbt*this.tileSize,t}get tileCount(){const t=[0,0];return t[0]=this.blockCount[0]*Qbt,t[1]=this.blockCount[1]*Qbt,t}get vertexCount(){const t=this.tileCount;return t[0]+=1,t[1]+=1,t}},kEt=Za(LEt.prototype,"tileSize",[vh],(function(){return 1})),zEt=Za(LEt.prototype,"blockCount",[vh],(function(){return[1,1]})),UEt=Za(LEt.prototype,"weightMapSize",[vh],(function(){return 128})),VEt=Za(LEt.prototype,"lightMapSize",[vh],(function(){return 128})),NEt=LEt))||NEt),SIt=t("TerrainLayer",ah("cc.TerrainLayer")((HEt=class{constructor(){this.detailMap=GEt&&GEt(),this.normalMap=WEt&&WEt(),this.tileSize=XEt&&XEt(),this.metallic=YEt&&YEt(),this.roughness=qEt&&qEt()}},GEt=Za(HEt.prototype,"detailMap",[vh],(function(){return null})),WEt=Za(HEt.prototype,"normalMap",[vh],(function(){return null})),XEt=Za(HEt.prototype,"tileSize",[vh],(function(){return 1})),YEt=Za(HEt.prototype,"metallic",[vh],(function(){return 0})),qEt=Za(HEt.prototype,"roughness",[vh],(function(){return 1})),jEt=HEt))||jEt);class TIt extends LB{constructor(...t){super(...t),this._model=null,this._meshData=null,this._brushPass=null,this._brushMaterial=null,this._currentMaterial=null,this._currentMaterialLayers=0,this._lightmap=null}destroy(){return null!=this._model&&(h.director.root.destroyModel(this._model),this._model=null),super.destroy()}_destroyModel(){null!=this._model&&(h.director.root.destroyModel(this._model),this._model=null),null!=this._meshData&&(this._meshData.destroy(),this._meshData=null)}_invalidMaterial(){null!=this._currentMaterial&&(this._clearMaterials(),this._brushPass=null,this._currentMaterial=null,null!=this._model&&(this._model.enabled=!1))}_updateMaterial(t,e){if(null==this._meshData||null==this._model)return!1;const i=t.getMaxLayer();if(null==this._currentMaterial||i!==this._currentMaterialLayers){if(this._currentMaterial=new fv,this._currentMaterial.initialize({effectAsset:t.getTerrain().getEffectAsset(),defines:t._getMaterialDefines(i)}),null!==this._brushMaterial){const t=new fv;t.copy(this._brushMaterial),this._brushPass=null,null!==t.passes&&t.passes.length>0&&(this._brushPass=t.passes[0],this._currentMaterial.passes.push(this._brushPass),t.passes.pop())}return e&&this._model.initSubModel(0,this._meshData,this._currentMaterial),this.setSharedMaterial(this._currentMaterial,0),this._currentMaterialLayers=i,this._model.enabled=!0,this._model.receiveShadow=t.getTerrain().receiveShadow,!0}return!1}_updateLightingmap(t,e){null!=this._model&&(this._lightmap=t,this._updateReceiveDirLight(),this._model.updateLightingmap(t,e))}_onMaterialModified(t,e){null!=this._model&&this._onRebuildPSO(t,e||this._getBuiltinMaterial())}_onRebuildPSO(t,e){this._model&&this._model.setSubModelMaterial(t,e)}_clearMaterials(){null!=this._model&&this._onMaterialModified(0,null)}_onUpdateReceiveDirLight(t,e=!1){this._model&&(e?this._model.receiveDirLight=!1:this.node&&(t&this.node.layer)===this.node.layer||t&this._model.visFlags?this._model.receiveDirLight=!0:this._model.receiveDirLight=!1)}_updateReceiveDirLight(){const t=this.node.scene;if(!t||!t.renderScene)return;const e=t.renderScene.mainLight;if(!e)return;const i=e.visibility;e.node&&(e.node.mobility===Vy.Static&&this._lightmap?this._onUpdateReceiveDirLight(i,!0):this._onUpdateReceiveDirLight(i))}_getBuiltinMaterial(){return iC.get("missing-material")}}let wIt=t("TerrainBlockLightmapInfo",ah("cc.TerrainBlockLightmapInfo")((KEt=class{constructor(){this.texture=ZEt&&ZEt(),this.UOff=QEt&&QEt(),this.VOff=JEt&&JEt(),this.UScale=tIt&&tIt(),this.VScale=eIt&&eIt()}},ZEt=Za(KEt.prototype,"texture",[vh],(function(){return null})),QEt=Za(KEt.prototype,"UOff",[vh],(function(){return 0})),JEt=Za(KEt.prototype,"VOff",[vh],(function(){return 0})),tIt=Za(KEt.prototype,"UScale",[vh],(function(){return 0})),eIt=Za(KEt.prototype,"VScale",[vh],(function(){return 0})),$Et=KEt))||$Et);class xIt{constructor(t,e,i){this._terrain=void 0,this._node=void 0,this._renderable=void 0,this._index=[1,1],this._weightMap=null,this._lightmapInfo=null,this._lodLevel=0,this._lodKey=new OEt,this._errorMetrics=[0,0,0,0],this._LevelDistances=[PEt,PEt,PEt,PEt],this._bbMin=Ps(),this._bbMax=Ps(),this._terrain=t,this._index[0]=e,this._index[1]=i,this._lightmapInfo=t._getLightmapInfo(e,i),this._node=new tb("TerrainBlock"),this._node.setParent(this._terrain.node),this._node.hideFlags|=1032,this._node.layer=this._terrain.node.layer,this._renderable=this._node.addComponent(TIt)}build(){const t=nC.root.device,e=new Float32Array(tvt*Jbt*Jbt);this._buildVertexData(e);const i=t.createBuffer(new a_(10,1,4*tvt*Jbt*Jbt,4*tvt));i.update(e),this._buildBoundingBox();const s=[new x_("a_position",32),new x_("a_normal",32),new x_("a_texCoord",21)];this._renderable._meshData=new wD([i],s,7,this._terrain._getSharedIndexBuffer(),null,!1),this._renderable._model=h.director.root.createModel(mb),this._renderable._model.createBoundingShape(this._bbMin,this._bbMax),this._renderable._model.node=this._renderable._model.transform=this._node,null!=this._renderable.node.scene&&(this.visible=!0),this._updateWeightMap(),this._updateMaterial(!0),this._terrain.lodEnable&&(this._updateLodBuffer(e),this._updateIndexBuffer())}rebuild(){this._updateHeight(),this._updateWeightMap(),this._renderable._invalidMaterial(),this._updateMaterial(!1)}destroy(){this.visible=!1,this._renderable._destroyModel(),null!=this._node&&this._node.isValid&&this._node.destroy(),null!=this._weightMap&&this._weightMap.destroy()}update(){this._updateMaterial(!1),this.lightmap!==this._renderable._lightmap&&this._renderable._updateLightingmap(this.lightmap,this.lightmapUVParam);const t=this._terrain.useNormalMap,e=this._terrain.usePBR,i=t=>null!==t?t.detailMap:null,s=t=>{let e=null!==t?t.normalMap:null;return null===e&&(e=iC.get("normal-texture")),e},r=this._renderable._currentMaterial;if(null!==r){const n=this.getMaxLayer(),o=new ms(1,1,1,1),a=new ms(1,1,1,1),h=new ms(0,0,0,0);if(0===n)if(-1!==this.layers[0]){const e=this._terrain.getLayer(this.layers[0]);null!==e&&(o.x=1/e.tileSize,a.x=e.roughness,h.x=e.metallic),r.setProperty("detailMap0",i(e)),t&&r.setProperty("normalMap0",s(e))}else r.setProperty("detailMap0",iC.get("default-texture")),t&&r.setProperty("normalMap0",iC.get("normal-texture"));else if(1===n){const e=this._terrain.getLayer(this.layers[0]),n=this._terrain.getLayer(this.layers[1]);null!==e&&(o.x=1/e.tileSize,a.x=e.roughness,h.x=e.metallic),null!==n&&(o.y=1/n.tileSize,a.y=n.roughness,h.y=n.metallic),r.setProperty("weightMap",this._weightMap),r.setProperty("detailMap0",i(e)),r.setProperty("detailMap1",i(n)),t&&(r.setProperty("normalMap0",s(e)),r.setProperty("normalMap1",s(n)))}else if(2===n){const e=this._terrain.getLayer(this.layers[0]),n=this._terrain.getLayer(this.layers[1]),l=this._terrain.getLayer(this.layers[2]);null!==e&&(o.x=1/e.tileSize,a.x=e.roughness,h.x=e.metallic),null!==n&&(o.y=1/n.tileSize,a.y=n.roughness,h.y=n.metallic),null!==l&&(o.z=1/l.tileSize,a.z=l.roughness,h.z=l.metallic),r.setProperty("weightMap",this._weightMap),r.setProperty("detailMap0",i(e)),r.setProperty("detailMap1",i(n)),r.setProperty("detailMap2",i(l)),t&&(r.setProperty("normalMap0",s(e)),r.setProperty("normalMap1",s(n)),r.setProperty("normalMap2",s(l)))}else if(3===n){const e=this._terrain.getLayer(this.layers[0]),n=this._terrain.getLayer(this.layers[1]),l=this._terrain.getLayer(this.layers[2]),c=this._terrain.getLayer(this.layers[3]);null!==e&&(o.x=1/e.tileSize,a.x=e.roughness,h.x=e.metallic),null!==n&&(o.y=1/n.tileSize,a.y=n.roughness,h.y=n.metallic),null!==l&&(o.z=1/l.tileSize,a.z=l.roughness,h.z=l.metallic),null!==c&&(o.w=1/c.tileSize,a.w=c.roughness,h.w=c.metallic),r.setProperty("weightMap",this._weightMap),r.setProperty("detailMap0",i(e)),r.setProperty("detailMap1",i(n)),r.setProperty("detailMap2",i(l)),r.setProperty("detailMap3",i(c)),t&&(r.setProperty("normalMap0",s(e)),r.setProperty("normalMap1",s(n)),r.setProperty("normalMap2",s(l)),r.setProperty("normalMap3",s(c)))}r.setProperty("UVScale",o),e&&(r.setProperty("roughness",a),r.setProperty("metallic",h))}}_buildLodInfo(){const t=new Float32Array(tvt*Jbt*Jbt);this._buildVertexData(t),this._updateLodBuffer(t),this._updateIndexBuffer()}_updateLevel(t){const e=this._terrain,i=e.node,s=Ps(),r=Ps();Ms.add(s,this._bbMin,i.worldPosition),Ms.add(r,this._bbMax,i.worldPosition);const n=Ms.distance(s,t),o=Ms.distance(r,t);let a=Math.min(n,o);for(a-=e.LodBias,this._lodLevel=0;this._lodLevel<3&&!(a<=this._LevelDistances[this._lodLevel+1]);)++this._lodLevel}setBrushMaterial(t){this._renderable._brushMaterial!==t&&(this._renderable._invalidMaterial(),this._renderable._brushMaterial=t)}_getBrushMaterial(){return this._renderable?this._renderable._brushMaterial:null}_getBrushPass(){return this._renderable?this._renderable._brushPass:null}get valid(){if(null===this._terrain)return!1;const t=this._terrain.getBlocks();for(let e=0;e<t.length;++e)if(t[e]===this)return!0;return!1}get material(){return this._renderable?this._renderable._currentMaterial:null}get layers(){return this._terrain.getBlockLayers(this._index[0],this._index[1])}get weightmap(){return this._weightMap}get lightmap(){return this._lightmapInfo?this._lightmapInfo.texture:null}get lightmapUVParam(){return null!=this._lightmapInfo?new ms(this._lightmapInfo.UOff,this._lightmapInfo.VOff,this._lightmapInfo.UScale,this._lightmapInfo.VScale):new ms(0,0,0,0)}set visible(t){null!==this._renderable._model&&(t?null!=this._terrain.node&&null!=this._terrain.node.scene&&null!=this._terrain.node.scene.renderScene&&null==this._renderable._model.scene&&this._terrain.node.scene.renderScene.addModel(this._renderable._model):null!==this._renderable._model.scene&&this._renderable._model.scene.removeModel(this._renderable._model))}get visible(){return null!==this._renderable._model&&null!==this._renderable._model.scene}getTerrain(){return this._terrain}getIndex(){return this._index}getRect(){const t=new Wr;return t.x=this._index[0]*Qbt,t.y=this._index[1]*Qbt,t.width=Qbt,t.height=Qbt,t}setLayer(t,e){this.layers[t]!==e&&(this._terrain.setBlockLayer(this._index[0],this._index[1],t,e),this._renderable._invalidMaterial(),this._updateMaterial(!1))}getLayer(t){return this.layers[t]}getMaxLayer(){return this.layers[3]>=0?3:this.layers[2]>=0?2:this.layers[1]>=0?1:0}_getMaterialDefines(t){let e=1;return this._terrain.node&&this._terrain.node.scene&&this._terrain.node.scene.globals.bakedWithStationaryMainLight&&(e=2),{LAYERS:t+1,CC_USE_LIGHTMAP:null!==this.lightmap?e:0,USE_NORMALMAP:this._terrain.useNormalMap?1:0,USE_PBR:this._terrain.usePBR?1:0}}_invalidMaterial(){this._renderable._invalidMaterial()}_updateMaterial(t){this._renderable._updateMaterial(this,t)&&(null!==this.lightmap&&this.lightmap.setWrapMode(3,3),this._renderable._updateLightingmap(this.lightmap,this.lightmapUVParam))}_updateHeight(){if(null==this._renderable._meshData)return;const t=new Float32Array(tvt*Jbt*Jbt);this._buildVertexData(t),this._renderable._meshData.vertexBuffers[0].update(t),this._buildBoundingBox(),this._renderable._model.createBoundingShape(this._bbMin,this._bbMax),this._renderable._model.updateWorldBound(),this._updateLodBuffer(t),this._updateIndexBuffer()}_updateWeightMap(){if(0===this.getMaxLayer())return void(null!=this._weightMap&&(this._weightMap.destroy(),this._weightMap=null));null==this._weightMap&&(this._weightMap=new ff,this._weightMap.create(this._terrain.weightMapSize,this._terrain.weightMapSize,35),this._weightMap.setFilters(2,2),this._weightMap.setWrapMode(2,2));const t=new Uint8Array(this._terrain.weightMapSize*this._terrain.weightMapSize*4);let e=0;for(let i=0;i<this._terrain.weightMapSize;++i)for(let s=0;s<this._terrain.weightMapSize;++s){const r=this._index[0]*this._terrain.weightMapSize+s,n=this._index[1]*this._terrain.weightMapSize+i,o=this._terrain.getWeight(r,n);t[4*e+0]=Math.floor(255*o.x),t[4*e+1]=Math.floor(255*o.y),t[4*e+2]=Math.floor(255*o.z),t[4*e+3]=Math.floor(255*o.w),e+=1}this._weightMap.uploadData(t)}_updateLightmap(t){this._lightmapInfo=t,this._invalidMaterial()}_updateLod(){const t=new OEt;if(t.level=this._lodLevel,t.north=this._lodLevel,t.south=this._lodLevel,t.west=this._lodLevel,t.east=this._lodLevel,this._index[0]>0){const e=this.getTerrain().getBlock(this._index[0]-1,this._index[1]);t.west=e._lodLevel,t.west<this._lodLevel&&(t.west=this._lodLevel)}if(this._index[0]<this._terrain.info.blockCount[0]-1){const e=this.getTerrain().getBlock(this._index[0]+1,this._index[1]);t.east=e._lodLevel,t.east<this._lodLevel&&(t.east=this._lodLevel)}if(this._index[1]>0){const e=this.getTerrain().getBlock(this._index[0],this._index[1]-1);t.north=e._lodLevel,t.north<this._lodLevel&&(t.north=this._lodLevel)}if(this._index[1]<this._terrain.info.blockCount[1]-1){const e=this.getTerrain().getBlock(this._index[0],this._index[1]+1);t.south=e._lodLevel,t.south<this._lodLevel&&(t.south=this._lodLevel)}this._lodKey.equals(t)||(this._lodKey=t,this._updateIndexBuffer())}_resetLod(){const t=new OEt;t.level=0,t.north=0,t.south=0,t.west=0,t.east=0,this._lodKey.equals(t)||(this._lodKey=t,this._updateIndexBuffer())}_updateIndexBuffer(){if(null===this._renderable._meshData)return;if(null===this._renderable._model)return;if(0===this._renderable._model.subModels.length)return;const t=this._terrain._getIndexData(this._lodKey);if(null===t)return;const e=this._renderable._model.subModels[0];e.inputAssembler.firstIndex=t.start,e.inputAssembler.indexCount=t.size}_getHeight(t,e,i){return i[(Jbt*e+t)*tvt+1]}_updateLodBuffer(t){this._lodLevel=0,this._lodKey=new OEt,this._calcErrorMetrics(t),this._calcLevelDistances(t)}_calcErrorMetrics(t){this._errorMetrics[0]=0;for(let e=1;e<4;++e)this._errorMetrics[e]=this._calcErrorMetric(e,t);for(let t=2;t<4;++t)this._errorMetrics[t]=Math.max(this._errorMetrics[t],this._errorMetrics[t-1])}_calcErrorMetric(t,e){let i=0;const s=1<<t,r=Jbt,n=Jbt,o=r-1>>t,a=n-1>>t;for(let t=0;t<n;t+=s)for(let r=0;r<o;++r){const n=r*s,o=n+s,a=(o+n)/2,h=this._getHeight(n,t,e),l=this._getHeight(o,t,e),c=this._getHeight(a,t,e),u=(h+l)/2,d=Math.abs(c-u);i=Math.max(i,d)}for(let t=0;t<r;t+=s)for(let r=0;r<a;++r){const n=r*s,o=n+s,a=(n+o)/2,h=this._getHeight(t,n,e),l=this._getHeight(t,o,e),c=this._getHeight(t,a,e),u=(h+l)/2,d=Math.abs(c-u);i=Math.max(i,d)}for(let t=0;t<a;++t){const r=t*s,n=r+s,a=(r+n)/2;for(let t=0;t<o;++t){const o=t*s,h=o+s,l=(o+h)/2,c=this._getHeight(o,r,e),u=this._getHeight(h,n,e),d=this._getHeight(l,a,e),_=(c+u)/2,p=Math.abs(d-_);i=Math.max(i,p)}}return i}_calcLevelDistances(t){for(let t=1;t<4;++t){const e=96*this._errorMetrics[t];this._LevelDistances[t]=e}}_buildVertexData(t){let e=0;for(let i=0;i<Jbt;++i)for(let s=0;s<Jbt;++s){const r=this._index[0]*Qbt+s,n=this._index[1]*Qbt+i,o=this._terrain.getPosition(r,n),a=this._terrain.getNormal(r,n),h=new kr(s/Qbt,i/Qbt);t[e++]=o.x,t[e++]=o.y,t[e++]=o.z,t[e++]=a.x,t[e++]=a.y,t[e++]=a.z,t[e++]=h.x,t[e++]=h.y}}_buildBoundingBox(){this._bbMin.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._bbMax.set(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);for(let t=0;t<Jbt;++t)for(let e=0;e<Jbt;++e){const i=this._index[0]*Qbt+e,s=this._index[1]*Qbt+t,r=this._terrain.getPosition(i,s);Ms.min(this._bbMin,this._bbMin,r),Ms.max(this._bbMax,this._bbMax,r)}}}t("TerrainBlock",xIt),t("Terrain",(iIt=ah("cc.Terrain"),sIt=Xh(yvt),rIt=Xh(_v),nIt=Xh(wIt),oIt=Xh(We),aIt=Xh(yvt),hIt=Xh(_v),lIt=Xh(vIt),iIt(cIt=ch((uIt=class extends Km{constructor(){super(),this.__asset=dIt&&dIt(),this._effectAsset=_It&&_It(),this._lightmapInfos=pIt&&pIt(),this._receiveShadow=mIt&&mIt(),this._useNormalmap=gIt&&gIt(),this._usePBR=fIt&&fIt(),this._lodEnable=yIt&&yIt(),this._lodBias=bIt&&bIt(),this._buitinAsset=null,this._tileSize=1,this._blockCount=[1,1],this._weightMapSize=128,this._lightMapSize=128,this._heights=new Uint16Array,this._weights=new Uint8Array,this._normals=new Float32Array,this._layerList=[],this._layerBuffer=[],this._blocks=[],this._lod=null,this._sharedIndexBuffer=null,this._sharedLodIndexBuffer=null;for(let t=0;t<Zbt;++t)this._layerList.push(null)}set _asset(t){if(this.__asset=t,this._buitinAsset!==this.__asset){this._buitinAsset=this.__asset;for(let t=0;t<this._blocks.length;++t)this._blocks[t].destroy();if(this._blocks=[],null===this.__asset){this._effectAsset=null,this._lightmapInfos=[],this._receiveShadow=!1,this._useNormalmap=!1,this._usePBR=!1,this._tileSize=1,this._blockCount=[1,1],this._weightMapSize=128,this._lightMapSize=128,this._heights=new Uint16Array,this._weights=new Uint8Array,this._normals=new Float32Array,this._layerBuffer=[],this._blocks=[],this._layerList=[];for(let t=0;t<Zbt;++t)this._layerList.push(null)}yp.gfxDevice&&this._buildImp()}}get _asset(){return this.__asset}set effectAsset(t){if(this._effectAsset!==t){this._effectAsset=t;for(let t=0;t<this._blocks.length;++t)this._blocks[t]._invalidMaterial()}}get effectAsset(){return this._effectAsset}get receiveShadow(){return this._receiveShadow}set receiveShadow(t){this._receiveShadow=t;for(let t=0;t<this._blocks.length;t++)this._blocks[t]._invalidMaterial()}get useNormalMap(){return this._useNormalmap}set useNormalMap(t){this._useNormalmap=t;for(let t=0;t<this._blocks.length;t++)this._blocks[t]._invalidMaterial()}get usePBR(){return this._usePBR}set usePBR(t){this._usePBR=t;for(let t=0;t<this._blocks.length;t++)this._blocks[t]._invalidMaterial()}get lodEnable(){return this._lodEnable}set lodEnable(t){if(this._lodEnable=t,this._lodEnable&&null===this._lod){this._lod=new FEt,null===this._sharedLodIndexBuffer&&(this._sharedLodIndexBuffer=this._createSharedIndexBuffer());for(let t=0;t<this._blocks.length;++t)this._blocks[t].destroy();this._blocks=[];for(let t=0;t<this._blockCount[1];++t)for(let e=0;e<this._blockCount[0];++e)this._blocks.push(new xIt(this,e,t));for(let t=0;t<this._blocks.length;++t)this._blocks[t].build()}if(!this._lodEnable)for(let t=0;t<this._blocks.length;t++)this._blocks[t]._resetLod()}get LodBias(){return this._lodBias}set LodBias(t){this._lodBias=t}get size(){const t=new Vr(0,0);return t.width=this.blockCount[0]*Qbt*this.tileSize,t.height=this.blockCount[1]*Qbt*this.tileSize,t}get tileSize(){return this._tileSize}get tileCount(){return[this.blockCount[0]*Qbt,this.blockCount[1]*Qbt]}get vertexCount(){const t=this.tileCount;return t[0]+=1,t[1]+=1,t}get blockCount(){return this._blockCount}get lightMapSize(){return this._lightMapSize}get weightMapSize(){return this._weightMapSize}get heights(){return this._heights}get weights(){return this._weights}get valid(){return this._blocks.length>0}get info(){const t=new vIt;return t.tileSize=this.tileSize,t.blockCount[0]=this.blockCount[0],t.blockCount[1]=this.blockCount[1],t.weightMapSize=this.weightMapSize,t.lightMapSize=this.lightMapSize,t}build(t){return this._tileSize=t.tileSize,this._blockCount[0]=t.blockCount[0],this._blockCount[1]=t.blockCount[1],this._weightMapSize=t.weightMapSize,this._lightMapSize=t.lightMapSize,this._buildImp()}rebuild(t){for(let t=0;t<this._blocks.length;++t)this._blocks[t].destroy();this._blocks=[],this._resetLightmap(!1),this._rebuildLayerBuffer(t);const e=this._rebuildHeights(t);this._rebuildWeights(t),this._tileSize=t.tileSize,this._blockCount[0]=t.blockCount[0],this._blockCount[1]=t.blockCount[1],this._weightMapSize=t.weightMapSize,this._lightMapSize=t.lightMapSize,e&&(this._normals=new Float32Array(3*this.heights.length),this._buildNormals());for(let t=0;t<this._blockCount[1];++t)for(let e=0;e<this._blockCount[0];++e)this._blocks.push(new xIt(this,e,t));for(let t=0;t<this._blocks.length;++t)this._blocks[t].build()}importHeightField(t,e){let i=0;for(let s=0;s<this.vertexCount[1];++s)for(let r=0;r<this.vertexCount[0];++r){const n=r/this.tileCount[0],o=s/this.tileCount[1],a=t.getAt(n*t.w,o*t.h)*e;this._heights[i++]=a}this._buildNormals();for(let t=0;t<this._blocks.length;++t)this._blocks[t]._updateHeight()}exportHeightField(t,e){let i=0;for(let s=0;s<t.h;++s)for(let r=0;r<t.w;++r){const n=r/(t.w-1),o=s/(t.h-1),a=n*this.size.width,h=o*this.size.height,l=this.getHeightAt(a,h);null!=l&&(t.data[i++]=l*e)}}exportAsset(){const t=new yvt;t.tileSize=this.tileSize,t.blockCount=this.blockCount,t.lightMapSize=this.lightMapSize,t.weightMapSize=this.weightMapSize,t.heights=this.heights,t.weights=this.weights,t.layerBuffer=new Array(4*this._blocks.length);for(let e=0;e<this._blocks.length;++e)t.layerBuffer[4*e+0]=this._blocks[e].layers[0],t.layerBuffer[4*e+1]=this._blocks[e].layers[1],t.layerBuffer[4*e+2]=this._blocks[e].layers[2],t.layerBuffer[4*e+3]=this._blocks[e].layers[3];return this.exportLayerListToAsset(t),t}exportLayerListToAsset(t){t.layerInfos.length=0;for(let e=0;e<this._layerList.length;++e){const i=this._layerList[e];if(i&&i.detailMap&&Mo(i.detailMap)){const s=new gvt;s.slot=e,s.tileSize=i.tileSize,s.detailMap=i.detailMap,s.normalMap=i.normalMap,s.metallic=i.metallic,s.roughness=i.roughness,t.layerInfos.push(s)}}}getEffectAsset(){return null===this._effectAsset?h.EffectAsset.get("1d08ef62-a503-4ce2-8b9a-46c90873f7d3"):this._effectAsset}onEnable(){0===this._blocks.length&&this._buildImp();for(let t=0;t<this._blocks.length;++t)this._blocks[t].visible=!0;h.director.root.pipelineEvent.on("render-camera-begin",this.onUpdateFromCamera,this)}onDisable(){h.director.root.pipelineEvent.off("render-camera-begin",this.onUpdateFromCamera,this);for(let t=0;t<this._blocks.length;++t)this._blocks[t].visible=!1}onDestroy(){for(let t=0;t<this._blocks.length;++t)this._blocks[t].destroy();this._blocks=[];for(let t=0;t<this._layerList.length;++t)this._layerList[t]=null;null!=this._sharedIndexBuffer&&this._sharedIndexBuffer.destroy(),null!=this._sharedLodIndexBuffer&&this._sharedLodIndexBuffer.destroy()}onRestore(){this.onEnable(),this._buildImp(!0)}update(t){for(let t=0;t<this._blocks.length;++t)this._blocks[t].update()}onUpdateFromCamera(t){if(this.lodEnable&&null!=this._sharedLodIndexBuffer&&t.scene===this._getRenderScene()){for(let e=0;e<this._blocks.length;++e)this._blocks[e]._updateLevel(t.position);for(let t=0;t<this._blocks.length;++t)this._blocks[t]._updateLod()}}addLayer(t){for(let i=0;i<this._layerList.length;++i){var e;if(null===this._layerList[i]||this._layerList[i]&&null===(null==(e=this._layerList[i])?void 0:e.detailMap))return this._layerList[i]=t,this._asset&&this.exportLayerListToAsset(this._asset),i}return-1}setLayer(t,e){this._layerList[t]=e,this._asset&&this.exportLayerListToAsset(this._asset)}removeLayer(t){this._layerList[t]=null,this._asset&&this.exportLayerListToAsset(this._asset)}getLayer(t){return-1===t?null:this._layerList[t]}getPosition(t,e){const i=t*this._tileSize,s=e*this._tileSize;return Ps(i,this.getHeight(t,e),s)}getHeightField(){return this._heights}setHeight(t,e,i){i=Ri(i,rvt,nvt),this._heights[e*this.vertexCount[0]+t]=evt+i/ivt}getHeight(t,e){return(this._heights[e*this.vertexCount[0]+t]-evt)*ivt}getHeightClamp(t,e){return t=Ri(t,0,this.vertexCount[0]-1),e=Ri(e,0,this.vertexCount[1]-1),this.getHeight(t,e)}getHeightAt(t,e){const i=t/this.tileSize,s=e/this.tileSize;let r=Math.floor(i),n=Math.floor(s),o=r+1,a=n+1;const h=i-r,l=s-n;if(r<0||r>this.vertexCount[0]-1||n<0||n>this.vertexCount[1]-1)return null;r=Ri(r,0,this.vertexCount[0]-1),n=Ri(n,0,this.vertexCount[1]-1),o=Ri(o,0,this.vertexCount[0]-1),a=Ri(a,0,this.vertexCount[1]-1);let c=this.getHeight(r,n);const u=this.getHeight(o,n),d=this.getHeight(r,a);let _=this.getHeight(o,a);const p=.5*(u+d);return h+l<=1?_=p+(p-c):c=p+(p-_),(c*(1-h)+u*h)*(1-l)+(d*(1-h)+_*h)*l}_setNormal(t,e,i){const s=e*this.vertexCount[0]+t;this._normals[3*s+0]=i.x,this._normals[3*s+1]=i.y,this._normals[3*s+2]=i.z}getNormal(t,e){const i=e*this.vertexCount[0]+t,s=Ps();return s.x=this._normals[3*i+0],s.y=this._normals[3*i+1],s.z=this._normals[3*i+2],s}getNormalAt(t,e){const i=t/this.tileSize,s=e/this.tileSize;let r=Math.floor(i),n=Math.floor(s),o=r+1,a=n+1;const h=i-r,l=s-n;if(r<0||r>this.vertexCount[0]-1||n<0||n>this.vertexCount[1]-1)return null;r=Ri(r,0,this.vertexCount[0]-1),n=Ri(n,0,this.vertexCount[1]-1),o=Ri(o,0,this.vertexCount[0]-1),a=Ri(a,0,this.vertexCount[1]-1);const c=this.getNormal(r,n),u=this.getNormal(o,n),d=this.getNormal(r,a),_=this.getNormal(o,a),p=Ps();Ms.add(p,u,d).multiplyScalar(.5),h+l<=1?(_.set(p),_.subtract(c),_.add(p)):(c.set(p),c.subtract(_),c.add(p));const m=Ps(),g=Ps(),f=Ps();return Ms.lerp(m,c,u,h),Ms.lerp(g,d,_,h),Ms.lerp(f,m,g,l),f}setWeight(t,e,i){const s=e*this._weightMapSize*this._blockCount[0]+t;this._weights[4*s+0]=255*i.x,this._weights[4*s+1]=255*i.y,this._weights[4*s+2]=255*i.z,this._weights[4*s+3]=255*i.w}getWeight(t,e){const i=e*this._weightMapSize*this._blockCount[0]+t,s=new ms;return s.x=this._weights[4*i+0]/255,s.y=this._weights[4*i+1]/255,s.z=this._weights[4*i+2]/255,s.w=this._weights[4*i+3]/255,s}getWeightAt(t,e){const i=this.weightMapSize*this.blockCount[0],s=this.weightMapSize*this.blockCount[1];if(0===i||0===s)return null;const r=t/i,n=e/s;let o=Math.floor(r),a=Math.floor(n),h=o+1,l=a+1;const c=r-o,u=n-a;if(o<0||o>i-1||a<0||a>s-1)return null;o=Ri(o,0,i-1),a=Ri(a,0,s-1),h=Ri(h,0,i-1),l=Ri(l,0,s-1);let d=this.getWeight(o,a);const _=this.getWeight(h,a),p=this.getWeight(o,l);let m=this.getWeight(h,l);const g=new ms;ms.add(g,_,p).multiplyScalar(.5),c+u<=1?(m=new ms,ms.subtract(m,g,d).add(g)):(d=new ms,ms.subtract(d,g,m).add(g));const f=new ms,y=new ms,b=new ms;return ms.lerp(f,d,_,c),ms.lerp(y,p,m,c),ms.lerp(b,f,y,u),b}getMaxWeightLayerAt(t,e){const i=this.weightMapSize*this.blockCount[0],s=this.weightMapSize*this.blockCount[1];if(0===i||0===s)return null;const r=t/i,n=e/s,o=Math.floor(r),a=Math.floor(n);if(o<0||o>i-1||a<0||a>s-1)return null;const h=this.getWeight(o,a),l=Math.floor(t/this.weightMapSize),c=Math.floor(e/this.weightMapSize),u=this.getBlock(l,c);let d=0;return h.y>h[d]&&-1!==u.getLayer(1)&&(d=1),h.y>h[d]&&-1!==u.getLayer(2)&&(d=2),h.z>h[d]&&-1!==u.getLayer(3)&&(d=3),d=u.getLayer(d),this.getLayer(d)}getBlockLayers(t,e){const i=(e*this._blockCount[0]+t)*Kbt;return[this._layerBuffer[i],this._layerBuffer[i+1],this._layerBuffer[i+2],this._layerBuffer[i+3]]}getBlockLayer(t,e,i){const s=(e*this._blockCount[0]+t)*Kbt;return this._layerBuffer[s+i]}setBlockLayer(t,e,i,s){const r=(e*this._blockCount[0]+t)*Kbt;this._layerBuffer[r+i]=s}getBlock(t,e){return this._blocks[e*this._blockCount[0]+t]}getBlocks(){return this._blocks}rayCheck(t,e,i,s=!0){const r=t;s&&Ms.subtract(r,t,this.node.worldPosition);const n=Ps();n.set(e),n.multiplyScalar(i);let o=null;if(e.equals(Ps(0,1,0))){const t=this.getHeightAt(r.x,r.z);null!=t&&r.y<=t&&(o=Ps(r.x,t,r.z))}else if(e.equals(Ps(0,-1,0))){const t=this.getHeightAt(r.x,r.z);null!=t&&r.y>=t&&(o=Ps(r.x,t,r.z))}else{let t=0;for(;t++<2e3;){const t=this.getHeightAt(r.x,r.z);if(null!=t&&r.y<=t)break;r.add(e)}for(;t++<2e3;){const t=this.getHeightAt(r.x,r.z);if(null!=t&&r.y<=t){o=Ps(r.x,t,r.z);break}r.add(n)}}return o}_createSharedIndexBuffer(){const t=yp.gfxDevice;if(null!==this._lod){const e=t.createBuffer(new a_(6,1,2*this._lod._indexBuffer.length,2));return e.update(this._lod._indexBuffer),e}{const e=new Uint16Array(Qbt*Qbt*6);let i=0;for(let t=0;t<Qbt;++t)for(let s=0;s<Qbt;++s){const r=t*Jbt+s,n=t*Jbt+s+1,o=(t+1)*Jbt+s,a=(t+1)*Jbt+s+1;e[i++]=r,e[i++]=o,e[i++]=n,e[i++]=n,e[i++]=o,e[i++]=a}const s=t.createBuffer(new a_(6,1,2*e.length,2));return s.update(e),s}}_getSharedIndexBuffer(){return null!==this._sharedLodIndexBuffer?this._sharedLodIndexBuffer:null!==this._sharedIndexBuffer?this._sharedIndexBuffer:(this.lodEnable&&null===this._lod&&(this._lod=new FEt),null!==this._lod?(this._sharedLodIndexBuffer=this._createSharedIndexBuffer(),this._sharedLodIndexBuffer):(this._sharedIndexBuffer=this._createSharedIndexBuffer(),this._sharedIndexBuffer))}_getIndexData(t){return null!==this._sharedLodIndexBuffer&&null!==this._lod?this._lod.getIndexData(t):null}_resetLightmap(t){if(this._lightmapInfos.length=0,t)for(let t=0;t<this._blockCount[0]*this._blockCount[1];++t)this._lightmapInfos.push(new wIt)}_updateLightmap(t,e,i,s,r,n){if(e){if(0===this._lightmapInfos.length)for(let t=0;t<this._blockCount[0]*this._blockCount[1];++t)this._lightmapInfos.push(new wIt)}else if(0===this._lightmapInfos.length)return;this._lightmapInfos[t].texture=e,this._lightmapInfos[t].UOff=i,this._lightmapInfos[t].VOff=s,this._lightmapInfos[t].UScale=r,this._lightmapInfos[t].VScale=n,this._blocks[t]._updateLightmap(this._lightmapInfos[t])}_getLightmapInfo(t,e){const i=e*this._blockCount[0]+t;return i<this._lightmapInfos.length?this._lightmapInfos[i]:null}_calcNormal(t,e){let i=1;const s=this.getPosition(t,e);let r,n;t<this.vertexCount[0]-1?r=this.getPosition(t+1,e):(i*=-1,r=this.getPosition(t-1,e)),e<this.vertexCount[1]-1?n=this.getPosition(t,e+1):(i*=-1,n=this.getPosition(t,e-1)),r.subtract(s),n.subtract(s);const o=Ps();return o.set(n),o.cross(r),o.multiplyScalar(i),o.normalize(),o}_buildNormals(){let t=0;for(let e=0;e<this.vertexCount[1];++e)for(let i=0;i<this.vertexCount[0];++i){const s=this._calcNormal(i,e);this._normals[3*t+0]=s.x,this._normals[3*t+1]=s.y,this._normals[3*t+2]=s.z,t+=1}}_buildImp(t=!1){if(this.valid)return;const e=this.__asset;if(this._buitinAsset!==e&&(this._buitinAsset=e),!t&&null!==e){this._tileSize=e.tileSize,this._blockCount=e.blockCount,this._weightMapSize=e.weightMapSize,this._lightMapSize=e.lightMapSize,this._heights=e.heights,this._normals=e.normals,this._weights=e.weights,this._layerBuffer=e.layerBuffer;for(let t=0;t<this._layerList.length;++t)this._layerList[t]=null;if(e.version<cvt)for(let t=0;t<e.layerBinaryInfos.length;++t){const i=new SIt,s=e.layerBinaryInfos[t];i.tileSize=s.tileSize,h.assetManager.loadAny(s.detailMapId,((t,e)=>{i.detailMap=e})),""!==s.normalMapId&&h.assetManager.loadAny(s.normalMapId,((t,e)=>{i.normalMap=e})),i.roughness=s.roughness,i.metallic=s.metallic,this._layerList[s.slot]=i}else for(let t=0;t<e.layerInfos.length;++t){const i=new SIt,s=e.layerInfos[t];i.tileSize=s.tileSize,i.detailMap=s.detailMap,i.normalMap=s.normalMap,i.roughness=s.roughness,i.metallic=s.metallic,this._layerList[s.slot]=i}}if(0===this._blockCount[0]||0===this._blockCount[1])return;const i=this.vertexCount[0]*this.vertexCount[1];if(null===this._heights||this._heights.length!==i){this._heights=new Uint16Array(i),this._normals=new Float32Array(3*i);for(let t=0;t<i;++t)this._heights[t]=evt,this._normals[3*t+0]=0,this._normals[3*t+1]=1,this._normals[3*t+2]=0;e&&(e.heights=this._heights,e.normals=this._normals)}null!==this._normals&&this._normals.length===3*i||(this._normals=new Float32Array(3*i),this._buildNormals());const s=this.blockCount[0]*this.blockCount[1]*Kbt;if(null===this._layerBuffer||this._layerBuffer.length!==s){this._layerBuffer=new Array(s);for(let t=0;t<s;++t)this._layerBuffer[t]=-1;e&&(e.layerBuffer=this._layerBuffer)}const r=this._weightMapSize*this._blockCount[0],n=this._weightMapSize*this._blockCount[1];if(this._weights.length!==r*n*4){this._weights=new Uint8Array(r*n*4);for(let t=0;t<r*n;++t)this._weights[4*t+0]=255,this._weights[4*t+1]=0,this._weights[4*t+2]=0,this._weights[4*t+3]=0;e&&(e.weights=this._weights)}for(let t=0;t<this._blockCount[1];++t)for(let e=0;e<this._blockCount[0];++e)this._blocks.push(new xIt(this,e,t));for(let t=0;t<this._blocks.length;++t)this._blocks[t].build()}_rebuildHeights(t){if(this.vertexCount[0]===t.vertexCount[0]&&this.vertexCount[1]===t.vertexCount[1])return!1;const e=new Uint16Array(t.vertexCount[0]*t.vertexCount[1]);for(let t=0;t<e.length;++t)e[t]=evt;const i=Math.min(this.vertexCount[0],t.vertexCount[0]),s=Math.min(this.vertexCount[1],t.vertexCount[1]);for(let r=0;r<s;++r)for(let s=0;s<i;++s){const i=r*t.vertexCount[0]+s,n=r*this.vertexCount[0]+s;e[i]=this._heights[n]}return this._heights=e,!0}_rebuildLayerBuffer(t){if(this.blockCount[0]===t.blockCount[0]&&this.blockCount[1]===t.blockCount[1])return!1;const e=[];e.length=t.blockCount[0]*t.blockCount[1]*Kbt;for(let t=0;t<e.length;++t)e[t]=-1;const i=Math.min(this.blockCount[0],t.blockCount[0]),s=Math.min(this.blockCount[1],t.blockCount[1]);for(let r=0;r<s;++r)for(let s=0;s<i;++s){const i=r*t.blockCount[0]+s,n=r*this.blockCount[0]+s;for(let t=0;t<Kbt;++t)e[i*Kbt+t]=this._layerBuffer[n*Kbt+t]}return this._layerBuffer=e,!0}_rebuildWeights(t){const e=this._weightMapSize,i=this._weightMapSize*this._blockCount[0],s=this._weightMapSize*this._blockCount[1],r=t.weightMapSize*t.blockCount[0],n=t.weightMapSize*t.blockCount[1];if(r===i&&n===s)return!1;const o=new Uint8Array(r*n*4);for(let t=0;t<r*n;++t)o[4*t+0]=255,o[4*t+1]=0,o[4*t+2]=0,o[4*t+3]=0;const a=Math.min(t.blockCount[0],this._blockCount[0]),h=Math.min(t.blockCount[1],this._blockCount[1]),l=(t,e,s)=>{const r=e*i+t,n=new ms;return n.x=s[4*r+0]/255,n.y=s[4*r+1]/255,n.z=s[4*r+2]/255,n.w=s[4*r+3]/255,n},c=(t,i,s,r)=>{const n=Math.floor(t),o=Math.floor(i),a=Math.min(n+1,e-1),h=Math.min(o+1,e-1),c=t-n,u=i-o,d=l(n+s,o+r,this._weights),_=l(a+s,o+r,this._weights),p=l(n+s,h+r,this._weights),m=l(a+s,h+r,this._weights),g=new ms;ms.add(g,_,p).multiplyScalar(.5),c+u<=1?(m.set(g),m.subtract(d),m.add(g)):(d.set(g),d.subtract(m),d.add(g));const f=new ms,y=new ms,b=new ms;return ms.lerp(f,d,_,c),ms.lerp(y,p,m,c),ms.lerp(b,f,y,u),b};for(let i=0;i<h;++i)for(let s=0;s<a;++s){const n=s*e,a=i*e;for(let h=0;h<t.weightMapSize;++h)for(let u=0;u<t.weightMapSize;++u){let d;d=t.weightMapSize===e?l(u+n,h+a,this._weights):c(u/(t.weightMapSize-1)*(e-1),h/(t.weightMapSize-1)*(e-1),n,a,this._weights);const _=s*t.weightMapSize+u,p=(i*t.weightMapSize+h)*r+_;o[4*p+0]=255*d.x,o[4*p+1]=255*d.y,o[4*p+2]=255*d.z,o[4*p+3]=255*d.w}}return this._weights=o,!0}},dIt=Za(uIt.prototype,"__asset",[sIt,vh],(function(){return null})),_It=Za(uIt.prototype,"_effectAsset",[rIt,vh],(function(){return null})),pIt=Za(uIt.prototype,"_lightmapInfos",[nIt,vh],(function(){return[]})),mIt=Za(uIt.prototype,"_receiveShadow",[vh],(function(){return!1})),gIt=Za(uIt.prototype,"_useNormalmap",[vh],(function(){return!1})),fIt=Za(uIt.prototype,"_usePBR",[vh],(function(){return!1})),yIt=Za(uIt.prototype,"_lodEnable",[vh],(function(){return!1})),bIt=Za(uIt.prototype,"_lodBias",[oIt,vh],(function(){return 0})),s(uIt.prototype,"_asset",[aIt],Object.getOwnPropertyDescriptor(uIt.prototype,"_asset"),uIt.prototype),s(uIt.prototype,"effectAsset",[hIt],Object.getOwnPropertyDescriptor(uIt.prototype,"effectAsset"),uIt.prototype),s(uIt.prototype,"info",[lIt],Object.getOwnPropertyDescriptor(uIt.prototype,"info"),uIt.prototype),cIt=uIt))||cIt)||cIt));const CIt={ORTHO:0,HEX:1,ISO:2};fe(CIt);const AIt={NONE:0,MAP:1,LAYER:2,OBJECTGROUP:3,OBJECT:4,TILE:5};fe(AIt);const DIt={HORIZONTAL:2147483648,VERTICAL:1073741824,DIAGONAL:536870912,FLIPPED_ALL:4026531840,FLIPPED_MASK:268435455};fe(DIt);const EIt={STAGGERAXIS_X:0,STAGGERAXIS_Y:1};fe(EIt);const IIt={STAGGERINDEX_ODD:0,STAGGERINDEX_EVEN:1};fe(IIt);const MIt={RightDown:0,RightUp:1,LeftDown:2,LeftUp:3};fe(MIt);const PIt={RECT:0,ELLIPSE:1,POLYGON:2,POLYLINE:3,IMAGE:4,TEXT:5};fe(PIt);class OIt{constructor(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=void 0,this.imageName=null,this.imageOffset=null,this.imageSize=new Vr(0,0),this.tileOffset=new kr(0,0),this._tileSize=new Vr(0,0),this.collection=!1}rectForGID(t,e){const i=e||new Wr(0,0,0,0);i.width=this._tileSize.width,i.height=this._tileSize.height;let s=t;if(s&=268435455,s-=this.firstGid,this.imageOffset)i.x=this.imageOffset.x,i.y=this.imageOffset.y;else{const t=Math.floor((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing));i.x=Math.round(s%t*(this._tileSize.width+this.spacing)+this.margin),i.y=Math.round(Math.floor(s/t)*(this._tileSize.height+this.spacing)+this.margin)}return i}}class RIt{constructor(){this.properties={},this.name="",this.objects=[],this.visible=!0,this.opacity=0,this.color=new Ls(255,255,255,255),this.offset=new kr(0,0),this.draworder="topdown",this.tintColor=null}getProperties(){return this.properties}setProperties(t){this.properties=t}}class BIt{constructor(){this.properties={},this.name="",this.layerSize=null,this.tiles=[],this.visible=!0,this.opacity=0,this.ownTiles=!0,this.minGID=1e5,this.maxGID=0,this.offset=new kr(0,0),this.tintColor=null}getProperties(){return this.properties}setProperties(t){this.properties=t}}BIt.ATTRIB_NONE=1,BIt.ATTRIB_BASE64=2,BIt.ATTRIB_GZIP=4,BIt.ATTRIB_ZLIB=8;class FIt{constructor(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=new kr(0,0),this.opacity=0,this.trans=new Ls(255,255,255,255),this.sourceImage=void 0,this.tintColor=null}}function NIt(t){if(t.length%4!=0)return null;const e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[];for(let s=0;s<e;s++){const e=4*s;i[s]=t[e]+256*t[e+1]+65536*t[e+2]+t[e+3]*(1<<24)}return i}function LIt(t){const e=eP.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}function kIt(t){const e=eP.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}function zIt(t){if(!t)return new Ls(0,0,0,255);if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length){const e=parseInt(t.substr(0,2),16)||255,i=parseInt(t.substr(2,2),16)||0,s=parseInt(t.substr(4,2),16)||0,r=parseInt(t.substr(6,2),16)||0;return new Ls(i,s,r,e)}{const e=parseInt(t.substr(0,2),16)||0,i=parseInt(t.substr(2,2),16)||0,s=parseInt(t.substr(4,2),16)||0;return new Ls(e,i,s,255)}}function UIt(t,e){const i=[],s=Array.from(t.getElementsByTagName("properties")).filter((e=>e.parentNode===t));for(let t=0;t<s.length;++t){const e=s[t].getElementsByTagName("property");for(let t=0;t<e.length;++t)i.push(e[t])}e=e||{};for(let t=0;t<i.length;t++){const s=i[t],r=s.getAttribute("name"),n=s.getAttribute("type")||"string";let o=s.getAttribute("value");"int"===n?o=parseInt(o):"float"===n?o=parseFloat(o):"bool"===n?o="true"===o:"color"===n&&(o=zIt(o)),e[r]=o}return e}class VIt{get mapSize(){return this._mapSize}get tileSize(){return this._tileSize}constructor(t,e,i,s,r){this.properties={},this.orientation=null,this.parentElement=null,this.parentGID=0,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=0,this._supportVersion=[1,4,0],this._objectGroups=[],this._allChildren=[],this._mapSize=new Vr(0,0),this._tileSize=new Vr(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties=new Map,this._tileAnimations={},this._tsxContentMap=null,this._spriteFrameMap=null,this._spfSizeMap={},this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerSPF=null,this.initWithXML(t,e,i,s,r)}getOrientation(){return this.orientation}setOrientation(t){this.orientation=t}getStaggerAxis(){return this._staggerAxis}setStaggerAxis(t){this._staggerAxis=t}getStaggerIndex(){return this._staggerIndex}setStaggerIndex(t){this._staggerIndex=t}getHexSideLength(){return this._hexSideLength}setHexSideLength(t){this._hexSideLength=t}getMapSize(){return new Vr(this._mapSize.width,this._mapSize.height)}setMapSize(t){this._mapSize.width=t.width,this._mapSize.height=t.height}get mapWidth(){return this._mapSize.width}set mapWidth(t){this._mapSize.width=t}get mapHeight(){return this._mapSize.height}set mapHeight(t){this._mapSize.height=t}getTileSize(){return new Vr(this._tileSize.width,this._tileSize.height)}setTileSize(t){this._tileSize.width=t.width,this._tileSize.height=t.height}get tileWidth(){return this._tileSize.width}set tileWidth(t){this._tileSize.width=t}get tileHeight(){return this._tileSize.height}set tileHeight(t){this._tileSize.height=t}getLayers(){return this._layers}setLayers(t){this._allChildren.push(t),this._layers.push(t)}getImageLayers(){return this._imageLayers}setImageLayers(t){this._allChildren.push(t),this._imageLayers.push(t)}getTilesets(){return this._tilesets}setTilesets(t){this._tilesets.push(t)}getObjectGroups(){return this._objectGroups}setObjectGroups(t){this._allChildren.push(t),this._objectGroups.push(t)}getAllChildren(){return this._allChildren}getParentElement(){return this.parentElement}setParentElement(t){this.parentElement=t}getParentGID(){return this.parentGID}setParentGID(t){this.parentGID=t}getLayerAttribs(){return this.layerAttrs}setLayerAttribs(t){this.layerAttrs=t}getStoringCharacters(){return this.storingCharacters}setStoringCharacters(t){this.storingCharacters=t}getProperties(){return this.properties}setProperties(t){this.properties=t}initWithXML(t,e,i,s,r){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxContentMap=e,this._spriteFrameMap=i,this._imageLayerSPF=r,this._spfSizeMap=s,this._objectGroups.length=0,this._allChildren.length=0,this.properties={},this._tileProperties=new Map,this._tileAnimations=new Map,this.currentString="",this.storingCharacters=!1,this.layerAttrs=BIt.ATTRIB_NONE,this.parentElement=null,this.parseXMLString(t)}parseXMLString(t,e){let i;const s=(new Cx).parse(t).documentElement,r=s.getAttribute("orientation"),n=s.getAttribute("staggeraxis"),o=s.getAttribute("staggerindex"),a=s.getAttribute("hexsidelength"),h=s.getAttribute("renderorder"),l=s.getAttribute("version")||"1.0.0";if("map"===s.nodeName){const t=l.split("."),e=this._supportVersion;for(i=0;i<e.length;i++){const s=parseInt(t[i])||0;if(e[i]<s){k(7216,l);break}}"orthogonal"===r?this.orientation=0:"isometric"===r?this.orientation=2:"hexagonal"===r?this.orientation=1:null!==r&&k(7217,r),this.renderOrder="right-up"===h?1:"left-up"===h?3:"left-down"===h?2:0,"x"===n?this.setStaggerAxis(0):"y"===n&&this.setStaggerAxis(1),"odd"===o?this.setStaggerIndex(0):"even"===o&&this.setStaggerIndex(1),a&&this.setHexSideLength(parseFloat(a));let c=new Vr(0,0);c.width=parseFloat(s.getAttribute("width")),c.height=parseFloat(s.getAttribute("height")),this.setMapSize(c),c=new Vr(0,0),c.width=parseFloat(s.getAttribute("tilewidth")),c.height=parseFloat(s.getAttribute("tileheight")),this.setTileSize(c),this.properties=UIt(s)}let c=s.getElementsByTagName("tileset");for("map"!==s.nodeName&&(c=[],c.push(s)),i=0;i<c.length;i++){const t=c[i],s=t.getAttribute("source");if(s){const e=parseInt(t.getAttribute("firstgid")),i=this._tsxContentMap[s];i&&this.parseXMLString(i,e)}else{const i=t.getElementsByTagName("image"),s=i.length>1,r=i[0];let n=r.getAttribute("source");n=n.replace(/\\/g,"/");const o=t.getElementsByTagName("tile"),a=o&&o.length||1;let h=null;const l=t.getAttribute("name")||"",c=parseInt(t.getAttribute("spacing"))||0,u=parseInt(t.getAttribute("margin"))||0,d=e||parseInt(t.getAttribute("firstgid"))||0,_=new Vr(0,0);_.width=parseFloat(t.getAttribute("tilewidth")),_.height=parseFloat(t.getAttribute("tileheight"));const p=t.getElementsByTagName("tileoffset")[0];let m=0,g=0;p&&(m=parseFloat(p.getAttribute("x"))||0,g=parseFloat(p.getAttribute("y"))||0);let f=null;for(let t=0;t<a;t++){const e=i[t]?i[t]:r;if(!e)continue;let n=e.getAttribute("source");if(n=n.replace(/\\/g,"/"),!f||s){if(f=new OIt,f.name=l,f.firstGid=268435455&d,f.tileOffset.x=m,f.tileOffset.y=g,f.collection=s,!s&&(f.imageName=n,f.imageSize.width=parseFloat(e.getAttribute("width"))||0,f.imageSize.height=parseFloat(e.getAttribute("height"))||0,f.sourceImage=this._spriteFrameMap[n],!f.sourceImage)){const t=VIt.getNameWithPostfix(n);if(f.imageName=t,f.sourceImage=this._spriteFrameMap[t],!f.sourceImage){const t=VIt.getShortName(n);f.imageName=t,f.sourceImage=this._spriteFrameMap[t],f.sourceImage||(P(`[error]: ${t} not find in [${Object.keys(this._spriteFrameMap).join(", ")}]`),G(7221,n),M(`Please try asset type of ${n} to 'sprite-frame'`))}}f.spacing=c,f.margin=u,f._tileSize.width=_.width,f._tileSize.height=_.height,this.setTilesets(f)}if(h=o&&o[t],!h)continue;this.parentGID=d+(parseInt(h.getAttribute("id"))||0);const a=h.getElementsByTagName("image");h.hasAttribute("x")&&h.hasAttribute("y")&&(f.imageOffset=new kr(parseFloat(h.getAttribute("x"))||0,parseFloat(h.getAttribute("y"))||0));const p=h.hasAttribute("width")&&h.hasAttribute("height");if(p&&(f._tileSize.width=parseFloat(h.getAttribute("width"))||0,f._tileSize.height=parseFloat(h.getAttribute("height"))||0),a&&a.length>0){const t=a[0];let e=t.getAttribute("source");if(e=e.replace(/\\/g,"/"),f.imageName=e,f.imageSize.width=parseFloat(t.getAttribute("width"))||0,f.imageSize.height=parseFloat(t.getAttribute("height"))||0,p||(f._tileSize.width=f.imageSize.width,f._tileSize.height=f.imageSize.height),f.sourceImage=this._spriteFrameMap[e],!f.sourceImage){const t=VIt.getNameWithPostfix(e);if(f.imageName=t,f.sourceImage=this._spriteFrameMap[t],!f.sourceImage){const t=VIt.getShortName(e);f.imageName=t,f.sourceImage=this._spriteFrameMap[t],f.sourceImage||(G(7221,e),M(`Please try asset type of ${e} to 'sprite-frame'`))}}f.firstGid=268435455&this.parentGID}const y=(268435455&this.parentGID)>>>0;this._tileProperties.set(y,UIt(h));const b=h.getElementsByTagName("animation");if(b&&b.length>0){const t=b[0].getElementsByTagName("frame"),e={frames:[],dt:0,frameIdx:0};this._tileAnimations.set(y,e);const i=e.frames;for(let e=0;e<t.length;e++){const s=t[e],r=d+(parseInt(s.getAttribute("tileid"))||0),n=parseFloat(s.getAttribute("duration"))||0;i.push({tileid:r,duration:n/1e3,grid:null})}}}}}const u=s.childNodes;for(i=0;i<u.length;i++){const t=u[i];if(!this._shouldIgnoreNode(t)){if("imagelayer"===t.nodeName){const e=this._parseImageLayer(t);e&&this.setImageLayers(e)}if("layer"===t.nodeName){const e=this._parseLayer(t);this.setLayers(e)}if("objectgroup"===t.nodeName){const e=this._parseObjectGroup(t);this.setObjectGroups(e)}}}return s}_shouldIgnoreNode(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType}_parseImageLayer(t){const e=t.getElementsByTagName("image");if(!e||0===e.length)return null;const i=new FIt;i.name=t.getAttribute("name"),i.offset.x=parseFloat(t.getAttribute("offsetx"))||0,i.offset.y=parseFloat(t.getAttribute("offsety"))||0;const s=t.getAttribute("visible");i.visible=!("0"===s);const r=t.getAttribute("opacity");i.opacity=r?Math.round(255*parseFloat(r)):255;const n=t.getAttribute("tintcolor");i.tintColor=n?zIt(n):null;const o=e[0],a=o.getAttribute("source");return i.sourceImage=this._imageLayerSPF[a],i.width=parseInt(o.getAttribute("width"))||0,i.height=parseInt(o.getAttribute("height"))||0,i.trans=zIt(o.getAttribute("trans")),i.sourceImage?i:(G(7221,a),M(`Please try asset type of ${a} to 'sprite-frame'`),null)}_parseLayer(t){const e=t.getElementsByTagName("data")[0],i=new BIt;i.name=t.getAttribute("name");const s=new Vr(0,0);s.width=parseFloat(t.getAttribute("width")),s.height=parseFloat(t.getAttribute("height")),i.layerSize=s;const r=t.getAttribute("visible");i.visible=!("0"===r);const n=t.getAttribute("opacity");i.opacity=n?Math.round(255*parseFloat(n)):255,i.offset=new kr(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);const o=t.getAttribute("tintcolor");i.tintColor=o?zIt(o):null;let a="";for(let t=0;t<e.childNodes.length;t++)a+=e.childNodes[t].nodeValue;a=a.trim();const h=e.getAttribute("compression"),l=e.getAttribute("encoding");if(h&&"gzip"!==h&&"zlib"!==h)return k(7218),null;let c;switch(h){case"gzip":c=Wut.unzipBase64AsArray(a,4);break;case"zlib":c=NIt(new zct.Inflate(Wut.Base64.decodeAsArray(a,1)).decompress());break;case null:case"":if("base64"===l)c=Wut.Base64.decodeAsArray(a,4);else if("csv"===l){c=[];const t=a.split(",");for(let e=0;e<t.length;e++)c.push(parseInt(t[e]))}else{const t=e.getElementsByTagName("tile");c=[];for(let e=0;e<t.length;e++)c.push(parseInt(t[e].getAttribute("gid")))}break;default:this.layerAttrs===BIt.ATTRIB_NONE&&k(7219)}return c&&(i.tiles=new Uint32Array(c)),i.properties=UIt(t),i}_parseObjectGroup(t){const e=new RIt;e.name=t.getAttribute("name")||"",e.offset=new kr(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));const i=t.getAttribute("opacity");e.opacity=i?Math.round(255*parseFloat(i)):255;const s=t.getAttribute("tintcolor");e.tintColor=s?zIt(s):null;const r=t.getAttribute("visible");r&&0===parseInt(r)&&(e.visible=!1);const n=t.getAttribute("color");n&&e.color.fromHEX(n);const o=t.getAttribute("draworder");o&&(e.draworder=o),e.setProperties(UIt(t));const a=t.getElementsByTagName("object");if(a){for(let t=0;t<a.length;t++){const i=a[t],s={};s.id=i.getAttribute("id")||t,s.name=i.getAttribute("name")||"",s.width=parseFloat(i.getAttribute("width"))||0,s.height=parseFloat(i.getAttribute("height"))||0,s.x=parseFloat(i.getAttribute("x"))||0,s.y=parseFloat(i.getAttribute("y"))||0,s.rotation=parseFloat(i.getAttribute("rotation"))||0,s.properties=UIt(i);const r=i.getAttribute("visible");s.visible=!(r&&0===parseInt(r));const n=i.getElementsByTagName("text");if(n&&n.length>0){const t=n[0];s.type=5,s.wrap="1"===t.getAttribute("wrap"),s.color=zIt(t.getAttribute("color")),s.halign=LIt(t.getAttribute("halign")),s.valign=kIt(t.getAttribute("valign")),s.pixelsize=parseInt(t.getAttribute("pixelsize"))||16,s.text=t.childNodes[0].nodeValue}const o=i.getAttribute("gid");o&&(s.gid=parseInt(o),s.type=4);const h=i.getElementsByTagName("ellipse");h&&h.length>0&&(s.type=1);const l=i.getElementsByTagName("polygon");if(l&&l.length>0){s.type=2;const t=l[0].getAttribute("points");t&&(s.points=this._parsePointsString(t))}const c=i.getElementsByTagName("polyline");if(c&&c.length>0){s.type=3;const t=c[0].getAttribute("points");t&&(s.polylinePoints=this._parsePointsString(t))}s.type||(s.type=0),e.objects.push(s)}"index"!==o&&e.objects.sort(((t,e)=>t.y-e.y))}return e}_parsePointsString(t){if(!t)return null;const e=[],i=t.split(" ");for(let t=0;t<i.length;t++){const s=i[t].split(",");e.push({x:parseFloat(s[0]),y:parseFloat(s[1])})}return e}setTileAnimations(t){this._tileAnimations=t}getTileAnimations(){return this._tileAnimations}getTileProperties(){return this._tileProperties}setTileProperties(t){this._tileProperties=t}getCurrentString(){return this.currentString}setCurrentString(t){this.currentString=t}static getNameWithPostfix(t){const e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,i=t.length;return t.substring(e,i)}static getShortName(t){const e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1;let i=t.lastIndexOf(".");return i=i<0?t.length:i,t.substring(e,i)}}var jIt,HIt,GIt,WIt,XIt,YIt,qIt,$It,KIt,ZIt,QIt;let JIt=t("TiledTile",(jIt=ah("cc.TiledTile"),HIt=hh(RI),GIt=Xh(Ge),WIt=Xh(Ge),XIt=Xh(Ge),YIt=Xh(Ge),qIt=Xh(Ge),jIt($It=HIt((KIt=class extends Km{constructor(){super(),this._layer=null,this._x=ZIt&&ZIt(),this._y=QIt&&QIt()}get x(){return this._x}set x(t){t!==this._x&&(this._layer&&this._layer.isInvalidPosition(t,this._y)?M("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.width):(this._resetTile(),this._x=t,this.updateInfo()))}get y(){return this._y}set y(t){t!==this._y&&(this._layer&&this._layer.isInvalidPosition(this._x,t)?M("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.height):(this._resetTile(),this._y=t,this.updateInfo()))}get grid(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0}set grid(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)}onEnable(){const t=this.node.parent;this._layer=t.getComponent("cc.TiledLayer"),this.node.on("transform-changed",this._updatePosition,this),this.node.on("size-changed",this._updatePosition,this),this._resetTile(),this.updateInfo()}onDisable(){this._resetTile(),this.node.off("transform-changed",this._updatePosition,this),this.node.off("size-changed",this._updatePosition,this)}_resetTile(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)}updateInfo(){if(!this._layer)return;const t=this._x,e=this._y;if(this._layer.getTiledTileAt(t,e))return void M("There is already a TiledTile at [%s, %s]",t,e);const i=this._layer.getPositionAt(t,e);this.node.setPosition(i.x,i.y),this._layer.setTiledTileAt(t,e,this),this._layer._markForUpdateRenderData()}_updatePosition(){this._layer._markForUpdateRenderData()}},ZIt=Za(KIt.prototype,"_x",[GIt],(function(){return 0})),QIt=Za(KIt.prototype,"_y",[WIt],(function(){return 0})),s(KIt.prototype,"x",[XIt],Object.getOwnPropertyDescriptor(KIt.prototype,"x"),KIt.prototype),s(KIt.prototype,"y",[YIt],Object.getOwnPropertyDescriptor(KIt.prototype,"y"),KIt.prototype),s(KIt.prototype,"grid",[qIt],Object.getOwnPropertyDescriptor(KIt.prototype,"grid"),KIt.prototype),$It=KIt))||$It)||$It)),tMt=!1;function eMt(t){tMt=t}function iMt(t,e,i){const s=i||t.sourceImage,r=s.texture,n=t.collection;if(!t.imageSize.width||!t.imageSize.height){const e=t.sourceImage;t.imageSize.width=e.width,t.imageSize.height=e.height}const o=t.imageSize.width,a=t.imageSize.height,h=t._tileSize.width,l=t._tileSize.height,c=s.width,u=s.height,d=t.spacing,_=t.margin;let p=1;if(!n){const t=Math.floor((o-2*_+d)/(h+d)),e=Math.floor((a-2*_+d)/(l+d));p=Math.max(1,e*t)}const m=t.firstGid;let g=null,f=!!e.get(m);const y=t.firstGid+p;let b=m;for(;b<y&&(f&&!e.get(b)&&(f=!1),f||!e.get(b));++b){if(g={tileset:t,x:0,y:0,width:h,height:l,t:0,l:0,r:0,b:0,cx:0,cy:0,offsetX:0,offsetY:0,rotated:!1,gid:b,spriteFrame:s,texture:r},t.rectForGID(b,g),!i||p>1||t.imageOffset)if(i){g._name=i.name;const t=i.unbiasUV[0],e=i.rotated?i.unbiasUV[1]:i.unbiasUV[5];tMt?(g.l=t+(g.x+.5)/c,g.t=e+(g.y+.5)/u,g.r=t+(g.x+g.width-.5)/c,g.b=e+(g.y+g.height-.5)/u):(g.l=t+g.x/c,g.t=e+g.y/u,g.r=t+(g.x+g.width)/c,g.b=e+(g.y+g.height)/u),g._rect=new Wr(g.x,g.y,g.width,g.height)}else g.l=g.x/c,g.t=g.y/u,g.r=(g.x+g.width)/c,g.b=(g.y+g.height)/u,g._rect=new Wr(g.x,g.y,g.width,g.height);else i.rotated?(g._rotated=!0,g._name=i.name,g._rect=i.getRect(),g.l=i.unbiasUV[0],g.t=i.unbiasUV[1],g.r=i.unbiasUV[4],g.b=i.unbiasUV[3]):(g._name=i.name,g._rect=i.getRect(),g.l=i.unbiasUV[0],g.t=i.unbiasUV[5],g.r=i.unbiasUV[2],g.b=i.unbiasUV[1]);g.cx=(g.l+g.r)/2,g.cy=(g.t+g.b)/2,e.set(b,g)}}var sMt,rMt;const nMt=new vr,oMt=new kr,aMt=new Ms,hMt=new Ms,lMt={row:0,col:0};function cMt(t){return"subNodes"in t}let uMt=t("TiledUserNodeData",ah("cc.TiledUserNodeData")(sMt=class extends Km{constructor(){super(),this._index=-1,this._row=-1,this._col=-1,this._tiledLayer=null}})||sMt),dMt=t("TiledLayer",ah("cc.TiledLayer")(rMt=class t extends uM{get cullingRect(){return this._cullingRect}get rightTop(){return this._rightTop}get layerSize(){return this._layerSize}get tiledDataArray(){return this._tiledDataArray}get leftDownToCenterX(){return this._leftDownToCenterX}get leftDownToCenterY(){return this._leftDownToCenterY}requestDrawInfo(t){return this._drawInfoList[t]||(this._drawInfoList[t]=new mI,this._drawInfoList[t].setDrawInfoType(2)),this._drawInfoList[t]}constructor(){super(),this._userNodeGrid={},this._userNodeMap={},this._userNodeDirty=!1,this.tiledTiles=[],this._viewPort={x:-1,y:-1,width:-1,height:-1},this._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},this._cullingDirty=!0,this._rightTop={row:-1,col:-1},this._layerInfo=null,this._mapInfo=null,this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this.tiles=[],this.vertices=[],this._verticesDirty=!0,this._layerName="",this._layerSize=void 0,this._minGID=void 0,this._maxGID=void 0,this._layerOrientation=null,this._opacity=void 0,this._tintColor=void 0,this.texGrids=null,this._textures=[],this._tilesets=[],this._leftDownToCenterX=0,this._leftDownToCenterY=0,this._hasTiledNodeGrid=!1,this._hasAniGrid=!1,this._animations=null,this._enableCulling=void 0,this.colorChanged=!1,this._properties=void 0,this.renderOrder=void 0,this._staggerAxis=void 0,this._staggerIndex=void 0,this._hexSideLength=void 0,this._mapTileSize=void 0,this._odd_even=void 0,this._diffX1=void 0,this._diffY1=void 0,this._useAutomaticVertexZ=void 0,this._vertexZvalue=void 0,this._offset=void 0,this._tiledDataArray=[],this._cameraNode=void 0,this._drawInfoList=[],this._tiledDataArrayIdx=0}hasTiledNode(){return this._hasTiledNodeGrid}hasAnimation(){return this._hasAniGrid}set enableCulling(t){this._enableCulling!==t&&(this._enableCulling=t,this._cullingDirty=!0,this._markForUpdateRenderData())}get enableCulling(){return this._enableCulling}addUserNode(t){let e=t.getComponent(uMt);return e?(j(7242),!1):(e=t.addComponent(uMt),t.parent=this.node,this._userNodeMap[t.uuid]=e,e._row=-1,e._col=-1,e._tiledLayer=this,this._nodeLocalPosToLayerPos(t.getPosition(),oMt),this._positionToRowCol(oMt.x,oMt.y,lMt),this._addUserNodeToGrid(e,lMt),this._updateCullingOffsetByUserNode(t),t.on("transform-changed",this._userNodePosChange,e),t.on("size-changed",this._userNodeSizeChange,e),!0)}removeUserNode(t){const e=t.getComponent(uMt);return e?(t.off("transform-changed",this._userNodePosChange,e),t.off("size-changed",this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t.uuid],t._removeComponent(e),e.destroy(),t.removeFromParent(),!0):(j(7243),!1)}destroyUserNode(t){this.removeUserNode(t),t.destroy()}_nodeLocalPosToLayerPos(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY}getNodesByRowCol(t,e){const i=this._userNodeGrid[t];return i?i[e]:null}getNodesCountByRow(t){const e=this._userNodeGrid[t];return e?e.count:0}_updateAllUserNode(){this._userNodeGrid={};for(const t in this._userNodeMap){const e=this._userNodeMap[t];this._nodeLocalPosToLayerPos(e.node.getPosition(),oMt),this._positionToRowCol(oMt.x,oMt.y,lMt),this._addUserNodeToGrid(e,lMt),this._updateCullingOffsetByUserNode(e.node)}}_updateCullingOffsetByUserNode(t){const e=t._getUITransformComp().contentSize;this._topOffset<e.height&&(this._topOffset=e.height),this._downOffset<e.height&&(this._downOffset=e.height),this._leftOffset<e.width&&(this._leftOffset=e.width),this._rightOffset<e.width&&(this._rightOffset=e.width)}_userNodeSizeChange(){const t=this.node,e=this._tiledLayer;e._updateCullingOffsetByUserNode(t),e._userNodeDirty=!0,e._markForUpdateRenderData()}_userNodePosChange(){const t=this,e=t.node,i=t._tiledLayer;i._nodeLocalPosToLayerPos(e.getPosition(),oMt),i._positionToRowCol(oMt.x,oMt.y,lMt),i._limitInLayer(lMt),lMt.row===t._row&&lMt.col===t._col||(i._removeUserNodeFromGrid(t),i._addUserNodeToGrid(t,lMt))}_removeUserNodeFromGrid(t){const e=t._row,i=t._col,s=t._index,r=this._userNodeGrid[e],n=r&&r[i];n&&(r.count--,n.count--,n.list[s]=null,n.count<=0&&(n.list.length=0,n.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0,this._markForUpdateRenderData()}_limitInLayer(t){const e=t.row,i=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),i<0&&(t.col=0),i>this._rightTop.col&&(t.col=this._rightTop.col)}_addUserNodeToGrid(t,e){const i=e.row,s=e.col,r=this._userNodeGrid[i]=this._userNodeGrid[i]||{count:0},n=r[s]=r[s]||{count:0,list:[]};t._row=i,t._col=s,t._index=n.list.length,r.count++,n.count++,n.list.push(t),this._userNodeDirty=!0,this._markForUpdateRenderData()}isUserNodeDirty(){return this._userNodeDirty}setUserNodeDirty(t){this._userNodeDirty=t}_reinstallCamera(){const t=nC.root.batcher2D.getFirstRenderCamera(this.node),e=null==t?void 0:t.node;return this._cameraNode!==e&&(this._uninstallCamera(),e&&(e.on("transform-changed",this.updateCulling,this),e.on("size-changed",this.updateCulling,this),this._cameraNode=e)),t}_uninstallCamera(){this._cameraNode&&(this._cameraNode.off("transform-changed",this.updateCulling,this),this._cameraNode.off("size-changed",this.updateCulling,this),delete this._cameraNode)}onEnable(){super.onEnable(),this.node.on("anchor-changed",this._syncAnchorPoint,this),this.node.on("transform-changed",this.updateCulling,this),this.node.on("size-changed",this.updateCulling,this),this.node.parent.on("transform-changed",this.updateCulling,this),this.node.parent.on("size-changed",this.updateCulling,this),jA.instance.on("canvas-resize",this._resize,this),pa.on("window-resize",this._resize,this),this._markForUpdateRenderData(),this.scheduleOnce(this.updateCulling.bind(this))}onDisable(){var t,e;super.onDisable(),null==(t=this.node.parent)||t.off("size-changed",this.updateCulling,this),null==(e=this.node.parent)||e.off("transform-changed",this.updateCulling,this),this.node.off("size-changed",this.updateCulling,this),this.node.off("transform-changed",this.updateCulling,this),this.node.off("anchor-changed",this._syncAnchorPoint,this),jA.instance.off("canvas-resize",this._resize,this),pa.off("window-resize",this._resize,this),this._uninstallCamera()}_syncAnchorPoint(){const t=this.node,e=t._getUITransformComp(),i=t.getScale();this._leftDownToCenterX=e.width*e.anchorX*i.x,this._leftDownToCenterY=e.height*e.anchorY*i.y,this._cullingDirty=!0,this._markForUpdateRenderData()}_resize(){this._markForUpdateRenderData()}getLayerName(){return this._layerName}setLayerName(t){this._layerName=t}getProperty(t){return this._properties[t]}getPositionAt(t,e){let i;switch(void 0!==e?(i=Math.floor(t),e=Math.floor(e)):(i=Math.floor(t.x),e=Math.floor(t.y)),this._layerOrientation){case 0:return this._positionForOrthoAt(i,e);case 2:return this._positionForIsoAt(i,e);case 1:return this._positionForHexAt(i,e)}return null}isInvalidPosition(t,e){return t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0}_positionForIsoAt(t,e){let i=0,s=0;const r=Math.floor(t)+Math.floor(e)*this._layerSize.width,n=this.tiles[r];if(n){const t=(268435455&n)>>>0,e=this.texGrids.get(t).tileset.tileOffset;i=e.x,s=e.y}return new kr(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+i,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-s)}_positionForOrthoAt(t,e){let i=0,s=0;const r=Math.floor(t)+Math.floor(e)*this._layerSize.width,n=this.tiles[r];if(n){const t=(268435455&n)>>>0,e=this.texGrids.get(t).tileset.tileOffset;i=e.x,s=e.y}return new kr(t*this._mapTileSize.width+i,(this._layerSize.height-e-1)*this._mapTileSize.height-s)}_positionForHexAt(t,e){const i=this._mapTileSize.width,s=this._mapTileSize.height,r=this._layerSize.height,n=Math.floor(t)+Math.floor(e)*this._layerSize.width,o=(268435455&this.tiles[n])>>>0;let a;a=this.texGrids.get(o)?this.texGrids.get(o).tileset.tileOffset:{x:0,y:0};const h=0===this._staggerIndex?1:-1;let l=0,c=0,u=0,d=0;switch(this._staggerAxis){case 1:u=0,e%2==1&&(u=i/2*h),l=t*i+u+a.x,c=(r-e-1)*(s-(s-this._hexSideLength)/2)-a.y;break;case 0:d=0,t%2==1&&(d=s/2*-h),l=t*(i-(i-this._hexSideLength)/2)+a.x,c=(r-e-1)*s+d-a.y}return new kr(l,c)}setTilesGIDAt(t,e,i,s){if(!t||0===t.length||s<=0)return;i<0&&(i=0),e<0&&(e=0);let r=0;const n=e+s;for(let s=i;;s++)for(let i=e;i<n;i++){if(r>=t.length)return;this._updateTileForGID(t[r],i,s),r++}}setTileGIDAt(t,e,i,s){const r=(268435455&t)>>>0;if(e=Math.floor(e),i=Math.floor(i),this.isInvalidPosition(e,i))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this.tiles&&this._tilesets&&0!==this._tilesets.length?0!==r&&r<this._tilesets[0].firstGid?k(7239,t):(s=s||0,this._updateTileForGID((r|s)>>>0,e,i)):k(7238)}_updateTileForGID(t,e,i){const s=0|e+i*this._layerSize.width;if(s>=this.tiles.length)return;if(t===this.tiles[s])return;const r=(268435455&t)>>>0;this.texGrids.get(r)?(this.tiles[s]=t,this._updateVertex(e,i)):this.tiles[s]=0,this._cullingDirty=!0}getTileGIDAt(t,e){if(this.isInvalidPosition(t,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this.tiles)return k(7237),null;const i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(268435455&this.tiles[i])>>>0}getTileFlagsAt(t,e){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this.tiles)return k(7240),null;const i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(4026531840&this.tiles[i])>>>0}setCullingDirty(t){this._cullingDirty=t}isCullingDirty(){return this._cullingDirty}updateViewPort(t,e,i,s){if(this._viewPort.width===i&&this._viewPort.height===s&&this._viewPort.x===t&&this._viewPort.y===e)return;this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=s;let r=1;2===this._layerOrientation&&(r=2);const n=this._viewPort.x-this._offset.x+this._leftDownToCenterX,o=this._viewPort.y-this._offset.y+this._leftDownToCenterY;let a=n-this._leftOffset,h=o-this._downOffset;const l=n+i+this._rightOffset,c=o+s+this._topOffset,u=this._cullingRect.leftDown,d=this._cullingRect.rightTop;a<0&&(a=0),h<0&&(h=0),this._positionToRowCol(a,h,lMt),lMt.row-=r,lMt.col-=r,lMt.row=lMt.row>0?lMt.row:0,lMt.col=lMt.col>0?lMt.col:0,lMt.row===u.row&&lMt.col===u.col||(u.row=lMt.row,u.col=lMt.col,this._cullingDirty=!0),l<0||c<0?(lMt.row=-1,lMt.col=-1):(this._positionToRowCol(l,c,lMt),lMt.row++,lMt.col++),lMt.row===d.row&&lMt.col===d.col||(d.row=lMt.row,d.col=lMt.col,this._cullingDirty=!0),this._cullingDirty&&this._markForUpdateRenderData()}_positionToRowCol(t,e,i){const s=this._mapTileSize.width,r=this._mapTileSize.height,n=.5*s,o=.5*r;let a=0,h=0,l=0,c=0;const u=this._staggerAxis;switch(this._layerOrientation){case 0:h=Math.floor(t/s),a=Math.floor(e/r);break;case 2:h=Math.floor(t/n),a=Math.floor(e/o);break;case 1:1===u?(a=Math.floor(e/(r-this._diffY1)),l=a%2==1?n*this._odd_even:0,h=Math.floor((t-l)/s)):(h=Math.floor(t/(s-this._diffX1)),c=h%2==1?o*-this._odd_even:0,a=Math.floor((e-c)/r))}return i.row=a,i.col=h,i}updateCulling(){if(this._enableCulling){this.node.updateWorldTransform(),vr.invert(nMt,this.node.getWorldMatrix());const t=this._reinstallCamera();t&&(aMt.x=0,aMt.y=0,aMt.z=0,hMt.x=t.width,hMt.y=t.height,hMt.z=0,t.screenToWorld(aMt,aMt),t.screenToWorld(hMt,hMt),Ms.transformMat4(aMt,aMt,nMt),Ms.transformMat4(hMt,hMt,nMt),this.updateViewPort(aMt.x,aMt.y,hMt.x-aMt.x,hMt.y-aMt.y))}}getLayerOrientation(){return this._layerOrientation}getProperties(){return this._properties}_updateVertex(t,e){const i=this.vertices,s=this._layerOrientation,r=this.tiles;if(!r)return;const n=this._rightTop,o=this._mapTileSize.width,a=this._mapTileSize.height,h=.5*o,l=.5*a,c=this._layerSize.height,u=this._layerSize.width,d=this.texGrids;let _,p,m,g,f,y,b=0,v=0;1===s&&(_=this._staggerAxis,p=this._diffX1,m=this._diffY1,g=this._odd_even);let S=0,T=0,w=0,x=0,C=0,A=0,D=0;const E=e*u+t;w=(268435455&r[E])>>>0;const I=d.get(w);if(!I)return;switch(this._animations.get(w)&&(this._hasAniGrid=this._hasAniGrid||!0),s){case 0:S=t,T=c-e-1,b=S*o,v=T*a;break;case 2:S=c+t-e-1,T=c+u-t-e-2,b=h*S,v=l*T;break;case 1:f=1===_&&e%2==1?h*g:0,y=0===_&&t%2==1?l*-g:0,b=t*(o-p)+f,v=(c-e-1)*(a-m)+y,S=t,T=c-e-1}const M=i[T]=i[T]||{minCol:0,maxCol:0},P=M[S]=M[S]||{left:0,bottom:0,index:0};M.minCol>S&&(M.minCol=S),M.maxCol<S&&(M.maxCol=S),n.row<T&&(n.row=T,2===s&&(n.row+=1)),n.col<S&&(n.col=S,2===s&&(n.col+=1));const O=I.tileset.tileOffset;b+=this._offset.x+O.x+I.offsetX,v+=this._offset.y-O.y-I.offsetY,x=-O.y+I.tileset._tileSize.height-a,x=x<0?0:x,C=O.y<0?0:O.y,A=-O.x<0?0:-O.x,D=O.x+I.tileset._tileSize.width-o,D=D<0?0:D,this._rightOffset<A&&(this._rightOffset=A),this._leftOffset<D&&(this._leftOffset=D),this._topOffset<C&&(this._topOffset=C),this._downOffset<x&&(this._downOffset=x),P.left=b,P.bottom=v,P.index=E,this._cullingDirty=!0}_updateVertices(){if(this.vertices.length=0,!this.tiles)return;const t=this._rightTop;t.row=-1,t.col=-1;const e=this._layerSize.height,i=this._layerSize.width;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;for(let t=0;t<e;++t)for(let e=0;e<i;++e)this._updateVertex(e,t);this._verticesDirty=!1}getTiledTileAt(t,e,i){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this.tiles)return k(7236),null;const s=Math.floor(t)+Math.floor(e)*this._layerSize.width;let r=this.tiledTiles[s];if(!r&&i){const i=new tb;return r=i.addComponent(JIt),r._x=t,r._y=e,r._layer=this,r.updateInfo(),i.parent=this.node,r}return r}setTiledTileAt(t,e,i){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this.tiles)return k(7236),null;const s=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this.tiledTiles[s]=i,this._cullingDirty=!0,this._hasTiledNodeGrid=!!i||this.tiledTiles.some((t=>!!t)),i}getTexture(t){return t=t||0,this._textures&&t>=0&&this._textures.length>t?this._textures[t]:null}getTextures(){return this._textures}setTexture(t){this.setTextures([t])}setTextures(t){this._textures=t,this._markForUpdateRenderData()}getLayerSize(){return this._layerSize}getMapTileSize(){return this._mapTileSize}getTileSet(t){return t=t||0,this._tilesets&&t>=0&&this._tilesets.length>t?this._tilesets[t]:null}getTileSets(){return this._tilesets}setTileSet(t){this.setTileSets([t])}setTileSets(t){this._tilesets=t;const e=this._textures=[],i=this.texGrids;i.clear();for(let i=0;i<t.length;i++){const s=t[i];s&&(e[i]=s.sourceImage)}for(let e=0,s=t.length;e<s;++e){const s=t[e];s&&iMt(s,i,s.sourceImage)}this._prepareToRender()}init(t,e,i,s,r){const n=this;n._cullingDirty=!0,n._layerInfo=t,n._mapInfo=e;const o=t.layerSize;n._layerName=t.name,n.tiles=t.tiles,n._properties=t.properties,n._layerSize=o,n._minGID=t.minGID,n._maxGID=t.maxGID,n._opacity=t.opacity,t.tintColor&&(n._tintColor=t.tintColor),n.renderOrder=e.renderOrder,n._staggerAxis=e.getStaggerAxis(),n._staggerIndex=e.getStaggerIndex(),n._hexSideLength=e.getHexSideLength(),n._animations=e.getTileAnimations(),n._tilesets=i,n._textures=s,n.texGrids=r,n._layerOrientation=e.orientation,n._mapTileSize=e.getTileSize();const a=n._mapTileSize.width,h=n._mapTileSize.height,l=n._layerSize.width,c=n._layerSize.height,u=n.node._getUITransformComp();if(1===n._layerOrientation){let t=0,e=0;const i=-2&a,s=-2&h;n._odd_even=0===n._staggerIndex?1:-1,0===n._staggerAxis?(n._diffX1=(i-n._hexSideLength)/2,n._diffY1=0,t=(n._diffX1+n._hexSideLength)*l+n._diffX1,e=s*c+s/2):(n._diffX1=0,n._diffY1=(s-n._hexSideLength)/2,t=i*l+i/2,e=(n._diffY1+n._hexSideLength)*c+n._diffY1),u.setContentSize(t,e)}else if(2===n._layerOrientation){const t=l+c;u.setContentSize(.5*a*t,.5*h*t)}else u.setContentSize(l*a,c*h);n._offset=new kr(t.offset.x,-t.offset.y),n._useAutomaticVertexZ=!1,n._vertexZvalue=0,n._syncAnchorPoint(),n._prepareToRender()}_prepareToRender(){this._updateVertices(),this._updateAllUserNode()}requestTiledRenderData(){const t=this._tiledDataArray;for(;t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length;)t.pop();if(t.length>0){const e=t[t.length-1];if(e.renderData&&0===e.renderData.vertexCount)return e}const e={renderData:null,texture:null};return this._tiledDataArray.push(e),e}requestSubNodesData(){const t=this._tiledDataArray;if(t.length>0){const e=t[t.length-1];if(cMt(e)&&0===e.subNodes.length)return e}const e={subNodes:[]};return this._tiledDataArray.push(e),e}destroyRenderData(){this._tiledDataArray.forEach((t=>{const e=t.renderData;e&&yI.remove(e)})),this._tiledDataArray.length=0,super.destroyRenderData()}_flushAssembler(){const e=t.Assembler.getAssembler(this);this._assembler!==e&&(this._assembler=e,this._assembler.createData(this)),0===this._tiledDataArray.length&&(this._markForUpdateRenderData(),this._updateColor())}_render(t){for(let e=0;e<this._tiledDataArray.length;e++){this._tiledDataArrayIdx=e;const i=this._tiledDataArray[e];if(i.subNodes)i.subNodes.forEach((e=>{e&&t.walk(e.node)}));else{const e=i;e.texture&&t.commitComp(this,e.renderData,e.texture,this._assembler,null)}}this.node._static=!0}createRenderEntity(){return new KI(2)}fillIndicesBuffer(t,e){const i=t.chunk.meshBuffer.iData;let s=t.chunk.vertexOffset;const r=t.vertexCount/4;let n=s/4*6;e.setIndexOffset(n);for(let t=0;t<r;t+=1)i[n]=s,i[n+1]=s+1,i[n+2]=s+2,i[n+3]=s+2,i[n+4]=s+1,i[n+5]=s+3,n+=6,s+=4;t.chunk.meshBuffer.indexOffset=n,e.setIBCount(6*r)}prepareDrawData(){this._drawInfoList.length=0;const t=this.renderEntity;t.clearDynamicRenderDrawInfos();const e=this._tiledDataArray;let i=0;e.forEach((e=>{if(cMt(e))e.subNodes.forEach((e=>{if(e){this._drawInfoList[i]||(this._drawInfoList[i]=new mI);const s=this._drawInfoList[i];s.setDrawInfoType(3),s.setSubNode(e.node),t.setDynamicRenderDrawInfo(s,i),i++}}));else{const s=e;if(s.texture&&s.renderData){this._drawInfoList[i]||(this._drawInfoList[i]=new mI);const e=this._drawInfoList[i];s.renderData.fillDrawInfoAttributes(e),e.setTexture(s.texture.getGFXTexture()),e.setSampler(s.texture.getGFXSampler()),e.setMaterial(this.getRenderMaterial(0)),this.fillIndicesBuffer(s.renderData,e),t.setDynamicRenderDrawInfo(e,i),i++}}}))}})||rMt);var _Mt,pMt,mMt,gMt,fMt;let yMt=t("TiledObjectGroup",(_Mt=ah("cc.TiledObjectGroup"),pMt=hh(RI),mMt=Xh(Xe),_Mt(gMt=pMt((fMt=class extends Km{constructor(){super(),this._premultiplyAlpha=!1,this._groupName=void 0,this._positionOffset=void 0,this._mapInfo=void 0,this._properties=void 0,this._offset=void 0,this._opacity=void 0,this._tintColor=null,this._animations=void 0,this._hasAniObj=void 0,this._texGrids=void 0,this.aniObjects=void 0,this._objects=[]}get premultiplyAlpha(){return this._premultiplyAlpha}set premultiplyAlpha(t){this._premultiplyAlpha=t}getPositionOffset(){return this._positionOffset}getProperties(){return this._properties}getGroupName(){return this._groupName}getProperty(t){return this._properties[t.toString()]}getObject(t){for(let e=0,i=this._objects.length;e<i;e++){const i=this._objects[e];if(i&&i.name===t)return i}return null}getObjects(){return this._objects}get offset(){return this._offset}_init(t,e,i){this._groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this._properties=t.getProperties(),this._offset=new kr(t.offset.x,-t.offset.y),this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this._texGrids=i,this._animations=e.getTileAnimations(),this.aniObjects=[],this._hasAniObj=!1;const s=e.mapSize,r=e.tileSize;let n=0,o=0;const a=new Ls,h=2===e.orientation;if(1===e.orientation)0===e.getStaggerAxis()?(o=r.height*(s.height+.5),n=(r.width+e.getHexSideLength())*Math.floor(s.width/2)+r.width*(s.width%2)):(n=r.width*(s.width+.5),o=(r.height+e.getHexSideLength())*Math.floor(s.height/2)+r.height*(s.height%2));else if(h){const t=s.width+s.height;n=.5*r.width*t,o=.5*r.height*t}else n=s.width*r.width,o=s.height*r.height;const l=this.node._getUITransformComp();l.setContentSize(n,o);const c=n*l.anchorX,u=o*(1-l.anchorY),d=t.objects,_={};for(let t=0,e=d.length;t<e;t++){const e=d[t],n=e.type;e.offset=new kr(e.x,e.y);const l=e.points||e.polylinePoints;if(l)for(let t=0;t<l.length;t++)l[t].y*=-1;if(h){const t=e.x/r.height,i=e.y/r.height;e.x=.5*r.width*(s.height+t-i),e.y=.5*r.height*(s.width+s.height-t-i)}else e.y=o-e.y;if(5===n){const i=`text${e.id}`;_[i]=!0;let s=this.node.getChildByName(i);s||(s=new tb),s.setRotationFromEuler(0,0,-e.rotation),s.setPosition(e.x-c,e.y-u),s.name=i,s.parent=this.node,s.setSiblingIndex(t),s.layer=this.node.layer;let r=s.getComponent(eP);r||(r=s.addComponent(eP));const n=s._getUITransformComp();s.active=e.visible,n.anchorX=0,n.anchorY=1,this._tintColor?(a.set(this._tintColor),a.a*=this._opacity/255,r.color.set(a)):r.color.a*=this._opacity/255,r.overflow=2,r.lineHeight=e.height,r.string=e.text,r.horizontalAlign=e.halign,r.verticalAlign=e.valign,r.fontSize=e.pixelsize,n.setContentSize(e.width,e.height)}else if(4===n){const s=e.gid,r=(268435455&s)>>>0,n=i.get(r);if(!n)continue;const o=n.tileset,l=`img${e.id}`;_[l]=!0;let d=this.node.getChildByName(l);e.width=e.width||n.width,e.height=e.height||n.height,d&&1024&d._objFlags&&(d.removeFromParent(),d.hideFlags|=8,d.destroy(),d=null),d||(d=new tb),this._animations.get(r)&&(this.aniObjects.push({object:e,imgNode:d,gridGID:r}),this._hasAniObj=!0);const p=o.tileOffset.x,m=o.tileOffset.y;d.active=e.visible,d.setRotationFromEuler(0,0,-e.rotation),d.setPosition(e.x-c,e.y-u),d.name=l,d.parent=this.node,d.setSiblingIndex(t),d.layer=this.node.layer;let g=d.getComponent(CP);g||(g=d.addComponent(CP));const f=d._getUITransformComp();h?(f.anchorX=.5+p/e.width,f.anchorY=m/e.height):(f.anchorX=p/e.width,f.anchorY=m/e.height),this._tintColor?(a.set(this._tintColor),a.a*=this._opacity/255,g.color.set(a)):g.color.a*=this._opacity/255,g.sizeMode=0;const y=this._premultiplyAlpha?1:2;g.srcBlendFactor!==y&&(g.srcBlendFactor=y,g.material&&g._updateBlendFunc());let b=n.spriteFrame;b=b?b.clone():new yD,(2147483648&s)>>>0&&(b.flipUVX=!b.flipUVX),(1073741824&s)>>>0&&(b.flipUVY=!b.flipUVY),b.rotated=n._rotated,b.rect=n._rect,g.spriteFrame=b,f.setContentSize(e.width,e.height),g._markForUpdateRenderData()}}this._objects=d;const p=this.node.children,m=/^(?:img|text)\d+$/;for(let t=0,e=p.length;t<e;t++){const e=p[t],i=e.name;m.test(i)&&!_[i]&&e.destroy()}}update(t){if(!this._hasAniObj)return;const e=this.aniObjects,i=this._texGrids,s=2===this._mapInfo.orientation;for(let t=0,r=e.length;t<r;t++){const r=e[t],n=r.gridGID,o=i.get(n);if(!o)continue;const a=o.tileset,h=r.object,l=r.imgNode,c=a.tileOffset.x,u=a.tileOffset.y,d=l._getUITransformComp();s?(d.anchorX=.5+c/h.width,d.anchorY=u/h.height):(d.anchorX=c/h.width,d.anchorY=u/h.height);const _=l.getComponent(CP),p=_.spriteFrame;p.rotated=o._rotated,p.rect=o._rect,_.spriteFrame=p,_._markForUpdateRenderData()}}},s(fMt.prototype,"premultiplyAlpha",[mMt],Object.getOwnPropertyDescriptor(fMt.prototype,"premultiplyAlpha"),fMt.prototype),gMt=fMt))||gMt)||gMt));var bMt,vMt,SMt,TMt,wMt,xMt,CMt,AMt,DMt,EMt,IMt,MMt,PMt,OMt,RMt,BMt,FMt,NMt;let LMt=t("TiledMapAsset",(bMt=ah("cc.TiledMapAsset"),vMt=Xh([lx]),SMt=Xh([Ye]),TMt=Xh([yD]),wMt=Xh([yD]),xMt=Xh([Ye]),CMt=Xh([Ye]),AMt=Xh([Vr]),bMt((EMt=class extends fm{constructor(){super(),this.tmxXmlStr=IMt&&IMt(),this.tsxFiles=MMt&&MMt(),this.tsxFileNames=PMt&&PMt(),this.spriteFrames=OMt&&OMt(),this.imageLayerSpriteFrame=RMt&&RMt(),this.imageLayerSpriteFrameNames=BMt&&BMt(),this.spriteFrameNames=FMt&&FMt(),this.spriteFrameSizes=NMt&&NMt()}},IMt=Za(EMt.prototype,"tmxXmlStr",[vh],(function(){return""})),MMt=Za(EMt.prototype,"tsxFiles",[vh,vMt],(function(){return[]})),PMt=Za(EMt.prototype,"tsxFileNames",[vh,SMt],(function(){return[]})),OMt=Za(EMt.prototype,"spriteFrames",[vh,TMt],(function(){return[]})),RMt=Za(EMt.prototype,"imageLayerSpriteFrame",[vh,wMt],(function(){return[]})),BMt=Za(EMt.prototype,"imageLayerSpriteFrameNames",[vh,xMt],(function(){return[]})),FMt=Za(EMt.prototype,"spriteFrameNames",[vh,CMt],(function(){return[]})),NMt=Za(EMt.prototype,"spriteFrameSizes",[vh,AMt],(function(){return[]})),DMt=EMt))||DMt));var kMt,zMt,UMt,VMt,jMt,HMt,GMt,WMt,XMt;t("TiledMap",(kMt=ah("cc.TiledMap"),zMt=hh(RI),UMt=Xh(LMt),kMt(VMt=zMt((XMt=class extends Km{get tmxAsset(){return this._tmxFile}set tmxAsset(t){this._tmxFile!==t&&(this._tmxFile=t,this._applyFile(),this._isApplied=!0)}get enableCulling(){return this._enableCulling}set enableCulling(t){this._enableCulling=t;const e=this._layers;for(let i=0;i<e.length;++i)e[i].enableCulling=t}constructor(){super(),this._texGrids=new Map,this._textures=[],this._tilesets=[],this._animations=new Map,this._imageLayers=[],this._layers=[],this._groups=[],this._images=[],this._properties={},this._tileProperties=new Map,this._mapInfo=null,this._mapSize=new Vr(0,0),this._tileSize=new Vr(0,0),this._mapOrientation=0,this._isApplied=!1,this._tmxFile=HMt&&HMt(),this._enableCulling=GMt&&GMt(),this.cleanupImageCache=WMt&&WMt()}getMapSize(){return this._mapSize}getTileSize(){return this._tileSize}getMapOrientation(){return this._mapOrientation}getObjectGroups(){return this._groups}getObjectGroup(t){const e=this._groups;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(s&&s.getGroupName()===t)return s}return null}getProperties(){return this._properties}getLayers(){return this._layers}getLayer(t){const e=this._layers;for(let i=0,s=e.length;i<s;i++){const s=e[i];if(s&&s.getLayerName()===t)return s}return null}_changeLayer(t,e){const i=this._layers;for(let s=0,r=i.length;s<r;s++){const r=i[s];if(r&&r.getLayerName()===t)return void(i[s]=e)}}getProperty(t){return this._properties[t.toString()]}getPropertiesForGID(t){return this._tileProperties.get(t)}enableTexelOffset(t){eMt(t)}__preload(){this._tmxFile&&!1===this._isApplied&&(this._applyFile(),this._isApplied=!0)}onEnable(){this.node.on("anchor-changed",this._syncAnchorPoint,this)}onDisable(){this.node.off("anchor-changed",this._syncAnchorPoint,this)}_applyFile(){const t=[],e={},i=this._tmxFile;if(i){let s=i.spriteFrameNames;const r=i.spriteFrameSizes,n=i.spriteFrames,o={},a={};for(let i=0;i<s.length;++i){const h=s[i];a[h]=r[i],t[i]=n[i];const l=t[i];l&&(e[l.name]=l,o[h]=l)}const h={},l=i.imageLayerSpriteFrame;s=i.imageLayerSpriteFrameNames;for(let t=0;t<l.length;++t)h[s[t]]=l[t];const c=i.tsxFileNames,u=i.tsxFiles,d={};for(let t=0;t<c.length;++t)c[t].length>0&&(d[c[t]]=u[t].text);const _=new VIt(i.tmxXmlStr,d,o,a,h),p=_.getTilesets();p&&0!==p.length||k(7241),this._buildWithMapInfo(_)}else this._releaseMapInfo()}_releaseMapInfo(){const t=this._layers;for(let s=0,r=t.length;s<r;s++){var e,i;null==(e=t[s].node.parent)||e.off("size-changed",t[s].updateCulling,t[s]),null==(i=t[s].node.parent)||i.off("transform-changed",t[s].updateCulling,t[s]),t[s].node.removeFromParent(),t[s].node.destroy()}t.length=0;const s=this._groups;for(let t=0,e=s.length;t<e;t++)s[t].node.removeFromParent(),s[t].node.destroy();s.length=0;const r=this._images;for(let t=0,e=r.length;t<e;t++)r[t].removeFromParent(),r[t].destroy();r.length=0}_syncAnchorPoint(){const t=this.node._getUITransformComp().anchorPoint,e=this.node._getUITransformComp().width*t.x,i=this.node._getUITransformComp().height*(1-t.y);let s,r;for(s=0,r=this._layers.length;s<r;s++)this._layers[s].node._getUITransformComp().setAnchorPoint(t);for(s=0,r=this._groups.length;s<r;s++){const t=this._groups[s],r=t.node._getUITransformComp();r.anchorX=.5,r.anchorY=.5;const n=t.offset.x-e+r.width*r.anchorX,o=t.offset.y+i-r.height*r.anchorY;t.node.setPosition(n,o)}for(s=0,r=this._images.length;s<r;s++){const t=this._images[s]._getUITransformComp();t.anchorX=.5,t.anchorY=.5;const r=this._images[s]._offset.x-e+t.width*t.anchorX,n=this._images[s]._offset.y+i-t.height*t.anchorY;this._images[s].setPosition(r,n)}}_fillAniGrids(t,e){for(const i of e.keys()){const s=e.get(i);if(!s)continue;const r=s.frames;for(let e=0;e<r.length;e++){const i=r[e];i.grid=t.get(i.tileid)}}}_buildLayerAndGroup(){const t=this._tilesets,e=this._texGrids,i=this._animations;e.clear();for(let i=0,s=t.length;i<s;++i){const s=t[i];s&&(s.sourceImage?iMt(s,e,s.sourceImage):j(16406,i))}this._fillAniGrids(e,i);let s=this._layers,r=this._groups,n=this._images;const o={};for(let t=0,e=s.length;t<e;t++)o[s[t].node.name]=!0;for(let t=0,e=r.length;t<e;t++)o[r[t].node.name]=!0;for(let t=0,e=n.length;t<e;t++)o[n[t].name]=!0;s=this._layers=[],r=this._groups=[],n=this._images=[];const a=this._mapInfo,h=this.node,l=a.getAllChildren(),c=this._textures;let u=0,d=0;if(l&&l.length>0)for(let i=0,_=l.length;i<_;i++){const _=l[i],p=_.name;let m=this.node.getChildByName(p);if(o[p]=!1,m||(m=new tb,m.name=p,m.layer=h.layer,h.addChild(m)),m.setSiblingIndex(i),m.active=_.visible,_ instanceof BIt){let i=m.getComponent(dMt);i||(i=m.addComponent(dMt)),i.init(_,a,t,c,e),i.enableCulling=this._enableCulling,_.ownTiles=!1,s.push(i)}else if(_ instanceof RIt){let t=m.getComponent(yMt);t||(t=m.addComponent(yMt)),t._init(_,a,e),r.push(t)}else if(_ instanceof FIt){const t=_.sourceImage;m.layerInfo=_,m._offset=new kr(_.offset.x,-_.offset.y);let e=m.getComponent(CP);e||(e=m.addComponent(CP)),e.color.a*=_.opacity,e.spriteFrame=t;let i=t.width,s=t.height;t.original&&(i=t.originalSize.width,s=t.originalSize.height),m._getUITransformComp().setContentSize(i,s),n.push(m)}u=Math.max(u,m._getUITransformComp().width),d=Math.max(d,m._getUITransformComp().height)}const _=h.children;for(let t=0,e=_.length;t<e;t++){const e=_[t];o[e.name]&&e.destroy()}this.node._getUITransformComp().setContentSize(u,d),this._syncAnchorPoint()}_buildWithMapInfo(t){this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();const e=this._tilesets;this._textures.length=0;const i=[];for(let t=0,s=e.length;t<s;++t){const s=e[t];s&&s.sourceImage&&(this._textures[t]=s.sourceImage,i.push(s.sourceImage))}for(let t=0;t<this._imageLayers.length;t++){const e=this._imageLayers[t];e&&e.sourceImage&&i.push(e.sourceImage)}this._buildLayerAndGroup(),this.cleanupImageCache&&this._textures.forEach((t=>{this.doCleanupImageCache(t)}))}doCleanupImageCache(t){t._image instanceof HTMLImageElement?(t._image.src="",t._image.destroy()):ga.hasFeature(ga.Feature.IMAGE_BITMAP)&&t._image instanceof ImageBitmap&&t._image.close&&t._image.close(),t._image=null}lateUpdate(t){const e=this._animations,i=this._texGrids;for(const s of e.keys()){const r=e.get(s),n=r.frames;let o=n[r.frameIdx];r.dt+=t,o.duration<r.dt&&(r.dt=0,r.frameIdx++,r.frameIdx>=n.length&&(r.frameIdx=0),o=n[r.frameIdx]),i.set(s,o.grid)}const s=this.getLayers();for(let t=0,e=s.length;t<e;t++){const e=s[t];(e.hasAnimation()||e.node.hasChangedFlags)&&e._markForUpdateRenderData()}}},XMt.Orientation=CIt,XMt.Property=AIt,XMt.TileFlag=DIt,XMt.StaggerAxis=EIt,XMt.StaggerIndex=IIt,XMt.TMXObjectType=PIt,XMt.RenderOrder=MIt,HMt=Za((jMt=XMt).prototype,"_tmxFile",[vh],(function(){return null})),s(jMt.prototype,"tmxAsset",[UMt],Object.getOwnPropertyDescriptor(jMt.prototype,"tmxAsset"),jMt.prototype),GMt=Za(jMt.prototype,"_enableCulling",[vh],(function(){return!0})),WMt=Za(jMt.prototype,"cleanupImageCache",[vh],(function(){return!0})),VMt=jMt))||VMt)||VMt));const YMt=Math.ceil(10922.5),qMt=[];for(let t=0;t<4;t++)qMt.push(new Ms);const $Mt=new vr,KMt=new Ms,ZMt={row:0,col:0};let QMt,JMt,tPt,ePt={x:0,y:0},iPt={x:0,y:0},sPt={x:0,y:0},rPt={x:0,y:0},nPt=0,oPt=0,aPt=0,hPt=0,lPt=null,cPt=null;const uPt=new class{ensureAccessor(){if(!cPt){const t=nC.root.device;nC.root.batcher2D,cPt=new dI(t,QE)}}createData(t){return this.ensureAccessor(),null}fillBuffers(t,e){if(!t||0===t.tiledDataArray.length)return;const i=t.tiledDataArray[t._tiledDataArrayIdx].renderData;if(!i)return;const s=i.chunk.meshBuffer.iData;let r=i.chunk.meshBuffer.indexOffset,n=i.chunk.vertexOffset;const o=i.vertexCount/4;for(let t=0;t<o;t+=1)s[r]=n,s[r+1]=n+1,s[r+2]=n+2,s[r+3]=n+2,s[r+4]=n+1,s[r+5]=n+3,r+=6,n+=4;i.chunk.meshBuffer.indexOffset=r}updateRenderData(t){if(t.updateCulling(),oPt=t.leftDownToCenterX,aPt=t.leftDownToCenterY,t.colorChanged||t.isCullingDirty()||t.isUserNodeDirty()||t.hasAnimation()||t.hasTiledNode()||t.node.hasChangedFlags){let e,i;if(t.colorChanged=!1,t.destroyRenderData(),t.enableCulling){const s=t.cullingRect;e=s.leftDown,i=s.rightTop}else e=ZMt,i=t.rightTop;switch(t.renderOrder){case 0:pPt(e,i,-1,1,t);break;case 2:pPt(e,i,-1,-1,t);break;case 1:pPt(e,i,1,1,t);break;default:pPt(e,i,1,-1,t)}t.setCullingDirty(!1),t.setUserNodeDirty(!1)}t.prepareDrawData()}updateColor(t){const e=t.color,i=new Float32Array(4);i[0]=e.r/255,i[1]=e.g/255,i[2]=e.b/255,i[3]=e.a/255;const s=t.tiledDataArray;for(let t=0;t<s.length;t++){const e=s[t];if(!e.renderData)continue;const r=e.renderData,n=r.vData;for(let t=r.vertexStart,e=r.vertexCount;t<e;t++)n.set(i,9*t+5)}}};function dPt(t,e){let i;t._rotated?(ePt.x=t.r,ePt.y=t.t,iPt.x=t.l,iPt.y=t.t,sPt.x=t.r,sPt.y=t.b,rPt.x=t.l,rPt.y=t.b):(ePt.x=t.l,ePt.y=t.t,iPt.x=t.l,iPt.y=t.b,sPt.x=t.r,sPt.y=t.t,rPt.x=t.r,rPt.y=t.b),(536870912&e)>>>0&&(i=iPt,iPt=sPt,sPt=i),(2147483648&e)>>>0&&(i=ePt,ePt=sPt,sPt=i,i=iPt,iPt=rPt,rPt=i),(1073741824&e)>>>0&&(i=ePt,ePt=iPt,iPt=i,i=sPt,sPt=rPt,rPt=i)}function _Pt(){if(hPt<1||!lPt)return;const t=4*hPt,e=6*hPt,i=JMt.requestTiledRenderData();i.renderData=yI.add(QE,cPt),i.renderData.drawInfoType=2,i.texture=lPt;const s=i.renderData;s.resize(t,e),s.chunk.vb.set(QMt.subarray(0,9*t),0),hPt=0,lPt=null}function pPt(t,e,i,s,r){if(e.row<0||e.col<0)return;JMt=r;const n=r.node.worldMatrix;nPt=0;const o=r.tiledTiles,a=r.texGrids,h=r.tiles,l=18,c=27,u=r.vertices;let d,_,p,m,g,f,y,b,v,S=0,T=0,w=0,x=0,C=0,A=0,D=!0;tPt=dPt;const E=new Float32Array(4);E[0]=r.color.r/255,E[1]=r.color.g/255,E[2]=r.color.b/255,E[3]=r.color.a/255,-1===i?(m=e.row,g=t.row):(m=t.row,g=e.row);const I=Math.abs(t.row-e.row)+1,M=Math.abs(e.col-t.col)+1;QMt=new Float32Array(I*M*36),hPt=0;const P=QMt;for(;(g-m)*i>=0;m+=i)for(d=u[m],A=r.getNodesCountByRow(m),D=d&&0===A,1===s?(_=D&&t.col<d.minCol?d.minCol:t.col,p=D&&e.col>d.maxCol?d.maxCol:e.col):(_=D&&e.col>d.maxCol?d.maxCol:e.col,p=D&&t.col<d.minCol?d.minCol:t.col);(p-_)*s>=0;_+=s){if(f=d&&d[_],A>0){_Pt();const t=r.requestSubNodesData(),e=r.getNodesByRowCol(m,_);e&&e.count>0&&(t.subNodes=e.list)}f&&(S=h[f.index],b=a.get((268435455&S)>>>0),b&&(lPt!==b.texture&&(_Pt(),lPt=b.texture),y=b.tileset._tileSize,T=f.left-oPt,w=f.bottom-aPt,x=T+y.width,C=w+y.height,v=o[f.index],nPt=36*hPt,v?v.node.active&&mPt(v.node,E,P,T,x,C,w):(qMt[0].x=T,qMt[0].y=C,qMt[1].x=T,qMt[1].y=w,qMt[2].x=x,qMt[2].y=C,qMt[3].x=x,qMt[3].y=w,qMt[0].transformMat4(n),P[nPt]=qMt[0].x,P[nPt+1]=qMt[0].y,P[nPt+2]=qMt[0].z,qMt[1].transformMat4(n),P[nPt+9]=qMt[1].x,P[nPt+9+1]=qMt[1].y,P[nPt+9+2]=qMt[1].z,qMt[2].transformMat4(n),P[nPt+l]=qMt[2].x,P[nPt+l+1]=qMt[2].y,P[nPt+l+2]=qMt[2].z,qMt[3].transformMat4(n),P[nPt+c]=qMt[3].x,P[nPt+c+1]=qMt[3].y,P[nPt+c+2]=qMt[3].z,P.set(E,nPt+5),P.set(E,nPt+9+5),P.set(E,nPt+l+5),P.set(E,nPt+c+5)),tPt(b,S),P[nPt+3]=ePt.x,P[nPt+4]=ePt.y,P[nPt+9+3]=iPt.x,P[nPt+9+4]=iPt.y,P[nPt+l+3]=sPt.x,P[nPt+l+4]=sPt.y,P[nPt+c+3]=rPt.x,P[nPt+c+4]=rPt.y,hPt++,hPt>=YMt&&_Pt()))}_Pt()}function mPt(t,e,i,s,r,n,o){t.updateWorldTransform(),vr.fromRTS($Mt,t.rotation,t.position,t.scale),Ms.set(KMt,-(s+oPt),-(o+aPt),0),vr.transform($Mt,$Mt,KMt),vr.multiply($Mt,t.parent.worldMatrix,$Mt);const a=$Mt,h=a.m12,l=a.m13,c=a.m00,u=a.m01,d=a.m04,_=a.m05;1===c&&0===u&&0===d&&1===_?(i[nPt]=s+h,i[nPt+1]=n+l,i[nPt+9]=s+h,i[nPt+9+1]=o+l,i[nPt+18]=r+h,i[nPt+18+1]=n+l,i[nPt+27]=r+h,i[nPt+27+1]=o+l):(i[nPt]=s*c+n*d+h,i[nPt+1]=s*u+n*_+l,i[nPt+9]=s*c+o*d+h,i[nPt+9+1]=s*u+o*_+l,i[nPt+18]=r*c+n*d+h,i[nPt+18+1]=r*u+n*_+l,i[nPt+27]=r*c+o*d+h,i[nPt+27+1]=r*u+o*_+l),i.set(e,nPt+5),i.set(e,nPt+9+5),i.set(e,nPt+18+5),i.set(e,nPt+27+5)}const gPt=t("tiledLayerAssembler",{getAssembler:()=>uPt});dMt.Assembler=gPt;const fPt=new Ms,yPt=new Ms;function bPt(t,e){let i=null;return{value:e.length>0?e[e.length-1]:Ms.ZERO,progress:(t,e,s,r)=>i.getPoint(r),clone:t=>Ms.clone(t),add:(t,e)=>t.clone().add(e),sub:(t,e)=>t.clone().subtract(e),onStart(s){const{start:r,end:n,relative:o,reversed:a}=s;i=Pu.create(t),i.addKnot(r);let h=null;o&&a&&(h=yPt,Ms.subtract(h,r,e[e.length-1]));for(let t=0,s=e.length;t<s;++t){const n=a?e[s-1-t]:e[t];o?a?t>0&&i.addKnot(Ms.copy(fPt,h).add(n)):i.addKnot(Ms.copy(fPt,r).add(n)):i.addKnot(n)}o&&a&&i.addKnot(n)},onComplete(){i=null},onStop(){i=null},legacyProgress:!1}}var vPt,SPt,TPt,wPt,xPt,CPt,APt,DPt,EPt,IPt,MPt,PPt,OPt,RPt,BPt,FPt,NPt,LPt,kPt,zPt,UPt,VPt,jPt,HPt,GPt,WPt,XPt;t("tweenProgress",Object.freeze({__proto__:null,bezier:function(...t){return bPt(1,t)},catmullRom:function(...t){return bPt(2,t)}}));class YPt{constructor(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1}}class qPt{constructor(){this._hashTargets=new Map,this._arrayTargets=[],this._currentTarget=void 0,this._elementPool=[]}_getElement(t,e){let i=this._elementPool.pop();return i||(i=new YPt),i.target=t,i.paused=!!e,i}_putElement(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)}_onNodeActiveChanged(t,e){e?this.resumeTarget(t):this.pauseTarget(t)}_onNodeDestroy(t){this._removeAllActionsFromTarget(t,!1)}_registerNodeEvent(t){t.isValid&&(t.on("active-changed",this._onNodeActiveChanged,this),t.on("node-destroyed",this._onNodeDestroy,this))}_unregisterNodeEvent(t){t.isValid&&(t.off("active-changed",this._onNodeActiveChanged,this),t.off("node-destroyed",this._onNodeDestroy,this))}addAction(t,e,i,s=!0){if(!t||!e)return void G(1e3);let r=this._hashTargets.get(e);r?r.actions||(r.actions=[]):(r=this._getElement(e,i),this._hashTargets.set(e,r),this._arrayTargets.push(r)),s&&0===r.actions.length&&e instanceof tb&&(this._registerNodeEvent(e),e.active||(r.paused=!0)),r.target=e,r.actions.push(t),t.startWithTarget(e)}removeAllActions(){const t=this._arrayTargets;for(let e=0;e<t.length;e++){const i=t[e];i&&(i.target instanceof tb&&this._unregisterNodeEvent(i.target),this._putElement(i))}this._arrayTargets.length=0,this._hashTargets=new Map}removeAllActionsFromTarget(t){this._removeAllActionsFromTarget(t,!0)}_removeAllActionsFromTarget(t,e){if(null==t)return;const i=this._hashTargets.get(t);i&&(e&&t instanceof tb&&this._unregisterNodeEvent(t),i.actions.length=0,this._deleteHashElement(i))}removeAction(t){if(null==t)return;const e=t.getOriginalTarget(),i=this._hashTargets.get(e);if(i)for(let e=0;e<i.actions.length;e++)if(i.actions[e]===t){i.actions.splice(e,1),i.actionIndex>=e&&i.actionIndex--;break}}_removeActionByTag(t,e,i){for(let s=0,r=e.actions.length;s<r;++s){const r=e.actions[s];if(r&&r.getTag()===t){if(i&&r.getOriginalTarget()!==i)continue;this._removeActionAtIndex(s,e);break}}}_removeAllActionsByTag(t,e,i){for(let s=e.actions.length-1;s>=0;--s){const r=e.actions[s];if(r&&r.getTag()===t){if(i&&r.getOriginalTarget()!==i)continue;this._removeActionAtIndex(s,e)}}}removeActionByTag(t,e){-1===t&&k(1002);const i=this._hashTargets;if(e){const s=i.get(e);s&&this._removeActionByTag(t,s,e)}else i.forEach((e=>{this._removeActionByTag(t,e)}))}removeAllActionsByTag(t,e){-1===t&&k(1002);const i=this._hashTargets;if(e){const s=i.get(e);s&&this._removeAllActionsByTag(t,s,e)}else i.forEach((e=>{this._removeAllActionsByTag(t,e)}))}getActionByTag(t,e){-1===t&&k(1004);const i=this._hashTargets.get(e);if(i){if(null!=i.actions)for(let e=0;e<i.actions.length;++e){const s=i.actions[e];if(s&&s.getTag()===t)return s}k(1005,t)}return null}getNumberOfRunningActionsInTarget(t){const e=this._hashTargets.get(t);return e&&e.actions?e.actions.length:0}pauseTarget(t){const e=this._hashTargets.get(t);e&&(e.paused=!0)}resumeTarget(t){const e=this._hashTargets.get(t);e&&(e.paused=!1)}pauseAllRunningActions(){const t=[],e=this._arrayTargets;for(let i=0;i<e.length;i++){const s=e[i];s&&!s.paused&&(s.paused=!0,s.target&&t.push(s.target))}return t}resumeTargets(t){if(t)for(let e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])}pauseTargets(t){if(t)for(let e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])}isActionRunning(t){const e=this._hashTargets.get(t.getOriginalTarget());let i=-1;return e&&(i=e.actions.indexOf(t)),-1!==i}_removeActionAtIndex(t,e){e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&(e.target instanceof tb&&this._unregisterNodeEvent(e.target),this._deleteHashElement(e))}_deleteHashElement(t){let e=!1;if(t&&!t.lock&&this._hashTargets.get(t.target)){this._hashTargets.delete(t.target);const i=this._arrayTargets;for(let e=0,s=i.length;e<s;e++)if(i[e]===t){i.splice(e,1);break}this._putElement(t),e=!0}return e}update(t){const e=this._arrayTargets;let i;for(let s=0;s<e.length;s++){this._currentTarget=e[s],i=this._currentTarget;const r=i.target;if(!Io(r)||r.isValid){if(!i.paused&&i.actions){for(i.lock=!0,i.actionIndex=0;i.actionIndex<i.actions.length;i.actionIndex++)if(i.currentAction=i.actions[i.actionIndex],i.currentAction){if(i.currentAction.step(t),i.currentAction&&i.currentAction.isDone()){i.currentAction.stop();const t=i.currentAction;i.currentAction=null,this.removeAction(t)}i.currentAction=null}i.lock=!1}0===i.actions.length&&(r instanceof tb&&this._unregisterNodeEvent(r),this._deleteHashElement(i)&&s--)}else this.removeAllActionsFromTarget(r),s--}}}class $Pt extends Bu{get ActionManager(){return this.actionMgr}constructor(){super(),this.actionMgr=new qPt}update(t){this.actionMgr.update(t)}}t("TweenSystem",$Pt),$Pt.ID="TWEEN",$Pt.instance=void 0,nC.on("director_init",(()=>{const t=new $Pt;$Pt.instance=t,nC.registerSystem($Pt.ID,t,100)}));class KPt{constructor(){this.originalTarget=null,this.target=null,this._owner=null,this.tag=-1,this._id=void 0,this._paused=!1}isDone(){return!0}startWithTarget(t){this.originalTarget=t,this.target=t}stop(){this.target=null}getTarget(){return this.target}setTarget(t){this.target=t}getOriginalTarget(){return this.originalTarget}setOriginalTarget(t){this.originalTarget=t}_getWorkerTarget(){var t;const e=null==(t=this._owner)?void 0:t.getTarget();return null!=e?e:this.target}getTag(){return this.tag}setTag(t){this.tag=t}setId(t){this._id=t}getId(){return this._id}setPaused(t){this._paused=t}}class ZPt extends KPt{constructor(){super(),this._duration=0}getDurationScaled(){return this._duration}getDuration(){return this._duration}setDuration(t){this._duration=t}}class QPt extends ZPt{isDone(){return!0}step(t){this.update(1)}update(t){}reverse(){return this.clone()}isUnknownDuration(){return!1}}class JPt extends QPt{update(t){const e=this._getWorkerTarget();if(!e)return;const i=e.getComponentsInChildren($I);for(let t=0;t<i.length;++t)i[t].enabled=!0}reverse(){return new tOt}clone(){const t=new JPt;return t._id=this._id,t}toString(){return"<Show>"}}class tOt extends QPt{update(t){const e=this._getWorkerTarget();if(!e)return;const i=e.getComponentsInChildren($I);for(let t=0;t<i.length;++t)i[t].enabled=!1}reverse(){return new JPt}clone(){const t=new tOt;return t._id=this._id,t}toString(){return"<Hide>"}}class eOt extends QPt{constructor(t){super(),this._isNeedCleanUp=!0,void 0!==t&&this.init(t)}update(t){const e=this._getWorkerTarget();e&&(e.removeFromParent(),this._isNeedCleanUp&&e.destroy())}init(t){return this._isNeedCleanUp=t,!0}reverse(){return new eOt(this._isNeedCleanUp)}clone(){const t=new eOt(this._isNeedCleanUp);return t._id=this._id,t}toString(){return"<RemoveSelf>"}}function iOt(t){return new eOt(t)}class sOt extends QPt{constructor(t,e,i){super(),this._callbackThis=void 0,this._callback=void 0,this._data=void 0,this.initWithFunction(t,e,i)}initWithFunction(t,e,i){return t&&(this._callback=t),e&&(this._callbackThis=e),void 0!==i&&(this._data=i),!0}execute(){if(this._callback){const t=this._getWorkerTarget();this._callback.call(this._callbackThis,t,this._data)}}update(t){this.execute()}getTargetCallback(){return this._callbackThis}setTargetCallback(t){t!==this._callbackThis&&(this._callbackThis=t)}clone(){const t=new sOt;return t._id=this._id,this._callback&&t.initWithFunction(this._callback,this._callbackThis,this._data),t}toString(){return"<CallFunc>"}}function rOt(t,e,i){return new sOt(t,e,i)}class nOt extends ZPt{clone(){return new nOt}reverse(){return this.clone()}update(t){}step(t){}isUnknownDuration(){return!1}toString(){return"DummyAction"}}class oOt extends ZPt{constructor(t){super(),this.MAX_VALUE=2,this._elapsed=0,this._startTime=0,this._firstTick=!1,this._speed=1,void 0===t||Number.isNaN(t)||this.initWithDuration(t)}setStartTime(t){t=t<0?0:t>this._duration?this._duration:t,this._startTime=t}getElapsed(){return this._elapsed}initWithDuration(t){return this._duration=0===t?we.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0}isDone(){return this._elapsed>=this._duration&&!this.isUnknownDuration()}_cloneDecoration(t){t._speed=this._speed}step(t){if(this._paused||0===this._speed)return;t*=this._speed,this._firstTick?this._elapsed=this._startTime:this._elapsed+=t;let e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=e<1?e:1,this.update(e>0?e:0),this.isUnknownDuration()&&!this._firstTick&&(e<1?this._elapsed-=t:this._elapsed=this._startTime+this._duration),this._firstTick&&(this._firstTick=!1,this._startTime>0&&(this._startTime=0))}startWithTarget(t){super.startWithTarget(t),this._elapsed=0,this._firstTick=!0}getSpeed(){return this._speed}setSpeed(t){this._speed=t}getDurationScaled(){return this._duration/this._speed}}function aOt(t,e){const i=new hOt;return i.initWithTwoActions(t,e),i}class hOt extends oOt{constructor(t){if(super(),this._actions=[],this._split=0,this._last=0,this._reversed=!1,!t||0===t.length)return;1===t.length&&t.push(new nOt);const e=t.length-1;if(e>=0&&null==t[e]&&k(1015),e>=0){let i,s=t[0];for(let r=1;r<e;r++)t[r]&&(i=s,s=aOt(i,t[r]));this.initWithTwoActions(s,t[e])}}initWithTwoActions(t,e){if(!t||!e)return G(1025),!1;const i=t.getDurationScaled()+e.getDurationScaled();return this.initWithDuration(i),this._actions[0]=t,this._actions[1]=e,!0}clone(){const t=new hOt;return t._id=this._id,t._speed=this._speed,this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t}startWithTarget(t){super.startWithTarget(t),0!==this._actions.length&&(this._split=this._actions[0].getDurationScaled()/this._duration,this._last=-1)}stop(){0!==this._actions.length&&(-1!==this._last&&this._actions[this._last].stop(),super.stop())}update(t){const e=this._actions;if(0===e.length)return;let i=0,s=0;const r=this._split,n=this._last;if(t<r){if(i=0!==r?t/r:1,0===s&&1===n&&this._reversed){const t=e[1];if(t.update(0),t.isUnknownDuration())return;t.stop()}}else{const o=e[0];if(s=1,i=1===r?1:(t-r)/(1-r),-1===n){if(o.startWithTarget(this.target),o.update(1),o.isUnknownDuration())return;o.stop()}if(0===n){if(o.update(1),o.isUnknownDuration())return;o.stop()}}const o=e[s];n===s&&o.isDone()||(n!==s&&o.startWithTarget(this.target),o.update(i>1?i%1:i),this._last=s)}reverse(){const t=aOt(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),t._reversed=!0,t}updateOwner(t){if(this._actions.length<2)return;const e=this._actions[0],i=this._actions[1];i._owner||(i._owner=t),e instanceof hOt||e instanceof mOt?e.updateOwner(t):e._owner||(e._owner=t)}findAction(t){for(let e=0,i=this._actions.length;e<i;++e){let i=this._actions[e];if(i.getId()===t)return i;if((i instanceof hOt||i instanceof mOt)&&(i=i.findAction(t),i&&i.getId()===t))return i}return null}isUnknownDuration(){if(0===this._actions.length)return!1;const t=this._actions[0],e=this._actions[1];return this._last<1?t.isUnknownDuration():e.isUnknownDuration()}toString(){return"<Sequence>"}}function lOt(t){return new hOt(t)}class cOt extends oOt{constructor(t,e){super(),this._times=0,this._total=0,this._nextDt=0,this._actionInstant=!1,this._innerAction=null,this.initWithAction(t,e)}initWithAction(t,e){if(!t||void 0===e)return!1;const i=t.getDurationScaled()*e;return!!this.initWithDuration(i)&&(this._times=e,this._innerAction=t,t instanceof QPt&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)}clone(){const t=new cOt;return t._id=this._id,t._speed=this._speed,this._cloneDecoration(t),this._innerAction&&t.initWithAction(this._innerAction.clone(),this._times),t}startWithTarget(t){this._total=0,this._nextDt=(this._innerAction?this._innerAction.getDurationScaled():0)/this._duration,super.startWithTarget(t),this._innerAction&&this._innerAction.startWithTarget(t)}stop(){this._innerAction&&this._innerAction.stop(),super.stop()}update(t){const e=this._innerAction,i=this._duration,s=this._times;let r=this._nextDt;if(e)if(t>=r){for(;t>r&&this._total<s;){if(e.update(1),e.isUnknownDuration())return;this._total++,e.stop(),e.startWithTarget(this.target),r+=e.getDurationScaled()/i,this._nextDt=r>1?1:r}if(t>=1&&this._total<s){if(e.update(1),e.isUnknownDuration())return;this._total++}this._actionInstant||(this._total===s?e.stop():e.update(t-(r-e.getDurationScaled()/i)))}else e.update(t*s%1)}isDone(){return this._total===this._times}reverse(){const t=this._innerAction?this._innerAction.reverse():void 0,e=new cOt(t,this._times);return this._cloneDecoration(e),e}setInnerAction(t){this._innerAction!==t&&(this._innerAction=t)}getInnerAction(){return this._innerAction}isUnknownDuration(){return!!this._innerAction&&this._innerAction.isUnknownDuration()}toString(){return"<Repeat>"}}function uOt(t,e){return new cOt(t,e)}class dOt extends oOt{constructor(t){super(),this._innerAction=null,t&&this.initWithAction(t)}initWithAction(t){return t?(this._innerAction=t,this._duration=1/0,!0):(G(1026),!1)}clone(){const t=new dOt;return t._id=this._id,t._speed=this._speed,this._cloneDecoration(t),this._innerAction&&t.initWithAction(this._innerAction.clone()),t}startWithTarget(t){super.startWithTarget(t),this._innerAction&&this._innerAction.startWithTarget(t)}stop(){this._innerAction&&this._innerAction.stop(),super.stop()}step(t){if(this._paused||0===this._speed)return;const e=this._innerAction;e&&(t*=this._speed,e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e.getDurationScaled())))}update(t){k(1007)}isDone(){return!1}reverse(){if(this._innerAction){const t=new dOt(this._innerAction.reverse());return this._cloneDecoration(t),t}return this}setInnerAction(t){this._innerAction!==t&&(this._innerAction=t)}getInnerAction(){return this._innerAction}isUnknownDuration(){return!!this._innerAction&&this._innerAction.isUnknownDuration()}toString(){return"<RepeatForever>"}}function _Ot(t){return new dOt(t)}function pOt(t,e){const i=new mOt;return i.initWithTwoActions(t,e),i}class mOt extends oOt{constructor(t){if(super(),this._one=null,this._two=null,this._finished=!1,!t||0===t.length)return;1===t.length&&t.push(new nOt);const e=t.length-1;if(e>=0&&null==t[e]&&k(1015),e>=0){let i,s=t[0];for(let r=1;r<e;r++)t[r]&&(i=s,s=pOt(i,t[r]));this.initWithTwoActions(s,t[e])}}initWithTwoActions(t,e){if(!t||!e)return G(1027),!1;let i=!1;const s=t.getDurationScaled(),r=e.getDurationScaled();return this.initWithDuration(Math.max(s,r))&&(this._one=t,this._two=e,s>r?this._two=aOt(e,fOt(s-r)):s<r&&(this._one=aOt(t,fOt(r-s))),i=!0),i}clone(){const t=new mOt;return t._id=this._id,t._speed=this._speed,this._cloneDecoration(t),this._one&&this._two&&t.initWithTwoActions(this._one.clone(),this._two.clone()),t}startWithTarget(t){super.startWithTarget(t),this._one&&this._one.startWithTarget(t),this._two&&this._two.startWithTarget(t)}stop(){this._one&&this._one.stop(),this._two&&this._two.stop(),super.stop()}update(t){this._one&&(this._finished&&!this._one.isUnknownDuration()||this._one.update(t)),this._two&&(this._finished&&!this._two.isUnknownDuration()||this._two.update(t)),this._finished=1===t}reverse(){if(this._one&&this._two){const t=pOt(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),t}return this}updateOwner(t){if(!this._one||!this._two)return;this._two._owner||(this._two._owner=t);const e=this._one;e instanceof mOt||e instanceof hOt?e.updateOwner(t):e._owner||(e._owner=t)}findAction(t){const e=this._one,i=this._two;let s=null;const r=e=>{if(e.getId()===t)return e;if(e instanceof hOt||e instanceof mOt){const i=e.findAction(t);if(i)return i}return null};return e&&(s=r(e),s)||i&&(s=r(i),s)?s:null}isUnknownDuration(){const t=this._one,e=this._two;if(null==t||null==e)return!1;const i=t.isUnknownDuration(),s=e.isUnknownDuration();if(i||s){if(i&&s)return!0;if(this._finished)return!0}return!1}toString(){return"<Spawn>"}}class gOt extends oOt{update(t){}reverse(){const t=new gOt(this._duration);return this._cloneDecoration(t),t}clone(){const t=new gOt;return t._id=this._id,t._speed=this._speed,this._cloneDecoration(t),t.initWithDuration(this._duration),t}isUnknownDuration(){return!1}toString(){return"<DelayTime>"}}function fOt(t){return new gOt(t)}class yOt extends oOt{constructor(t){super(),this._other=null,t&&this.initWithAction(t)}initWithAction(t){return t?t===this._other?(G(1029),!1):!!super.initWithDuration(t.getDurationScaled())&&(this._other=t,!0):(G(1028),!1)}clone(){const t=new yOt;return t._id=this._id,t._speed=this._speed,this._cloneDecoration(t),this._other&&t.initWithAction(this._other.clone()),t}startWithTarget(t){super.startWithTarget(t),this._other&&this._other.startWithTarget(t)}update(t){this._other&&this._other.update(1-t)}reverse(){return this._other?this._other.clone():this}stop(){this._other&&this._other.stop(),super.stop()}isUnknownDuration(){return!1}toString(){return"<ReverseTime>"}}function bOt(t){return new yOt(t)}class vOt extends oOt{constructor(t,e,i){super(t),this._cb=e,this._args=i}clone(){return new vOt(this._duration,this._cb,this._args)}update(t){this._cb(this.target,t,...this._args)}reverse(){return this.clone()}isUnknownDuration(){return!1}toString(){return"<ActionCustomUpdate>"}}class SOt extends ZPt{constructor(t,e){super(),this._finished=!1,this._cb=t,this._args=e}clone(){return new SOt(this._cb,this._args)}reverse(){return this.clone()}step(t){throw new Error("should never go here")}update(t){const e=a.game.deltaTime;this._finished=this._cb(this.target,e,...this._args)}isDone(){return this._finished}isUnknownDuration(){return!this.isDone()}toString(){return"<ActionUnknownDuration>"}}function TOt(t){const e=t.charAt(0);if(/[A-Z]/.test(e)){const i=(t=t.replace(e,e.toLowerCase())).split("-");if(2===i.length){const e=i[0];if("linear"===e)t="linear";else{const s=i[1];switch(e){case"quadratic":t=`quad${s}`;break;case"quartic":t=`quart${s}`;break;case"quintic":t=`quint${s}`;break;case"sinusoidal":t=`sine${s}`;break;case"exponential":t=`expo${s}`;break;case"circular":t=`circ${s}`;break;default:t=e+s}}}}return t}function wOt(t){const e=" [Tween:] ",i=` option is not support in v + ${l}`,s=t;s.delay&&M(`${e}delay${i}`),s.repeat&&M(`${e}repeat${i}`),s.repeatDelay&&M(`${e}repeatDelay${i}`),s.interpolation&&M(`${e}interpolation${i}`),s.onStop&&M(`${e}onStop${i}`)}class xOt extends oOt{constructor(t,e,i){if(super(),this._reversed=!1,null==i)i=Object.create(null);else if(wOt(i),i.easing&&"string"==typeof i.easing&&(i.easing=TOt(i.easing)),i.progress||(i.progress=this.progress),i.easing&&"string"==typeof i.easing){const t=i.easing;i.easing=tc[t],i.easing||j(1031,t)}this._opts=i,this._props=Object.create(null);for(const t in e){var s;if(!e.hasOwnProperty(t))continue;let i,r,n,o=e[t];if("function"==typeof o)o=o();else if(null==o)continue;void 0!==o.value?(n=o.value,"function"==typeof n&&(n=n()),void 0!==o.easing&&("string"==typeof o.easing?(i=tc[o.easing],i||j(1031,o.easing)):i=o.easing),void 0!==o.progress&&(r=o.progress)):n=o;const a=Object.create(null);a.start=a.current=a.end=null,a.keys=null,a.value=n,a.easing=i,a.progress=r,a.convert=o.convert,a.clone=o.clone,a.add=o.add,a.sub=o.sub,a.legacyProgress=null===(s=o.legacyProgress)||void 0===s||s,a.toFixed=o.toFixed,a.onStart=o.onStart,a.onStop=o.onStop,a.onComplete=o.onComplete,a.valid=!0,this._props[t]=a}this._originProps=e,this.initWithDuration(t)}get relative(){return!!this._opts.relative}clone(){const t=new xOt(this._duration,this._originProps,this._opts);return t._reversed=this._reversed,t._owner=this._owner,t._id=this._id,this._cloneDecoration(t),t}reverse(){if(!this._opts.relative)return j(16382),new xOt(0,{});const t=new xOt(this._duration,this._originProps,this._opts);return this._cloneDecoration(t),t._reversed=!this._reversed,t._owner=this._owner,t}startWithTarget(t){super.startWithTarget(t);const e=this._getWorkerTarget();if(!e)return;const i=!!this._opts.relative,s=this._props,r=this._reversed;for(const t in s){const n=e[t];if(void 0===n)continue;const o=s[t],a=o.value;if("number"==typeof n)o.start=n,o.current=n,o.end=i?r?n-a:n+a:a;else if("object"==typeof n)if(o.legacyProgress){if(null==o.start){const t=n.constructor;o.start=new t,o.current=new t,o.end=new t}let t;t=a.getModifiableProperties?a.getModifiableProperties():Object.keys(a),o.keys=t;for(let e=0,s=t.length;e<s;++e){const s=t[e];isNaN(n[s])||(o.start[s]=n[s],o.current[s]=n[s],o.end[s]=i?r?n[s]-a[s]:n[s]+a[s]:a[s])}}else{const e=o.clone;if(!e){j(16383,t),o.valid=!1;continue}{const s=o.add,h=o.sub;if(i&&(s||(j(16384,t),o.valid=!1),r&&!h&&(j(16385,t),o.valid=!1),!o.valid))continue;o.start=e(n),o.current=e(n),o.end=i?r?h(n,a):s(n,a):e(a)}}else if("string"==typeof n){const t=o.convert,e=e=>{if("number"==typeof e)return e;let i=e;return t&&(i=t(e)),"number"!=typeof i&&(i=Number(i),Number.isNaN(i))?(j(16386,`${e}`),null):i},s=e(a),h=e(n);if(null==s||null==h){o.valid=!1;continue}o.start=h,o.current=n,o.end=i?r?h-s:h+s:s}o.onStart&&o.onStart({relative:i,reversed:r,start:o.start,end:o.end})}this._opts.onStart&&this._opts.onStart(e)}stop(){const t=this._props;for(const e in t){const i=t[e];i.valid&&i.onStop&&i.onStop()}super.stop()}update(t){const e=this._getWorkerTarget();if(!e)return;if(!this._opts)return;const i=this._props,s=this._opts;let r=t;"function"==typeof s.easing&&(r=s.easing(t));const n=s.progress;for(const s in i){const a=i[s];if(!a.valid)continue;const h=a.easing?a.easing(t):r,l=a.progress?a.progress:n,c=a.start,u=a.end,d=a.current;if("number"==typeof d)a.current=l(c,u,a.current,h);else if("object"==typeof c)if(a.legacyProgress){const t=a.keys;for(let e=0,i=t.length;e<i;++e){const i=t[e];a.current[i]=l(c[i],u[i],a.current[i],h)}}else a.current=l(c,u,a.current,h);else if("string"==typeof d){let t=l(c,u,a.current,h);var o;if("number"==typeof t)t=t.toFixed(null!==(o=a.toFixed)&&void 0!==o?o:0);else if("string"!=typeof t){j(16387);continue}a.current=t}e[s]=a.current,1===t&&a.onComplete&&a.onComplete()}s.onUpdate&&s.onUpdate(e,t),1===t&&s.onComplete&&s.onComplete(e)}progress(t,e,i,s){return t+(e-t)*s}isUnknownDuration(){return!1}}t("TweenAction",xOt);class COt extends QPt{constructor(t){super(),this._props=void 0,this._props={},t&&this.init(t)}init(t){for(const e in t)this._props[e]=t[e];return!0}update(){const t=this._props,e=this._getWorkerTarget();for(const i in t)e[i]=t[i]}clone(){const t=new COt;return t._id=this._id,t.init(this._props),t}isUnknownDuration(){return!1}}function AOt(){return $Pt.instance.ActionManager}class DOt{constructor(t){this._actions=[],this._finalAction=null,this._target=null,this._tag=-1,this._timeScale=1,this._isBindNodeState=!0,this._target=void 0===t?null:t}bindNodeState(t){return this._isBindNodeState=t,this}tag(t){return this._tag=t,this}id(t){return this._actions.length>0&&this._actions[this._actions.length-1].setId(t),this}then(t){const e=t._union(!0);return e&&(e.setSpeed(t._timeScale),this._actions.push(e)),this}reverse(t,e){if(null==t&&null==e)return this.reverseTween();let i,s;if(t instanceof DOt?(i=t,void 0!==e&&(s=e)):"number"==typeof t&&(i=this,s=t),i){const t=DOt.reverseAction(i,s);t&&this._actions.push(t)}return this}reverseTween(){if(0===this._actions.length)return j(16388),this.clone(this._target);const t=this._union(!1),e=EOt(this._target);return e._timeScale=this._timeScale,t&&e.insertAction(t.reverse()),e}static reverseAction(t,e){const i=t._actions;if(0===i.length)return null;let s=null,r=null;return"number"==typeof e?s=t.findAction(e,i):t&&(s=t._union(!1)),s?(r=s.reverse(),r._owner=t):j(16391,`${e}`),r}findAction(t,e){let i=null;for(let s=0,r=e.length;s<r;++s){if(i=e[s],i.getId()===t)return i;if((i instanceof hOt||i instanceof mOt)&&(i=i.findAction(t),i))return i}return null}insertAction(t){const e=t.clone();return this.updateOwnerForAction(e),this._actions.push(e),this}updateOwnerForAction(t){t&&(t instanceof hOt||t instanceof mOt?t.updateOwner(this):t._owner||(t._owner=this))}target(t){return this._target=t,this}getTarget(){return this._target}start(t=0){if(!this._target)return j(16392),this;this._finalAction&&AOt().removeAction(this._finalAction);const e=this._unionForStart();return this._finalAction=e,e?(e.setTag(this._tag),e.setSpeed(this._timeScale),e.setStartTime(t),e.setPaused(!1),AOt().addAction(e,this._target,!1,this._isBindNodeState)):j(16393),this}stop(){return this._finalAction&&(this._finalAction.stop(),AOt().removeAction(this._finalAction),this._finalAction=null),this}pause(){return this._finalAction?this._finalAction.setPaused(!0):j(16389),this}resume(){return this._finalAction?this._finalAction.setPaused(!1):j(16390),this}get running(){return!!this._finalAction&&AOt().isActionRunning(this._finalAction)}clone(t){const e=this._union(!1),i=EOt(null!=t?t:this._target);return i._timeScale=this._timeScale,e?i.insertAction(e):i}union(t){if(void 0===t)return(()=>{const t=this._union(!1);this._actions.length=0,t&&this._actions.push(t)})(),this;const e=this._actions,i=e.findIndex((e=>e.getId()===t));if(e.length>1){const t=e.splice(i);1===t.length?e.push(t[0]):e.push(lOt(t))}return this}to(t,e,i){const s=i||Object.create(null);s.relative=!1;const r=new xOt(t,e,s);return this._actions.push(r),this}by(t,e,i){const s=i||Object.create(null);s.relative=!0;const r=new xOt(t,e,s);return this._actions.push(r),this}update(t,e,...i){const s=new vOt(t,e,i);return this._actions.push(s),this}updateUntil(t,...e){const i=new SOt(t,e);return this._actions.push(i),this}set(t){const e=new COt(t);return this._actions.push(e),this}delay(t){const e=fOt(t);return this._actions.push(e),this}call(t,e,i){const s=rOt(t,e,i);return this._actions.push(s),this}sequence(...t){const e=DOt._wrappedSequence(t);return e&&this._actions.push(e),this}parallel(...t){const e=DOt._wrappedParallel(t);return e&&this._actions.push(e),this}timeScale(t){return this._timeScale=t,this._finalAction&&this._finalAction.setSpeed(t),this}getTimeScale(){return this._timeScale}get duration(){return this._finalAction?this._finalAction.getDuration():0}repeat(t,e){if(t===1/0)return this.repeatForever(e);const i=this._actions;let s;return s=e instanceof DOt?e._union(!1):i.pop(),s&&i.push(uOt(s,t)),this}repeatForever(t){const e=this._actions;let i;return i=t instanceof DOt?t._union(!1):e.pop(),i&&0!==e.length?e.push(uOt(i,Number.MAX_SAFE_INTEGER)):i instanceof oOt?e.push(_Ot(i)):j(16394),this}reverseTime(t){const e=this._actions;let i;return i=t instanceof DOt?t._union(!1):e.pop(),i instanceof oOt?e.push(bOt(i)):j(16395),this}hide(){if(this._target instanceof tb){const t=new tOt;this._actions.push(t)}return this}show(){if(this._target instanceof tb){const t=new JPt;this._actions.push(t)}return this}removeSelf(){if(this._target instanceof tb){const t=iOt(!1);this._actions.push(t)}return this}destroySelf(){if(this._target instanceof tb){const t=iOt(!0);this._actions.push(t)}return this}static getRunningCount(t){return AOt().getNumberOfRunningActionsInTarget(t)}static stopAll(){AOt().removeAllActions()}static stopAllByTag(t,e){AOt().removeAllActionsByTag(t,e)}static stopAllByTarget(t){AOt().removeAllActionsFromTarget(t)}static pauseAllByTarget(t){AOt().pauseTarget(t)}static resumeAllByTarget(t){AOt().resumeTarget(t)}_union(t){const e=this._actions;if(0===e.length)return null;const i=lOt(e);return t&&this.updateOwnerForAction(i),i}_unionForStart(){const t=this._actions;if(0===t.length)return null;let e;return e=1===t.length&&t[0]instanceof dOt?t[0]:lOt(t),e}static _tweenToActions(t){const e=DOt._tmpArgs;e.length=0;for(let i=t.length,s=0;s<i;s++){const i=t[s],r=i._union(!0);r&&(r.setSpeed(i._timeScale),e.push(r))}}static _wrappedSequence(t){DOt._tweenToActions(t);const e=lOt(DOt._tmpArgs);return this._tmpArgs.length=0,e}static _wrappedParallel(t){DOt._tweenToActions(t);const e=(i=DOt._tmpArgs,new mOt(i));var i;return this._tmpArgs.length=0,e}}function EOt(t){return new DOt(t)}function IOt(t){return j(16396),new DOt(t)}t("Tween",DOt),DOt._tmpArgs=[],h.Tween=DOt,h.tween=EOt,h.tweenUtil=IOt;const MOt=new Ls,POt={NONE:0,COLOR:1,SPRITE:2,SCALE:3};fe(POt);const OOt={CLICK:"click"};let ROt=(vPt=ah("cc.Button"),SPt=lh(110),TPt=hh(RI),wPt=Xh(tb),xPt=Xh(POt),CPt=Xh(yD),APt=Xh(yD),DPt=Xh(yD),EPt=Xh(yD),IPt=Xh([Um]),vPt(MPt=SPt(MPt=TPt((XPt=class extends Km{get target(){return this._target||this.node}set target(t){this._target!==t&&(this._target&&this._unregisterTargetEvent(this._target),this._target=t,this._applyTarget())}get interactable(){return this._interactable}set interactable(t){this._interactable!==t&&(this._interactable=t,this._updateState(),this._interactable||this._resetState())}set _resizeToTarget(t){t&&this._resizeNodeToTargetNode()}get transition(){return this._transition}set transition(t){this._transition!==t&&(1===this._transition?this._updateColorTransition(0):2===this._transition&&this._updateSpriteTransition(0),this._transition=t,this._updateState())}get normalColor(){return this._normalColor}set normalColor(t){this._normalColor!==t&&(this._normalColor.set(t),this._updateState())}get pressedColor(){return this._pressedColor}set pressedColor(t){this._pressedColor!==t&&this._pressedColor.set(t)}get hoverColor(){return this._hoverColor}set hoverColor(t){this._hoverColor!==t&&this._hoverColor.set(t)}get disabledColor(){return this._disabledColor}set disabledColor(t){this._disabledColor!==t&&(this._disabledColor.set(t),this._updateState())}get duration(){return this._duration}set duration(t){this._duration!==t&&(this._duration=t)}get zoomScale(){return this._zoomScale}set zoomScale(t){this._zoomScale!==t&&(this._zoomScale=t)}get normalSprite(){return this._normalSprite}set normalSprite(t){if(this._normalSprite===t)return;this._normalSprite=t;const e=this.node.getComponent(CP);e&&(e.spriteFrame=t),this._updateState()}get pressedSprite(){return this._pressedSprite}set pressedSprite(t){this._pressedSprite!==t&&(this._pressedSprite=t,this._updateState())}get hoverSprite(){return this._hoverSprite}set hoverSprite(t){this._hoverSprite!==t&&(this._hoverSprite=t,this._updateState())}get disabledSprite(){return this._disabledSprite}set disabledSprite(t){this._disabledSprite!==t&&(this._disabledSprite=t,this._updateState())}constructor(){super(),this.clickEvents=OPt&&OPt(),this._interactable=RPt&&RPt(),this._transition=BPt&&BPt(),this._normalColor=FPt&&FPt(),this._hoverColor=NPt&&NPt(),this._pressedColor=LPt&&LPt(),this._disabledColor=kPt&&kPt(),this._normalSprite=zPt&&zPt(),this._hoverSprite=UPt&&UPt(),this._pressedSprite=VPt&&VPt(),this._disabledSprite=jPt&&jPt(),this._duration=HPt&&HPt(),this._zoomScale=GPt&&GPt(),this._target=WPt&&WPt(),this._pressed=!1,this._hovered=!1,this._fromColor=new Ls,this._toColor=new Ls,this._time=0,this._transitionFinished=!0,this._fromScale=Ps(),this._toScale=Ps(),this._originalScale=null,this._sprite=null,this._targetScale=Ps()}__preload(){this.target||(this.target=this.node),this._applyTarget(),this._resetState()}onEnable(){this._registerNodeEvent()}onDisable(){this._resetState(),this._unregisterNodeEvent()}onDestroy(){this.target.isValid&&this._unregisterTargetEvent(this.target)}update(t){const e=this.target;if(this._transitionFinished||!e)return;if(1!==this._transition&&3!==this._transition)return;this._time+=t;let i=1;if(this._duration>0&&(i=this._time/this._duration),i>=1&&(i=1),1===this._transition){const t=e._uiProps.uiComp;Ls.lerp(MOt,this._fromColor,this._toColor,i),t&&(t.color=MOt)}else 3===this.transition&&(e.getScale(this._targetScale),this._targetScale.x=Fi(this._fromScale.x,this._toScale.x,i),this._targetScale.y=Fi(this._fromScale.y,this._toScale.y,i),e.setScale(this._targetScale));1===i&&(this._transitionFinished=!0)}_resizeNodeToTargetNode(){this.target&&this.target._getUITransformComp()}_resetState(){this._pressed=!1,this._hovered=!1;const t=this.target;if(!t)return;const e=this._transition;if(1===e&&this._interactable){const e=t.getComponent(uM);e&&(e.color=this._normalColor)}else 3===e&&this._originalScale&&t.setScale(this._originalScale);this._transitionFinished=!0}_registerNodeEvent(){const t=this,e=t.node;e.on("touch-start",t._onTouchBegan,t),e.on("touch-move",t._onTouchMove,t),e.on("touch-end",t._onTouchEnded,t),e.on("touch-cancel",t._onTouchCancel,t),e.on("mouse-enter",t._onMouseMoveIn,t),e.on("mouse-leave",t._onMouseMoveOut,t)}_registerTargetEvent(t){t.on("transform-changed",this._onTargetTransformChanged,this)}_unregisterNodeEvent(){const t=this,e=t.node;e.off("touch-start",t._onTouchBegan,t),e.off("touch-move",t._onTouchMove,t),e.off("touch-end",t._onTouchEnded,t),e.off("touch-cancel",t._onTouchCancel,t),e.off("mouse-enter",t._onMouseMoveIn,t),e.off("mouse-leave",t._onMouseMoveOut,t)}_unregisterTargetEvent(t){t.off("transform-changed")}_getTargetSprite(t){let e=null;return t&&(e=t.getComponent(CP)),e}_applyTarget(){this.target&&(this._sprite=this._getTargetSprite(this.target),this._originalScale||(this._originalScale=new Ms),Ms.copy(this._originalScale,this.target.scale),this._registerTargetEvent(this.target))}_onTargetSpriteFrameChanged(t){2===this._transition&&this._setCurrentStateSpriteFrame(t.spriteFrame)}_setCurrentStateSpriteFrame(t){if(t)switch(this._getButtonState()){case 0:this._normalSprite=t;break;case 1:this._hoverSprite=t;break;case 2:this._pressedSprite=t;break;case 3:this._disabledSprite=t}}_onTargetColorChanged(t){1===this._transition&&this._setCurrentStateColor(t)}_setCurrentStateColor(t){switch(this._getButtonState()){case 0:this._normalColor=t;break;case 1:this._hoverColor=t;break;case 2:this._pressedColor=t;break;case 3:this._disabledColor=t}}_onTargetTransformChanged(t){4&t&&this._originalScale&&3===this._transition&&this._transitionFinished&&Ms.copy(this._originalScale,this.target.scale)}_onTouchBegan(t){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t&&(t.propagationStopped=!0))}_onTouchMove(t){if(!this._interactable||!this.enabledInHierarchy||!this._pressed)return;if(!t)return;const e=t.touch;if(!e)return;const i=this.node._getUITransformComp().hitTest(e.getLocation(),t.windowId);if(3===this._transition&&this.target&&this._originalScale)i?(Ms.copy(this._fromScale,this._originalScale),Ms.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._transitionFinished=!1):(this._time=0,this._transitionFinished=!0,this.target.setScale(this._originalScale));else{let t;t=i?2:0,this._applyTransition(t)}t&&(t.propagationStopped=!0)}_onTouchEnded(t){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(Um.emitEvents(this.clickEvents,t),this.node.emit("click",this)),this._pressed=!1,this._updateState(),t&&(t.propagationStopped=!0))}_onTouchCancel(t){this._interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())}_onMouseMoveIn(t){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(2!==this._transition||this._hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))}_onMouseMoveOut(t){this._hovered&&(this._hovered=!1,this._updateState())}_updateState(){const t=this._getButtonState();this._applyTransition(t)}_getButtonState(){let t=0;return this._interactable?this._pressed?t=2:this._hovered&&(t=1):t=3,t}_updateColorTransition(t){var e;const i=this._getColorByState(t),s=null==(e=this.target)?void 0:e.getComponent(uM);s&&(3===t?(s.color=i,this._transitionFinished=!0):(this._fromColor=s.color.clone(),this._toColor=i,this._time=0,this._transitionFinished=!1))}_updateSpriteTransition(t){const e=this._getSpriteFrameByState(t);this._sprite&&e&&(this._sprite.spriteFrame=e)}_updateScaleTransition(t){this._interactable&&(2===t?this._zoomUp():this._zoomBack())}_zoomUp(){this._originalScale&&(Ms.copy(this._fromScale,this._originalScale),Ms.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._time=0,this._transitionFinished=!1)}_zoomBack(){this.target&&this._originalScale&&(Ms.copy(this._fromScale,this.target.scale),Ms.copy(this._toScale,this._originalScale),this._time=0,this._transitionFinished=!1)}_applyTransition(t){const e=this._transition;1===e?this._updateColorTransition(t):2===e?this._updateSpriteTransition(t):3===e&&this._updateScaleTransition(t)}_getSpriteFrameByState(t){switch(t){case 0:return this._normalSprite;case 3:return this._disabledSprite;case 1:return this.hoverSprite;case 2:return this._pressedSprite;default:return null}}_getColorByState(t){switch(t){case 0:return this._normalColor;case 3:return this._disabledColor;case 1:return this._hoverColor;case 2:return this._pressedColor;default:return new Ls}}_xrHoverEnter(){}_xrHoverExit(){}_xrClick(){}_xrUnClick(){}},XPt.Transition=POt,XPt.EventType=OOt,s((PPt=XPt).prototype,"target",[wPt],Object.getOwnPropertyDescriptor(PPt.prototype,"target"),PPt.prototype),s(PPt.prototype,"transition",[xPt],Object.getOwnPropertyDescriptor(PPt.prototype,"transition"),PPt.prototype),s(PPt.prototype,"normalSprite",[CPt],Object.getOwnPropertyDescriptor(PPt.prototype,"normalSprite"),PPt.prototype),s(PPt.prototype,"pressedSprite",[APt],Object.getOwnPropertyDescriptor(PPt.prototype,"pressedSprite"),PPt.prototype),s(PPt.prototype,"hoverSprite",[DPt],Object.getOwnPropertyDescriptor(PPt.prototype,"hoverSprite"),PPt.prototype),s(PPt.prototype,"disabledSprite",[EPt],Object.getOwnPropertyDescriptor(PPt.prototype,"disabledSprite"),PPt.prototype),OPt=Za(PPt.prototype,"clickEvents",[IPt,vh],(function(){return[]})),RPt=Za(PPt.prototype,"_interactable",[vh],(function(){return!0})),BPt=Za(PPt.prototype,"_transition",[vh],(function(){return 0})),FPt=Za(PPt.prototype,"_normalColor",[vh],(function(){return Ls.WHITE.clone()})),NPt=Za(PPt.prototype,"_hoverColor",[vh],(function(){return new Ls(211,211,211,255)})),LPt=Za(PPt.prototype,"_pressedColor",[vh],(function(){return Ls.WHITE.clone()})),kPt=Za(PPt.prototype,"_disabledColor",[vh],(function(){return new Ls(124,124,124,255)})),zPt=Za(PPt.prototype,"_normalSprite",[vh],(function(){return null})),UPt=Za(PPt.prototype,"_hoverSprite",[vh],(function(){return null})),VPt=Za(PPt.prototype,"_pressedSprite",[vh],(function(){return null})),jPt=Za(PPt.prototype,"_disabledSprite",[vh],(function(){return null})),HPt=Za(PPt.prototype,"_duration",[vh],(function(){return.1})),GPt=Za(PPt.prototype,"_zoomScale",[vh],(function(){return 1.2})),WPt=Za(PPt.prototype,"_target",[vh],(function(){return null})),MPt=PPt))||MPt)||MPt)||MPt);t({Button:ROt,ButtonComponent:ROt}),h.Button=ROt,c.document,new vr,new vr,new Ms;const BOt={DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4,NEXT:5};pe(BOt);const FOt={ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6};pe(FOt);const NOt={PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5};var LOt,kOt,zOt,UOt,VOt,jOt,HOt,GOt,WOt,XOt,YOt,qOt,$Ot,KOt,ZOt,QOt,JOt,tRt,eRt,iRt,sRt,rRt,nRt,oRt,aRt,hRt,lRt,cRt,uRt;pe(NOt);let dRt=(LOt=ah("cc.EditBox"),kOt=lh(110),zOt=hh(RI),UOt=Xh(eP),VOt=Xh(eP),jOt=Xh(yD),HOt=Xh(NOt),GOt=Xh(FOt),WOt=Xh(BOt),XOt=Xh([Um]),YOt=Xh([Um]),qOt=Xh([Um]),$Ot=Xh([Um]),LOt(KOt=kOt(KOt=zOt((uRt=class t extends Km{get string(){return this._string}set string(t){this._maxLength>=0&&t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._string!==t&&(this._string=t,this._updateString(t))}get placeholder(){return this._placeholderLabel?this._placeholderLabel.string:""}set placeholder(t){this._placeholderLabel&&(this._placeholderLabel.string=t)}get textLabel(){return this._textLabel}set textLabel(t){this._textLabel!==t&&(this._textLabel=t,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}get placeholderLabel(){return this._placeholderLabel}set placeholderLabel(t){this._placeholderLabel!==t&&(this._placeholderLabel=t,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}get backgroundImage(){return this._backgroundImage}set backgroundImage(t){this._backgroundImage!==t&&(this._backgroundImage=t,this._ensureBackgroundSprite(),this._background.spriteFrame=t)}get inputFlag(){return this._inputFlag}set inputFlag(t){this._inputFlag!==t&&(this._inputFlag=t,this._updateString(this._string))}get inputMode(){return this._inputMode}set inputMode(t){this._inputMode!==t&&(this._inputMode=t,this._updateTextLabel(),this._updatePlaceholderLabel())}get returnType(){return this._returnType}set returnType(t){this._returnType=t}get maxLength(){return this._maxLength}set maxLength(t){this._maxLength=t}get tabIndex(){return this._tabIndex}set tabIndex(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}constructor(){super(),this.editingDidBegan=QOt&&QOt(),this.textChanged=JOt&&JOt(),this.editingDidEnded=tRt&&tRt(),this.editingReturn=eRt&&eRt(),this._impl=null,this._background=null,this._textLabel=iRt&&iRt(),this._placeholderLabel=sRt&&sRt(),this._returnType=rRt&&rRt(),this._string=nRt&&nRt(),this._tabIndex=oRt&&oRt(),this._backgroundImage=aRt&&aRt(),this._inputFlag=hRt&&hRt(),this._inputMode=lRt&&lRt(),this._maxLength=cRt&&cRt(),this._isLabelVisible=!1}__preload(){this._init()}onEnable(){this._registerEvent(),this._ensureBackgroundSprite(),this._impl&&this._impl.onEnable()}_beforeDraw(){this._impl&&this._impl.beforeDraw()}onDisable(){this._unregisterEvent(),this._unregisterBackgroundEvent(),this._impl&&this._impl.onDisable()}onDestroy(){nC.off("director_before_draw",this._beforeDraw,this),this._impl&&this._impl.clear()}setFocus(){this._impl&&this._impl.setFocus(!0)}focus(){this._impl&&this._impl.setFocus(!0)}blur(){this._impl&&this._impl.setFocus(!1)}isFocused(){return!!this._impl&&this._impl.isFocused()}_editBoxEditingDidBegan(){Um.emitEvents(this.editingDidBegan,this),this.node.emit("editing-did-began",this)}_editBoxEditingDidEnded(t){Um.emitEvents(this.editingDidEnded,this),this.node.emit("editing-did-ended",this,t)}_editBoxTextChanged(t){t=this._updateLabelStringStyle(t,!0),this.string=t,Um.emitEvents(this.textChanged,t,this),this.node.emit("text-changed",this)}_editBoxEditingReturn(t){Um.emitEvents(this.editingReturn,this),this.node.emit("editing-return",this,t)}_showLabels(){this._isLabelVisible=!0,this._updateLabels()}_hideLabels(){this._isLabelVisible=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)}_onTouchBegan(t){t.propagationStopped=!0}_onTouchCancel(t){t.propagationStopped=!0}_onTouchEnded(t){this._impl&&this._impl.beginEditing(),t.propagationStopped=!0}_init(){this._updatePlaceholderLabel(),this._updateTextLabel(),this._isLabelVisible=!0,this.node.on("size-changed",this._resizeChildNodes,this),nC.on("director_before_draw",this._beforeDraw,this),(this._impl=new t._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()}_ensureBackgroundSprite(){if(!this._background){let t=this.node.getComponent(CP);t||(t=this.node.addComponent(CP)),t!==this._background&&(t.type=CP.Type.SLICED,t.spriteFrame=this._backgroundImage,this._background=t,this._registerBackgroundEvent())}}_updateTextLabel(){let t=this._textLabel;if(!t){let e=this.node.getChildByName("TEXT_LABEL");e||(e=new tb("TEXT_LABEL"),e.layer=this.node.layer),t=e.getComponent(eP),t||(t=e.addComponent(eP)),e.parent=this.node,this._textLabel=t}0===this._inputMode?(t.verticalAlign=0,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this._updateLabelStringStyle(this._string)}_updatePlaceholderLabel(){let t=this._placeholderLabel;if(!t){let e=this.node.getChildByName("PLACEHOLDER_LABEL");e||(e=new tb("PLACEHOLDER_LABEL"),e.layer=this.node.layer),t=e.getComponent(eP),t||(t=e.addComponent(eP)),e.parent=this.node,this._placeholderLabel=t}0===this._inputMode?t.enableWrapText=!0:t.enableWrapText=!1,t.string=this.placeholder}_syncSize(){const t=this.node._getUITransformComp(),e=t.contentSize;if(this._background){const i=this._background.node._getUITransformComp();i.anchorPoint=t.anchorPoint,i.setContentSize(e)}this._updateLabelPosition(e),this._impl&&this._impl.setSize(e.width,e.height)}_updateLabels(){if(this._isLabelVisible){const t=this._string;this._textLabel&&(this._textLabel.node.active=""!==t),this._placeholderLabel&&(this._placeholderLabel.node.active=""===t)}}_updateString(t){const e=this._textLabel;if(!e)return;let i=t;i&&(i=this._updateLabelStringStyle(i)),e.string=i,this._updateLabels()}_updateLabelStringStyle(t,e=!1){const i=this._inputFlag;if(e||0!==i)4===i?t=t.toUpperCase():2===i?t=t.replace(/(?:^|\s)\S/g,(t=>t.toUpperCase())):3===i&&(t=(s=t).charAt(0).toUpperCase()+s.slice(1));else{let e="";const i=t.length;for(let t=0;t<i;++t)e+="";t=e}var s;return t}_registerEvent(){const t=this,e=t.node;e.on("touch-start",t._onTouchBegan,t),e.on("touch-end",t._onTouchEnded,t)}_unregisterEvent(){const t=this,e=t.node;e.off("touch-start",t._onTouchBegan,t),e.off("touch-end",t._onTouchEnded,t)}_onBackgroundSpriteFrameChanged(){this._background&&(this.backgroundImage=this._background.spriteFrame)}_registerBackgroundEvent(){const t=this._background&&this._background.node;null==t||t.on("spriteframe-changed",this._onBackgroundSpriteFrameChanged,this)}_unregisterBackgroundEvent(){const t=this._background&&this._background.node;null==t||t.off("spriteframe-changed",this._onBackgroundSpriteFrameChanged,this)}_updateLabelPosition(t){const e=this.node._getUITransformComp(),i=-e.anchorX*e.width,s=-e.anchorY*e.height,r=this._placeholderLabel,n=this._textLabel;n&&(n.node._getUITransformComp().setContentSize(t.width-2,t.height),n.node.setPosition(i+2,s+t.height,n.node.position.z),0===this._inputMode&&(n.verticalAlign=0),n.enableWrapText=0===this._inputMode),r&&(r.node._getUITransformComp().setContentSize(t.width-2,t.height),r.node.setPosition(i+2,s+t.height,r.node.position.z),r.enableWrapText=0===this._inputMode)}_resizeChildNodes(){const t=this.node._getUITransformComp(),e=this._textLabel&&this._textLabel.node;e&&(e.setPosition(-t.width/2,t.height/2,e.position.z),e._getUITransformComp().setContentSize(t.contentSize));const i=this._placeholderLabel&&this._placeholderLabel.node;i&&(i.setPosition(-t.width/2,t.height/2,i.position.z),i._getUITransformComp().setContentSize(t.contentSize));const s=this._background&&this._background.node;s&&s._getUITransformComp().setContentSize(t.contentSize),this._syncSize()}_xrUnClick(){}_xrKeyBoardInput(t){}},uRt._EditBoxImpl=class{constructor(){this._editing=!1,this._delegate=null}init(t){}onEnable(){}beforeDraw(){}onDisable(){this._editing&&this.endEditing()}clear(){this._delegate=null}setTabIndex(t){}setSize(t,e){}setFocus(t){t?this.beginEditing():this.endEditing()}isFocused(){return this._editing}beginEditing(){}endEditing(){}},uRt.KeyboardReturnType=BOt,uRt.InputFlag=NOt,uRt.InputMode=FOt,uRt.EventType={EDITING_DID_BEGAN:"editing-did-began",EDITING_DID_ENDED:"editing-did-ended",TEXT_CHANGED:"text-changed",EDITING_RETURN:"editing-return",XR_EDITING_DID_BEGAN:"xr-editing-did-began",XR_EDITING_DID_ENDED:"xr-editing-did-ended"},s((ZOt=uRt).prototype,"textLabel",[UOt],Object.getOwnPropertyDescriptor(ZOt.prototype,"textLabel"),ZOt.prototype),s(ZOt.prototype,"placeholderLabel",[VOt],Object.getOwnPropertyDescriptor(ZOt.prototype,"placeholderLabel"),ZOt.prototype),s(ZOt.prototype,"backgroundImage",[jOt],Object.getOwnPropertyDescriptor(ZOt.prototype,"backgroundImage"),ZOt.prototype),s(ZOt.prototype,"inputFlag",[HOt],Object.getOwnPropertyDescriptor(ZOt.prototype,"inputFlag"),ZOt.prototype),s(ZOt.prototype,"inputMode",[GOt],Object.getOwnPropertyDescriptor(ZOt.prototype,"inputMode"),ZOt.prototype),s(ZOt.prototype,"returnType",[WOt],Object.getOwnPropertyDescriptor(ZOt.prototype,"returnType"),ZOt.prototype),QOt=Za(ZOt.prototype,"editingDidBegan",[XOt,vh],(function(){return[]})),JOt=Za(ZOt.prototype,"textChanged",[YOt,vh],(function(){return[]})),tRt=Za(ZOt.prototype,"editingDidEnded",[qOt,vh],(function(){return[]})),eRt=Za(ZOt.prototype,"editingReturn",[$Ot,vh],(function(){return[]})),iRt=Za(ZOt.prototype,"_textLabel",[vh],(function(){return null})),sRt=Za(ZOt.prototype,"_placeholderLabel",[vh],(function(){return null})),rRt=Za(ZOt.prototype,"_returnType",[vh],(function(){return 0})),nRt=Za(ZOt.prototype,"_string",[vh],(function(){return""})),oRt=Za(ZOt.prototype,"_tabIndex",[vh],(function(){return 0})),aRt=Za(ZOt.prototype,"_backgroundImage",[vh],(function(){return null})),hRt=Za(ZOt.prototype,"_inputFlag",[vh],(function(){return 5})),lRt=Za(ZOt.prototype,"_inputMode",[vh],(function(){return 0})),cRt=Za(ZOt.prototype,"_maxLength",[vh],(function(){return 20})),KOt=ZOt))||KOt)||KOt)||KOt);var _Rt,pRt,mRt,gRt,fRt,yRt,bRt,vRt,SRt,TRt,wRt,xRt,CRt,ARt,DRt,ERt,IRt,MRt,PRt,ORt,RRt,BRt,FRt,NRt,LRt,kRt,zRt,URt;t({EditBox:dRt,EditBoxComponent:dRt}),h.internal.EditBox=dRt;const VRt={NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3};fe(VRt);const jRt={NONE:0,CONTAINER:1,CHILDREN:2};fe(jRt);const HRt={HORIZONTAL:0,VERTICAL:1};fe(HRt);const GRt={BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1};fe(GRt);const WRt={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1};fe(WRt);const XRt={NONE:0,FIXED_ROW:1,FIXED_COL:2};fe(XRt);const YRt=new Ms;let qRt=(_Rt=ah("cc.Layout"),pRt=lh(110),mRt=hh(RI),gRt=Xh(VRt),fRt=Xh(jRt),yRt=Xh(HRt),bRt=Xh(GRt),vRt=Xh(WRt),SRt=Xh(XRt),_Rt(TRt=pRt(TRt=mRt((URt=class extends Km{constructor(){super(),this._resizeMode=xRt&&xRt(),this._layoutType=CRt&&CRt(),this._cellSize=ARt&&ARt(),this._startAxis=DRt&&DRt(),this._paddingLeft=ERt&&ERt(),this._paddingRight=IRt&&IRt(),this._paddingTop=MRt&&MRt(),this._paddingBottom=PRt&&PRt(),this._spacingX=ORt&&ORt(),this._spacingY=RRt&&RRt(),this._verticalDirection=BRt&&BRt(),this._horizontalDirection=FRt&&FRt(),this._constraint=NRt&&NRt(),this._constraintNum=LRt&&LRt(),this._affectedByScale=kRt&&kRt(),this._isAlign=zRt&&zRt(),this._layoutSize=new Vr(300,200),this._layoutDirty=!0,this._childrenDirty=!1,this._usefulLayoutObj=[],this._init=!1}get alignHorizontal(){return this._isAlign}set alignHorizontal(t){1===this._layoutType&&(this._isAlign=t,this._doLayoutDirty())}get alignVertical(){return this._isAlign}set alignVertical(t){2===this._layoutType&&(this._isAlign=t,this._doLayoutDirty())}get type(){return this._layoutType}set type(t){this._layoutType=t,this._doLayoutDirty()}get resizeMode(){return this._resizeMode}set resizeMode(t){0!==this._layoutType&&(this._resizeMode=t,this._doLayoutDirty())}get cellSize(){return this._cellSize}set cellSize(t){this._cellSize!==t&&(this._cellSize.set(t),this._doLayoutDirty())}get startAxis(){return this._startAxis}set startAxis(t){this._startAxis!==t&&(this._startAxis=t,this._doLayoutDirty())}get paddingLeft(){return this._paddingLeft}set paddingLeft(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._doLayoutDirty())}get paddingRight(){return this._paddingRight}set paddingRight(t){this._paddingRight!==t&&(this._paddingRight=t,this._doLayoutDirty())}get paddingTop(){return this._paddingTop}set paddingTop(t){this._paddingTop!==t&&(this._paddingTop=t,this._doLayoutDirty())}get paddingBottom(){return this._paddingBottom}set paddingBottom(t){this._paddingBottom!==t&&(this._paddingBottom=t,this._doLayoutDirty())}get spacingX(){return this._spacingX}set spacingX(t){this._spacingX!==t&&(this._spacingX=t,this._doLayoutDirty())}get spacingY(){return this._spacingY}set spacingY(t){this._spacingY!==t&&(this._spacingY=t,this._doLayoutDirty())}get verticalDirection(){return this._verticalDirection}set verticalDirection(t){this._verticalDirection!==t&&(this._verticalDirection=t,this._doLayoutDirty())}get horizontalDirection(){return this._horizontalDirection}set horizontalDirection(t){this._horizontalDirection!==t&&(this._horizontalDirection=t,this._doLayoutDirty())}get padding(){return this._paddingLeft}set padding(t){this.paddingLeft===t&&this._paddingRight===t&&this._paddingTop===t&&this._paddingBottom===t||(this._paddingLeft=this._paddingRight=this._paddingTop=this._paddingBottom=t,this._doLayoutDirty())}get constraint(){return this._constraint}set constraint(t){0!==this._layoutType&&this._constraint!==t&&(this._constraint=t,this._doLayoutDirty())}get constraintNum(){return this._constraintNum}set constraintNum(t){0!==this._constraint&&this._constraintNum!==t&&(t<=0&&j(16400),this._constraintNum=t,this._doLayoutDirty())}get affectedByScale(){return this._affectedByScale}set affectedByScale(t){this._affectedByScale=t,this._doLayoutDirty()}updateLayout(t=!1){(this._layoutDirty||t)&&(this._doLayout(),this._layoutDirty=!1)}onEnable(){this._addEventListeners();const t=this.node._getUITransformComp();t.contentSize.equals(Vr.ZERO)&&t.setContentSize(this._layoutSize),this._childrenChanged()}onDisable(){this._usefulLayoutObj.length=0,this._removeEventListeners()}_checkUsefulObj(){this._usefulLayoutObj.length=0;const t=this.node.children;for(let e=0;e<t.length;++e){const i=t[e],s=i._getUITransformComp();i.activeInHierarchy&&s&&this._usefulLayoutObj.push(s)}}_addEventListeners(){nC.on("director_after_update",this.updateLayout,this),this.node.on("size-changed",this._resized,this),this.node.on("anchor-changed",this._doLayoutDirty,this),this.node.on("child-added",this._childAdded,this),this.node.on("child-removed",this._childRemoved,this),this.node.on("sibling-order-changed",this._childrenChanged,this),this.node.on("childrenSiblingOrderChanged",this.updateLayout,this),this._addChildrenEventListeners()}_removeEventListeners(){nC.off("director_after_update",this.updateLayout,this),this.node.off("size-changed",this._resized,this),this.node.off("anchor-changed",this._doLayoutDirty,this),this.node.off("child-added",this._childAdded,this),this.node.off("child-removed",this._childRemoved,this),this.node.off("sibling-order-changed",this._childrenChanged,this),this.node.off("childrenSiblingOrderChanged",this.updateLayout,this),this._removeChildrenEventListeners()}_addChildrenEventListeners(){const t=this.node.children;for(let e=0;e<t.length;++e){const i=t[e];i.on("size-changed",this._doLayoutDirty,this),i.on("transform-changed",this._transformDirty,this),i.on("anchor-changed",this._doLayoutDirty,this),i.on("active-in-hierarchy-changed",this._childrenChanged,this)}}_removeChildrenEventListeners(){const t=this.node.children;for(let e=0;e<t.length;++e){const i=t[e];i.off("size-changed",this._doLayoutDirty,this),i.off("transform-changed",this._transformDirty,this),i.off("anchor-changed",this._doLayoutDirty,this),i.off("active-in-hierarchy-changed",this._childrenChanged,this)}}_childAdded(t){t.on("size-changed",this._doLayoutDirty,this),t.on("transform-changed",this._transformDirty,this),t.on("anchor-changed",this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()}_childRemoved(t){t.off("size-changed",this._doLayoutDirty,this),t.off("transform-changed",this._transformDirty,this),t.off("anchor-changed",this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()}_resized(){this._layoutSize.set(this.node._getUITransformComp().contentSize),this._doLayoutDirty()}_doLayoutHorizontally(t,e,i,s){const r=this.node._getUITransformComp().anchorPoint,n=this._getFixedBreakingNum();let o=1,a=this._paddingLeft;1===this._horizontalDirection&&(o=-1,a=this._paddingRight);const h=(this._horizontalDirection-r.x)*t+o*a;let l=h-o*this._spacingX,c=0,u=0,d=0,_=0,p=!1;const m=this._usefulLayoutObj.length;let g=this._cellSize.width;const f=this._getPaddingH();3!==this._layoutType&&2===this._resizeMode&&(g=(t-f-(m-1)*this._spacingX)/m);const y=this._usefulLayoutObj;for(let a=0;a<y.length;++a){const m=y[a],b=m.node,v=b.scale,S=this._getUsedScaleValue(v.x),T=this._getUsedScaleValue(v.y);2===this._resizeMode&&(m.width=g/S,3===this._layoutType&&(m.height=this._cellSize.height/T));const w=Math.abs(this._horizontalDirection-m.anchorX),x=m.width*S,C=m.height*T;C>d&&(_=Math.max(d,_),u=d||C,d=C),l+=o*(w*x+this._spacingX);const A=o*(1-w)*x;if(e){if(n>0)p=a/n>0&&a%n==0,p&&(u=d>C?d:u);else if(x>t-f)l>h+o*w*x&&(p=!0);else{const e=(1-this._horizontalDirection-r.x)*t,i=l+A+o*(o>0?this._paddingRight:this._paddingLeft);p=Math.abs(i)>Math.abs(e)}p&&(l=h+o*w*x,C!==d&&(u=d),c+=u+this._spacingY,u=d=C)}const D=i(b,m,c);s&&b.setPosition(l,D),l+=A}return u=Math.max(u,d),Math.max(_,c+u)+this._getPaddingV()}_doLayoutVertically(t,e,i,s){const r=this.node._getUITransformComp().anchorPoint,n=this._getFixedBreakingNum();let o=1,a=this._paddingBottom;1===this._verticalDirection&&(o=-1,a=this._paddingTop);const h=(this._verticalDirection-r.y)*t+o*a;let l=h-o*this._spacingY,c=0,u=0,d=0,_=0,p=!1;const m=this._usefulLayoutObj.length;let g=this._cellSize.height;const f=this._getPaddingV();3!==this._layoutType&&2===this._resizeMode&&(g=(t-f-(m-1)*this._spacingY)/m);const y=this._usefulLayoutObj;for(let a=0;a<y.length;++a){const m=y[a],b=m.node,v=b.scale,S=this._getUsedScaleValue(v.x),T=this._getUsedScaleValue(v.y);2===this._resizeMode&&(m.height=g/T,3===this._layoutType&&(m.width=this._cellSize.width/S));const w=Math.abs(this._verticalDirection-m.anchorY),x=m.width*S,C=m.height*T;x>c&&(u=Math.max(c,u),d=c||x,c=x),l+=o*(w*C+this._spacingY);const A=o*(1-w)*C;if(e){if(n>0)p=a/n>0&&a%n==0,p&&(d=c>C?c:d);else if(C>t-f)l>h+o*w*C&&(p=!0);else{const e=(1-this._verticalDirection-r.y)*t,i=l+A+o*(o>0?this._paddingTop:this._paddingBottom);p=Math.abs(i)>Math.abs(e)}p&&(l=h+o*w*C,x!==c&&(d=c),_+=d+this._spacingX,d=c=x)}const D=i(b,m,_);s&&(b.getPosition(YRt),b.setPosition(D,l,YRt.z)),l+=A}return d=Math.max(d,c),Math.max(u,_+d)+this._getPaddingH()}_doLayoutGridAxisHorizontal(t,e){const i=e.width;let s=1,r=-t.y*e.height,n=this._paddingBottom;1===this._verticalDirection&&(s=-1,r=(1-t.y)*e.height,n=this._paddingTop);const o=(t,e,i)=>r+s*(i+(1-e.anchorY)*e.height*this._getUsedScaleValue(t.scale.y)+n);let a=0;1===this._resizeMode&&(a=this._doLayoutHorizontally(i,!0,o,!1),r=-t.y*a,1===this._verticalDirection&&(s=-1,r=(1-t.y)*a)),this._doLayoutHorizontally(i,!0,o,!0),1===this._resizeMode&&this.node._getUITransformComp().setContentSize(i,a)}_doLayoutGridAxisVertical(t,e){const i=e.height;let s=1,r=-t.x*e.width,n=this._paddingLeft;1===this._horizontalDirection&&(s=-1,r=(1-t.x)*e.width,n=this._paddingRight);const o=(t,e,i)=>r+s*(i+(1-e.anchorX)*e.width*this._getUsedScaleValue(t.scale.x)+n);let a=0;1===this._resizeMode&&(a=this._doLayoutVertically(i,!0,o,!1),r=-t.x*a,1===this._horizontalDirection&&(s=-1,r=(1-t.x)*a)),this._doLayoutVertically(i,!0,o,!0),1===this._resizeMode&&this.node._getUITransformComp().setContentSize(a,i)}_doLayoutGrid(){const t=this.node._getUITransformComp(),e=t.anchorPoint,i=t.contentSize;0===this.startAxis?this._doLayoutGridAxisHorizontal(e,i):1===this.startAxis&&this._doLayoutGridAxisVertical(e,i)}_getHorizontalBaseWidth(t=!0){const e=this._usefulLayoutObj;let i=0;const s=e.length;if(1===this._resizeMode){for(let t=0;t<e.length;++t){const s=e[t],r=s.node.scale;i+=s.width*this._getUsedScaleValue(r.x)}i+=(s-1)*this._spacingX+this._getPaddingH()}else i=this.node._getUITransformComp().width;return i}_getVerticalBaseHeight(){const t=this._usefulLayoutObj;let e=0;const i=t.length;if(1===this._resizeMode){for(let i=0;i<t.length;++i){const s=t[i],r=s.node.scale;e+=s.height*this._getUsedScaleValue(r.y)}e+=(i-1)*this._spacingY+this._getPaddingV()}else e=this.node._getUITransformComp().height;return e}_doLayout(){if(this._init&&!this._childrenDirty||(this._checkUsefulObj(),this._init=!0,this._childrenDirty=!1),1===this._layoutType){const t=this._getHorizontalBaseWidth(),e=t=>(this._isAlign?Ms.ZERO:t.position).y;this._doLayoutHorizontally(t,!1,e,!0),this.node._getUITransformComp().width=t}else if(2===this._layoutType){const t=this._getVerticalBaseHeight(),e=t=>(this._isAlign?Ms.ZERO:t.position).x;this._doLayoutVertically(t,!1,e,!0),this.node._getUITransformComp().height=t}else 3===this._layoutType&&this._doLayoutGrid()}_getUsedScaleValue(t){return this._affectedByScale?Math.abs(t):1}_transformDirty(t){4&t&&1&t&&this._affectedByScale&&this._doLayoutDirty()}_doLayoutDirty(){this._layoutDirty=!0}_childrenChanged(){this._childrenDirty=!0,this._doLayoutDirty()}_getPaddingH(){return this._paddingLeft+this._paddingRight}_getPaddingV(){return this._paddingTop+this._paddingBottom}_getFixedBreakingNum(){if(3!==this._layoutType||0===this._constraint||this._constraintNum<=0)return 0;let t=1===this._constraint?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum;return 1===this._startAxis&&(t=2===this._constraint?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum),t}},URt.Type=VRt,URt.VerticalDirection=GRt,URt.HorizontalDirection=WRt,URt.ResizeMode=jRt,URt.AxisDirection=HRt,URt.Constraint=XRt,s((wRt=URt).prototype,"type",[gRt],Object.getOwnPropertyDescriptor(wRt.prototype,"type"),wRt.prototype),s(wRt.prototype,"resizeMode",[fRt],Object.getOwnPropertyDescriptor(wRt.prototype,"resizeMode"),wRt.prototype),s(wRt.prototype,"startAxis",[yRt],Object.getOwnPropertyDescriptor(wRt.prototype,"startAxis"),wRt.prototype),s(wRt.prototype,"verticalDirection",[bRt],Object.getOwnPropertyDescriptor(wRt.prototype,"verticalDirection"),wRt.prototype),s(wRt.prototype,"horizontalDirection",[vRt],Object.getOwnPropertyDescriptor(wRt.prototype,"horizontalDirection"),wRt.prototype),s(wRt.prototype,"constraint",[SRt],Object.getOwnPropertyDescriptor(wRt.prototype,"constraint"),wRt.prototype),xRt=Za(wRt.prototype,"_resizeMode",[vh],(function(){return 0})),CRt=Za(wRt.prototype,"_layoutType",[vh],(function(){return 0})),ARt=Za(wRt.prototype,"_cellSize",[vh],(function(){return new Vr(40,40)})),DRt=Za(wRt.prototype,"_startAxis",[vh],(function(){return 0})),ERt=Za(wRt.prototype,"_paddingLeft",[vh],(function(){return 0})),IRt=Za(wRt.prototype,"_paddingRight",[vh],(function(){return 0})),MRt=Za(wRt.prototype,"_paddingTop",[vh],(function(){return 0})),PRt=Za(wRt.prototype,"_paddingBottom",[vh],(function(){return 0})),ORt=Za(wRt.prototype,"_spacingX",[vh],(function(){return 0})),RRt=Za(wRt.prototype,"_spacingY",[vh],(function(){return 0})),BRt=Za(wRt.prototype,"_verticalDirection",[vh],(function(){return 1})),FRt=Za(wRt.prototype,"_horizontalDirection",[vh],(function(){return 0})),NRt=Za(wRt.prototype,"_constraint",[vh],(function(){return 0})),LRt=Za(wRt.prototype,"_constraintNum",[vh],(function(){return 2})),kRt=Za(wRt.prototype,"_affectedByScale",[vh],(function(){return!1})),zRt=Za(wRt.prototype,"_isAlign",[vh],(function(){return!1})),TRt=wRt))||TRt)||TRt)||TRt);var $Rt,KRt,ZRt,QRt,JRt,tBt,eBt,iBt,sBt,rBt,nBt,oBt,aBt;t({Layout:qRt,LayoutComponent:qRt}),h.Layout=qRt;const hBt={HORIZONTAL:0,VERTICAL:1,FILLED:2};pe(hBt);let lBt=($Rt=ah("cc.ProgressBar"),KRt=lh(110),ZRt=hh(RI),QRt=Xh(CP),JRt=Xh(hBt),$Rt(tBt=KRt(tBt=ZRt((aBt=class extends Km{constructor(){super(),this._barSprite=iBt&&iBt(),this._mode=sBt&&sBt(),this._totalLength=rBt&&rBt(),this._progress=nBt&&nBt(),this._reverse=oBt&&oBt()}get barSprite(){return this._barSprite}set barSprite(t){this._barSprite!==t&&(this._barSprite=t,this._initBarSprite())}get mode(){return this._mode}set mode(t){if(this._mode!==t&&(this._mode=t,this._barSprite)){const t=this._barSprite.node;if(!t)return;const e=t._getUITransformComp().contentSize;0===this._mode?this.totalLength=e.width:1===this._mode?this.totalLength=e.height:2===this._mode&&(this.totalLength=this._barSprite.fillRange)}}get totalLength(){return this._totalLength}set totalLength(t){2===this._mode&&(t=Bi(t)),this._totalLength!==t&&(this._totalLength=t,this._updateBarStatus())}get progress(){return this._progress}set progress(t){this._progress!==t&&(this._progress=t,this._updateBarStatus())}get reverse(){return this._reverse}set reverse(t){this._reverse!==t&&(this._reverse=t,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}onLoad(){this._updateBarStatus()}_initBarSprite(){if(this._barSprite){const t=this._barSprite.node;if(!t)return;const e=this.node._getUITransformComp(),i=e.contentSize,s=e.anchorPoint,r=t._getUITransformComp().contentSize;if(2===this._barSprite.fillType&&(this._mode=2),0===this._mode?this.totalLength=r.width:1===this._mode?this.totalLength=r.height:this.totalLength=this._barSprite.fillRange,t.parent===this.node){const e=-i.width*s.x;t.setPosition(e,0,0)}}}_updateBarStatus(){if(this._barSprite){const t=this._barSprite.node;if(!t)return;const e=t._getUITransformComp(),i=e.anchorPoint,s=e.contentSize;let r=new kr(0,.5);const n=Bi(this._progress);let o=this._totalLength*n,a=s,h=0,l=0;switch(this._mode){case 0:this._reverse&&(r=new kr(1,.5)),a=new Vr(o,s.height),h=this._totalLength,l=s.height;break;case 1:r=this._reverse?new kr(.5,1):new kr(.5,0),a=new Vr(s.width,o),h=s.width,l=this._totalLength}if(2===this._mode)this._barSprite.type!==CP.Type.FILLED?j(16397):(this._reverse&&(o*=-1),this._barSprite.fillRange=o);else if(this._barSprite.type!==CP.Type.FILLED){const s=r.x-i.x,n=r.y-i.y,o=new Ms(t.position);o.add3f(h*s,l*n,0),t.setPosition(o),e.setAnchorPoint(r),e.setContentSize(a)}else j(16398)}}},aBt.Mode=hBt,s((eBt=aBt).prototype,"barSprite",[QRt],Object.getOwnPropertyDescriptor(eBt.prototype,"barSprite"),eBt.prototype),s(eBt.prototype,"mode",[JRt],Object.getOwnPropertyDescriptor(eBt.prototype,"mode"),eBt.prototype),iBt=Za(eBt.prototype,"_barSprite",[vh],(function(){return null})),sBt=Za(eBt.prototype,"_mode",[vh],(function(){return 0})),rBt=Za(eBt.prototype,"_totalLength",[vh],(function(){return 1})),nBt=Za(eBt.prototype,"_progress",[vh],(function(){return.1})),oBt=Za(eBt.prototype,"_reverse",[vh],(function(){return!1})),tBt=eBt))||tBt)||tBt)||tBt);var cBt,uBt,dBt,_Bt,pBt,mBt,gBt,fBt,yBt,bBt,vBt,SBt,TBt;t({ProgressBar:lBt,ProgressBarComponent:lBt}),h.ProgressBar=lBt;const wBt=new Ms,xBt=new Ms,CBt=new Ms,ABt=new kr,DBt=new Ls,EBt=new kr,IBt={HORIZONTAL:0,VERTICAL:1};fe(IBt);let MBt=(cBt=ah("cc.ScrollBar"),uBt=lh(110),dBt=hh(RI),_Bt=Xh(CP),pBt=Xh(IBt),cBt(mBt=uBt(mBt=dBt((TBt=class extends Km{constructor(){super(),this._scrollView=fBt&&fBt(),this._handle=yBt&&yBt(),this._direction=bBt&&bBt(),this._enableAutoHide=vBt&&vBt(),this._autoHideTime=SBt&&SBt(),this._touching=!1,this._opacity=255,this._autoHideRemainingTime=0}get handle(){return this._handle}set handle(t){this._handle!==t&&(this._handle=t,this.onScroll(kr.ZERO))}get direction(){return this._direction}set direction(t){this._direction!==t&&(this._direction=t,this.onScroll(kr.ZERO))}get enableAutoHide(){return this._enableAutoHide}set enableAutoHide(t){this._enableAutoHide!==t&&(this._enableAutoHide=t,this._enableAutoHide&&this._setOpacity(0))}get autoHideTime(){return this._autoHideTime}set autoHideTime(t){this._autoHideTime!==t&&(this._autoHideTime=t)}hide(){this._autoHideRemainingTime=0,this._setOpacity(0)}show(){this._autoHideRemainingTime=this._autoHideTime,this._opacity=255,this._setOpacity(this._opacity)}onScroll(t){if(!this._scrollView)return;const e=this._scrollView.content;if(!e)return;const i=e._getUITransformComp().contentSize,s=this._scrollView.node._getUITransformComp().contentSize,r=this.node._getUITransformComp().contentSize;if(this._conditionalDisableScrollBar(i,s))return;this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));let n=0,o=0,a=0,h=0,l=0;const c=EBt;c.set(0,0),0===this._direction?(n=i.width,o=s.width,l=r.width,a=t.x,this._convertToScrollViewSpace(c,e),h=-c.x):1===this._direction&&(n=i.height,o=s.height,l=r.height,a=t.y,this._convertToScrollViewSpace(c,e),h=-c.y);const u=this._calculateLength(n,o,l,a),d=EBt;this._calculatePosition(d,n,o,l,h,a,u),this._updateLength(u),this._updateHandlerPosition(d)}setScrollView(t){this._scrollView=t}onTouchBegan(){this._enableAutoHide&&(this._touching=!0)}onTouchEnded(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){const t=this._scrollView.content;if(t){const e=t._getUITransformComp().contentSize,i=this._scrollView.node._getUITransformComp().contentSize;if(this._conditionalDisableScrollBar(e,i))return}}this._autoHideRemainingTime=this._autoHideTime}}onEnable(){const t=this.node.getComponent(CP);t&&(this._opacity=t.color.a)}start(){this._enableAutoHide&&this._setOpacity(0)}update(t){this._processAutoHide(t)}_convertToScrollViewSpace(t,e){const i=this._scrollView&&this._scrollView.node._getUITransformComp(),s=e._getUITransformComp();if(i&&s){wBt.set(-s.anchorX*s.width,-s.anchorY*s.height,0),s.convertToWorldSpaceAR(wBt,xBt);const e=i.convertToNodeSpaceAR(xBt);e.x+=i.anchorX*i.width,e.y+=i.anchorY*i.height,t.set(e.x,e.y)}else t.set(kr.ZERO)}_setOpacity(t){if(this._handle){let e=this.node.getComponent(CP);e&&(DBt.set(e.color),DBt.a=t,e.color=DBt),e=this._handle.getComponent(CP),e&&(DBt.set(e.color),DBt.a=t,e.color=DBt)}}_updateHandlerPosition(t){if(this._handle){const e=CBt;this._fixupHandlerPosition(e),this._handle.node.setPosition(t.x+e.x,t.y+e.y,e.z)}}_fixupHandlerPosition(t){const e=this.node._getUITransformComp(),i=e.contentSize,s=e.anchorPoint,r=this.handle.node._getUITransformComp().contentSize,n=this.handle.node.parent;Ms.set(wBt,-i.width*s.x,-i.height*s.y,0);const o=this.node._getUITransformComp().convertToWorldSpaceAR(wBt,xBt),a=t;a.set(0,0,0),n._getUITransformComp().convertToNodeSpaceAR(o,a),0===this.direction?a.set(a.x,a.y+(i.height-r.height)/2,a.z):1===this.direction&&a.set(a.x+(i.width-r.width)/2,a.y,a.z),this.handle.node.setPosition(a)}_conditionalDisableScrollBar(t,e){return t.width<=e.width&&0===this._direction||t.height<=e.height&&1===this._direction}_calculateLength(t,e,i,s){let r=t;return s&&(r+=20*(s>0?s:-s)),i*(e/r)}_calculatePosition(t,e,i,s,r,n,o){let a=e-i;n&&(a+=Math.abs(n));let h=0;a&&(h=r/a,h=Bi(h));const l=(s-o)*h;1===this._direction?t.set(0,l):t.set(l,0)}_updateLength(t){if(this._handle){const e=this._handle.node._getUITransformComp(),i=e.contentSize,s=e.anchorPoint;s.x===ABt.x&&s.y===ABt.y||e.setAnchorPoint(ABt),0===this._direction?e.setContentSize(t,i.height):e.setContentSize(i.width,t)}}_processAutoHide(t){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);const t=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(t)}}},TBt.Direction=IBt,s((gBt=TBt).prototype,"handle",[_Bt],Object.getOwnPropertyDescriptor(gBt.prototype,"handle"),gBt.prototype),s(gBt.prototype,"direction",[pBt],Object.getOwnPropertyDescriptor(gBt.prototype,"direction"),gBt.prototype),fBt=Za(gBt.prototype,"_scrollView",[vh],(function(){return null})),yBt=Za(gBt.prototype,"_handle",[vh],(function(){return null})),bBt=Za(gBt.prototype,"_direction",[vh],(function(){return 0})),vBt=Za(gBt.prototype,"_enableAutoHide",[vh],(function(){return!1})),SBt=Za(gBt.prototype,"_autoHideTime",[vh],(function(){return 1})),mBt=gBt))||mBt)||mBt)||mBt);var PBt;t({ScrollBar:MBt,ScrollBarComponent:MBt}),h.ScrollBar=MBt;let OBt=t("ViewGroup",ah("cc.ViewGroup")(PBt=lh(110)(PBt=class extends Km{})||PBt)||PBt);var RBt,BBt,FBt,NBt,LBt,kBt,zBt,UBt,VBt,jBt,HBt,GBt,WBt,XBt,YBt,qBt,$Bt,KBt,ZBt,QBt,JBt;h.ViewGroup=OBt;const tFt=1e-4,eFt=Ps(),iFt=Ps(),sFt=zr(),rFt=zr(),nFt=()=>(new Date).getMilliseconds(),oFt={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12},aFt={anchor:zr(),applyToHorizontal:!1,applyToVertical:!1},hFt=(t,e,i,s)=>{aFt.anchor.set(t,e),aFt.applyToHorizontal=i,aFt.applyToVertical=s},lFt={NONE:"",SCROLL_TO_TOP:"scroll-to-top",SCROLL_TO_BOTTOM:"scroll-to-bottom",SCROLL_TO_LEFT:"scroll-to-left",SCROLL_TO_RIGHT:"scroll-to-right",SCROLL_BEGAN:"scroll-began",SCROLL_ENDED:"scroll-ended",BOUNCE_TOP:"bounce-top",BOUNCE_BOTTOM:"bounce-bottom",BOUNCE_LEFT:"bounce-left",BOUNCE_RIGHT:"bounce-right",SCROLLING:"scrolling",SCROLL_ENG_WITH_THRESHOLD:"scroll-ended-with-threshold",TOUCH_UP:"touch-up"};let cFt=(RBt=ah("cc.ScrollView"),BBt=lh(110),FBt=hh(RI),NBt=Xh(tb),LBt=Xh(MBt),kBt=Xh(MBt),zBt=Xh([Um]),RBt(UBt=BBt(UBt=FBt((JBt=class extends OBt{get content(){return this._content}set content(t){if(this._content===t)return;const e=t&&t.parent&&t.parent._getUITransformComp();!t||t&&e?(this._content=t,this._calculateBoundary()):k(4302)}get horizontalScrollBar(){const t=this._horizontalScrollBar;return t&&!t.isValid&&G(4303,"horizontal",this.node.name),t}set horizontalScrollBar(t){this._horizontalScrollBar!==t&&(this._horizontalScrollBar=t,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar(kr.ZERO)))}get verticalScrollBar(){const t=this._verticalScrollBar;return t&&!t.isValid&&G(4303,"vertical",this.node.name),t}set verticalScrollBar(t){this._verticalScrollBar!==t&&(this._verticalScrollBar=t,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar(kr.ZERO)))}get view(){const t=this._content&&this._content.parent;return t?t._getUITransformComp():null}constructor(){super(),this.bounceDuration=jBt&&jBt(),this.brake=HBt&&HBt(),this.elastic=GBt&&GBt(),this.inertia=WBt&&WBt(),this.horizontal=XBt&&XBt(),this.vertical=YBt&&YBt(),this.cancelInnerEvents=qBt&&qBt(),this.scrollEvents=$Bt&&$Bt(),this._autoScrolling=!1,this._scrolling=!1,this._content=KBt&&KBt(),this._horizontalScrollBar=ZBt&&ZBt(),this._verticalScrollBar=QBt&&QBt(),this._topBoundary=0,this._bottomBoundary=0,this._leftBoundary=0,this._rightBoundary=0,this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._touchMoved=!1,this._autoScrollAttenuate=!1,this._autoScrollStartPosition=new Ms,this._autoScrollTargetDelta=new Ms,this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0,this._autoScrollCurrentlyOutOfBoundary=!1,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=new Ms,this._outOfBoundaryAmount=new Ms,this._outOfBoundaryAmountDirty=!0,this._stopMouseWheel=!1,this._mouseWheelEventElapsedTime=0,this._isScrollEndedWithThresholdEventFired=!1,this._scrollEventEmitMask=0,this._isBouncing=!1,this._contentPos=new Ms,this._deltaPos=new Ms,this._deltaAmount=new Ms,this._hoverIn=0}scrollToBottom(t,e=!0){this._doScroll(0,0,!1,!0,t,e)}scrollToTop(t,e=!0){this._doScroll(0,1,!1,!0,t,e)}scrollToLeft(t,e=!0){this._doScroll(0,0,!0,!1,t,e)}scrollToRight(t,e=!0){this._doScroll(1,0,!0,!1,t,e)}scrollToTopLeft(t,e=!0){this._doScroll(0,1,!0,!0,t,e)}scrollToTopRight(t,e=!0){this._doScroll(1,1,!0,!0,t,e)}scrollToBottomLeft(t,e=!0){this._doScroll(0,0,!0,!0,t,e)}scrollToBottomRight(t,e=!0){this._doScroll(1,0,!0,!0,t,e)}scrollToOffset(t,e,i=!0){const s=this.getMaxScrollOffset(),r=zr();0===s.x?r.x=0:r.x=t.x/s.x,0===s.y?r.y=1:r.y=(s.y-t.y)/s.y,this.scrollTo(r,e,i)}getScrollOffset(){const t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return new kr(e,t)}getMaxScrollOffset(){if(!this._content||!this.view)return kr.ZERO;const t=this._content._getUITransformComp().contentSize;let e=t.width-this.view.width,i=t.height-this.view.height;return e=e>=0?e:0,i=i>=0?i:0,new kr(e,i)}scrollToPercentHorizontal(t,e,i){this._doScroll(t,0,!0,!1,e,i)}scrollTo(t,e,i){this._doScroll(t.x,t.y,!0,!0,e,i)}scrollToPercentVertical(t,e,i){this._doScroll(0,t,!1,!0,e,i)}_doScroll(t,e,i,s,r,n=!0){hFt(t,e,i,s);const o=this._calculateMovePercentDelta(aFt);r?this._startAutoScroll(o,r,n):this._moveContent(o)}stopAutoScroll(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime}setContentPosition(t){this._setContentPosition(t)}_setContentPosition(t){if(!this._content)return;const e=this._getContentPosition();Math.abs(t.x-e.x)<tFt&&Math.abs(t.y-e.y)<tFt||(this._content.setPosition(t),this._outOfBoundaryAmountDirty=!0)}getContentPosition(){return this._getContentPosition()}_getContentPosition(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):Ms.ZERO.clone()}isScrolling(){return this._scrolling}isAutoScrolling(){return this._autoScrolling}getScrollEndedEventTiming(){return tFt}start(){this._calculateBoundary(),this._content&&nC.once("director_before_draw",this._adjustContentOutOfBoundary,this)}onEnable(){const t=this;{t._registerEvent();const e=this._content;if(e){e.on("size-changed",t._calculateBoundary,t),e.on("transform-changed",t._scaleChanged,t);const i=t.view;i&&(i.node.on("transform-changed",t._scaleChanged,t),i.node.on("size-changed",t._calculateBoundary,t))}t._calculateBoundary()}t._updateScrollBarState()}update(t){const e=this._deltaAmount;this._autoScrolling?(this._processAutoScrolling(t),e.x=0,e.y=0):0===e.x&&0===e.y||(this._processDeltaMove(e),e.x=0,e.y=0)}onDisable(){const t=this;{t._unregisterEvent();const e=t.content;if(e){e.off("size-changed",t._calculateBoundary,t),e.off("transform-changed",t._scaleChanged,t);const i=t.view;i&&(i.node.off("transform-changed",t._scaleChanged,t),i.node.off("size-changed",t._calculateBoundary,t))}}t._deltaAmount.set(0,0),t._hideScrollBar(),t.stopAutoScroll()}_registerEvent(){const t=this,e=t.node;e.on("touch-start",t._onTouchBegan,t,!0),e.on("touch-move",t._onTouchMoved,t,!0),e.on("touch-end",t._onTouchEnded,t,!0),e.on("touch-cancel",t._onTouchCancelled,t,!0),e.on("mouse-wheel",t._onMouseWheel,t,!0),Dy.on("handle-input",t._dispatchEventHandleInput,t),Dy.on("gamepad-input",t._dispatchEventHandleInput,t)}_unregisterEvent(){const t=this,e=t.node;e.off("touch-start",t._onTouchBegan,t,!0),e.off("touch-move",t._onTouchMoved,t,!0),e.off("touch-end",t._onTouchEnded,t,!0),e.off("touch-cancel",t._onTouchCancelled,t,!0),e.off("mouse-wheel",t._onMouseWheel,t,!0),Dy.off("handle-input",t._dispatchEventHandleInput,t),Dy.off("gamepad-input",t._dispatchEventHandleInput,t)}_onMouseWheel(t,e){const i=this;if(!i.enabledInHierarchy)return;if(i._hasNestedViewGroup(t,e))return;const s=t.getScrollY(),r=eFt;i.vertical?r.set(0,-.1*s,0):i.horizontal&&r.set(-.1*s,0,0),i._mouseWheelEventElapsedTime=0,i._deltaAmount.add(r),i._stopMouseWheel||(i._handlePressLogic(),i.schedule(this._checkMouseWheel,1/60),i._stopMouseWheel=!0),i._stopPropagationIfTargetIsMe(t)}_onTouchBegan(t,e){const i=this;i.enabledInHierarchy&&i._content&&(i._hasNestedViewGroup(t,e)||(i._handlePressLogic(),i._touchMoved=!1,i._stopPropagationIfTargetIsMe(t)))}_onTouchMoved(t,e){const i=this;if(!i.enabledInHierarchy||!i._content)return;if(i._hasNestedViewGroup(t,e))return;const s=t.touch;if(i._handleMoveLogic(s),!i.cancelInnerEvents)return;const r=s.getUILocation(sFt);if(r.subtract(s.getUIStartLocation(rFt)),r.length()>7&&!i._touchMoved&&t.target!==i.node){const e=new If(t.getTouches(),t.bubbles,"touch-cancel");e.touch=t.touch,e.simulate=!0,t.target.dispatchEvent(e),i._touchMoved=!0}i._stopPropagationIfTargetIsMe(t)}_onTouchEnded(t,e){const i=this;if(!i.enabledInHierarchy||!i._content||!t)return;if(i._hasNestedViewGroup(t,e))return;i._dispatchEvent("touch-up");const s=t.touch;i._handleReleaseLogic(s),i._touchMoved?t.propagationStopped=!0:i._stopPropagationIfTargetIsMe(t)}_onTouchCancelled(t,e){const i=this;i.enabledInHierarchy&&i._content&&(i._hasNestedViewGroup(t,e)||(t&&!t.simulate&&i._handleReleaseLogic(t.touch),i._stopPropagationIfTargetIsMe(t)))}_calculateBoundary(){const t=this;if(t._content&&t.view){const e=t._content.getComponent(qRt);e&&e.enabledInHierarchy&&e.updateLayout();const i=t.view,s=i.width*i.anchorX,r=i.height*i.anchorY;t._leftBoundary=-s,t._bottomBoundary=-r,t._rightBoundary=t._leftBoundary+i.width,t._topBoundary=t._bottomBoundary+i.height,t._moveContentToTopLeft(i.contentSize)}}_hasNestedViewGroup(t,e){if(!t||t.eventPhase!==xf.CAPTURING_PHASE)return!1;if(e)for(let i=0;i<e.length;i++){const s=e[i];if(this.node===s)return!(!t.target||!t.target.getComponent(OBt));if(s.getComponent(OBt))return!0}return!1}_startInertiaScroll(t){eFt.set(t),eFt.multiplyScalar(.7),this._startAttenuatingAutoScroll(eFt,t)}_calculateAttenuatedFactor(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))}_startAttenuatingAutoScroll(t,e){const i=t.clone();if(i.normalize(),this._content&&this.view){const t=this._content._getUITransformComp().contentSize,e=this.view.contentSize,s=t.width-e.width,r=t.height-e.height,n=this._calculateAttenuatedFactor(s),o=this._calculateAttenuatedFactor(r);i.x=i.x*s*(1-this.brake)*n,i.y=i.y*r*o*(1-this.brake),i.z=0}const s=t.length();let r=i.length()/s;this.brake>0&&r>7?(r=Math.sqrt(r),i.set(t),i.multiplyScalar(r+1)):i.add(t);let n=this._calculateAutoScrollTimeByInitialSpeed(e.length());this.brake>0&&r>3&&(r=3,n*=r),0===this.brake&&r>1&&(n*=r),this._startAutoScroll(i,n,!0)}_calculateAutoScrollTimeByInitialSpeed(t){return Math.sqrt(Math.sqrt(t/5))}_startAutoScroll(t,e,i=!1){const s=this,r=s._flattenVectorByDirection(t);s._autoScrolling=!0,s._autoScrollTargetDelta=r,s._autoScrollAttenuate=i,Ms.copy(s._autoScrollStartPosition,s._getContentPosition()),s._autoScrollTotalTime=e,s._autoScrollAccumulatedTime=0,s._autoScrollBraking=!1,s._isScrollEndedWithThresholdEventFired=!1,s._autoScrollBrakingStartPosition.set(0,0,0),s._getHowMuchOutOfBoundary().equals(Ms.ZERO,tFt)||(this._autoScrollCurrentlyOutOfBoundary=!0)}_calculateTouchMoveVelocity(){const t=new Ms;let e=0;if(e=this._touchMoveTimeDeltas.reduce(((t,e)=>t+e),e),e<=0||e>=.5)t.set(Ms.ZERO);else{let i=eFt;i.set(0,0,0),i=this._touchMoveDisplacements.reduce(((t,e)=>(t.add(e),t)),i),t.set(i.x*(1-this.brake)/e,i.y*(1-this.brake)/e,i.z)}return t}_flattenVectorByDirection(t){return this.horizontal||(t.x=0),this.vertical||(t.y=0),t}_moveContent(t,e){const i=this._flattenVectorByDirection(t);eFt.set(this._getContentPosition()),eFt.add(i),eFt.set(Math.round(1e4*eFt.x)*tFt,Math.round(1e4*eFt.y)*tFt,eFt.z),this._setContentPosition(eFt);const s=this._getHowMuchOutOfBoundary();sFt.set(s.x,s.y),this._updateScrollBar(sFt),this.elastic&&e&&this._startBounceBackIfNeeded()}_getContentLeftBoundary(){if(!this._content)return-1;const t=this._getContentPosition(),e=this._content._getUITransformComp();return t.x-e.anchorX*e.width}_getContentRightBoundary(){if(!this._content)return-1;const t=this._content._getUITransformComp();return this._getContentLeftBoundary()+t.width}_getContentTopBoundary(){if(!this._content)return-1;const t=this._content._getUITransformComp();return this._getContentBottomBoundary()+t.height}_getContentBottomBoundary(){if(!this._content)return-1;const t=this._getContentPosition(),e=this._content._getUITransformComp();return t.y-e.anchorY*e.height}_getHowMuchOutOfBoundary(t){if(t||(t=Ms.ZERO),t.equals(Ms.ZERO,tFt)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;const e=new Ms,i=this._getContentLeftBoundary(),s=this._getContentRightBoundary();i+t.x>this._leftBoundary?e.x=this._leftBoundary-(i+t.x):s+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(s+t.x));const r=this._getContentTopBoundary(),n=this._getContentBottomBoundary();return r+t.y<this._topBoundary?e.y=this._topBoundary-(r+t.y):n+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(n+t.y)),t.equals(Ms.ZERO,tFt)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e),e}_updateScrollBar(t){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onScroll(t),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onScroll(t)}_onScrollBarTouchBegan(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onTouchBegan(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onTouchBegan()}_onScrollBarTouchEnded(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.onTouchEnded(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.onTouchEnded()}_dispatchEvent(t){if("scroll-ended"===t)this._scrollEventEmitMask=0;else if("scroll-to-top"===t||"scroll-to-bottom"===t||"scroll-to-left"===t||"scroll-to-right"===t){const e=1<<oFt[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}Um.emitEvents(this.scrollEvents,this,oFt[t]),this.node.emit(t,this)}_adjustContentOutOfBoundary(){if(!this._content)return;this._outOfBoundaryAmountDirty=!0;const t=this._getHowMuchOutOfBoundary();!t.equals(Ms.ZERO,tFt)&&(eFt.set(this._getContentPosition()),eFt.add(t),this._setContentPosition(eFt),this._updateScrollBar(kr.ZERO))}_hideScrollBar(){this._horizontalScrollBar&&this._horizontalScrollBar.isValid&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.isValid&&this._verticalScrollBar.hide()}_updateScrollBarState(){const t=this;if(!t._content||!t.view)return;const e=t.view,i=t._content._getUITransformComp(),s=t._verticalScrollBar;s&&s.isValid&&(i.height<e.height||Oi(i.height,e.height)?s.hide():s.show());const r=t._horizontalScrollBar;r&&r.isValid&&(i.width<e.width||Oi(i.width,e.width)?r.hide():r.show())}_stopPropagationIfTargetIsMe(t){t.eventPhase===xf.AT_TARGET&&t.target===this.node&&(t.propagationStopped=!0)}_processDeltaMove(t){this._scrollChildren(t),this._gatherTouchMove(t)}_handleMoveLogic(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._deltaAmount.add(this._deltaPos)}_handleReleaseLogic(t){const e=this;e._getLocalAxisAlignDelta(e._deltaPos,t),e._gatherTouchMove(e._deltaPos),e._processInertiaScroll(),e._scrolling&&(e._scrolling=!1,e._autoScrolling||e._dispatchEvent("scroll-ended"))}_getLocalAxisAlignDelta(t,e){const i=this.node._getUITransformComp();i&&(e.getUILocation(sFt),e.getUIPreviousLocation(rFt),eFt.set(sFt.x,sFt.y,0),iFt.set(rFt.x,rFt.y,0),i.convertToNodeSpaceAR(eFt,eFt),i.convertToNodeSpaceAR(iFt,iFt),Ms.subtract(t,eFt,iFt))}_scrollChildren(t){const e=this;e._clampDelta(t);const i=t;let s;e.elastic&&(s=e._getHowMuchOutOfBoundary(),i.x*=0===s.x?1:.5,i.y*=0===s.y?1:.5),e.elastic||(s=e._getHowMuchOutOfBoundary(i),i.add(s));let r="",n="";if(e._content){const{anchorX:t,anchorY:s,width:o,height:a}=e._content._getUITransformComp(),h=e._content.position||Ms.ZERO;e.vertical&&(i.y>0?h.y-s*a+i.y>=e._bottomBoundary&&(r="scroll-to-bottom"):i.y<0&&h.y-s*a+a+i.y<=e._topBoundary&&(r="scroll-to-top")),e.horizontal&&(i.x<0?h.x-t*o+o+i.x<=e._rightBoundary&&(n="scroll-to-right"):i.x>0&&h.x-t*o+i.x>=e._leftBoundary&&(n="scroll-to-left"))}e._moveContent(i,!1),(e.horizontal&&0!==i.x||e.vertical&&0!==i.y)&&(e._scrolling||(e._scrolling=!0,e._dispatchEvent("scroll-began")),e._dispatchEvent("scrolling")),""!==r&&e._dispatchEvent(r),""!==n&&e._dispatchEvent(n)}_handlePressLogic(){const t=this;t._autoScrolling&&t._dispatchEvent("scroll-ended"),t._autoScrolling=!1,t._isBouncing=!1,t._touchMovePreviousTimestamp=nFt(),t._touchMoveDisplacements.length=0,t._touchMoveTimeDeltas.length=0,t._onScrollBarTouchBegan()}_clampDelta(t){if(this._content&&this.view){const e=this.view.contentSize,i=this._content._getUITransformComp();i.width<e.width&&(t.x=0),i.height<e.height&&(t.y=0)}}_gatherTouchMove(t){const e=this,i=t.clone();for(e._clampDelta(i);e._touchMoveDisplacements.length>=5;)e._touchMoveDisplacements.shift(),e._touchMoveTimeDeltas.shift();e._touchMoveDisplacements.push(i);const s=nFt();e._touchMoveTimeDeltas.push((s-e._touchMovePreviousTimestamp)/1e3),e._touchMovePreviousTimestamp=s}_startBounceBackIfNeeded(){const t=this;if(!t.elastic)return!1;const e=t._getHowMuchOutOfBoundary();if(t._clampDelta(e),e.equals(Ms.ZERO,tFt))return!1;const i=Math.max(t.bounceDuration,0);return t._startAutoScroll(e,i,!0),t._isBouncing||(e.y>0&&t._dispatchEvent("bounce-top"),e.y<0&&t._dispatchEvent("bounce-bottom"),e.x>0&&t._dispatchEvent("bounce-right"),e.x<0&&t._dispatchEvent("bounce-left"),t._isBouncing=!0),!0}_processInertiaScroll(){if(!this._startBounceBackIfNeeded()&&this.inertia){const t=this._calculateTouchMoveVelocity();!t.equals(Ms.ZERO,tFt)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()}_isOutOfBoundary(){return!this._getHowMuchOutOfBoundary().equals(Ms.ZERO,tFt)}_isNecessaryAutoScrollBrake(){const t=this;if(t._autoScrollBraking)return!0;if(t._isOutOfBoundary()){if(!t._autoScrollCurrentlyOutOfBoundary)return t._autoScrollCurrentlyOutOfBoundary=!0,t._autoScrollBraking=!0,Ms.copy(t._autoScrollBrakingStartPosition,t._getContentPosition()),!0}else t._autoScrollCurrentlyOutOfBoundary=!1;return!1}_processAutoScrolling(t){const e=this,i=e._isNecessaryAutoScrollBrake(),s=i?.05:1;e._autoScrollAccumulatedTime+=t*(1/s);let r=Math.min(1,e._autoScrollAccumulatedTime/e._autoScrollTotalTime);var n;e._autoScrollAttenuate&&(n=r,r=(n-=1)*n*n*n*n+1);const o=e._autoScrollTargetDelta.clone();o.multiplyScalar(r);const a=e._autoScrollStartPosition.clone();a.add(o);let h=Math.abs(r-1)<=tFt;if(Math.abs(r-1)<=e.getScrollEndedEventTiming()&&!e._isScrollEndedWithThresholdEventFired&&(e._dispatchEvent("scroll-ended-with-threshold"),e._isScrollEndedWithThresholdEventFired=!0),e.elastic){const t=a.clone();t.subtract(e._autoScrollBrakingStartPosition),i&&t.multiplyScalar(s),a.set(e._autoScrollBrakingStartPosition),a.add(t)}else{const t=a.clone();t.subtract(e.getContentPosition());const i=e._getHowMuchOutOfBoundary(t);i.equals(Ms.ZERO,tFt)||(a.add(i),h=!0)}h&&(e._autoScrolling=!1);const l=a.clone();l.subtract(e._getContentPosition()),e._clampDelta(l),e._moveContent(l,h),e._dispatchEvent("scrolling"),e._autoScrolling||(e._isBouncing=!1,e._scrolling=!1,e._dispatchEvent("scroll-ended"))}_checkMouseWheel(t){const e=this;if(!e._getHowMuchOutOfBoundary().equals(Ms.ZERO,tFt))return e._processInertiaScroll(),e._scrolling&&(e._scrolling=!1,e._autoScrolling||e._dispatchEvent("scroll-ended")),e.unschedule(e._checkMouseWheel),void(e._stopMouseWheel=!1);e._mouseWheelEventElapsedTime+=t,e._mouseWheelEventElapsedTime>.1&&(e._onScrollBarTouchEnded(),e._scrolling&&(e._scrolling=!1,e._autoScrolling||e._dispatchEvent("scroll-ended")),e.unschedule(e._checkMouseWheel),e._stopMouseWheel=!1)}_calculateMovePercentDelta(t){const e=t.anchor,i=t.applyToHorizontal,s=t.applyToVertical,r=this;r._calculateBoundary(),e.clampf(kr.ZERO,kr.ONE);let n=r._getContentBottomBoundary()-r._bottomBoundary;n=-n;let o=r._getContentLeftBoundary()-r._leftBoundary;o=-o;const a=new Ms;if(r._content&&r.view){let t=0;const h=r._content._getUITransformComp().contentSize,l=r.view.contentSize;i&&(t=h.width-l.width,a.x=o-t*e.x),s&&(t=h.height-l.height,a.y=n-t*e.y)}return a}_moveContentToTopLeft(t){const e=this;let i=e._getContentBottomBoundary()-e._bottomBoundary;i=-i;const s=new Ms;let r=0,n=e._getContentLeftBoundary()-e._leftBoundary;if(n=-n,e._content){const o=e._content._getUITransformComp().contentSize;o.height<t.height&&(r=o.height-t.height,s.y=i-r),o.width<t.width&&(r=o.width-t.width,s.x=n)}e._updateScrollBarState(),e._moveContent(s),e._adjustContentOutOfBoundary()}_scaleChanged(t){4===t&&this._calculateBoundary()}_xrHoverEnter(t){}_xrHoverExit(t){}_dispatchEventHandleInput(t){t instanceof Mf?t.gamepad:t instanceof Pf&&t.handleInputDevice,this.enabledInHierarchy}_xrThumbStickMove(t){const e=this;if(!e.enabledInHierarchy)return;const i=t.y,s=eFt;e.vertical?s.set(0,-62.5*i,0):e.horizontal&&s.set(-62.5*i,0,0),e._mouseWheelEventElapsedTime=0,e._deltaAmount.add(s),e._stopMouseWheel||(e._handlePressLogic(),e.schedule(e._checkMouseWheel,1/60,NaN,0),e._stopMouseWheel=!0)}},JBt.EventType=lFt,jBt=Za((VBt=JBt).prototype,"bounceDuration",[vh],(function(){return 1})),HBt=Za(VBt.prototype,"brake",[vh],(function(){return.5})),GBt=Za(VBt.prototype,"elastic",[vh],(function(){return!0})),WBt=Za(VBt.prototype,"inertia",[vh],(function(){return!0})),s(VBt.prototype,"content",[NBt],Object.getOwnPropertyDescriptor(VBt.prototype,"content"),VBt.prototype),XBt=Za(VBt.prototype,"horizontal",[vh],(function(){return!0})),s(VBt.prototype,"horizontalScrollBar",[LBt],Object.getOwnPropertyDescriptor(VBt.prototype,"horizontalScrollBar"),VBt.prototype),YBt=Za(VBt.prototype,"vertical",[vh],(function(){return!0})),s(VBt.prototype,"verticalScrollBar",[kBt],Object.getOwnPropertyDescriptor(VBt.prototype,"verticalScrollBar"),VBt.prototype),qBt=Za(VBt.prototype,"cancelInnerEvents",[vh],(function(){return!0})),$Bt=Za(VBt.prototype,"scrollEvents",[zBt,vh],(function(){return[]})),KBt=Za(VBt.prototype,"_content",[vh],(function(){return null})),ZBt=Za(VBt.prototype,"_horizontalScrollBar",[vh],(function(){return null})),QBt=Za(VBt.prototype,"_verticalScrollBar",[vh],(function(){return null})),UBt=VBt))||UBt)||UBt)||UBt);var uFt,dFt,_Ft,pFt,mFt,gFt,fFt,yFt,bFt,vFt,SFt,TFt,wFt;t({ScrollView:cFt,ScrollViewComponent:cFt}),h.ScrollView=cFt;const xFt=new Ms,CFt={Horizontal:0,Vertical:1};fe(CFt);let AFt=(uFt=ah("cc.Slider"),dFt=lh(110),_Ft=hh(RI),pFt=Xh(CP),mFt=Xh(CFt),gFt=Xh([Um]),uFt(fFt=dFt(fFt=_Ft((wFt=class extends Km{get handle(){return this._handle}set handle(t){this._handle!==t&&(this._handle=t)}get direction(){return this._direction}set direction(t){this._direction!==t&&(this._direction=t,this._changeLayout())}get progress(){return this._progress}set progress(t){this._progress!==t&&(this._progress=t,this._updateHandlePosition())}constructor(){super(),this.slideEvents=bFt&&bFt(),this._handle=vFt&&vFt(),this._direction=SFt&&SFt(),this._progress=TFt&&TFt(),this._offset=new Ms,this._dragging=!1,this._touchHandle=!1,this._handleLocalPos=new Ms,this._touchPos=new Ms}__preload(){this._updateHandlePosition()}onEnable(){const t=this,e=t.node,i=t._handle;if(t._updateHandlePosition(),e.on("touch-start",t._onTouchBegan,t),e.on("touch-move",t._onTouchMoved,t),e.on("touch-end",t._onTouchEnded,t),e.on("touch-cancel",t._onTouchCancelled,t),i&&i.isValid){const e=i.node;e.on("touch-start",t._onHandleDragStart,t),e.on("touch-move",t._onTouchMoved,t),e.on("touch-end",t._onTouchEnded,t)}}onDisable(){const t=this,e=t.node,i=t._handle;if(e.off("touch-start",t._onTouchBegan,t),e.off("touch-move",t._onTouchMoved,t),e.off("touch-end",t._onTouchEnded,t),e.off("touch-cancel",t._onTouchCancelled,t),i&&i.isValid){const e=i.node;e.off("touch-start",t._onHandleDragStart,t),e.off("touch-move",t._onTouchMoved,t),e.off("touch-end",t._onTouchEnded,t)}}_onHandleDragStart(t){if(!t||!this._handle||!this._handle.node._getUITransformComp())return;this._dragging=!0,this._touchHandle=!0;const e=t.touch.getUILocation();Ms.set(this._touchPos,e.x,e.y,0),this._handle.node._getUITransformComp().convertToNodeSpaceAR(this._touchPos,this._offset),t.propagationStopped=!0}_onTouchBegan(t){this._handle&&t&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.propagationStopped=!0)}_onTouchMoved(t){this._dragging&&t&&(this._handleSliderLogic(t.touch),t.propagationStopped=!0)}_onTouchEnded(t){this._dragging=!1,this._touchHandle=!1,this._offset=new Ms,t&&(t.propagationStopped=!0)}_onTouchCancelled(t){this._dragging=!1,t&&(t.propagationStopped=!0)}_handleSliderLogic(t){this._updateProgress(t),this._emitSlideEvent()}_emitSlideEvent(){Um.emitEvents(this.slideEvents,this),this.node.emit("slide",this)}_updateProgress(t){if(!this._handle||!t)return;const e=t.getUILocation();Ms.set(this._touchPos,e.x,e.y,0);const i=this.node._getUITransformComp(),s=i.convertToNodeSpaceAR(this._touchPos,xFt);0===this.direction?this.progress=Bi(.5+(s.x-this._offset.x)/i.width):this.progress=Bi(.5+(s.y-this._offset.y)/i.height)}_updateHandlePosition(){if(!this._handle)return;this._handleLocalPos.set(this._handle.node.position);const t=this.node._getUITransformComp();0===this._direction?this._handleLocalPos.x=-t.width*t.anchorX+this.progress*t.width:this._handleLocalPos.y=-t.height*t.anchorY+this.progress*t.height,this._handle.node.setPosition(this._handleLocalPos)}_changeLayout(){const t=this.node._getUITransformComp(),e=t.contentSize;if(t.setContentSize(e.height,e.width),this._handle){const t=this._handle.node.position;0===this._direction?this._handle.node.setPosition(t.x,0,t.z):this._handle.node.setPosition(0,t.y,t.z),this._updateHandlePosition()}}_xrHandleProgress(t){}_xrClick(t){}_xrUnClick(){}_xrHoverStay(t){}},wFt.Direction=CFt,s((yFt=wFt).prototype,"handle",[pFt],Object.getOwnPropertyDescriptor(yFt.prototype,"handle"),yFt.prototype),s(yFt.prototype,"direction",[mFt],Object.getOwnPropertyDescriptor(yFt.prototype,"direction"),yFt.prototype),bFt=Za(yFt.prototype,"slideEvents",[gFt,vh],(function(){return[]})),vFt=Za(yFt.prototype,"_handle",[vh],(function(){return null})),SFt=Za(yFt.prototype,"_direction",[vh],(function(){return 0})),TFt=Za(yFt.prototype,"_progress",[vh],(function(){return.1})),fFt=yFt))||fFt)||fFt)||fFt);function DFt(...t){return Object.assign({},...t)}var EFt,IFt,MFt,PFt,OFt,RFt,BFt,FFt,NFt,LFt,kFt;t({Slider:AFt,SliderComponent:AFt}),h.Slider=AFt;let zFt=(EFt=ah("cc.Toggle"),IFt=lh(110),MFt=hh(RI),PFt=Xh(CP),OFt=Xh([Um]),EFt(RFt=IFt(RFt=MFt((kFt=class t extends ROt{get isChecked(){return this._isChecked}set isChecked(t){this._set(t)}get checkMark(){return this._checkMark}set checkMark(t){this._checkMark!==t&&(this._checkMark=t)}set _resizeToTarget(t){t&&this._resizeNodeToTargetNode()}get _toggleContainer(){const t=this.node.parent;return h.Node.isNode(t)?t.getComponent("cc.ToggleContainer"):null}constructor(){super(),this.checkEvents=FFt&&FFt(),this._isChecked=NFt&&NFt(),this._checkMark=LFt&&LFt()}_internalToggle(){this.isChecked=!this.isChecked}_set(t,e=!0){if(this._isChecked==t)return;this._isChecked=t;const i=this._toggleContainer;i&&i.enabled&&this.enabled&&(t||!i.anyTogglesChecked()&&!i.allowSwitchOff)&&(this._isChecked=!0,i.notifyToggleCheck(this,e)),this.playEffect(),e&&this._emitToggleEvents()}playEffect(){this._checkMark&&(this._checkMark.node.active=this._isChecked)}setIsCheckedWithoutNotify(t){this._set(t,!1)}onEnable(){super.onEnable(),this.playEffect(),this.node.on(t.EventType.CLICK,this._internalToggle,this)}onDisable(){super.onDisable(),this.node.off(t.EventType.CLICK,this._internalToggle,this)}_emitToggleEvents(){this.node.emit(t.EventType.TOGGLE,this),this.checkEvents&&Um.emitEvents(this.checkEvents,this)}},kFt.EventType=DFt({TOGGLE:"toggle"},OOt),s((BFt=kFt).prototype,"checkMark",[PFt],Object.getOwnPropertyDescriptor(BFt.prototype,"checkMark"),BFt.prototype),FFt=Za(BFt.prototype,"checkEvents",[OFt,vh],(function(){return[]})),NFt=Za(BFt.prototype,"_isChecked",[vh],(function(){return!0})),LFt=Za(BFt.prototype,"_checkMark",[vh],(function(){return null})),RFt=BFt))||RFt)||RFt)||RFt);var UFt,VFt,jFt,HFt,GFt,WFt,XFt;t({Toggle:zFt,ToggleComponent:zFt}),h.Toggle=zFt;let YFt=(UFt=ah("cc.ToggleContainer"),VFt=lh(110),jFt=Xh([Um]),UFt(HFt=VFt((GFt=class extends Km{get allowSwitchOff(){return this._allowSwitchOff}set allowSwitchOff(t){this._allowSwitchOff=t}constructor(){super(),this._allowSwitchOff=WFt&&WFt(),this.checkEvents=XFt&&XFt()}get toggleItems(){return this.node.children.map((t=>{const e=t.getComponent("cc.Toggle");return e&&e.enabled?e:null})).filter(Boolean)}onEnable(){this.ensureValidState(),this.node.on("child-added",this.ensureValidState,this),this.node.on("child-removed",this.ensureValidState,this)}onDisable(){this.node.off("child-added",this.ensureValidState,this),this.node.off("child-removed",this.ensureValidState,this)}activeToggles(){return this.toggleItems.filter((t=>t.isChecked))}anyTogglesChecked(){return!!this.toggleItems.find((t=>t.isChecked))}notifyToggleCheck(t,e=!0){if(this.enabledInHierarchy){for(let i=0;i<this.toggleItems.length;i++){const s=this.toggleItems[i];s!==t&&(e?s.isChecked=!1:s.setIsCheckedWithoutNotify(!1))}this.checkEvents&&h.Component.EventHandler.emitEvents(this.checkEvents,t)}}ensureValidState(){const t=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==t.length){const e=t[0];e.isChecked=!0,this.notifyToggleCheck(e)}const e=this.activeToggles();if(e.length>1){const t=e[0];for(let i=0;i<e.length;++i){const s=e[i];s!==t&&(s.isChecked=!1)}}}},WFt=Za(GFt.prototype,"_allowSwitchOff",[vh],(function(){return!1})),XFt=Za(GFt.prototype,"checkEvents",[jFt,vh],(function(){return[]})),HFt=GFt))||HFt)||HFt);var qFt,$Ft,KFt,ZFt,QFt,JFt,tNt,eNt,iNt,sNt,rNt,nNt,oNt,aNt,hNt,lNt,cNt,uNt,dNt,_Nt,pNt,mNt,gNt,fNt,yNt,bNt;t({ToggleContainer:YFt,ToggleContainerComponent:YFt}),h.ToggleContainer=YFt;const vNt=new kr;function SNt(t){const e=t._getUITransformComp();return t instanceof fT?fa:e?e.contentSize:Vr.ZERO}function TNt(t,e,i,s){t.parent?vNt.set(t.parent.scale.x,t.parent.scale.y):vNt.set(0,0);let r=vNt.x,n=vNt.y,o=0,a=0;for(let h=t.parent;;){if(!h)return i.x=i.y=0,void(s.x=s.y=1);const t=h.position;if(o+=t.x,a+=t.y,h=h.parent,h===e)break;{h?vNt.set(h.scale.x,h.scale.y):vNt.set(0,0);const t=vNt.x,e=vNt.y;o*=t,a*=e,r*=t,n*=e}}s.x=0!==r?1/r:1,s.y=0!==n?1/n:1,i.x=-o,i.y=-a}const wNt={ONCE:0,ALWAYS:1,ON_WINDOW_RESIZE:2};fe(wNt);const xNt={TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32,HORIZONTAL:56,VERTICAL:7};let CNt=(qFt=ah("cc.Widget"),$Ft=lh(110),KFt=hh(RI),ZFt=Xh(tb),QFt=Xh(wNt),qFt(JFt=$Ft(JFt=KFt((bNt=class extends Km{constructor(){super(),this._lastPos=new Ms,this._lastSize=new Vr,this._dirty=!0,this._hadAlignOnce=!1,this._alignFlags=eNt&&eNt(),this._target=iNt&&iNt(),this._left=sNt&&sNt(),this._right=rNt&&rNt(),this._top=nNt&&nNt(),this._bottom=oNt&&oNt(),this._horizontalCenter=aNt&&aNt(),this._verticalCenter=hNt&&hNt(),this._isAbsLeft=lNt&&lNt(),this._isAbsRight=cNt&&cNt(),this._isAbsTop=uNt&&uNt(),this._isAbsBottom=dNt&&dNt(),this._isAbsHorizontalCenter=_Nt&&_Nt(),this._isAbsVerticalCenter=pNt&&pNt(),this._originalWidth=mNt&&mNt(),this._originalHeight=gNt&&gNt(),this._alignMode=fNt&&fNt(),this._lockFlags=yNt&&yNt()}get target(){return this._target}set target(t){this._target!==t&&(this._unregisterTargetEvents(),this._target=t,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}get isAlignTop(){return(1&this._alignFlags)>0}set isAlignTop(t){this._setAlign(1,t),this._recursiveDirty()}get isAlignBottom(){return(4&this._alignFlags)>0}set isAlignBottom(t){this._setAlign(4,t),this._recursiveDirty()}get isAlignLeft(){return(8&this._alignFlags)>0}set isAlignLeft(t){this._setAlign(8,t),this._recursiveDirty()}get isAlignRight(){return(32&this._alignFlags)>0}set isAlignRight(t){this._setAlign(32,t),this._recursiveDirty()}get isAlignVerticalCenter(){return(2&this._alignFlags)>0}set isAlignVerticalCenter(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=2):this._alignFlags&=-3,this._recursiveDirty()}get isAlignHorizontalCenter(){return(16&this._alignFlags)>0}set isAlignHorizontalCenter(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=16):this._alignFlags&=-17,this._recursiveDirty()}get isStretchWidth(){return!(40&~this._alignFlags)}get isStretchHeight(){return!(5&~this._alignFlags)}get top(){return this._top}set top(t){this._top=t,this._recursiveDirty()}get editorTop(){return this._isAbsTop?this._top:100*this._top}set editorTop(t){this._top=this._isAbsTop?t:t/100,this._recursiveDirty()}get bottom(){return this._bottom}set bottom(t){this._bottom=t,this._recursiveDirty()}get editorBottom(){return this._isAbsBottom?this._bottom:100*this._bottom}set editorBottom(t){this._bottom=this._isAbsBottom?t:t/100,this._recursiveDirty()}get left(){return this._left}set left(t){this._left=t,this._recursiveDirty()}get editorLeft(){return this._isAbsLeft?this._left:100*this._left}set editorLeft(t){this._left=this._isAbsLeft?t:t/100,this._recursiveDirty()}get right(){return this._right}set right(t){this._right=t,this._recursiveDirty()}get editorRight(){return this._isAbsRight?this._right:100*this._right}set editorRight(t){this._right=this._isAbsRight?t:t/100,this._recursiveDirty()}get horizontalCenter(){return this._horizontalCenter}set horizontalCenter(t){this._horizontalCenter=t,this._recursiveDirty()}get editorHorizontalCenter(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter}set editorHorizontalCenter(t){this._horizontalCenter=this._isAbsHorizontalCenter?t:t/100,this._recursiveDirty()}get verticalCenter(){return this._verticalCenter}set verticalCenter(t){this._verticalCenter=t,this._recursiveDirty()}get editorVerticalCenter(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter}set editorVerticalCenter(t){this._verticalCenter=this._isAbsVerticalCenter?t:t/100,this._recursiveDirty()}get isAbsoluteTop(){return this._isAbsTop}set isAbsoluteTop(t){this._isAbsTop!==t&&(this._isAbsTop=t,this._autoChangedValue(1,this._isAbsTop))}get isAbsoluteBottom(){return this._isAbsBottom}set isAbsoluteBottom(t){this._isAbsBottom!==t&&(this._isAbsBottom=t,this._autoChangedValue(4,this._isAbsBottom))}get isAbsoluteLeft(){return this._isAbsLeft}set isAbsoluteLeft(t){this._isAbsLeft!==t&&(this._isAbsLeft=t,this._autoChangedValue(8,this._isAbsLeft))}get isAbsoluteRight(){return this._isAbsRight}set isAbsoluteRight(t){this._isAbsRight!==t&&(this._isAbsRight=t,this._autoChangedValue(32,this._isAbsRight))}get isAbsoluteHorizontalCenter(){return this._isAbsHorizontalCenter}set isAbsoluteHorizontalCenter(t){this._isAbsHorizontalCenter!==t&&(this._isAbsHorizontalCenter=t,this._autoChangedValue(16,this._isAbsHorizontalCenter))}get isAbsoluteVerticalCenter(){return this._isAbsVerticalCenter}set isAbsoluteVerticalCenter(t){this._isAbsVerticalCenter!==t&&(this._isAbsVerticalCenter=t,this._autoChangedValue(2,this._isAbsVerticalCenter))}get alignMode(){return this._alignMode}set alignMode(t){this._alignMode=t,this._recursiveDirty()}get alignFlags(){return this._alignFlags}set alignFlags(t){this._alignFlags!==t&&(this._alignFlags=t,this._recursiveDirty())}updateAlignment(){a._widgetManager.updateAlignment(this.node)}_validateTargetInDEV(){}setDirty(){this._recursiveDirty()}onEnable(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._getUITransformComp().contentSize),a._widgetManager.add(this),this._hadAlignOnce=!1,this._registerEvent(),this._registerTargetEvents()}onDisable(){a._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()}onDestroy(){this._removeParentEvent()}_adjustWidgetToAllowMovingInEditor(t){}_adjustWidgetToAllowResizingInEditor(){}_adjustWidgetToAnchorChanged(){this.setDirty()}_adjustTargetToParentChanged(t){t&&this._unregisterOldParentEvents(t),this.node.getParent()&&this._registerTargetEvents(),this._setDirtyByMode()}_registerEvent(){this.node.on("transform-changed",this._setDirtyByMode,this),this.node.on("size-changed",this._setDirtyByMode,this),this.node.on("anchor-changed",this._adjustWidgetToAnchorChanged,this),this.node.on("parent-changed",this._adjustTargetToParentChanged,this)}_unregisterEvent(){this.node.off("transform-changed",this._setDirtyByMode,this),this.node.off("size-changed",this._setDirtyByMode,this),this.node.off("anchor-changed",this._adjustWidgetToAnchorChanged,this)}_removeParentEvent(){this.node.off("parent-changed",this._adjustTargetToParentChanged,this)}_autoChangedValue(t,e){if(!((this._alignFlags&t)>0))return;const i=this.node.parent&&this.node.parent._uiProps,s=i&&i.uiTransformComp,r=s?s.contentSize:fa;this.isAlignLeft&&8===t?this._left=e?this._left*r.width:this._left/r.width:this.isAlignRight&&32===t?this._right=e?this._right*r.width:this._right/r.width:this.isAlignHorizontalCenter&&16===t?this._horizontalCenter=e?this._horizontalCenter*r.width:this._horizontalCenter/r.width:this.isAlignTop&&1===t?this._top=e?this._top*r.height:this._top/r.height:this.isAlignBottom&&4===t?this._bottom=e?this._bottom*r.height:this._bottom/r.height:this.isAbsoluteVerticalCenter&&2===t&&(this._verticalCenter=this._verticalCenter/r.height),this._recursiveDirty()}_registerTargetEvents(){const t=this._target||this.node.parent;t&&t.getComponent(RI)&&(t.on("transform-changed",this._setDirtyByMode,this),t.on("size-changed",this._setDirtyByMode,this),t.on("anchor-changed",this._setDirtyByMode,this))}_unregisterTargetEvents(){const t=this._target||this.node.parent;t&&(t.off("transform-changed",this._setDirtyByMode,this),t.off("size-changed",this._setDirtyByMode,this),t.off("anchor-changed",this._setDirtyByMode,this))}_unregisterOldParentEvents(t){const e=this._target||t;e&&(e.off("transform-changed",this._setDirtyByMode,this),e.off("size-changed",this._setDirtyByMode,this),e.off("anchor-changed",this._setDirtyByMode,this))}_setDirtyByMode(){1===this.alignMode&&this._recursiveDirty()}_setAlign(t,e){if(e===(this._alignFlags&t)>0)return;const i=(40&t)>0,s=this.node._getUITransformComp();e?(this._alignFlags|=t,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=s.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=s.height))):(i?this.isStretchWidth&&(s.width=this._originalWidth):this.isStretchHeight&&(s.height=this._originalHeight),this._alignFlags&=~t)}_recursiveDirty(){this._dirty||(this._dirty=!0)}},bNt.AlignMode=wNt,s((tNt=bNt).prototype,"target",[ZFt],Object.getOwnPropertyDescriptor(tNt.prototype,"target"),tNt.prototype),s(tNt.prototype,"alignMode",[QFt],Object.getOwnPropertyDescriptor(tNt.prototype,"alignMode"),tNt.prototype),eNt=Za(tNt.prototype,"_alignFlags",[vh],(function(){return 0})),iNt=Za(tNt.prototype,"_target",[vh],(function(){return null})),sNt=Za(tNt.prototype,"_left",[vh],(function(){return 0})),rNt=Za(tNt.prototype,"_right",[vh],(function(){return 0})),nNt=Za(tNt.prototype,"_top",[vh],(function(){return 0})),oNt=Za(tNt.prototype,"_bottom",[vh],(function(){return 0})),aNt=Za(tNt.prototype,"_horizontalCenter",[vh],(function(){return 0})),hNt=Za(tNt.prototype,"_verticalCenter",[vh],(function(){return 0})),lNt=Za(tNt.prototype,"_isAbsLeft",[vh],(function(){return!0})),cNt=Za(tNt.prototype,"_isAbsRight",[vh],(function(){return!0})),uNt=Za(tNt.prototype,"_isAbsTop",[vh],(function(){return!0})),dNt=Za(tNt.prototype,"_isAbsBottom",[vh],(function(){return!0})),_Nt=Za(tNt.prototype,"_isAbsHorizontalCenter",[vh],(function(){return!0})),pNt=Za(tNt.prototype,"_isAbsVerticalCenter",[vh],(function(){return!0})),mNt=Za(tNt.prototype,"_originalWidth",[vh],(function(){return 0})),gNt=Za(tNt.prototype,"_originalHeight",[vh],(function(){return 0})),fNt=Za(tNt.prototype,"_alignMode",[vh],(function(){return 2})),yNt=Za(tNt.prototype,"_lockFlags",[vh,Th],(function(){return 0})),JFt=tNt))||JFt)||JFt)||JFt);var ANt,DNt,ENt,INt,MNt,PNt,ONt,RNt,BNt,FNt,NNt,LNt;t({Widget:CNt,WidgetComponent:CNt}),a.internal.computeInverseTransForTarget=TNt,a.internal.getReadonlyNodeSize=SNt,a.Widget=CNt;const kNt=new Ls,zNt={HORIZONTAL:0,VERTICAL:1};fe(zNt);let UNt=(ANt=ah("cc.PageViewIndicator"),DNt=lh(110),ENt=Xh(yD),INt=Xh(zNt),MNt=Xh(Vr),ANt(PNt=DNt((LNt=class extends Km{get spriteFrame(){return this._spriteFrame}set spriteFrame(t){this._spriteFrame!==t&&(this._spriteFrame=t)}get direction(){return this._direction}set direction(t){this._direction!==t&&(this._direction=t)}get cellSize(){return this._cellSize}set cellSize(t){this._cellSize!==t&&(this._cellSize=t)}constructor(){super(),this.spacing=RNt&&RNt(),this._spriteFrame=BNt&&BNt(),this._direction=FNt&&FNt(),this._cellSize=NNt&&NNt(),this._layout=null,this._pageView=null,this._indicators=[]}onLoad(){this._updateLayout()}setPageView(t){this._pageView=t,this._refresh()}_updateLayout(){this._layout=this.getComponent(qRt),this._layout||(this._layout=this.addComponent(qRt));const t=this._layout;0===this.direction?(t.type=1,t.spacingX=this.spacing):1===this.direction&&(t.type=2,t.spacingY=this.spacing),t.resizeMode=1}_createIndicator(){const t=new tb;t.layer=this.node.layer;const e=t.addComponent(CP);return e.spriteFrame=this.spriteFrame,e.sizeMode=0,t.parent=this.node,t._getUITransformComp().setContentSize(this._cellSize),t}_changedState(){const t=this._indicators;if(0===t.length||!this._pageView)return;const e=this._pageView.curPageIdx;if(!(e>=t.length)){for(let e=0;e<t.length;++e){const i=t[e];if(!i._uiProps.uiComp)continue;const s=i._uiProps.uiComp;kNt.set(s.color),kNt.a=127.5,s.color=kNt}if(t[e]._uiProps.uiComp){const i=t[e]._uiProps.uiComp;kNt.set(i.color),kNt.a=255,i.color=kNt}}}_refresh(){if(!this._pageView)return;const t=this._indicators,e=this._pageView.getPages();if(e.length===t.length)return;let i=0;if(e.length>t.length)for(i=0;i<e.length;++i)t[i]||(t[i]=this._createIndicator());else for(i=t.length-e.length;i>0;--i){const e=t[i-1];this.node.removeChild(e),t.splice(i-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}},LNt.Direction=zNt,s((ONt=LNt).prototype,"spriteFrame",[ENt],Object.getOwnPropertyDescriptor(ONt.prototype,"spriteFrame"),ONt.prototype),s(ONt.prototype,"direction",[INt],Object.getOwnPropertyDescriptor(ONt.prototype,"direction"),ONt.prototype),s(ONt.prototype,"cellSize",[MNt],Object.getOwnPropertyDescriptor(ONt.prototype,"cellSize"),ONt.prototype),RNt=Za(ONt.prototype,"spacing",[vh],(function(){return 0})),BNt=Za(ONt.prototype,"_spriteFrame",[vh],(function(){return null})),FNt=Za(ONt.prototype,"_direction",[vh],(function(){return 0})),NNt=Za(ONt.prototype,"_cellSize",[vh],(function(){return new Vr(20,20)})),PNt=ONt))||PNt)||PNt);var VNt,jNt,HNt,GNt,WNt,XNt,YNt,qNt,$Nt,KNt,ZNt,QNt,JNt,tLt,eLt,iLt,sLt,rLt,nLt,oLt,aLt,hLt,lLt,cLt;t({PageViewIndicator:UNt,PageViewIndicatorComponent:UNt}),h.PageViewIndicator=UNt;const uLt=new kr,dLt={Unified:0,Free:1};fe(dLt);const _Lt={HORIZONTAL:0,VERTICAL:1};fe(_Lt);let pLt=(VNt=ah("cc.PageView"),jNt=lh(110),HNt=Xh(dLt),GNt=Xh(_Lt),WNt=Xh(UNt),XNt=Xh(MBt),YNt=Xh(MBt),qNt=Xh([Um]),$Nt=Xh([Um]),VNt(KNt=jNt((cLt=class t extends cFt{get sizeMode(){return this._sizeMode}set sizeMode(t){this._sizeMode!==t&&(this._sizeMode=t,this._syncSizeMode())}get direction(){return this._direction}set direction(t){this._direction!==t&&(this._direction=t,this._syncScrollDirection())}get scrollThreshold(){return this._scrollThreshold}set scrollThreshold(t){this._scrollThreshold!==t&&(this._scrollThreshold=t)}get pageTurningEventTiming(){return this._pageTurningEventTiming}set pageTurningEventTiming(t){this._pageTurningEventTiming!==t&&(this._pageTurningEventTiming=t)}get indicator(){return this._indicator}set indicator(t){this._indicator!==t&&(this._indicator=t,this.indicator&&this.indicator.setPageView(this))}get curPageIdx(){return this._curPageIdx}get verticalScrollBar(){return super.verticalScrollBar}set verticalScrollBar(t){super.verticalScrollBar=t}get horizontalScrollBar(){return super.horizontalScrollBar}set horizontalScrollBar(t){super.horizontalScrollBar=t}constructor(){super(),this.autoPageTurningThreshold=QNt&&QNt(),this.horizontal=JNt&&JNt(),this.vertical=tLt&&tLt(),this.cancelInnerEvents=eLt&&eLt(),this.scrollEvents=iLt&&iLt(),this.pageTurningSpeed=sLt&&sLt(),this.pageEvents=rLt&&rLt(),this._sizeMode=nLt&&nLt(),this._direction=oLt&&oLt(),this._scrollThreshold=aLt&&aLt(),this._pageTurningEventTiming=hLt&&hLt(),this._indicator=lLt&&lLt(),this._curPageIdx=0,this._lastPageIdx=0,this._pages=[],this._initContentPos=Ps(),this._scrollCenterOffsetX=[],this._scrollCenterOffsetY=[],this._touchBeganPosition=zr(),this._touchEndPosition=zr()}onEnable(){super.onEnable(),this.node.on("size-changed",this._updateAllPagesSize,this),this.node.on(t.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)}onDisable(){super.onDisable(),this.node.off("size-changed",this._updateAllPagesSize,this),this.node.off(t.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)}onLoad(){this._initPages(),this.indicator&&this.indicator.setPageView(this)}getCurrentPageIndex(){return this._curPageIdx}setCurrentPageIndex(t){this.scrollToPage(t,1)}getPages(){return this._pages}addPage(t){t&&-1===this._pages.indexOf(t)&&this.content&&(t._getUITransformComp()?(this.content.addChild(t),this._pages.push(t),this._updatePageView()):k(4301))}insertPage(t,e){if(!(e<0)&&t&&-1===this._pages.indexOf(t)&&this.content)if(e>=this._pages.length)this.addPage(t);else{if(!t._getUITransformComp())return void k(4301);this._pages.splice(e,0,t),this.content.insertChild(t,e),this._updatePageView()}}removePage(t){if(!t||!this.content)return;const e=this._pages.indexOf(t);-1!==e?this.removePageAtIndex(e):j(4300,t.name)}removePageAtIndex(t){const e=this._pages;if(t<0||t>=e.length)return;const i=e[t];i&&this.content&&(this.content.removeChild(i),e.splice(t,1),this._updatePageView())}removeAllPages(){if(!this.content)return;const t=this._pages;for(let e=0,i=t.length;e<i;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}scrollToPage(t,e=.3){t<0||t>=this._pages.length||(this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())}getScrollEndedEventTiming(){return this.pageTurningEventTiming}_updatePageView(){if(!this.content)return;const t=this.content.getComponent(qRt);t&&t.enabled&&t.updateLayout();const e=this._pages.length;this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx);const i=this._initContentPos;for(let t=0;t<e;++t){const e=this._pages[t].position;0===this.direction?this._scrollCenterOffsetX[t]=Math.abs(i.x+e.x):this._scrollCenterOffsetY[t]=Math.abs(i.y+e.y)}this.indicator&&this.indicator._refresh()}_updateAllPagesSize(){const t=this.view;if(!this.content||!t)return;if(0!==this._sizeMode)return;const e=this._pages,i=t.contentSize;for(let t=0,s=e.length;t<s;t++)e[t]._getUITransformComp().setContentSize(i)}_handleReleaseLogic(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(t.EventType.SCROLL_ENDED))}_onTouchBegan(t,e){t.touch.getUILocation(uLt),kr.set(this._touchBeganPosition,uLt.x,uLt.y),super._onTouchBegan(t,e)}_onTouchMoved(t,e){super._onTouchMoved(t,e)}_onTouchEnded(t,e){t.touch.getUILocation(uLt),kr.set(this._touchEndPosition,uLt.x,uLt.y),super._onTouchEnded(t,e)}_onTouchCancelled(t,e){t.touch.getUILocation(uLt),kr.set(this._touchEndPosition,uLt.x,uLt.y),super._onTouchCancelled(t,e)}_onMouseWheel(){}_syncScrollDirection(){this.horizontal=0===this.direction,this.vertical=1===this.direction}_syncSizeMode(){const t=this.view;if(!this.content||!t)return;const e=this.content.getComponent(qRt);if(e){if(1===this._sizeMode&&this._pages.length>0){const i=this._pages[0]._getUITransformComp(),s=this._pages[this._pages.length-1]._getUITransformComp();0===this.direction?(e.paddingLeft=(t.width-i.width)/2,e.paddingRight=(t.width-s.width)/2):1===this.direction&&(e.paddingTop=(t.height-i.height)/2,e.paddingBottom=(t.height-s.height)/2)}e.updateLayout()}}_initPages(){if(!this.content)return;this._initContentPos=this.content.position;const t=this.content.children;for(let e=0;e<t.length;++e){const i=t[e];this._pages.indexOf(i)>=0||this._pages.push(i)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}_dispatchPageTurningEvent(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,Um.emitEvents(this.pageEvents,this,"page-turning"),this.node.emit("page-turning",this))}_isQuicklyScrollable(t){if(0===this.direction){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(1===this.direction&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1}_moveOffsetValue(t){const e=new kr;if(1===this._sizeMode)0===this.direction?e.x=this._scrollCenterOffsetX[t]:1===this.direction&&(e.y=this._scrollCenterOffsetY[t]);else{const i=this.view;if(!i)return e;0===this.direction?e.x=t*i.width:1===this.direction&&(e.y=t*i.height)}return e}_getDragDirection(t){return 0===this._direction?0===t.x?0:t.x>0?1:-1:0===t.y?0:t.y<0?1:-1}_isScrollable(t,e,i){if(1===this._sizeMode){let s=0,r=0;if(0===this.direction)return s=this._scrollCenterOffsetX[e],r=this._scrollCenterOffsetX[i],Math.abs(t.x)>=Math.abs(s-r)*this.scrollThreshold;if(1===this.direction)return s=this._scrollCenterOffsetY[e],r=this._scrollCenterOffsetY[i],Math.abs(t.y)>=Math.abs(s-r)*this.scrollThreshold}else{const e=this.view;if(!e)return!1;if(0===this.direction)return Math.abs(t.x)>=e.width*this.scrollThreshold;if(1===this.direction)return Math.abs(t.y)>=e.height*this.scrollThreshold}return!1}_autoScrollToPage(){if(this._startBounceBackIfNeeded()){const t=this._getHowMuchOutOfBoundary();this._clampDelta(t),(t.x>0||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||t.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{const t=new kr;kr.subtract(t,this._touchBeganPosition,this._touchEndPosition);const e=this._curPageIdx,i=e+this._getDragDirection(t),s=this.pageTurningSpeed*Math.abs(e-i);if(i<this._pages.length){if(this._isScrollable(t,e,i))return void this.scrollToPage(i,s);{const t=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(t))return void this.scrollToPage(i,s)}}this.scrollToPage(e,s)}}},cLt.SizeMode=dLt,cLt.Direction=_Lt,cLt.EventType=DFt({PAGE_TURNING:"page-turning"},lFt),s((ZNt=cLt).prototype,"sizeMode",[HNt],Object.getOwnPropertyDescriptor(ZNt.prototype,"sizeMode"),ZNt.prototype),s(ZNt.prototype,"direction",[GNt],Object.getOwnPropertyDescriptor(ZNt.prototype,"direction"),ZNt.prototype),s(ZNt.prototype,"indicator",[WNt],Object.getOwnPropertyDescriptor(ZNt.prototype,"indicator"),ZNt.prototype),QNt=Za(ZNt.prototype,"autoPageTurningThreshold",[vh],(function(){return 100})),s(ZNt.prototype,"verticalScrollBar",[XNt,Yh],Object.getOwnPropertyDescriptor(ZNt.prototype,"verticalScrollBar"),ZNt.prototype),s(ZNt.prototype,"horizontalScrollBar",[YNt,Yh],Object.getOwnPropertyDescriptor(ZNt.prototype,"horizontalScrollBar"),ZNt.prototype),JNt=Za(ZNt.prototype,"horizontal",[Yh,vh],(function(){return!0})),tLt=Za(ZNt.prototype,"vertical",[Yh,vh],(function(){return!0})),eLt=Za(ZNt.prototype,"cancelInnerEvents",[Yh,vh],(function(){return!0})),iLt=Za(ZNt.prototype,"scrollEvents",[qNt,vh,Yh],(function(){return[]})),sLt=Za(ZNt.prototype,"pageTurningSpeed",[vh],(function(){return.3})),rLt=Za(ZNt.prototype,"pageEvents",[$Nt,vh],(function(){return[]})),nLt=Za(ZNt.prototype,"_sizeMode",[vh],(function(){return 0})),oLt=Za(ZNt.prototype,"_direction",[vh],(function(){return 0})),aLt=Za(ZNt.prototype,"_scrollThreshold",[vh],(function(){return.5})),hLt=Za(ZNt.prototype,"_pageTurningEventTiming",[vh],(function(){return.1})),lLt=Za(ZNt.prototype,"_indicator",[vh],(function(){return null})),KNt=ZNt))||KNt)||KNt);t({PageView:pLt,PageViewComponent:pLt}),h.PageView=pLt;const mLt=new Ms,gLt=new kr,fLt=new kr,yLt=new kr(1,1),bLt=new kr,vLt=new kr;function SLt(t,e){if(e._hadAlignOnce)return;0===e.alignMode&&(e._hadAlignOnce=!0);const i=e.target;let s;const r=fLt,n=yLt;i?(s=i,TNt(t,s,r,n)):s=t.parent;const o=SNt(s),a=s instanceof fT||!s.getComponent(RI),h=a?gLt:s.getComponent(RI).anchorPoint,l=a;t.getPosition(mLt);const c=t._getUITransformComp();let u=mLt.x,d=mLt.y;const _=c.anchorPoint,p=t.scale;if(56&e.alignFlags){let t=0,s=0;const a=o.width;l?(t=fa.left.x,s=fa.right.x):(t=-h.x*a,s=t+a),t+=e.isAbsoluteLeft?e.left:e.left*a,s-=e.isAbsoluteRight?e.right:e.right*a,i&&(t+=r.x,t*=n.x,s+=r.x,s*=n.x);let d=0,m=_.x,g=p.x;if(g<0&&(m=1-m,g=-g),e.isStretchWidth)d=s-t,0!==g&&(c.width=d/g),u=t+m*d;else{if(d=c.width*g,e.isAlignHorizontalCenter){let t=e.isAbsoluteHorizontalCenter?e.horizontalCenter:e.horizontalCenter*a,s=(.5-h.x)*o.width;i&&(t*=n.x,s+=r.x,s*=n.x),u=s+(m-.5)*d+t}else u=e.isAlignLeft?t+m*d:s+(m-1)*d;Oi(g,0,Mi)?d=c.width:d/=g}e._lastSize.width=d}if(7&e.alignFlags){let t=0,s=0;const a=o.height;l?(s=fa.bottom.y,t=fa.top.y):(s=-h.y*a,t=s+a),s+=e.isAbsoluteBottom?e.bottom:e.bottom*a,t-=e.isAbsoluteTop?e.top:e.top*a,i&&(s+=r.y,s*=n.y,t+=r.y,t*=n.y);let u=0,m=_.y,g=p.y;if(g<0&&(m=1-m,g=-g),e.isStretchHeight)u=t-s,0!==g&&(c.height=u/g),d=s+m*u;else{if(u=c.height*g,e.isAlignVerticalCenter){let t=e.isAbsoluteVerticalCenter?e.verticalCenter:e.verticalCenter*a,s=(.5-h.y)*o.height;i&&(t*=n.y,s+=r.y,s*=n.y),d=s+(m-.5)*u+t}else d=e.isAlignBottom?s+m*u:t+(m-1)*u;Oi(g,0,Mi)?u=c.height:u/=g}e._lastSize.height=u}t.setPosition(u,d,mLt.z),Ms.set(e._lastPos,u,d,mLt.z)}function TLt(t){const e=t.getComponent(CNt);if(e&&e.enabled){if(!a.isValid(t,!0))return;xLt.push(e)}const i=t.children;for(const t of i)t.active&&TLt(t)}function wLt(){const t=nC.getScene();if(t){CLt.isAligning=!0,CLt._nodesOrderDirty&&(xLt.length=0,TLt(t),CLt._nodesOrderDirty=!1);let e=null;const i=CLt._activeWidgetsIterator;for(i.i=0;i.i<xLt.length;++i.i)e=xLt[i.i],e._dirty&&(SLt(e.node,e),e._dirty=!1);CLt.isAligning=!1}}const xLt=[],CLt=t("widgetManager",a._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new te(xLt),animationState:null,init(){nC.on("director_after_scene_launch",wLt),nC.on("director_after_update",wLt),jA.instance.on("design-resolution-changed",this.onResized,this);{const t=this.onResized.bind(this);jA.instance.on("canvas-resize",t),pa.on("window-resize",t)}},add(t){this._nodesOrderDirty=!0},remove(t){this._activeWidgetsIterator.remove(t)},onResized(){const t=nC.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized(t){const e=tb.isNode(t)&&t.getComponent(CNt);e&&e.enabled&&(2===e.alignMode||1===e.alignMode)&&e.setDirty();const i=t.children;for(const t of i)this.refreshWidgetOnResized(t)},updateOffsetsToStayPut(t,e){function i(t,e){return Math.abs(t-e)>1e-10?e:t}const s=t.node;let r=s.parent;if(r){const n=bLt;n.set(0,0);const o=vLt;if(o.set(1,1),t.target&&(r=t.target,TNt(s,r,n,o)),!e)return;const a=r._uiProps&&r._getUITransformComp(),h=a?a.anchorPoint:gLt,l=s._getUITransformComp(),c=SNt(r),u=l.anchorPoint,d=s.position,_=xNt,p=s.scale;let m=0;if(e&_.LEFT){let e=-h.x*c.width;e+=n.x,e*=o.x,m=d.x-u.x*l.width*Math.abs(p.x)-e,t.isAbsoluteLeft||(m/=c.width),m/=o.x,t.left=i(t.left,m)}if(e&_.RIGHT){let e=(1-h.x)*c.width;e+=n.x,m=(e*=o.x)-(d.x+(1-u.x)*l.width*Math.abs(p.x)),t.isAbsoluteRight||(m/=c.width),m/=o.x,t.right=i(t.right,m)}if(e&_.TOP){let e=(1-h.y)*c.height;e+=n.y,m=(e*=o.y)-(d.y+(1-u.y)*l.height*Math.abs(p.y)),t.isAbsoluteTop||(m/=c.height),m/=o.y,t.top=i(t.top,m)}if(e&_.BOT){let e=-h.y*c.height;e+=n.y,e*=o.y,m=d.y-u.y*l.height*Math.abs(p.y)-e,t.isAbsoluteBottom||(m/=c.height),m/=o.y,t.bottom=i(t.bottom,m)}}},updateAlignment:function t(e){const i=e.parent;i&&tb.isNode(i)&&t(i);const s=e.getComponent(CNt);s&&i&&SLt(e,s)},AlignMode:wNt,AlignFlags:xNt});var ALt,DLt,ELt;nC.on("director_init",(()=>{CLt.init()}));let ILt=ah("cc.SafeArea")(ALt=lh(110)(ALt=hh(CNt)((DLt=class extends Km{get symmetric(){return this._symmetric}set symmetric(t){this._symmetric=t}constructor(){super(),this._symmetric=ELt&&ELt()}onEnable(){this.updateArea(),pa.on("window-resize",this.updateArea,this),pa.on("orientation-change",this.updateArea,this)}onDisable(){pa.off("window-resize",this.updateArea,this),pa.off("orientation-change",this.updateArea,this)}updateArea(){const t=this.node.getComponent(CNt),e=this.node.getComponent(RI);if(!t||!e)return;t.updateAlignment();const i=this.node.position.clone(),s=e.anchorPoint.clone();t.isAlignTop=t.isAlignBottom=t.isAlignLeft=t.isAlignRight=!0;const r=XA.getVisibleSize(),n=r.width,o=r.height,a=ga.getSafeAreaRect(this._symmetric);t.top=o-a.y-a.height,t.bottom=a.y,t.left=a.x,t.right=n-a.x-a.width,t.updateAlignment();const h=this.node.position.clone(),l=s.x-(h.x-i.x)/e.width,c=s.y-(h.y-i.y)/e.height;e.setAnchorPoint(l,c),CLt.add(t)}},ELt=Za(DLt.prototype,"_symmetric",[vh],(function(){return!0})),ALt=DLt))||ALt)||ALt)||ALt;var MLt,PLt,OLt,RLt,BLt,FLt,NLt,LLt,kLt,zLt,ULt,VLt;t({SafeArea:ILt,SafeAreaComponent:ILt}),h.SafeArea=ILt;let jLt=(MLt=ah("cc.UICoordinateTracker"),PLt=lh(110),OLt=Xh(tb),RLt=Xh(gB),BLt=Xh([Um]),MLt(FLt=PLt((NLt=class extends Km{get target(){return this._target}set target(t){this._target!==t&&(this._target=t,this._checkCanMove())}get camera(){return this._camera}set camera(t){this._camera!==t&&(this._camera=t,this._checkCanMove())}get useScale(){return this._useScale}set useScale(t){this._useScale!==t&&(this._useScale=t)}get distance(){return this._distance}set distance(t){this._distance!==t&&(this._distance=t)}constructor(){super(),this.syncEvents=LLt&&LLt(),this._target=kLt&&kLt(),this._camera=zLt&&zLt(),this._useScale=ULt&&ULt(),this._distance=VLt&&VLt(),this._transformPos=Ps(),this._viewPos=Ps(),this._canMove=!0,this._lastWPos=Ps(),this._lastCameraPos=Ps()}onEnable(){this._checkCanMove()}update(){const t=this.node.worldPosition,e=this._camera;if(this._canMove&&e&&e.camera&&(!this._lastWPos.equals(t)||!this._lastCameraPos.equals(e.node.worldPosition))&&(this._lastWPos.set(t),this._lastCameraPos.set(e.node.worldPosition),e.camera.update(),e.convertToUINode(t,this._target,this._transformPos),this._useScale&&Ms.transformMat4(this._viewPos,this.node.worldPosition,e.camera.matView),this.syncEvents.length>0)){const t=this._distance/Math.abs(this._viewPos.z);Um.emitEvents(this.syncEvents,this._transformPos,t)}}_checkCanMove(){this._canMove=!(!this._camera||!this._target)}},s(NLt.prototype,"target",[OLt],Object.getOwnPropertyDescriptor(NLt.prototype,"target"),NLt.prototype),s(NLt.prototype,"camera",[RLt],Object.getOwnPropertyDescriptor(NLt.prototype,"camera"),NLt.prototype),LLt=Za(NLt.prototype,"syncEvents",[BLt,vh],(function(){return[]})),kLt=Za(NLt.prototype,"_target",[vh],(function(){return null})),zLt=Za(NLt.prototype,"_camera",[vh],(function(){return null})),ULt=Za(NLt.prototype,"_useScale",[vh],(function(){return!0})),VLt=Za(NLt.prototype,"_distance",[vh],(function(){return 1})),FLt=NLt))||FLt)||FLt);var HLt;t({UICoordinateTracker:jLt,UICoordinateTrackerComponent:jLt});const GLt=["touch-start","touch-end","touch-move","mouse-down","mouse-move","mouse-up","mouse-enter","mouse-leave","mouse-wheel"];function WLt(t){t.propagationStopped=!0}let XLt=ah("cc.BlockInputEvents")(HLt=class extends Km{onEnable(){for(let t=0;t<GLt.length;t++)this.node.on(GLt[t],WLt,this)}onDisable(){for(let t=0;t<GLt.length;t++)this.node.off(GLt[t],WLt,this)}})||HLt;var YLt,qLt,$Lt,KLt;t({BlockInputEvents:XLt,BlockInputEventsComponent:XLt});let ZLt=t("SubContextView",ah("cc.SubContextView")(YLt=lh(110)(YLt=hh(RI)((qLt=class extends Km{get designResolutionSize(){return this._designResolutionSize}set designResolutionSize(t){}get fps(){return this._fps}set fps(t){this._fps!==t&&(this._fps=t,this._updateInterval=1e3/t)}constructor(){super(),this._fps=$Lt&&$Lt(),this._sprite=null,this._imageAsset=new Sm,this._texture=new ff,this._updatedTime=0,this._updateInterval=0,this._openDataContext=null,this._content=new tb("content"),this._designResolutionSize=KLt&&KLt(),this._content.hideFlags|=1032,this._updatedTime=performance.now()}onLoad(){FD.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._openDataContext=FD.getOpenDataContext(),this._initSharedCanvas(),this._initContentNode(),this._updateSubContextView(),this._updateContentLayer()):this.enabled=!1}onEnable(){this._registerNodeEvent()}onDisable(){this._unregisterNodeEvent()}_initSharedCanvas(){if(this._openDataContext){const t=this._openDataContext.canvas;let e=this._designResolutionSize.width,i=this._designResolutionSize.height;t.width=e,t.height=i}}_initContentNode(){if(this._openDataContext){const t=this._openDataContext.canvas,e=this._imageAsset;if(e.reset(t),this._texture.image=e,this._texture.create(t.width,t.height),this._sprite=this._content.getComponent(CP),this._sprite||(this._sprite=this._content.addComponent(CP)),this._sprite.spriteFrame)this._sprite.spriteFrame.texture=this._texture;else{const t=new yD;t.texture=this._texture,this._sprite.spriteFrame=t}this._content.parent=this.node}}_updateSubContextView(){if(!this._openDataContext)return;const t=this.node.getComponent(RI),e=this._content.getComponent(RI),i=t.width/e.width,s=t.height/e.height,r=i>s?s:i;e.width*=r,e.height*=r;const n=XA.getViewportRect(),o=e.getBoundingBoxToWorld(),a=XA.getVisibleSize(),h=pa.devicePixelRatio,l=(n.width*(o.x/a.width)+n.x)/h,c=(n.height*(o.y/a.height)+n.y)/h,u=n.width*(o.width/a.width)/h,d=n.height*(o.height/a.height)/h;this._openDataContext.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:l,y:c,width:u,height:d})}_updateSubContextTexture(){const t=this._imageAsset;if(!t||!this._openDataContext)return;if(t.width<=0||t.height<=0)return;const e=this._openDataContext.canvas;t.reset(e),(e.width>t.width||e.height>t.height)&&this._texture.create(e.width,e.height),this._texture.uploadData(e)}_registerNodeEvent(){this.node.on("transform-changed",this._updateSubContextView,this),this.node.on("size-changed",this._updateSubContextView,this),this.node.on("layer-changed",this._updateContentLayer,this)}_unregisterNodeEvent(){this.node.off("transform-changed",this._updateSubContextView,this),this.node.off("size-changed",this._updateSubContextView,this),this.node.off("layer-changed",this._updateContentLayer,this)}_updateContentLayer(){this._content.layer=this.node.layer}update(t){void 0!==t?performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture()):this._updateSubContextTexture()}onDestroy(){this._content.destroy(),this._texture.destroy(),this._sprite&&this._sprite.destroy(),this._imageAsset.destroy(),this._openDataContext=null}},$Lt=Za(qLt.prototype,"_fps",[vh],(function(){return 60})),KLt=Za(qLt.prototype,"_designResolutionSize",[vh],(function(){return new Vr(640,960)})),YLt=qLt))||YLt)||YLt)||YLt);var QLt;h.SubContextView=ZLt,at({ButtonComponent:{newName:"Button",since:"1.2.0",removed:!1},EditBoxComponent:{newName:"EditBox",since:"1.2.0",removed:!1},LayoutComponent:{newName:"Layout",since:"1.2.0",removed:!1},ProgressBarComponent:{newName:"ProgressBar",since:"1.2.0",removed:!1},ScrollViewComponent:{newName:"ScrollView",since:"1.2.0",removed:!1},ScrollBarComponent:{newName:"ScrollBar",since:"1.2.0",removed:!1},SliderComponent:{newName:"Slider",since:"1.2.0",removed:!1},ToggleComponent:{newName:"Toggle",since:"1.2.0",removed:!1},ToggleContainerComponent:{newName:"ToggleContainer",since:"1.2.0",removed:!1},WidgetComponent:{newName:"Widget",since:"1.2.0",removed:!1},PageViewComponent:{newName:"PageView",since:"1.2.0",removed:!1},PageViewIndicatorComponent:{newName:"PageViewIndicator",since:"1.2.0",removed:!1},SafeAreaComponent:{newName:"SafeArea",since:"1.2.0",removed:!1},UICoordinateTrackerComponent:{newName:"UICoordinateTracker",since:"1.2.0",removed:!1},BlockInputEventsComponent:{newName:"BlockInputEvents",since:"1.2.0",removed:!1}});let JLt=t("UIReorderComponent",ah("cc.UIReorderComponent")(QLt=class{constructor(){j(1408,"UIReorderComponent")}})||QLt);var tkt,ekt,ikt;h.UIReorderComponent=JLt,h.ButtonComponent=ROt,Xt(ROt,"cc.ButtonComponent"),h.EditBoxComponent=dRt,Xt(dRt,"cc.EditBoxComponent"),h.LayoutComponent=qRt,Xt(qRt,"cc.LayoutComponent"),h.ProgressBarComponent=lBt,Xt(lBt,"cc.ProgressBarComponent"),h.ScrollViewComponent=cFt,Xt(cFt,"cc.ScrollViewComponent"),h.ScrollBarComponent=MBt,Xt(MBt,"cc.ScrollBarComponent"),h.SliderComponent=AFt,Xt(AFt,"cc.SliderComponent"),h.ToggleComponent=zFt,Xt(zFt,"cc.ToggleComponent"),h.ToggleContainerComponent=YFt,Xt(YFt,"cc.ToggleContainerComponent"),h.WidgetComponent=CNt,Xt(CNt,"cc.WidgetComponent"),h.PageViewComponent=pLt,Xt(pLt,"cc.PageViewComponent"),h.PageViewIndicatorComponent=UNt,Xt(UNt,"cc.PageViewIndicatorComponent"),h.SafeAreaComponent=ILt,Xt(ILt,"cc.SafeAreaComponent"),Xt(jLt,"cc.UICoordinateTrackerComponent"),h.BlockInputEventsComponent=XLt,Xt(XLt,"cc.BlockInputEventsComponent"),J(jA.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),tt(jA.prototype,"View.prototype",[{name:"adjustViewportMeta"},{name:"enableAutoFullScreen",suggest:"use screen.requestFullScreen() instead."},{name:"isAutoFullScreenEnabled"},{name:"setCanvasSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getCanvasSize",suggest:"please use screen.windowSize instead."},{name:"getFrameSize",suggest:"getting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"setFrameSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getDevicePixelRatio",suggest:"use screen.devicePixelRatio instead."},{name:"convertToLocationInView"},{name:"enableRetina"},{name:"isRetinaEnabled"},{name:"setRealPixelResolution"}]);let skt=t("VideoClip",ah("cc.VideoClip")((ekt=class extends fm{constructor(){super(),this._duration=ikt&&ikt(),this._video=null}set _nativeAsset(t){this._video=t,this._duration=t?t.duration:0}get _nativeAsset(){return this._video}},ikt=Za(ekt.prototype,"_duration",[vh],(function(){return 0})),tkt=ekt))||tkt);const rkt=c.document;function nkt(t,e,i){const s=rkt.createElement("video"),r=rkt.createElement("source");s.appendChild(r);const n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="blob",n.onload=function(){200===this.status||0===this.status?(r.src=URL.createObjectURL(this.response),i(null,s)):i(new Error(`${n.status}(no response)`))},n.onerror=function(){const e=`load video failure - ${t}`;I(e),i(new Error(e))},n.send()}function okt(t,e,i,s){const r=new skt;r._nativeUrl=t,r._nativeAsset=e,s(null,r)}rx.register({".mp4":nkt,".avi":nkt,".mov":nkt,".mpg":nkt,".mpeg":nkt,".rm":nkt,".rmvb":nkt}),fx.register({".mp4":okt,".avi":okt,".mov":okt,".mpg":okt,".mpeg":okt,".rm":okt,".rmvb":okt});class akt{constructor(t){this._componentEventList=new Map,this._state="none",this._video=null,this._onInterruptedBegin=void 0,this._onInterruptedEnd=void 0,this._interrupted=!1,this._loaded=!1,this._loadedMeta=!1,this._ignorePause=!1,this._fullScreenOnAwake=!1,this._visible=!0,this._playing=!1,this._cachedCurrentTime=-1,this._waitingFullscreen=!1,this._waitingPlay=!1,this._keepAspectRatio=!1,this._component=null,this._uiTrans=null,this._node=null,this._stayOnBottom=!1,this._dirty=!1,this._forceUpdate=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(RI),this._onInterruptedBegin=()=>{this.video&&"playing"===this._state&&(this.video.pause(),this._interrupted=!0)},this._onInterruptedEnd=()=>{this._interrupted&&this.video&&(this.video.play(),this._interrupted=!1)},h.game.on(h.Game.EVENT_PAUSE,this._onInterruptedBegin),h.game.on(h.Game.EVENT_RESUME,this._onInterruptedEnd)}get fullScreenOnAwake(){return this._fullScreenOnAwake}get loaded(){return this._loaded}get componentEventList(){return this._componentEventList}get video(){return this._video}get state(){return this._state}get isPlaying(){return this._playing}get UICamera(){return nC.root.batcher2D.getFirstRenderCamera(this._node)}onLoadedMetadata(t){this._loadedMeta=!0,this._forceUpdate=!0,this._visible?this.enable():this.disable(),this.dispatchEvent("meta-loaded");const e=t.target;this._keepAspectRatio&&e&&this.syncUITransform(e.videoWidth,e.videoHeight),this.delayedFullScreen(),this.delayedPlay()}onCanPlay(t){this._loaded=!0,this.dispatchEvent("ready-to-play")}onPlay(t){this._playing=!0,this.dispatchEvent("playing")}onPlaying(t){this.dispatchEvent("playing")}onPause(t){this._playing=!1,this._ignorePause?this._ignorePause=!1:this.dispatchEvent("paused")}onStoped(t){this._playing=!1,this._ignorePause=!1,this.dispatchEvent("stopped")}onEnded(t){this._playing=!1,this.dispatchEvent("completed")}onClick(t){this.dispatchEvent("clicked")}onError(t){this.dispatchEvent("error");const e=t.target;e&&e.error&&P(`Error ${e.error.code}; details: ${e.error.message}`)}play(){this._loadedMeta||this._loaded?this.canPlay():this._waitingPlay=!0}delayedPlay(){this._waitingPlay&&(this.canPlay(),this._waitingPlay=!1)}syncFullScreenOnAwake(t){this._fullScreenOnAwake=t,this._loadedMeta||this._loaded?this.canFullScreen(t):this._waitingFullscreen=!0}delayedFullScreen(){this._waitingFullscreen&&(this.canFullScreen(this._fullScreenOnAwake),this._waitingFullscreen=!1)}dispatchEvent(t){const e=this._componentEventList.get(t);e&&(this._state=t,e.call(this))}syncUITransform(t,e){const i=this._uiTrans;i&&(i.width=t,i.height=e)}syncCurrentTime(){this.video&&-1!==this._cachedCurrentTime&&this.video.currentTime!==this._cachedCurrentTime&&(this.seekTo(this._cachedCurrentTime),this._cachedCurrentTime=-1)}destroy(){this.removeVideoPlayer(),this._componentEventList.clear(),h.game.off(h.Game.EVENT_PAUSE,this._onInterruptedBegin),h.game.off(h.Game.EVENT_RESUME,this._onInterruptedEnd)}}h.internal.VideoPlayerImpl=akt;const hkt=c.document,lkt=wr();class ckt extends akt{constructor(t){super(t),this._eventList=new Map,this._clearColorA=-1,this._clearFlag=void 0}addListener(t,e){this._video&&(this._eventList.set(t,e),this._video.addEventListener(t,e))}removeAllListeners(){this._eventList.forEach(((t,e)=>{this._video&&this._video.removeEventListener(e,t)})),this._eventList.clear()}canPlay(){if(this.video){const t=this.video.play();c.Promise&&t instanceof Promise&&t.catch((()=>{})).then((()=>{this.syncCurrentTime()}))}}pause(){this.video&&(this.video.pause(),this._cachedCurrentTime=this.video.currentTime)}resume(){this.play()}stop(){this.video&&(this._ignorePause=!0,this.video.currentTime=0,this.video.pause(),this._cachedCurrentTime=0,setTimeout((()=>{this._ignorePause=!1,this.dispatchEvent("stopped")}),0))}syncClip(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t.nativeUrl)}syncURL(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t)}syncPlaybackRate(t){ga.browserType!==Vo.UC?this.video&&(this.video.playbackRate=t):M("playbackRate is not supported by the uc mobile browser.")}syncVolume(t){this.video&&(this.video.volume=t)}syncMute(t){this.video&&(this.video.muted=t)}syncLoop(t){this.video&&(this.video.loop=t)}getDuration(){return this.video?this.video.duration:0}getCurrentTime(){return this.video?this.video.currentTime:-1}seekTo(t){this.video&&(this.video.currentTime=t,this._cachedCurrentTime=this.video.currentTime)}canFullScreen(t){const e=this._video;if(e&&4===e.readyState)return ga.os===Go.IOS&&ga.isBrowser?(t?e.webkitEnterFullscreen&&e.webkitEnterFullscreen():e.webkitExitFullscreen&&e.webkitExitFullscreen(),void(this._fullScreenOnAwake=e.webkitDisplayingFullscreen)):ma.supportsFullScreen?void(t?(ga.browserType===Vo.IE&&(e.style.transform=""),e.setAttribute("x5-video-player-fullscreen","true"),ma.requestFullScreen(e,(t=>{const i=ga.browserType===Vo.IE?t.msFullscreenElement:t.fullscreenElement;this._fullScreenOnAwake=i===e}),(()=>{this._fullScreenOnAwake=!1}))):(e.removeAttribute("x5-video-player-fullscreen"),ma.exitFullScreen())):(this._fullScreenOnAwake=t,this._forceUpdate=!0,void this.syncMatrix())}syncStayOnBottom(t){this._video&&(this._video.style["z-index"]=t?-32768:0,this._stayOnBottom=t),this._dirty=!0}syncKeepAspectRatio(t){this._keepAspectRatio=t,t&&this._loadedMeta&&this._video&&this.syncUITransform(this._video.videoWidth,this._video.videoHeight)}removeVideoPlayer(){const t=this._video;t&&Me(JA.container,t)&&(JA.container.removeChild(t),this.removeAllListeners()),this._cachedCurrentTime=0,this._playing=!1,this._loaded=!1,this._loadedMeta=!1,this._video=null}createVideoPlayer(t){const e=this._video=hkt.createElement("video");e.className="cocosVideo",e.style.visibility="hidden",e.style.position="absolute",e.style.bottom="0px",e.style.left="0px",e.style["transform-origin"]="0px 100% 0px",e.style["-webkit-transform-origin"]="0px 100% 0px",e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("x5-playsinline",""),e.setAttribute("playsinline",""),this._bindDomEvent(),JA.container.appendChild(e);const i=hkt.createElement("source");e.appendChild(i),i.src=t}_bindDomEvent(){this._video,this.addListener("loadedmetadata",this.onLoadedMetadata.bind(this)),this.addListener("canplay",this.onCanPlay.bind(this)),this.addListener("canplaythrough",this.onCanPlay.bind(this)),this.addListener("play",this.onPlay.bind(this)),this.addListener("playing",this.onPlaying.bind(this)),this.addListener("pause",this.onPause.bind(this)),this.addListener("click",this.onClick.bind(this)),this.addListener("ended",this.onEnded.bind(this)),this.addListener("error",this.onError.bind(this))}onCanPlay(t){const e=t.target;if(!this._loaded||!e)switch(e.readyState){case 1:case 4:super.onCanPlay(t)}}enable(){if(this._video){if(this._visible=!0,"visible"===this._video.style.visibility)return;this._video.style.visibility="visible"}}disable(t){if(this._video){if(!t&&this._playing&&this._video.pause(),this._visible=!1,"hidden"===this._video.style.visibility)return;this._video.style.visibility="hidden"}}syncMatrix(){if(!this._video||!this._visible||!this._component)return;const t=this.UICamera;if(!t)return;this._dirty&&(this._dirty=!1,this._stayOnBottom?(this._clearColorA=t.clearColor.w,this._clearFlag=t.clearFlag,t.clearColor.w=0,t.clearFlag=7):this._clearFlag&&(t.clearColor.w=this._clearColorA,t.clearFlag=this._clearFlag,this._clearColorA=-1,this._clearFlag=null)),this._component.node.getWorldMatrix(lkt),t.update(!0),t.worldMatrixToScreen(lkt,lkt,JA.canvas.width,JA.canvas.height);let e=0,i=0;if(this._fullScreenOnAwake?(e=fa.width,i=fa.height):(e=this._uiTrans.contentSize.width,i=this._uiTrans.contentSize.height),!this._forceUpdate&&this._m00===lkt.m00&&this._m01===lkt.m01&&this._m04===lkt.m04&&this._m05===lkt.m05&&this._m12===lkt.m12&&this._m13===lkt.m13&&this._w===e&&this._h===i)return;this._m00=lkt.m00,this._m01=lkt.m01,this._m04=lkt.m04,this._m05=lkt.m05,this._m12=lkt.m12,this._m13=lkt.m13,this._w=e,this._h=i;const s=pa.devicePixelRatio,r=1/s,n=1/s,o=JA.container,a=lkt.m00*r,h=lkt.m01,l=lkt.m04,c=lkt.m05*n;this._video.style.width=`${this._w}px`,this._video.style.height=`${this._h}px`,ga.browserType!==Vo.MOBILE_QQ?this._video.style.objectFit=this._keepAspectRatio?"none":"fill":M("keepAspectRatio is not supported by the qq mobile browser.");const u=this._w*r,d=this._h*n,{x:_,y:p}=this._uiTrans.anchorPoint,m=u*lkt.m00*_,g=d*lkt.m05*p,f=o&&o.style.paddingLeft?parseInt(o.style.paddingLeft):0,y=o&&o.style.paddingBottom?parseInt(o.style.paddingBottom):0,b=`matrix(${a},${-h},${-l},${c},${lkt.m12*r-m+f},${-(lkt.m13*n-g+y)})`;this._video.style.transform=b,this._video.style["-webkit-transform"]=b,ga.browserType!==Vo.IE&&(this._forceUpdate=!1)}}class ukt{static getImpl(t){return new ckt(t)}}h.internal.VideoPlayerImplManager=ukt;const dkt=pe({REMOTE:0,LOCAL:1});var _kt,pkt,mkt,gkt,fkt,ykt,bkt,vkt,Skt,Tkt,wkt,xkt,Ckt,Akt,Dkt,Ekt,Ikt,Mkt,Pkt,Okt,Rkt;let Bkt=t("VideoPlayer",(_kt=ah("cc.VideoPlayer"),pkt=hh(RI),mkt=Xh(skt),gkt=Xh(dkt),fkt=Xh(skt),ykt=Xh([Um]),_kt(bkt=pkt((Rkt=class extends Km{constructor(){super(),this._resourceType=Skt&&Skt(),this._remoteURL=Tkt&&Tkt(),this._clip=wkt&&wkt(),this._playOnAwake=xkt&&xkt(),this._volume=Ckt&&Ckt(),this._mute=Akt&&Akt(),this._playbackRate=Dkt&&Dkt(),this._loop=Ekt&&Ekt(),this._fullScreenOnAwake=Ikt&&Ikt(),this._stayOnBottom=Mkt&&Mkt(),this._keepAspectRatio=Pkt&&Pkt(),this._impl=null,this._cachedCurrentTime=0,this.videoPlayerEvent=Okt&&Okt()}get resourceType(){return this._resourceType}set resourceType(t){this._resourceType!==t&&(this._resourceType=t,this.syncSource())}get remoteURL(){return this._remoteURL}set remoteURL(t){this._remoteURL!==t&&(this._remoteURL=t,this.syncSource())}get clip(){return this._clip}set clip(t){this._clip!==t&&(this._clip=t,this.syncSource())}get playOnAwake(){return this._playOnAwake}set playOnAwake(t){this._playOnAwake=t}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._impl&&this._impl.syncPlaybackRate(t)}get volume(){return this._volume}set volume(t){this._volume=t,this._impl&&this._impl.syncVolume(t)}get mute(){return this._mute}set mute(t){this._mute=t,this._impl&&this._impl.syncMute(t)}get loop(){return this._loop}set loop(t){this._loop=t,this._impl&&this._impl.syncLoop(t)}get keepAspectRatio(){return this._keepAspectRatio}set keepAspectRatio(t){this._keepAspectRatio!==t&&(this._keepAspectRatio=t,this._impl&&this._impl.syncKeepAspectRatio(t))}get fullScreenOnAwake(){return this._impl?(this._fullScreenOnAwake=this._impl.fullScreenOnAwake,this._fullScreenOnAwake):this._fullScreenOnAwake}set fullScreenOnAwake(t){this._fullScreenOnAwake!==t&&(this._fullScreenOnAwake=t,this._impl&&this._impl.syncFullScreenOnAwake(t))}get stayOnBottom(){return this._stayOnBottom}set stayOnBottom(t){this._stayOnBottom!==t&&(this._stayOnBottom=t,this._impl&&this._impl.syncStayOnBottom(t))}get nativeVideo(){return this._impl&&this._impl.video||null}get currentTime(){return this._impl?this._impl.getCurrentTime():this._cachedCurrentTime}set currentTime(t){Number.isNaN(t)?M(`illegal video time! value:${t}`):(t=Ri(t,0,this.duration),this._cachedCurrentTime=t,this._impl&&this._impl.seekTo(t))}get duration(){return this._impl?this._impl.getDuration():0}get state(){return this._impl?this._impl.state:"none"}get isPlaying(){return!!this._impl&&this._impl.isPlaying}syncSource(){const t=this._impl;t&&(this._resourceType===dkt.REMOTE?t.syncURL(this._remoteURL):t.syncClip(this._clip),this._cachedCurrentTime=0,t.syncLoop(this._loop),t.syncVolume(this._volume),t.syncMute(this._mute),t.seekTo(this._cachedCurrentTime),t.syncPlaybackRate(this._playbackRate),t.syncStayOnBottom(this._stayOnBottom),t.syncKeepAspectRatio(this._keepAspectRatio),t.syncFullScreenOnAwake(this._fullScreenOnAwake))}__preload(){this._impl=ukt.getImpl(this),this.syncSource();const{componentEventList:t}=this._impl;t.set("meta-loaded",this.onMetaLoaded.bind(this)),t.set("ready-to-play",this.onReadyToPlay.bind(this)),t.set("playing",this.onPlaying.bind(this)),t.set("paused",this.onPaused.bind(this)),t.set("stopped",this.onStopped.bind(this)),t.set("completed",this.onCompleted.bind(this)),t.set("error",this.onError.bind(this)),t.set("clicked",this.onClicked.bind(this)),this._playOnAwake&&this._impl.loaded&&this.play()}onEnable(){this._impl&&this._impl.enable()}onDisable(){this._impl&&this._impl.disable()}onDestroy(){this._impl&&(this._impl.destroy(),this._impl=null)}update(t){this._impl&&this._impl.syncMatrix()}onMetaLoaded(){Um.emitEvents(this.videoPlayerEvent,this,"meta-loaded"),this.node.emit("meta-loaded",this)}onReadyToPlay(){this._playOnAwake&&!this.isPlaying&&this.play(),Um.emitEvents(this.videoPlayerEvent,this,"ready-to-play"),this.node.emit("ready-to-play",this)}onPlaying(){Um.emitEvents(this.videoPlayerEvent,this,"playing"),this.node.emit("playing",this)}onPaused(){Um.emitEvents(this.videoPlayerEvent,this,"paused"),this.node.emit("paused",this)}onStopped(){Um.emitEvents(this.videoPlayerEvent,this,"stopped"),this.node.emit("stopped",this)}onCompleted(){Um.emitEvents(this.videoPlayerEvent,this,"completed"),this.node.emit("completed",this)}onError(){Um.emitEvents(this.videoPlayerEvent,this,"error"),this.node.emit("error",this)}onClicked(){Um.emitEvents(this.videoPlayerEvent,this,"clicked"),this.node.emit("clicked",this)}play(){this._impl&&this._impl.play()}resume(){this._impl&&this._impl.resume()}pause(){this._impl&&this._impl.pause()}stop(){this._impl&&this._impl.stop()}},Rkt.EventType={NONE:"none",PLAYING:"playing",PAUSED:"paused",STOPPED:"stopped",COMPLETED:"completed",META_LOADED:"meta-loaded",READY_TO_PLAY:"ready-to-play",ERROR:"error",CLICKED:"clicked"},Rkt.ResourceType=dkt,Skt=Za((vkt=Rkt).prototype,"_resourceType",[vh],(function(){return dkt.LOCAL})),Tkt=Za(vkt.prototype,"_remoteURL",[vh],(function(){return""})),wkt=Za(vkt.prototype,"_clip",[mkt,vh],(function(){return null})),xkt=Za(vkt.prototype,"_playOnAwake",[vh],(function(){return!0})),Ckt=Za(vkt.prototype,"_volume",[vh],(function(){return 1})),Akt=Za(vkt.prototype,"_mute",[vh],(function(){return!1})),Dkt=Za(vkt.prototype,"_playbackRate",[vh],(function(){return 1})),Ekt=Za(vkt.prototype,"_loop",[vh],(function(){return!1})),Ikt=Za(vkt.prototype,"_fullScreenOnAwake",[vh],(function(){return!1})),Mkt=Za(vkt.prototype,"_stayOnBottom",[vh],(function(){return!1})),Pkt=Za(vkt.prototype,"_keepAspectRatio",[vh],(function(){return!0})),s(vkt.prototype,"resourceType",[gkt],Object.getOwnPropertyDescriptor(vkt.prototype,"resourceType"),vkt.prototype),s(vkt.prototype,"clip",[fkt],Object.getOwnPropertyDescriptor(vkt.prototype,"clip"),vkt.prototype),Okt=Za(vkt.prototype,"videoPlayerEvent",[vh,ykt],(function(){return[]})),bkt=vkt))||bkt)||bkt));h.internal.VideoPlayer=Bkt,Q(Bkt.prototype,"VideoPlayer.prototype",[{name:"onPasued",newName:"onPaused"}]);class Fkt{constructor(t){this._componentEventList=new Map,this._state="none",this._wrapper=void 0,this._webview=null,this._loaded=!1,this._forceUpdate=!1,this._component=null,this._uiTrans=null,this._node=null,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(RI),this.reset(),this.createWebView()}reset(){this._wrapper=null,this._webview=null,this._loaded=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._state="none",this._forceUpdate=!1}get loaded(){return this._loaded}get componentEventList(){return this._componentEventList}get webview(){return this._webview}get state(){return this._state}get UICamera(){return nC.root.batcher2D.getFirstRenderCamera(this._node)}dispatchEvent(t,...e){const i=this._componentEventList.get(t);i&&(this._state=t,i.call(this,e))}destroy(){this.removeWebView(),this._wrapper=null,this._webview=null,this._loaded=!1,this._component=null,this._uiTrans=null,this._forceUpdate=!1,this._componentEventList.clear()}}h.internal.WebViewImpl=Fkt;const Nkt=c.document,Lkt=wr();class kkt extends Fkt{constructor(t){super(t)}_bindDomEvent(){this.webview&&this.webview.addEventListener("load",(t=>{this._forceUpdate=!0,this.dispatchEvent("loaded");const e=t.target,i=e.contentDocument&&e.contentDocument.body;i&&i.innerHTML.includes("404")&&this.dispatchEvent("error",i.innerHTML)}))}loadURL(t){this.webview&&(this.webview.src=t,this.dispatchEvent("loading"))}createWebView(){const t=Nkt.createElement("div");this._wrapper=t,t.id="webview-wrapper";const e=t.style;e["-webkit-overflow"]="auto",e["-webkit-overflow-scrolling"]="touch",e.position="absolute",e.bottom="0px",e.left="0px",e.transformOrigin="0px 100% 0px",e["-webkit-transform-origin"]="0px 100% 0px",JA.container.appendChild(t);const i=Nkt.createElement("iframe");this._webview=i;const s=i.style;i.id="webview",s.border="none",s.width="100%",s.height="100%",t.appendChild(i),this._bindDomEvent()}removeWebView(){const t=this._wrapper;Me(JA.container,t)&&JA.container.removeChild(t),this.reset()}enable(){this._wrapper&&(this._wrapper.style.visibility="visible")}disable(){this._wrapper&&(this._wrapper.style.visibility="hidden")}evaluateJS(t){if(this.webview){const e=this.webview.contentWindow;if(e)try{e.eval(t)}catch(t){this.dispatchEvent("error",t),P(t)}}}setOnJSCallback(t){M("The platform does not support")}setJavascriptInterfaceScheme(t){M("The platform does not support")}syncMatrix(){if(!this._wrapper||!this._uiTrans||!this._component||"hidden"===this._wrapper.style.visibility)return;const t=this.UICamera;if(!t)return;this._component.node.getWorldMatrix(Lkt),t.update(!0),t.worldMatrixToScreen(Lkt,Lkt,JA.canvas.width,JA.canvas.height);const{width:e,height:i}=this._uiTrans.contentSize;if(!this._forceUpdate&&this._m00===Lkt.m00&&this._m01===Lkt.m01&&this._m04===Lkt.m04&&this._m05===Lkt.m05&&this._m12===Lkt.m12&&this._m13===Lkt.m13&&this._w===e&&this._h===i)return;this._m00=Lkt.m00,this._m01=Lkt.m01,this._m04=Lkt.m04,this._m05=Lkt.m05,this._m12=Lkt.m12,this._m13=Lkt.m13,this._w=e,this._h=i;const s=pa.devicePixelRatio,r=1/s,n=1/s,o=JA.container,a=Lkt.m00*r,h=Lkt.m01,l=Lkt.m04,c=Lkt.m05*n;this._wrapper.style.width=`${e}px`,this._wrapper.style.height=`${i}px`;const u=this._w*r,d=this._h*n,_=u*Lkt.m00*this._uiTrans.anchorX,p=d*Lkt.m05*this._uiTrans.anchorY,m=o&&o.style.paddingLeft?parseInt(o.style.paddingLeft):0,g=o&&o.style.paddingBottom?parseInt(o.style.paddingBottom):0,f=`matrix(${a},${-h},${-l},${c},${Lkt.m12*r-_+m},${-(Lkt.m13*n-p+g)})`;this._wrapper.style.transform=f,this._wrapper.style["-webkit-transform"]=f,this._forceUpdate=!1}}class zkt{static getImpl(t){return new kkt(t)}}var Ukt,Vkt,jkt,Hkt,Gkt,Wkt,Xkt,Ykt;h.internal.WebViewImplManager=zkt;let qkt=t("WebView",(Ukt=ah("cc.WebView"),Vkt=hh(RI),jkt=Xh([Um]),Ukt(Hkt=Vkt(((Ykt=class extends Km{constructor(){super(),this._url=Wkt&&Wkt(),this._impl=null,this.webviewEvents=Xkt&&Xkt()}get url(){return this._url}set url(t){this._url=t,this._impl&&this._impl.loadURL(t)}get nativeWebView(){return this._impl&&this._impl.webview||null}get state(){return this._impl?this._impl.state:"none"}setJavascriptInterfaceScheme(t){this._impl&&this._impl.setJavascriptInterfaceScheme(t)}setOnJSCallback(t){this._impl&&this._impl.setOnJSCallback(t)}evaluateJS(t){this._impl&&this._impl.evaluateJS(t)}__preload(){this._impl=zkt.getImpl(this);const{componentEventList:t}=this._impl;t.set("loading",this.onLoading.bind(this)),t.set("loaded",this.onLoaded.bind(this)),t.set("error",this.onError.bind(this)),this._impl.loadURL(this._url)}onLoading(){Um.emitEvents(this.webviewEvents,this,"loading"),this.node.emit("loading",this)}onLoaded(){Um.emitEvents(this.webviewEvents,this,"loaded"),this.node.emit("loaded",this)}onError(...t){Um.emitEvents(this.webviewEvents,this,"error",t),this.node.emit("error",this,t)}onEnable(){this._impl&&this._impl.enable()}onDisable(){this._impl&&this._impl.disable()}onDestroy(){this._impl&&(this._impl.destroy(),this._impl=null)}update(t){this._impl&&this._impl.syncMatrix()}}).EventType={NONE:"none",LOADING:"loading",LOADED:"loaded",ERROR:"error"},Wkt=Za((Gkt=Ykt).prototype,"_url",[vh],(function(){return"https://cocos.com"})),Xkt=Za(Gkt.prototype,"webviewEvents",[vh,jkt],(function(){return[]})),Hkt=Gkt))||Hkt)||Hkt));h.internal.WebView=qkt}}}));
